"use client";

import {
    Compass,
    ThumbsUp,
    GitFork,
    Star,
    Bookmark,
    Building2,
    AppWindow,
} from "lucide-react";
import {
    Sidebar,
    SidebarContent,
    SidebarFooter,
    SidebarGroup,
    SidebarGroupContent,
    SidebarGroupLabel,
    SidebarMenu,
    SidebarMenuButton,
    SidebarMenuItem,
    SidebarRail,
} from "@/components/animate-ui/components/radix/sidebar";
import React, { useState } from "react";
import Link from "next/link";
import { useRouter } from "next/navigation";
import { useTranslations } from "@/hooks/use-translations";
import { useAuth } from "@/contexts/auth-context";
import Image from "next/image";

// 飞书图标 SVG 组件
const FeishuIcon = () => (
    <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg" data-view-component="true" className="v-align-middle text-muted-foreground hover:text-primary cursor-pointer grayscale size-5 sm:size-4 hover:filter-none transition duration-200"><path d="M23.0793 12.7082C23.0053 12.7122 22.9873 12.6782 22.9793 12.6082C22.9713 12.5342 22.9753 12.4462 22.9393 12.3882C22.8693 12.2782 22.8893 12.1482 22.8293 12.0342C22.7955 11.9738 22.7718 11.9083 22.7593 11.8402C22.7553 11.8002 22.7654 11.7442 22.7374 11.7222C22.6734 11.6762 22.6974 11.6022 22.6574 11.5422C22.6134 11.4782 22.6114 11.3842 22.5774 11.3062C22.5434 11.2242 22.5014 11.1362 22.4934 11.0462C22.4894 11.0022 22.4394 11.0002 22.4414 10.9562C22.4454 10.8822 22.3914 10.8222 22.3734 10.7522C22.3494 10.6582 22.2974 10.5682 22.2614 10.4762C22.2334 10.4022 22.2034 10.3262 22.1694 10.2602C22.1194 10.1602 22.0774 10.0582 22.0194 9.96019C21.9634 9.8742 21.9474 9.7622 21.8874 9.6682C21.8378 9.58997 21.795 9.50768 21.7594 9.4222C21.7014 9.2862 21.6174 9.1682 21.5514 9.03821C21.4878 8.90947 21.4191 8.78337 21.3454 8.66021C21.2754 8.54221 21.2134 8.41821 21.1314 8.30422C21.0994 8.25822 21.0474 8.21222 21.0394 8.16022C21.0274 8.08422 20.9694 8.03022 20.9334 7.98622C20.8834 7.92622 20.8814 7.82022 20.7834 7.79822C20.7834 7.79822 20.7794 7.78822 20.7814 7.78422C20.7894 7.70422 20.6774 7.68222 20.6874 7.60022C20.6014 7.57022 20.6254 7.44423 20.5274 7.42023C20.5274 7.42023 20.5234 7.41223 20.5254 7.40823C20.5334 7.32823 20.4554 7.28423 20.4214 7.23223C20.3771 7.16523 20.3269 7.10231 20.2714 7.04423C20.2454 7.01623 20.2014 6.99223 20.1914 6.95823C20.1574 6.83823 20.0434 6.77823 19.9854 6.67424C19.9314 6.57824 19.8374 6.51424 19.7634 6.43424C19.6921 6.34963 19.6034 6.2814 19.5034 6.23424C19.4094 6.19824 19.3354 6.12224 19.2234 6.11624C19.1074 6.11024 18.9974 6.04224 18.8754 6.04624C18.8754 6.02024 18.8674 6.00024 18.8354 6.00024H6.71355C6.68155 6.00024 6.67355 6.02024 6.67355 6.04624C6.59355 6.04024 6.54955 6.10624 6.52355 6.15424C6.46355 6.26024 6.54955 6.45424 6.66555 6.50024C6.71355 6.51824 6.73955 6.55224 6.77355 6.58424C6.79155 6.60224 6.80755 6.63024 6.83355 6.62624C6.88155 6.62224 6.90355 6.65624 6.91755 6.68424C6.93555 6.72224 6.96955 6.73623 6.99755 6.75023C7.0823 6.79438 7.1604 6.85026 7.22954 6.91623C7.33354 7.01223 7.44954 7.09023 7.56154 7.17223C7.65554 7.24023 7.73154 7.33023 7.83354 7.38623C7.91154 7.42623 7.95354 7.51623 8.02753 7.55222C8.13153 7.60422 8.18953 7.70422 8.28953 7.75622C8.35153 7.78822 8.39953 7.84022 8.44353 7.89222C8.48353 7.93822 8.55553 7.94022 8.58753 7.98622C8.68153 8.12622 8.84152 8.19022 8.95152 8.31621C9.05952 8.43821 9.21152 8.51221 9.32352 8.64021C9.45552 8.79421 9.63551 8.90421 9.77951 9.04821C9.87951 9.1482 9.98151 9.2422 10.0835 9.3382C10.1635 9.4122 10.2435 9.4862 10.3195 9.5642C10.3755 9.6202 10.4475 9.6642 10.4995 9.7142C10.6295 9.8402 10.7795 9.95219 10.8695 10.1142L10.8895 10.1382C10.9895 10.2322 11.0895 10.3262 11.1855 10.4222C11.3055 10.5422 11.4215 10.6702 11.5515 10.7842C11.6051 10.824 11.65 10.8744 11.6835 10.9322C11.7095 10.9922 11.7555 11.0322 11.7955 11.0702C11.9055 11.1782 12.0255 11.2782 12.1035 11.4142C12.1355 11.4702 12.2015 11.4902 12.2355 11.5442C12.2795 11.6122 12.3455 11.6602 12.3895 11.7322C12.4535 11.8382 12.5635 11.9122 12.6375 12.0222C12.7095 12.1302 12.8055 12.2342 12.8975 12.3262C13.0015 12.4302 13.0735 12.5582 13.1835 12.6522C13.2415 12.7002 13.2475 12.7922 13.3215 12.8222C13.3595 12.8382 13.3715 12.8702 13.3815 12.8962C13.4215 12.9822 13.4955 13.0422 13.5415 13.1222C13.5875 13.2022 13.6655 13.2522 13.7175 13.3302C13.8135 13.4782 13.9235 13.6201 14.0435 13.7501C14.0815 13.7941 14.0775 13.8621 14.1335 13.8841C14.2175 13.9181 14.2315 14.0081 14.2755 14.0681C14.3315 14.1461 14.4075 14.2121 14.4495 14.2981C14.4935 14.3901 14.5695 14.4581 14.6175 14.5421C14.6615 14.6181 14.7175 14.6861 14.7635 14.7621C14.7975 14.8201 14.8294 14.8861 14.8794 14.9361C14.9334 14.9901 14.9494 15.0721 15.0114 15.1221C15.0674 15.1681 15.0794 15.2421 15.1314 15.2941C15.1854 15.3541 15.2074 15.4421 15.2674 15.5001C15.3194 15.5501 15.3454 15.6181 15.3814 15.6761C15.4074 15.7161 15.4614 15.7401 15.4674 15.7941C15.4734 15.8541 15.5194 15.8901 15.5494 15.9341C15.5954 16.0021 15.6554 16.0701 15.6814 16.1341C15.7294 16.2541 15.8114 16.3461 15.8694 16.4541C15.9374 16.5741 16.0214 16.6941 16.0894 16.8181C16.1414 16.9081 16.1934 16.9981 16.2494 17.0821C16.2734 17.1241 16.2694 17.1801 16.3154 17.2121C16.3714 17.2521 16.3834 17.3201 16.4154 17.3761C16.4434 17.4261 16.4634 17.4861 16.5034 17.5201C16.5354 17.5481 16.5354 17.5741 16.5414 17.6061C16.5894 17.6261 16.6134 17.5881 16.6414 17.5621L16.8654 17.3401L17.3274 16.8841C17.4594 16.7541 17.5814 16.6161 17.7174 16.4901C17.9574 16.2701 18.1774 16.0341 18.4174 15.8121C18.5734 15.6661 18.7134 15.5061 18.8854 15.3761C19.0354 15.2601 19.1614 15.1161 19.2974 14.9821L19.5994 14.6821C19.7034 14.5781 19.8394 14.5101 19.9354 14.3981C19.9432 14.3872 19.9535 14.3783 19.9654 14.3721C20.0654 14.3321 20.1354 14.2501 20.2194 14.1881C20.3174 14.1181 20.4154 14.0481 20.5114 13.9741C20.5594 13.9361 20.6214 13.9181 20.6634 13.8761C20.7834 13.7561 20.9434 13.7021 21.0834 13.6181C21.2314 13.5301 21.3834 13.4442 21.5394 13.3702C21.6494 13.3182 21.7474 13.2342 21.8674 13.2102C22.0054 13.1822 22.1074 13.0882 22.2374 13.0482C22.2774 13.0362 22.3274 13.0322 22.3634 13.0042C22.4394 12.9442 22.5414 12.9442 22.6274 12.9042C22.6674 12.8842 22.7114 12.8582 22.7574 12.8522C22.8613 12.8382 22.9533 12.7902 23.0533 12.7642C23.0813 12.7582 23.1033 12.7422 23.0793 12.7082Z" fill="#00D6B9"></path><path d="M25.9602 20.0361C25.9302 20.0161 25.9122 20.0421 25.8942 20.0601C25.8402 20.1081 25.8022 20.1721 25.7562 20.2281L25.5262 20.4961C25.3682 20.6701 25.1982 20.8361 25.0262 20.9921C24.8922 21.1141 24.7422 21.2181 24.5982 21.3281C24.5442 21.3681 24.4902 21.4121 24.4342 21.4481C24.3742 21.4901 24.3202 21.5461 24.2542 21.5741C24.1282 21.6281 24.0162 21.7061 23.9002 21.7741C23.6963 21.8861 23.4852 21.9843 23.2682 22.0681C23.1462 22.1181 23.0262 22.1721 22.9002 22.2121C22.8002 22.2441 22.7022 22.2861 22.6002 22.3121C22.5662 22.3201 22.5302 22.3161 22.4982 22.3281C22.3982 22.3661 22.2922 22.3881 22.1882 22.4141C22.0982 22.4381 22.0003 22.4181 21.9223 22.4541C21.8023 22.5101 21.6663 22.4581 21.5543 22.5341C21.3803 22.5321 21.2063 22.5521 21.0323 22.5661C20.7243 22.5901 20.4163 22.5461 20.1083 22.5381C19.9683 22.5341 19.8363 22.4641 19.6943 22.4841C19.6863 22.4841 19.6783 22.4821 19.6723 22.4761C19.6263 22.4401 19.5723 22.4421 19.5203 22.4421C19.4123 22.4421 19.3083 22.4181 19.2063 22.3981C19.1063 22.3781 19.0043 22.3401 18.9063 22.3061C18.8483 22.2861 18.7863 22.2981 18.7343 22.2721C18.6583 22.2356 18.5775 22.21 18.4943 22.1961C18.3023 22.1561 18.1243 22.0761 17.9303 22.0441C17.8023 22.0221 17.6903 21.9501 17.5623 21.9241C17.4723 21.9041 17.3843 21.8721 17.2983 21.8441C17.1883 21.8081 17.0783 21.7701 16.9663 21.7421C16.7883 21.6941 16.6243 21.6181 16.4503 21.5621C16.2423 21.4941 16.0403 21.4121 15.8323 21.3421C15.7103 21.3021 15.6003 21.2281 15.4683 21.2081C15.4117 21.1984 15.3574 21.178 15.3083 21.1481C15.2103 21.0921 15.1003 21.0721 15.0003 21.0241C14.9163 20.9841 14.8223 20.9641 14.7403 20.9241C14.6043 20.8541 14.4463 20.8321 14.3223 20.7341C14.3143 20.7281 14.3023 20.7261 14.2923 20.7261C14.1923 20.7161 14.1023 20.6701 14.0164 20.6261C13.8264 20.5341 13.6224 20.4721 13.4364 20.3701C13.2884 20.2881 13.1244 20.2421 12.9764 20.1621C12.9424 20.1541 12.9124 20.1601 12.8764 20.1421C12.8144 20.1121 12.7564 20.0621 12.6924 20.0461C12.5704 20.0121 12.4784 19.9241 12.3584 19.8881C12.2904 19.8681 12.2384 19.8081 12.1744 19.7921C12.0944 19.7721 12.0284 19.7321 11.9644 19.6961C11.8584 19.6361 11.7444 19.5961 11.6384 19.5301C11.5804 19.4941 11.5044 19.4821 11.4544 19.4401C11.3784 19.3761 11.2604 19.3801 11.2084 19.2841C11.0804 19.2741 10.9944 19.1761 10.8844 19.1301C10.7544 19.0761 10.6364 18.9941 10.5124 18.9241C10.4604 18.8941 10.4124 18.8401 10.3624 18.8301C10.2264 18.8021 10.1344 18.7061 10.0224 18.6461C9.8915 18.5774 9.76463 18.5013 9.64241 18.4181C9.62241 18.4061 9.59241 18.4081 9.57841 18.3921C9.49841 18.3021 9.38441 18.2561 9.28641 18.1961C9.189 18.1387 9.09232 18.08 8.99641 18.0201C8.87841 17.9461 8.75642 17.8721 8.64442 17.7921C8.57042 17.7381 8.47642 17.7061 8.41242 17.6441C8.36442 17.6001 8.30642 17.5841 8.25842 17.5441C8.17042 17.4721 8.06842 17.4141 7.97243 17.3482C7.92843 17.3182 7.87043 17.2902 7.84043 17.2582C7.78243 17.1942 7.70443 17.1622 7.64243 17.1102C7.55043 17.0322 7.43443 16.9782 7.34243 16.8962C7.28843 16.8482 7.20844 16.8402 7.16844 16.7722C7.15444 16.7462 7.12844 16.7282 7.09244 16.7182C7.03244 16.7022 6.99044 16.6522 6.94044 16.6182C6.86644 16.5682 6.80044 16.5002 6.72444 16.4482C6.63244 16.3862 6.55244 16.3042 6.45844 16.2482C6.35645 16.1862 6.28445 16.0902 6.18245 16.0322C6.12045 15.9942 6.08245 15.9242 6.02245 15.8962C5.91445 15.8482 5.85045 15.7542 5.75245 15.6962C5.67645 15.6482 5.62446 15.5582 5.54446 15.5162C5.45046 15.4662 5.39446 15.3782 5.31046 15.3202C5.28646 15.3022 5.25846 15.3002 5.23646 15.2722C5.18246 15.2062 5.10846 15.1582 5.04646 15.1002C4.98046 15.0402 4.89846 15.0002 4.83846 14.9282C4.79047 14.8762 4.73847 14.8062 4.67847 14.7822C4.58647 14.7482 4.54647 14.6662 4.47447 14.6142C4.38447 14.5502 4.31847 14.4582 4.23047 14.3882C4.17447 14.3442 4.11047 14.3082 4.06647 14.2522C4.00048 14.1682 3.91648 14.0982 3.84048 14.0262C3.74048 13.9282 3.64448 13.8262 3.54048 13.7322C3.46048 13.6602 3.38648 13.5802 3.30448 13.5082C3.22848 13.4402 3.16049 13.3642 3.08449 13.2962C2.98449 13.2042 2.89249 13.1002 2.79649 13.0022C2.70249 12.9022 2.60049 12.8102 2.50849 12.7082C2.42849 12.6182 2.3485 12.5082 2.1925 12.5422C2.1165 12.5582 2.0805 12.6062 2.0525 12.6682C1.9745 12.6762 2.0065 12.7362 2.0065 12.7702V24.0961C2.0065 24.1421 2.0105 24.1861 2.0085 24.2301C2.0085 24.2641 2.0205 24.2801 2.0525 24.2821C2.0325 24.3861 2.1025 24.4701 2.1185 24.5661C2.1285 24.6341 2.1725 24.6921 2.1985 24.7561C2.2365 24.8441 2.3105 24.9181 2.3625 25.0021C2.40929 25.0732 2.46898 25.1349 2.53849 25.1841C2.61049 25.2361 2.68449 25.2921 2.76249 25.3381C2.85449 25.3901 2.94249 25.456 3.02849 25.516C3.05449 25.532 3.08449 25.536 3.11249 25.562C3.19249 25.634 3.29448 25.688 3.39248 25.738C3.45848 25.772 3.52048 25.818 3.59248 25.848C3.75248 25.914 3.88848 26.034 4.05247 26.098C4.14447 26.132 4.21447 26.198 4.30847 26.226C4.33047 26.234 4.35647 26.236 4.37447 26.248C4.50647 26.34 4.65647 26.392 4.79847 26.464C4.82846 26.48 4.86646 26.48 4.89046 26.5C4.96632 26.5594 5.0556 26.5993 5.15046 26.616C5.16646 26.62 5.18246 26.622 5.20046 26.636C5.24046 26.666 5.29046 26.688 5.33646 26.714C5.38846 26.744 5.45646 26.726 5.50446 26.778C5.52246 26.798 5.56446 26.824 5.59846 26.83C5.73845 26.856 5.86845 26.922 5.99845 26.974C6.03845 26.99 6.09045 26.974 6.11845 27.004C6.17045 27.058 6.24445 27.056 6.30445 27.084C6.39245 27.122 6.48444 27.152 6.58244 27.176C6.62444 27.186 6.68244 27.178 6.70844 27.206C6.75844 27.262 6.83444 27.266 6.88844 27.28C7.03244 27.314 7.17244 27.36 7.31243 27.408C7.42443 27.448 7.55043 27.456 7.66843 27.492C7.76843 27.52 7.86843 27.552 7.96843 27.57C8.01443 27.578 8.08242 27.56 8.10842 27.584C8.18442 27.66 8.28842 27.616 8.37442 27.658C8.45842 27.698 8.57442 27.714 8.68242 27.706C8.70242 27.704 8.73242 27.7 8.74242 27.71C8.82241 27.79 8.94641 27.71 9.02241 27.792C9.20241 27.808 9.38241 27.816 9.55841 27.868C9.6724 27.902 9.7984 27.884 9.9184 27.912C10.0644 27.946 10.2224 27.936 10.3744 27.952C10.4744 27.96 10.5724 27.956 10.6704 27.958C10.6704 27.99 10.6884 28.002 10.7204 28H12.8804C12.9124 28 12.9304 27.99 12.9304 27.958C13.1704 27.97 13.4064 27.914 13.6444 27.922H13.7764C13.8084 27.924 13.8264 27.912 13.8244 27.878C13.9318 27.8718 14.0387 27.8584 14.1443 27.838C14.3123 27.804 14.4883 27.812 14.6563 27.758C14.7403 27.73 14.8363 27.734 14.9263 27.712C15.0303 27.688 15.1403 27.66 15.2543 27.668C15.2663 27.668 15.2863 27.668 15.2923 27.662C15.3483 27.588 15.4423 27.622 15.5163 27.588C15.5983 27.5528 15.6873 27.5371 15.7763 27.542C15.7883 27.542 15.8043 27.542 15.8163 27.536C15.8949 27.4909 15.9821 27.4629 16.0723 27.454C16.1933 27.4362 16.312 27.4053 16.4263 27.362C16.5115 27.3311 16.5991 27.3077 16.6883 27.292C16.7083 27.288 16.7303 27.288 16.7403 27.276C16.7903 27.224 16.8643 27.222 16.9203 27.206C17.0363 27.176 17.1463 27.132 17.2603 27.098C17.2983 27.088 17.3423 27.1 17.3743 27.078C17.4625 27.0159 17.5637 26.9748 17.6703 26.958C17.6883 26.956 17.7043 26.954 17.7203 26.942C17.7723 26.91 17.8203 26.872 17.8863 26.864C17.9783 26.854 18.0663 26.808 18.1463 26.768C18.2143 26.734 18.2903 26.708 18.3603 26.672C18.4143 26.644 18.4723 26.61 18.5383 26.598C18.6323 26.582 18.6943 26.5 18.7903 26.48C18.8624 26.4622 18.9312 26.4332 18.9943 26.394C19.0963 26.336 19.2023 26.288 19.3063 26.238C19.3723 26.204 19.4483 26.176 19.5023 26.136C19.584 26.0795 19.671 26.0313 19.7623 25.992C19.8783 25.94 19.9803 25.866 20.0963 25.816C20.1963 25.77 20.2863 25.696 20.3863 25.64C20.4363 25.612 20.4823 25.568 20.5303 25.544C20.585 25.5152 20.6384 25.4838 20.6903 25.4501C20.7583 25.4041 20.8383 25.376 20.8963 25.3181C20.9483 25.2661 21.0183 25.2481 21.0723 25.2001C21.1363 25.1461 21.2223 25.1201 21.2823 25.0601C21.3023 25.0401 21.3143 25.0201 21.3423 25.0201C21.3577 25.0183 21.3725 25.0129 21.3854 25.0042C21.3983 24.9955 21.4089 24.9838 21.4163 24.9701C21.4352 24.9396 21.4632 24.9158 21.4963 24.9021C21.5903 24.8681 21.6403 24.7781 21.7283 24.7341C21.7823 24.7081 21.8283 24.6581 21.8783 24.6221C21.9643 24.5621 22.0463 24.4981 22.1283 24.4341C22.1742 24.3981 22.2142 24.3361 22.2602 24.3221C22.3602 24.2901 22.3902 24.1821 22.4842 24.1421C22.5164 24.1259 22.5455 24.1042 22.5702 24.0781C22.6422 23.9981 22.7302 23.9341 22.8102 23.8561C22.8602 23.8041 22.9282 23.7801 22.9762 23.7241C23.0329 23.6551 23.0958 23.5915 23.1642 23.5341C23.2242 23.4861 23.2802 23.4301 23.3322 23.3741L23.6322 23.0761C23.7322 22.9801 23.8262 22.8821 23.9262 22.7881C23.9856 22.7308 24.0392 22.6678 24.0862 22.6001C24.1377 22.5292 24.1982 22.4653 24.2662 22.4101C24.3182 22.3681 24.3342 22.3041 24.3822 22.2601C24.4537 22.2018 24.5152 22.1322 24.5642 22.0541C24.6182 21.9621 24.7102 21.9041 24.7602 21.8101C24.7962 21.7421 24.8662 21.6981 24.9082 21.6301C24.9502 21.5581 25.0082 21.4941 25.0622 21.4301C25.1222 21.3581 25.1902 21.2821 25.2302 21.2021C25.2722 21.1161 25.3482 21.0621 25.3902 20.9761C25.434 20.8972 25.4856 20.8228 25.5442 20.7541C25.5842 20.7041 25.6082 20.6481 25.6422 20.5961C25.6942 20.5161 25.7502 20.4381 25.8062 20.3601C25.8282 20.3261 25.8322 20.2901 25.8622 20.2561C25.9162 20.2001 25.9762 20.1321 25.9622 20.0401" fill="#3370FF"></path><path d="M29.9604 13.2262C29.9484 13.2122 29.9364 13.2122 29.9204 13.2082C29.8764 13.1942 29.8264 13.1842 29.7864 13.1602C29.7424 13.129 29.6955 13.1022 29.6464 13.0802C29.5724 13.0502 29.4864 13.0402 29.4244 12.9962C29.3384 12.9302 29.2304 12.9322 29.1384 12.8842C29.0733 12.8489 29.0031 12.8239 28.9304 12.8102C28.8744 12.8002 28.8164 12.7742 28.7624 12.7582C28.6884 12.7342 28.6104 12.7082 28.5344 12.6882C28.415 12.659 28.2969 12.625 28.1804 12.5862C28.1002 12.555 28.0144 12.5407 27.9284 12.5442C27.9084 12.4622 27.8424 12.5102 27.7964 12.5002C27.7364 12.5002 27.6804 12.4702 27.6244 12.4602C27.4424 12.4282 27.2564 12.4222 27.0724 12.3802C26.9264 12.3482 26.7684 12.3662 26.6164 12.3442C26.5264 12.3322 26.4364 12.3402 26.3444 12.3382C26.3444 12.3022 26.3264 12.2942 26.2944 12.2942H25.4164C25.3844 12.2942 25.3664 12.3042 25.3664 12.3382C25.1424 12.3262 24.9224 12.3762 24.6984 12.3742H24.5664C24.5344 12.3722 24.5204 12.3862 24.5184 12.4162C24.3904 12.4042 24.2704 12.4602 24.1424 12.4522C24.1347 12.452 24.127 12.4541 24.1204 12.4582C24.0224 12.5262 23.9024 12.5022 23.7964 12.5382C23.7124 12.5662 23.6104 12.5622 23.5304 12.5922C23.4664 12.6142 23.3944 12.6322 23.3304 12.6582C23.2518 12.6931 23.1664 12.7102 23.0804 12.7082C23.0824 12.7242 23.0864 12.7442 23.0644 12.7462C23.0144 12.7502 22.9684 12.7762 22.9244 12.7862C22.7924 12.8202 22.6684 12.8702 22.5404 12.9142C22.4284 12.9542 22.3244 13.0142 22.2144 13.0402C22.0884 13.0702 22.0004 13.1702 21.8685 13.1862C21.8275 13.1887 21.788 13.2026 21.7545 13.2262C21.7184 13.2578 21.6771 13.2828 21.6325 13.3002C21.5617 13.3236 21.4944 13.3566 21.4325 13.3982C21.3405 13.4582 21.2405 13.4982 21.1525 13.5582C21.1185 13.5822 21.0625 13.5722 21.0465 13.5982C20.9825 13.7102 20.8505 13.7122 20.7605 13.7822C20.6645 13.8562 20.5505 13.9122 20.4545 13.9842C20.3745 14.0442 20.2905 14.1002 20.2145 14.1642C20.1145 14.2502 20.0065 14.3282 19.9005 14.4042C19.8445 14.4442 19.8105 14.5182 19.7525 14.5362C19.6605 14.5682 19.6125 14.6442 19.5525 14.7002C19.4925 14.7602 19.4245 14.8222 19.3645 14.8862C19.2725 14.9802 19.1745 15.0682 19.0785 15.1602C19.0065 15.2282 18.9445 15.3142 18.8645 15.3662C18.7445 15.4461 18.6565 15.5521 18.5565 15.6461C18.4565 15.7401 18.3565 15.8381 18.2605 15.9361C18.1485 16.0501 18.0245 16.1521 17.9185 16.2701C17.8265 16.3741 17.7205 16.4641 17.6225 16.5601C17.5225 16.6581 17.4285 16.7621 17.3225 16.8561C17.2196 16.9505 17.1209 17.0493 17.0265 17.1521C16.9505 17.2321 16.8705 17.3101 16.7905 17.3861C16.7105 17.4621 16.6425 17.5521 16.5425 17.6061C16.5325 17.6541 16.4925 17.6741 16.4565 17.6981C16.3525 17.7641 16.2705 17.8541 16.1805 17.9381C16.1205 17.9921 16.0725 18.0641 16.0045 18.1021C15.8925 18.1621 15.8125 18.2621 15.7125 18.3341C15.5925 18.4221 15.4685 18.5121 15.3625 18.6181C15.3105 18.6681 15.2305 18.6761 15.1965 18.7421C15.1685 18.7981 15.0965 18.7861 15.0625 18.8301C14.9925 18.9241 14.8785 18.9621 14.7945 19.0381C14.7445 19.0841 14.6745 19.1221 14.6145 19.1581C14.5765 19.1781 14.5345 19.1921 14.5025 19.2221C14.4241 19.2923 14.3375 19.3528 14.2445 19.4021C14.2045 19.4261 14.1505 19.4421 14.1205 19.4761C14.0645 19.5361 13.9866 19.5641 13.9226 19.6161C13.8589 19.6695 13.7874 19.7126 13.7106 19.7441C13.6106 19.7821 13.5346 19.8521 13.4426 19.8981C13.3186 19.9581 13.2026 20.0321 13.0806 20.0921C13.0486 20.1081 12.9946 20.1181 12.9766 20.1621C12.9766 20.1901 12.9886 20.1981 13.0126 20.2121C13.0666 20.2441 13.1266 20.2521 13.1806 20.2741C13.2686 20.3141 13.3526 20.3641 13.4406 20.4001C13.5246 20.4341 13.5946 20.4921 13.6946 20.5001C13.74 20.5084 13.7822 20.5292 13.8166 20.5601C13.8766 20.6121 13.9526 20.6321 14.0166 20.6561C14.0725 20.6761 14.1265 20.7121 14.1905 20.7241C14.2305 20.7321 14.2845 20.7301 14.3165 20.7541C14.3725 20.7981 14.4365 20.8221 14.4965 20.8581C14.5365 20.8821 14.5905 20.8501 14.6145 20.8861C14.6485 20.9361 14.7105 20.9441 14.7485 20.9581C14.8625 20.9981 14.9685 21.0441 15.0805 21.0901C15.1765 21.1301 15.2745 21.1581 15.3685 21.2101C15.4465 21.2521 15.5505 21.2541 15.6405 21.2921C15.6745 21.3081 15.6925 21.3401 15.7305 21.3441C15.8171 21.3495 15.9013 21.3748 15.9765 21.4181C16.0005 21.4341 16.0265 21.4621 16.0565 21.4681C16.1445 21.4861 16.2305 21.5081 16.3165 21.5441C16.3965 21.5761 16.4805 21.6121 16.5645 21.6241C16.6105 21.6301 16.6205 21.6761 16.6645 21.6761C16.7425 21.6761 16.8045 21.7261 16.8785 21.7421C16.9785 21.7661 17.0765 21.8021 17.1745 21.8321C17.1965 21.8381 17.2345 21.8281 17.2445 21.8401C17.3045 21.9201 17.4045 21.8801 17.4845 21.9201C17.5705 21.9641 17.6845 21.9841 17.7845 22.0181C17.8745 22.0501 17.9645 22.0841 18.0605 22.0881C18.0765 22.0881 18.0905 22.0921 18.1045 22.1021C18.1685 22.1421 18.2425 22.1641 18.3165 22.1821C18.3516 22.1893 18.387 22.1953 18.4225 22.2001C18.4865 22.2101 18.5385 22.2541 18.6005 22.2581C18.6925 22.2621 18.7705 22.3181 18.8665 22.3221C18.9025 22.3241 18.9625 22.3181 18.9925 22.3481C19.0545 22.4101 19.1425 22.4061 19.2125 22.4241C19.3645 22.4641 19.5265 22.4541 19.6825 22.5061C19.7725 22.5381 19.8745 22.5261 19.9745 22.5501C20.1345 22.5861 20.3085 22.5741 20.4785 22.5841C20.7925 22.6041 21.1085 22.5961 21.4205 22.5601C21.5005 22.5501 21.5745 22.5461 21.6525 22.5261C21.7639 22.4974 21.8777 22.4787 21.9924 22.4701C22.0904 22.4621 22.1804 22.4201 22.2804 22.4301C22.2875 22.43 22.2945 22.4279 22.3004 22.4241C22.3864 22.3701 22.4864 22.3701 22.5764 22.3401C22.6404 22.3201 22.7164 22.3221 22.7704 22.2901C22.8265 22.2561 22.8881 22.2324 22.9524 22.2201C23.0524 22.2041 23.1224 22.1201 23.2244 22.1281C23.2284 22.1281 23.2324 22.1221 23.2364 22.1201C23.3044 22.0681 23.3884 22.0401 23.4644 22.0141C23.5471 21.9857 23.6279 21.9523 23.7064 21.9141C23.8104 21.8621 23.9104 21.7941 24.0124 21.7341C24.0424 21.7161 24.0864 21.7421 24.1084 21.6941C24.1244 21.6541 24.1624 21.6341 24.2084 21.6241C24.2604 21.6101 24.3204 21.5901 24.3424 21.5301C24.3524 21.5041 24.3724 21.5021 24.3924 21.5041C24.4061 21.5045 24.4197 21.5011 24.4317 21.4944C24.4436 21.4878 24.4536 21.478 24.4604 21.4661C24.5244 21.3701 24.6344 21.3261 24.7224 21.2621C24.8144 21.1981 24.8864 21.1121 24.9824 21.0541C25.0964 20.9881 25.1784 20.8821 25.2704 20.7901C25.3484 20.7101 25.4224 20.6281 25.5044 20.5561C25.5684 20.5001 25.5984 20.4241 25.6624 20.3681C25.7064 20.3281 25.7764 20.2881 25.7944 20.2281C25.8224 20.1341 25.8984 20.0961 25.9624 20.0381C25.9854 19.9894 26.0189 19.9464 26.0604 19.9121L26.0844 19.8741C26.1184 19.8541 26.1004 19.8041 26.1364 19.7821C26.2004 19.7401 26.2244 19.6621 26.2524 19.6021C26.2964 19.5101 26.3504 19.4201 26.4024 19.3341C26.4584 19.2401 26.4924 19.1361 26.5624 19.0481C26.6144 18.9801 26.6484 18.8901 26.6864 18.8101C26.7544 18.6701 26.8244 18.5321 26.8984 18.3961C26.9424 18.3161 26.9844 18.2321 27.0224 18.1481C27.0604 18.0601 27.1104 17.9781 27.1504 17.8941C27.1904 17.8061 27.2464 17.7261 27.2784 17.6401C27.3184 17.5341 27.3784 17.4441 27.4244 17.3421C27.4384 17.3061 27.4344 17.2621 27.4604 17.2361C27.5118 17.1799 27.5501 17.113 27.5724 17.0401C27.6124 16.9341 27.7024 16.8521 27.7124 16.7341L27.7204 16.7301C27.7604 16.7001 27.7744 16.6501 27.7964 16.6081C27.8324 16.5421 27.8484 16.4641 27.8924 16.4041C27.9604 16.3081 28.0004 16.2001 28.0524 16.0981C28.0864 16.0341 28.1124 15.9621 28.1484 15.9041C28.2084 15.8101 28.2484 15.7041 28.3044 15.6101C28.3444 15.5435 28.3779 15.4732 28.4044 15.4002C28.4224 15.3522 28.4564 15.3042 28.4864 15.2602C28.5404 15.1762 28.5784 15.0802 28.6484 15.0062C28.6784 14.9742 28.6764 14.9302 28.7124 14.8942C28.7724 14.8342 28.8044 14.7542 28.8524 14.6842C28.8884 14.6322 28.9124 14.5682 28.9544 14.5282C29.0344 14.4522 29.0944 14.3582 29.1484 14.2722C29.2024 14.1862 29.2724 14.1082 29.3344 14.0342C29.4364 13.9102 29.5464 13.7882 29.6584 13.6682C29.7599 13.5603 29.8612 13.4523 29.9623 13.3442C30.0223 13.2822 30.0063 13.2682 29.9623 13.2242" fill="#133C9A"></path></svg>
);

// GitHub 图标 SVG 组件
const GithubIcon = ({ className }: { className?: string }) => (
    <svg
        className={className}
        viewBox="0 0 24 24"
        fill="currentColor"
        width="16"
        height="16"
    >
        <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z" />
    </svg>
);

const itemKeys = [
    { key: "explore", url: "/", icon: Compass, requireAuth: false },
    { key: "recommend", url: "/recommend", icon: ThumbsUp, requireAuth: false },
    { key: "private", url: "/private", icon: GitFork, requireAuth: true },
    { key: "subscribe", url: "/subscribe", icon: Star, requireAuth: true },
    { key: "bookmarks", url: "/bookmarks", icon: Bookmark, requireAuth: true },
    { key: "organizations", url: "/organizations", icon: Building2, requireAuth: false },
    { key: "apps", url: "/apps", icon: AppWindow, requireAuth: true },
];

interface AppSidebarProps extends React.ComponentProps<typeof Sidebar> {
    activeItem?: string;
    onItemClick?: (title: string) => void;
}

export function AppSidebar({ activeItem, onItemClick, ...props }: AppSidebarProps) {
    const t = useTranslations();
    const router = useRouter();
    const { isAuthenticated } = useAuth();
    const [showFeishuQr, setShowFeishuQr] = useState(false);

    const items = itemKeys.map(item => ({
        title: t(`sidebar.${item.key}`),
        url: item.url,
        icon: item.icon,
        requireAuth: item.requireAuth,
    }));

    const handleItemClick = (item: typeof items[0]) => {
        if (item.requireAuth && !isAuthenticated) {
            router.push("/auth");
            return;
        }
        onItemClick?.(item.title);
    };

    return (
        <Sidebar collapsible="icon" {...props}>
            <SidebarContent>
                <SidebarGroup>
                    <SidebarGroupLabel>
                        <Image
                            src="/favicon.png"
                            alt="OpenDeepWiki"
                            width={24}
                            height={24}
                            className="shrink-0 rounded"
                        />
                        <span className="ml-2">OpenDeepWiki</span>
                    </SidebarGroupLabel>
                    <SidebarGroupContent>
                        <SidebarMenu>
                            {items.map((item) => (
                                <SidebarMenuItem key={item.title}>
                                    <SidebarMenuButton
                                        asChild
                                        tooltip={item.title}
                                        isActive={activeItem === item.title}
                                        onClick={(e) => {
                                            if (item.requireAuth && !isAuthenticated) {
                                                e.preventDefault();
                                                handleItemClick(item);
                                            } else {
                                                onItemClick?.(item.title);
                                            }
                                        }}
                                    >
                                        <Link href={item.requireAuth && !isAuthenticated ? "#" : item.url}>
                                            <item.icon />
                                            <span>{item.title}</span>
                                        </Link>
                                    </SidebarMenuButton>
                                </SidebarMenuItem>
                            ))}
                        </SidebarMenu>
                    </SidebarGroupContent>
                </SidebarGroup>
            </SidebarContent>
            <SidebarFooter>
                <SidebarMenu>
                    <SidebarMenuItem>
                        <SidebarMenuButton asChild tooltip={t("sidebar.github")}>
                            <Link href="https://github.com/AIDotNet/OpenDeepWiki" target="_blank">
                                <GithubIcon />
                                <span>{t("sidebar.github")}</span>
                            </Link>
                        </SidebarMenuButton>
                    </SidebarMenuItem>
                    <SidebarMenuItem>
                        <div 
                            className="relative"
                            onMouseEnter={() => setShowFeishuQr(true)}
                            onMouseLeave={() => setShowFeishuQr(false)}
                        >
                            <SidebarMenuButton asChild tooltip={t("sidebar.feishu")}>
                                <Link href="https://www.feishu.cn" target="_blank">
                                    <FeishuIcon />
                                    <span>{t("sidebar.feishu")}</span>
                                </Link>
                            </SidebarMenuButton>
                            {/* 悬浮弹窗显示二维码 */}
                            {showFeishuQr && (
                                <div className="absolute left-full bottom-0 ml-2 z-50">
                                    <div className="bg-popover border rounded-lg shadow-lg p-6 min-w-[350px]">
                                        <Image
                                            src="/fieshu.png"
                                            alt={t("sidebar.feishu")}
                                            width={320}
                                            height={320}
                                            className="rounded block w-full h-auto"
                                        />
                                        <p className="text-sm text-center mt-3 text-muted-foreground whitespace-nowrap">
                                            {t("sidebar.scanQrCode")}
                                        </p>
                                    </div>
                                </div>
                            )}
                        </div>
                    </SidebarMenuItem>
                </SidebarMenu>
            </SidebarFooter>
            <SidebarRail />
        </Sidebar>
    );
}