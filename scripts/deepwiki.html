<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/4cf2300e9c8272f7-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/_next/static/media/93f479601ee12b01-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/de70bee13400563f.css?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/0df64a618dd79f27.css?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-5400bf868d87f903.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK"/><script src="/_next/static/chunks/87c73c54-dd8d81ac9604067c.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK" async=""></script><script src="/_next/static/chunks/18-b4dc409d6ec27396.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK" async=""></script><script src="/_next/static/chunks/main-app-57aa1716f0d0f500.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK" async=""></script><script src="/_next/static/chunks/b1298b8d-5cac6cd7c8e952ff.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK" async=""></script><script src="/_next/static/chunks/378e5a93-860e027c5a5e0c0d.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK" async=""></script><script src="/_next/static/chunks/f7f68e2d-d8bf979db5ff4e9d.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK" async=""></script><script src="/_next/static/chunks/7963-b29c27a8b53c3f2a.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK" async=""></script><script src="/_next/static/chunks/1265-fa8a95d3842768f5.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK" async=""></script><script src="/_next/static/chunks/9885-b57089f03806c3b8.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK" async=""></script><script src="/_next/static/chunks/659-ee9e1e775e30dcef.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK" async=""></script><script src="/_next/static/chunks/app/layout-0537c2076823e553.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK" async=""></script><script src="/_next/static/chunks/7bf36345-1ac10ec2f0e0c88f.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK" async=""></script><script src="/_next/static/chunks/c16f53c3-b390b6f98a69dcec.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK" async=""></script><script src="/_next/static/chunks/6212-505c2fc95d1a35ae.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK" async=""></script><script src="/_next/static/chunks/4336-624d5ae6f4cc1cc7.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK" async=""></script><script src="/_next/static/chunks/8461-369a9f0c48ea2626.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK" async=""></script><script src="/_next/static/chunks/7198-985a49f2b6072d25.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK" async=""></script><script src="/_next/static/chunks/5462-08221e91030fd747.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK" async=""></script><script src="/_next/static/chunks/4429-943205658cbafffe.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK" async=""></script><script src="/_next/static/chunks/9976-9250854d58eefaa3.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK" async=""></script><script src="/_next/static/chunks/1481-25d5bbc4f2d9524a.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK" async=""></script><script src="/_next/static/chunks/app/%5Borg%5D/%5Brepo%5D/%5B%5B...wikiRoutes%5D%5D/page-6651f8cd8321a0db.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK" async=""></script><script src="/_next/static/chunks/25-9f305b682cea7558.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK" async=""></script><script src="/_next/static/chunks/7391-247f6ef4f530f4c6.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK" async=""></script><script src="/_next/static/chunks/6373-d56a493968555802.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK" async=""></script><script src="/_next/static/chunks/6375-7e0e75eb09fc9abe.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK" async=""></script><script src="/_next/static/chunks/9437-00f165dda9ad3a42.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK" async=""></script><script src="/_next/static/chunks/app/%5Borg%5D/%5Brepo%5D/layout-cecfb9eee640deb0.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK" async=""></script><meta name="next-size-adjust" content=""/><title>microsoft/vscode | DeepWiki</title><meta name="description" content="This document provides a high-level overview of VS Code&#x27;s architecture, including its execution contexts, multi-process architecture, major subsystems, and codebase organization. It serves as an entry"/><meta name="keywords" content="microsoft/vscode,microsoft,vscode,documentation,wiki,codebase,AI documentation,Devin,Overview"/><link rel="canonical" href="https://deepwiki.com/microsoft/vscode"/><meta property="og:title" content="microsoft/vscode | DeepWiki"/><meta property="og:description" content="This document provides a high-level overview of VS Code&#x27;s architecture, including its execution contexts, multi-process architecture, major subsystems, and codebase organization. It serves as an entry"/><meta property="og:url" content="https://deepwiki.com/microsoft/vscode"/><meta property="og:site_name" content="DeepWiki"/><meta property="og:image" content="https://deepwiki.com/microsoft/vscode/og-image.png?page=1"/><meta property="og:type" content="website"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@cognition"/><meta name="twitter:creator" content="@cognition"/><meta name="twitter:title" content="microsoft/vscode | DeepWiki"/><meta name="twitter:description" content="This document provides a high-level overview of VS Code&#x27;s architecture, including its execution contexts, multi-process architecture, major subsystems, and codebase organization. It serves as an entry"/><meta name="twitter:image" content="https://deepwiki.com/microsoft/vscode/og-image.png?page=1"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="48x48"/><link rel="icon" href="/icon.png?1ee4c6a68a73a205" type="image/png" sizes="48x48"/><link rel="apple-touch-icon" href="/apple-icon.png?a4f658907db0ab87" type="image/png" sizes="180x180"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK" noModule=""></script></head><body class="__variable_188709 font-geist-sans relative min-h-screen __variable_9a8899 bg-background antialiased"><div hidden=""><!--$--><!--/$--></div><section aria-label="Notifications alt+T" tabindex="-1" aria-live="polite" aria-relevant="additions text" aria-atomic="false"></section><script>((a,b,c,d,e,f,g,h)=>{let i=document.documentElement,j=["light","dark"];function k(b){var c;(Array.isArray(a)?a:[a]).forEach(a=>{let c="class"===a,d=c&&f?e.map(a=>f[a]||a):e;c?(i.classList.remove(...d),i.classList.add(f&&f[b]?f[b]:b)):i.setAttribute(a,b)}),c=b,h&&j.includes(c)&&(i.style.colorScheme=c)}if(d)k(d);else try{let a=localStorage.getItem(b)||c,d=g&&"system"===a?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":a;k(d)}catch(a){}})("class","theme","light",null,["light","dark"],null,true,true)</script><!--$?--><template id="B:0"></template><div class="flex min-h-screen w-full flex-col text-white"><div class="container-wrapper flex flex-1 items-center justify-center px-4"><div class="inline-block bg-clip-text text-[#b5b5b5a4] animate-shine text-center text-lg" style="background-image:linear-gradient(120deg, rgba(255, 255, 255, 0) 40%, rgba(255, 255, 255, 0.8) 50%, rgba(255, 255, 255, 0) 60%);background-size:200% 100%;-webkit-background-clip:text;animation-duration:1s">Loading...</div></div></div><!--/$--><script>requestAnimationFrame(function(){$RT=performance.now()});</script><script src="/_next/static/chunks/webpack-5400bf868d87f903.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK" id="_R_" async=""></script><div hidden id="S:0"><div class="flex min-h-screen w-full flex-col text-white" id="codebase-wiki-repo-page"><div class="bg-background border-b-border sticky top-0 z-30 border-b border-dashed"><div class="font-geist-mono relative flex h-8 items-center justify-center text-xs font-medium sm:hidden"><div class="powered-by-devin-gradient absolute inset-0 z-[-1] h-8 w-full"></div><button class="flex items-center gap-2"><svg class="size-3 [&amp;_path]:stroke-0 [&amp;_path]:animate-[custom-pulse_1.8s_infinite_var(--delay,0s)]" xmlns="http://www.w3.org/2000/svg" viewBox="110 110 460 500"><path style="fill:#21c19a" class="[--delay:0.6s]" d="M418.73,332.37c9.84-5.68,22.07-5.68,31.91,0l25.49,14.71c.82.48,1.69.8,2.58,1.06.19.06.37.11.55.16.87.21,1.76.34,2.65.35.04,0,.08.02.13.02.1,0,.19-.03.29-.04.83-.02,1.64-.13,2.45-.32.14-.03.28-.05.42-.09.87-.24,1.7-.59,2.5-1.03.08-.04.17-.06.25-.1l50.97-29.43c3.65-2.11,5.9-6.01,5.9-10.22v-58.86c0-4.22-2.25-8.11-5.9-10.22l-50.97-29.43c-3.65-2.11-8.15-2.11-11.81,0l-50.97,29.43c-.08.04-.13.11-.2.16-.78.48-1.51,1.02-2.15,1.66-.1.1-.18.21-.28.31-.57.6-1.08,1.26-1.51,1.97-.07.12-.15.22-.22.34-.44.77-.77,1.6-1.03,2.47-.05.19-.1.37-.14.56-.22.89-.37,1.81-.37,2.76v29.43c0,11.36-6.11,21.95-15.95,27.63-9.84,5.68-22.06,5.68-31.91,0l-25.49-14.71c-.82-.48-1.69-.8-2.57-1.06-.19-.06-.37-.11-.56-.16-.88-.21-1.76-.34-2.65-.34-.13,0-.26.02-.4.02-.84.02-1.66.13-2.47.32-.13.03-.27.05-.4.09-.87.24-1.71.6-2.51,1.04-.08.04-.16.06-.24.1l-50.97,29.43c-3.65,2.11-5.9,6.01-5.9,10.22v58.86c0,4.22,2.25,8.11,5.9,10.22l50.97,29.43c.08.04.17.06.24.1.8.44,1.64.79,2.5,1.03.14.04.28.06.42.09.81.19,1.62.3,2.45.32.1,0,.19.04.29.04.04,0,.08-.02.13-.02.89,0,1.77-.13,2.65-.35.19-.04.37-.1.56-.16.88-.26,1.75-.59,2.58-1.06l25.49-14.71c9.84-5.68,22.06-5.68,31.91,0,9.84,5.68,15.95,16.27,15.95,27.63v29.43c0,.95.15,1.87.37,2.76.05.19.09.37.14.56.25.86.59,1.69,1.03,2.47.07.12.15.22.22.34.43.71.94,1.37,1.51,1.97.1.1.18.21.28.31.65.63,1.37,1.18,2.15,1.66.07.04.13.11.2.16l50.97,29.43c1.83,1.05,3.86,1.58,5.9,1.58s4.08-.53,5.9-1.58l50.97-29.43c3.65-2.11,5.9-6.01,5.9-10.22v-58.86c0-4.22-2.25-8.11-5.9-10.22l-50.97-29.43c-.08-.04-.16-.06-.24-.1-.8-.44-1.64-.8-2.51-1.04-.13-.04-.26-.05-.39-.09-.82-.2-1.65-.31-2.49-.33-.13,0-.25-.02-.38-.02-.89,0-1.78.13-2.66.35-.18.04-.36.1-.54.15-.88.26-1.75.59-2.58,1.07l-25.49,14.72c-9.84,5.68-22.07,5.68-31.9,0-9.84-5.68-15.95-16.27-15.95-27.63s6.11-21.95,15.95-27.63Z"></path><path style="fill:#3969ca" d="M141.09,317.65l50.97,29.43c1.83,1.05,3.86,1.58,5.9,1.58s4.08-.53,5.9-1.58l50.97-29.43c.08-.04.13-.11.2-.16.78-.48,1.51-1.02,2.15-1.66.1-.1.18-.21.28-.31.57-.6,1.08-1.26,1.51-1.97.07-.12.15-.22.22-.34.44-.77.77-1.6,1.03-2.47.05-.19.1-.37.14-.56.22-.89.37-1.81.37-2.76v-29.43c0-11.36,6.11-21.95,15.96-27.63s22.06-5.68,31.91,0l25.49,14.71c.82.48,1.69.8,2.57,1.06.19.06.37.11.56.16.87.21,1.76.34,2.64.35.04,0,.09.02.13.02.1,0,.19-.04.29-.04.83-.02,1.65-.13,2.45-.32.14-.03.28-.05.41-.09.87-.24,1.71-.6,2.51-1.04.08-.04.16-.06.24-.1l50.97-29.43c3.65-2.11,5.9-6.01,5.9-10.22v-58.86c0-4.22-2.25-8.11-5.9-10.22l-50.97-29.43c-3.65-2.11-8.15-2.11-11.81,0l-50.97,29.43c-.08.04-.13.11-.2.16-.78.48-1.51,1.02-2.15,1.66-.1.1-.18.21-.28.31-.57.6-1.08,1.26-1.51,1.97-.07.12-.15.22-.22.34-.44.77-.77,1.6-1.03,2.47-.05.19-.1.37-.14.56-.22.89-.37,1.81-.37,2.76v29.43c0,11.36-6.11,21.95-15.95,27.63-9.84,5.68-22.07,5.68-31.91,0l-25.49-14.71c-.82-.48-1.69-.8-2.58-1.06-.19-.06-.37-.11-.55-.16-.88-.21-1.76-.34-2.65-.35-.13,0-.26.02-.4.02-.83.02-1.66.13-2.47.32-.13.03-.27.05-.4.09-.87.24-1.71.6-2.51,1.04-.08.04-.16.06-.24.1l-50.97,29.43c-3.65,2.11-5.9,6.01-5.9,10.22v58.86c0,4.22,2.25,8.11,5.9,10.22Z"></path><path style="fill:#0294de" class="[--delay:1.2s]" d="M396.88,484.35l-50.97-29.43c-.08-.04-.17-.06-.24-.1-.8-.44-1.64-.79-2.51-1.03-.14-.04-.27-.06-.41-.09-.81-.19-1.64-.3-2.47-.32-.13,0-.26-.02-.39-.02-.89,0-1.78.13-2.66.35-.18.04-.36.1-.54.15-.88.26-1.76.59-2.58,1.07l-25.49,14.72c-9.84,5.68-22.06,5.68-31.9,0-9.84-5.68-15.96-16.27-15.96-27.63v-29.43c0-.95-.15-1.87-.37-2.76-.05-.19-.09-.37-.14-.56-.25-.86-.59-1.69-1.03-2.47-.07-.12-.15-.22-.22-.34-.43-.71-.94-1.37-1.51-1.97-.1-.1-.18-.21-.28-.31-.65-.63-1.37-1.18-2.15-1.66-.07-.04-.13-.11-.2-.16l-50.97-29.43c-3.65-2.11-8.15-2.11-11.81,0l-50.97,29.43c-3.65,2.11-5.9,6.01-5.9,10.22v58.86c0,4.22,2.25,8.11,5.9,10.22l50.97,29.43c.08.04.17.06.25.1.8.44,1.63.79,2.5,1.03.14.04.29.06.43.09.8.19,1.61.3,2.43.32.1,0,.2.04.3.04.04,0,.09-.02.13-.02.88,0,1.77-.13,2.64-.34.19-.04.37-.1.56-.16.88-.26,1.75-.59,2.57-1.06l25.49-14.71c9.84-5.68,22.06-5.68,31.91,0,9.84,5.68,15.95,16.27,15.95,27.63v29.43c0,.95.15,1.87.37,2.76.05.19.09.37.14.56.25.86.59,1.69,1.03,2.47.07.12.15.22.22.34.43.71.94,1.37,1.51,1.97.1.1.18.21.28.31.65.63,1.37,1.18,2.15,1.66.07.04.13.11.2.16l50.97,29.43c1.83,1.05,3.86,1.58,5.9,1.58s4.08-.53,5.9-1.58l50.97-29.43c3.65-2.11,5.9-6.01,5.9-10.22v-58.86c0-4.22-2.25-8.11-5.9-10.22Z"></path></svg>Index your code with Devin</button></div><div class="container-wrapper"><div class="container mx-auto flex w-full flex-row items-center gap-2 py-4 md:py-6"><a class="flex items-center gap-3" href="/"><span class="text-base font-medium leading-none md:text-lg hidden sm:block">DeepWiki</span></a><div class="flex-1"><div class="flex flex-row items-center gap-2"><a class="block text-xs font-medium leading-none text-white sm:hidden md:text-lg" href="/">DeepWiki</a><p class="text-sm font-normal leading-none md:text-lg"><a href="https://github.com/microsoft/vscode" target="_blank" rel="noopener noreferrer" title="Open repository" class="text-muted-foreground hover:text-muted-foreground/80 group inline-flex items-center gap-1 transition-colors">microsoft/vscode<!-- --> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256" class="opacity-0 transition-opacity group-hover:opacity-100"><path d="M224,104a8,8,0,0,1-16,0V59.32l-66.33,66.34a8,8,0,0,1-11.32-11.32L196.68,48H152a8,8,0,0,1,0-16h64a8,8,0,0,1,8,8Zm-40,24a8,8,0,0,0-8,8v72H48V80h72a8,8,0,0,0,0-16H48A16,16,0,0,0,32,80V208a16,16,0,0,0,16,16H176a16,16,0,0,0,16-16V136A8,8,0,0,0,184,128Z"></path></svg></a></p></div></div><div class="flex items-center gap-4"><button class="group hidden items-center gap-1.5 md:flex"><div class="relative"><span class="text-foreground/70 group-hover:text-foreground text-xs font-light transition-colors">Index your code with</span><div class="bg-foreground/30 absolute bottom-0 left-0 h-[1px] w-0 transition-all duration-300 group-hover:w-full"></div></div><div class="flex items-center gap-1 transition-transform duration-300 group-hover:translate-x-0.5"><svg class="size-4 transform transition-transform duration-700 group-hover:rotate-180 [&amp;_path]:stroke-0" xmlns="http://www.w3.org/2000/svg" viewBox="110 110 460 500"><path style="fill:#21c19a" class="" d="M418.73,332.37c9.84-5.68,22.07-5.68,31.91,0l25.49,14.71c.82.48,1.69.8,2.58,1.06.19.06.37.11.55.16.87.21,1.76.34,2.65.35.04,0,.08.02.13.02.1,0,.19-.03.29-.04.83-.02,1.64-.13,2.45-.32.14-.03.28-.05.42-.09.87-.24,1.7-.59,2.5-1.03.08-.04.17-.06.25-.1l50.97-29.43c3.65-2.11,5.9-6.01,5.9-10.22v-58.86c0-4.22-2.25-8.11-5.9-10.22l-50.97-29.43c-3.65-2.11-8.15-2.11-11.81,0l-50.97,29.43c-.08.04-.13.11-.2.16-.78.48-1.51,1.02-2.15,1.66-.1.1-.18.21-.28.31-.57.6-1.08,1.26-1.51,1.97-.07.12-.15.22-.22.34-.44.77-.77,1.6-1.03,2.47-.05.19-.1.37-.14.56-.22.89-.37,1.81-.37,2.76v29.43c0,11.36-6.11,21.95-15.95,27.63-9.84,5.68-22.06,5.68-31.91,0l-25.49-14.71c-.82-.48-1.69-.8-2.57-1.06-.19-.06-.37-.11-.56-.16-.88-.21-1.76-.34-2.65-.34-.13,0-.26.02-.4.02-.84.02-1.66.13-2.47.32-.13.03-.27.05-.4.09-.87.24-1.71.6-2.51,1.04-.08.04-.16.06-.24.1l-50.97,29.43c-3.65,2.11-5.9,6.01-5.9,10.22v58.86c0,4.22,2.25,8.11,5.9,10.22l50.97,29.43c.08.04.17.06.24.1.8.44,1.64.79,2.5,1.03.14.04.28.06.42.09.81.19,1.62.3,2.45.32.1,0,.19.04.29.04.04,0,.08-.02.13-.02.89,0,1.77-.13,2.65-.35.19-.04.37-.1.56-.16.88-.26,1.75-.59,2.58-1.06l25.49-14.71c9.84-5.68,22.06-5.68,31.91,0,9.84,5.68,15.95,16.27,15.95,27.63v29.43c0,.95.15,1.87.37,2.76.05.19.09.37.14.56.25.86.59,1.69,1.03,2.47.07.12.15.22.22.34.43.71.94,1.37,1.51,1.97.1.1.18.21.28.31.65.63,1.37,1.18,2.15,1.66.07.04.13.11.2.16l50.97,29.43c1.83,1.05,3.86,1.58,5.9,1.58s4.08-.53,5.9-1.58l50.97-29.43c3.65-2.11,5.9-6.01,5.9-10.22v-58.86c0-4.22-2.25-8.11-5.9-10.22l-50.97-29.43c-.08-.04-.16-.06-.24-.1-.8-.44-1.64-.8-2.51-1.04-.13-.04-.26-.05-.39-.09-.82-.2-1.65-.31-2.49-.33-.13,0-.25-.02-.38-.02-.89,0-1.78.13-2.66.35-.18.04-.36.1-.54.15-.88.26-1.75.59-2.58,1.07l-25.49,14.72c-9.84,5.68-22.07,5.68-31.9,0-9.84-5.68-15.95-16.27-15.95-27.63s6.11-21.95,15.95-27.63Z"></path><path style="fill:#3969ca" d="M141.09,317.65l50.97,29.43c1.83,1.05,3.86,1.58,5.9,1.58s4.08-.53,5.9-1.58l50.97-29.43c.08-.04.13-.11.2-.16.78-.48,1.51-1.02,2.15-1.66.1-.1.18-.21.28-.31.57-.6,1.08-1.26,1.51-1.97.07-.12.15-.22.22-.34.44-.77.77-1.6,1.03-2.47.05-.19.1-.37.14-.56.22-.89.37-1.81.37-2.76v-29.43c0-11.36,6.11-21.95,15.96-27.63s22.06-5.68,31.91,0l25.49,14.71c.82.48,1.69.8,2.57,1.06.19.06.37.11.56.16.87.21,1.76.34,2.64.35.04,0,.09.02.13.02.1,0,.19-.04.29-.04.83-.02,1.65-.13,2.45-.32.14-.03.28-.05.41-.09.87-.24,1.71-.6,2.51-1.04.08-.04.16-.06.24-.1l50.97-29.43c3.65-2.11,5.9-6.01,5.9-10.22v-58.86c0-4.22-2.25-8.11-5.9-10.22l-50.97-29.43c-3.65-2.11-8.15-2.11-11.81,0l-50.97,29.43c-.08.04-.13.11-.2.16-.78.48-1.51,1.02-2.15,1.66-.1.1-.18.21-.28.31-.57.6-1.08,1.26-1.51,1.97-.07.12-.15.22-.22.34-.44.77-.77,1.6-1.03,2.47-.05.19-.1.37-.14.56-.22.89-.37,1.81-.37,2.76v29.43c0,11.36-6.11,21.95-15.95,27.63-9.84,5.68-22.07,5.68-31.91,0l-25.49-14.71c-.82-.48-1.69-.8-2.58-1.06-.19-.06-.37-.11-.55-.16-.88-.21-1.76-.34-2.65-.35-.13,0-.26.02-.4.02-.83.02-1.66.13-2.47.32-.13.03-.27.05-.4.09-.87.24-1.71.6-2.51,1.04-.08.04-.16.06-.24.1l-50.97,29.43c-3.65,2.11-5.9,6.01-5.9,10.22v58.86c0,4.22,2.25,8.11,5.9,10.22Z"></path><path style="fill:#0294de" class="" d="M396.88,484.35l-50.97-29.43c-.08-.04-.17-.06-.24-.1-.8-.44-1.64-.79-2.51-1.03-.14-.04-.27-.06-.41-.09-.81-.19-1.64-.3-2.47-.32-.13,0-.26-.02-.39-.02-.89,0-1.78.13-2.66.35-.18.04-.36.1-.54.15-.88.26-1.76.59-2.58,1.07l-25.49,14.72c-9.84,5.68-22.06,5.68-31.9,0-9.84-5.68-15.96-16.27-15.96-27.63v-29.43c0-.95-.15-1.87-.37-2.76-.05-.19-.09-.37-.14-.56-.25-.86-.59-1.69-1.03-2.47-.07-.12-.15-.22-.22-.34-.43-.71-.94-1.37-1.51-1.97-.1-.1-.18-.21-.28-.31-.65-.63-1.37-1.18-2.15-1.66-.07-.04-.13-.11-.2-.16l-50.97-29.43c-3.65-2.11-8.15-2.11-11.81,0l-50.97,29.43c-3.65,2.11-5.9,6.01-5.9,10.22v58.86c0,4.22,2.25,8.11,5.9,10.22l50.97,29.43c.08.04.17.06.25.1.8.44,1.63.79,2.5,1.03.14.04.29.06.43.09.8.19,1.61.3,2.43.32.1,0,.2.04.3.04.04,0,.09-.02.13-.02.88,0,1.77-.13,2.64-.34.19-.04.37-.1.56-.16.88-.26,1.75-.59,2.57-1.06l25.49-14.71c9.84-5.68,22.06-5.68,31.91,0,9.84,5.68,15.95,16.27,15.95,27.63v29.43c0,.95.15,1.87.37,2.76.05.19.09.37.14.56.25.86.59,1.69,1.03,2.47.07.12.15.22.22.34.43.71.94,1.37,1.51,1.97.1.1.18.21.28.31.65.63,1.37,1.18,2.15,1.66.07.04.13.11.2.16l50.97,29.43c1.83,1.05,3.86,1.58,5.9,1.58s4.08-.53,5.9-1.58l50.97-29.43c3.65-2.11,5.9-6.01,5.9-10.22v-58.86c0-4.22-2.25-8.11-5.9-10.22Z"></path></svg><span class="text-sm font-medium">Devin</span></div></button><button aria-label="Edit Wiki" class="flex items-center rounded-md cursor-pointer transition-all border border-border bg-surface hover:border-border-hover hover:bg-component disabled:cursor-default disabled:opacity-50 disabled:hover:border-border disabled:hover:bg-surface gap-2 px-3 py-1.5 text-sm"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 256 256"><path d="M227.32,73.37,182.63,28.69a16,16,0,0,0-22.63,0L36.69,152A15.86,15.86,0,0,0,32,163.31V208a16,16,0,0,0,16,16H216a8,8,0,0,0,0-16H115.32l112-112A16,16,0,0,0,227.32,73.37ZM92.69,208H48V163.31l88-88L180.69,120ZM192,108.69,147.32,64l24-24L216,84.69Z"></path></svg>Edit Wiki</button><button class="flex items-center rounded-md !text-white cursor-pointer transition-all border bg-blue-500 hover:bg-blue-600 border-blue-500 hover:border-blue-600 dark:bg-blue-900 dark:hover:bg-blue-800 dark:border-blue-900 dark:hover:border-blue-800 disabled:cursor-default disabled:opacity-50 disabled:hover:bg-blue-500 disabled:hover:border-blue-500 dark:disabled:hover:bg-blue-900 dark:disabled:hover:border-blue-900 gap-1.5 px-3 py-1.5 text-sm" aria-label="Share" data-state="closed" data-slot="tooltip-trigger"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4"><circle cx="18" cy="5" r="3"></circle><circle cx="6" cy="12" r="3"></circle><circle cx="18" cy="19" r="3"></circle><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line></svg><span>Share</span></button><div class="h-8 w-8"></div></div></div></div></div><!--$?--><template id="B:1"></template><div class="container-wrapper flex flex-1 items-center justify-center px-4"><div class="inline-block bg-clip-text text-[#b5b5b5a4] animate-shine text-center text-lg" style="background-image:linear-gradient(120deg, rgba(255, 255, 255, 0) 40%, rgba(255, 255, 255, 0.8) 50%, rgba(255, 255, 255, 0) 60%);background-size:200% 100%;-webkit-background-clip:text;animation-duration:1s">Loading...</div></div><!--/$--></div></div><script>$RB=[];$RV=function(a){$RT=performance.now();for(var b=0;b<a.length;b+=2){var c=a[b],e=a[b+1];null!==e.parentNode&&e.parentNode.removeChild(e);var f=c.parentNode;if(f){var g=c.previousSibling,h=0;do{if(c&&8===c.nodeType){var d=c.data;if("/$"===d||"/&"===d)if(0===h)break;else h--;else"$"!==d&&"$?"!==d&&"$~"!==d&&"$!"!==d&&"&"!==d||h++}d=c.nextSibling;f.removeChild(c);c=d}while(c);for(;e.firstChild;)f.insertBefore(e.firstChild,c);g.data="$";g._reactRetry&&requestAnimationFrame(g._reactRetry)}}a.length=0};
$RC=function(a,b){if(b=document.getElementById(b))(a=document.getElementById(a))?(a.previousSibling.data="$~",$RB.push(a,b),2===$RB.length&&("number"!==typeof $RT?requestAnimationFrame($RV.bind(null,$RB)):(a=performance.now(),setTimeout($RV.bind(null,$RB),2300>a&&2E3<a?2300-a:$RT+300-a)))):b.parentNode.removeChild(b)};$RC("B:0","S:0")</script><div hidden id="S:1"><script type="application/ld+json">{"@context":"https://schema.org","@type":"TechArticle","headline":"Overview","description":"This document provides a high-level overview of VS Code's architecture, including its execution contexts, multi-process architecture, major subsystems, and codebase organization. It serves as an entry","image":"https://deepwiki.com/microsoft/vscode/og-image.png","datePublished":"2026-01-16T13:57:41.049714","dateModified":"2026-01-16T13:57:41.049714","author":{"@type":"Organization","name":"DeepWiki","url":"https://deepwiki.com"},"publisher":{"@type":"Organization","name":"DeepWiki","logo":{"@type":"ImageObject","url":"https://deepwiki.com/icon.png"}},"mainEntityOfPage":{"@type":"WebPage","@id":"https://deepwiki.com/microsoft/vscode"}}</script><div class="w-full flex-1"><div class="container-wrapper relative mx-auto h-full px-0"><div class="container relative mx-auto flex h-full w-full flex-col gap-0 max-md:!px-0 md:flex-row md:gap-6 lg:gap-10"><div class="border-r-border hidden max-h-screen border-r border-dashed py-6 pr-4 transition-[border-radius] md:sticky md:left-0 md:top-20 md:block md:h-[calc(100vh-82px)] md:w-64 md:flex-shrink-0 md:overflow-y-auto lg:py-9 xl:w-72"><div class="flex h-full w-full max-w-full flex-shrink-0 flex-col overflow-hidden" style="scrollbar-color:var(--color-border) transparent"><div class="flex-shrink-0 px-2"><div class="text-secondary pb-1 text-xs">Last indexed: <!-- -->16 January 2026<!-- --> (<a href="https://github.com/microsoft/vscode/commits/c9c76f12" target="_blank" rel="noopener noreferrer" class="underline-offset-2 hover:underline">c9c76f</a>)</div></div><ul class="flex-1 flex-shrink-0 space-y-1 overflow-y-auto py-1" style="scrollbar-width:none"><li style="padding-left:0"><a data-selected="true" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/1-overview">Overview</a></li><li style="padding-left:0"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/2-build-system-and-development">Build System and Development</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/2.1-package-structure-and-dependencies">Package Structure and Dependencies</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/2.2-native-modules-and-cross-platform-builds">Native Modules and Cross-Platform Builds</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/2.3-build-tasks-and-scripts">Build Tasks and Scripts</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/2.4-code-quality-and-linting">Code Quality and Linting</a></li><li style="padding-left:0"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/3-application-lifecycle-and-bootstrap">Application Lifecycle and Bootstrap</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/3.1-entry-points-and-execution-modes">Entry Points and Execution Modes</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/3.2-electron-main-process-startup">Electron Main Process Startup</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/3.3-multi-process-architecture">Multi-Process Architecture</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/3.4-web-workbench-bootstrap">Web Workbench Bootstrap</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/3.5-service-initialization-and-dependency-injection">Service Initialization and Dependency Injection</a></li><li style="padding-left:0"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/4-workbench-architecture">Workbench Architecture</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/4.1-layout-system-and-parts">Layout System and Parts</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/4.2-editor-service-and-groups">Editor Service and Groups</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/4.3-editor-input-and-pane-system">Editor Input and Pane System</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/4.4-view-system-and-contributions">View System and Contributions</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/4.5-context-keys-and-state-management">Context Keys and State Management</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/4.6-drag-and-drop-system">Drag and Drop System</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/4.7-multi-window-support">Multi-Window Support</a></li><li style="padding-left:0"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/5-extension-system">Extension System</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/5.1-extension-host-architecture-and-rpc-protocol">Extension Host Architecture and RPC Protocol</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/5.2-extension-api-implementation">Extension API Implementation</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/5.3-language-features-provider-system">Language Features Provider System</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/5.4-extension-management-and-marketplace">Extension Management and Marketplace</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/5.5-extension-management-ui">Extension Management UI</a></li><li style="padding-left:0"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/6-integrated-terminal">Integrated Terminal</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/6.1-terminal-architecture-overview">Terminal Architecture Overview</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/6.2-terminal-instance-and-process-management">Terminal Instance and Process Management</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/6.3-xterm.js-integration-and-rendering">XTerm.js Integration and Rendering</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/6.4-pty-host-and-multi-server-support">Pty Host and Multi-Server Support</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/6.5-shell-integration-and-capabilities">Shell Integration and Capabilities</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/6.6-terminal-ui-and-layout">Terminal UI and Layout</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/6.7-terminal-extension-api">Terminal Extension API</a></li><li style="padding-left:0"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/7-chat-and-ai-integration">Chat and AI Integration</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/7.1-chat-system-architecture">Chat System Architecture</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/7.2-chat-agents-and-participants">Chat Agents and Participants</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/7.3-chat-request-and-response-flow">Chat Request and Response Flow</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/7.4-chat-ui-components">Chat UI Components</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/7.5-chat-modes-and-sessions">Chat Modes and Sessions</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/7.6-chat-extension-api">Chat Extension API</a></li><li style="padding-left:0"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/8-notebooks">Notebooks</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/8.1-notebook-architecture-overview">Notebook Architecture Overview</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/8.2-notebook-editor-and-cell-management">Notebook Editor and Cell Management</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/8.3-notebook-data-model">Notebook Data Model</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/8.4-cell-outputs-and-webview-rendering">Cell Outputs and WebView Rendering</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/8.5-notebook-extension-api">Notebook Extension API</a></li><li style="padding-left:0"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/9-source-control-management">Source Control Management</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/9.1-scm-framework-architecture">SCM Framework Architecture</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/9.2-scm-provider-system">SCM Provider System</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/9.3-scm-views-and-ui-components">SCM Views and UI Components</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/9.4-scm-history-provider">SCM History Provider</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/9.5-scm-extension-api">SCM Extension API</a></li><li style="padding-left:0"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/10-git-extension">Git Extension</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/10.1-git-extension-architecture">Git Extension Architecture</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/10.2-repository-and-operation-management">Repository and Operation Management</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/10.3-git-commands-and-actions">Git Commands and Actions</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/10.4-git-history-provider">Git History Provider</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/10.5-git-ipc-and-helper-processes">Git IPC and Helper Processes</a></li><li style="padding-left:0"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/11-settings-and-preferences">Settings and Preferences</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/11.1-settings-editor-architecture">Settings Editor Architecture</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/11.2-settings-tree-model-and-rendering">Settings Tree Model and Rendering</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/11.3-keybindings-editor">Keybindings Editor</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/microsoft/vscode/11.4-preferences-service-and-search">Preferences Service and Search</a></li></ul></div></div><div class="flex h-full flex-1 flex-col overflow-hidden"><div class="bg-background border-b-border sticky top-0 z-10 border-b border-dashed md:hidden"><div class="flex cursor-pointer items-center gap-2 p-3"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256" class="transition-transform"><path d="M184.49,136.49l-80,80a12,12,0,0,1-17-17L159,128,87.51,56.49a12,12,0,1,1,17-17l80,80A12,12,0,0,1,184.49,136.49Z"></path></svg><span class="truncate text-base font-normal">Menu</span></div></div><div class="relative flex-1 overflow-y-auto px-3 pt-3 md:rounded-md md:px-0 md:pt-0 [&amp;_::selection]:bg-purple-500/40" style="scrollbar-color:var(--color-night) transparent"><div class="pb-30 mx-auto max-w-2xl md:pb-40 md:pt-6 lg:pt-8"><div class="prose prose-invert dark:prose-invert prose-headings:text-inherit prose-p:text-inherit max-w-none"><div><div class="prose-custom prose-custom-md prose-custom-gray !max-w-none text-neutral-300 [overflow-wrap:anywhere]"><h1 id="overview" class="group" data-header="true">Overview<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h1>
<details>
<summary>Relevant source files</summary>
<ul>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/.npmrc" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>.npmrc</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/.nvmrc" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>.nvmrc</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/build/.moduleignore" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>build/.moduleignore</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/build/.webignore" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>build/.webignore</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/build/azure-pipelines/linux/setup-env.sh" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>build/azure-pipelines/linux/setup-env.sh</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/build/azure-pipelines/linux/verify-glibc-requirements.sh" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>build/azure-pipelines/linux/verify-glibc-requirements.sh</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/build/checksums/electron.txt" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>build/checksums/electron.txt</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/build/checksums/nodejs.txt" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>build/checksums/nodejs.txt</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/build/darwin/create-universal-app.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>build/darwin/create-universal-app.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/build/gulpfile.vscode.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>build/gulpfile.vscode.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/build/lib/i18n.resources.json" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>build/lib/i18n.resources.json</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/build/linux/dependencies-generator.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>build/linux/dependencies-generator.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/build/npm/postinstall.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>build/npm/postinstall.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/build/package.json" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>build/package.json</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/cgmanifest.json" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>cgmanifest.json</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/cli/src/bin/code/legacy_args.rs" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>cli/src/bin/code/legacy_args.rs</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/eslint.config.js" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>eslint.config.js</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/extensions/esbuild-webview-common.mjs" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>extensions/esbuild-webview-common.mjs</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/extensions/package-lock.json" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>extensions/package-lock.json</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/extensions/package.json" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>extensions/package.json</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/extensions/vscode-api-tests/package.json" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>extensions/vscode-api-tests/package.json</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/extensions/vscode-api-tests/src/singlefolder-tests/chat.test.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>extensions/vscode-api-tests/src/singlefolder-tests/chat.test.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/package-lock.json" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>package-lock.json</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/package.json" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>package.json</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/remote/.npmrc" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>remote/.npmrc</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/remote/package-lock.json" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>remote/package-lock.json</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/remote/package.json" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>remote/package.json</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/remote/web/package-lock.json" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>remote/web/package-lock.json</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/remote/web/package.json" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>remote/web/package.json</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/resources/completions/bash/code" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>resources/completions/bash/code</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/resources/completions/zsh/_code" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>resources/completions/zsh/_code</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/base/node/terminalEncoding.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/base/node/terminalEncoding.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/base/parts/contextmenu/electron-main/contextmenu.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/base/parts/contextmenu/electron-main/contextmenu.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/code/browser/workbench/workbench-dev.html" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/code/browser/workbench/workbench-dev.html</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/code/browser/workbench/workbench.html" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/code/browser/workbench/workbench.html</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/code/browser/workbench/workbench.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/code/browser/workbench/workbench.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/code/electron-main/app.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/code/electron-main/app.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/code/electron-main/main.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/code/electron-main/main.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/code/node/cli.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/code/node/cli.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/code/node/cliProcessMain.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/code/node/cliProcessMain.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/editor/browser/config/charWidthReader.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/editor/browser/config/charWidthReader.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/editor/browser/editorBrowser.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/editor/browser/editorBrowser.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/editor/browser/viewParts/minimap/minimap.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/editor/browser/viewParts/minimap/minimap.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/editor/browser/viewParts/minimap/minimapCharRenderer.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/editor/browser/viewParts/minimap/minimapCharRenderer.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/editor/browser/viewParts/minimap/minimapCharRendererFactory.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/editor/browser/viewParts/minimap/minimapCharRendererFactory.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/editor/browser/viewParts/minimap/minimapCharSheet.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/editor/browser/viewParts/minimap/minimapCharSheet.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/editor/browser/viewParts/minimap/minimapPreBaked.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/editor/browser/viewParts/minimap/minimapPreBaked.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/editor/browser/widget/codeEditor/codeEditorWidget.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/editor/browser/widget/codeEditor/codeEditorWidget.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/editor/common/config/editorOptions.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/editor/common/config/editorOptions.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/editor/common/config/fontInfo.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/editor/common/config/fontInfo.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/editor/common/editorCommon.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/editor/common/editorCommon.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/editor/common/languages.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/editor/common/languages.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/editor/common/standalone/standaloneEnums.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/editor/common/standalone/standaloneEnums.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/editor/common/textModelEvents.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/editor/common/textModelEvents.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/editor/common/viewModel/minimapTokensColorTracker.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/editor/common/viewModel/minimapTokensColorTracker.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/editor/test/browser/view/minimapCharRenderer.test.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/editor/test/browser/view/minimapCharRenderer.test.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/monaco.d.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/monaco.d.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/platform/editor/common/editor.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/platform/editor/common/editor.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/platform/environment/common/argv.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/platform/environment/common/argv.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/platform/environment/common/environment.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/platform/environment/common/environment.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/platform/environment/common/environmentService.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/platform/environment/common/environmentService.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/platform/environment/electron-main/environmentMainService.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/platform/environment/electron-main/environmentMainService.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/platform/environment/node/argv.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/platform/environment/node/argv.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/platform/environment/node/argvHelper.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/platform/environment/node/argvHelper.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/platform/environment/node/environmentService.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/platform/environment/node/environmentService.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/platform/environment/node/stdin.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/platform/environment/node/stdin.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/platform/environment/test/node/nativeModules.integrationTest.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/platform/environment/test/node/nativeModules.integrationTest.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/platform/extensionManagement/common/extensionManagementCLI.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/platform/extensionManagement/common/extensionManagementCLI.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/platform/extensions/common/extensionsApiProposals.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/platform/extensions/common/extensionsApiProposals.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/server/node/remoteExtensionHostAgentCli.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/server/node/remoteExtensionHostAgentCli.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/server/node/server.cli.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/server/node/server.cli.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/server/node/serverEnvironmentService.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/server/node/serverEnvironmentService.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/server/node/serverServices.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/server/node/serverServices.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/api/browser/extensionHost.contribution.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/api/browser/extensionHost.contribution.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/api/browser/mainThreadLanguageFeatures.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/api/browser/mainThreadLanguageFeatures.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/api/common/extHost.api.impl.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/api/common/extHost.api.impl.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/api/common/extHost.protocol.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/api/common/extHost.protocol.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/api/common/extHostLanguageFeatures.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/api/common/extHostLanguageFeatures.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/api/common/extHostTypeConverters.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/api/common/extHostTypeConverters.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/api/common/extHostTypes.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/api/common/extHostTypes.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/browser/actions/layoutActions.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/browser/actions/layoutActions.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/browser/contextkeys.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/browser/contextkeys.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/browser/dnd.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/browser/dnd.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/browser/layout.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/browser/layout.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/browser/parts/auxiliarybar/auxiliaryBarActions.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/browser/parts/auxiliarybar/auxiliaryBarActions.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/browser/parts/editor/editor.contribution.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/browser/parts/editor/editor.contribution.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/browser/parts/editor/editor.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/browser/parts/editor/editor.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/browser/parts/editor/editorActions.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/browser/parts/editor/editorActions.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/browser/parts/editor/editorCommands.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/browser/parts/editor/editorCommands.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/browser/parts/editor/editorDropTarget.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/browser/parts/editor/editorDropTarget.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/browser/parts/editor/editorGroupView.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/browser/parts/editor/editorGroupView.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/browser/parts/editor/editorPart.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/browser/parts/editor/editorPart.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/browser/parts/panel/panelActions.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/browser/parts/panel/panelActions.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/browser/parts/titlebar/titlebarActions.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/browser/parts/titlebar/titlebarActions.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/browser/web.api.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/browser/web.api.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/browser/web.factory.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/browser/web.factory.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/browser/web.main.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/browser/web.main.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/browser/workbench.contribution.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/browser/workbench.contribution.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/browser/workbench.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/browser/workbench.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/common/contextkeys.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/common/contextkeys.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/common/editor.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/common/editor.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/electron-browser/desktop.main.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/electron-browser/desktop.main.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/services/editor/browser/editorService.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/services/editor/browser/editorService.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/services/editor/common/editorGroupsService.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/services/editor/common/editorGroupsService.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/services/editor/common/editorService.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/services/editor/common/editorService.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/services/editor/test/browser/editorGroupsService.test.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/services/editor/test/browser/editorGroupsService.test.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/services/editor/test/browser/editorService.test.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/services/editor/test/browser/editorService.test.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/services/environment/browser/environmentService.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/services/environment/browser/environmentService.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/services/environment/common/environmentService.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/services/environment/common/environmentService.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/services/environment/electron-browser/environmentService.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/services/environment/electron-browser/environmentService.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/services/extensions/electron-browser/nativeExtensionService.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/services/extensions/electron-browser/nativeExtensionService.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/services/layout/browser/layoutService.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/services/layout/browser/layoutService.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/test/browser/workbenchTestServices.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/test/browser/workbenchTestServices.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/workbench.common.main.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/workbench.common.main.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/workbench.desktop.main.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/workbench.desktop.main.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/workbench.web.main.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/workbench.web.main.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vscode-dts/vscode.d.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vscode-dts/vscode.d.ts</span></a></li>
<li><a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vscode-dts/vscode.proposed.inlineCompletionsAdditions.d.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vscode-dts/vscode.proposed.inlineCompletionsAdditions.d.ts</span></a></li>
</ul>
</details>
<p>This document provides a high-level overview of VS Code&#x27;s architecture, including its execution contexts, multi-process architecture, major subsystems, and codebase organization. It serves as an entry point for understanding how the different parts of VS Code fit together.</p>
<p>For information about specific subsystems, see:</p>
<ul>
<li>Build system and development workflow: <a href="/microsoft/vscode/2-build-system-and-development" class="text-neutral-300 hover:text-neutral-200 hover:underline">Build System and Development</a></li>
<li>Application startup and initialization: <a href="/microsoft/vscode/3-application-lifecycle-and-bootstrap" class="text-neutral-300 hover:text-neutral-200 hover:underline">Application Lifecycle and Bootstrap</a></li>
<li>UI layout and editor system: <a href="/microsoft/vscode/4-workbench-architecture" class="text-neutral-300 hover:text-neutral-200 hover:underline">Workbench Architecture</a></li>
<li>Extension development and API: <a href="/microsoft/vscode/5-extension-system" class="text-neutral-300 hover:text-neutral-200 hover:underline">Extension System</a></li>
</ul>
<h2 id="execution-contexts" class="group" data-header="true">Execution Contexts<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h2>
<p>VS Code runs in three distinct execution contexts, each with its own entry point and runtime characteristics:</p>
<pre class="px-2 py-1.5 has-[code]:rounded-md has-[code]:!bg-[#e5e5e5] has-[div]:bg-transparent has-[div]:!p-0 has-[code]:text-stone-900 dark:has-[code]:!bg-[#242424] has-[code]:dark:text-white [&amp;_code]:block [&amp;_code]:border-none [&amp;_code]:bg-transparent [&amp;_code]:p-0"><!--$!--><template data-dgst="BAILOUT_TO_CLIENT_SIDE_RENDERING"></template><!--/$--></pre>
<p><strong>Sources:</strong> <a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/code/electron-main/main.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/code/electron-main/main.ts</span></a> <a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/browser/web.main.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/browser/web.main.ts</span></a> <a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/code/node/cliProcessMain.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/code/node/cliProcessMain.ts</span></a> <a href="https://github.com/microsoft/vscode/blob/c9c76f12/package.json#L9-L9" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4]"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>package.json</span><span class="flex flex-shrink-0 items-center rounded-r border-l px-2 py-1.5 border-[#dddddd] bg-[#d8d8d8] text-[#666666] dark:border-[#333333] dark:bg-[#2a2a2a] dark:text-[#888888]">9</span></a></p>
<h3 id="desktop-electron" class="group" data-header="true">Desktop (Electron)<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h3>
<p>The Electron-based desktop application is the primary execution context. It uses Chromium for rendering and Node.js for system integration. The entry point is <code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">CodeMain</code> which initializes the Electron app and creates the main process.</p>
<p><strong>Key characteristics:</strong></p>
<ul>
<li>Full file system access via Node.js</li>
<li>Native module support (node-pty, native-keymap, etc.)</li>
<li>Multi-process architecture for stability</li>
<li>OS integration (title bar, menus, notifications)</li>
</ul>
<h3 id="web-browser" class="group" data-header="true">Web (Browser)<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h3>
<p>The web version runs entirely in the browser without Node.js. It uses browser APIs and optional remote connections for file access and extension execution.</p>
<p><strong>Key characteristics:</strong></p>
<ul>
<li>No direct file system access (uses FileSystemAccess API or remote)</li>
<li>Limited to web-compatible extensions</li>
<li>Single-process architecture in the browser</li>
<li>Remote connection support for backend services</li>
</ul>
<h3 id="cli" class="group" data-header="true">CLI<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h3>
<p>The command-line interface provides headless operations like diffs, file manipulation, and extension management through a Node.js process.</p>
<p><strong>Sources:</strong> <a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/code/node/cliProcessMain.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/code/node/cliProcessMain.ts</span></a> <a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/platform/environment/node/argv.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/platform/environment/node/argv.ts</span></a></p>
<h2 id="multi-process-architecture-electron" class="group" data-header="true">Multi-Process Architecture (Electron)<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h2>
<p>The Electron desktop version uses a sophisticated multi-process architecture for isolation, stability, and security:</p>
<pre class="px-2 py-1.5 has-[code]:rounded-md has-[code]:!bg-[#e5e5e5] has-[div]:bg-transparent has-[div]:!p-0 has-[code]:text-stone-900 dark:has-[code]:!bg-[#242424] has-[code]:dark:text-white [&amp;_code]:block [&amp;_code]:border-none [&amp;_code]:bg-transparent [&amp;_code]:p-0"><!--$!--><template data-dgst="BAILOUT_TO_CLIENT_SIDE_RENDERING"></template><!--/$--></pre>
<p><strong>Sources:</strong> <a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/code/electron-main/app.ts#L1-L1000" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4]"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/code/electron-main/app.ts</span><span class="flex flex-shrink-0 items-center rounded-r border-l px-2 py-1.5 border-[#dddddd] bg-[#d8d8d8] text-[#666666] dark:border-[#333333] dark:bg-[#2a2a2a] dark:text-[#888888]">1-1000</span></a> <a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/browser/workbench.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/browser/workbench.ts</span></a> <a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/api/common/extHost.api.impl.ts#L132-L256" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4]"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/api/common/extHost.api.impl.ts</span><span class="flex flex-shrink-0 items-center rounded-r border-l px-2 py-1.5 border-[#dddddd] bg-[#d8d8d8] text-[#666666] dark:border-[#333333] dark:bg-[#2a2a2a] dark:text-[#888888]">132-256</span></a></p>
<h3 id="process-responsibilities" class="group" data-header="true">Process Responsibilities<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h3>









































<table><thead><tr><th>Process</th><th>Purpose</th><th>Key Classes</th><th>Crashes Affect</th></tr></thead><tbody><tr><td>Main Process</td><td>Window management, lifecycle, IPC server</td><td><code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">CodeApplication</code>, <code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">WindowsMainService</code></td><td>Entire application</td></tr><tr><td>Renderer Process</td><td>UI, user interactions, workbench</td><td><code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">Workbench</code>, <code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">Layout</code>, <code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">EditorService</code></td><td>Single window</td></tr><tr><td>Extension Host</td><td>Isolated extension execution</td><td><code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">ExtensionService</code>, API factory</td><td>Extensions only</td></tr><tr><td>Shared Process</td><td>Cross-window services</td><td>Extension management, telemetry</td><td>Background services</td></tr><tr><td>Pty Host</td><td>Terminal/shell processes</td><td><code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">PtyService</code></td><td>Terminals only</td></tr></tbody></table>
<p>The separation ensures that extension crashes, terminal failures, or shell hangs do not affect the main UI or other windows.</p>
<p><strong>Sources:</strong> <a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/code/electron-main/app.ts#L100-L500" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4]"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/code/electron-main/app.ts</span><span class="flex flex-shrink-0 items-center rounded-r border-l px-2 py-1.5 border-[#dddddd] bg-[#d8d8d8] text-[#666666] dark:border-[#333333] dark:bg-[#2a2a2a] dark:text-[#888888]">100-500</span></a> <a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/platform/terminal/node/ptyHostService.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/platform/terminal/node/ptyHostService.ts</span></a></p>
<h2 id="core-subsystems" class="group" data-header="true">Core Subsystems<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h2>
<p>VS Code is organized into major subsystems, each responsible for distinct functionality:</p>
<pre class="px-2 py-1.5 has-[code]:rounded-md has-[code]:!bg-[#e5e5e5] has-[div]:bg-transparent has-[div]:!p-0 has-[code]:text-stone-900 dark:has-[code]:!bg-[#242424] has-[code]:dark:text-white [&amp;_code]:block [&amp;_code]:border-none [&amp;_code]:bg-transparent [&amp;_code]:p-0"><!--$!--><template data-dgst="BAILOUT_TO_CLIENT_SIDE_RENDERING"></template><!--/$--></pre>
<p><strong>Sources:</strong> <a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/workbench.common.main.ts#L1-L200" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4]"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/workbench.common.main.ts</span><span class="flex flex-shrink-0 items-center rounded-r border-l px-2 py-1.5 border-[#dddddd] bg-[#d8d8d8] text-[#666666] dark:border-[#333333] dark:bg-[#2a2a2a] dark:text-[#888888]">1-200</span></a> <a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/browser/workbench.contribution.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/browser/workbench.contribution.ts</span></a></p>
<h3 id="subsystem-importance-rankings" class="group" data-header="true">Subsystem Importance Rankings<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h3>
<p>Based on code activity and architectural significance:</p>


















































<table><thead><tr><th>Subsystem</th><th>Importance Score</th><th>Primary Location</th></tr></thead><tbody><tr><td>Build &amp; Distribution</td><td>4811</td><td><code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">build/</code>, <code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">gulpfile.*.ts</code></td></tr><tr><td>Extension System</td><td>3055</td><td><code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">src/vs/workbench/api/</code></td></tr><tr><td>Terminal</td><td>2352</td><td><code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">src/vs/workbench/contrib/terminal/</code></td></tr><tr><td>Chat/AI</td><td>1852</td><td><code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">src/vs/workbench/contrib/chat/</code></td></tr><tr><td>Notebooks</td><td>1812</td><td><code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">src/vs/workbench/contrib/notebook/</code></td></tr><tr><td>Core Workbench</td><td>1085</td><td><code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">src/vs/workbench/browser/</code></td></tr><tr><td>SCM</td><td>840</td><td><code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">src/vs/workbench/contrib/scm/</code></td></tr><tr><td>Git Extension</td><td>1340</td><td><code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">extensions/git/</code></td></tr></tbody></table>
<p>These scores reflect both the complexity and frequency of changes in each subsystem.</p>
<p><strong>Sources:</strong> Analysis from provided cluster importance data</p>
<h2 id="codebase-organization" class="group" data-header="true">Codebase Organization<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h2>
<p>The VS Code codebase follows a hierarchical layering architecture:</p>
<pre class="px-2 py-1.5 has-[code]:rounded-md has-[code]:!bg-[#e5e5e5] has-[div]:bg-transparent has-[div]:!p-0 has-[code]:text-stone-900 dark:has-[code]:!bg-[#242424] has-[code]:dark:text-white [&amp;_code]:block [&amp;_code]:border-none [&amp;_code]:bg-transparent [&amp;_code]:p-0"><!--$!--><template data-dgst="BAILOUT_TO_CLIENT_SIDE_RENDERING"></template><!--/$--></pre>
<p><strong>Sources:</strong> <a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/base/" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/base/</span></a> <a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/platform/" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/platform/</span></a> <a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/editor/" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/editor/</span></a> <a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/</span></a></p>
<h3 id="directory-structure" class="group" data-header="true">Directory Structure<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h3>
<p><strong><code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">src/vs/base/</code></strong> - Foundation layer with no dependencies on other VS Code layers:</p>
<ul>
<li><code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">common/</code> - Pure TypeScript utilities (events, lifecycle, URIs, etc.)</li>
<li><code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">browser/</code> - Browser-specific code (DOM manipulation, browser APIs)</li>
<li><code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">node/</code> - Node.js-specific code (file system, process management)</li>
</ul>
<p><strong><code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">src/vs/platform/</code></strong> - Platform services with dependency injection:</p>
<ul>
<li>Each subdirectory represents a service abstraction (e.g., <code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">files/</code>, <code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">configuration/</code>, <code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">telemetry/</code>)</li>
<li>Defines <code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">I*Service</code> interfaces</li>
<li>Implementations separated by environment (<code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">common/</code>, <code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">browser/</code>, <code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">node/</code>, <code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">electron-main/</code>)</li>
</ul>
<p><strong><code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">src/vs/editor/</code></strong> - Monaco Editor implementation:</p>
<ul>
<li><code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">common/</code> - Core text editing logic</li>
<li><code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">browser/</code> - Editor rendering and UI</li>
<li>Self-contained, reusable outside VS Code</li>
</ul>
<p><strong><code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">src/vs/workbench/</code></strong> - VS Code workbench (the application shell):</p>
<ul>
<li><code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">common/</code> - Workbench abstractions and models</li>
<li><code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">browser/</code> - Workbench UI and layout</li>
<li><code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">services/</code> - Workbench-specific services</li>
<li><code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">contrib/</code> - Feature contributions (terminal, SCM, debug, etc.)</li>
<li><code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">api/</code> - Extension API implementation</li>
</ul>
<p><strong><code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">extensions/</code></strong> - Built-in extensions:</p>
<ul>
<li>Written using the same public API as third-party extensions</li>
<li>Examples: Git, Markdown, TypeScript, themes</li>
</ul>
<p><strong>Sources:</strong> <a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/workbench.common.main.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/workbench.common.main.ts</span></a> <a href="https://github.com/microsoft/vscode/blob/c9c76f12/build/package.json" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>build/package.json</span></a></p>
<h3 id="layering-enforcement" class="group" data-header="true">Layering Enforcement<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h3>
<p>VS Code enforces architectural layering through ESLint rules to prevent circular dependencies and maintain separation of concerns:</p>
<ul>
<li>Base cannot depend on Platform</li>
<li>Platform cannot depend on Editor or Workbench</li>
<li>Editor cannot depend on Workbench</li>
<li>Common code cannot depend on Browser or Node code</li>
</ul>
<p><strong>Sources:</strong> <a href="https://github.com/microsoft/vscode/blob/c9c76f12/package.json#L51-L51" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4]"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>package.json</span><span class="flex flex-shrink-0 items-center rounded-r border-l px-2 py-1.5 border-[#dddddd] bg-[#d8d8d8] text-[#666666] dark:border-[#333333] dark:bg-[#2a2a2a] dark:text-[#888888]">51</span></a> (<code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">valid-layers-check</code> script), <a href="https://github.com/microsoft/vscode/blob/c9c76f12/eslint.config.js" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>eslint.config.js</span></a></p>
<h2 id="dependency-injection" class="group" data-header="true">Dependency Injection<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h2>
<p>VS Code uses a sophisticated dependency injection system for service instantiation and lifecycle management:</p>
<pre class="px-2 py-1.5 has-[code]:rounded-md has-[code]:!bg-[#e5e5e5] has-[div]:bg-transparent has-[div]:!p-0 has-[code]:text-stone-900 dark:has-[code]:!bg-[#242424] has-[code]:dark:text-white [&amp;_code]:block [&amp;_code]:border-none [&amp;_code]:bg-transparent [&amp;_code]:p-0"><!--$!--><template data-dgst="BAILOUT_TO_CLIENT_SIDE_RENDERING"></template><!--/$--></pre>
<p><strong>Sources:</strong> <a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/platform/instantiation/" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/platform/instantiation/</span></a> <a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/browser/workbench.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/browser/workbench.ts</span></a></p>
<p>Services are registered by binding interfaces to implementations:</p>
<pre class="px-2 py-1.5 has-[code]:rounded-md has-[code]:!bg-[#e5e5e5] has-[div]:bg-transparent has-[div]:!p-0 has-[code]:text-stone-900 dark:has-[code]:!bg-[#242424] has-[code]:dark:text-white [&amp;_code]:block [&amp;_code]:border-none [&amp;_code]:bg-transparent [&amp;_code]:p-0"><div class="rounded-sm border border-[#8F8F8F]/30 p-2 text-xs font-normal leading-[15px]" style="background-color:transparent;min-height:2em"></div></pre>
<p>All services follow the naming convention <code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">I*Service</code> for interfaces, ensuring consistency across the codebase.</p>
<p><strong>Sources:</strong> <a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/platform/instantiation/common/instantiation.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/platform/instantiation/common/instantiation.ts</span></a> <a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/platform/instantiation/common/serviceCollection.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/platform/instantiation/common/serviceCollection.ts</span></a></p>
<h2 id="extension-system-architecture" class="group" data-header="true">Extension System Architecture<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h2>
<p>The Extension System is one of VS Code&#x27;s most critical subsystems (importance: 3055), enabling third-party extensibility while maintaining application stability:</p>
<pre class="px-2 py-1.5 has-[code]:rounded-md has-[code]:!bg-[#e5e5e5] has-[div]:bg-transparent has-[div]:!p-0 has-[code]:text-stone-900 dark:has-[code]:!bg-[#242424] has-[code]:dark:text-white [&amp;_code]:block [&amp;_code]:border-none [&amp;_code]:bg-transparent [&amp;_code]:p-0"><!--$!--><template data-dgst="BAILOUT_TO_CLIENT_SIDE_RENDERING"></template><!--/$--></pre>
<p><strong>Sources:</strong> <a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/api/common/extHost.api.impl.ts#L132-L256" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4]"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/api/common/extHost.api.impl.ts</span><span class="flex flex-shrink-0 items-center rounded-r border-l px-2 py-1.5 border-[#dddddd] bg-[#d8d8d8] text-[#666666] dark:border-[#333333] dark:bg-[#2a2a2a] dark:text-[#888888]">132-256</span></a> <a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/api/common/extHost.protocol.ts#L1-L200" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4]"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/api/common/extHost.protocol.ts</span><span class="flex flex-shrink-0 items-center rounded-r border-l px-2 py-1.5 border-[#dddddd] bg-[#d8d8d8] text-[#666666] dark:border-[#333333] dark:bg-[#2a2a2a] dark:text-[#888888]">1-200</span></a></p>
<p>Extensions run in an isolated Extension Host process and communicate with the main UI via RPC (Remote Procedure Call):</p>
<ol>
<li>Extensions call the <code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">vscode.*</code> API</li>
<li>API calls are converted to RPC messages via type converters</li>
<li>Messages cross the process boundary through IPC</li>
<li>MainThread implementations execute the calls using core services</li>
<li>Results are marshalled back to the Extension Host</li>
</ol>
<p>This architecture ensures that extension crashes or hangs do not affect the main workbench.</p>
<p>For detailed information about the extension system, see <a href="/microsoft/vscode/5-extension-system" class="text-neutral-300 hover:text-neutral-200 hover:underline">Extension System</a>.</p>
<p><strong>Sources:</strong> <a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/api/common/extHostLanguageFeatures.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/api/common/extHostLanguageFeatures.ts</span></a> <a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/api/browser/mainThreadLanguageFeatures.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/api/browser/mainThreadLanguageFeatures.ts</span></a></p>
<h2 id="entry-points" class="group" data-header="true">Entry Points<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h2>
<p>VS Code has different entry points depending on the execution context:</p>



































<table><thead><tr><th>Context</th><th>Entry Point File</th><th>Key Classes</th></tr></thead><tbody><tr><td>Electron Main</td><td><code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">src/vs/code/electron-main/main.ts</code></td><td><code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">CodeMain</code>, <code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">CodeApplication</code></td></tr><tr><td>Electron Renderer</td><td><code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">src/vs/workbench/electron-sandbox/desktop.main.ts</code></td><td><code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">DesktopMain</code></td></tr><tr><td>Web Workbench</td><td><code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">src/vs/workbench/browser/web.main.ts</code></td><td><code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">BrowserMain</code></td></tr><tr><td>CLI</td><td><code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">src/vs/code/node/cliProcessMain.ts</code></td><td><code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">CliMain</code></td></tr><tr><td>Shared Process</td><td><code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">src/vs/code/electron-sandbox/sharedProcess/sharedProcess.ts</code></td><td><code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">SharedProcessMain</code></td></tr></tbody></table>
<p>Each entry point bootstraps its own service container and initializes the appropriate subsystems for its execution context.</p>
<p><strong>Sources:</strong> <a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/code/electron-main/main.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/code/electron-main/main.ts</span></a> <a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/browser/web.main.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/browser/web.main.ts</span></a> <a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/code/node/cliProcessMain.ts" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/code/node/cliProcessMain.ts</span></a></p>
<h2 id="configuration-and-dependencies" class="group" data-header="true">Configuration and Dependencies<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h2>
<h3 id="package-structure" class="group" data-header="true">Package Structure<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h3>
<p>VS Code uses multiple <code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">package.json</code> files for different contexts:</p>



































<table><thead><tr><th>Package</th><th>Purpose</th><th>Location</th></tr></thead><tbody><tr><td>Root</td><td>Desktop application dependencies</td><td><code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">package.json</code></td></tr><tr><td>Remote</td><td>Server-side dependencies for remote development</td><td><code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">remote/package.json</code></td></tr><tr><td>Web</td><td>Browser-only dependencies</td><td><code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">remote/web/package.json</code></td></tr><tr><td>Build</td><td>Build tool dependencies</td><td><code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">build/package.json</code></td></tr><tr><td>Extensions</td><td>Shared extension dependencies</td><td><code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">extensions/package.json</code></td></tr></tbody></table>
<p><strong>Sources:</strong> <a href="https://github.com/microsoft/vscode/blob/c9c76f12/package.json#L1-L50" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4]"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>package.json</span><span class="flex flex-shrink-0 items-center rounded-r border-l px-2 py-1.5 border-[#dddddd] bg-[#d8d8d8] text-[#666666] dark:border-[#333333] dark:bg-[#2a2a2a] dark:text-[#888888]">1-50</span></a> <a href="https://github.com/microsoft/vscode/blob/c9c76f12/remote/package.json" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>remote/package.json</span></a> <a href="https://github.com/microsoft/vscode/blob/c9c76f12/build/package.json" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>build/package.json</span></a> <a href="https://github.com/microsoft/vscode/blob/c9c76f12/extensions/package.json" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>extensions/package.json</span></a></p>
<h3 id="key-dependencies" class="group" data-header="true">Key Dependencies<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h3>
<p><strong>Runtime dependencies:</strong></p>
<ul>
<li><code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">electron</code> (39.2.7) - Desktop application framework</li>
<li><code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">@xterm/xterm</code> - Terminal emulator</li>
<li><code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">vscode-textmate</code> - TextMate grammar engine</li>
<li><code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">vscode-oniguruma</code> - Regex engine for syntax highlighting</li>
<li>Native modules: <code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">node-pty</code>, <code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">native-keymap</code>, <code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">kerberos</code></li>
</ul>
<p><strong>Build dependencies:</strong></p>
<ul>
<li><code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">typescript</code> - Language and type checking</li>
<li><code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">gulp</code> - Build task automation</li>
<li><code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">esbuild</code> - Fast JavaScript bundling</li>
<li><code class="rounded-sm bg-[#e5e5e5] px-[0.25rem] py-[0.20rem] text-xs font-normal leading-[15px] before:hidden after:hidden dark:bg-[#484848]/30">electron-builder</code> - Application packaging</li>
</ul>
<p><strong>Sources:</strong> <a href="https://github.com/microsoft/vscode/blob/c9c76f12/package.json#L75-L122" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4]"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>package.json</span><span class="flex flex-shrink-0 items-center rounded-r border-l px-2 py-1.5 border-[#dddddd] bg-[#d8d8d8] text-[#666666] dark:border-[#333333] dark:bg-[#2a2a2a] dark:text-[#888888]">75-122</span></a> <a href="https://github.com/microsoft/vscode/blob/c9c76f12/package.json#L123-L226" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4]"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>package.json</span><span class="flex flex-shrink-0 items-center rounded-r border-l px-2 py-1.5 border-[#dddddd] bg-[#d8d8d8] text-[#666666] dark:border-[#333333] dark:bg-[#2a2a2a] dark:text-[#888888]">123-226</span></a></p>
<h2 id="summary" class="group" data-header="true">Summary<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h2>
<p>VS Code is a complex, multi-layered application that supports multiple execution contexts (Electron, Web, CLI) through careful architectural separation. The Electron version uses a multi-process architecture for stability, with distinct processes for the main window, extension execution, shared services, and terminal management.</p>
<p>The codebase is organized into strict layers (Base  Platform  Editor  Workbench) with enforced dependencies. A comprehensive dependency injection system manages service instantiation and lifecycle. The Extension System provides third-party extensibility through process isolation and RPC communication.</p>
<p>Key architectural principles include:</p>
<ul>
<li><strong>Process isolation</strong> - Crashes in one subsystem don&#x27;t affect others</li>
<li><strong>Layering</strong> - Clear separation between platform code, editor, and workbench</li>
<li><strong>Service abstraction</strong> - Dependencies injected through interfaces</li>
<li><strong>Multi-context support</strong> - Same codebase runs in desktop, web, and CLI</li>
</ul>
<p>For detailed information about specific subsystems, refer to their respective wiki pages in sections 2-11.</p>
<p><strong>Sources:</strong> <a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/</span></a> <a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/code/electron-main/" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/code/electron-main/</span></a> <a href="https://github.com/microsoft/vscode/blob/c9c76f12/package.json" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>package.json</span></a> <a href="https://github.com/microsoft/vscode/blob/c9c76f12/src/vs/workbench/api/" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>src/vs/workbench/api/</span></a></p></div></div></div></div></div></div><div class="hidden overflow-hidden transition-[border-radius] xl:sticky xl:right-0 xl:top-20 xl:block xl:h-[calc(100vh-82px)] xl:w-64 xl:flex-shrink-0 2xl:w-72" style="scrollbar-width:none"><div class="flex max-h-full w-full flex-shrink-0 flex-col py-6 pt-0 text-sm lg:pb-4 lg:pt-8 xl:w-64 2xl:w-72" style="scrollbar-color:var(--color-night) transparent"><div><div class="relative mx-4 my-4 rounded-md border border-neutral-200 bg-neutral-100 p-3 text-sm text-neutral-600 dark:border-neutral-800 dark:bg-neutral-900 dark:text-neutral-400"><button class="absolute right-2 top-2 rounded-sm p-1 opacity-70 transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-neutral-400 focus:ring-offset-2"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M205.66,194.34a8,8,0,0,1-11.32,11.32L128,139.31,61.66,205.66a8,8,0,0,1-11.32-11.32L116.69,128,50.34,61.66A8,8,0,0,1,61.66,50.34L128,116.69l66.34-66.35a8,8,0,0,1,11.32,11.32L139.31,128Z"></path></svg><span class="sr-only">Dismiss</span></button><p class="text-sm font-medium">Refresh this wiki</p><p class="mt-2 text-sm font-light text-neutral-500 dark:text-neutral-400">This wiki was recently refreshed. Please wait<!-- --> <!-- -->2<!-- --> day<!-- -->s<!-- --> to refresh again.</p></div></div><h3 class="px-4 pb-5 text-lg font-medium leading-none">On this page</h3><ul style="scrollbar-width:none" class="min-h-0 flex-1 space-y-3 overflow-y-auto p-4 pt-0"><li class=""><a href="#overview" class="hover:text-primary pr-1 transition-all text-primary font-medium">Overview</a></li><li class="ml-3"><a href="#execution-contexts" class="hover:text-primary pr-1 font-normal transition-all text-secondary">Execution Contexts</a></li><li class="ml-6"><a href="#desktop-electron" class="hover:text-primary pr-1 font-normal transition-all text-secondary">Desktop (Electron)</a></li><li class="ml-6"><a href="#web-browser" class="hover:text-primary pr-1 font-normal transition-all text-secondary">Web (Browser)</a></li><li class="ml-6"><a href="#cli" class="hover:text-primary pr-1 font-normal transition-all text-secondary">CLI</a></li><li class="ml-3"><a href="#multi-process-architecture-electron" class="hover:text-primary pr-1 font-normal transition-all text-secondary">Multi-Process Architecture (Electron)</a></li><li class="ml-6"><a href="#process-responsibilities" class="hover:text-primary pr-1 font-normal transition-all text-secondary">Process Responsibilities</a></li><li class="ml-3"><a href="#core-subsystems" class="hover:text-primary pr-1 font-normal transition-all text-secondary">Core Subsystems</a></li><li class="ml-6"><a href="#subsystem-importance-rankings" class="hover:text-primary pr-1 font-normal transition-all text-secondary">Subsystem Importance Rankings</a></li><li class="ml-3"><a href="#codebase-organization" class="hover:text-primary pr-1 font-normal transition-all text-secondary">Codebase Organization</a></li><li class="ml-6"><a href="#directory-structure" class="hover:text-primary pr-1 font-normal transition-all text-secondary">Directory Structure</a></li><li class="ml-6"><a href="#layering-enforcement" class="hover:text-primary pr-1 font-normal transition-all text-secondary">Layering Enforcement</a></li><li class="ml-3"><a href="#dependency-injection" class="hover:text-primary pr-1 font-normal transition-all text-secondary">Dependency Injection</a></li><li class="ml-3"><a href="#extension-system-architecture" class="hover:text-primary pr-1 font-normal transition-all text-secondary">Extension System Architecture</a></li><li class="ml-3"><a href="#entry-points" class="hover:text-primary pr-1 font-normal transition-all text-secondary">Entry Points</a></li><li class="ml-3"><a href="#configuration-and-dependencies" class="hover:text-primary pr-1 font-normal transition-all text-secondary">Configuration and Dependencies</a></li><li class="ml-6"><a href="#package-structure" class="hover:text-primary pr-1 font-normal transition-all text-secondary">Package Structure</a></li><li class="ml-6"><a href="#key-dependencies" class="hover:text-primary pr-1 font-normal transition-all text-secondary">Key Dependencies</a></li><li class="ml-3"><a href="#summary" class="hover:text-primary pr-1 font-normal transition-all text-secondary">Summary</a></li></ul></div></div><div class="pointer-events-none fixed bottom-2 left-2 right-2 mt-2 md:bottom-4 md:left-0 md:right-0"><div class="z-10 mx-auto max-w-3xl"><!--$!--><template data-dgst="BAILOUT_TO_CLIENT_SIDE_RENDERING"></template><!--/$--></div></div></div></div></div><!--$--><!--/$--></div><script>$RC("B:1","S:1")</script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n"])</script><script>self.__next_f.push([1,"2:I[49138,[\"9453\",\"static/chunks/b1298b8d-5cac6cd7c8e952ff.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"8970\",\"static/chunks/378e5a93-860e027c5a5e0c0d.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"1585\",\"static/chunks/f7f68e2d-d8bf979db5ff4e9d.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"7963\",\"static/chunks/7963-b29c27a8b53c3f2a.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"1265\",\"static/chunks/1265-fa8a95d3842768f5.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"9885\",\"static/chunks/9885-b57089f03806c3b8.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"659\",\"static/chunks/659-ee9e1e775e30dcef.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"7177\",\"static/chunks/app/layout-0537c2076823e553.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\"],\"RootProvider\"]\n"])</script><script>self.__next_f.push([1,"3:I[85341,[],\"\"]\n4:I[90025,[],\"\"]\n7:I[41012,[],\"ClientPageRoot\"]\n"])</script><script>self.__next_f.push([1,"8:I[57456,[\"9453\",\"static/chunks/b1298b8d-5cac6cd7c8e952ff.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"8970\",\"static/chunks/378e5a93-860e027c5a5e0c0d.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"1585\",\"static/chunks/f7f68e2d-d8bf979db5ff4e9d.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"4129\",\"static/chunks/7bf36345-1ac10ec2f0e0c88f.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"2545\",\"static/chunks/c16f53c3-b390b6f98a69dcec.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"7963\",\"static/chunks/7963-b29c27a8b53c3f2a.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"1265\",\"static/chunks/1265-fa8a95d3842768f5.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"6212\",\"static/chunks/6212-505c2fc95d1a35ae.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"9885\",\"static/chunks/9885-b57089f03806c3b8.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"4336\",\"static/chunks/4336-624d5ae6f4cc1cc7.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"659\",\"static/chunks/659-ee9e1e775e30dcef.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"8461\",\"static/chunks/8461-369a9f0c48ea2626.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"7198\",\"static/chunks/7198-985a49f2b6072d25.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"5462\",\"static/chunks/5462-08221e91030fd747.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"4429\",\"static/chunks/4429-943205658cbafffe.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"9976\",\"static/chunks/9976-9250854d58eefaa3.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"1481\",\"static/chunks/1481-25d5bbc4f2d9524a.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"3285\",\"static/chunks/app/%5Borg%5D/%5Brepo%5D/%5B%5B...wikiRoutes%5D%5D/page-6651f8cd8321a0db.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\"],\"default\"]\n"])</script><script>self.__next_f.push([1,"b:I[15104,[],\"OutletBoundary\"]\nd:I[94777,[],\"AsyncMetadataOutlet\"]\nf:I[15104,[],\"ViewportBoundary\"]\n11:I[15104,[],\"MetadataBoundary\"]\n12:\"$Sreact.suspense\"\n14:I[34431,[],\"\"]\n:HL[\"/_next/static/media/4cf2300e9c8272f7-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/media/93f479601ee12b01-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/css/de70bee13400563f.css?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"style\"]\n:HL[\"/_next/static/css/0df64a618dd79f27.css?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"3A3Pyo8yufrPcwNgXOPtr\",\"p\":\"\",\"c\":[\"\",\"microsoft\",\"vscode\",\"\"],\"i\":false,\"f\":[[[\"\",{\"children\":[[\"org\",\"microsoft\",\"d\"],{\"children\":[[\"repo\",\"vscode\",\"d\"],{\"children\":[[\"wikiRoutes\",\"\",\"oc\"],{\"children\":[\"__PAGE__\",{}]}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/de70bee13400563f.css?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/0df64a618dd79f27.css?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"suppressHydrationWarning\":true,\"children\":[[\"$\",\"head\",null,{}],[\"$\",\"body\",null,{\"className\":\"__variable_188709 font-geist-sans relative min-h-screen __variable_9a8899 bg-background antialiased\",\"children\":[\"$\",\"$L2\",null,{\"children\":[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]}]]}]]}],{\"children\":[[\"org\",\"microsoft\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"repo\",\"vscode\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,\"$L5\"]}],{\"children\":[[\"wikiRoutes\",\"\",\"oc\"],[\"$\",\"$1\",\"c\",{\"children\":[null,\"$L6\"]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[[\"$\",\"$L7\",null,{\"Component\":\"$8\",\"searchParams\":{},\"params\":{\"org\":\"microsoft\",\"repo\":\"vscode\"},\"promises\":[\"$@9\",\"$@a\"]}],null,[\"$\",\"$Lb\",null,{\"children\":[\"$Lc\",[\"$\",\"$Ld\",null,{\"promise\":\"$@e\"}]]}]]}],{},null,false]},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[[\"$\",\"$Lf\",null,{\"children\":\"$L10\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]],[\"$\",\"$L11\",null,{\"children\":[\"$\",\"div\",null,{\"hidden\":true,\"children\":[\"$\",\"$12\",null,{\"fallback\":null,\"children\":\"$L13\"}]}]}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$14\",[]],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"9:{}\na:\"$0:f:0:1:2:children:2:children:2:children:2:children:1:props:children:0:props:params\"\n"])</script><script>self.__next_f.push([1,"10:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\nc:null\n"])</script><script>self.__next_f.push([1,"15:I[13550,[\"9453\",\"static/chunks/b1298b8d-5cac6cd7c8e952ff.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"8970\",\"static/chunks/378e5a93-860e027c5a5e0c0d.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"1585\",\"static/chunks/f7f68e2d-d8bf979db5ff4e9d.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"7963\",\"static/chunks/7963-b29c27a8b53c3f2a.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"1265\",\"static/chunks/1265-fa8a95d3842768f5.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"6212\",\"static/chunks/6212-505c2fc95d1a35ae.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"4336\",\"static/chunks/4336-624d5ae6f4cc1cc7.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"25\",\"static/chunks/25-9f305b682cea7558.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"7391\",\"static/chunks/7391-247f6ef4f530f4c6.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"6373\",\"static/chunks/6373-d56a493968555802.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"6375\",\"static/chunks/6375-7e0e75eb09fc9abe.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"9437\",\"static/chunks/9437-00f165dda9ad3a42.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"2933\",\"static/chunks/app/%5Borg%5D/%5Brepo%5D/layout-cecfb9eee640deb0.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\"],\"HeaderWrapperWithSuspense\"]\n"])</script><script>self.__next_f.push([1,"16:I[82188,[\"9453\",\"static/chunks/b1298b8d-5cac6cd7c8e952ff.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"8970\",\"static/chunks/378e5a93-860e027c5a5e0c0d.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"1585\",\"static/chunks/f7f68e2d-d8bf979db5ff4e9d.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"7963\",\"static/chunks/7963-b29c27a8b53c3f2a.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"1265\",\"static/chunks/1265-fa8a95d3842768f5.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"6212\",\"static/chunks/6212-505c2fc95d1a35ae.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"4336\",\"static/chunks/4336-624d5ae6f4cc1cc7.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"25\",\"static/chunks/25-9f305b682cea7558.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"7391\",\"static/chunks/7391-247f6ef4f530f4c6.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"6373\",\"static/chunks/6373-d56a493968555802.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"6375\",\"static/chunks/6375-7e0e75eb09fc9abe.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"9437\",\"static/chunks/9437-00f165dda9ad3a42.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\",\"2933\",\"static/chunks/app/%5Borg%5D/%5Brepo%5D/layout-cecfb9eee640deb0.js?dpl=dpl_76ZRHKsVzF45bwFAhtW7jaJcniJK\"],\"WikiContextProvider\"]\n"])</script><script>self.__next_f.push([1,"58:I[36505,[],\"IconMark\"]\n17:T734b,"])</script><script>self.__next_f.push([1,"# Overview\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [.npmrc](.npmrc)\n- [.nvmrc](.nvmrc)\n- [build/.moduleignore](build/.moduleignore)\n- [build/.webignore](build/.webignore)\n- [build/azure-pipelines/linux/setup-env.sh](build/azure-pipelines/linux/setup-env.sh)\n- [build/azure-pipelines/linux/verify-glibc-requirements.sh](build/azure-pipelines/linux/verify-glibc-requirements.sh)\n- [build/checksums/electron.txt](build/checksums/electron.txt)\n- [build/checksums/nodejs.txt](build/checksums/nodejs.txt)\n- [build/darwin/create-universal-app.ts](build/darwin/create-universal-app.ts)\n- [build/gulpfile.vscode.ts](build/gulpfile.vscode.ts)\n- [build/lib/i18n.resources.json](build/lib/i18n.resources.json)\n- [build/linux/dependencies-generator.ts](build/linux/dependencies-generator.ts)\n- [build/npm/postinstall.ts](build/npm/postinstall.ts)\n- [build/package.json](build/package.json)\n- [cgmanifest.json](cgmanifest.json)\n- [cli/src/bin/code/legacy_args.rs](cli/src/bin/code/legacy_args.rs)\n- [eslint.config.js](eslint.config.js)\n- [extensions/esbuild-webview-common.mjs](extensions/esbuild-webview-common.mjs)\n- [extensions/package-lock.json](extensions/package-lock.json)\n- [extensions/package.json](extensions/package.json)\n- [extensions/vscode-api-tests/package.json](extensions/vscode-api-tests/package.json)\n- [extensions/vscode-api-tests/src/singlefolder-tests/chat.test.ts](extensions/vscode-api-tests/src/singlefolder-tests/chat.test.ts)\n- [package-lock.json](package-lock.json)\n- [package.json](package.json)\n- [remote/.npmrc](remote/.npmrc)\n- [remote/package-lock.json](remote/package-lock.json)\n- [remote/package.json](remote/package.json)\n- [remote/web/package-lock.json](remote/web/package-lock.json)\n- [remote/web/package.json](remote/web/package.json)\n- [resources/completions/bash/code](resources/completions/bash/code)\n- [resources/completions/zsh/_code](resources/completions/zsh/_code)\n- [src/vs/base/node/terminalEncoding.ts](src/vs/base/node/terminalEncoding.ts)\n- [src/vs/base/parts/contextmenu/electron-main/contextmenu.ts](src/vs/base/parts/contextmenu/electron-main/contextmenu.ts)\n- [src/vs/code/browser/workbench/workbench-dev.html](src/vs/code/browser/workbench/workbench-dev.html)\n- [src/vs/code/browser/workbench/workbench.html](src/vs/code/browser/workbench/workbench.html)\n- [src/vs/code/browser/workbench/workbench.ts](src/vs/code/browser/workbench/workbench.ts)\n- [src/vs/code/electron-main/app.ts](src/vs/code/electron-main/app.ts)\n- [src/vs/code/electron-main/main.ts](src/vs/code/electron-main/main.ts)\n- [src/vs/code/node/cli.ts](src/vs/code/node/cli.ts)\n- [src/vs/code/node/cliProcessMain.ts](src/vs/code/node/cliProcessMain.ts)\n- [src/vs/editor/browser/config/charWidthReader.ts](src/vs/editor/browser/config/charWidthReader.ts)\n- [src/vs/editor/browser/editorBrowser.ts](src/vs/editor/browser/editorBrowser.ts)\n- [src/vs/editor/browser/viewParts/minimap/minimap.ts](src/vs/editor/browser/viewParts/minimap/minimap.ts)\n- [src/vs/editor/browser/viewParts/minimap/minimapCharRenderer.ts](src/vs/editor/browser/viewParts/minimap/minimapCharRenderer.ts)\n- [src/vs/editor/browser/viewParts/minimap/minimapCharRendererFactory.ts](src/vs/editor/browser/viewParts/minimap/minimapCharRendererFactory.ts)\n- [src/vs/editor/browser/viewParts/minimap/minimapCharSheet.ts](src/vs/editor/browser/viewParts/minimap/minimapCharSheet.ts)\n- [src/vs/editor/browser/viewParts/minimap/minimapPreBaked.ts](src/vs/editor/browser/viewParts/minimap/minimapPreBaked.ts)\n- [src/vs/editor/browser/widget/codeEditor/codeEditorWidget.ts](src/vs/editor/browser/widget/codeEditor/codeEditorWidget.ts)\n- [src/vs/editor/common/config/editorOptions.ts](src/vs/editor/common/config/editorOptions.ts)\n- [src/vs/editor/common/config/fontInfo.ts](src/vs/editor/common/config/fontInfo.ts)\n- [src/vs/editor/common/editorCommon.ts](src/vs/editor/common/editorCommon.ts)\n- [src/vs/editor/common/languages.ts](src/vs/editor/common/languages.ts)\n- [src/vs/editor/common/standalone/standaloneEnums.ts](src/vs/editor/common/standalone/standaloneEnums.ts)\n- [src/vs/editor/common/textModelEvents.ts](src/vs/editor/common/textModelEvents.ts)\n- [src/vs/editor/common/viewModel/minimapTokensColorTracker.ts](src/vs/editor/common/viewModel/minimapTokensColorTracker.ts)\n- [src/vs/editor/test/browser/view/minimapCharRenderer.test.ts](src/vs/editor/test/browser/view/minimapCharRenderer.test.ts)\n- [src/vs/monaco.d.ts](src/vs/monaco.d.ts)\n- [src/vs/platform/editor/common/editor.ts](src/vs/platform/editor/common/editor.ts)\n- [src/vs/platform/environment/common/argv.ts](src/vs/platform/environment/common/argv.ts)\n- [src/vs/platform/environment/common/environment.ts](src/vs/platform/environment/common/environment.ts)\n- [src/vs/platform/environment/common/environmentService.ts](src/vs/platform/environment/common/environmentService.ts)\n- [src/vs/platform/environment/electron-main/environmentMainService.ts](src/vs/platform/environment/electron-main/environmentMainService.ts)\n- [src/vs/platform/environment/node/argv.ts](src/vs/platform/environment/node/argv.ts)\n- [src/vs/platform/environment/node/argvHelper.ts](src/vs/platform/environment/node/argvHelper.ts)\n- [src/vs/platform/environment/node/environmentService.ts](src/vs/platform/environment/node/environmentService.ts)\n- [src/vs/platform/environment/node/stdin.ts](src/vs/platform/environment/node/stdin.ts)\n- [src/vs/platform/environment/test/node/nativeModules.integrationTest.ts](src/vs/platform/environment/test/node/nativeModules.integrationTest.ts)\n- [src/vs/platform/extensionManagement/common/extensionManagementCLI.ts](src/vs/platform/extensionManagement/common/extensionManagementCLI.ts)\n- [src/vs/platform/extensions/common/extensionsApiProposals.ts](src/vs/platform/extensions/common/extensionsApiProposals.ts)\n- [src/vs/server/node/remoteExtensionHostAgentCli.ts](src/vs/server/node/remoteExtensionHostAgentCli.ts)\n- [src/vs/server/node/server.cli.ts](src/vs/server/node/server.cli.ts)\n- [src/vs/server/node/serverEnvironmentService.ts](src/vs/server/node/serverEnvironmentService.ts)\n- [src/vs/server/node/serverServices.ts](src/vs/server/node/serverServices.ts)\n- [src/vs/workbench/api/browser/extensionHost.contribution.ts](src/vs/workbench/api/browser/extensionHost.contribution.ts)\n- [src/vs/workbench/api/browser/mainThreadLanguageFeatures.ts](src/vs/workbench/api/browser/mainThreadLanguageFeatures.ts)\n- [src/vs/workbench/api/common/extHost.api.impl.ts](src/vs/workbench/api/common/extHost.api.impl.ts)\n- [src/vs/workbench/api/common/extHost.protocol.ts](src/vs/workbench/api/common/extHost.protocol.ts)\n- [src/vs/workbench/api/common/extHostLanguageFeatures.ts](src/vs/workbench/api/common/extHostLanguageFeatures.ts)\n- [src/vs/workbench/api/common/extHostTypeConverters.ts](src/vs/workbench/api/common/extHostTypeConverters.ts)\n- [src/vs/workbench/api/common/extHostTypes.ts](src/vs/workbench/api/common/extHostTypes.ts)\n- [src/vs/workbench/browser/actions/layoutActions.ts](src/vs/workbench/browser/actions/layoutActions.ts)\n- [src/vs/workbench/browser/contextkeys.ts](src/vs/workbench/browser/contextkeys.ts)\n- [src/vs/workbench/browser/dnd.ts](src/vs/workbench/browser/dnd.ts)\n- [src/vs/workbench/browser/layout.ts](src/vs/workbench/browser/layout.ts)\n- [src/vs/workbench/browser/parts/auxiliarybar/auxiliaryBarActions.ts](src/vs/workbench/browser/parts/auxiliarybar/auxiliaryBarActions.ts)\n- [src/vs/workbench/browser/parts/editor/editor.contribution.ts](src/vs/workbench/browser/parts/editor/editor.contribution.ts)\n- [src/vs/workbench/browser/parts/editor/editor.ts](src/vs/workbench/browser/parts/editor/editor.ts)\n- [src/vs/workbench/browser/parts/editor/editorActions.ts](src/vs/workbench/browser/parts/editor/editorActions.ts)\n- [src/vs/workbench/browser/parts/editor/editorCommands.ts](src/vs/workbench/browser/parts/editor/editorCommands.ts)\n- [src/vs/workbench/browser/parts/editor/editorDropTarget.ts](src/vs/workbench/browser/parts/editor/editorDropTarget.ts)\n- [src/vs/workbench/browser/parts/editor/editorGroupView.ts](src/vs/workbench/browser/parts/editor/editorGroupView.ts)\n- [src/vs/workbench/browser/parts/editor/editorPart.ts](src/vs/workbench/browser/parts/editor/editorPart.ts)\n- [src/vs/workbench/browser/parts/panel/panelActions.ts](src/vs/workbench/browser/parts/panel/panelActions.ts)\n- [src/vs/workbench/browser/parts/titlebar/titlebarActions.ts](src/vs/workbench/browser/parts/titlebar/titlebarActions.ts)\n- [src/vs/workbench/browser/web.api.ts](src/vs/workbench/browser/web.api.ts)\n- [src/vs/workbench/browser/web.factory.ts](src/vs/workbench/browser/web.factory.ts)\n- [src/vs/workbench/browser/web.main.ts](src/vs/workbench/browser/web.main.ts)\n- [src/vs/workbench/browser/workbench.contribution.ts](src/vs/workbench/browser/workbench.contribution.ts)\n- [src/vs/workbench/browser/workbench.ts](src/vs/workbench/browser/workbench.ts)\n- [src/vs/workbench/common/contextkeys.ts](src/vs/workbench/common/contextkeys.ts)\n- [src/vs/workbench/common/editor.ts](src/vs/workbench/common/editor.ts)\n- [src/vs/workbench/electron-browser/desktop.main.ts](src/vs/workbench/electron-browser/desktop.main.ts)\n- [src/vs/workbench/services/editor/browser/editorService.ts](src/vs/workbench/services/editor/browser/editorService.ts)\n- [src/vs/workbench/services/editor/common/editorGroupsService.ts](src/vs/workbench/services/editor/common/editorGroupsService.ts)\n- [src/vs/workbench/services/editor/common/editorService.ts](src/vs/workbench/services/editor/common/editorService.ts)\n- [src/vs/workbench/services/editor/test/browser/editorGroupsService.test.ts](src/vs/workbench/services/editor/test/browser/editorGroupsService.test.ts)\n- [src/vs/workbench/services/editor/test/browser/editorService.test.ts](src/vs/workbench/services/editor/test/browser/editorService.test.ts)\n- [src/vs/workbench/services/environment/browser/environmentService.ts](src/vs/workbench/services/environment/browser/environmentService.ts)\n- [src/vs/workbench/services/environment/common/environmentService.ts](src/vs/workbench/services/environment/common/environmentService.ts)\n- [src/vs/workbench/services/environment/electron-browser/environmentService.ts](src/vs/workbench/services/environment/electron-browser/environmentService.ts)\n- [src/vs/workbench/services/extensions/electron-browser/nativeExtensionService.ts](src/vs/workbench/services/extensions/electron-browser/nativeExtensionService.ts)\n- [src/vs/workbench/services/layout/browser/layoutService.ts](src/vs/workbench/services/layout/browser/layoutService.ts)\n- [src/vs/workbench/test/browser/workbenchTestServices.ts](src/vs/workbench/test/browser/workbenchTestServices.ts)\n- [src/vs/workbench/workbench.common.main.ts](src/vs/workbench/workbench.common.main.ts)\n- [src/vs/workbench/workbench.desktop.main.ts](src/vs/workbench/workbench.desktop.main.ts)\n- [src/vs/workbench/workbench.web.main.ts](src/vs/workbench/workbench.web.main.ts)\n- [src/vscode-dts/vscode.d.ts](src/vscode-dts/vscode.d.ts)\n- [src/vscode-dts/vscode.proposed.inlineCompletionsAdditions.d.ts](src/vscode-dts/vscode.proposed.inlineCompletionsAdditions.d.ts)\n\n\u003c/details\u003e\n\n\n\nThis document provides a high-level overview of VS Code's architecture, including its execution contexts, multi-process architecture, major subsystems, and codebase organization. It serves as an entry point for understanding how the different parts of VS Code fit together.\n\nFor information about specific subsystems, see:\n- Build system and development workflow: [Build System and Development](#2)\n- Application startup and initialization: [Application Lifecycle and Bootstrap](#3)\n- UI layout and editor system: [Workbench Architecture](#4)\n- Extension development and API: [Extension System](#5)\n\n## Execution Contexts\n\nVS Code runs in three distinct execution contexts, each with its own entry point and runtime characteristics:\n\n```mermaid\ngraph TB\n    subgraph \"Execution Contexts\"\n        Electron[\"Electron Desktop\u003cbr/\u003eCodeMain\u003cbr/\u003esrc/vs/code/electron-main/main.ts\"]\n        Web[\"Web Workbench\u003cbr/\u003eBrowserMain\u003cbr/\u003esrc/vs/workbench/browser/web.main.ts\"]\n        CLI[\"Command Line\u003cbr/\u003eCliMain\u003cbr/\u003esrc/vs/code/node/cliProcessMain.ts\"]\n    end\n    \n    subgraph \"Build Artifacts\"\n        ElectronBuild[\"Desktop Application\u003cbr/\u003eWindows, macOS, Linux\"]\n        WebBundle[\"Web Bundle\u003cbr/\u003eBrowser Deployment\"]\n        CLIBinary[\"CLI Binary\u003cbr/\u003eNode.js Process\"]\n    end\n    \n    Electron --\u003e ElectronBuild\n    Web --\u003e WebBundle\n    CLI --\u003e CLIBinary\n```\n\n**Sources:** [src/vs/code/electron-main/main.ts](), [src/vs/workbench/browser/web.main.ts](), [src/vs/code/node/cliProcessMain.ts](), [package.json:9]()\n\n### Desktop (Electron)\n\nThe Electron-based desktop application is the primary execution context. It uses Chromium for rendering and Node.js for system integration. The entry point is `CodeMain` which initializes the Electron app and creates the main process.\n\n**Key characteristics:**\n- Full file system access via Node.js\n- Native module support (node-pty, native-keymap, etc.)\n- Multi-process architecture for stability\n- OS integration (title bar, menus, notifications)\n\n### Web (Browser)\n\nThe web version runs entirely in the browser without Node.js. It uses browser APIs and optional remote connections for file access and extension execution.\n\n**Key characteristics:**\n- No direct file system access (uses FileSystemAccess API or remote)\n- Limited to web-compatible extensions\n- Single-process architecture in the browser\n- Remote connection support for backend services\n\n### CLI\n\nThe command-line interface provides headless operations like diffs, file manipulation, and extension management through a Node.js process.\n\n**Sources:** [src/vs/code/node/cliProcessMain.ts](), [src/vs/platform/environment/node/argv.ts]()\n\n## Multi-Process Architecture (Electron)\n\nThe Electron desktop version uses a sophisticated multi-process architecture for isolation, stability, and security:\n\n```mermaid\ngraph TB\n    subgraph \"Main Process\"\n        CodeApp[\"CodeApplication\u003cbr/\u003esrc/vs/code/electron-main/app.ts\"]\n        MainIPC[\"NodeIPCServer\u003cbr/\u003eIPC Coordination\"]\n    end\n    \n    subgraph \"Renderer Process(es)\"\n        Workbench[\"Workbench\u003cbr/\u003esrc/vs/workbench/browser/workbench.ts\"]\n        EditorService[\"EditorService\u003cbr/\u003esrc/vs/workbench/services/editor\"]\n        LayoutService[\"Layout\u003cbr/\u003esrc/vs/workbench/browser/layout.ts\"]\n    end\n    \n    subgraph \"Extension Host Process\"\n        ExtHostMain[\"ExtensionService\u003cbr/\u003esrc/vs/workbench/api/common\"]\n        ExtHostAPI[\"createApiFactoryAndRegisterActors\u003cbr/\u003esrc/vs/workbench/api/common/extHost.api.impl.ts\"]\n    end\n    \n    subgraph \"Shared Process\"\n        SharedMain[\"Shared Process\u003cbr/\u003eLong-lived services\"]\n        ExtMgmt[\"Extension Management\"]\n        Telemetry[\"Telemetry Service\"]\n    end\n    \n    subgraph \"Pty Host Process\"\n        PtyService[\"PtyService\u003cbr/\u003esrc/vs/platform/terminal/node\"]\n        Terminals[\"Shell Processes\"]\n    end\n    \n    CodeApp --\u003e MainIPC\n    MainIPC \u003c--\u003e|IPC| Workbench\n    MainIPC \u003c--\u003e|IPC| ExtHostMain\n    MainIPC \u003c--\u003e|IPC| SharedMain\n    Workbench \u003c--\u003e|RPC| ExtHostMain\n    Workbench \u003c--\u003e|IPC| PtyService\n    PtyService --\u003e Terminals\n```\n\n**Sources:** [src/vs/code/electron-main/app.ts:1-1000](), [src/vs/workbench/browser/workbench.ts](), [src/vs/workbench/api/common/extHost.api.impl.ts:132-256]()\n\n### Process Responsibilities\n\n| Process | Purpose | Key Classes | Crashes Affect |\n|---------|---------|-------------|----------------|\n| Main Process | Window management, lifecycle, IPC server | `CodeApplication`, `WindowsMainService` | Entire application |\n| Renderer Process | UI, user interactions, workbench | `Workbench`, `Layout`, `EditorService` | Single window |\n| Extension Host | Isolated extension execution | `ExtensionService`, API factory | Extensions only |\n| Shared Process | Cross-window services | Extension management, telemetry | Background services |\n| Pty Host | Terminal/shell processes | `PtyService` | Terminals only |\n\nThe separation ensures that extension crashes, terminal failures, or shell hangs do not affect the main UI or other windows.\n\n**Sources:** [src/vs/code/electron-main/app.ts:100-500](), [src/vs/platform/terminal/node/ptyHostService.ts]()\n\n## Core Subsystems\n\nVS Code is organized into major subsystems, each responsible for distinct functionality:\n\n```mermaid\ngraph TB\n    subgraph \"Platform Services\"\n        Files[\"IFileService\u003cbr/\u003eFile System Abstraction\"]\n        Config[\"IConfigurationService\u003cbr/\u003eSettings Management\"]\n        Telemetry[\"ITelemetryService\u003cbr/\u003eUsage Analytics\"]\n        Log[\"ILogService\u003cbr/\u003eLogging Infrastructure\"]\n    end\n    \n    subgraph \"Workbench Services\"\n        Editor[\"IEditorService\u003cbr/\u003eEditor Lifecycle\"]\n        EditorGroups[\"IEditorGroupsService\u003cbr/\u003eEditor Organization\"]\n        Layout[\"IWorkbenchLayoutService\u003cbr/\u003eUI Layout\"]\n        Views[\"IViewsService\u003cbr/\u003eView Contributions\"]\n    end\n    \n    subgraph \"Feature Services\"\n        Terminal[\"ITerminalService\u003cbr/\u003eTerminal Management\"]\n        SCM[\"ISCMService\u003cbr/\u003eSource Control\"]\n        Extensions[\"IExtensionService\u003cbr/\u003eExtension Lifecycle\"]\n        Notebook[\"INotebookService\u003cbr/\u003eNotebook Documents\"]\n        Chat[\"IChatService\u003cbr/\u003eAI Chat\"]\n    end\n    \n    subgraph \"Extension System\"\n        ExtAPI[\"vscode.* API\u003cbr/\u003esrc/vscode-dts/vscode.d.ts\"]\n        ExtHost[\"Extension Host RPC\u003cbr/\u003esrc/vs/workbench/api/common\"]\n        MainThread[\"MainThread Bridges\u003cbr/\u003emainThread*.ts files\"]\n    end\n    \n    Platform --\u003e Workbench\n    Workbench --\u003e Feature\n    Feature --\u003e ExtAPI\n    ExtHost \u003c--\u003e MainThread\n    MainThread --\u003e Workbench\n```\n\n**Sources:** [src/vs/workbench/workbench.common.main.ts:1-200](), [src/vs/workbench/browser/workbench.contribution.ts]()\n\n### Subsystem Importance Rankings\n\nBased on code activity and architectural significance:\n\n| Subsystem | Importance Score | Primary Location |\n|-----------|-----------------|------------------|\n| Build \u0026 Distribution | 4811 | `build/`, `gulpfile.*.ts` |\n| Extension System | 3055 | `src/vs/workbench/api/` |\n| Terminal | 2352 | `src/vs/workbench/contrib/terminal/` |\n| Chat/AI | 1852 | `src/vs/workbench/contrib/chat/` |\n| Notebooks | 1812 | `src/vs/workbench/contrib/notebook/` |\n| Core Workbench | 1085 | `src/vs/workbench/browser/` |\n| SCM | 840 | `src/vs/workbench/contrib/scm/` |\n| Git Extension | 1340 | `extensions/git/` |\n\nThese scores reflect both the complexity and frequency of changes in each subsystem.\n\n**Sources:** Analysis from provided cluster importance data\n\n## Codebase Organization\n\nThe VS Code codebase follows a hierarchical layering architecture:\n\n```mermaid\ngraph TB\n    subgraph \"Layer 0: Base\"\n        BaseCommon[\"base/common\u003cbr/\u003ePlatform-agnostic utilities\"]\n        BaseBrowser[\"base/browser\u003cbr/\u003eBrowser APIs\"]\n        BaseNode[\"base/node\u003cbr/\u003eNode.js APIs\"]\n    end\n    \n    subgraph \"Layer 1: Platform\"\n        Platform[\"platform/**\u003cbr/\u003eService abstractions\u003cbr/\u003eDependency injection\"]\n    end\n    \n    subgraph \"Layer 2: Editor\"\n        EditorCommon[\"editor/common\u003cbr/\u003eText editing core\"]\n        EditorBrowser[\"editor/browser\u003cbr/\u003eMonaco Editor\"]\n    end\n    \n    subgraph \"Layer 3: Workbench\"\n        WorkbenchCommon[\"workbench/common\u003cbr/\u003eWorkbench abstractions\"]\n        WorkbenchBrowser[\"workbench/browser\u003cbr/\u003eWorkbench UI\"]\n        WorkbenchServices[\"workbench/services\u003cbr/\u003eWorkbench services\"]\n        WorkbenchContrib[\"workbench/contrib\u003cbr/\u003eFeature contributions\"]\n    end\n    \n    subgraph \"Layer 4: Extensions\"\n        ExtAPI[\"workbench/api\u003cbr/\u003eExtension API implementation\"]\n        BuiltinExt[\"extensions/\u003cbr/\u003eBuilt-in extensions\"]\n    end\n    \n    BaseCommon --\u003e Platform\n    BaseBrowser --\u003e Platform\n    BaseNode --\u003e Platform\n    \n    Platform --\u003e EditorCommon\n    EditorCommon --\u003e EditorBrowser\n    \n    Platform --\u003e WorkbenchCommon\n    EditorBrowser --\u003e WorkbenchBrowser\n    WorkbenchCommon --\u003e WorkbenchServices\n    WorkbenchServices --\u003e WorkbenchContrib\n    \n    WorkbenchContrib --\u003e ExtAPI\n    ExtAPI --\u003e BuiltinExt\n```\n\n**Sources:** [src/vs/base/](), [src/vs/platform/](), [src/vs/editor/](), [src/vs/workbench/]()\n\n### Directory Structure\n\n**`src/vs/base/`** - Foundation layer with no dependencies on other VS Code layers:\n- `common/` - Pure TypeScript utilities (events, lifecycle, URIs, etc.)\n- `browser/` - Browser-specific code (DOM manipulation, browser APIs)\n- `node/` - Node.js-specific code (file system, process management)\n\n**`src/vs/platform/`** - Platform services with dependency injection:\n- Each subdirectory represents a service abstraction (e.g., `files/`, `configuration/`, `telemetry/`)\n- Defines `I*Service` interfaces\n- Implementations separated by environment (`common/`, `browser/`, `node/`, `electron-main/`)\n\n**`src/vs/editor/`** - Monaco Editor implementation:\n- `common/` - Core text editing logic\n- `browser/` - Editor rendering and UI\n- Self-contained, reusable outside VS Code\n\n**`src/vs/workbench/`** - VS Code workbench (the application shell):\n- `common/` - Workbench abstractions and models\n- `browser/` - Workbench UI and layout\n- `services/` - Workbench-specific services\n- `contrib/` - Feature contributions (terminal, SCM, debug, etc.)\n- `api/` - Extension API implementation\n\n**`extensions/`** - Built-in extensions:\n- Written using the same public API as third-party extensions\n- Examples: Git, Markdown, TypeScript, themes\n\n**Sources:** [src/vs/workbench/workbench.common.main.ts](), [build/package.json]()\n\n### Layering Enforcement\n\nVS Code enforces architectural layering through ESLint rules to prevent circular dependencies and maintain separation of concerns:\n\n- Base cannot depend on Platform\n- Platform cannot depend on Editor or Workbench\n- Editor cannot depend on Workbench\n- Common code cannot depend on Browser or Node code\n\n**Sources:** [package.json:51]() (`valid-layers-check` script), [eslint.config.js]()\n\n## Dependency Injection\n\nVS Code uses a sophisticated dependency injection system for service instantiation and lifecycle management:\n\n```mermaid\ngraph TB\n    ServiceCollection[\"ServiceCollection\u003cbr/\u003eService Registry\"]\n    InstService[\"InstantiationService\u003cbr/\u003eDI Container\"]\n    \n    subgraph \"Service Declarations\"\n        IFileService[\"IFileService\u003cbr/\u003einterface\"]\n        IConfigService[\"IConfigurationService\u003cbr/\u003einterface\"]\n        ILogService[\"ILogService\u003cbr/\u003einterface\"]\n    end\n    \n    subgraph \"Service Implementations\"\n        FileService[\"FileService\u003cbr/\u003econcrete class\"]\n        ConfigService[\"ConfigurationService\u003cbr/\u003econcrete class\"]\n        LogService[\"LogService\u003cbr/\u003econcrete class\"]\n    end\n    \n    subgraph \"Service Consumers\"\n        EditorService[\"EditorService\u003cbr/\u003econstructor(IFileService, IConfigService)\"]\n    end\n    \n    ServiceCollection --\u003e InstService\n    \n    IFileService -.interface.-\u003e FileService\n    IConfigService -.interface.-\u003e ConfigService\n    ILogService -.interface.-\u003e LogService\n    \n    FileService --\u003e ServiceCollection\n    ConfigService --\u003e ServiceCollection\n    LogService --\u003e ServiceCollection\n    \n    InstService --\u003e|resolves| EditorService\n```\n\n**Sources:** [src/vs/platform/instantiation/](), [src/vs/workbench/browser/workbench.ts]()\n\nServices are registered by binding interfaces to implementations:\n\n```typescript\n// Service definition\ninterface IFileService { ... }\n\n// Service implementation\nclass FileService implements IFileService { ... }\n\n// Registration\nconst services = new ServiceCollection();\nservices.set(IFileService, new SyncDescriptor(FileService));\n\n// Usage - dependencies injected automatically\nclass EditorService {\n  constructor(\n    @IFileService private fileService: IFileService,\n    @ILogService private logService: ILogService\n  ) { }\n}\n```\n\nAll services follow the naming convention `I*Service` for interfaces, ensuring consistency across the codebase.\n\n**Sources:** [src/vs/platform/instantiation/common/instantiation.ts](), [src/vs/platform/instantiation/common/serviceCollection.ts]()\n\n## Extension System Architecture\n\nThe Extension System is one of VS Code's most critical subsystems (importance: 3055), enabling third-party extensibility while maintaining application stability:\n\n```mermaid\ngraph LR\n    subgraph \"Extension Code\"\n        Extension[\"Extension\u003cbr/\u003eTypeScript/JavaScript\"]\n        VSCodeAPI[\"vscode.* API\u003cbr/\u003esrc/vscode-dts/vscode.d.ts\"]\n    end\n    \n    subgraph \"Extension Host Process\"\n        APIFactory[\"createApiFactoryAndRegisterActors\u003cbr/\u003esrc/vs/workbench/api/common/extHost.api.impl.ts\"]\n        ExtHostDocs[\"ExtHostDocuments\"]\n        ExtHostLang[\"ExtHostLanguageFeatures\"]\n        RPCClient[\"Extension Host RPC\"]\n    end\n    \n    subgraph \"RPC Boundary\"\n        Protocol[\"extHost.protocol.ts\u003cbr/\u003eMainThread/ExtHost shapes\"]\n    end\n    \n    subgraph \"Main Thread\"\n        MainRPC[\"Main Thread RPC\"]\n        MainThreadDocs[\"MainThreadDocuments\"]\n        MainThreadLang[\"MainThreadLanguageFeatures\"]\n    end\n    \n    subgraph \"Core Services\"\n        EditorSvc[\"IEditorService\"]\n        LangFeatures[\"ILanguageFeaturesService\"]\n    end\n    \n    Extension --\u003e VSCodeAPI\n    VSCodeAPI --\u003e APIFactory\n    APIFactory --\u003e ExtHostDocs\n    APIFactory --\u003e ExtHostLang\n    ExtHostDocs --\u003e RPCClient\n    ExtHostLang --\u003e RPCClient\n    \n    RPCClient \u003c--\u003e|IPC| Protocol\n    Protocol \u003c--\u003e|IPC| MainRPC\n    \n    MainRPC --\u003e MainThreadDocs\n    MainRPC --\u003e MainThreadLang\n    MainThreadDocs --\u003e EditorSvc\n    MainThreadLang --\u003e LangFeatures\n```\n\n**Sources:** [src/vs/workbench/api/common/extHost.api.impl.ts:132-256](), [src/vs/workbench/api/common/extHost.protocol.ts:1-200]()\n\nExtensions run in an isolated Extension Host process and communicate with the main UI via RPC (Remote Procedure Call):\n\n1. Extensions call the `vscode.*` API\n2. API calls are converted to RPC messages via type converters\n3. Messages cross the process boundary through IPC\n4. MainThread implementations execute the calls using core services\n5. Results are marshalled back to the Extension Host\n\nThis architecture ensures that extension crashes or hangs do not affect the main workbench.\n\nFor detailed information about the extension system, see [Extension System](#5).\n\n**Sources:** [src/vs/workbench/api/common/extHostLanguageFeatures.ts](), [src/vs/workbench/api/browser/mainThreadLanguageFeatures.ts]()\n\n## Entry Points\n\nVS Code has different entry points depending on the execution context:\n\n| Context | Entry Point File | Key Classes |\n|---------|------------------|-------------|\n| Electron Main | `src/vs/code/electron-main/main.ts` | `CodeMain`, `CodeApplication` |\n| Electron Renderer | `src/vs/workbench/electron-sandbox/desktop.main.ts` | `DesktopMain` |\n| Web Workbench | `src/vs/workbench/browser/web.main.ts` | `BrowserMain` |\n| CLI | `src/vs/code/node/cliProcessMain.ts` | `CliMain` |\n| Shared Process | `src/vs/code/electron-sandbox/sharedProcess/sharedProcess.ts` | `SharedProcessMain` |\n\nEach entry point bootstraps its own service container and initializes the appropriate subsystems for its execution context.\n\n**Sources:** [src/vs/code/electron-main/main.ts](), [src/vs/workbench/browser/web.main.ts](), [src/vs/code/node/cliProcessMain.ts]()\n\n## Configuration and Dependencies\n\n### Package Structure\n\nVS Code uses multiple `package.json` files for different contexts:\n\n| Package | Purpose | Location |\n|---------|---------|----------|\n| Root | Desktop application dependencies | `package.json` |\n| Remote | Server-side dependencies for remote development | `remote/package.json` |\n| Web | Browser-only dependencies | `remote/web/package.json` |\n| Build | Build tool dependencies | `build/package.json` |\n| Extensions | Shared extension dependencies | `extensions/package.json` |\n\n**Sources:** [package.json:1-50](), [remote/package.json](), [build/package.json](), [extensions/package.json]()\n\n### Key Dependencies\n\n**Runtime dependencies:**\n- `electron` (39.2.7) - Desktop application framework\n- `@xterm/xterm` - Terminal emulator\n- `vscode-textmate` - TextMate grammar engine\n- `vscode-oniguruma` - Regex engine for syntax highlighting\n- Native modules: `node-pty`, `native-keymap`, `kerberos`\n\n**Build dependencies:**\n- `typescript` - Language and type checking\n- `gulp` - Build task automation\n- `esbuild` - Fast JavaScript bundling\n- `electron-builder` - Application packaging\n\n**Sources:** [package.json:75-122](), [package.json:123-226]()\n\n## Summary\n\nVS Code is a complex, multi-layered application that supports multiple execution contexts (Electron, Web, CLI) through careful architectural separation. The Electron version uses a multi-process architecture for stability, with distinct processes for the main window, extension execution, shared services, and terminal management. \n\nThe codebase is organized into strict layers (Base  Platform  Editor  Workbench) with enforced dependencies. A comprehensive dependency injection system manages service instantiation and lifecycle. The Extension System provides third-party extensibility through process isolation and RPC communication.\n\nKey architectural principles include:\n- **Process isolation** - Crashes in one subsystem don't affect others\n- **Layering** - Clear separation between platform code, editor, and workbench\n- **Service abstraction** - Dependencies injected through interfaces\n- **Multi-context support** - Same codebase runs in desktop, web, and CLI\n\nFor detailed information about specific subsystems, refer to their respective wiki pages in sections 2-11.\n\n**Sources:** [src/vs/workbench/](), [src/vs/code/electron-main/](), [package.json](), [src/vs/workbench/api/]()"])</script><script>self.__next_f.push([1,"18:T5f6b,"])</script><script>self.__next_f.push([1,"# Build System and Development\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [.npmrc](.npmrc)\n- [.nvmrc](.nvmrc)\n- [build/.moduleignore](build/.moduleignore)\n- [build/.webignore](build/.webignore)\n- [build/azure-pipelines/linux/setup-env.sh](build/azure-pipelines/linux/setup-env.sh)\n- [build/azure-pipelines/linux/verify-glibc-requirements.sh](build/azure-pipelines/linux/verify-glibc-requirements.sh)\n- [build/checksums/electron.txt](build/checksums/electron.txt)\n- [build/checksums/nodejs.txt](build/checksums/nodejs.txt)\n- [build/darwin/create-universal-app.ts](build/darwin/create-universal-app.ts)\n- [build/gulpfile.vscode.ts](build/gulpfile.vscode.ts)\n- [build/linux/dependencies-generator.ts](build/linux/dependencies-generator.ts)\n- [build/npm/postinstall.ts](build/npm/postinstall.ts)\n- [build/package.json](build/package.json)\n- [cgmanifest.json](cgmanifest.json)\n- [eslint.config.js](eslint.config.js)\n- [extensions/esbuild-webview-common.mjs](extensions/esbuild-webview-common.mjs)\n- [extensions/package-lock.json](extensions/package-lock.json)\n- [extensions/package.json](extensions/package.json)\n- [package-lock.json](package-lock.json)\n- [package.json](package.json)\n- [remote/.npmrc](remote/.npmrc)\n- [remote/package-lock.json](remote/package-lock.json)\n- [remote/package.json](remote/package.json)\n- [remote/web/package-lock.json](remote/web/package-lock.json)\n- [remote/web/package.json](remote/web/package.json)\n- [src/vs/base/parts/contextmenu/electron-main/contextmenu.ts](src/vs/base/parts/contextmenu/electron-main/contextmenu.ts)\n- [src/vs/platform/environment/test/node/nativeModules.integrationTest.ts](src/vs/platform/environment/test/node/nativeModules.integrationTest.ts)\n\n\u003c/details\u003e\n\n\n\nThis document describes VS Code's build infrastructure, including the multi-package structure, build toolchain, native module compilation, and development workflows. It covers how the codebase is compiled from TypeScript sources into deployable artifacts for Desktop (Electron), Remote (Node.js server), and Web (browser) environments.\n\nFor information about the application lifecycle and initialization after build, see [Application Lifecycle and Bootstrap](#3). For package management details across the workspace, see [Package Structure and Dependencies](#2.1).\n\n---\n\n## Overview\n\nVS Code uses a complex build system that supports three primary deployment targets from a shared codebase. The build process orchestrates TypeScript compilation, native module compilation, bundling, and minification through Gulp tasks. The system handles platform-specific toolchains for native dependencies and maintains strict code quality through ESLint and TypeScript configuration.\n\n**Key Components:**\n- **Build Orchestration**: Gulp tasks coordinate compilation and bundling\n- **Compilation**: TypeScript compiler (`tsgo`/`tsc`) with strict checking\n- **Bundling**: Webpack for most targets, ESBuild for web\n- **Native Modules**: Platform-specific compilation with node-gyp\n- **Code Quality**: ESLint with custom rules and TypeScript strict mode\n\n---\n\n## Build Architecture\n\n```mermaid\ngraph TB\n    subgraph \"Source Code\"\n        TS[\"TypeScript Sources\u003cbr/\u003esrc/**/*.ts\"]\n        EXTENSIONS[\"Extension Sources\u003cbr/\u003eextensions/*\"]\n        BUILD_SCRIPTS[\"Build Scripts\u003cbr/\u003ebuild/**/*.ts\"]\n    end\n    \n    subgraph \"Build Orchestration\"\n        GULP[\"Gulp Tasks\u003cbr/\u003egulpfile.js\"]\n        NPM_SCRIPTS[\"npm Scripts\u003cbr/\u003epackage.json\"]\n        \n        NPM_SCRIPTS --\u003e|\"npm run gulp\"| GULP\n    end\n    \n    subgraph \"Compilation\"\n        TSC[\"TypeScript Compiler\u003cbr/\u003etsgo/tsc\u003cbr/\u003e--project tsconfig.json\"]\n        WEBPACK[\"Webpack\u003cbr/\u003ewebpack.config.js\"]\n        ESBUILD[\"ESBuild\u003cbr/\u003ebuild/package.json\"]\n        \n        GULP --\u003e TSC\n        GULP --\u003e WEBPACK\n        GULP --\u003e ESBUILD\n    end\n    \n    subgraph \"Native Module Build\"\n        NODEGYP[\"node-gyp\u003cbr/\u003ebinding.gyp files\"]\n        TOOLCHAINS[\"Platform Toolchains\u003cbr/\u003eClang, GCC, MSVC\"]\n        SYSROOTS[\"Linux Sysroots\u003cbr/\u003e.build/sysroots/\"]\n        \n        NODEGYP --\u003e TOOLCHAINS\n        TOOLCHAINS --\u003e SYSROOTS\n    end\n    \n    subgraph \"Output Artifacts\"\n        CLIENT_OUT[\"Desktop Bundles\u003cbr/\u003eminify-vscode\"]\n        REMOTE_OUT[\"Remote Server Bundles\u003cbr/\u003eminify-vscode-reh\"]\n        WEB_OUT[\"Web Bundles\u003cbr/\u003eminify-vscode-reh-web\"]\n    end\n    \n    TS --\u003e TSC\n    TS --\u003e WEBPACK\n    TS --\u003e ESBUILD\n    EXTENSIONS --\u003e TSC\n    BUILD_SCRIPTS --\u003e TSC\n    \n    TSC --\u003e CLIENT_OUT\n    WEBPACK --\u003e CLIENT_OUT\n    WEBPACK --\u003e REMOTE_OUT\n    ESBUILD --\u003e WEB_OUT\n    \n    NODEGYP --\u003e CLIENT_OUT\n    NODEGYP --\u003e REMOTE_OUT\n    \n    style GULP fill:#f9f9f9\n    style TSC fill:#e1f5ff\n    style WEBPACK fill:#e1f5ff\n    style ESBUILD fill:#e1f5ff\n```\n\n**Sources:** [package.json:12-72](), [build/package.json:1-82]()\n\n---\n\n## Build Targets and Package Structure\n\nVS Code maintains separate package.json files for different build targets, each with tailored dependencies.\n\n| Package | Location | Purpose | Runtime | Key Dependencies |\n|---------|----------|---------|---------|------------------|\n| `code-oss-dev` | [package.json:1-242]() | Main desktop application | Electron 39.2.7 | Full dependency set including native modules |\n| `vscode-reh` | [remote/package.json:1-50]() | Remote server | Node.js 22.21.1 | Server dependencies, no UI-specific packages |\n| `vscode-web` | [remote/web/package.json:1-27]() | Web workbench | Browser | Browser-compatible dependencies only |\n| `code-oss-dev-build` | [build/package.json:1-82]() | Build tooling | Node.js | esbuild, gulp plugins, build utilities |\n| `vscode-extensions` | [extensions/package.json:1-20]() | Extensions workspace | Shared | TypeScript, esbuild, shared extension deps |\n\n```mermaid\ngraph LR\n    ROOT[\"Root Workspace\u003cbr/\u003epackage.json\u003cbr/\u003ecode-oss-dev\"]\n    \n    REMOTE[\"Remote Package\u003cbr/\u003eremote/package.json\u003cbr/\u003evscode-reh\"]\n    WEB[\"Web Package\u003cbr/\u003eremote/web/package.json\u003cbr/\u003evscode-web\"]\n    BUILD[\"Build Package\u003cbr/\u003ebuild/package.json\u003cbr/\u003ecode-oss-dev-build\"]\n    EXT[\"Extensions Package\u003cbr/\u003eextensions/package.json\u003cbr/\u003evscode-extensions\"]\n    \n    ROOT --\u003e|\"Manages\"| REMOTE\n    ROOT --\u003e|\"Manages\"| WEB\n    ROOT --\u003e|\"Manages\"| BUILD\n    ROOT --\u003e|\"Manages\"| EXT\n    \n    ROOT --\u003e|\"Desktop Build\"| ELECTRON[\"Electron 39.2.7\u003cbr/\u003eFull native modules\"]\n    REMOTE --\u003e|\"Remote Build\"| NODEJS[\"Node.js 22.21.1\u003cbr/\u003eServer native modules\"]\n    WEB --\u003e|\"Web Build\"| BROWSER[\"Browser Runtime\u003cbr/\u003eNo native modules\"]\n```\n\n**Sources:** [package.json:1-242](), [remote/package.json:1-50](), [remote/web/package.json:1-27](), [build/package.json:1-82](), [extensions/package.json:1-20]()\n\n---\n\n## Build Pipeline and npm Scripts\n\nThe build system exposes numerous npm scripts for different build and development tasks.\n\n### Primary Build Scripts\n\n```mermaid\ngraph TB\n    subgraph \"Development Scripts\"\n        COMPILE[\"npm run compile\u003cbr/\u003egulp compile\"]\n        WATCH[\"npm run watch\u003cbr/\u003ewatch-client + watch-extensions\"]\n        WATCH_WEB[\"npm run watch-web\u003cbr/\u003egulp watch-web\"]\n    end\n    \n    subgraph \"Production Build Scripts\"\n        COMPILE_BUILD[\"npm run compile-build\u003cbr/\u003egulp compile-build-with-mangling\"]\n        MINIFY_VSCODE[\"npm run minify-vscode\u003cbr/\u003eDesktop bundles\"]\n        MINIFY_REH[\"npm run minify-vscode-reh\u003cbr/\u003eServer bundles\"]\n        MINIFY_WEB[\"npm run minify-vscode-reh-web\u003cbr/\u003eWeb bundles\"]\n    end\n    \n    subgraph \"Quality Scripts\"\n        ESLINT[\"npm run eslint\u003cbr/\u003ebuild/eslint.ts\"]\n        STYLELINT[\"npm run stylelint\u003cbr/\u003ebuild/stylelint.ts\"]\n        HYGIENE[\"npm run hygiene\u003cbr/\u003egulp hygiene\"]\n        VALID_LAYERS[\"npm run valid-layers-check\u003cbr/\u003ebuild/checker/layersChecker.ts\"]\n    end\n    \n    subgraph \"Test Scripts\"\n        TEST_BROWSER[\"npm run test-browser\u003cbr/\u003eunit/browser/index.js\"]\n        TEST_NODE[\"npm run test-node\u003cbr/\u003emocha unit/node/index.js\"]\n    end\n    \n    COMPILE --\u003e|\"Compiles\"| OUT[\"out/**/*.js\"]\n    WATCH --\u003e|\"Watches and recompiles\"| OUT\n    \n    COMPILE_BUILD --\u003e MINIFY_VSCODE\n    COMPILE_BUILD --\u003e MINIFY_REH\n    COMPILE_BUILD --\u003e MINIFY_WEB\n```\n\n**Key Scripts from [package.json:12-72]():**\n\n- **`compile`**: Runs `gulp compile` to compile TypeScript sources\n- **`compile-check-ts-native`**: Type-checks using `tsgo --noEmit`\n- **`watch`**: Parallel watch of client and extensions\n- **`watch-client`**: Watches and recompiles main client code\n- **`watch-extensions`**: Watches and recompiles extension code\n- **`compile-build`**: Builds with mangling for production\n- **`minify-vscode`**: Produces minified desktop bundles\n- **`minify-vscode-reh`**: Produces minified remote server bundles\n- **`minify-vscode-reh-web`**: Produces minified web bundles\n- **`eslint`**: Runs ESLint checks via [build/eslint.ts]()\n- **`hygiene`**: Runs code hygiene checks\n\n**Sources:** [package.json:12-72]()\n\n---\n\n## Native Module Compilation\n\nVS Code depends on numerous native Node.js modules that require compilation for each platform and architecture. The build system manages this complexity through node-gyp and platform-specific toolchains.\n\n### Native Module Dependencies\n\n**Desktop and Remote Native Modules:**\n\n| Module | Purpose | Binding File |\n|--------|---------|--------------|\n| `node-pty` | PTY/terminal process management | [build/.moduleignore:100-113]() |\n| `@vscode/spdlog` | Fast logging library | [build/.moduleignore:15-21]() |\n| `@vscode/watcher` | File system watching | [build/.moduleignore:115-119]() |\n| `@vscode/windows-process-tree` | Windows process enumeration | [build/.moduleignore:46-51]() |\n| `@vscode/windows-registry` | Windows registry access | [build/.moduleignore:53-56]() |\n| `@vscode/sqlite3` | SQLite database | [build/.moduleignore:32-39]() |\n| `native-keymap` | Keyboard layout detection | [build/.moduleignore:66-70]() |\n| `native-is-elevated` | Admin/elevation detection | [build/.moduleignore:72-76]() |\n| `native-watchdog` | Process watchdog | [build/.moduleignore:78-81]() |\n| `kerberos` | Kerberos authentication | [build/.moduleignore:94-98]() |\n\n**Configuration Files:**\n\n- **Desktop**: [.npmrc:1-7]() configures node-gyp for Electron\n  - `disturl=\"https://electronjs.org/headers\"`\n  - `target=\"39.2.7\"` (Electron version)\n  - `runtime=\"electron\"`\n  \n- **Remote**: [remote/.npmrc:1-7]() configures for Node.js\n  - `disturl=\"https://nodejs.org/dist\"`\n  - `target=\"22.21.1\"` (Node.js version)\n  - `runtime=\"node\"`\n\n```mermaid\ngraph TB\n    subgraph \"Native Module Sources\"\n        NATIVE_MODULES[\"Native Modules\u003cbr/\u003enode-pty, @vscode/spdlog,\u003cbr/\u003e@vscode/watcher, etc.\"]\n        BINDING_GYP[\"binding.gyp files\u003cbr/\u003eModule-specific\"]\n    end\n    \n    subgraph \"Build Configuration\"\n        NPMRC_DESKTOP[\".npmrc\u003cbr/\u003eElectron 39.2.7\u003cbr/\u003eruntime=electron\"]\n        NPMRC_REMOTE[\"remote/.npmrc\u003cbr/\u003eNode.js 22.21.1\u003cbr/\u003eruntime=node\"]\n        MODULEIGNORE[\"build/.moduleignore\u003cbr/\u003eCleanup rules\"]\n    end\n    \n    subgraph \"Platform Toolchains\"\n        CLANG[\"Clang Toolchain\u003cbr/\u003ex64 client builds\u003cbr/\u003e.build/CR_Clang\"]\n        GCC[\"GCC Toolchain\u003cbr/\u003eremote, arm64 builds\"]\n        MSVC[\"MSVC\u003cbr/\u003eWindows builds\"]\n    end\n    \n    subgraph \"Linux-Specific\"\n        CLIENT_SYSROOT[\"Client Sysroot\u003cbr/\u003eglibc-2.28-gcc-10.5.0\u003cbr/\u003e.build/sysroots/\"]\n        REMOTE_SYSROOT[\"Remote Sysroot\u003cbr/\u003eglibc-2.28-gcc-8.5.0\u003cbr/\u003e.build/sysroots/\"]\n        LIBCXX[\"libcxx Objects\u003cbr/\u003e.build/libcxx-objects\"]\n    end\n    \n    NATIVE_MODULES --\u003e BINDING_GYP\n    \n    NPMRC_DESKTOP --\u003e CLANG\n    NPMRC_REMOTE --\u003e GCC\n    \n    BINDING_GYP --\u003e|\"node-gyp rebuild\"| CLANG\n    BINDING_GYP --\u003e|\"node-gyp rebuild\"| GCC\n    BINDING_GYP --\u003e|\"node-gyp rebuild\"| MSVC\n    \n    CLANG --\u003e CLIENT_SYSROOT\n    CLANG --\u003e LIBCXX\n    GCC --\u003e REMOTE_SYSROOT\n    \n    CLANG --\u003e DESKTOP_OUT[\"Desktop Artifacts\u003cbr/\u003e*.node files\"]\n    GCC --\u003e REMOTE_OUT_NATIVE[\"Remote Artifacts\u003cbr/\u003e*.node files\"]\n    MSVC --\u003e WIN_OUT[\"Windows Artifacts\u003cbr/\u003e*.node files\"]\n    \n    MODULEIGNORE -.filters.-\u003e DESKTOP_OUT\n    MODULEIGNORE -.filters.-\u003e REMOTE_OUT_NATIVE\n```\n\n**Sources:** [.npmrc:1-7](), [remote/.npmrc:1-7](), [build/.moduleignore:1-191]()\n\n---\n\n## Linux Build Environment Setup\n\nFor Linux builds, the system downloads and configures platform-specific toolchains and sysroots to ensure compatibility with older glibc versions.\n\n**From [build/azure-pipelines/linux/setup-env.sh:1-60]():**\n\n### Sysroot Configuration\n\n```bash\n# Client builds use newer toolchain\nVSCODE_CLIENT_SYSROOT_DIR=$PWD/.build/sysroots/glibc-2.28-gcc-10.5.0\n\n# Remote builds use older toolchain for compatibility\nVSCODE_REMOTE_SYSROOT_DIR=$PWD/.build/sysroots/glibc-2.28-gcc-8.5.0\n```\n\n### Clang Toolchain (x64 Desktop)\n\nThe desktop x64 build uses Clang from Chromium:\n\n```bash\n# Download clang based on chromium revision\ncurl -s https://raw.githubusercontent.com/chromium/chromium/142.0.7444.235/tools/clang/scripts/update.py | \\\n  python - --output-dir=$PWD/.build/CR_Clang --host-os=linux\n```\n\n### Compiler Flags\n\n**For x64 client builds (from [build/azure-pipelines/linux/setup-env.sh:43-46]()):**\n\n- `CC`: Clang with GCC toolchain from client sysroot\n- `CXX`: Clang++ with libc++ headers\n- `CXXFLAGS`: \n  - `-nostdinc++` - Don't use system C++ headers\n  - `-DSPDLOG_USE_STD_FORMAT` - Use std::format\n  - `-I$PWD/.build/libcxx_headers` - Custom libc++ headers\n  - `--sysroot=...` - Use client sysroot\n- `LDFLAGS`:\n  - `-stdlib=libc++` - Link with libc++\n  - `-fuse-ld=lld` - Use LLVM linker\n  - `-flto=thin` - Thin LTO for optimization\n\n**For ARM64 and remote builds:**\n- Uses GCC 8.5.0 from remote sysroot\n- Standard glibc 2.28 compatibility\n\n**Sources:** [build/azure-pipelines/linux/setup-env.sh:1-60]()\n\n---\n\n## Dependency Management and Verification\n\nThe build system includes mechanisms to track and verify native dependencies across platforms.\n\n**Native Module Testing ([src/vs/platform/environment/test/node/nativeModules.integrationTest.ts:1-141]()):**\n\nThe test suite verifies all native modules load correctly:\n\n```typescript\ntest('node-pty', async () =\u003e {\n  const nodePty = await import('node-pty');\n  assert.ok(typeof nodePty.spawn === 'function', testErrorMessage('node-pty'));\n});\n\ntest('@vscode/spdlog', async () =\u003e {\n  const spdlog = await import('@vscode/spdlog');\n  assert.ok(typeof spdlog.createRotatingLogger === 'function', ...);\n  assert.ok(typeof spdlog.version === 'number', ...);\n});\n```\n\n**Linux Dependency Generation ([build/linux/dependencies-generator.ts:1-99]()):**\n\nThe system automatically generates package dependencies for `.deb` and `.rpm` packages:\n\n```typescript\nexport async function getDependencies(\n  packageType: 'deb' | 'rpm',\n  buildDir: string,\n  applicationName: string,\n  arch: string\n): Promise\u003cstring[]\u003e\n```\n\nKey logic:\n1. Finds all `.node` files in `node_modules.asar.unpacked`\n2. Adds main executable and helper binaries\n3. Uses platform-specific tools (`dpkg-shlibdeps` for Debian, `ldd`/`rpm` for RPM)\n4. Filters bundled dependencies (libEGL, libGLESv2, libvulkan, libffmpeg)\n5. Compares against reference dependency lists\n6. Fails build if unexpected new dependencies appear (when `FAIL_BUILD_FOR_NEW_DEPENDENCIES` is true)\n\n**Sources:** [src/vs/platform/environment/test/node/nativeModules.integrationTest.ts:1-141](), [build/linux/dependencies-generator.ts:1-99]()\n\n---\n\n## Code Quality and Linting\n\n### ESLint Configuration\n\nThe build system enforces strict code quality through ESLint with custom rules.\n\n**Configuration ([eslint.config.js:1-617]()):**\n\n```javascript\nexport default tseslint.config(\n  // Global ignores from .eslint-ignore\n  { ignores: [...] },\n  \n  // All files (JS and TS)\n  {\n    plugins: {\n      'local': pluginLocal,\n      'header': pluginHeader,\n    },\n    rules: {\n      'local/code-layering': ['warn', { /* layer definitions */ }],\n      'local/code-no-unexternalized-strings': 'warn',\n      'local/code-no-potentially-unsafe-disposables': 'warn',\n      // ... more custom rules\n    }\n  }\n)\n```\n\n### Custom ESLint Rules\n\nKey custom rules from [eslint.config.js:39-130]():\n\n| Rule | Purpose |\n|------|---------|\n| `local/code-layering` | Enforces architectural layer boundaries (common, node, browser, electron-browser, electron-utility, electron-main) |\n| `local/code-no-unexternalized-strings` | Ensures strings are externalized for localization |\n| `local/code-no-potentially-unsafe-disposables` | Prevents resource leaks |\n| `local/code-translation-remind` | Reminds about translation requirements |\n| `local/code-must-use-super-dispose` | Ensures proper disposal chain |\n| `local/code-declare-service-brand` | Enforces service branding pattern |\n| `local/code-no-deep-import-of-internal` | Prevents importing internal APIs |\n\n### Layer Enforcement\n\nThe `code-layering` rule enforces dependency directions:\n\n```javascript\n'local/code-layering': [\n  'warn',\n  {\n    'common': [],\n    'node': ['common'],\n    'browser': ['common'],\n    'electron-browser': ['common', 'browser'],\n    'electron-utility': ['common', 'node'],\n    'electron-main': ['common', 'node', 'electron-utility']\n  }\n]\n```\n\nThis ensures:\n- `common` has no platform dependencies\n- `browser` and `node` only depend on `common`\n- `electron-browser` combines common + browser\n- `electron-main` is the top layer\n\n**Sources:** [eslint.config.js:1-617]()\n\n---\n\n## TypeScript Configuration\n\nVS Code uses multiple TypeScript configurations for different purposes:\n\n### Primary Configurations\n\n| Config File | Purpose | Key Settings |\n|------------|---------|--------------|\n| `src/tsconfig.json` | Main source compilation | `strictNullChecks: true`, `noImplicitAny: true` |\n| `src/tsconfig.monaco.json` | Monaco editor API surface | Validates monaco.d.ts |\n| `src/tsconfig.vscode-dts.json` | Extension API validation | Validates vscode.d.ts |\n| `build/checker/tsconfig.*.json` | Layer checking | Separate configs per layer |\n\n### Compilation Process\n\nFrom [package.json:22]():\n```bash\nnpm run compile-check-ts-native\n# Runs: tsgo --project ./src/tsconfig.json --noEmit --skipLibCheck\n```\n\n**Layer Validation ([package.json:50]()):**\n```bash\nnpm run valid-layers-check\n# Compiles with separate configs for each layer:\n#   - tsconfig.browser.json\n#   - tsconfig.worker.json\n#   - tsconfig.node.json\n#   - tsconfig.electron-browser.json\n#   - tsconfig.electron-main.json\n#   - tsconfig.electron-utility.json\n```\n\n**Sources:** [package.json:22](), [package.json:50]()\n\n---\n\n## Development Workflow\n\n### Watch Mode\n\nFor active development, the watch mode provides incremental compilation:\n\n```bash\n# Watch everything (client + extensions)\nnpm run watch\n\n# Watch only client\nnpm run watch-client\n\n# Watch only extensions\nnpm run watch-extensions\n\n# Watch web target\nnpm run watch-web\n```\n\nThe watch scripts use `npm-run-all` to run multiple watchers in parallel ([package.json:23]()).\n\n### Daemon Mode\n\nThe build system supports daemon mode using `deemon` for persistent background processes:\n\n```bash\n# Start watch daemon\nnpm run watchd\n\n# Kill watch daemon\nnpm run kill-watchd\n\n# Restart watch daemon\nnpm run restart-watchd\n```\n\n### Testing\n\nDifferent test suites for different environments:\n\n```bash\n# Browser tests (uses Playwright)\nnpm run test-browser\n\n# Node.js tests (uses Mocha)\nnpm run test-node\n\n# Extension tests\nnpm run test-extension\n```\n\n**Sources:** [package.json:23-35](), [package.json:14-17]()\n\n---\n\n## Bundling and Minification\n\n### Desktop Build (Electron)\n\n```mermaid\ngraph LR\n    SOURCE[\"TypeScript Sources\u003cbr/\u003esrc/**/*.ts\"]\n    COMPILE[\"TypeScript Compiler\u003cbr/\u003etsgo\"]\n    WEBPACK_CLIENT[\"Webpack\u003cbr/\u003eClient bundles\"]\n    NATIVE[\"Native Modules\u003cbr/\u003e*.node\"]\n    MINIFY[\"Gulp Minification\u003cbr/\u003eminify-vscode\"]\n    OUTPUT[\"Output Directory\u003cbr/\u003eVSCode-darwin-x64/\u003cbr/\u003eVSCode-win32-x64/\u003cbr/\u003eVSCode-linux-x64/\"]\n    \n    SOURCE --\u003e COMPILE\n    COMPILE --\u003e WEBPACK_CLIENT\n    WEBPACK_CLIENT --\u003e MINIFY\n    NATIVE --\u003e MINIFY\n    MINIFY --\u003e OUTPUT\n```\n\n### Remote Build (Node.js Server)\n\n```mermaid\ngraph LR\n    SOURCE_REMOTE[\"TypeScript Sources\u003cbr/\u003esrc/**/*.ts\u003cbr/\u003e(server-only)\"]\n    COMPILE_REMOTE[\"TypeScript Compiler\"]\n    WEBPACK_REMOTE[\"Webpack\u003cbr/\u003eServer bundles\"]\n    NATIVE_REMOTE[\"Native Modules\u003cbr/\u003e*.node\u003cbr/\u003e(server-compatible)\"]\n    MINIFY_REMOTE[\"Gulp Minification\u003cbr/\u003eminify-vscode-reh\"]\n    OUTPUT_REMOTE[\"Output Directory\u003cbr/\u003evscode-reh-darwin/\u003cbr/\u003evscode-reh-linux/\"]\n    \n    SOURCE_REMOTE --\u003e COMPILE_REMOTE\n    COMPILE_REMOTE --\u003e WEBPACK_REMOTE\n    WEBPACK_REMOTE --\u003e MINIFY_REMOTE\n    NATIVE_REMOTE --\u003e MINIFY_REMOTE\n    MINIFY_REMOTE --\u003e OUTPUT_REMOTE\n```\n\n### Web Build (Browser)\n\n```mermaid\ngraph LR\n    SOURCE_WEB[\"TypeScript Sources\u003cbr/\u003esrc/**/*.ts\u003cbr/\u003e(browser-compatible)\"]\n    COMPILE_WEB[\"TypeScript Compiler\"]\n    ESBUILD_WEB[\"ESBuild\u003cbr/\u003eFast web bundling\"]\n    MINIFY_WEB[\"Gulp Minification\u003cbr/\u003eminify-vscode-reh-web\"]\n    OUTPUT_WEB[\"Output Directory\u003cbr/\u003evscode-reh-web/\"]\n    \n    SOURCE_WEB --\u003e COMPILE_WEB\n    COMPILE_WEB --\u003e ESBUILD_WEB\n    ESBUILD_WEB --\u003e MINIFY_WEB\n    MINIFY_WEB --\u003e OUTPUT_WEB\n    \n    note[\"Note: No native modules\u003cbr/\u003eBrowser APIs only\"]\n    MINIFY_WEB -.-\u003e note\n```\n\n**Key Differences:**\n- **Desktop**: Full native module support, Electron APIs, webpack bundling\n- **Remote**: Server-side native modules only (no UI), Node.js APIs, webpack bundling\n- **Web**: No native modules, browser APIs only, ESBuild for faster builds\n\n**Sources:** [package.json:63-65](), [build/package.json:50]()\n\n---\n\n## Module Cleanup and Optimization\n\nThe build system includes extensive module cleanup rules to reduce bundle size.\n\n**[build/.moduleignore:1-191]()** - Removes unnecessary files from node_modules:\n\n```\n# Cleanup patterns\n**/docs/**\n**/test/**\n**/examples/**\n**/*.md\n**/*.ts\n**/*.d.ts\n**/*.js.map\n\n# Keep only required native binaries\n!@vscode/spdlog/build/Release/*.node\n!node-pty/build/Release/*.node\n```\n\n**[build/.webignore:1-65]()** - Additional cleanup for web bundles:\n\n```\n# Web-specific cleanup\n**/*.txt\n**/*.json\n**/*.md\n**/*.d.ts\n\n# Keep only required assets\n!@vscode/vscode-languagedetection/model/**\n!@vscode/tree-sitter-wasm/wasm/**\n```\n\nThis ensures:\n- Source files are removed from production bundles\n- Only compiled artifacts are included\n- Native binaries are preserved\n- Test and documentation files are excluded\n\n**Sources:** [build/.moduleignore:1-191](), [build/.webignore:1-65]()\n\n---\n\n## XTerm.js Integration\n\nVS Code bundles multiple XTerm.js addons, managed through a centralized importer.\n\n**From [src/vs/workbench/contrib/terminal/browser/xterm/xtermAddonImporter.ts:1-61]():**\n\n```typescript\nexport interface IXtermAddonNameToCtor {\n  clipboard: typeof ClipboardAddonType;\n  image: typeof ImageAddonType;\n  ligatures: typeof LigaturesAddonType;\n  progress: typeof ProgressAddonType;\n  search: typeof SearchAddonType;\n  serialize: typeof SerializeAddonType;\n  unicode11: typeof Unicode11AddonType;\n  webgl: typeof WebglAddonType;\n}\n\nexport class XtermAddonImporter {\n  async importAddon\u003cT extends keyof IXtermAddonNameToCtor\u003e(name: T): \n    Promise\u003cIXtermAddonNameToCtor[T]\u003e {\n    // Dynamic imports with caching\n  }\n}\n```\n\n**Update Script ([scripts/xterm-update.js:1-102]()):**\n\nThe script synchronizes XTerm.js versions across all package.json files:\n\n1. Fetches latest versions from npm\n2. Updates dependencies in:\n   - Root `package.json`\n   - `remote/package.json`\n   - `remote/web/package.json`\n3. Runs `npm install` in each location\n\n**Sources:** [src/vs/workbench/contrib/terminal/browser/xterm/xtermAddonImporter.ts:1-61](), [scripts/xterm-update.js:1-102](), [package.json:92-101]()\n\n---\n\n## CI/CD Build Configuration\n\n### Electron and Node.js Versions\n\n**Electron ([build/checksums/electron.txt:1-76]()):**\n- Version: 39.2.7\n- Chromium: 142.0.7444.235\n- Prebuilt binaries for all platforms (darwin, linux, win32) and architectures (x64, arm64, ia32)\n\n**Node.js ([build/checksums/nodejs.txt:1-8]()):**\n- Version: 22.21.1\n- Specified in [.nvmrc:1](): `22.21.1`\n- Prebuilt binaries for darwin-arm64, darwin-x64, linux-arm64, linux-armv7l, linux-x64, win-arm64, win-x64\n\n### Chromium Component\n\nThe build references specific Chromium components ([cgmanifest.json:1-43]()):\n\n```json\n{\n  \"component\": {\n    \"type\": \"git\",\n    \"git\": {\n      \"name\": \"chromium\",\n      \"repositoryUrl\": \"https://chromium.googlesource.com/chromium/src\",\n      \"commitHash\": \"4d74005947d2522c31942de3d609355124455643\"\n    }\n  },\n  \"version\": \"142.0.7444.235\"\n}\n```\n\n**Sources:** [build/checksums/electron.txt:1-76](), [build/checksums/nodejs.txt:1-8](), [.nvmrc:1](), [cgmanifest.json:1-43]()"])</script><script>self.__next_f.push([1,"19:T4791,"])</script><script>self.__next_f.push([1,"# Package Structure and Dependencies\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [.npmrc](.npmrc)\n- [.nvmrc](.nvmrc)\n- [build/.moduleignore](build/.moduleignore)\n- [build/.webignore](build/.webignore)\n- [build/azure-pipelines/linux/setup-env.sh](build/azure-pipelines/linux/setup-env.sh)\n- [build/azure-pipelines/linux/verify-glibc-requirements.sh](build/azure-pipelines/linux/verify-glibc-requirements.sh)\n- [build/checksums/electron.txt](build/checksums/electron.txt)\n- [build/checksums/nodejs.txt](build/checksums/nodejs.txt)\n- [build/darwin/create-universal-app.ts](build/darwin/create-universal-app.ts)\n- [build/gulpfile.vscode.ts](build/gulpfile.vscode.ts)\n- [build/linux/dependencies-generator.ts](build/linux/dependencies-generator.ts)\n- [build/npm/postinstall.ts](build/npm/postinstall.ts)\n- [build/package.json](build/package.json)\n- [cgmanifest.json](cgmanifest.json)\n- [eslint.config.js](eslint.config.js)\n- [extensions/esbuild-webview-common.mjs](extensions/esbuild-webview-common.mjs)\n- [extensions/package-lock.json](extensions/package-lock.json)\n- [extensions/package.json](extensions/package.json)\n- [package-lock.json](package-lock.json)\n- [package.json](package.json)\n- [remote/.npmrc](remote/.npmrc)\n- [remote/package-lock.json](remote/package-lock.json)\n- [remote/package.json](remote/package.json)\n- [remote/web/package-lock.json](remote/web/package-lock.json)\n- [remote/web/package.json](remote/web/package.json)\n- [src/vs/base/parts/contextmenu/electron-main/contextmenu.ts](src/vs/base/parts/contextmenu/electron-main/contextmenu.ts)\n- [src/vs/platform/environment/test/node/nativeModules.integrationTest.ts](src/vs/platform/environment/test/node/nativeModules.integrationTest.ts)\n\n\u003c/details\u003e\n\n\n\nThis document describes the package structure and dependency management system in VS Code, including the multiple `package.json` files, Yarn-based dependency resolution, and the postinstall script workflow that compiles native modules.\n\nFor information about native module compilation and cross-platform builds, see [Native Modules and Cross-Platform Builds](#2.2). For information about build tasks, see [Build Tasks and Scripts](#2.3).\n\n## Package Hierarchy Overview\n\nVS Code uses a multi-package structure with separate `package.json` files for different contexts. Each package has its own dependency tree and runtime requirements.\n\n### Package.json Files\n\n```mermaid\ngraph TD\n    Root[\"package.json\u003cbr/\u003e(code-oss-dev)\u003cbr/\u003eRoot package\"]\n    Remote[\"remote/package.json\u003cbr/\u003e(vscode-reh)\u003cbr/\u003eNode.js server\"]\n    RemoteWeb[\"remote/web/package.json\u003cbr/\u003e(vscode-web)\u003cbr/\u003eWeb client\"]\n    Build[\"build/package.json\u003cbr/\u003e(code-oss-dev-build)\u003cbr/\u003eBuild tools\"]\n    Extensions[\"extensions/package.json\u003cbr/\u003e(vscode-extensions)\u003cbr/\u003eExtension dependencies\"]\n    \n    Root --\u003e Remote\n    Root --\u003e RemoteWeb\n    Root --\u003e Build\n    Root --\u003e Extensions\n    \n    Root -.-\u003e|\"preinstall\u003cbr/\u003epostinstall\"| InstallScripts[\"build/npm/preinstall.ts\u003cbr/\u003ebuild/npm/postinstall.ts\"]\n```\n\n**Sources:** [package.json:1-243](), [remote/package.json:1-50](), [remote/web/package.json:1-27](), [build/package.json:1-82](), [extensions/package.json:1-20]()\n\n| Package | Name | Purpose | Runtime |\n|---------|------|---------|---------|\n| Root | `code-oss-dev` | Main Electron application | Electron 39.2.7 |\n| Remote | `vscode-reh` | Remote extension host server | Node.js 22.21.1 |\n| Remote Web | `vscode-web` | Web workbench client | Browser |\n| Build | `code-oss-dev-build` | Build and packaging tools | Node.js |\n| Extensions | `vscode-extensions` | Shared extension dependencies | N/A |\n\n**Sources:** [package.json:2-3,10,164](), [remote/package.json:2-3](), [remote/web/package.json:2-3](), [build/package.json:2-3](), [extensions/package.json:2-3]()\n\n## Dependency Management with Yarn\n\nVS Code uses Yarn for dependency management with lock files ensuring deterministic installs across different environments.\n\n### Lock Files and Resolution\n\n```mermaid\ngraph LR\n    subgraph \"Root Project\"\n        RootPkg[\"package.json\u003cbr/\u003eDependencies\u003cbr/\u003eDevDependencies\"]\n        YarnLock[\"yarn.lock\u003cbr/\u003eLocked versions\"]\n        PackageLock[\"package-lock.json\u003cbr/\u003eNPM fallback\"]\n    end\n    \n    subgraph \"Remote Package\"\n        RemotePkg[\"remote/package.json\"]\n        RemoteLock[\"remote/package-lock.json\"]\n    end\n    \n    subgraph \"Web Package\"\n        WebPkg[\"remote/web/package.json\"]\n        WebLock[\"remote/web/package-lock.json\"]\n    end\n    \n    subgraph \"Extensions\"\n        ExtPkg[\"extensions/package.json\"]\n        ExtLock[\"extensions/package-lock.json\"]\n    end\n    \n    RootPkg --\u003e YarnLock\n    RootPkg --\u003e PackageLock\n    RemotePkg --\u003e RemoteLock\n    WebPkg --\u003e WebLock\n    ExtPkg --\u003e ExtLock\n```\n\n**Sources:** [package.json:1](), [package-lock.json:1-4](), [remote/package-lock.json:1-4](), [remote/web/package-lock.json:1-4](), [extensions/package-lock.json:1-4]()\n\n### Dependency Overrides\n\nThe root `package.json` uses overrides to enforce specific versions of transitive dependencies:\n\n```json\n\"overrides\": {\n  \"node-gyp-build\": \"4.8.1\",\n  \"kerberos@2.1.1\": {\n    \"node-addon-api\": \"7.1.0\"\n  }\n}\n```\n\n**Sources:** [package.json:227-232](), [remote/package.json:44-49]()\n\nThese overrides ensure:\n- Consistent `node-gyp-build` version across all native modules\n- Compatible `node-addon-api` version for the `kerberos` native module\n\n## NPM Configuration for Different Runtimes\n\nDifferent `.npmrc` files configure npm for compiling native modules against different runtimes.\n\n### Root .npmrc (Electron)\n\n```\ndisturl=\"https://electronjs.org/headers\"\ntarget=\"39.2.7\"\nms_build_id=\"13098910\"\nruntime=\"electron\"\nbuild_from_source=\"true\"\nlegacy-peer-deps=\"true\"\ntimeout=180000\n```\n\nThis configuration tells `node-gyp` to compile native modules against Electron 39.2.7 headers.\n\n**Sources:** [.npmrc:1-7]()\n\n### Remote .npmrc (Node.js)\n\n```\ndisturl=\"https://nodejs.org/dist\"\ntarget=\"22.21.1\"\nms_build_id=\"374314\"\nruntime=\"node\"\nbuild_from_source=\"true\"\nlegacy-peer-deps=\"true\"\ntimeout=180000\n```\n\nThis configuration tells `node-gyp` to compile native modules against Node.js 22.21.1 headers.\n\n**Sources:** [remote/.npmrc:1-7]()\n\n### Runtime Configuration Diagram\n\n```mermaid\ngraph TD\n    RootNpmrc[\".npmrc\u003cbr/\u003eruntime=electron\u003cbr/\u003etarget=39.2.7\"]\n    RemoteNpmrc[\"remote/.npmrc\u003cbr/\u003eruntime=node\u003cbr/\u003etarget=22.21.1\"]\n    \n    RootNpmrc --\u003e ElectronHeaders[\"Electron Headers\u003cbr/\u003eelectronjs.org/headers\u003cbr/\u003ev39.2.7\"]\n    RemoteNpmrc --\u003e NodeHeaders[\"Node.js Headers\u003cbr/\u003enodejs.org/dist\u003cbr/\u003ev22.21.1\"]\n    \n    ElectronHeaders --\u003e NativeModsElectron[\"Native Modules\u003cbr/\u003e*.node files\u003cbr/\u003e(Electron ABI)\"]\n    NodeHeaders --\u003e NativeModsNode[\"Native Modules\u003cbr/\u003e*.node files\u003cbr/\u003e(Node.js ABI)\"]\n    \n    NativeModsElectron --\u003e MainProcess[\"Main Process\u003cbr/\u003eExtension Host\"]\n    NativeModsNode --\u003e RemoteServer[\"Remote Server\u003cbr/\u003evscode-reh\"]\n```\n\n**Sources:** [.npmrc:1-7](), [remote/.npmrc:1-7]()\n\n## Core Dependencies\n\n### Production Dependencies\n\nThe root `package.json` contains production dependencies that ship with the application:\n\n**Key Native Modules:**\n- `@vscode/spdlog` (0.15.2) - Logging\n- `@vscode/sqlite3` (5.1.11-vscode) - Database\n- `@vscode/windows-registry` (1.1.0) - Windows registry access\n- `@vscode/windows-process-tree` (0.6.0) - Process management\n- `@parcel/watcher` (2.5.4) - File system watching\n- `node-pty` (1.2.0-beta.6) - Terminal PTY\n- `kerberos` (2.1.1) - Authentication\n- `native-keymap` (3.3.5) - Keyboard layout detection\n- `native-is-elevated` (0.8.0) - Privilege detection\n\n**Key JavaScript Libraries:**\n- `@xterm/xterm` (6.1.0-beta.102) - Terminal emulator\n- `katex` (0.16.22) - Math rendering\n- `vscode-textmate` (9.3.1) - TextMate grammar support\n- `vscode-oniguruma` (1.7.0) - Regular expression engine\n\n**Sources:** [package.json:75-122]()\n\n### Development Dependencies\n\nDevelopment dependencies include build tools and testing frameworks:\n\n- `electron` (39.2.7) - Electron runtime for development\n- `typescript` (6.0.0-dev.20251110) - TypeScript compiler\n- `eslint` (9.36.0) - Linting\n- `webpack` (5.94.0) - Bundling\n- `gulp` (4.0.0) - Task runner\n- `mocha` (10.8.2) - Testing framework\n\n**Sources:** [package.json:123-226]()\n\n### Optional Dependencies\n\n```json\n\"optionalDependencies\": {\n  \"windows-foreground-love\": \"0.5.0\"\n}\n```\n\nThe `windows-foreground-love` module is Windows-specific and won't fail installation on other platforms.\n\n**Sources:** [package.json:240-242]()\n\n## Postinstall Script Workflow\n\nThe postinstall script orchestrates dependency installation across multiple directories and compiles native modules.\n\n### Postinstall Execution Flow\n\n```mermaid\ngraph TD\n    Start[\"npm install\u003cbr/\u003e(root)\"]\n    Preinstall[\"preinstall.ts\u003cbr/\u003ePre-installation checks\"]\n    RootInstall[\"Install root\u003cbr/\u003edependencies\"]\n    Postinstall[\"postinstall.ts\u003cbr/\u003emain()\"]\n    \n    Start --\u003e Preinstall\n    Preinstall --\u003e RootInstall\n    RootInstall --\u003e Postinstall\n    \n    Postinstall --\u003e Remote[\"npmInstall()\u003cbr/\u003eremote/\"]\n    Postinstall --\u003e RemoteWeb[\"npmInstall()\u003cbr/\u003eremote/web/\"]\n    Postinstall --\u003e Build[\"npmInstall()\u003cbr/\u003ebuild/\"]\n    Postinstall --\u003e Extensions[\"npmInstall()\u003cbr/\u003eextensions/\"]\n    Postinstall --\u003e TestSmoke[\"npmInstall()\u003cbr/\u003etest/smoke/\"]\n    Postinstall --\u003e TestInt[\"npmInstall()\u003cbr/\u003etest/integration/browser/\"]\n    \n    Remote --\u003e CompileNative[\"Compile Native Modules\u003cbr/\u003enode-gyp rebuild\"]\n    RemoteWeb --\u003e End[\"Installation Complete\"]\n    Build --\u003e End\n    Extensions --\u003e ExtPostinstall[\"extensions/postinstall.mjs\"]\n    TestSmoke --\u003e End\n    TestInt --\u003e End\n    CompileNative --\u003e End\n    ExtPostinstall --\u003e End\n```\n\n**Sources:** [package.json:19-20](), [build/npm/postinstall.ts:1-139]()\n\n### Key Functions in postinstall.ts\n\n**`npmInstall(dir, opts)`** - Runs npm install in a specific directory:\n\n```typescript\nfunction npmInstall(dir: string, opts?: child_process.SpawnSyncOptions) {\n    opts = {\n        env: { ...process.env },\n        ...(opts ?? {}),\n        cwd: dir,\n        stdio: 'inherit',\n        shell: true\n    };\n    \n    const command = process.env['npm_command'] || 'install';\n    // ...runs npm command\n}\n```\n\n**Sources:** [build/npm/postinstall.ts:37-60]()\n\n**Installation Order:**\n\n1. Root dependencies (automatic via npm)\n2. `remote/` - Server dependencies\n3. `remote/web/` - Web client dependencies  \n4. `build/` - Build tool dependencies\n5. `extensions/` - Extension dependencies\n6. Test directories - Test runner dependencies\n\n**Sources:** [build/npm/postinstall.ts:123-139]()\n\n### Conditional Installation\n\nThe postinstall script includes logic for container-based builds:\n\n```typescript\nif (process.env['VSCODE_REMOTE_DEPENDENCIES_CONTAINER_NAME'] \u0026\u0026 \n    /^(.build\\/distro\\/npm\\/)?remote$/.test(dir)) {\n    // Install inside Docker container\n    run('docker', [\n        'exec', '-i', '-w', '/root/vscode', \n        process.env['VSCODE_REMOTE_DEPENDENCIES_CONTAINER_NAME'], \n        'sh', '-c', `\\\"npm ci\\\"`\n    ], opts);\n}\n```\n\n**Sources:** [build/npm/postinstall.ts:48-66]()\n\n## Native Module Compilation\n\nNative modules are compiled during postinstall using `node-gyp`. The compilation process varies by platform and target runtime.\n\n### Native Module List\n\nThe following native modules are compiled from source:\n\n```mermaid\ngraph LR\n    subgraph \"Core Native Modules\"\n        Spdlog[\"@vscode/spdlog\u003cbr/\u003eLogging (C++)\"]\n        Sqlite[\"@vscode/sqlite3\u003cbr/\u003eDatabase (C++)\"]\n        Pty[\"node-pty\u003cbr/\u003eTerminal PTY (C++)\"]\n        Watcher[\"@parcel/watcher\u003cbr/\u003eFile watching (C++)\"]\n    end\n    \n    subgraph \"Platform-Specific\"\n        WinReg[\"@vscode/windows-registry\u003cbr/\u003eWindows only\"]\n        WinProc[\"@vscode/windows-process-tree\u003cbr/\u003eWindows only\"]\n        WinMutex[\"@vscode/windows-mutex\u003cbr/\u003eWindows only\"]\n        WinCA[\"@vscode/windows-ca-certs\u003cbr/\u003eWindows only\"]\n        WinFG[\"windows-foreground-love\u003cbr/\u003eWindows only (optional)\"]\n    end\n    \n    subgraph \"Cross-Platform\"\n        Keymap[\"native-keymap\u003cbr/\u003eKeyboard layouts\"]\n        Elevated[\"native-is-elevated\u003cbr/\u003ePrivilege detection\"]\n        DeviceId[\"@vscode/deviceid\u003cbr/\u003eDevice identification\"]\n        Watchdog[\"@vscode/native-watchdog\u003cbr/\u003eProcess monitoring\"]\n        Kerberos[\"kerberos\u003cbr/\u003eAuthentication\"]\n    end\n```\n\n**Sources:** [package.json:75-93](), [package.json:240-241]()\n\n### Module Ignore Patterns\n\nThe build process uses `.moduleignore` to exclude unnecessary files from native modules:\n\n```\n# Native module cleanup patterns\n@vscode/spdlog/binding.gyp\n@vscode/spdlog/build/**\n@vscode/spdlog/deps/**\n@vscode/spdlog/src/**\n!@vscode/spdlog/build/Release/*.node\n\nnode-pty/binding.gyp\nnode-pty/build/**\nnode-pty/src/**\n!node-pty/build/Release/*.node\n!node-pty/build/Release/spawn-helper\n```\n\nThis ensures only compiled `.node` files and necessary executables are included in the final package.\n\n**Sources:** [build/.moduleignore:1-191]()\n\n### Verification of Native Modules\n\nThe codebase includes integration tests to verify native modules load correctly:\n\n```typescript\ntest('native-keymap', async () =\u003e {\n    const keyMap = await import('native-keymap');\n    assert.ok(typeof keyMap.getCurrentKeyboardLayout === 'function', \n              testErrorMessage('native-keymap'));\n});\n\ntest('node-pty', async () =\u003e {\n    const nodePty = await import('node-pty');\n    assert.ok(typeof nodePty.spawn === 'function', \n              testErrorMessage('node-pty'));\n});\n```\n\n**Sources:** [src/vs/platform/environment/test/node/nativeModules.integrationTest.ts:43-71]()\n\n## Dependency Categories by Package\n\n### Root Package Categories\n\nThe root package dependencies are organized by purpose:\n\n```mermaid\ngraph TD\n    RootDeps[\"Root Dependencies\u003cbr/\u003e(package.json)\"]\n    \n    RootDeps --\u003e Native[\"Native Modules\u003cbr/\u003ePlatform integration\"]\n    RootDeps --\u003e UI[\"UI Libraries\u003cbr/\u003eTerminal, rendering\"]\n    RootDeps --\u003e Utility[\"Utility Libraries\u003cbr/\u003eParsing, encoding\"]\n    RootDeps --\u003e Telemetry[\"Telemetry\u003cbr/\u003e@microsoft/1ds-*\"]\n    \n    Native --\u003e NativeList[\"@vscode/spdlog\u003cbr/\u003e@vscode/sqlite3\u003cbr/\u003enode-pty\u003cbr/\u003e@parcel/watcher\u003cbr/\u003ekerberos\u003cbr/\u003enative-keymap\u003cbr/\u003eetc.\"]\n    \n    UI --\u003e UIList[\"@xterm/xterm\u003cbr/\u003e@xterm/addon-*\u003cbr/\u003ekatex\"]\n    \n    Utility --\u003e UtilList[\"jschardet\u003cbr/\u003eminimist\u003cbr/\u003evscode-textmate\u003cbr/\u003evscode-oniguruma\u003cbr/\u003eyauzl\u003cbr/\u003eyazl\"]\n    \n    Telemetry --\u003e TelList[\"@microsoft/1ds-core-js\u003cbr/\u003e@microsoft/1ds-post-js\"]\n```\n\n**Sources:** [package.json:75-122]()\n\n### Remote Package Dependencies\n\nThe remote package (`vscode-reh`) includes a subset of dependencies needed for the server:\n\n**Shared with Root:**\n- `@microsoft/1ds-core-js`, `@microsoft/1ds-post-js` (telemetry)\n- `@parcel/watcher` (file watching)\n- `@xterm/xterm`, `@xterm/addon-*` (terminal support)\n- `jschardet`, `katex`, `vscode-textmate`, `vscode-oniguruma`\n- `yauzl`, `yazl` (archive handling)\n- `node-pty` (terminal PTY)\n- `kerberos` (authentication)\n\n**Not Included:**\n- Desktop-specific modules (`@vscode/windows-*`, `native-keymap`, etc.)\n- Electron-specific dependencies\n\n**Sources:** [remote/package.json:5-48]()\n\n### Web Package Dependencies\n\nThe web package (`vscode-web`) has minimal dependencies for browser environments:\n\n- `@microsoft/1ds-core-js`, `@microsoft/1ds-post-js` (telemetry)\n- `@xterm/xterm`, `@xterm/addon-*` (terminal emulator)\n- `jschardet` (encoding detection)\n- `katex` (math rendering)\n- `vscode-textmate`, `vscode-oniguruma` (syntax highlighting)\n- `@vscode/tree-sitter-wasm`, `@vscode/vscode-languagedetection` (language features)\n\n**No native modules** - all dependencies are pure JavaScript.\n\n**Sources:** [remote/web/package.json:5-25]()\n\n### Build Package Dependencies\n\nThe build package contains tools for packaging and building:\n\n- `@vscode/vsce` (extension packaging)\n- `esbuild` (bundling)\n- `@electron/get`, `@electron/osx-sign` (Electron tooling)\n- `@azure/storage-blob`, `@azure/cosmos` (publishing to CDN)\n- `workerpool` (parallel processing)\n- Various `@types/*` packages\n\n**Sources:** [build/package.json:5-63]()\n\n## Web-Specific Ignore Patterns\n\nThe `.webignore` file specifies files to exclude from the web bundle:\n\n```\n# Source files not needed in production\n**/*.ts\n**/*.d.ts\n**/*.js.map\n\n# Documentation\n**/*.md\n**/*.txt\n\n# XTerm source files (only dist needed)\n@xterm/xterm/src/**\n@xterm/addon-*/src/**\n\n# Telemetry - only minified versions\n@microsoft/1ds-core-js/**\n!@microsoft/1ds-core-js/dist/ms.core.min.js\n```\n\nThis reduces bundle size by excluding source files, build artifacts, and documentation.\n\n**Sources:** [build/.webignore:1-65]()\n\n## Dependency Installation in Different Contexts\n\n### Local Development\n\n```bash\nnpm install              # Installs root deps, runs postinstall\nnpm run watch            # Development mode\n```\n\n### CI/CD Pipeline\n\n```bash\nnpm ci                   # Clean install from lock file\nnpm run compile          # Production compilation\nnpm run gulp \u003ctask\u003e      # Specific build tasks\n```\n\n**Sources:** [package.json:21-73]()\n\n### Container-Based Remote Build\n\nWhen building remote dependencies in a container (for Linux builds):\n\n```typescript\nif (process.env['VSCODE_REMOTE_DEPENDENCIES_CONTAINER_NAME']) {\n    run('docker', ['exec', '-i', '-w', '/root/vscode', \n        process.env['VSCODE_REMOTE_DEPENDENCIES_CONTAINER_NAME'],\n        'sh', '-c', '\"npm ci\"'\n    ], opts);\n}\n```\n\n**Sources:** [build/npm/postinstall.ts:48-66]()\n\n## Summary\n\nVS Code's package structure uses:\n\n1. **Multiple package.json files** for different contexts (desktop, remote server, web, build tools, extensions)\n2. **Yarn** for deterministic dependency resolution with lock files\n3. **Separate .npmrc configurations** to compile native modules against Electron or Node.js headers\n4. **Postinstall scripts** that orchestrate installation across multiple directories\n5. **Dependency overrides** to ensure compatible versions of transitive dependencies\n6. **Module ignore patterns** to exclude unnecessary files from production builds\n7. **Integration tests** to verify native modules load correctly\n\nThis structure allows VS Code to maintain separate dependency trees for different runtime contexts while sharing common dependencies where appropriate.\n\n**Sources:** [package.json:1-243](), [build/npm/postinstall.ts:1-139](), [.npmrc:1-7](), [remote/.npmrc:1-7](), [build/.moduleignore:1-191](), [build/.webignore:1-65]()"])</script><script>self.__next_f.push([1,"1a:T5060,"])</script><script>self.__next_f.push([1,"# Native Modules and Cross-Platform Builds\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [.npmrc](.npmrc)\n- [.nvmrc](.nvmrc)\n- [build/.moduleignore](build/.moduleignore)\n- [build/.webignore](build/.webignore)\n- [build/azure-pipelines/linux/setup-env.sh](build/azure-pipelines/linux/setup-env.sh)\n- [build/azure-pipelines/linux/verify-glibc-requirements.sh](build/azure-pipelines/linux/verify-glibc-requirements.sh)\n- [build/checksums/electron.txt](build/checksums/electron.txt)\n- [build/checksums/nodejs.txt](build/checksums/nodejs.txt)\n- [build/darwin/create-universal-app.ts](build/darwin/create-universal-app.ts)\n- [build/gulpfile.vscode.ts](build/gulpfile.vscode.ts)\n- [build/linux/dependencies-generator.ts](build/linux/dependencies-generator.ts)\n- [build/npm/postinstall.ts](build/npm/postinstall.ts)\n- [build/package.json](build/package.json)\n- [cgmanifest.json](cgmanifest.json)\n- [eslint.config.js](eslint.config.js)\n- [extensions/esbuild-webview-common.mjs](extensions/esbuild-webview-common.mjs)\n- [extensions/package-lock.json](extensions/package-lock.json)\n- [extensions/package.json](extensions/package.json)\n- [package-lock.json](package-lock.json)\n- [package.json](package.json)\n- [remote/.npmrc](remote/.npmrc)\n- [remote/package-lock.json](remote/package-lock.json)\n- [remote/package.json](remote/package.json)\n- [remote/web/package-lock.json](remote/web/package-lock.json)\n- [remote/web/package.json](remote/web/package.json)\n- [src/vs/base/parts/contextmenu/electron-main/contextmenu.ts](src/vs/base/parts/contextmenu/electron-main/contextmenu.ts)\n- [src/vs/platform/environment/test/node/nativeModules.integrationTest.ts](src/vs/platform/environment/test/node/nativeModules.integrationTest.ts)\n\n\u003c/details\u003e\n\n\n\nThis document details how VS Code compiles native Node.js modules (`.node` binaries) for multiple platforms and architectures. Native modules provide access to OS-specific functionality and are critical for features like terminal emulation, file watching, and authentication. The build system must compile these modules separately for Electron (desktop), Node.js (remote server), and each platform/architecture combination (Windows x64/arm64, macOS x64/arm64, Linux x64/arm64/armv7l).\n\nFor information about the overall build pipeline and bundling process, see [Build Tasks and Scripts](#2.3). For package structure and dependency management, see [Package Structure and Dependencies](#2.1).\n\n## Native Module Inventory\n\nVS Code depends on approximately 15 native modules that require compilation with platform-specific toolchains. These modules are listed in the root `package.json` and `remote/package.json` files.\n\n### Core Native Dependencies\n\n| Module | Version | Purpose | Platforms |\n|--------|---------|---------|-----------|\n| `node-pty` | ^1.2.0-beta.6 | Terminal pseudo-TTY management | All |\n| `@parcel/watcher` | ^2.5.4 | High-performance file system watching | All |\n| `@vscode/spdlog` | ^0.15.2 | Fast C++ logging library | All |\n| `@vscode/sqlite3` | 5.1.11-vscode | Embedded SQL database | Desktop only |\n| `native-keymap` | ^3.3.5 | Keyboard layout detection | Desktop only |\n| `native-is-elevated` | 0.8.0 | Administrator privilege detection | Desktop only |\n| `kerberos` | 2.1.1 | Kerberos authentication | All |\n| `@vscode/deviceid` | ^0.1.1 | Hardware device identification | All |\n| `@vscode/native-watchdog` | ^1.4.6 | Process health monitoring | All |\n| `@vscode/policy-watcher` | ^1.3.2 | Group policy monitoring | Desktop only |\n| `@vscode/windows-process-tree` | ^0.6.0 | Windows process tree enumeration | Windows |\n| `@vscode/windows-registry` | ^1.1.0 | Windows registry access | Windows |\n| `@vscode/windows-mutex` | ^0.5.0 | Named mutex support | Windows |\n| `windows-foreground-love` | 0.5.0 | Window focus management | Windows (optional) |\n\n**Sources:** [package.json:75-122](), [remote/package.json:5-43]()\n\n## Runtime Configuration and Target Environments\n\nVS Code must build native modules for two distinct JavaScript runtimes with different ABIs, each targeting multiple architectures.\n\n```mermaid\ngraph TB\n    subgraph \"Build Targets\"\n        Desktop[\"Desktop Runtime\u003cbr/\u003e(Electron 39.2.7)\"]\n        Remote[\"Remote Server Runtime\u003cbr/\u003e(Node.js 22.21.1)\"]\n    end\n    \n    subgraph \"Desktop Architectures\"\n        Desktop --\u003e WinX64[\"Windows x64\"]\n        Desktop --\u003e WinArm64[\"Windows arm64\"]\n        Desktop --\u003e MacX64[\"macOS x64\"]\n        Desktop --\u003e MacArm64[\"macOS arm64\"]\n        Desktop --\u003e LinuxX64[\"Linux x64\"]\n        Desktop --\u003e LinuxArm64[\"Linux arm64\"]\n        Desktop --\u003e LinuxArmv7l[\"Linux armv7l\"]\n    end\n    \n    subgraph \"Remote Architectures\"\n        Remote --\u003e RemoteLinuxX64[\"Linux x64\"]\n        Remote --\u003e RemoteLinuxArm64[\"Linux arm64\"]\n        Remote --\u003e RemoteLinuxArmv7l[\"Linux armv7l\"]\n    end\n    \n    subgraph \"Configuration Files\"\n        DesktopNpmrc[\".npmrc\u003cbr/\u003eruntime=electron\u003cbr/\u003etarget=39.2.7\"]\n        RemoteNpmrc[\"remote/.npmrc\u003cbr/\u003eruntime=node\u003cbr/\u003etarget=22.21.1\"]\n    end\n    \n    DesktopNpmrc --\u003e Desktop\n    RemoteNpmrc --\u003e Remote\n```\n\nThe `.npmrc` files configure how `node-gyp` compiles native modules:\n\n**Desktop (.npmrc):**\n```\ndisturl=\"https://electronjs.org/headers\"\ntarget=\"39.2.7\"\nruntime=\"electron\"\nbuild_from_source=\"true\"\n```\n\n**Remote Server (remote/.npmrc):**\n```\ndisturl=\"https://nodejs.org/dist\"\ntarget=\"22.21.1\"\nruntime=\"node\"\nbuild_from_source=\"true\"\n```\n\nThe `build_from_source=\"true\"` setting forces all native modules to compile from source rather than using prebuilt binaries, ensuring ABI compatibility with the specific runtime version.\n\n**Sources:** [.npmrc:1-7](), [remote/.npmrc:1-7](), [package.json:75-122]()\n\n## Linux Build Toolchain Setup\n\nLinux builds use a custom toolchain with specific GLIBC targeting to ensure broad compatibility across distributions. The build system downloads Clang from the Chromium project and sets up sysroots with GLIBC 2.28.\n\n```mermaid\ngraph LR\n    subgraph \"Sysroot Download\"\n        SysrootScript[\"install-sysroot.ts\u003cbr/\u003egetVSCodeSysroot()\"]\n        ClientSysroot[\".build/sysroots/\u003cbr/\u003eglibc-2.28-gcc-10.5.0\"]\n        RemoteSysroot[\".build/sysroots/\u003cbr/\u003eglibc-2.28-gcc-8.5.0\"]\n    end\n    \n    subgraph \"Clang Toolchain\"\n        ChromiumClang[\"Chromium Clang\u003cbr/\u003eTag 142.0.7444.235\"]\n        ClangBin[\".build/CR_Clang/bin/clang\"]\n    end\n    \n    subgraph \"libcxx Setup\"\n        LibcxxFetcher[\"libcxx-fetcher.ts\"]\n        LibcxxHeaders[\".build/libcxx_headers\"]\n        LibcxxObjects[\".build/libcxx-objects\"]\n        LibcxxabiHeaders[\".build/libcxxabi_headers\"]\n    end\n    \n    subgraph \"Compilation Environment\"\n        SetupEnv[\"setup-env.sh\"]\n        CC[\"CC=clang --gcc-toolchain\"]\n        CXX[\"CXX=clang++ --gcc-toolchain\"]\n        CXXFLAGS[\"CXXFLAGS\u003cbr/\u003e-nostdinc++ -D__NO_INLINE__\u003cbr/\u003e-isystem libcxx_headers\"]\n        LDFLAGS[\"LDFLAGS\u003cbr/\u003e-stdlib=libc++\u003cbr/\u003e-Wl,-rpath-link\"]\n    end\n    \n    SysrootScript --\u003e ClientSysroot\n    SysrootScript --\u003e RemoteSysroot\n    ChromiumClang --\u003e ClangBin\n    LibcxxFetcher --\u003e LibcxxHeaders\n    LibcxxFetcher --\u003e LibcxxObjects\n    LibcxxFetcher --\u003e LibcxxabiHeaders\n    \n    SetupEnv --\u003e CC\n    SetupEnv --\u003e CXX\n    SetupEnv --\u003e CXXFLAGS\n    SetupEnv --\u003e LDFLAGS\n    \n    ClientSysroot --\u003e CC\n    ClientSysroot --\u003e CXX\n    ClangBin --\u003e CC\n    ClangBin --\u003e CXX\n    LibcxxHeaders --\u003e CXXFLAGS\n    LibcxxObjects --\u003e LDFLAGS\n```\n\n### Sysroot Configuration\n\nVS Code maintains two separate sysroots for Linux builds:\n\n- **Client sysroot**: `glibc-2.28-gcc-10.5.0` for desktop Electron builds\n- **Remote sysroot**: `glibc-2.28-gcc-8.5.0` for Node.js server builds\n\nThe sysroots provide a consistent build environment with known library versions, preventing accidental dependencies on newer system libraries.\n\n**Sources:** [build/azure-pipelines/linux/setup-env.sh:5-24]()\n\n### Compiler Toolchain\n\nThe Linux build uses Clang from the Chromium project (tag 142.0.7444.235) rather than system compilers. This ensures:\n\n1. **Consistent compiler behavior** across different build machines\n2. **Compatibility with Electron's Chromium build** which uses the same toolchain\n3. **Modern C++ standard library (libc++)** matching Electron's runtime\n\nKey compiler flags configured in `setup-env.sh`:\n\n```bash\nexport CC=\"$PWD/.build/CR_Clang/bin/clang --gcc-toolchain=$VSCODE_CLIENT_SYSROOT_DIR/x86_64-linux-gnu\"\nexport CXX=\"$PWD/.build/CR_Clang/bin/clang++ --gcc-toolchain=$VSCODE_CLIENT_SYSROOT_DIR/x86_64-linux-gnu\"\nexport CXXFLAGS=\"-nostdinc++ -D__NO_INLINE__ -DSPDLOG_USE_STD_FORMAT -I$PWD/.build/libcxx_headers...\"\nexport LDFLAGS=\"-stdlib=libc++ -L$PWD/.build/libcxx-objects -lc++abi...\"\n```\n\nThe `-nostdinc++` flag prevents using system C++ headers, while the `-isystem` directives point to the downloaded libcxx headers from Electron.\n\n**Sources:** [build/azure-pipelines/linux/setup-env.sh:26-52](), [cgmanifest.json:1-44]()\n\n### GLIBC Targeting and Verification\n\nAfter compilation, the build system verifies that all `.node` binaries depend on at most GLIBC 2.28 to ensure compatibility with older Linux distributions.\n\n```mermaid\ngraph TD\n    FindNode[\"find *.node files\u003cbr/\u003eExclude prebuilds\"]\n    Objdump[\"objdump -T\u003cbr/\u003eExtract symbol versions\"]\n    CheckGLIBC[\"Check GLIBC_* symbols\u003cbr/\u003eMax: 2.28\"]\n    CheckGLIBCXX[\"Check GLIBCXX_* symbols\u003cbr/\u003eMax: 3.4.25\"]\n    Pass[\"Build passes\"]\n    Fail[\"Build fails\"]\n    \n    FindNode --\u003e Objdump\n    Objdump --\u003e CheckGLIBC\n    Objdump --\u003e CheckGLIBCXX\n    CheckGLIBC --\u003e|\" 2.28\"| Pass\n    CheckGLIBC --\u003e|\"\u003e 2.28\"| Fail\n    CheckGLIBCXX --\u003e|\" 3.4.25\"| Pass\n    CheckGLIBCXX --\u003e|\"\u003e 3.4.25\"| Fail\n```\n\nThe verification script `verify-glibc-requirements.sh` scans all compiled `.node` files and extracts their symbol versions using `objdump`:\n\n```bash\n# Expected versions\nEXPECTED_GLIBC_VERSION=\"2.28\"\nEXPECTED_GLIBCXX_VERSION=\"3.4.25\"\n\n# Extract and verify versions\nobjdump -T \"$file\" | grep \"GLIBC_\\|GLIBCXX_\"\n```\n\n**Sources:** [build/azure-pipelines/linux/verify-glibc-requirements.sh:1-44](), [build/azure-pipelines/linux/setup-env.sh:53-65]()\n\n## macOS Universal Binary Creation\n\nmacOS builds must produce universal binaries containing both x64 and arm64 architectures. The `create-universal-app.ts` script merges separate architecture builds.\n\n```mermaid\ngraph LR\n    subgraph \"Input Builds\"\n        X64[\"VSCode-darwin-x64/\u003cbr/\u003eVisual Studio Code.app\"]\n        ARM64[\"VSCode-darwin-arm64/\u003cbr/\u003eVisual Studio Code.app\"]\n    end\n    \n    subgraph \"Universal Bundler\"\n        MakeUniversal[\"makeUniversalApp()\"]\n        MergeASARs[\"mergeASARs: true\"]\n        X64ArchFiles[\"x64ArchFiles:\u003cbr/\u003ekerberos.node\u003cbr/\u003elibmsalruntime.dylib\u003cbr/\u003emsal-node-runtime.node\"]\n    end\n    \n    subgraph \"Output\"\n        Universal[\"VSCode-darwin-universal/\u003cbr/\u003eVisual Studio Code.app\"]\n    end\n    \n    X64 --\u003e MakeUniversal\n    ARM64 --\u003e MakeUniversal\n    MergeASARs --\u003e MakeUniversal\n    X64ArchFiles --\u003e MakeUniversal\n    MakeUniversal --\u003e Universal\n```\n\n### Architecture-Specific Files\n\nSome native modules cannot be merged into universal binaries due to architecture-specific implementations. These files are kept as x64-only:\n\n- `kerberos.node` - Kerberos authentication module\n- `libmsalruntime.dylib` - Microsoft Authentication Library runtime\n- `msal-node-runtime.node` - MSAL Node.js binding\n\nThe `x64ArchFiles` pattern matches these files and preserves only the x64 version in the universal app:\n\n```typescript\nx64ArchFiles: '{*/kerberos.node,**/extensions/microsoft-authentication/dist/libmsalruntime.dylib,**/extensions/microsoft-authentication/dist/msal-node-runtime.node}'\n```\n\nWhen these modules are required on arm64, they run through Rosetta 2 translation.\n\n**Sources:** [build/darwin/create-universal-app.ts:1-65]()\n\n## Native Module Compilation Process\n\nThe compilation of native modules occurs during `npm install` through the postinstall scripts. The process differs for desktop and remote builds.\n\n```mermaid\nsequenceDiagram\n    participant NPM as npm install\n    participant Postinstall as postinstall.ts\n    participant Subdirs as Subdirectories\n    participant NodeGYP as node-gyp\n    participant Verify as Verification\n    \n    NPM-\u003e\u003ePostinstall: Run postinstall script\n    Postinstall-\u003e\u003ePostinstall: Check for remote container\n    \n    alt Remote Container Build\n        Postinstall-\u003e\u003eSubdirs: docker exec npm install\n    else Local Build\n        Postinstall-\u003e\u003eSubdirs: Local npm install\n    end\n    \n    Subdirs-\u003e\u003eNodeGYP: Compile native modules\n    NodeGYP-\u003e\u003eNodeGYP: Read .npmrc config\n    NodeGYP-\u003e\u003eNodeGYP: Download headers (Electron/Node)\n    NodeGYP-\u003e\u003eNodeGYP: Run binding.gyp\n    NodeGYP-\u003e\u003eNodeGYP: Compile C/C++ sources\n    NodeGYP-\u003e\u003eNodeGYP: Link .node binary\n    \n    NodeGYP-\u003e\u003eVerify: .node files created\n    \n    alt Linux\n        Verify-\u003e\u003eVerify: verify-glibc-requirements.sh\n        Verify-\u003e\u003eVerify: Check GLIBC versions\n    end\n    \n    Verify-\u003e\u003eNPM: Build complete\n```\n\n### Postinstall Script Flow\n\nThe `postinstall.ts` script orchestrates native module compilation across multiple directories:\n\n1. **Root directory**: Compiles desktop dependencies\n2. **remote/**: Compiles Node.js server dependencies\n3. **build/**: Compiles build tool dependencies\n4. **extensions/**: Compiles extension dependencies\n\nFor remote builds in CI, the script can execute npm install inside a Docker container to match the target environment:\n\n```typescript\nif (process.env['VSCODE_REMOTE_DEPENDENCIES_CONTAINER_NAME']) {\n  // Execute inside container\n  run('docker', ['exec', ...], opts);\n}\n```\n\n**Sources:** [build/npm/postinstall.ts:1-120]()\n\n### node-gyp Configuration\n\nThe `node-gyp` build tool reads configuration from `.npmrc` files and uses the `binding.gyp` files in each native module to generate platform-specific build files (Makefiles on Linux/macOS, Visual Studio projects on Windows).\n\nFor overriding dependencies, the root `package.json` includes:\n\n```json\n\"overrides\": {\n  \"node-gyp-build\": \"4.8.1\",\n  \"kerberos@2.1.1\": {\n    \"node-addon-api\": \"7.1.0\"\n  }\n}\n```\n\nThis ensures consistent versions of build dependencies across all native modules.\n\n**Sources:** [package.json:227-232](), [remote/package.json:44-49]()\n\n## Module Cleanup and Packaging\n\nAfter compilation, the build system removes unnecessary files from `node_modules` to reduce distribution size. The `.moduleignore` file specifies cleanup patterns.\n\n### Cleanup Patterns by Module\n\nThe `.moduleignore` file uses `.gitignore` syntax to specify which files to remove:\n\n```\n# Native module structure\n\u003cmodule\u003e/binding.gyp          # Build scripts\n\u003cmodule\u003e/build/**              # Intermediate build files\n\u003cmodule\u003e/src/**                # C/C++ source files\n!\u003cmodule\u003e/build/Release/*.node # Keep final binaries\n```\n\nExample for `@vscode/spdlog`:\n\n```\n@vscode/spdlog/binding.gyp\n@vscode/spdlog/build/**\n@vscode/spdlog/deps/**\n@vscode/spdlog/src/**\n@vscode/spdlog/test/**\n!@vscode/spdlog/build/Release/*.node\n```\n\nThis pattern:\n- Removes all build artifacts and source code\n- Keeps only the final `.node` binary in `build/Release/`\n- Reduces the module from ~50MB to \u003c1MB\n\n**Sources:** [build/.moduleignore:1-191]()\n\n### Platform-Specific Binaries\n\nFor each native module, only the `.node` binary for the target platform is kept:\n\n| Platform | Binary Location | Example |\n|----------|----------------|---------|\n| Windows | `build/Release/*.node` | `node_pty/build/Release/pty.node` |\n| Linux | `build/Release/*.node` | `@vscode/spdlog/build/Release/spdlog.node` |\n| macOS | `build/Release/*.node` | `native-keymap/build/Release/keymap.node` |\n\nAdditional platform-specific files:\n- **Windows**: `*.exe`, `*.dll` files (e.g., `node-pty/build/Release/conpty.dll`)\n- **Linux**: `spawn-helper` executable for `node-pty`\n- **macOS**: Universal or architecture-specific `.node` files\n\n**Sources:** [build/.moduleignore:94-114]()\n\n## Dependency Validation\n\nThe build system validates that compiled binaries have correct system library dependencies for each platform.\n\n```mermaid\ngraph TD\n    Find[\"Find all .node files\"]\n    \n    subgraph \"Linux Analysis\"\n        Objdump[\"objdump -T\u003cbr/\u003eExtract dynamic symbols\"]\n        FilterSym[\"Filter for system libs\u003cbr/\u003eExclude bundled libs\"]\n        CalcDeps[\"Calculate package\u003cbr/\u003edependencies\"]\n    end\n    \n    subgraph \"Validation\"\n        Compare[\"Compare against\u003cbr/\u003ereference dependencies\"]\n        CheckNew[\"Check for new\u003cbr/\u003edependencies\"]\n        Decision{New deps?}\n    end\n    \n    Find --\u003e Objdump\n    Objdump --\u003e FilterSym\n    FilterSym --\u003e CalcDeps\n    CalcDeps --\u003e Compare\n    Compare --\u003e CheckNew\n    CheckNew --\u003e Decision\n    Decision --\u003e|\"Yes + strict mode\"| Fail[\"Build fails\"]\n    Decision --\u003e|\"Yes + warn mode\"| Warn[\"Warning logged\"]\n    Decision --\u003e|\"No\"| Pass[\"Validation passes\"]\n```\n\n### Bundled Dependencies\n\nVS Code bundles some Chromium-provided libraries that native modules can link against. These are excluded from system dependency calculations:\n\n```typescript\nconst bundledDeps = [\n  'libEGL.so',\n  'libGLESv2.so',\n  'libvulkan.so.1',\n  'libvk_swiftshader.so',\n  'libffmpeg.so'\n];\n```\n\n### Reference Dependency Lists\n\nThe build maintains reference lists of expected system library dependencies in `build/linux/debian/dep-lists.ts` and `build/linux/rpm/dep-lists.ts`. These lists are used to:\n\n1. Detect when new system library dependencies are introduced\n2. Generate package metadata for `.deb` and `.rpm` distributions\n3. Ensure consistent dependencies across architectures\n\nThe `FAIL_BUILD_FOR_NEW_DEPENDENCIES` flag controls whether new dependencies cause build failures or just warnings:\n\n```typescript\nconst FAIL_BUILD_FOR_NEW_DEPENDENCIES: boolean = true;\n```\n\n**Sources:** [build/linux/dependencies-generator.ts:1-120]()\n\n## Native Module Testing\n\nIntegration tests verify that native modules load correctly in the target runtime environment.\n\n```mermaid\ngraph LR\n    subgraph \"Test Suite\"\n        TestRunner[\"nativeModules.integrationTest.ts\"]\n    end\n    \n    subgraph \"Module Tests\"\n        Kerberos[\"kerberos\u003cbr/\u003einitializeClient()\"]\n        NodePty[\"node-pty\u003cbr/\u003espawn()\"]\n        Spdlog[\"@vscode/spdlog\u003cbr/\u003ecreateRotatingLogger()\"]\n        Parcel[\"@parcel/watcher\u003cbr/\u003esubscribe()\"]\n        DeviceId[\"@vscode/deviceid\u003cbr/\u003egetDeviceId()\"]\n        NativeKeymap[\"native-keymap\u003cbr/\u003egetCurrentKeyboardLayout()\"]\n        WindowsRegistry[\"@vscode/windows-registry\u003cbr/\u003eGetStringRegKey()\"]\n    end\n    \n    TestRunner --\u003e Kerberos\n    TestRunner --\u003e NodePty\n    TestRunner --\u003e Spdlog\n    TestRunner --\u003e Parcel\n    TestRunner --\u003e DeviceId\n    TestRunner --\u003e NativeKeymap\n    TestRunner --\u003e WindowsRegistry\n```\n\nEach test attempts to import the native module and call a key function to verify it was compiled correctly:\n\n```typescript\ntest('node-pty', async () =\u003e {\n  const nodePty = await import('node-pty');\n  assert.ok(typeof nodePty.spawn === 'function', testErrorMessage('node-pty'));\n});\n\ntest('@vscode/spdlog', async () =\u003e {\n  const spdlog = await import('@vscode/spdlog');\n  assert.ok(typeof spdlog.createRotatingLogger === 'function', testErrorMessage('@vscode/spdlog'));\n  assert.ok(typeof spdlog.version === 'number', testErrorMessage('@vscode/spdlog'));\n});\n```\n\nPlatform-specific tests run conditionally:\n\n```typescript\n(isWindows ? test : test.skip)('@vscode/windows-registry', async () =\u003e {\n  const registry = await import('@vscode/windows-registry');\n  assert.ok(typeof registry.GetStringRegKey === 'function', testErrorMessage('@vscode/windows-registry'));\n});\n```\n\n**Sources:** [src/vs/platform/environment/test/node/nativeModules.integrationTest.ts:1-140]()\n\n## Cross-Platform Build Matrix\n\nThe complete build matrix for native modules spans multiple dimensions:\n\n| Dimension | Values |\n|-----------|--------|\n| **Runtime** | Electron 39.2.7, Node.js 22.21.1 |\n| **OS** | Windows, macOS, Linux |\n| **Architecture** | x64, arm64, armv7l (Linux only), ia32 (Windows only) |\n| **Toolchain** | MSVC (Windows), Clang (macOS), Chromium Clang (Linux) |\n| **GLIBC** | 2.28 (Linux) |\n\nThis results in approximately 18 distinct build configurations:\n\n- **Desktop (Electron)**: 7 configurations (Windows x64/arm64/ia32, macOS x64/arm64, Linux x64/arm64/armv7l)\n- **Remote (Node.js)**: 3 configurations (Linux x64/arm64/armv7l)\n- **Universal (macOS)**: 1 merged configuration\n\nEach configuration requires separate compilation of all native modules, producing architecture-specific `.node` binaries that are approximately 1-5MB per module.\n\n**Sources:** [package.json:1-243](), [remote/package.json:1-50](), [build/checksums/electron.txt:1-76](), [build/checksums/nodejs.txt:1-8]()"])</script><script>self.__next_f.push([1,"1b:T5f72,"])</script><script>self.__next_f.push([1,"# Build Tasks and Scripts\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [.npmrc](.npmrc)\n- [.nvmrc](.nvmrc)\n- [build/.moduleignore](build/.moduleignore)\n- [build/.webignore](build/.webignore)\n- [build/azure-pipelines/linux/setup-env.sh](build/azure-pipelines/linux/setup-env.sh)\n- [build/azure-pipelines/linux/verify-glibc-requirements.sh](build/azure-pipelines/linux/verify-glibc-requirements.sh)\n- [build/checksums/electron.txt](build/checksums/electron.txt)\n- [build/checksums/nodejs.txt](build/checksums/nodejs.txt)\n- [build/darwin/create-universal-app.ts](build/darwin/create-universal-app.ts)\n- [build/gulpfile.vscode.ts](build/gulpfile.vscode.ts)\n- [build/linux/dependencies-generator.ts](build/linux/dependencies-generator.ts)\n- [build/npm/postinstall.ts](build/npm/postinstall.ts)\n- [build/package.json](build/package.json)\n- [cgmanifest.json](cgmanifest.json)\n- [eslint.config.js](eslint.config.js)\n- [extensions/esbuild-webview-common.mjs](extensions/esbuild-webview-common.mjs)\n- [extensions/package-lock.json](extensions/package-lock.json)\n- [extensions/package.json](extensions/package.json)\n- [package-lock.json](package-lock.json)\n- [package.json](package.json)\n- [remote/.npmrc](remote/.npmrc)\n- [remote/package-lock.json](remote/package-lock.json)\n- [remote/package.json](remote/package.json)\n- [remote/web/package-lock.json](remote/web/package-lock.json)\n- [remote/web/package.json](remote/web/package.json)\n- [src/vs/base/parts/contextmenu/electron-main/contextmenu.ts](src/vs/base/parts/contextmenu/electron-main/contextmenu.ts)\n- [src/vs/platform/environment/test/node/nativeModules.integrationTest.ts](src/vs/platform/environment/test/node/nativeModules.integrationTest.ts)\n\n\u003c/details\u003e\n\n\n\nThis document describes the build tasks, compilation pipeline, and development scripts used to build VS Code. It covers the npm script interface, Gulp task orchestration, TypeScript compilation, watch mode, testing infrastructure, and quality validation checks.\n\nFor information about package structure and dependencies, see [Package Structure and Dependencies](#2.1). For information about native module compilation and platform-specific builds, see [Native Modules and Cross-Platform Builds](#2.2).\n\n## Purpose and Scope\n\nThis page documents:\n- NPM scripts defined in `package.json` for common development tasks\n- Gulp task system for build orchestration\n- TypeScript compilation pipeline using `tsgo` and `tsc`\n- Watch mode for incremental compilation during development\n- Testing infrastructure including unit, integration, and smoke tests\n- Quality checks: ESLint, Stylelint, hygiene checks, and layer validation\n\n## NPM Scripts Overview\n\nThe root [package.json:12-73]() defines npm scripts that serve as the primary interface for developers. These scripts delegate to either Gulp tasks or direct tool invocations.\n\n```mermaid\ngraph TB\n    subgraph \"Primary Development Scripts\"\n        compile[\"npm run compile\u003cbr/\u003eGulp compile task\"]\n        watch[\"npm run watch\u003cbr/\u003ewatch-client + watch-extensions\"]\n        test[\"npm test\u003cbr/\u003eUnit test suites\"]\n    end\n    \n    subgraph \"Quality Check Scripts\"\n        precommit[\"npm run precommit\u003cbr/\u003eHygiene checks\"]\n        eslint[\"npm run eslint\u003cbr/\u003eCode style validation\"]\n        stylelint[\"npm run stylelint\u003cbr/\u003eCSS linting\"]\n        validLayers[\"npm run valid-layers-check\u003cbr/\u003eArchitecture validation\"]\n        hygiene[\"npm run hygiene\u003cbr/\u003eGulp hygiene task\"]\n    end\n    \n    subgraph \"Specialized Compilation\"\n        compileCLI[\"npm run compile-cli\u003cbr/\u003eCLI server compilation\"]\n        compileWeb[\"npm run compile-web\u003cbr/\u003eWeb workbench compilation\"]\n        compileBuild[\"npm run compile-build\u003cbr/\u003eProduction build with mangling\"]\n    end\n    \n    subgraph \"CI Tasks\"\n        coreCI[\"npm run core-ci\u003cbr/\u003eGulp core-ci\"]\n        coreCIPR[\"npm run core-ci-pr\u003cbr/\u003eGulp core-ci-pr\"]\n        extensionsCI[\"npm run extensions-ci\u003cbr/\u003eGulp extensions-ci\"]\n    end\n    \n    compile --\u003e Gulp\n    watch --\u003e watchClient[\"watch-client task\"]\n    watch --\u003e watchExtensions[\"watch-extensions task\"]\n    precommit --\u003e hygieneNode[\"build/hygiene.ts\"]\n    validLayers --\u003e layerChecker[\"build/checker/layersChecker.ts\"]\n    \n    style compile fill:#e1f5ff\n    style watch fill:#ffe1e1\n    style precommit fill:#e1ffe1\n```\n\n**Sources:** [package.json:12-73]()\n\n### Key Script Categories\n\nThe npm scripts are organized into several categories:\n\n| Category | Scripts | Purpose |\n|----------|---------|---------|\n| **Compilation** | `compile`, `compile-cli`, `compile-web`, `compile-build` | Full TypeScript compilation for different targets |\n| **Watch Mode** | `watch`, `watch-client`, `watch-extensions`, `watchd` | Incremental compilation during development |\n| **Testing** | `test`, `test-browser`, `test-node`, `test-extension`, `smoketest` | Run different test suites |\n| **Quality Checks** | `eslint`, `stylelint`, `hygiene`, `valid-layers-check`, `precommit` | Code quality and architecture validation |\n| **CI** | `core-ci`, `core-ci-pr`, `extensions-ci`, `extensions-ci-pr` | Continuous integration task bundles |\n| **Type Checking** | `monaco-compile-check`, `vscode-dts-compile-check`, `tsec-compile-check` | Validate specific TypeScript subsets |\n\n**Sources:** [package.json:12-73]()\n\n## Gulp Task System\n\nVS Code uses Gulp 4 as its task orchestration system. The main Gulp entry point invokes tasks with increased memory allocation.\n\n### Gulp Invocation\n\nThe `gulp` npm script [package.json:37]() is defined as:\n```\n\"gulp\": \"node --max-old-space-size=8192 ./node_modules/gulp/bin/gulp.js\"\n```\n\nThis allocates 8GB of heap space to handle the large-scale build operations, particularly during production builds with minification and bundling.\n\n### Primary Gulp Tasks\n\n```mermaid\ngraph TB\n    subgraph \"Core Compilation Tasks\"\n        gulpCompile[\"gulp compile\u003cbr/\u003eFull TypeScript compilation\u003cbr/\u003eClient + Extensions\"]\n        gulpWatchClient[\"gulp watch-client\u003cbr/\u003eIncremental client code compilation\"]\n        gulpWatchExtensions[\"gulp watch-extensions\u003cbr/\u003eIncremental extension compilation\"]\n    end\n    \n    subgraph \"Production Build Tasks\"\n        compileWithMangling[\"gulp compile-build-with-mangling\u003cbr/\u003eOptimized production build\"]\n        minifyVSCode[\"gulp minify-vscode\u003cbr/\u003eMinify desktop application\"]\n        minifyREH[\"gulp minify-vscode-reh\u003cbr/\u003eMinify remote server\"]\n        minifyREHWeb[\"gulp minify-vscode-reh-web\u003cbr/\u003eMinify web remote server\"]\n    end\n    \n    subgraph \"Quality Tasks\"\n        gulpHygiene[\"gulp hygiene\u003cbr/\u003eCopyright, indentation, file checks\"]\n        coreCI[\"gulp core-ci\u003cbr/\u003eFull CI validation for core\"]\n        coreCIPR[\"gulp core-ci-pr\u003cbr/\u003ePR validation for core\"]\n        extensionsCI[\"gulp extensions-ci\u003cbr/\u003eFull CI validation for extensions\"]\n    end\n    \n    gulpCompile --\u003e TSC[\"TypeScript Compiler\u003cbr/\u003etsgo/tsc\"]\n    gulpWatchClient --\u003e TSCWatch[\"tsc --watch\"]\n    compileWithMangling --\u003e Webpack[\"webpack bundling\"]\n    minifyVSCode --\u003e Minification[\"Code minification\u003cbr/\u003eand optimization\"]\n    gulpHygiene --\u003e HygieneChecks[\"build/hygiene.ts\"]\n    \n    style gulpCompile fill:#e1f5ff\n    style gulpHygiene fill:#ffe1e1\n    style compileWithMangling fill:#e1ffe1\n```\n\n**Sources:** [package.json:37](), [package.json:61-69]()\n\n## TypeScript Compilation Pipeline\n\nVS Code uses a custom TypeScript compiler build called `tsgo` (based on TypeScript with Go-like performance characteristics) alongside the standard `tsc` compiler.\n\n### Compilation Targets\n\nThe codebase maintains multiple TypeScript configurations for different compilation targets:\n\n```mermaid\ngraph TB\n    subgraph \"Main Compilation Targets\"\n        mainTSConfig[\"src/tsconfig.json\u003cbr/\u003eMain source compilation\"]\n        monacoTSConfig[\"src/tsconfig.monaco.json\u003cbr/\u003eStandalone Monaco editor\"]\n        vscodeDTS[\"src/tsconfig.vscode-dts.json\u003cbr/\u003eExtension API definitions\"]\n    end\n    \n    subgraph \"Layer Validation Configs\"\n        browserLayer[\"build/checker/tsconfig.browser.json\u003cbr/\u003eBrowser-only code\"]\n        electronMainLayer[\"build/checker/tsconfig.electron-main.json\u003cbr/\u003eElectron main process\"]\n        electronBrowserLayer[\"build/checker/tsconfig.electron-browser.json\u003cbr/\u003eElectron renderer\"]\n        nodeLayer[\"build/checker/tsconfig.node.json\u003cbr/\u003eNode.js code\"]\n        workerLayer[\"build/checker/tsconfig.worker.json\u003cbr/\u003eWeb Worker code\"]\n    end\n    \n    subgraph \"Security and Validation\"\n        tsecConfig[\"src/tsconfig.tsec.json\u003cbr/\u003eTypeScript security checks\"]\n        defineClassFields[\"src/tsconfig.defineClassFields.json\u003cbr/\u003eClass field initialization order\"]\n    end\n    \n    mainTSConfig --\u003e CompilationOutput[\"out/**/*.js\"]\n    monacoTSConfig --\u003e MonacoValidation[\"Monaco API surface validation\"]\n    vscodeDTS --\u003e ExtensionAPIValidation[\"Extension API validation\"]\n    \n    browserLayer --\u003e LayerCheck[\"build/checker/layersChecker.ts\"]\n    electronMainLayer --\u003e LayerCheck\n    nodeLayer --\u003e LayerCheck\n    \n    style mainTSConfig fill:#e1f5ff\n    style LayerCheck fill:#ffe1e1\n```\n\n**Sources:** [package.json:47-51](), [build/checker/tsconfig.browser.json](), [build/checker/tsconfig.electron-main.json]()\n\n### Compilation Commands\n\nThe following npm scripts handle different compilation scenarios:\n\n- **Full Compilation**: `npm run compile`  `gulp compile` - Compiles all TypeScript sources\n- **Native Check**: `npm run compile-check-ts-native` [package.json:22]() - Type-checks main sources without emitting\n- **Monaco Check**: `npm run monaco-compile-check` [package.json:47]() - Validates standalone Monaco editor build\n- **Extension API Check**: `npm run vscode-dts-compile-check` [package.json:49]() - Validates extension API definitions\n- **Security Check**: `npm run tsec-compile-check` [package.json:48]() - Runs `tsec` security analysis\n\n**Sources:** [package.json:21-22](), [package.json:47-49]()\n\n## Watch Mode for Development\n\nWatch mode enables incremental compilation during development, dramatically reducing build times by only recompiling changed files.\n\n### Watch Architecture\n\n```mermaid\ngraph TB\n    subgraph \"Watch Entry Points\"\n        npmWatch[\"npm run watch\u003cbr/\u003eCombined watch mode\"]\n        watchd[\"npm run watchd\u003cbr/\u003eDaemonized watch with deemon\"]\n    end\n    \n    subgraph \"Parallel Watch Tasks\"\n        watchClient[\"npm run watch-client\u003cbr/\u003egulp watch-client\u003cbr/\u003eClient code compilation\"]\n        watchExtensions[\"npm run watch-extensions\u003cbr/\u003egulp watch-extensions + watch-extension-media\u003cbr/\u003eExtension code + media\"]\n    end\n    \n    subgraph \"Specialized Watch\"\n        watchWeb[\"npm run watch-web\u003cbr/\u003egulp watch-web\u003cbr/\u003eWeb workbench\"]\n        watchCLI[\"npm run watch-cli\u003cbr/\u003egulp watch-cli\u003cbr/\u003eCLI server\"]\n    end\n    \n    subgraph \"Daemon Management\"\n        killWatchd[\"npm run kill-watchd\u003cbr/\u003eStop daemon\"]\n        restartWatchd[\"npm run restart-watchd\u003cbr/\u003eRestart daemon\"]\n    end\n    \n    npmWatch --\u003e npmRunAll[\"npm-run-all -lp\u003cbr/\u003eParallel execution\"]\n    npmRunAll --\u003e watchClient\n    npmRunAll --\u003e watchExtensions\n    watchd --\u003e deemon[\"deemon package\u003cbr/\u003eProcess daemonization\"]\n    \n    watchClient --\u003e tscWatch[\"tsc --watch\u003cbr/\u003eIncremental compilation\"]\n    watchExtensions --\u003e gulpWatch[\"Gulp watch tasks\"]\n    \n    style npmWatch fill:#e1f5ff\n    style watchClient fill:#ffe1e1\n    style watchExtensions fill:#e1ffe1\n```\n\n**Sources:** [package.json:23-35](), [package.json:56-57]()\n\n### Watch Script Details\n\nThe watch system uses `npm-run-all` [package.json:23]() to run multiple watch tasks in parallel:\n\n```\n\"watch\": \"npm-run-all -lp watch-client watch-extensions\"\n```\n\nThe `-lp` flags mean:\n- `-l`: Prepend package name to output\n- `-p`: Run tasks in parallel\n\nThe `deemon` package [package.json:162]() provides daemon management, allowing watch processes to run in the background and survive terminal sessions.\n\n**Sources:** [package.json:23-35]()\n\n## Testing Infrastructure\n\nVS Code has a comprehensive testing infrastructure covering unit tests, integration tests, and end-to-end smoke tests.\n\n### Test Types and Commands\n\n```mermaid\ngraph TB\n    subgraph \"Unit Tests\"\n        testBrowser[\"npm run test-browser\u003cbr/\u003eBrowser unit tests\u003cbr/\u003ePlaywright + Mocha\"]\n        testNode[\"npm run test-node\u003cbr/\u003eNode.js unit tests\u003cbr/\u003eMocha\"]\n    end\n    \n    subgraph \"Integration Tests\"\n        testExtension[\"npm run test-extension\u003cbr/\u003eExtension integration tests\u003cbr/\u003e@vscode/test-cli\"]\n        testBuildScripts[\"npm run test-build-scripts\u003cbr/\u003eBuild script tests\"]\n    end\n    \n    subgraph \"Smoke Tests\"\n        smoketest[\"npm run smoketest\u003cbr/\u003eEnd-to-end UI tests\u003cbr/\u003etest/smoke\"]\n        smoketestNoCompile[\"npm run smoketest-no-compile\u003cbr/\u003eRun smoke tests without compilation\"]\n    end\n    \n    testBrowser --\u003e playwright[\"@playwright/test\u003cbr/\u003eBrowser automation\"]\n    testNode --\u003e mocha[\"mocha test runner\"]\n    testExtension --\u003e vscodeTest[\"@vscode/test-cli\u003cbr/\u003eExtension test harness\"]\n    smoketest --\u003e automation[\"test/automation\u003cbr/\u003eUI automation framework\"]\n    \n    style testBrowser fill:#e1f5ff\n    style testExtension fill:#ffe1e1\n    style smoketest fill:#e1ffe1\n```\n\n**Sources:** [package.json:13-18](), [package.json:43-44]()\n\n### Test Configuration\n\n| Test Type | Command | Framework | Purpose |\n|-----------|---------|-----------|---------|\n| Browser Unit | `test-browser` | Playwright + Mocha | Test browser-compatible code in headless browser |\n| Node Unit | `test-node` | Mocha | Test Node.js-specific code |\n| Extension Integration | `test-extension` | `@vscode/test-cli` | Test extension API integration |\n| Build Scripts | `test-build-scripts` | Mocha | Validate build tooling |\n| Smoke Tests | `smoketest` | Custom automation | End-to-end UI testing |\n\nThe browser test setup [package.json:14]() first installs Playwright browsers:\n```\n\"test-browser\": \"npx playwright install \u0026\u0026 node test/unit/browser/index.js\"\n```\n\n**Sources:** [package.json:13-18](), [test/smoke/package.json](), [test/automation/package.json]()\n\n### Test Suite Structure\n\nThe test suites are organized in separate packages with their own dependencies:\n\n- **test/automation** [test/automation/package.json]() - UI automation driver used by smoke tests\n- **test/smoke** [test/smoke/package.json]() - End-to-end smoke test scenarios\n- **test/integration/browser** [test/integration/browser/package.json]() - Browser integration tests\n\n**Sources:** [test/automation/package.json:1-34](), [test/smoke/package.json:1-23]()\n\n## Quality Checks and Validation\n\nVS Code enforces code quality through multiple automated checks that run during development and in CI.\n\n### Quality Check System\n\n```mermaid\ngraph TB\n    subgraph \"Pre-commit Checks\"\n        precommit[\"npm run precommit\u003cbr/\u003ebuild/hygiene.ts\u003cbr/\u003eRun before git commit\"]\n    end\n    \n    subgraph \"Linting\"\n        eslint[\"npm run eslint\u003cbr/\u003ebuild/eslint.ts\u003cbr/\u003eJavaScript/TypeScript style\"]\n        stylelint[\"npm run stylelint\u003cbr/\u003ebuild/stylelint.ts\u003cbr/\u003eCSS style\"]\n    end\n    \n    subgraph \"Architecture Validation\"\n        validLayers[\"npm run valid-layers-check\u003cbr/\u003eLayer isolation validation\"]\n        layerChecker[\"build/checker/layersChecker.ts\u003cbr/\u003eEnforce architectural boundaries\"]\n        layerConfigs[\"Multiple tsconfig files\u003cbr/\u003ebrowser, node, electron-main, etc.\"]\n    end\n    \n    subgraph \"Code Quality Checks\"\n        hygiene[\"npm run hygiene\u003cbr/\u003egulp hygiene task\"]\n        hygieneChecks[\"Copyright headers\u003cbr/\u003eIndentation\u003cbr/\u003eFile consistency\"]\n    end\n    \n    subgraph \"Security Validation\"\n        tsec[\"npm run tsec-compile-check\u003cbr/\u003etsec security analyzer\"]\n        defineClassFields[\"npm run define-class-fields-check\u003cbr/\u003eClass initialization order\"]\n    end\n    \n    precommit --\u003e hygiene\n    validLayers --\u003e layerChecker\n    layerChecker --\u003e layerConfigs\n    hygiene --\u003e hygieneChecks\n    eslint --\u003e eslintTool[\"eslint with custom rules\"]\n    stylelint --\u003e stylelintTool[\"stylelint\"]\n    \n    style precommit fill:#e1f5ff\n    style validLayers fill:#ffe1e1\n    style hygiene fill:#e1ffe1\n```\n\n**Sources:** [package.json:36](), [package.json:50-51](), [package.json:58-59](), [package.json:66]()\n\n### Layer Validation\n\nThe `valid-layers-check` script [package.json:50]() enforces architectural boundaries by ensuring code in different layers only imports from allowed layers:\n\n1. Runs `layersChecker.ts` to validate dependency rules\n2. Compiles each layer's TypeScript configuration to verify isolation:\n   - `tsconfig.browser.json` - Browser-only code\n   - `tsconfig.worker.json` - Web Worker code\n   - `tsconfig.node.json` - Node.js code\n   - `tsconfig.electron-browser.json` - Electron renderer process\n   - `tsconfig.electron-main.json` - Electron main process\n   - `tsconfig.electron-utility.json` - Electron utility process\n\nThis prevents accidental use of Node.js APIs in browser code or Electron APIs in Node.js code.\n\n**Sources:** [package.json:50](), [build/checker/tsconfig.browser.json]()\n\n### Hygiene Checks\n\nThe hygiene check [package.json:36]() runs `build/hygiene.ts` which validates:\n- Copyright headers on all source files\n- Consistent indentation (tabs vs spaces)\n- File encoding (UTF-8)\n- Line endings (LF vs CRLF)\n- No trailing whitespace\n\n**Sources:** [package.json:36](), [package.json:66]()\n\n### ESLint Configuration\n\nVS Code uses a custom ESLint configuration [package.json:58]() that runs via `build/eslint.ts`. The project uses:\n- `eslint` v9 [package.json:164]()\n- `typescript-eslint` [package.json:217]()\n- `@stylistic/eslint-plugin-ts` [package.json:124]() for stylistic rules\n- Custom plugins: `eslint-plugin-header` [package.json:166](), `eslint-plugin-jsdoc` [package.json:167]()\n\n**Sources:** [package.json:58](), [package.json:164-167]()\n\n## CI Task Bundles\n\nThe CI system uses bundled tasks that combine multiple checks for efficient validation in different contexts.\n\n### CI Task Structure\n\n```mermaid\ngraph TB\n    subgraph \"Core CI Tasks\"\n        coreCI[\"gulp core-ci\u003cbr/\u003eFull core validation\"]\n        coreCIPR[\"gulp core-ci-pr\u003cbr/\u003ePR validation\"]\n    end\n    \n    subgraph \"Extension CI Tasks\"\n        extensionsCI[\"gulp extensions-ci\u003cbr/\u003eFull extension validation\"]\n        extensionsCIPR[\"gulp extensions-ci-pr\u003cbr/\u003ePR extension validation\"]\n    end\n    \n    coreCI --\u003e compile[\"Compilation\"]\n    coreCI --\u003e hygiene[\"Hygiene checks\"]\n    coreCI --\u003e eslint[\"ESLint\"]\n    coreCI --\u003e tests[\"Unit tests\"]\n    \n    coreCIPR --\u003e quickChecks[\"Subset of core-ci\u003cbr/\u003efor faster PR feedback\"]\n    \n    extensionsCI --\u003e extensionCompile[\"Extension compilation\"]\n    extensionsCI --\u003e extensionTests[\"Extension tests\"]\n    \n    style coreCI fill:#e1f5ff\n    style extensionsCI fill:#ffe1e1\n```\n\n**Sources:** [package.json:67-70]()\n\nThe CI tasks provide different validation levels:\n- **core-ci**: Full validation of core VS Code code\n- **core-ci-pr**: Fast validation for pull requests\n- **extensions-ci**: Full validation of built-in extensions\n- **extensions-ci-pr**: Fast validation for extension PRs\n\n## Build Script Organization\n\nBuild-related scripts are organized in the `build/` directory with their own package.json and dependencies.\n\n### Build Package Structure\n\nThe [build/package.json]() defines build-specific dependencies and scripts:\n\n```mermaid\ngraph TB\n    subgraph \"Build Package Dependencies\"\n        esbuild[\"esbuild 0.25.5\u003cbr/\u003eFast JavaScript bundler\"]\n        electron[\"@electron/get\u003cbr/\u003eDownload Electron\"]\n        gulp[\"gulp packages\u003cbr/\u003eTask utilities\"]\n        azure[\"@azure packages\u003cbr/\u003eCloud storage\"]\n    end\n    \n    subgraph \"Build Scripts\"\n        typecheck[\"npm run typecheck\u003cbr/\u003eType-check build scripts\"]\n        watch[\"npm run watch\u003cbr/\u003eWatch build scripts\"]\n        test[\"npm run test\u003cbr/\u003eTest build scripts\"]\n    end\n    \n    subgraph \"Build Utilities\"\n        copyPolicyDto[\"copy-policy-dto\u003cbr/\u003elib/policies/copyPolicyDto.ts\"]\n        libScripts[\"Various lib/*.ts scripts\u003cbr/\u003eBuild utilities\"]\n    end\n    \n    typecheck --\u003e tsgo[\"tsgo --project build/tsconfig.json\"]\n    watch --\u003e tscWatch[\"tsc --watch\"]\n    test --\u003e mocha[\"mocha test runner\"]\n    \n    style esbuild fill:#e1f5ff\n    style typecheck fill:#ffe1e1\n```\n\n**Sources:** [build/package.json:1-82]()\n\n### Key Build Dependencies\n\n| Dependency | Version | Purpose |\n|------------|---------|---------|\n| `esbuild` | 0.25.5 | Fast JavaScript bundling |\n| `@electron/get` | ^2.0.0 | Download Electron binaries |\n| `@electron/osx-sign` | ^2.0.0 | macOS code signing |\n| `@azure/storage-blob` | ^12.25.0 | Azure Blob storage for artifacts |\n| `gulp-*` | Various | Gulp plugins for build tasks |\n| `tree-sitter` | ^0.22.4 | Parser generator for syntax highlighting |\n\n**Sources:** [build/package.json:5-63]()\n\n## Native Module Compilation\n\nNative modules require special compilation configuration. The build system uses different configurations for desktop and remote scenarios.\n\n### NPM Configuration Files\n\nThe project uses multiple `.npmrc` files for different compilation targets:\n\n- **Root `.npmrc`** [.npmrc:1-7]() - Electron-based desktop compilation:\n  ```\n  disturl=\"https://electronjs.org/headers\"\n  target=\"39.2.7\"\n  runtime=\"electron\"\n  ```\n\n- **Remote `.npmrc`** [remote/.npmrc:1-7]() - Node.js-based remote server compilation:\n  ```\n  disturl=\"https://nodejs.org/dist\"\n  target=\"22.21.1\"\n  runtime=\"node\"\n  ```\n\nBoth configurations set:\n- `build_from_source=\"true\"` - Compile native modules from source\n- `legacy-peer-deps=\"true\"` - Use legacy peer dependency resolution\n- `timeout=180000` - 3-minute timeout for slow module builds\n\n**Sources:** [.npmrc:1-7](), [remote/.npmrc:1-7]()\n\n### Node.js Version Management\n\nThe project pins the Node.js version using [.nvmrc:1]():\n```\n22.21.1\n```\n\nThis ensures consistent builds across development machines and CI environments.\n\n**Sources:** [.nvmrc:1]()\n\n### Native Module Cleanup\n\nThe build system includes cleanup rules for native modules:\n\n- [build/.moduleignore]() - Rules for cleaning desktop `node_modules`\n- [build/.webignore]() - Rules for cleaning web `node_modules`\n\nThese files specify which files to keep/remove from each native module after compilation, reducing bundle size by removing source files, build artifacts, and documentation.\n\n**Sources:** [build/.moduleignore:1-191](), [build/.webignore:1-65]()\n\n## Platform-Specific Build Setup\n\nLinux builds require additional setup for cross-compilation and dependency management.\n\n### Linux Build Environment Setup\n\nThe [build/azure-pipelines/linux/setup-env.sh]() script configures the Linux build environment:\n\n1. **Downloads sysroots** for cross-compilation:\n   - Client sysroot: `glibc-2.28-gcc-10.5.0`\n   - Remote sysroot: `glibc-2.28-gcc-8.5.0`\n\n2. **For x64 builds**, downloads and configures:\n   - Chromium's Clang toolchain\n   - libcxx headers and objects from Electron\n   - Sets up compiler flags matching Chromium's configuration\n\n3. **For ARM builds** (arm64/armv7l), configures:\n   - Cross-compilation toolchains\n   - Sysroot paths for target architecture\n\n**Sources:** [build/azure-pipelines/linux/setup-env.sh:1-78]()\n\n### Linux Dependency Generation\n\nThe [build/linux/dependencies-generator.ts]() generates package dependencies for `.deb` and `.rpm` packages by:\n\n1. Finding all `.node` native modules\n2. Analyzing shared library dependencies\n3. Mapping to distribution package names\n4. Validating against reference dependency lists\n5. Excluding bundled dependencies (libEGL, libGLESv2, libvulkan, libffmpeg)\n\n**Sources:** [build/linux/dependencies-generator.ts:1-116]()\n\n## Checksums and Binary Verification\n\nThe build system maintains checksums for downloaded binaries to ensure reproducibility and security.\n\n### Electron Checksums\n\nThe [build/checksums/electron.txt]() file contains SHA256 checksums for all Electron binaries across platforms and architectures, including:\n- Application binaries (darwin-arm64, darwin-x64, linux-*, win32-*, mas-*)\n- Debug symbols and symbol files\n- Chromedrivers for testing\n- FFmpeg libraries\n- mksnapshot tools\n\n**Sources:** [build/checksums/electron.txt:1-76]()\n\n### Node.js Checksums\n\nThe [build/checksums/nodejs.txt]() file contains checksums for Node.js binaries used in the remote server, covering all target platforms.\n\n**Sources:** [build/checksums/nodejs.txt:1-8]()\n\n## Component Graph Manifest\n\nThe [cgmanifest.json]() file documents third-party components included in VS Code, particularly Chromium and FFmpeg versions with their licenses. This is used for compliance and legal purposes.\n\n**Sources:** [cgmanifest.json:1-660]()"])</script><script>self.__next_f.push([1,"1c:T4b35,"])</script><script>self.__next_f.push([1,"# Code Quality and Linting\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [.npmrc](.npmrc)\n- [.nvmrc](.nvmrc)\n- [build/.moduleignore](build/.moduleignore)\n- [build/.webignore](build/.webignore)\n- [build/azure-pipelines/linux/setup-env.sh](build/azure-pipelines/linux/setup-env.sh)\n- [build/azure-pipelines/linux/verify-glibc-requirements.sh](build/azure-pipelines/linux/verify-glibc-requirements.sh)\n- [build/checksums/electron.txt](build/checksums/electron.txt)\n- [build/checksums/nodejs.txt](build/checksums/nodejs.txt)\n- [build/darwin/create-universal-app.ts](build/darwin/create-universal-app.ts)\n- [build/gulpfile.vscode.ts](build/gulpfile.vscode.ts)\n- [build/linux/dependencies-generator.ts](build/linux/dependencies-generator.ts)\n- [build/npm/postinstall.ts](build/npm/postinstall.ts)\n- [build/package.json](build/package.json)\n- [cgmanifest.json](cgmanifest.json)\n- [eslint.config.js](eslint.config.js)\n- [extensions/esbuild-webview-common.mjs](extensions/esbuild-webview-common.mjs)\n- [extensions/package-lock.json](extensions/package-lock.json)\n- [extensions/package.json](extensions/package.json)\n- [package-lock.json](package-lock.json)\n- [package.json](package.json)\n- [remote/.npmrc](remote/.npmrc)\n- [remote/package-lock.json](remote/package-lock.json)\n- [remote/package.json](remote/package.json)\n- [remote/web/package-lock.json](remote/web/package-lock.json)\n- [remote/web/package.json](remote/web/package.json)\n- [src/vs/base/parts/contextmenu/electron-main/contextmenu.ts](src/vs/base/parts/contextmenu/electron-main/contextmenu.ts)\n- [src/vs/platform/environment/test/node/nativeModules.integrationTest.ts](src/vs/platform/environment/test/node/nativeModules.integrationTest.ts)\n\n\u003c/details\u003e\n\n\n\nThis document describes the code quality and linting infrastructure in VS Code. It covers ESLint configuration, custom lint rules, TypeScript type checking, code layering validation, and automated hygiene checks that ensure code quality and architectural consistency.\n\nFor information about the build pipeline that executes these checks, see [Build Tasks and Scripts](#2.3). For native module compilation requirements, see [Native Modules and Cross-Platform Builds](#2.2).\n\n## Overview\n\nVS Code's code quality system enforces multiple layers of validation:\n\n- **ESLint** with custom plugins for code style and architectural rules\n- **TypeScript** compiler checks with strict configurations\n- **Custom linters** for layering boundaries, localization, and VS Code-specific patterns\n- **Hygiene checks** that run during build and pre-commit\n- **Security checks** using tsec for trusted types validation\n\n```mermaid\ngraph TB\n    subgraph \"Developer Actions\"\n        Write[Write Code]\n        Commit[Git Commit]\n        Build[Run Build]\n    end\n    \n    subgraph \"Quality Gates\"\n        PreCommit[\"precommit script\u003cbr/\u003ebuild/hygiene.ts\"]\n        ESLint[\"eslint script\u003cbr/\u003ebuild/eslint.ts\"]\n        StyleLint[\"stylelint script\u003cbr/\u003ebuild/stylelint.ts\"]\n        Hygiene[\"hygiene gulp task\"]\n        ValidLayers[\"valid-layers-check\"]\n        TSec[\"tsec-compile-check\"]\n    end\n    \n    subgraph \"Validation Tools\"\n        ESLintConfig[\"eslint.config.js\"]\n        LocalPlugin[\".eslint-plugin-local\"]\n        TSConfig[\"tsconfig.json files\"]\n        TSChecker[\"TypeScript Compiler\"]\n    end\n    \n    Write --\u003e Commit\n    Commit --\u003e PreCommit\n    PreCommit --\u003e Hygiene\n    \n    Write --\u003e Build\n    Build --\u003e ESLint\n    Build --\u003e StyleLint\n    Build --\u003e Hygiene\n    Build --\u003e ValidLayers\n    Build --\u003e TSec\n    \n    ESLint --\u003e ESLintConfig\n    ESLint --\u003e LocalPlugin\n    ValidLayers --\u003e TSChecker\n    ValidLayers --\u003e TSConfig\n    TSec --\u003e TSChecker\n```\n\n**Sources:** [package.json:12-73](), [eslint.config.js:1-900]()\n\n## ESLint Configuration Structure\n\nThe ESLint configuration is defined in [eslint.config.js]() using the TypeScript ESLint flat config format.\n\n```mermaid\ngraph TB\n    Config[\"eslint.config.js\"]\n    \n    subgraph \"Parsers and Plugins\"\n        TSParser[\"typescript-eslint parser\"]\n        StylisticPlugin[\"@stylistic/eslint-plugin-ts\"]\n        LocalPlugin[\".eslint-plugin-local\"]\n        HeaderPlugin[\"eslint-plugin-header\"]\n        JsdocPlugin[\"eslint-plugin-jsdoc\"]\n    end\n    \n    subgraph \"Configuration Sets\"\n        GlobalRules[\"Global Rules\u003cbr/\u003eAll JS/TS files\"]\n        TSRules[\"TypeScript Rules\u003cbr/\u003e*.ts files\"]\n        VSCodeRules[\"VS Code Rules\u003cbr/\u003esrc/**/*.ts\"]\n        InOperatorRules[\"In Operator Rules\u003cbr/\u003eSpecific files\"]\n        StrictAnyRules[\"Strict No Any Rules\u003cbr/\u003eSelected extensions\"]\n    end\n    \n    subgraph \"Ignored Files\"\n        ESLintIgnore[\".eslint-ignore\u003cbr/\u003eBuild artifacts\u003cbr/\u003enode_modules\u003cbr/\u003eout/\"]\n    end\n    \n    Config --\u003e TSParser\n    Config --\u003e StylisticPlugin\n    Config --\u003e LocalPlugin\n    Config --\u003e HeaderPlugin\n    Config --\u003e JsdocPlugin\n    \n    Config --\u003e GlobalRules\n    Config --\u003e TSRules\n    Config --\u003e VSCodeRules\n    Config --\u003e InOperatorRules\n    Config --\u003e StrictAnyRules\n    \n    Config --\u003e ESLintIgnore\n```\n\n**Sources:** [eslint.config.js:1-30](), [eslint.config.js:32-132](), [eslint.config.js:134-161]()\n\n### Key Configuration Elements\n\n| Configuration Section | File Patterns | Purpose |\n|----------------------|---------------|---------|\n| Global Rules | All files | Basic code quality and style rules |\n| TypeScript Rules | `**/*.{ts,tsx,mts,cts}` | TypeScript-specific linting |\n| VS Code Rules | `src/**/*.ts` | Naming conventions for core source |\n| In Operator Rules | Most TS files (with exceptions) | Disallow `in` operator except in type predicates |\n| Strict No Any | Extensions and `src/**/*.ts` | Prohibit explicit `any` types |\n\nThe configuration uses a `.eslint-ignore` file to exclude generated files, build artifacts, and third-party code:\n\n**Sources:** [eslint.config.js:17-28](), [eslint.config.js:134-161](), [eslint.config.js:344-900]()\n\n## Custom ESLint Rules\n\nVS Code implements numerous custom ESLint rules via the `.eslint-plugin-local` plugin. These enforce VS Code-specific coding patterns and architectural constraints.\n\n```mermaid\ngraph LR\n    subgraph \"Local Plugin Rules\"\n        Translation[\"code-translation-remind\"]\n        NativePrivate[\"code-no-native-private\"]\n        ParamProps[\"code-parameter-properties-must-have-explicit-accessibility\"]\n        NLS[\"code-no-nls-in-standalone-editor\"]\n        Disposables[\"code-no-potentially-unsafe-disposables\"]\n        TypeAssert[\"code-no-dangerous-type-assertions\"]\n        AnyCasts[\"code-no-any-casts\"]\n        StandaloneEditor[\"code-no-standalone-editor\"]\n        Unexternalized[\"code-no-unexternalized-strings\"]\n        SuperDispose[\"code-must-use-super-dispose\"]\n        ServiceBrand[\"code-declare-service-brand\"]\n        ReaderAfterAwait[\"code-no-reader-after-await\"]\n        ObservableReactive[\"code-no-observable-get-in-reactive-context\"]\n        LocalizedModel[\"code-no-localized-model-description\"]\n        PolicyLocalization[\"code-policy-localization-key-match\"]\n        LocalizationLiterals[\"code-no-localization-template-literals\"]\n        DeepImport[\"code-no-deep-import-of-internal\"]\n        Layering[\"code-layering\"]\n        UnusedExpr[\"code-no-unused-expressions\"]\n        StaticSelfRef[\"code-no-static-self-ref\"]\n        InOperator[\"code-no-in-operator\"]\n    end\n```\n\n**Sources:** [eslint.config.js:79-96](), [eslint.config.js:152-159](), [eslint.config.js:340-342]()\n\n### Critical Custom Rules\n\n| Rule | Severity | Purpose |\n|------|----------|---------|\n| `code-layering` | warn | Enforces architectural layer boundaries |\n| `code-no-localization-template-literals` | error | Prevents template literals in localization |\n| `code-no-deep-import-of-internal` | error | Prevents importing internal APIs |\n| `code-must-use-super-dispose` | warn | Ensures proper disposal in inheritance |\n| `code-declare-service-brand` | warn | Enforces service brand declarations for DI |\n| `code-no-unexternalized-strings` | warn | Ensures strings are localized |\n\n**Sources:** [eslint.config.js:79-96]()\n\n## Code Layering Architecture\n\nVS Code enforces strict layering rules to maintain architectural boundaries between different execution contexts.\n\n```mermaid\ngraph TB\n    subgraph \"Layer Hierarchy\"\n        Common[\"common\u003cbr/\u003ePure TypeScript\u003cbr/\u003eNo dependencies\"]\n        Node[\"node\u003cbr/\u003eNode.js APIs\u003cbr/\u003eUses: common\"]\n        Browser[\"browser\u003cbr/\u003eBrowser APIs\u003cbr/\u003eUses: common\"]\n        ElectronBrowser[\"electron-browser\u003cbr/\u003eElectron Renderer\u003cbr/\u003eUses: common, browser\"]\n        ElectronUtility[\"electron-utility\u003cbr/\u003eElectron Utility Process\u003cbr/\u003eUses: common, node\"]\n        ElectronMain[\"electron-main\u003cbr/\u003eElectron Main Process\u003cbr/\u003eUses: common, node, electron-utility\"]\n    end\n    \n    Common\n    Common --\u003e Node\n    Common --\u003e Browser\n    Browser --\u003e ElectronBrowser\n    Node --\u003e ElectronUtility\n    Node --\u003e ElectronMain\n    ElectronUtility --\u003e ElectronMain\n    \n    style Common fill:#f9f9f9\n    style Node fill:#f9f9f9\n    style Browser fill:#f9f9f9\n    style ElectronBrowser fill:#f9f9f9\n    style ElectronUtility fill:#f9f9f9\n    style ElectronMain fill:#f9f9f9\n```\n\n**Sources:** [eslint.config.js:96-120]()\n\nThe `code-layering` rule configuration in [eslint.config.js:96-120]() defines these dependencies:\n\n```javascript\n'local/code-layering': [\n    'warn',\n    {\n        'common': [],\n        'node': ['common'],\n        'browser': ['common'],\n        'electron-browser': ['common', 'browser'],\n        'electron-utility': ['common', 'node'],\n        'electron-main': ['common', 'node', 'electron-utility']\n    }\n]\n```\n\nThis ensures that:\n- `common` code has no platform dependencies\n- `node` and `browser` code only depends on `common`\n- `electron-*` layers properly separate concerns\n\nThe layering is validated by the `valid-layers-check` script:\n\n**Sources:** [package.json:51](), [eslint.config.js:96-120]()\n\n## TypeScript Compilation Checks\n\nMultiple TypeScript compilation checks ensure type safety across different build targets:\n\n```mermaid\ngraph TB\n    subgraph \"TypeScript Check Scripts\"\n        MonacoCheck[\"monaco-compile-check\u003cbr/\u003esrc/tsconfig.monaco.json\"]\n        TSECCheck[\"tsec-compile-check\u003cbr/\u003esrc/tsconfig.tsec.json\"]\n        VSCodeDTSCheck[\"vscode-dts-compile-check\u003cbr/\u003etsconfig.vscode-dts.json\u003cbr/\u003etsconfig.vscode-proposed-dts.json\"]\n        LayersCheck[\"valid-layers-check\u003cbr/\u003eMultiple layer tsconfigs\"]\n        DefineClassFields[\"define-class-fields-check\u003cbr/\u003etsconfig.defineClassFields.json\"]\n    end\n    \n    subgraph \"Layer Configs\"\n        BrowserConfig[\"tsconfig.browser.json\"]\n        WorkerConfig[\"tsconfig.worker.json\"]\n        NodeConfig[\"tsconfig.node.json\"]\n        ElectronBrowserConfig[\"tsconfig.electron-browser.json\"]\n        ElectronMainConfig[\"tsconfig.electron-main.json\"]\n        ElectronUtilityConfig[\"tsconfig.electron-utility.json\"]\n    end\n    \n    LayersCheck --\u003e BrowserConfig\n    LayersCheck --\u003e WorkerConfig\n    LayersCheck --\u003e NodeConfig\n    LayersCheck --\u003e ElectronBrowserConfig\n    LayersCheck --\u003e ElectronMainConfig\n    LayersCheck --\u003e ElectronUtilityConfig\n```\n\n**Sources:** [package.json:48-52]()\n\n### Check Purposes\n\n| Check Script | Purpose |\n|--------------|---------|\n| `monaco-compile-check` | Validates Monaco editor standalone build |\n| `tsec-compile-check` | Runs security-focused TypeScript checker (trusted types) |\n| `vscode-dts-compile-check` | Validates extension API type definitions |\n| `valid-layers-check` | Ensures layer boundaries via separate tsconfig files |\n| `define-class-fields-check` | Validates class field initialization order |\n\n**Sources:** [package.json:48-52]()\n\n## Header and Copyright Enforcement\n\nAll source files must include the standard Microsoft copyright header, enforced by the `eslint-plugin-header`:\n\n```javascript\n'header/header': [\n    2,\n    'block',\n    [\n        '---------------------------------------------------------------------------------------------',\n        ' *  Copyright (c) Microsoft Corporation. All rights reserved.',\n        ' *  Licensed under the MIT License. See License.txt in the project root for license information.',\n        ' *--------------------------------------------------------------------------------------------'\n    ]\n]\n```\n\n**Sources:** [eslint.config.js:121-131]()\n\n## Hygiene Checks\n\nThe hygiene system performs additional code quality checks beyond ESLint:\n\n```mermaid\ngraph TB\n    subgraph \"Hygiene System\"\n        PreCommit[\"precommit hook\u003cbr/\u003epackage.json script\"]\n        HygieneTS[\"build/hygiene.ts\"]\n        GulpHygiene[\"hygiene gulp task\"]\n    end\n    \n    subgraph \"Checks Performed\"\n        Indentation[\"Indentation validation\"]\n        Copyright[\"Copyright headers\"]\n        BOM[\"UTF-8 BOM presence\"]\n        EOL[\"End-of-line consistency\"]\n        TrailingWhitespace[\"Trailing whitespace\"]\n        ESLintRun[\"ESLint execution\"]\n        TSLintExt[\"Extension TSLint checks\"]\n    end\n    \n    PreCommit --\u003e HygieneTS\n    GulpHygiene --\u003e HygieneTS\n    \n    HygieneTS --\u003e Indentation\n    HygieneTS --\u003e Copyright\n    HygieneTS --\u003e BOM\n    HygieneTS --\u003e EOL\n    HygieneTS --\u003e TrailingWhitespace\n    HygieneTS --\u003e ESLintRun\n    HygieneTS --\u003e TSLintExt\n```\n\n**Sources:** [package.json:36](), [package.json:67]()\n\nThe `hygiene` gulp task is invoked by:\n- Pre-commit hooks via `npm run precommit`\n- CI pipelines via `npm run hygiene`\n- Manual execution during development\n\n**Sources:** [package.json:36](), [package.json:67]()\n\n## Build-Time Quality Enforcement\n\nCode quality checks are integrated into the build pipeline:\n\n```mermaid\ngraph LR\n    subgraph \"Build Scripts\"\n        CoreCI[\"core-ci\u003cbr/\u003eMain build validation\"]\n        CoreCIPR[\"core-ci-pr\u003cbr/\u003ePR validation\"]\n        ExtensionsCI[\"extensions-ci\u003cbr/\u003eExtension validation\"]\n        ExtensionsCIPR[\"extensions-ci-pr\u003cbr/\u003eExtension PR validation\"]\n    end\n    \n    subgraph \"Quality Checks\"\n        ESLintTask[\"ESLint\"]\n        StyleLintTask[\"StyleLint\"]\n        HygieneTask[\"Hygiene\"]\n        TSCompile[\"TypeScript Compilation\"]\n        LayerValidation[\"Layer Validation\"]\n    end\n    \n    CoreCI --\u003e ESLintTask\n    CoreCI --\u003e HygieneTask\n    CoreCI --\u003e TSCompile\n    CoreCI --\u003e LayerValidation\n    \n    CoreCIPR --\u003e ESLintTask\n    CoreCIPR --\u003e HygieneTask\n    \n    ExtensionsCI --\u003e ESLintTask\n    ExtensionsCI --\u003e TSCompile\n    \n    ExtensionsCIPR --\u003e ESLintTask\n```\n\n**Sources:** [package.json:68-71]()\n\n## Execution Flow\n\nThe following diagram shows how quality checks are triggered in different workflows:\n\n```mermaid\nsequenceDiagram\n    participant Dev as Developer\n    participant Git as Git Hook\n    participant NPM as npm scripts\n    participant Gulp as Gulp Tasks\n    participant Tools as Linting Tools\n    \n    Dev-\u003e\u003eGit: git commit\n    Git-\u003e\u003eNPM: precommit hook\n    NPM-\u003e\u003eGulp: hygiene task\n    Gulp-\u003e\u003eTools: Run hygiene.ts\n    Tools--\u003e\u003eDev: Report violations\n    \n    Dev-\u003e\u003eNPM: npm run eslint\n    NPM-\u003e\u003eTools: build/eslint.ts\n    Tools-\u003e\u003eTools: ESLint with config\n    Tools--\u003e\u003eDev: Report errors\n    \n    Dev-\u003e\u003eNPM: npm run valid-layers-check\n    NPM-\u003e\u003eGulp: Check layers\n    Gulp-\u003e\u003eTools: TypeScript compile per layer\n    Tools--\u003e\u003eDev: Report violations\n```\n\n**Sources:** [package.json:36](), [package.json:59](), [package.json:51]()\n\n## Configuration Files Summary\n\n| File | Purpose |\n|------|---------|\n| [eslint.config.js]() | Main ESLint configuration with custom rules |\n| [.eslint-ignore]() | Files excluded from ESLint checking |\n| [.eslint-plugin-local/]() | Custom ESLint rules specific to VS Code |\n| [build/hygiene.ts]() | Additional code hygiene checks |\n| [build/eslint.ts]() | ESLint execution script |\n| [build/stylelint.ts]() | CSS/LESS linting script |\n| [tsconfig.*.json]() | TypeScript configurations for different layers |\n| [build/.moduleignore]() | Patterns for excluding modules from native builds |\n| [build/.webignore]() | Patterns for excluding files from web builds |\n\n**Sources:** [eslint.config.js:1-900](), [package.json:59-60](), [package.json:36](), [build/.moduleignore:1-191](), [build/.webignore:1-65]()\n\n## Style Checking\n\nIn addition to ESLint, VS Code uses StyleLint for CSS and LESS files:\n\n```bash\nnpm run stylelint\n```\n\nThis executes [build/stylelint.ts]() which validates styling files according to the project's style guidelines.\n\n**Sources:** [package.json:60]()\n\n## Native Module Quality Checks\n\nNative modules require additional validation to ensure they're built correctly for each platform. The [build/azure-pipelines/linux/verify-glibc-requirements.sh]() script validates GLIBC version dependencies:\n\nThe script:\n1. Locates all `.node` files and executables\n2. Uses `objdump` to extract GLIBC/GLIBCXX dependencies\n3. Verifies versions don't exceed `EXPECTED_GLIBC_VERSION` and `EXPECTED_GLIBCXX_VERSION`\n4. Fails the build if unexpected dependencies are found\n\n**Sources:** [build/azure-pipelines/linux/verify-glibc-requirements.sh:1-44]()\n\n## Dependency Validation\n\nThe build system validates native dependencies to ensure compatibility:\n\n```mermaid\ngraph TB\n    subgraph \"Dependency Tests\"\n        NativeTest[\"nativeModules.integrationTest.ts\"]\n    end\n    \n    subgraph \"Tested Modules\"\n        Kerberos[\"kerberos\"]\n        Yauzl[\"yauzl\"]\n        Yazl[\"yazl\"]\n        V8Profiler[\"v8-inspect-profiler\"]\n        NativeElevated[\"native-is-elevated\"]\n        NativeKeymap[\"native-keymap\"]\n        Watchdog[\"@vscode/native-watchdog\"]\n        SudoPrompt[\"@vscode/sudo-prompt\"]\n        PolicyWatcher[\"@vscode/policy-watcher\"]\n        NodePty[\"node-pty\"]\n        Spdlog[\"@vscode/spdlog\"]\n        ParcelWatcher[\"@parcel/watcher\"]\n        DeviceId[\"@vscode/deviceid\"]\n        Ripgrep[\"@vscode/ripgrep\"]\n        SQLite[\"@vscode/sqlite3\"]\n    end\n    \n    NativeTest --\u003e Kerberos\n    NativeTest --\u003e Yauzl\n    NativeTest --\u003e Yazl\n    NativeTest --\u003e V8Profiler\n    NativeTest --\u003e NativeElevated\n    NativeTest --\u003e NativeKeymap\n    NativeTest --\u003e Watchdog\n    NativeTest --\u003e SudoPrompt\n    NativeTest --\u003e PolicyWatcher\n    NativeTest --\u003e NodePty\n    NativeTest --\u003e Spdlog\n    NativeTest --\u003e ParcelWatcher\n    NativeTest --\u003e DeviceId\n    NativeTest --\u003e Ripgrep\n    NativeTest --\u003e SQLite\n```\n\nThis test suite at [src/vs/platform/environment/test/node/nativeModules.integrationTest.ts]() ensures all native modules load correctly and expose expected APIs.\n\n**Sources:** [src/vs/platform/environment/test/node/nativeModules.integrationTest.ts:1-150]()\n\n## Summary\n\nVS Code's code quality infrastructure combines multiple layers of validation:\n\n1. **ESLint** with extensive custom rules enforces code style and architectural patterns\n2. **TypeScript** compiler validates types across different build targets and layers\n3. **Custom layering rules** maintain separation between common, node, browser, and electron code\n4. **Hygiene checks** validate formatting, copyright headers, and file consistency\n5. **Pre-commit hooks** catch issues before they enter version control\n6. **CI integration** ensures all checks pass before merging\n7. **Native module validation** confirms binary compatibility across platforms\n\nThese systems work together to maintain code quality and prevent architectural violations throughout the codebase.\n\n**Sources:** [eslint.config.js:1-900](), [package.json:12-73](), [build/.moduleignore:1-191](), [build/.webignore:1-65]()"])</script><script>self.__next_f.push([1,"1d:T8a0e,"])</script><script>self.__next_f.push([1,"# Application Lifecycle and Bootstrap\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [build/lib/i18n.resources.json](build/lib/i18n.resources.json)\n- [cli/src/bin/code/legacy_args.rs](cli/src/bin/code/legacy_args.rs)\n- [resources/completions/bash/code](resources/completions/bash/code)\n- [resources/completions/zsh/_code](resources/completions/zsh/_code)\n- [src/vs/base/node/terminalEncoding.ts](src/vs/base/node/terminalEncoding.ts)\n- [src/vs/code/browser/workbench/workbench-dev.html](src/vs/code/browser/workbench/workbench-dev.html)\n- [src/vs/code/browser/workbench/workbench.html](src/vs/code/browser/workbench/workbench.html)\n- [src/vs/code/browser/workbench/workbench.ts](src/vs/code/browser/workbench/workbench.ts)\n- [src/vs/code/electron-main/app.ts](src/vs/code/electron-main/app.ts)\n- [src/vs/code/electron-main/main.ts](src/vs/code/electron-main/main.ts)\n- [src/vs/code/node/cli.ts](src/vs/code/node/cli.ts)\n- [src/vs/code/node/cliProcessMain.ts](src/vs/code/node/cliProcessMain.ts)\n- [src/vs/platform/environment/common/argv.ts](src/vs/platform/environment/common/argv.ts)\n- [src/vs/platform/environment/common/environment.ts](src/vs/platform/environment/common/environment.ts)\n- [src/vs/platform/environment/common/environmentService.ts](src/vs/platform/environment/common/environmentService.ts)\n- [src/vs/platform/environment/electron-main/environmentMainService.ts](src/vs/platform/environment/electron-main/environmentMainService.ts)\n- [src/vs/platform/environment/node/argv.ts](src/vs/platform/environment/node/argv.ts)\n- [src/vs/platform/environment/node/argvHelper.ts](src/vs/platform/environment/node/argvHelper.ts)\n- [src/vs/platform/environment/node/environmentService.ts](src/vs/platform/environment/node/environmentService.ts)\n- [src/vs/platform/environment/node/stdin.ts](src/vs/platform/environment/node/stdin.ts)\n- [src/vs/platform/extensionManagement/common/extensionManagementCLI.ts](src/vs/platform/extensionManagement/common/extensionManagementCLI.ts)\n- [src/vs/server/node/remoteExtensionHostAgentCli.ts](src/vs/server/node/remoteExtensionHostAgentCli.ts)\n- [src/vs/server/node/server.cli.ts](src/vs/server/node/server.cli.ts)\n- [src/vs/server/node/serverEnvironmentService.ts](src/vs/server/node/serverEnvironmentService.ts)\n- [src/vs/server/node/serverServices.ts](src/vs/server/node/serverServices.ts)\n- [src/vs/workbench/browser/web.api.ts](src/vs/workbench/browser/web.api.ts)\n- [src/vs/workbench/browser/web.factory.ts](src/vs/workbench/browser/web.factory.ts)\n- [src/vs/workbench/browser/web.main.ts](src/vs/workbench/browser/web.main.ts)\n- [src/vs/workbench/electron-browser/desktop.main.ts](src/vs/workbench/electron-browser/desktop.main.ts)\n- [src/vs/workbench/services/environment/browser/environmentService.ts](src/vs/workbench/services/environment/browser/environmentService.ts)\n- [src/vs/workbench/services/environment/common/environmentService.ts](src/vs/workbench/services/environment/common/environmentService.ts)\n- [src/vs/workbench/services/environment/electron-browser/environmentService.ts](src/vs/workbench/services/environment/electron-browser/environmentService.ts)\n- [src/vs/workbench/services/extensions/electron-browser/nativeExtensionService.ts](src/vs/workbench/services/extensions/electron-browser/nativeExtensionService.ts)\n- [src/vs/workbench/workbench.common.main.ts](src/vs/workbench/workbench.common.main.ts)\n- [src/vs/workbench/workbench.desktop.main.ts](src/vs/workbench/workbench.desktop.main.ts)\n- [src/vs/workbench/workbench.web.main.ts](src/vs/workbench/workbench.web.main.ts)\n\n\u003c/details\u003e\n\n\n\nThis page documents how VS Code initializes and starts up across different execution contexts (Electron desktop, web browser, CLI). It covers the entry points, bootstrap sequence, service initialization, and multi-process architecture setup. For information about the dependency injection system used during initialization, see [Service Initialization and Dependency Injection](#3.5). For details about specific runtime services, see [Workbench Architecture](#4).\n\n## Overview\n\nVS Code supports three primary execution modes, each with its own entry point and bootstrap sequence:\n\n1. **Electron Desktop** - Native application using Electron framework\n2. **Web** - Browser-based workbench (vscode.dev, github.dev)\n3. **CLI** - Command-line interface for extension management and tunneling\n\nThe bootstrap process follows a consistent pattern across modes:\n1. Parse command-line arguments or configuration\n2. Initialize platform services (logging, file system, configuration)\n3. Create workbench-specific services\n4. Start the workbench or execute CLI commands\n5. Spawn additional processes (extension host, pty host, etc.)\n\n**Sources:** [src/vs/code/electron-main/main.ts:78-95](), [src/vs/workbench/browser/web.main.ts:102-121](), [Diagram 1 from overview]()\n\n## Entry Points and Execution Modes\n\n```mermaid\ngraph TB\n    CLI[\"CLI Entry\u003cbr/\u003ecli.ts main()\"]\n    ElectronEntry[\"Electron Entry\u003cbr/\u003emain.ts\"]\n    WebEntry[\"Web Entry\u003cbr/\u003eworkbench.ts\"]\n    \n    CLI --\u003e ShouldSpawn{\"shouldSpawnCliProcess()?\"}\n    ShouldSpawn --\u003e|\"true\u003cbr/\u003e(extensions, mcp)\"| CliProcess[\"CliMain\u003cbr/\u003ecliProcessMain.ts\"]\n    ShouldSpawn --\u003e|\"false\"| SpawnElectron[\"Spawn Electron\u003cbr/\u003ewith arguments\"]\n    \n    ElectronEntry --\u003e CodeMainClass[\"CodeMain\u003cbr/\u003estartup()\"]\n    CodeMainClass --\u003e CreateServices[\"createServices()\"]\n    CreateServices --\u003e InitServices[\"initServices()\"]\n    InitServices --\u003e ClaimInstance[\"claimInstance()\"]\n    ClaimInstance --\u003e CodeApp[\"CodeApplication\u003cbr/\u003estartup()\"]\n    \n    WebEntry --\u003e BrowserMainClass[\"BrowserMain\u003cbr/\u003eopen()\"]\n    BrowserMainClass --\u003e InitWebServices[\"initServices()\"]\n    InitWebServices --\u003e CreateWorkbench[\"new Workbench()\"]\n    CreateWorkbench --\u003e WorkbenchStartup[\"workbench.startup()\"]\n    \n    SpawnElectron -.-\u003e ElectronEntry\n```\n\n**Entry Point Determination**\n\nVS Code determines which execution mode to use based on:\n\n| Mode | Entry File | Condition |\n|------|-----------|-----------|\n| CLI Process | `cliProcessMain.ts` | `shouldSpawnCliProcess()` returns true (extension/MCP operations) |\n| Electron Main | `main.ts` | Native desktop launch |\n| Web Workbench | `workbench.ts` | Browser context with HTML page |\n\nThe `shouldSpawnCliProcess()` function checks for specific CLI arguments:\n\n[src/vs/code/node/cli.ts:32-41]()\n\n```typescript\nfunction shouldSpawnCliProcess(argv: NativeParsedArgs): boolean {\n\treturn !!argv['install-source']\n\t\t|| !!argv['list-extensions']\n\t\t|| !!argv['install-extension']\n\t\t|| !!argv['uninstall-extension']\n\t\t|| !!argv['update-extensions']\n\t\t|| !!argv['locate-extension']\n\t\t|| !!argv['add-mcp']\n\t\t|| !!argv['telemetry'];\n}\n```\n\n**Sources:** [src/vs/code/node/cli.ts:32-41](), [src/vs/code/electron-main/main.ts:78-95](), [src/vs/workbench/browser/web.main.ts:102-114]()\n\n## Electron Main Process Startup\n\n```mermaid\ngraph TB\n    Entry[\"main.ts entry\"]\n    CodeMain[\"CodeMain instance\"]\n    \n    Entry --\u003e CodeMain\n    CodeMain --\u003e Startup[\"startup()\"]\n    \n    Startup --\u003e ErrorHandler[\"setUnexpectedErrorHandler()\"]\n    ErrorHandler --\u003e CreateSvcs[\"createServices()\"]\n    \n    CreateSvcs --\u003e ProductSvc[\"IProductService\"]\n    CreateSvcs --\u003e EnvSvc[\"EnvironmentMainService\"]\n    CreateSvcs --\u003e LoggerSvc[\"LoggerMainService\"]\n    CreateSvcs --\u003e BufferLog[\"BufferLogger\"]\n    CreateSvcs --\u003e FileSvc[\"FileService\"]\n    CreateSvcs --\u003e StateSvc[\"StateService\"]\n    CreateSvcs --\u003e UserDataProfiles[\"UserDataProfilesMainService\"]\n    CreateSvcs --\u003e PolicySvc[\"IPolicyService\"]\n    CreateSvcs --\u003e ConfigSvc[\"ConfigurationService\"]\n    \n    CreateSvcs --\u003e InitSvcs[\"initServices()\"]\n    InitSvcs --\u003e StateInit[\"stateService.init()\"]\n    InitSvcs --\u003e ConfigInit[\"configurationService.initialize()\"]\n    \n    InitSvcs --\u003e Claim[\"claimInstance()\"]\n    Claim --\u003e NodeIPC[\"NodeIPCServer\u003cbr/\u003ecreate IPC server\"]\n    Claim --\u003e CheckMutex{\"Another instance?\"}\n    CheckMutex --\u003e|\"yes\"| SendArgs[\"Send args to\u003cbr/\u003eexisting instance\"]\n    CheckMutex --\u003e|\"no\"| Lockfile[\"Write mainLockfile\"]\n    \n    Lockfile --\u003e ReplaceLogger[\"Replace BufferLogger\u003cbr/\u003ewith FileLogger\"]\n    ReplaceLogger --\u003e CodeApp[\"new CodeApplication()\"]\n    CodeApp --\u003e AppStartup[\"app.startup()\"]\n```\n\n**Service Creation Phase**\n\nThe `CodeMain.createServices()` method establishes the foundation services in a specific order:\n\n[src/vs/code/electron-main/main.ts:162-228]()\n\n1. **Product Service** - Contains build-time configuration from `product.json`\n2. **Environment Service** - Parses CLI arguments, determines paths\n3. **Logger Service** - Sets up logging infrastructure\n4. **File Service** - Registers file system providers (initially just disk provider)\n5. **State Service** - Manages persistent application state\n6. **User Data Profiles** - Handles profile isolation\n7. **Policy Service** - Platform-specific policy enforcement (Windows registry, macOS plist, Linux file)\n8. **Configuration Service** - User settings management\n\nThese services are registered in a `ServiceCollection` and provided to an `InstantiationService` for dependency injection.\n\n**Instance Claiming**\n\nThe `claimInstance()` method ensures only one VS Code instance runs per user data directory:\n\n[src/vs/code/electron-main/main.ts:129](), [src/vs/code/electron-main/main.ts:278-398]()\n\n```mermaid\ngraph LR\n    Claim[\"claimInstance()\"]\n    TryListen[\"Try to listen on\u003cbr/\u003eIPC socket\"]\n    \n    Claim --\u003e TryListen\n    TryListen --\u003e|\"Success\"| Primary[\"This is primary instance\u003cbr/\u003eReturn NodeIPCServer\"]\n    TryListen --\u003e|\"EADDRINUSE\"| Connect[\"Connect to existing\u003cbr/\u003einstance via IPC\"]\n    Connect --\u003e SendArgs[\"Send CLI args\u003cbr/\u003evia IPC\"]\n    SendArgs --\u003e WaitOrExit{\"--wait flag?\"}\n    WaitOrExit --\u003e|\"yes\"| WaitForResp[\"Wait for response\"]\n    WaitOrExit --\u003e|\"no\"| Exit[\"app.exit()\"]\n```\n\nThe IPC handle location is determined by `EnvironmentMainService.mainIPCHandle`:\n\n[src/vs/platform/environment/electron-main/environmentMainService.ts:48-61]()\n\n**Sources:** [src/vs/code/electron-main/main.ts:78-160](), [src/vs/code/electron-main/main.ts:162-228](), [src/vs/code/electron-main/main.ts:278-398]()\n\n## CodeApplication Initialization\n\n```mermaid\ngraph TB\n    CodeAppCtor[\"CodeApplication\u003cbr/\u003econstructor\"]\n    \n    CodeAppCtor --\u003e ConfigSession[\"configureSession()\"]\n    ConfigSession --\u003e Permissions[\"Set Electron\u003cbr/\u003epermission handlers\"]\n    ConfigSession --\u003e RequestFilter[\"Set webRequest\u003cbr/\u003efilters (SVG, vscode-file)\"]\n    ConfigSession --\u003e CodeCache[\"Configure V8\u003cbr/\u003ecode cache path\"]\n    \n    CodeAppCtor --\u003e RegisterListeners[\"registerListeners()\"]\n    RegisterListeners --\u003e LifecycleEvents[\"onWillShutdown\"]\n    RegisterListeners --\u003e AppEvents[\"app.on listeners\"]\n    \n    CodeAppCtor --\u003e AppStartup[\"startup()\"]\n    AppStartup --\u003e SetAppId[\"Set Windows\u003cbr/\u003eAppUserModelId\"]\n    AppStartup --\u003e ElectronServer[\"Create ElectronIPCServer\"]\n    AppStartup --\u003e ResolveMachineId[\"Resolve machineId,\u003cbr/\u003esqmId, devDeviceId\"]\n    AppStartup --\u003e SharedProc[\"setupSharedProcess()\"]\n    AppStartup --\u003e InitAppServices[\"initServices()\"]\n    \n    InitAppServices --\u003e BackupSvc[\"BackupMainService\"]\n    InitAppServices --\u003e WorkspacesSvc[\"WorkspacesMainService\"]\n    InitAppServices --\u003e HistorySvc[\"WorkspacesHistoryMainService\"]\n    InitAppServices --\u003e URLSvc[\"NativeURLService\"]\n    InitAppServices --\u003e WindowsSvc[\"WindowsMainService\"]\n    InitAppServices --\u003e DialogSvc[\"DialogMainService\"]\n    InitAppServices --\u003e MenuSvc[\"MenubarMainService\"]\n    InitAppServices --\u003e LaunchSvc[\"LaunchMainService\"]\n    \n    InitAppServices --\u003e InitChannels[\"initChannels()\"]\n    InitChannels --\u003e IpcChannels[\"Register IPC channels\u003cbr/\u003efor services\"]\n    \n    InitChannels --\u003e ProtocolHandlers[\"setupProtocolUrlHandlers()\"]\n    ProtocolHandlers --\u003e URLHandlerReg[\"Register URL handlers\"]\n    \n    ProtocolHandlers --\u003e ReadyPhase[\"LifecycleMainPhase.Ready\"]\n    ReadyPhase --\u003e OpenWindows[\"openFirstWindow()\"]\n    OpenWindows --\u003e AfterWindowOpen[\"LifecycleMainPhase\u003cbr/\u003e.AfterWindowOpen\"]\n```\n\n**Security Configuration**\n\n`CodeApplication` sets up Electron security policies in `configureSession()`:\n\n[src/vs/code/electron-main/app.ts:163-378]()\n\n- **Permission handlers** - Allow only specific permissions (pointerLock, notifications, clipboard, media, local-fonts) for core UI and webviews\n- **Request filtering** - Block SVG requests from untrusted origins, validate vscode-file and vscode-webview protocol requests\n- **Code cache** - Partition Chrome's code cache to invalidate caches when necessary\n\n**Shared Process Setup**\n\nThe shared process is started early in the bootstrap sequence:\n\n[src/vs/code/electron-main/app.ts:581](), [src/vs/platform/sharedProcess/electron-main/sharedProcess.ts]()\n\nThe `SharedProcess` class spawns a separate Electron renderer process that runs without a visible window, hosting long-running services like extension management and telemetry. It communicates with the main process via `MessagePortClient`.\n\n**Service Initialization**\n\n`CodeApplication.initServices()` creates workbench-level services:\n\n[src/vs/code/electron-main/app.ts:584-596]()\n\n| Service | Purpose |\n|---------|---------|\n| `IBackupMainService` | Manages workspace backup locations |\n| `IWorkspacesManagementMainService` | Workspace file operations |\n| `IWorkspacesHistoryMainService` | Recently opened workspaces |\n| `IURLService` | Protocol URL handling |\n| `IWindowsMainService` | Window lifecycle management |\n| `IDialogMainService` | Native dialog integration |\n| `IMenubarMainService` | Native menu bar (macOS) |\n| `ILaunchMainService` | Handles window opening requests |\n\n**Lifecycle Phases**\n\nThe main process goes through distinct phases:\n\n[src/vs/platform/lifecycle/electron-main/lifecycleMainService.ts]()\n\n1. **Starting** - Initial state\n2. **Ready** - Services initialized, before opening windows\n3. **AfterWindowOpen** - First window opened\n4. **Eventually** - Delayed tasks (2.5-5 seconds after window open)\n\n**Sources:** [src/vs/code/electron-main/app.ts:132-531](), [src/vs/code/electron-main/app.ts:532-628](), [src/vs/platform/lifecycle/electron-main/lifecycleMainService.ts]()\n\n## Web Workbench Bootstrap\n\n```mermaid\ngraph TB\n    HTMLPage[\"workbench.html\u003cbr/\u003eloaded in browser\"]\n    ScriptTag[\"workbench.ts\u003cbr/\u003escript module\"]\n    \n    HTMLPage --\u003e MetaTags[\"Parse meta tags\u003cbr/\u003evscode-workbench-web-configuration\"]\n    HTMLPage --\u003e ScriptTag\n    \n    ScriptTag --\u003e CreateFn[\"create() function\"]\n    CreateFn --\u003e BrowserMain[\"new BrowserMain()\"]\n    \n    BrowserMain --\u003e InitMethod[\"init()\"]\n    InitMethod --\u003e Fullscreen[\"setFullscreen()\"]\n    \n    BrowserMain --\u003e OpenMethod[\"open()\"]\n    OpenMethod --\u003e InitSvcs[\"initServices()\"]\n    OpenMethod --\u003e DOMReady[\"domContentLoaded()\"]\n    \n    InitSvcs --\u003e ResolveWS[\"resolveWorkspace()\"]\n    ResolveWS --\u003e WSProvider[\"IWorkspaceProvider\"]\n    WSProvider --\u003e WSType{\"Workspace type?\"}\n    WSType --\u003e|\"workspace\"| MultiRoot[\"getWorkspaceIdentifier()\"]\n    WSType --\u003e|\"folder\"| SingleFolder[\"getSingleFolderWorkspaceIdentifier()\"]\n    WSType --\u003e|\"empty\"| EmptyWS[\"UNKNOWN_EMPTY_WINDOW_WORKSPACE\"]\n    \n    InitSvcs --\u003e ProductSvc2[\"IProductService\u003cbr/\u003e(from product + config)\"]\n    InitSvcs --\u003e EnvSvc2[\"BrowserWorkbenchEnvironmentService\"]\n    InitSvcs --\u003e FileLogger[\"BufferLogger + FileLoggerService\"]\n    InitSvcs --\u003e LogSvc2[\"LogService\"]\n    \n    InitSvcs --\u003e IndexedDB[\"registerIndexedDBFileSystemProviders()\"]\n    IndexedDB --\u003e UserDataFS[\"IndexedDBFileSystemProvider\u003cbr/\u003evscode-userdata scheme\"]\n    IndexedDB --\u003e LogsFS[\"IndexedDBFileSystemProvider\u003cbr/\u003evscode-log scheme\"]\n    IndexedDB --\u003e FileAccessFS[\"HTMLFileSystemProvider\u003cbr/\u003efile scheme (if supported)\"]\n    \n    InitSvcs --\u003e RemoteAuth[\"RemoteAuthorityResolverService\"]\n    InitSvcs --\u003e SignSvc[\"SignService\"]\n    InitSvcs --\u003e UriIdentity[\"UriIdentityService\"]\n    InitSvcs --\u003e Profiles[\"BrowserUserDataProfilesService\"]\n    \n    Profiles --\u003e GetProfile[\"getCurrentProfile()\"]\n    \n    InitSvcs --\u003e RemoteAgent[\"RemoteAgentService\"]\n    RemoteAgent --\u003e SocketFactory[\"RemoteSocketFactoryService\u003cbr/\u003eBrowserSocketFactory\"]\n    \n    InitSvcs --\u003e LongRunning[\"Long-running services\"]\n    LongRunning --\u003e ConfigSvc2[\"WorkspaceService\"]\n    LongRunning --\u003e StorageSvc2[\"BrowserStorageService\"]\n    \n    ConfigSvc2 --\u003e WSInit[\"workspaceService.initialize()\"]\n    StorageSvc2 --\u003e StoreInit[\"storageService.initialize()\"]\n    \n    LongRunning --\u003e SecretsSvc[\"BrowserSecretStorageService\u003cbr/\u003eEncryptionService\"]\n    LongRunning --\u003e UserDataInit[\"UserDataInitializationService\"]\n    \n    DOMReady --\u003e CreateWB[\"new Workbench()\"]\n    CreateWB --\u003e WBStartup[\"workbench.startup()\"]\n```\n\n**Configuration Loading**\n\nWeb workbench configuration is passed via HTML meta tags:\n\n[src/vs/code/browser/workbench/workbench.html:20-23]()\n\n```html\n\u003cmeta id=\"vscode-workbench-web-configuration\" data-settings=\"{{WORKBENCH_WEB_CONFIGURATION}}\"\u003e\n\u003cmeta id=\"vscode-workbench-auth-session\" data-settings=\"{{WORKBENCH_AUTH_SESSION}}\"\u003e\n```\n\nThe `BrowserMain` constructor receives `IWorkbenchConstructionOptions`:\n\n[src/vs/workbench/browser/web.api.ts]()\n\n**IndexedDB File System**\n\nWeb VS Code uses IndexedDB as the file system backend:\n\n[src/vs/workbench/browser/web.main.ts:462-506]()\n\n| Store Name | Scheme | Purpose |\n|------------|--------|---------|\n| `vscode-userdata-store` | `vscode-userdata` | User settings, keybindings, extensions |\n| `vscode-logs-store` | `vscode-log` | Application logs |\n| `vscode-filehandles-store` | `file` | File System Access API handles (when supported) |\n\nThree `IndexedDBFileSystemProvider` instances are created, each managing a separate IndexedDB object store. If IndexedDB creation fails, `InMemoryFileSystemProvider` is used as fallback.\n\n**User Data Initialization**\n\nThe `UserDataInitializationService` coordinates initialization from multiple sources:\n\n[src/vs/workbench/browser/web.main.ts:426-443]()\n\n1. `UserDataSyncInitializer` - Sync user data if Settings Sync is configured\n2. `UserDataProfileInitializer` - Load profile if specified in options\n\nInitialization is time-limited to 5 seconds to prevent blocking:\n\n[src/vs/workbench/browser/web.main.ts:435-442]()\n\n**Sources:** [src/vs/workbench/browser/web.main.ts:102-256](), [src/vs/workbench/browser/web.main.ts:257-445](), [src/vs/workbench/browser/web.main.ts:462-506](), [src/vs/workbench/services/environment/browser/environmentService.ts:42-405]()\n\n## Desktop Workbench Bootstrap\n\n```mermaid\ngraph TB\n    DesktopMain[\"DesktopMain.main()\"]\n    DOMLoad[\"domContentLoaded()\"]\n    \n    DesktopMain --\u003e DOMLoad\n    DOMLoad --\u003e ParseConfig[\"Parse INativeWindowConfiguration\u003cbr/\u003efrom window.vscodeWindowConfig\"]\n    \n    ParseConfig --\u003e ServiceCollection[\"Create ServiceCollection\"]\n    \n    ServiceCollection --\u003e ProductSvc3[\"IProductService\u003cbr/\u003e(from window config)\"]\n    ServiceCollection --\u003e MainIPCSvc[\"IMainProcessService\u003cbr/\u003eElectronIPCMainProcessService\"]\n    ServiceCollection --\u003e EnvSvc3[\"NativeWorkbenchEnvironmentService\"]\n    ServiceCollection --\u003e LogSvc3[\"NativeLogService\"]\n    ServiceCollection --\u003e LogChannels[\"LoggerChannelClient\u003cbr/\u003e(IPC to main)\"]\n    \n    ServiceCollection --\u003e FileSvc3[\"FileService\"]\n    FileSvc3 --\u003e DiskFS[\"DiskFileSystemProvider\u003cbr/\u003efile scheme\"]\n    FileSvc3 --\u003e UserDataFS2[\"FileUserDataProvider\u003cbr/\u003evscode-userdata scheme\"]\n    \n    ServiceCollection --\u003e SharedProc2[\"SharedProcessService\u003cbr/\u003econnect via IPC\"]\n    SharedProc2 --\u003e SharedChannels[\"ProxyChannel for\u003cbr/\u003eshared process services\"]\n    \n    ServiceCollection --\u003e RemoteAuth2[\"RemoteAuthorityResolverService\"]\n    RemoteAuth2 --\u003e SocketFactory2[\"RemoteSocketFactoryService\"]\n    \n    ServiceCollection --\u003e RemoteAgent2[\"RemoteAgentService\"]\n    RemoteAgent2 --\u003e RemoteFS[\"RemoteFileSystemProviderClient\"]\n    \n    ServiceCollection --\u003e StorageSvc3[\"NativeWorkbenchStorageService\"]\n    ServiceCollection --\u003e WorkspaceSvc3[\"WorkspaceService\"]\n    \n    ServiceCollection --\u003e ProfilesSvc[\"UserDataProfilesService\u003cbr/\u003e(IPC to main)\"]\n    ProfilesSvc --\u003e ProfileChannel[\"ProxyChannel\"]\n    \n    WorkspaceSvc3 --\u003e ConfigCache[\"ConfigurationCache\"]\n    ConfigCache --\u003e CacheSchemes[\"Cache non-native\u003cbr/\u003eresources (file, vscode-userdata)\"]\n    \n    WorkspaceSvc3 --\u003e WSInit2[\"workspaceService.initialize()\"]\n    StorageSvc3 --\u003e StoreInit2[\"storageService.initialize()\"]\n    \n    ServiceCollection --\u003e UtilityProc[\"UtilityProcessWorkerWorkbenchService\"]\n    \n    ServiceCollection --\u003e CreateWB2[\"new Workbench()\"]\n    CreateWB2 --\u003e WBStartup2[\"workbench.startup()\"]\n    WBStartup2 --\u003e InstSvc[\"Returns IInstantiationService\"]\n    \n    InstSvc --\u003e NativeWindow[\"new NativeWindow()\"]\n```\n\n**Native Window Configuration**\n\nThe renderer process receives configuration from the main process via `window.vscodeWindowConfig`:\n\n[src/vs/workbench/electron-browser/desktop.main.ts:82-88]()\n\nThis `INativeWindowConfiguration` object contains:\n- Window ID\n- Workspace to open\n- User data profiles\n- Command-line arguments\n- Environment variables\n- Remote authority (if applicable)\n\n**Main Process Communication**\n\nDesktop workbench uses `ElectronIPCMainProcessService` to communicate with main process:\n\n[src/vs/workbench/electron-browser/desktop.main.ts:116-117](), [src/vs/platform/ipc/electron-browser/mainProcessService.ts]()\n\nThis service wraps Electron's IPC mechanism (`ipcRenderer`) and provides a `ProxyChannel` interface for calling main process services.\n\n**Shared Process Connection**\n\nThe renderer connects to the shared process early in bootstrap:\n\n[src/vs/workbench/electron-browser/desktop.main.ts:128-129](), [src/vs/workbench/services/sharedProcess/electron-browser/sharedProcessService.ts]()\n\nThe `SharedProcessService` obtains a `MessagePort` from the main process and establishes a bidirectional communication channel. Services in the shared process are accessed via `ProxyChannel`.\n\n**Native Storage**\n\nDesktop uses `NativeWorkbenchStorageService` which stores data in:\n\n[src/vs/workbench/services/storage/electron-browser/storageService.ts]()\n\n- **Global storage** - SQLite database in user data directory\n- **Workspace storage** - SQLite database per workspace\n- **Profile storage** - Isolated per user data profile\n\n**Configuration Caching**\n\nThe `ConfigurationCache` improves startup performance by caching configuration:\n\n[src/vs/workbench/electron-browser/desktop.main.ts:168-169](), [src/vs/workbench/services/configuration/common/configurationCache.ts]()\n\nIt caches resources from `file`, `vscode-userdata`, and `tmp` schemes. On startup, cached configuration is used while fresh configuration is loaded asynchronously.\n\n**Sources:** [src/vs/workbench/electron-browser/desktop.main.ts:55-274](), [src/vs/workbench/services/environment/electron-browser/environmentService.ts](), [src/vs/workbench/services/storage/electron-browser/storageService.ts]()\n\n## Service Initialization Order\n\n```mermaid\ngraph TB\n    subgraph \"Phase 1: Platform Services\"\n        ProductService[\"IProductService\"]\n        EnvService[\"IEnvironmentService\"]\n        LogService[\"ILogService\"]\n        FileService[\"IFileService\"]\n    end\n    \n    subgraph \"Phase 2: State and Configuration\"\n        StateService[\"IStateService\"]\n        UriIdentity[\"IUriIdentityService\"]\n        PolicyService[\"IPolicyService\"]\n        ConfigService[\"IConfigurationService\"]\n        ProfilesService[\"IUserDataProfilesService\"]\n    end\n    \n    subgraph \"Phase 3: Communication\"\n        SignService[\"ISignService\"]\n        RequestService[\"IRequestService\"]\n        RemoteAuthResolver[\"IRemoteAuthorityResolverService\"]\n        RemoteAgent[\"IRemoteAgentService\"]\n        SocketFactory[\"IRemoteSocketFactoryService\"]\n    end\n    \n    subgraph \"Phase 4: Workbench Infrastructure\"\n        StorageService[\"IStorageService\"]\n        WorkspaceService[\"IWorkspaceContextService\"]\n        TrustService[\"IWorkspaceTrustManagementService\"]\n        ProfileService[\"IUserDataProfileService\"]\n    end\n    \n    subgraph \"Phase 5: Feature Services\"\n        ExtensionService[\"IExtensionService\"]\n        TerminalService[\"ITerminalService\"]\n        SearchService[\"ISearchService\"]\n        OtherServices[\"Other feature services...\"]\n    end\n    \n    ProductService --\u003e EnvService\n    EnvService --\u003e LogService\n    LogService --\u003e FileService\n    \n    FileService --\u003e StateService\n    FileService --\u003e UriIdentity\n    StateService --\u003e PolicyService\n    PolicyService --\u003e ConfigService\n    StateService --\u003e ProfilesService\n    UriIdentity --\u003e ProfilesService\n    \n    FileService --\u003e SignService\n    ConfigService --\u003e RequestService\n    RequestService --\u003e RemoteAuthResolver\n    RemoteAuthResolver --\u003e SocketFactory\n    SocketFactory --\u003e RemoteAgent\n    \n    ProfilesService --\u003e ProfileService\n    ConfigService --\u003e StorageService\n    ConfigService --\u003e WorkspaceService\n    WorkspaceService --\u003e TrustService\n    \n    StorageService --\u003e ExtensionService\n    WorkspaceService --\u003e ExtensionService\n    RemoteAgent --\u003e ExtensionService\n    \n    ExtensionService --\u003e TerminalService\n    ExtensionService --\u003e SearchService\n    ExtensionService --\u003e OtherServices\n```\n\n**Platform Services Layer**\n\nThe foundation layer provides OS-level abstractions:\n\n| Service | Implementation | Purpose |\n|---------|---------------|---------|\n| `IProductService` | Plain object from `product.json` | Build-time configuration |\n| `IEnvironmentService` | `NativeEnvironmentService` or `BrowserWorkbenchEnvironmentService` | Paths, CLI args, environment detection |\n| `ILogService` | `LogService` with `BufferLogger` + `ConsoleLogger` | Logging infrastructure |\n| `IFileService` | `FileService` with registered providers | File system abstraction |\n\n**State and Configuration Layer**\n\nThese services manage persistent state and user preferences:\n\n[src/vs/code/electron-main/main.ts:198-227]()\n\n- `IStateService` - Application-wide persistent state (JSON file)\n- `IPolicyService` - Platform-specific policies (Windows Registry, macOS plist, Linux file)\n- `IConfigurationService` - User and workspace settings\n- `IUserDataProfilesService` - Profile management\n\nInitialization sequence:\n1. Create services\n2. Call `stateService.init()` - loads state file\n3. Call `configurationService.initialize()` - loads settings\n4. Call `userDataProfilesService.init()` - sets up profiles\n\n**Workbench Infrastructure Layer**\n\nThese services are initialized after platform services:\n\n[src/vs/workbench/electron-browser/desktop.main.ts:177-248]()\n\n- `IStorageService` - Key-value storage (SQLite in desktop, IndexedDB in web)\n- `IWorkspaceContextService` - Current workspace context\n- `IWorkspaceTrustManagementService` - Workspace trust state\n- `IUserDataProfileService` - Current profile\n\n**Common vs. Platform-Specific Registration**\n\nServices are registered in multiple locations:\n\n1. **workbench.common.main.ts** - Services shared across desktop and web\n2. **workbench.desktop.main.ts** - Desktop-specific services\n3. **workbench.web.main.ts** - Web-specific services\n\n[src/vs/workbench/workbench.common.main.ts:137-182]()\n\nThe `registerSingleton()` calls establish the service implementations used by the instantiation service.\n\n**Sources:** [src/vs/code/electron-main/main.ts:162-228](), [src/vs/workbench/electron-browser/desktop.main.ts:89-248](), [src/vs/workbench/browser/web.main.ts:257-443](), [src/vs/workbench/workbench.common.main.ts:137-182]()\n\n## Multi-Process Spawning\n\n```mermaid\ngraph TB\n    MainProc[\"Main Process\u003cbr/\u003eCodeApplication\"]\n    \n    MainProc --\u003e SpawnShared[\"Spawn Shared Process\"]\n    SpawnShared --\u003e SharedConfig[\"SharedProcess configuration\"]\n    SharedConfig --\u003e SharedFork[\"fork('sharedProcess.js')\"]\n    \n    MainProc --\u003e OpenWindow[\"openFirstWindow()\"]\n    OpenWindow --\u003e CreateWindow[\"new CodeWindow()\"]\n    CreateWindow --\u003e LoadURL[\"window.loadURL()\"]\n    LoadURL --\u003e RendererProc[\"Renderer Process\u003cbr/\u003eDesktopMain\"]\n    \n    RendererProc --\u003e ConnectShared[\"Connect to Shared Process\u003cbr/\u003evia MessagePort\"]\n    \n    RendererProc --\u003e StartExtHost[\"ExtensionService.startExtensionHosts()\"]\n    StartExtHost --\u003e ExtHostStarter[\"IExtensionHostStarter\"]\n    ExtHostStarter --\u003e ForkExtHost[\"fork('extensionHostProcess.js')\"]\n    ForkExtHost --\u003e ExtHostProc[\"Extension Host Process\"]\n    ExtHostProc --\u003e LoadExtensions[\"Load extensions\"]\n    \n    RendererProc --\u003e CreateTerminal[\"User creates terminal\"]\n    CreateTerminal --\u003e TerminalService[\"ITerminalService\"]\n    TerminalService --\u003e PtyRequest[\"Request pty from backend\"]\n    PtyRequest --\u003e PtyHostStarter[\"ElectronPtyHostStarter\"]\n    PtyHostStarter --\u003e ForkPty[\"fork('ptyHostMain.js')\"]\n    ForkPty --\u003e PtyHostProc[\"Pty Host Process\"]\n    PtyHostProc --\u003e SpawnShell[\"spawn shell process\"]\n```\n\n**Shared Process**\n\nCreated early in `CodeApplication.startup()`:\n\n[src/vs/code/electron-main/app.ts:581](), [src/vs/platform/sharedProcess/electron-main/sharedProcess.ts]()\n\nThe `SharedProcess` class:\n1. Creates a `BrowserWindow` with `show: false`\n2. Loads `sharedProcess.html`\n3. Establishes `MessagePort` communication\n4. Provides channels for services like extension management, telemetry\n\n**Extension Host Process**\n\nSpawned by `ExtensionService` when workbench starts:\n\n[src/vs/workbench/services/extensions/electron-browser/nativeExtensionService.ts](), [src/vs/platform/extensions/electron-main/extensionHostStarter.ts]()\n\nProcess creation:\n1. `ExtensionService` requests spawn via `IExtensionHostStarter` (IPC service)\n2. Main process forks `extensionHostProcess.js` with specific node options\n3. Extension host connects back via IPC\n4. Extensions are activated based on activation events\n\nDebug parameters are passed if `--inspect-extensions` or `--inspect-brk-extensions` flags are set:\n\n[src/vs/platform/environment/common/environmentService.ts:71-76]()\n\n**Pty Host Process**\n\nSpawned on-demand when terminal is created:\n\n[src/vs/platform/terminal/electron-main/electronPtyHostStarter.ts](), [src/vs/platform/terminal/node/ptyHostService.ts]()\n\nFlow:\n1. User creates terminal in UI\n2. `ITerminalService` requests pty from backend\n3. `ElectronPtyHostStarter` (main process service) forks `ptyHostMain.js`\n4. `PtyService` in pty host spawns actual shell process\n5. Bi-directional IPC streams data between renderer and shell\n\nThe pty host is kept alive and reused for multiple terminals to reduce overhead.\n\n**Process Communication**\n\nEach process pair uses a different IPC mechanism:\n\n| From  To | Mechanism |\n|-----------|-----------|\n| Main  Renderer | Electron IPC (`ipcMain`/`ipcRenderer`) |\n| Main  Shared | `MessagePort` (passed during creation) |\n| Renderer  Extension Host | Node.js IPC socket |\n| Renderer  Pty Host | Node.js IPC socket |\n| Main  Extension Host | Node.js IPC socket (for debugging) |\n\n**Sources:** [src/vs/code/electron-main/app.ts:581](), [src/vs/platform/sharedProcess/electron-main/sharedProcess.ts](), [src/vs/platform/extensions/electron-main/extensionHostStarter.ts](), [src/vs/platform/terminal/electron-main/electronPtyHostStarter.ts]()\n\n## CLI Process Flow\n\n```mermaid\ngraph TB\n    CLIEntry[\"cli.ts main()\"]\n    ParseArgs[\"parseCLIProcessArgv()\"]\n    \n    CLIEntry --\u003e ParseArgs\n    ParseArgs --\u003e CheckSubcommand{\"Subcommand?\"}\n    \n    CheckSubcommand --\u003e|\"tunnel, serve-web\"| SpawnCLI[\"Spawn native CLI binary\"]\n    SpawnCLI --\u003e CLIBinary[\"code-tunnel binary\u003cbr/\u003e(Rust implementation)\"]\n    \n    CheckSubcommand --\u003e|\"--help\"| ShowHelp[\"buildHelpMessage()\"]\n    CheckSubcommand --\u003e|\"--version\"| ShowVersion[\"buildVersionMessage()\"]\n    CheckSubcommand --\u003e|\"--locate-shell-integration-path\"| ShowPath[\"Output shell script path\"]\n    \n    CheckSubcommand --\u003e|\"Extension/MCP operations\"| ShouldSpawn[\"shouldSpawnCliProcess()\"]\n    ShouldSpawn --\u003e|\"true\"| ImportCLI[\"import('cliProcessMain.js')\"]\n    ImportCLI --\u003e CliMain[\"CliMain.run()\"]\n    \n    CliMain --\u003e InitCLIServices[\"initServices()\"]\n    InitCLIServices --\u003e EnvSvcCLI[\"NativeEnvironmentService\"]\n    InitCLIServices --\u003e FileSvcCLI[\"FileService\"]\n    InitCLIServices --\u003e LogSvcCLI[\"LogService\"]\n    InitCLIServices --\u003e ConfigSvcCLI[\"ConfigurationService\"]\n    InitCLIServices --\u003e ExtMgmtCLI[\"ExtensionManagementService\"]\n    InitCLIServices --\u003e McpMgmtCLI[\"McpManagementService\"]\n    InitCLIServices --\u003e TelemetryCLI[\"TelemetryService\"]\n    \n    CliMain --\u003e DoRun[\"doRun()\"]\n    DoRun --\u003e CheckArgs{\"Which operation?\"}\n    \n    CheckArgs --\u003e|\"--list-extensions\"| ListExt[\"ExtensionManagementCLI.listExtensions()\"]\n    CheckArgs --\u003e|\"--install-extension\"| InstallExt[\"ExtensionManagementCLI.installExtensions()\"]\n    CheckArgs --\u003e|\"--uninstall-extension\"| UninstallExt[\"ExtensionManagementCLI.uninstallExtensions()\"]\n    CheckArgs --\u003e|\"--update-extensions\"| UpdateExt[\"ExtensionManagementCLI.updateExtensions()\"]\n    CheckArgs --\u003e|\"--locate-extension\"| LocateExt[\"ExtensionManagementCLI.locateExtension()\"]\n    CheckArgs --\u003e|\"--add-mcp\"| AddMcp[\"McpManagementCli.addServers()\"]\n    \n    ShouldSpawn --\u003e|\"false\"| SpawnElectron[\"Spawn Electron with args\"]\n    SpawnElectron --\u003e ElectronBinary[\"code executable\"]\n    ElectronBinary -.-\u003e MainProc[\"Electron Main Process\"]\n```\n\n**CLI Argument Parsing**\n\nThe `parseArgs()` function in `argv.ts` handles complex argument parsing:\n\n[src/vs/platform/environment/node/argv.ts:258-380]()\n\n- Supports subcommands (`tunnel`, `serve-web`, `chat`)\n- Handles aliases (e.g., `-d` for `--diff`)\n- Validates argument types (boolean, string, string[])\n- Reports errors for unknown options\n\n**Extension Management CLI**\n\nWhen extension operations are requested, `ExtensionManagementCLI` is invoked:\n\n[src/vs/platform/extensionManagement/common/extensionManagementCLI.ts]()\n\nKey operations:\n\n| Argument | Method | Description |\n|----------|--------|-------------|\n| `--list-extensions` | `listExtensions()` | Lists installed extensions with optional filtering |\n| `--install-extension` | `installExtensions()` | Installs from marketplace or VSIX file |\n| `--uninstall-extension` | `uninstallExtensions()` | Removes extensions |\n| `--update-extensions` | `updateExtensions()` | Updates all extensions to latest versions |\n| `--locate-extension` | `locateExtension()` | Prints installation path |\n\n**MCP Server Management**\n\nThe `--add-mcp` argument adds Model Context Protocol servers:\n\n[src/vs/code/node/cliProcessMain.ts:119](), [src/vs/platform/mcp/common/mcpManagementCli.ts]()\n\nInput format: JSON string like `{\"name\":\"server-name\",\"command\":\"...\"}`\n\n**Stdin Handling**\n\nCLI supports reading from stdin for piping:\n\n[src/vs/code/node/cli.ts:265-316]()\n\n- Checks `hasStdinWithoutTty()` to detect piped input\n- Creates temporary file via `getStdinFilePath()`\n- Reads data asynchronously via `readFromStdin()`\n- Passes temp file path to Electron process\n- Cleans up temp file after processing\n\n**Wait Marker File**\n\nWhen `--wait` flag is used, CLI creates a marker file:\n\n[src/vs/platform/environment/node/wait.ts](), [src/vs/code/node/cli.ts:376-405]()\n\n1. `createWaitMarkerFileSync()` creates a unique marker file\n2. Marker file path passed via `--waitMarkerFilePath` to Electron\n3. CLI process watches marker file for deletion\n4. Electron deletes marker when editor closes\n5. CLI process exits\n\n**Sources:** [src/vs/code/node/cli.ts:32-89](), [src/vs/code/node/cli.ts:126-144](), [src/vs/code/node/cliProcessMain.ts:81-127](), [src/vs/platform/extensionManagement/common/extensionManagementCLI.ts](), [src/vs/platform/environment/node/argv.ts:258-380]()"])</script><script>self.__next_f.push([1,"1e:Tb345,"])</script><script>self.__next_f.push([1,"# Entry Points and Execution Modes\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [build/lib/i18n.resources.json](build/lib/i18n.resources.json)\n- [cli/src/bin/code/legacy_args.rs](cli/src/bin/code/legacy_args.rs)\n- [resources/completions/bash/code](resources/completions/bash/code)\n- [resources/completions/zsh/_code](resources/completions/zsh/_code)\n- [src/vs/base/node/terminalEncoding.ts](src/vs/base/node/terminalEncoding.ts)\n- [src/vs/code/browser/workbench/workbench-dev.html](src/vs/code/browser/workbench/workbench-dev.html)\n- [src/vs/code/browser/workbench/workbench.html](src/vs/code/browser/workbench/workbench.html)\n- [src/vs/code/browser/workbench/workbench.ts](src/vs/code/browser/workbench/workbench.ts)\n- [src/vs/code/electron-main/app.ts](src/vs/code/electron-main/app.ts)\n- [src/vs/code/electron-main/main.ts](src/vs/code/electron-main/main.ts)\n- [src/vs/code/node/cli.ts](src/vs/code/node/cli.ts)\n- [src/vs/code/node/cliProcessMain.ts](src/vs/code/node/cliProcessMain.ts)\n- [src/vs/platform/environment/common/argv.ts](src/vs/platform/environment/common/argv.ts)\n- [src/vs/platform/environment/common/environment.ts](src/vs/platform/environment/common/environment.ts)\n- [src/vs/platform/environment/common/environmentService.ts](src/vs/platform/environment/common/environmentService.ts)\n- [src/vs/platform/environment/electron-main/environmentMainService.ts](src/vs/platform/environment/electron-main/environmentMainService.ts)\n- [src/vs/platform/environment/node/argv.ts](src/vs/platform/environment/node/argv.ts)\n- [src/vs/platform/environment/node/argvHelper.ts](src/vs/platform/environment/node/argvHelper.ts)\n- [src/vs/platform/environment/node/environmentService.ts](src/vs/platform/environment/node/environmentService.ts)\n- [src/vs/platform/environment/node/stdin.ts](src/vs/platform/environment/node/stdin.ts)\n- [src/vs/platform/extensionManagement/common/extensionManagementCLI.ts](src/vs/platform/extensionManagement/common/extensionManagementCLI.ts)\n- [src/vs/server/node/remoteExtensionHostAgentCli.ts](src/vs/server/node/remoteExtensionHostAgentCli.ts)\n- [src/vs/server/node/server.cli.ts](src/vs/server/node/server.cli.ts)\n- [src/vs/server/node/serverEnvironmentService.ts](src/vs/server/node/serverEnvironmentService.ts)\n- [src/vs/server/node/serverServices.ts](src/vs/server/node/serverServices.ts)\n- [src/vs/workbench/browser/web.api.ts](src/vs/workbench/browser/web.api.ts)\n- [src/vs/workbench/browser/web.factory.ts](src/vs/workbench/browser/web.factory.ts)\n- [src/vs/workbench/browser/web.main.ts](src/vs/workbench/browser/web.main.ts)\n- [src/vs/workbench/electron-browser/desktop.main.ts](src/vs/workbench/electron-browser/desktop.main.ts)\n- [src/vs/workbench/services/environment/browser/environmentService.ts](src/vs/workbench/services/environment/browser/environmentService.ts)\n- [src/vs/workbench/services/environment/common/environmentService.ts](src/vs/workbench/services/environment/common/environmentService.ts)\n- [src/vs/workbench/services/environment/electron-browser/environmentService.ts](src/vs/workbench/services/environment/electron-browser/environmentService.ts)\n- [src/vs/workbench/services/extensions/electron-browser/nativeExtensionService.ts](src/vs/workbench/services/extensions/electron-browser/nativeExtensionService.ts)\n- [src/vs/workbench/workbench.common.main.ts](src/vs/workbench/workbench.common.main.ts)\n- [src/vs/workbench/workbench.desktop.main.ts](src/vs/workbench/workbench.desktop.main.ts)\n- [src/vs/workbench/workbench.web.main.ts](src/vs/workbench/workbench.web.main.ts)\n\n\u003c/details\u003e\n\n\n\nThis page documents VS Code's main entry points and how the application determines which execution mode to use. VS Code has multiple entry points for different contexts: Electron desktop, web browser, CLI operations, and specialized server modes.\n\n**Scope**: This page covers the entry point selection logic and the initialization flow for each mode. For details on the Electron main process startup, see [Electron Main Process Startup](#3.2). For service initialization patterns, see [Service Initialization and Dependency Injection](#3.5).\n\n## Main Entry Point Classes\n\nVS Code has three primary entry point classes that handle application startup:\n\n| Entry Point Class | File | Purpose | Environment |\n|-------------------|------|---------|-------------|\n| `CodeMain` | `src/vs/code/electron-main/main.ts` | Electron main process entry | Desktop |\n| `BrowserMain` | `src/vs/workbench/browser/web.main.ts` | Web workbench initialization | Browser |\n| `CliMain` | `src/vs/code/node/cliProcessMain.ts` | CLI operations (extension management, etc.) | Node.js subprocess |\n\nEach entry point class is responsible for:\n1. Initializing platform-specific services\n2. Setting up the execution environment\n3. Loading the appropriate workbench modules\n4. Handling platform-specific lifecycle events\n\n**Sources**: [src/vs/code/electron-main/main.ts:78-159](), [src/vs/workbench/browser/web.main.ts:102-255](), [src/vs/code/node/cliProcessMain.ts:81-127]()\n\n## Entry Point Selection Logic\n\nThe application's entry point is determined by command-line arguments and the execution environment. The decision tree begins in `src/vs/code/node/cli.ts`:\n\n**Entry Point Selection Decision Tree**\n\n```mermaid\ngraph TB\n    Start[\"CLI Entry\u003cbr/\u003esrc/vs/code/node/cli.ts::main()\"]\n    \n    ParseArgs[\"Parse Arguments\u003cbr/\u003eparseCLIProcessArgv()\"]\n    \n    IsSubcommand{\"Subcommand?\u003cbr/\u003etunnel|serve-web|chat\"}\n    IsCLI{\"CLI Operations?\u003cbr/\u003eshouldSpawnCliProcess()\"}\n    IsHelp{\"Help or\u003cbr/\u003eVersion?\"}\n    IsFileWrite{\"File Write\u003cbr/\u003eOperation?\"}\n    \n    SpawnTunnel[\"Spawn Tunnel CLI\u003cbr/\u003eRust binary or cargo run\"]\n    SpawnCliProcess[\"Spawn CliMain\u003cbr/\u003ecliProcessMain.ts\"]\n    ShowHelp[\"Display Help/Version\u003cbr/\u003ebuildHelpMessage()\"]\n    FileWrite[\"Perform File Write\u003cbr/\u003eNative operation\"]\n    SpawnElectron[\"Spawn Electron\u003cbr/\u003eCodeMain entry\"]\n    \n    CodeMain[\"CodeMain.startup()\u003cbr/\u003eelectron-main/main.ts\"]\n    ClaimInstance[\"claimInstance()\u003cbr/\u003eCheck if first instance\"]\n    CreateApp[\"new CodeApplication()\u003cbr/\u003eelectron-main/app.ts\"]\n    \n    Start --\u003e ParseArgs\n    ParseArgs --\u003e IsSubcommand\n    IsSubcommand --\u003e|\"yes\"| SpawnTunnel\n    IsSubcommand --\u003e|\"no\"| IsCLI\n    IsCLI --\u003e|\"yes\"| SpawnCliProcess\n    IsCLI --\u003e|\"no\"| IsHelp\n    IsHelp --\u003e|\"yes\"| ShowHelp\n    IsHelp --\u003e|\"no\"| IsFileWrite\n    IsFileWrite --\u003e|\"yes\"| FileWrite\n    IsFileWrite --\u003e|\"no\"| SpawnElectron\n    \n    SpawnElectron --\u003e CodeMain\n    CodeMain --\u003e ClaimInstance\n    ClaimInstance --\u003e CreateApp\n    \n    style CodeMain fill:#e6f3ff\n    style SpawnCliProcess fill:#ffe6e6\n    style SpawnTunnel fill:#e6ffe6\n```\n\n**Sources**: [src/vs/code/node/cli.ts:43-222](), [src/vs/code/electron-main/main.ts:97-159]()\n\n### CLI Operations Detection\n\nThe `shouldSpawnCliProcess()` function determines if the command requires CLI mode:\n\n```typescript\nfunction shouldSpawnCliProcess(argv: NativeParsedArgs): boolean {\n\treturn !!argv['install-source']\n\t\t|| !!argv['list-extensions']\n\t\t|| !!argv['install-extension']\n\t\t|| !!argv['uninstall-extension']\n\t\t|| !!argv['update-extensions']\n\t\t|| !!argv['locate-extension']\n\t\t|| !!argv['add-mcp']\n\t\t|| !!argv['telemetry'];\n}\n```\n\nThese operations spawn a separate `CliMain` process to avoid launching the full Electron application.\n\n**Sources**: [src/vs/code/node/cli.ts:32-41]()\n\n## workbench.common.main.ts: Shared Foundation\n\nThe `workbench.common.main.ts` file serves as the foundation for both desktop and web workbenches. It is the first module imported by both platform-specific entry points.\n\n### Structure of workbench.common.main.ts\n\nThe file is organized into distinct sections using comment regions:\n\n```mermaid\ngraph TB\n    CommonMain[\"workbench.common.main.ts\"]\n    \n    subgraph \"Section 1: Core\"\n        EditorCore[\"editor/editor.all.js\u003cbr/\u003eMonaco Editor\"]\n        ExtHostAPI[\"api/browser/extensionHost.contribution.js\u003cbr/\u003eExtension Host\"]\n        WorkbenchCore[\"browser/workbench.contribution.js\u003cbr/\u003eWorkbench Core\"]\n    end\n    \n    subgraph \"Section 2: Workbench Actions\"\n        TextActions[\"browser/actions/textInputActions.js\"]\n        DevActions[\"browser/actions/developerActions.js\"]\n        LayoutActions[\"browser/actions/layoutActions.js\"]\n        NavActions[\"browser/actions/navigationActions.js\"]\n        WindowActions[\"browser/actions/windowActions.js\"]\n        OtherActions[\"Other action modules...\"]\n    end\n    \n    subgraph \"Section 3: API Extension Points\"\n        MenusExt[\"services/actions/common/menusExtensionPoint.js\"]\n        ConfigExt[\"api/common/configurationExtensionPoint.js\"]\n        ViewsExt[\"api/browser/viewsExtensionPoint.js\"]\n    end\n    \n    subgraph \"Section 4: Workbench Parts\"\n        EditorPart[\"browser/parts/editor/editor.contribution.js\"]\n        EditorParts[\"browser/parts/editor/editorParts.js\"]\n        StatusBar[\"browser/parts/statusbar/statusbarPart.js\"]\n        Banner[\"browser/parts/banner/bannerPart.js\"]\n    end\n    \n    subgraph \"Section 5: Workbench Services\"\n        ServiceImports[\"60+ service imports\u003cbr/\u003eEditorService, ThemeService,\u003cbr/\u003eExtensionManagementService, etc.\"]\n        ServiceRegistrations[\"registerSingleton() calls\u003cbr/\u003eIContextViewService,\u003cbr/\u003eIMarkerService, etc.\"]\n    end\n    \n    subgraph \"Section 6: Workbench Contributions\"\n        FeatureContribs[\"100+ feature contributions\u003cbr/\u003eTerminal, Notebook, Chat, SCM,\u003cbr/\u003eDebug, Extensions, etc.\"]\n    end\n    \n    CommonMain --\u003e EditorCore\n    CommonMain --\u003e ExtHostAPI\n    CommonMain --\u003e WorkbenchCore\n    CommonMain --\u003e TextActions\n    CommonMain --\u003e MenusExt\n    CommonMain --\u003e EditorPart\n    CommonMain --\u003e ServiceImports\n    CommonMain --\u003e ServiceRegistrations\n    CommonMain --\u003e FeatureContribs\n```\n\n**Sources**: [src/vs/workbench/workbench.common.main.ts:1-434]()\n\n### Key Sections in Detail\n\n**1. Editor/Workbench Core** [src/vs/workbench/workbench.common.main.ts:6-12]():\n- `editor.all.js`: Loads the complete Monaco Editor with all features\n- `extensionHost.contribution.js`: Sets up extension host communication\n- `workbench.contribution.js`: Core workbench UI registration\n\n**2. Workbench Actions** [src/vs/workbench/workbench.common.main.ts:16-29](): Imports action modules that register commands and keybindings for basic workbench operations like text input, layout management, and navigation.\n\n**3. API Extension Points** [src/vs/workbench/workbench.common.main.ts:33-38](): Defines contribution points that extensions can use (menus, configuration, views).\n\n**4. Workbench Parts** [src/vs/workbench/workbench.common.main.ts:42-49](): Loads UI parts like the editor area, status bar, and banner.\n\n**5. Workbench Services** [src/vs/workbench/workbench.common.main.ts:53-183]():\n- Service imports: Loads service implementation files\n- Service registrations: Uses `registerSingleton()` to register services with dependency injection\n- Examples: `IContextViewService`, `IMarkerService`, `IListService`, `IOpenerService`\n\n**6. Workbench Contributions** [src/vs/workbench/workbench.common.main.ts:186-433](): Imports all major feature contributions:\n\n| Feature Area | Example Contributions |\n|--------------|----------------------|\n| Preferences | `preferences.contribution.js`, `keybindingsEditorContribution.js` |\n| Notebook | `notebook.contribution.js` |\n| Chat/AI | `chat.contribution.js`, `inlineChat.contribution.js` |\n| Terminal | `terminal.all.js` |\n| Debug | `debug.contribution.js`, `debugEditorContribution.js` |\n| SCM | `scm.contribution.js` |\n| Extensions | `extensions.contribution.js`, `extensionsViewlet.js` |\n| Search | `search.contribution.js`, `searchView.js` |\n\n**Sources**: [src/vs/workbench/workbench.common.main.ts:6-433]()\n\n## workbench.desktop.main.ts: Desktop/Electron Additions\n\nThe `workbench.desktop.main.ts` file extends the common workbench with Electron-specific functionality.\n\n### Desktop Entry Point Structure\n\n```mermaid\ngraph TB\n    DesktopMain[\"workbench.desktop.main.ts\"]\n    \n    CommonImport[\"import './workbench.common.main.js'\u003cbr/\u003eLine 15\"]\n    \n    subgraph \"Desktop-Specific Imports\"\n        DesktopCore[\"electron-browser/desktop.main.js\u003cbr/\u003eelectron-browser/desktop.contribution.js\"]\n        DialogPart[\"electron-browser/parts/dialogs/dialog.contribution.js\"]\n    end\n    \n    subgraph \"Electron Services (Lines 36-94)\"\n        NativeServices[\"Native Service Implementations:\u003cbr/\u003e- nativeTextFileService.js\u003cbr/\u003e- fileDialogService.js\u003cbr/\u003e- menubarService.js\u003cbr/\u003e- updateService.js\u003cbr/\u003e- nativeHostService.js\u003cbr/\u003e- clipboardService.js\u003cbr/\u003e- contextmenuService.js\u003cbr/\u003e- nativeKeyboardLayout.js\"]\n        \n        ExtServices[\"Extension Services:\u003cbr/\u003e- extensionManagementService.js\u003cbr/\u003e- extensionsScannerService.js\u003cbr/\u003e- extensionHostStarter.js\u003cbr/\u003e- nativeExtensionService.js\"]\n        \n        OtherServices[\"Other Services:\u003cbr/\u003e- telemetryService.js\u003cbr/\u003e- encryptionService.js\u003cbr/\u003e- secretStorageService.js\u003cbr/\u003e- workingCopyBackupService.js\"]\n    end\n    \n    subgraph \"Desktop Contributions (Lines 105-188)\"\n        LogsContrib[\"logs.contribution.js\"]\n        LocalizationContrib[\"localization.contribution.js\"]\n        ExtensionsContrib[\"extensions.contribution.js\"]\n        TerminalContrib[\"terminal.contribution.js\"]\n        ChatContrib[\"chat.contribution.js\"]\n        McpContrib[\"mcp.contribution.js\"]\n        OtherContribs[\"Remote, Debug, Webview, etc.\"]\n    end\n    \n    MainExport[\"export { main }\u003cbr/\u003efrom desktop.main.js\u003cbr/\u003eLine 191\"]\n    \n    DesktopMain --\u003e CommonImport\n    DesktopMain --\u003e DesktopCore\n    DesktopMain --\u003e DialogPart\n    DesktopMain --\u003e NativeServices\n    DesktopMain --\u003e ExtServices\n    DesktopMain --\u003e OtherServices\n    DesktopMain --\u003e LogsContrib\n    DesktopMain --\u003e LocalizationContrib\n    DesktopMain --\u003e ExtensionsContrib\n    DesktopMain --\u003e TerminalContrib\n    DesktopMain --\u003e MainExport\n```\n\n**Sources**: [src/vs/workbench/workbench.desktop.main.ts:1-192]()\n\n### Desktop-Specific Services\n\nThe desktop entry point registers several Electron-specific service implementations:\n\n**Native Services** [src/vs/workbench/workbench.desktop.main.ts:36-94]():\n\n| Service | Implementation | Purpose |\n|---------|----------------|---------|\n| `ITextFileService` | `NativeTextFileService` | File operations with native dialogs |\n| `IFileDialogService` | `FileDialogService` | Native file picker dialogs |\n| `IMenubarService` | `MenubarService` | Native menu bar (macOS) |\n| `IUpdateService` | `UpdateService` | Application updates |\n| `INativeHostService` | `NativeHostService` | Native OS integration |\n| `IClipboardService` | `ClipboardService` | Native clipboard access |\n| `IContextMenuService` | `ContextMenuService` | Native context menus |\n\n**Extension Services** [src/vs/workbench/workbench.desktop.main.ts:64-91]():\n- `ExtensionManagementService`: Local extension installation/uninstallation\n- `ExtensionsScannerService`: Scans local file system for extensions\n- `ExtensionHostStarter`: Spawns Node.js extension host process\n- `NativeExtensionService`: Manages local process extension hosts\n\n**User Data Services** [src/vs/workbench/workbench.desktop.main.ts:71-90]():\n- `UserDataSyncService`: Settings sync with Microsoft account\n- `UserDataAutoSyncService`: Automatic sync\n- `SecretStorageService`: Native credential storage (Keychain/Credential Manager)\n- `EncryptionService`: Native encryption APIs\n\n**Sources**: [src/vs/workbench/workbench.desktop.main.ts:36-94]()\n\n### Desktop Contributions\n\nDesktop-specific contributions [src/vs/workbench/workbench.desktop.main.ts:105-188]() add functionality only available in Electron:\n\n- **Localization** [src/vs/workbench/workbench.desktop.main.ts:111](): Native language pack support\n- **Extension Management** [src/vs/workbench/workbench.desktop.main.ts:123](): VSIX installation from disk\n- **Terminal** [src/vs/workbench/workbench.desktop.main.ts:135](): Native PTY support\n- **Remote Development** [src/vs/workbench/workbench.desktop.main.ts:132](): SSH/WSL connections\n- **Debug** [src/vs/workbench/workbench.desktop.main.ts:120](): Native debugger integration\n- **Webview** [src/vs/workbench/workbench.desktop.main.ts:156](): Electron webview implementation\n\n### Main Function Export\n\nThe desktop entry point exports the `main` function [src/vs/workbench/workbench.desktop.main.ts:191]():\n\n```typescript\nexport { main } from './electron-browser/desktop.main.js';\n```\n\nThis `main` function is the actual entry point invoked when the Electron renderer process starts. It creates the workbench DOM structure and initializes the application.\n\n**Sources**: [src/vs/workbench/workbench.desktop.main.ts:105-192]()\n\n## workbench.web.main.ts: Web/Browser Additions\n\nThe `workbench.web.main.ts` file extends the common workbench with browser-specific functionality.\n\n### Web Entry Point Structure\n\n```mermaid\ngraph TB\n    WebMain[\"workbench.web.main.ts\"]\n    \n    CommonImport[\"import './workbench.common.main.js'\u003cbr/\u003eLine 16\"]\n    \n    subgraph \"Web-Specific Imports\"\n        WebCore[\"browser/web.main.js\u003cbr/\u003eBrowserMain class\"]\n        DialogPart[\"browser/parts/dialogs/dialog.web.contribution.js\"]\n    end\n    \n    subgraph \"Browser Services (Lines 36-73)\"\n        BrowserServices[\"Browser Service Implementations:\u003cbr/\u003e- integrityService.js\u003cbr/\u003e- searchService.js\u003cbr/\u003e- browserTextFileService.js\u003cbr/\u003e- keyboardLayoutService.js\u003cbr/\u003e- extensionService.js\u003cbr/\u003e- extensionsScannerService.js\u003cbr/\u003e- webExtensionsScannerService.js\u003cbr/\u003e- extensionManagementServerService.js\"]\n        \n        BrowserStorage[\"Browser Storage:\u003cbr/\u003e- urlService.js\u003cbr/\u003e- workspacesService.js\u003cbr/\u003e- clipboardService.js\u003cbr/\u003e- secretStorageService.js\u003cbr/\u003e- workingCopyBackupService.js\"]\n        \n        BrowserUI[\"Browser UI:\u003cbr/\u003e- browserHostService.js\u003cbr/\u003e- lifecycleService.js\u003cbr/\u003e- browserHostColorSchemeService.js\u003cbr/\u003e- auxiliaryWindowService.js\"]\n    end\n    \n    subgraph \"Service Registrations (Lines 74-122)\"\n        Singletons[\"registerSingleton() calls:\u003cbr/\u003e- IWorkbenchExtensionManagementService\u003cbr/\u003e- IAccessibilityService\u003cbr/\u003e- IContextMenuService\u003cbr/\u003e- IUserDataSyncStoreService\u003cbr/\u003e- ITitleService\u003cbr/\u003e- ITimerService\u003cbr/\u003e- ILanguagePackService\u003cbr/\u003e- IMcpGalleryManifestService\"]\n    end\n    \n    subgraph \"Web Contributions (Lines 126-175)\"\n        WebContribs[\"Browser-Specific Contributions:\u003cbr/\u003e- logs.contribution.js\u003cbr/\u003e- localization.contribution.js\u003cbr/\u003e- performance.web.contribution.js\u003cbr/\u003e- welcomeBanner.contribution.js\u003cbr/\u003e- webview.web.contribution.js\u003cbr/\u003e- extensions.web.contribution.js\u003cbr/\u003e- terminal.web.contribution.js\u003cbr/\u003e- issue.contribution.js\u003cbr/\u003e- splash.contribution.js\"]\n    end\n    \n    WebMain --\u003e CommonImport\n    WebMain --\u003e WebCore\n    WebMain --\u003e DialogPart\n    WebMain --\u003e BrowserServices\n    WebMain --\u003e BrowserStorage\n    WebMain --\u003e BrowserUI\n    WebMain --\u003e Singletons\n    WebMain --\u003e WebContribs\n```\n\n**Sources**: [src/vs/workbench/workbench.web.main.ts:1-176]()\n\n### Web-Specific Services\n\nThe web entry point registers browser-compatible service implementations:\n\n**File and Extension Services** [src/vs/workbench/workbench.web.main.ts:37-47]():\n\n| Service | Implementation | Purpose |\n|---------|----------------|---------|\n| `ITextFileService` | `BrowserTextFileService` | File operations via web APIs |\n| `IExtensionService` | `ExtensionService` | Web worker extension hosts |\n| `IExtensionsScannerService` | `ExtensionsScannerService` | Scans extensions from remote or IndexedDB |\n| `IWebExtensionsScannerService` | `WebExtensionsScannerService` | Web-specific extension scanning |\n| `ISearchService` | `SearchService` | File search via web APIs |\n\n**Browser Storage Services** [src/vs/workbench/workbench.web.main.ts:56-67]():\n- `WorkspacesService`: IndexedDB-based workspace storage\n- `ClipboardService`: Web Clipboard API wrapper\n- `SecretStorageService`: Encrypted IndexedDB storage\n- `WorkingCopyBackupService`: IndexedDB-based backup\n\n**Browser UI Services** [src/vs/workbench/workbench.web.main.ts:54-72]():\n- `BrowserHostService`: Browser window management\n- `LifecycleService`: Browser page lifecycle\n- `BrowserHostColorSchemeService`: Media query-based theme detection\n- `AuxiliaryWindowService`: Browser popup window management\n\n**User Data Sync** [src/vs/workbench/workbench.web.main.ts:103-112]():\n- Full sync infrastructure is registered in web builds\n- `IUserDataAutoSyncService`: Registered as `InstantiationType.Eager` to start immediately\n\n**Sources**: [src/vs/workbench/workbench.web.main.ts:36-122]()\n\n### Web Contributions\n\nWeb-specific contributions [src/vs/workbench/workbench.web.main.ts:126-175]() include:\n\n- **Performance Monitoring** [src/vs/workbench/workbench.web.main.ts:135](): `performance.web.contribution.js` for web-specific metrics\n- **Welcome Banner** [src/vs/workbench/workbench.web.main.ts:144](): Browser-specific welcome experience\n- **Webview** [src/vs/workbench/workbench.web.main.ts:147](): Iframe-based webview implementation\n- **Extensions** [src/vs/workbench/workbench.web.main.ts:150](): Web extension gallery integration\n- **Terminal** [src/vs/workbench/workbench.web.main.ts:153-155](): Web-based terminal (connects to remote PTY or local process)\n- **Issue Reporting** [src/vs/workbench/workbench.web.main.ts:164](): Browser-based issue reporter\n- **Remote Start Entry** [src/vs/workbench/workbench.web.main.ts:170](): Enables remote connection from web\n\n**Key Differences from Desktop**:\n1. No native file system access (uses remote or IndexedDB)\n2. Extension hosts run in Web Workers (not Node.js processes)\n3. No native menus, dialogs, or system integration\n4. Storage uses IndexedDB instead of file system\n5. User Data Sync is eager (starts immediately) to provide cloud-first experience\n\n**Sources**: [src/vs/workbench/workbench.web.main.ts:126-175]()\n\n## Service Registration Pattern\n\nAll three entry points use a consistent pattern for registering services with the dependency injection system.\n\n### Registration Methods\n\n```mermaid\ngraph TB\n    subgraph \"Service Registration Approaches\"\n        DirectImport[\"Direct Import\u003cbr/\u003eService file imports and\u003cbr/\u003eself-registers\"]\n        RegisterSingleton[\"registerSingleton()\u003cbr/\u003eExplicit registration\u003cbr/\u003ein entry point\"]\n    end\n    \n    subgraph \"Registration Details\"\n        ServiceInterface[\"Service Interface\u003cbr/\u003eIServiceName\"]\n        Implementation[\"Implementation Class\u003cbr/\u003eServiceName\"]\n        InstType[\"InstantiationType\u003cbr/\u003eDelayed or Eager\"]\n    end\n    \n    DirectImport --\u003e Example1[\"Example:\u003cbr/\u003eimport './services/editor/browser/editorService.js'\u003cbr/\u003eFile registers itself\"]\n    \n    RegisterSingleton --\u003e Example2[\"Example:\u003cbr/\u003eregisterSingleton(IMarkerService, MarkerService, InstantiationType.Delayed)\"]\n    \n    RegisterSingleton --\u003e ServiceInterface\n    RegisterSingleton --\u003e Implementation\n    RegisterSingleton --\u003e InstType\n```\n\n**Sources**: [src/vs/workbench/workbench.common.main.ts:137-181]()\n\n### Service Registration in Common Entry Point\n\nThe common entry point uses both patterns:\n\n**Self-Registering Services** [src/vs/workbench/workbench.common.main.ts:55-136](): Many services register themselves when their module is imported. These files internally call `registerSingleton()`:\n\n```typescript\n// Example from keybinding service\nimport './services/keybinding/browser/keybindingService.js';\n```\n\nInside `keybindingService.js`, the service registers itself:\n```typescript\nregisterSingleton(IKeybindingService, KeybindingService, InstantiationType.Delayed);\n```\n\n**Explicit Registrations** [src/vs/workbench/workbench.common.main.ts:137-181](): Some services are registered directly in the entry point:\n\n```typescript\nregisterSingleton(IUserDataSyncLogService, UserDataSyncLogService, InstantiationType.Delayed);\nregisterSingleton(IContextViewService, ContextViewService, InstantiationType.Delayed);\nregisterSingleton(IListService, ListService, InstantiationType.Delayed);\nregisterSingleton(IMarkerService, MarkerService, InstantiationType.Delayed);\nregisterSingleton(IContextKeyService, ContextKeyService, InstantiationType.Delayed);\n// ... more registrations\n```\n\n### InstantiationType\n\nServices specify when they should be instantiated:\n\n| Type | Behavior | Use Case |\n|------|----------|----------|\n| `InstantiationType.Delayed` | Created on first use | Most services (lazy loading) |\n| `InstantiationType.Eager` | Created at startup | Critical services like `UserDataAutoSyncService` |\n\n**Example of Eager Service** [src/vs/workbench/workbench.web.main.ts:112]():\n```typescript\nregisterSingleton(IUserDataAutoSyncService, UserDataAutoSyncService, InstantiationType.Eager);\n// Comment: \"Eager to start auto sync\"\n```\n\n**Sources**: [src/vs/workbench/workbench.common.main.ts:137-181](), [src/vs/workbench/workbench.web.main.ts:103-122](), [src/vs/workbench/workbench.desktop.main.ts:95-100]()\n\n## Contribution Loading Pattern\n\nBoth common and platform-specific entry points load feature contributions through imports.\n\n### Contribution Import Structure\n\n```mermaid\ngraph TB\n    subgraph \"Contribution Types\"\n        ServiceContrib[\"Service Contributions\u003cbr/\u003eRegister services and\u003cbr/\u003eservice implementations\"]\n        UIContrib[\"UI Contributions\u003cbr/\u003eRegister views, actions,\u003cbr/\u003emenus, commands\"]\n        EditorContrib[\"Editor Contributions\u003cbr/\u003eRegister editor features,\u003cbr/\u003edecorations, languages\"]\n    end\n    \n    subgraph \"Registration Mechanism\"\n        ImportSideEffect[\"Import Side Effect\u003cbr/\u003eFile executes on import\"]\n        Registration[\"Registration Calls:\u003cbr/\u003e- registerAction2()\u003cbr/\u003e- registerSingleton()\u003cbr/\u003e- registerEditorContribution()\u003cbr/\u003e- Registry.as().registerXXX()\"]\n    end\n    \n    Example[\"Example Contribution:\u003cbr/\u003eimport './contrib/terminal/terminal.all.js'\"]\n    \n    TerminalAll[\"terminal.all.js\u003cbr/\u003eImports all terminal modules\"]\n    \n    subgraph \"Terminal Contributions\"\n        TerminalActions[\"Terminal Actions\u003cbr/\u003eterminalActions.ts\"]\n        TerminalView[\"Terminal View\u003cbr/\u003eterminal.contribution.ts\"]\n        TerminalService[\"Terminal Service\u003cbr/\u003eterminalService.ts\"]\n    end\n    \n    Example --\u003e TerminalAll\n    TerminalAll --\u003e TerminalActions\n    TerminalAll --\u003e TerminalView\n    TerminalAll --\u003e TerminalService\n    \n    TerminalActions --\u003e Registration\n    TerminalView --\u003e Registration\n    TerminalService --\u003e Registration\n```\n\n**Sources**: [src/vs/workbench/workbench.common.main.ts:186-433]()\n\n### Major Feature Contributions in Common Entry Point\n\nThe common entry point loads numerous feature contributions [src/vs/workbench/workbench.common.main.ts:186-433]():\n\n**Core Features**:\n- **Telemetry** [Line 192]: Usage tracking and diagnostics\n- **Preferences** [Lines 195-197]: Settings UI and keybindings editor\n- **Performance** [Line 200]: Performance monitoring\n- **Notebook** [Line 203]: Interactive notebook support\n- **Speech** [Line 206]: Speech recognition/synthesis\n- **Chat** [Lines 209-213]: AI chat interface and inline chat\n\n**Development Features**:\n- **Debug** [Lines 253-258]: Debugger UI and integrations\n- **Testing** [Line 222]: Test explorer and execution\n- **Tasks** [Line 308]: Task runner\n- **SCM** [Line 250]: Source control management\n\n**Editor Features**:\n- **Search** [Lines 240-244]: File and text search\n- **Markers** [Line 261]: Problem indicators\n- **Comments** [Line 276]: Comment threads\n- **Code Actions** [Line 389]: Quick fixes and refactorings\n\n**UI Features**:\n- **Explorer** [Lines 231-233]: File explorer\n- **Output** [Lines 295-296]: Output channels\n- **Terminal** [Line 299]: Integrated terminal\n- **Extensions** [Lines 291-292]: Extension marketplace and management\n\n**Specialized Features**:\n- **Remote** [Lines 311-312]: Remote development\n- **Emmet** [Line 315]: Emmet abbreviations\n- **Markdown** [Line 321]: Markdown preview\n- **Webview** [Lines 282-285]: Custom webview panels\n- **Notebook** [Line 203]: Jupyter-style notebooks\n- **MCP** [Line 211]: Model Context Protocol\n\n### Rollup Files\n\nSome contributions use \"rollup\" files that import multiple related modules:\n\n**terminal.all.js** [src/vs/workbench/workbench.common.main.ts:299](): Aggregates all terminal-related contributions\n\n**notebook.contribution.js** [src/vs/workbench/workbench.common.main.ts:203](): Aggregates notebook features\n\n**chat.contribution.js** [src/vs/workbench/workbench.common.main.ts:209](): Aggregates chat features\n\nThis pattern allows the entry point to import a single file that loads an entire feature area.\n\n**Sources**: [src/vs/workbench/workbench.common.main.ts:186-433]()\n\n## Web Browser Entry: BrowserMain\n\nThe `BrowserMain` class in [src/vs/workbench/browser/web.main.ts:102-255]() is the entry point for browser-based VS Code.\n\n### BrowserMain Initialization Flow\n\n**BrowserMain Startup Sequence**\n\n```mermaid\ngraph TB\n    Constructor[\"new BrowserMain(domElement, config)\"]\n    \n    Init[\"init()\u003cbr/\u003eSet fullscreen mode\"]\n    \n    Open[\"open()\u003cbr/\u003eReturns IWorkbench\"]\n    \n    subgraph \"Service Initialization\"\n        InitServices[\"initServices()\"]\n        \n        ProductSvc[\"IProductService\u003cbr/\u003eFrom config\"]\n        EnvSvc[\"IBrowserWorkbenchEnvironmentService\u003cbr/\u003eBrowserWorkbenchEnvironmentService\"]\n        FileSvc[\"IFileService\u003cbr/\u003eFileService + BufferLogger\"]\n        LoggerSvc[\"ILoggerService\u003cbr/\u003eFileLoggerService\"]\n        LogSvc[\"ILogService\u003cbr/\u003eLogService\"]\n        \n        IndexedDB[\"registerIndexedDBFileSystemProviders()\u003cbr/\u003eUser data and logs storage\"]\n        \n        RemoteAuth[\"IRemoteAuthorityResolverService\u003cbr/\u003eRemoteAuthorityResolverService\"]\n        SignSvc[\"ISignService\u003cbr/\u003eSignService\"]\n        UriId[\"IUriIdentityService\u003cbr/\u003eUriIdentityService\"]\n        Profiles[\"IUserDataProfilesService\u003cbr/\u003eBrowserUserDataProfilesService\"]\n        RemoteAgent[\"IRemoteAgentService\u003cbr/\u003eRemoteAgentService\"]\n        \n        ConfigSvc[\"IWorkbenchConfigurationService\u003cbr/\u003eWorkspaceService\"]\n        StorageSvc[\"IStorageService\u003cbr/\u003eBrowserStorageService\"]\n    end\n    \n    CreateWorkbench[\"new Workbench(domElement)\u003cbr/\u003eworkbench.ts\"]\n    \n    StartupWB[\"workbench.startup()\u003cbr/\u003eReturns IInstantiationService\"]\n    \n    CreateWindow[\"new BrowserWindow\u003cbr/\u003ewindow.ts\"]\n    \n    ReturnAPI[\"Return IWorkbench API facade\"]\n    \n    Constructor --\u003e Init\n    Init --\u003e Open\n    Open --\u003e InitServices\n    \n    InitServices --\u003e ProductSvc\n    InitServices --\u003e EnvSvc\n    InitServices --\u003e FileSvc\n    InitServices --\u003e LoggerSvc\n    InitServices --\u003e LogSvc\n    InitServices --\u003e IndexedDB\n    InitServices --\u003e RemoteAuth\n    InitServices --\u003e SignSvc\n    InitServices --\u003e UriId\n    InitServices --\u003e Profiles\n    InitServices --\u003e RemoteAgent\n    InitServices --\u003e ConfigSvc\n    InitServices --\u003e StorageSvc\n    \n    InitServices --\u003e CreateWorkbench\n    CreateWorkbench --\u003e StartupWB\n    StartupWB --\u003e CreateWindow\n    CreateWindow --\u003e ReturnAPI\n```\n\n**Sources**: [src/vs/workbench/browser/web.main.ts:102-248](), [src/vs/workbench/browser/web.main.ts:257-444]()\n\n### IndexedDB File System Providers\n\nWeb VS Code uses IndexedDB for persistent storage [src/vs/workbench/browser/web.main.ts:462-505]():\n\n- **Logs Store**: `vscode-logs-store` - Application logs\n- **User Data Store**: `vscode-userdata-store` - Settings, keybindings, snippets\n- **File Handles Store**: `vscode-filehandles-store` - File system access handles (when supported)\n\nIf IndexedDB is unavailable, falls back to `InMemoryFileSystemProvider`.\n\n**Sources**: [src/vs/workbench/browser/web.main.ts:462-505]()\n\n### Workspace Resolution\n\n`BrowserMain` resolves the workspace to open [src/vs/workbench/browser/web.main.ts:607-625]():\n\n1. Checks `config.workspaceProvider.workspace`\n2. If multi-root workspace (`isWorkspaceToOpen`), calls `getWorkspaceIdentifier()`\n3. If single folder (`isFolderToOpen`), calls `getSingleFolderWorkspaceIdentifier()`\n4. Otherwise, returns `UNKNOWN_EMPTY_WINDOW_WORKSPACE`\n\n**Sources**: [src/vs/workbench/browser/web.main.ts:607-625]()\n\n## CLI Operations Entry: CliMain\n\nThe `CliMain` class in [src/vs/code/node/cliProcessMain.ts:81-127]() handles extension management and other CLI operations.\n\n### CliMain Initialization Flow\n\n**CliMain Startup Sequence**\n\n```mermaid\ngraph TB\n    Constructor[\"new CliMain(argv)\"]\n    \n    Run[\"run()\"]\n    \n    InitServices[\"initServices()\"]\n    \n    subgraph \"CLI Services\"\n        ProductSvc[\"IProductService\"]\n        EnvSvc[\"INativeEnvironmentService\u003cbr/\u003eNativeEnvironmentService\"]\n        LoggerSvc[\"ILoggerService\u003cbr/\u003eLoggerService\"]\n        LogSvc[\"ILogService\u003cbr/\u003eLogService\"]\n        FileSvc[\"IFileService\u003cbr/\u003eFileService + DiskFileSystemProvider\"]\n        UriIdSvc[\"IUriIdentityService\u003cbr/\u003eUriIdentityService\"]\n        ProfilesSvc[\"IUserDataProfilesService\u003cbr/\u003eUserDataProfilesReadonlyService\"]\n        ConfigSvc[\"IConfigurationService\u003cbr/\u003eConfigurationService\"]\n        RequestSvc[\"IRequestService\u003cbr/\u003eRequestService\"]\n        DownloadSvc[\"IDownloadService\u003cbr/\u003eDownloadService\"]\n        ExtScanSvc[\"IExtensionsScannerService\u003cbr/\u003eExtensionsScannerService\"]\n        ExtMgmtSvc[\"INativeServerExtensionManagementService\u003cbr/\u003eExtensionManagementService\"]\n        ExtGallerySvc[\"IExtensionGalleryService\u003cbr/\u003eExtensionGalleryServiceWithNoStorageService\"]\n        McpSvc[\"IMcpManagementService\u003cbr/\u003eMcpManagementService\"]\n        TelemetrySvc[\"ITelemetryService\u003cbr/\u003eTelemetryService or NullTelemetryService\"]\n    end\n    \n    DoRun[\"doRun()\u003cbr/\u003eExecute CLI operation\"]\n    \n    subgraph \"CLI Operations\"\n        ListExt[\"List Extensions\u003cbr/\u003eExtensionManagementCLI.listExtensions()\"]\n        InstallExt[\"Install Extension\u003cbr/\u003eExtensionManagementCLI.installExtensions()\"]\n        UninstallExt[\"Uninstall Extension\u003cbr/\u003eExtensionManagementCLI.uninstallExtensions()\"]\n        LocateExt[\"Locate Extension\u003cbr/\u003eExtensionManagementCLI.locateExtension()\"]\n        AddMcp[\"Add MCP Server\u003cbr/\u003eMcpManagementCli.addMcpServer()\"]\n    end\n    \n    Constructor --\u003e Run\n    Run --\u003e InitServices\n    InitServices --\u003e ProductSvc\n    InitServices --\u003e EnvSvc\n    InitServices --\u003e LoggerSvc\n    InitServices --\u003e LogSvc\n    InitServices --\u003e FileSvc\n    InitServices --\u003e ConfigSvc\n    InitServices --\u003e ExtScanSvc\n    InitServices --\u003e ExtMgmtSvc\n    InitServices --\u003e McpSvc\n    \n    InitServices --\u003e DoRun\n    DoRun --\u003e ListExt\n    DoRun --\u003e InstallExt\n    DoRun --\u003e UninstallExt\n    DoRun --\u003e LocateExt\n    DoRun --\u003e AddMcp\n```\n\n**Sources**: [src/vs/code/node/cliProcessMain.ts:81-292]()\n\n### Extension Management CLI\n\nThe `ExtensionManagementCLI` class provides the core CLI functionality:\n\n| Operation | Argument | Implementation |\n|-----------|----------|----------------|\n| List extensions | `--list-extensions` | `listExtensions()` [src/vs/platform/extensionManagement/common/extensionManagementCLI.ts:34-77]() |\n| Install extension | `--install-extension` | `installExtensions()` [src/vs/platform/extensionManagement/common/extensionManagementCLI.ts:79-186]() |\n| Uninstall extension | `--uninstall-extension` | `uninstallExtensions()` [src/vs/platform/extensionManagement/common/extensionManagementCLI.ts:188-238]() |\n| Update extensions | `--update-extensions` | `updateExtensions()` [src/vs/platform/extensionManagement/common/extensionManagementCLI.ts:240-274]() |\n| Locate extension | `--locate-extension` | `locateExtension()` [src/vs/platform/extensionManagement/common/extensionManagementCLI.ts:276-299]() |\n\n**Sources**: [src/vs/platform/extensionManagement/common/extensionManagementCLI.ts:20-317]()\n\n## Workbench Module Loading\n\nAfter the entry point class initializes core services, it loads workbench modules. These modules use a layered import system:\n\n| Module | File | Purpose | Used By |\n|--------|------|---------|---------|\n| Common | `workbench.common.main.ts` | Shared workbench foundation | Desktop and Web |\n| Desktop | `workbench.desktop.main.ts` | Electron-specific additions | Desktop only |\n| Web | `workbench.web.main.ts` | Browser-specific additions | Web only |\n\n### Module Import Hierarchy\n\n**Workbench Module Layering**\n\n```mermaid\ngraph TB\n    subgraph \"Desktop Entry Point\"\n        DesktopMain[\"workbench.desktop.main.ts\"]\n        DesktopImport[\"import './workbench.common.main.js'\"]\n        DesktopSpecific[\"Desktop-specific:\u003cbr/\u003e- electron-browser/desktop.main.js\u003cbr/\u003e- nativeTextFileService.js\u003cbr/\u003e- extensionManagementService.js\u003cbr/\u003e- nativeExtensionService.js\"]\n        MainExport[\"export { main } from\u003cbr/\u003eelectron-browser/desktop.main.js\"]\n    end\n    \n    subgraph \"Web Entry Point\"\n        WebMain[\"workbench.web.main.ts\"]\n        WebImport[\"import './workbench.common.main.js'\"]\n        WebSpecific[\"Web-specific:\u003cbr/\u003e- browser/web.main.js\u003cbr/\u003e- browserTextFileService.js\u003cbr/\u003e- extensionService.js (web workers)\u003cbr/\u003e- webExtensionsScannerService.js\"]\n    end\n    \n    subgraph \"Common Foundation\"\n        CommonMain[\"workbench.common.main.ts\"]\n        EditorCore[\"editor/editor.all.js\u003cbr/\u003eMonaco Editor\"]\n        WorkbenchCore[\"browser/workbench.contribution.js\"]\n        ExtHostAPI[\"api/browser/extensionHost.contribution.js\"]\n        Services[\"Core Services:\u003cbr/\u003eEditorService, ThemeService,\u003cbr/\u003eLanguageService, etc.\"]\n        Contributions[\"Feature Contributions:\u003cbr/\u003eTerminal, Notebook, Chat,\u003cbr/\u003eSCM, Debug, Extensions\"]\n    end\n    \n    DesktopMain --\u003e DesktopImport\n    DesktopImport --\u003e CommonMain\n    DesktopMain --\u003e DesktopSpecific\n    DesktopMain --\u003e MainExport\n    \n    WebMain --\u003e WebImport\n    WebImport --\u003e CommonMain\n    WebMain --\u003e WebSpecific\n    \n    CommonMain --\u003e EditorCore\n    CommonMain --\u003e WorkbenchCore\n    CommonMain --\u003e ExtHostAPI\n    CommonMain --\u003e Services\n    CommonMain --\u003e Contributions\n```\n\n**Sources**: [src/vs/workbench/workbench.common.main.ts:1-434](), [src/vs/workbench/workbench.desktop.main.ts:1-192](), [src/vs/workbench/workbench.web.main.ts:1-176]()\n\nThe workbench modules use ES6 imports with side effects. When imported, these modules register services, contributions, actions, and views that make up the workbench UI and functionality.\n\n**Sources**: [src/vs/workbench/workbench.common.main.ts:1-434](), [src/vs/workbench/workbench.desktop.main.ts:1-192](), [src/vs/workbench/workbench.web.main.ts:1-176]()\n\n## Specialized Execution Modes\n\n### Tunnel Mode\n\nThe `tunnel` subcommand enables remote access via vscode.dev without manual port forwarding.\n\n**Tunnel Mode Flow**\n\n```mermaid\ngraph LR\n    TunnelCmd[\"code tunnel\"]\n    \n    Detection[\"Subcommand Detection\u003cbr/\u003eargs.tunnel\u003cbr/\u003ecli.ts:53\"]\n    \n    TunnelBinary[\"Tunnel Binary\u003cbr/\u003eRust CLI or cargo run\u003cbr/\u003ebin/code-tunnel\"]\n    \n    Spawn[\"spawn() tunnel process\u003cbr/\u003ePass all arguments\"]\n    \n    TunnelService[\"Tunnel Service\u003cbr/\u003eRegisters with relay\u003cbr/\u003eCreates secure tunnel\"]\n    \n    RemoteClient[\"Remote Client\u003cbr/\u003evscode.dev or desktop\u003cbr/\u003eConnects via tunnel URL\"]\n    \n    TunnelCmd --\u003e Detection\n    Detection --\u003e TunnelBinary\n    TunnelBinary --\u003e Spawn\n    Spawn --\u003e TunnelService\n    TunnelService -..\"tunnel connection\"..-\u003e RemoteClient\n```\n\n**Implementation Details**:\n- Detected by `args.tunnel` presence [src/vs/code/node/cli.ts:53-88]()\n- In development (`VSCODE_DEV`), runs `cargo run` in `cli/` directory\n- In production, spawns bundled binary from `bin/code-tunnel` (or `.exe` on Windows)\n- All arguments after `tunnel` keyword are forwarded to the tunnel CLI\n- Process inherits stdout/stderr to display tunnel logs\n\n**Sources**: [src/vs/code/node/cli.ts:53-88]()\n\n### Serve-Web Mode\n\nThe `serve-web` subcommand starts a local HTTP server serving the VS Code web UI.\n\nSimilar to tunnel mode, spawns the external CLI binary with the `serve-web` subcommand. Used for local development and testing of the web workbench.\n\n**Sources**: [src/vs/code/node/cli.ts:53-88]()\n\n### Chat Mode\n\nThe `chat` subcommand opens VS Code with an initialized chat session.\n\n**Chat Arguments** [src/vs/platform/environment/node/argv.ts:51-64]():\n\n| Argument | Type | Description |\n|----------|------|-------------|\n| `_` | `string[]` | The prompt text |\n| `--mode` | `string` | Chat mode: 'ask', 'edit', 'agent', or custom mode ID |\n| `--add-file` | `string[]` | Files to add as context |\n| `--maximize` | `boolean` | Maximize the chat view |\n| `--reuse-window` | `boolean` | Use last active window |\n| `--new-window` | `boolean` | Open in new window |\n| `--profile` | `string` | Profile to use |\n| `--help` | `boolean` | Show chat-specific help |\n\n**Flow**:\n1. Arguments are parsed by `parseArgs()` with chat subcommand options\n2. Main application receives arguments and opens/activates a window\n3. Chat view is initialized with pre-populated prompt and context files\n4. View is optionally maximized if `--maximize` is set\n\n**Sources**: [src/vs/platform/environment/node/argv.ts:51-64](), [src/vs/code/node/cli.ts:98-101]()\n\n## Electron Desktop Entry: CodeMain\n\nThe `CodeMain` class in [src/vs/code/electron-main/main.ts:86-159]() is the entry point for Electron desktop applications.\n\n### CodeMain Initialization Flow\n\n**CodeMain Startup Sequence**\n\n```mermaid\ngraph TB\n    Entry[\"CodeMain.main()\"]\n    \n    Startup[\"CodeMain.startup()\"]\n    \n    CreateServices[\"createServices()\u003cbr/\u003eServiceCollection\"]\n    \n    subgraph \"Service Creation\"\n        ProductSvc[\"IProductService\u003cbr/\u003eproduct.ts\"]\n        EnvSvc[\"IEnvironmentMainService\u003cbr/\u003eEnvironmentMainService\"]\n        LogSvc[\"ILoggerService, ILogService\u003cbr/\u003eLoggerMainService, BufferLogger\"]\n        FileSvc[\"IFileService\u003cbr/\u003eFileService + DiskFileSystemProvider\"]\n        StateSvc[\"IStateService\u003cbr/\u003eStateService\"]\n        ProfileSvc[\"IUserDataProfilesMainService\u003cbr/\u003eUserDataProfilesMainService\"]\n        PolicySvc[\"IPolicyService\u003cbr/\u003eNativePolicyService (Windows/macOS)\u003cbr/\u003eFilePolicyService (Linux)\"]\n        ConfigSvc[\"IConfigurationService\u003cbr/\u003eConfigurationService\"]\n    end\n    \n    InitServices[\"initServices()\u003cbr/\u003eInitialize state and config\"]\n    \n    ClaimInstance[\"claimInstance()\u003cbr/\u003eCreate NodeIPCServer\u003cbr/\u003eCheck for existing instance\"]\n    \n    CreateApp[\"new CodeApplication()\u003cbr/\u003eapp.ts\"]\n    \n    AppStartup[\"CodeApplication.startup()\"]\n    \n    Entry --\u003e Startup\n    Startup --\u003e CreateServices\n    \n    CreateServices --\u003e ProductSvc\n    CreateServices --\u003e EnvSvc\n    CreateServices --\u003e LogSvc\n    CreateServices --\u003e FileSvc\n    CreateServices --\u003e StateSvc\n    CreateServices --\u003e ProfileSvc\n    CreateServices --\u003e PolicySvc\n    CreateServices --\u003e ConfigSvc\n    \n    CreateServices --\u003e InitServices\n    InitServices --\u003e ClaimInstance\n    ClaimInstance --\u003e CreateApp\n    CreateApp --\u003e AppStartup\n```\n\n**Sources**: [src/vs/code/electron-main/main.ts:86-159](), [src/vs/code/electron-main/main.ts:162-228]()\n\n### Instance Claiming\n\nThe `claimInstance()` method [src/vs/code/electron-main/main.ts:230-394]() ensures only one VS Code instance handles a given workspace:\n\n1. Creates a `NodeIPCServer` on a unique socket/named pipe\n2. If successful, this instance becomes the primary\n3. If socket is already in use, connects as client and sends arguments to existing instance\n4. The existing instance handles the request (e.g., opening a file)\n\nThis prevents multiple instances from accessing the same workspace simultaneously and enables features like \"Open in existing window.\"\n\n**Sources**: [src/vs/code/electron-main/main.ts:230-394]()\n\n### CodeApplication Startup\n\nAfter instance claiming, `CodeApplication` from [src/vs/code/electron-main/app.ts:132-628]() takes over:\n\n1. **Configure Session** [src/vs/code/electron-main/app.ts:163-378](): Set Electron security policies, permissions, request filtering\n2. **Setup Shared Process** [src/vs/code/electron-main/app.ts:581](): Launch shared process for long-running services\n3. **Initialize Services** [src/vs/code/electron-main/app.ts:584](): Complete service initialization with machine ID resolution\n4. **Setup Protocol Handlers** [src/vs/code/electron-main/app.ts:599](): Register URL protocol handlers\n5. **Open Windows** [src/vs/code/electron-main/app.ts:608](): Open initial windows based on arguments\n\n**Sources**: [src/vs/code/electron-main/app.ts:532-628]()\n\n## Environment-Specific Argument Handling\n\nDifferent execution environments require different argument handling strategies.\n\n### Desktop (Electron) Arguments\n\nDesktop arguments are processed through [src/vs/platform/environment/node/argvHelper.ts:12-89]():\n\n1. **`parseMainProcessArgv()`**: Primary parser for main process\n2. **`parseCLIProcessArgv()`**: Parser for CLI operations subprocess\n3. **Validation**: Includes checks for conflicting options, deprecated flags\n\n**Special Handling**:\n- `--wait`: Creates marker file [src/vs/platform/environment/node/wait.ts]() that's deleted when file closes\n- `--` (stdin): Reads from stdin into temporary file [src/vs/platform/environment/node/stdin.ts:40-109]()\n- `--remote`: Extracts remote authority from argument\n\n### Web/Browser Arguments\n\nWeb applications receive configuration differently [src/vs/workbench/services/environment/browser/environmentService.ts:265-278]():\n\n1. Configuration is embedded in HTML via `\u003cmeta\u003e` tag\n2. Parsed from `data-settings` attribute\n3. Converted to `IWorkbenchConstructionOptions`\n4. Query parameters may provide additional configuration\n\n**Payload Parsing**: The `payload` map [src/vs/workbench/services/environment/browser/environmentService.ts:263-277]() contains key-value pairs from the workspace provider, including:\n- `extensionDevelopmentPath`: Extension to debug\n- `extensionTestsPath`: Test runner location\n- `debugRenderer`: Enable renderer debugging\n- `logLevel`: Logging configuration\n- Profile information\n\n### Server Arguments\n\nServer arguments use `ServerParsedArgs` [src/vs/server/node/serverEnvironmentService.ts:18-98]() which extends `NativeParsedArgs` with server-specific options:\n\n- Connection parameters (`host`, `port`, `socket-path`)\n- Authentication (`connection-token`, `connection-token-file`)\n- Base path configuration (`server-base-path`)\n- Compatibility mode settings\n\n**Sources**: [src/vs/platform/environment/node/argvHelper.ts:12-89](), [src/vs/workbench/services/environment/browser/environmentService.ts:42-405](), [src/vs/server/node/serverEnvironmentService.ts:18-134]()"])</script><script>self.__next_f.push([1,"1f:T6396,"])</script><script>self.__next_f.push([1,"# Electron Main Process Startup\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [build/lib/i18n.resources.json](build/lib/i18n.resources.json)\n- [cli/src/bin/code/legacy_args.rs](cli/src/bin/code/legacy_args.rs)\n- [resources/completions/bash/code](resources/completions/bash/code)\n- [resources/completions/zsh/_code](resources/completions/zsh/_code)\n- [src/vs/base/node/terminalEncoding.ts](src/vs/base/node/terminalEncoding.ts)\n- [src/vs/code/browser/workbench/workbench-dev.html](src/vs/code/browser/workbench/workbench-dev.html)\n- [src/vs/code/browser/workbench/workbench.html](src/vs/code/browser/workbench/workbench.html)\n- [src/vs/code/browser/workbench/workbench.ts](src/vs/code/browser/workbench/workbench.ts)\n- [src/vs/code/electron-main/app.ts](src/vs/code/electron-main/app.ts)\n- [src/vs/code/electron-main/main.ts](src/vs/code/electron-main/main.ts)\n- [src/vs/code/node/cli.ts](src/vs/code/node/cli.ts)\n- [src/vs/code/node/cliProcessMain.ts](src/vs/code/node/cliProcessMain.ts)\n- [src/vs/platform/environment/common/argv.ts](src/vs/platform/environment/common/argv.ts)\n- [src/vs/platform/environment/common/environment.ts](src/vs/platform/environment/common/environment.ts)\n- [src/vs/platform/environment/common/environmentService.ts](src/vs/platform/environment/common/environmentService.ts)\n- [src/vs/platform/environment/electron-main/environmentMainService.ts](src/vs/platform/environment/electron-main/environmentMainService.ts)\n- [src/vs/platform/environment/node/argv.ts](src/vs/platform/environment/node/argv.ts)\n- [src/vs/platform/environment/node/argvHelper.ts](src/vs/platform/environment/node/argvHelper.ts)\n- [src/vs/platform/environment/node/environmentService.ts](src/vs/platform/environment/node/environmentService.ts)\n- [src/vs/platform/environment/node/stdin.ts](src/vs/platform/environment/node/stdin.ts)\n- [src/vs/platform/extensionManagement/common/extensionManagementCLI.ts](src/vs/platform/extensionManagement/common/extensionManagementCLI.ts)\n- [src/vs/server/node/remoteExtensionHostAgentCli.ts](src/vs/server/node/remoteExtensionHostAgentCli.ts)\n- [src/vs/server/node/server.cli.ts](src/vs/server/node/server.cli.ts)\n- [src/vs/server/node/serverEnvironmentService.ts](src/vs/server/node/serverEnvironmentService.ts)\n- [src/vs/server/node/serverServices.ts](src/vs/server/node/serverServices.ts)\n- [src/vs/workbench/browser/web.api.ts](src/vs/workbench/browser/web.api.ts)\n- [src/vs/workbench/browser/web.factory.ts](src/vs/workbench/browser/web.factory.ts)\n- [src/vs/workbench/browser/web.main.ts](src/vs/workbench/browser/web.main.ts)\n- [src/vs/workbench/electron-browser/desktop.main.ts](src/vs/workbench/electron-browser/desktop.main.ts)\n- [src/vs/workbench/services/environment/browser/environmentService.ts](src/vs/workbench/services/environment/browser/environmentService.ts)\n- [src/vs/workbench/services/environment/common/environmentService.ts](src/vs/workbench/services/environment/common/environmentService.ts)\n- [src/vs/workbench/services/environment/electron-browser/environmentService.ts](src/vs/workbench/services/environment/electron-browser/environmentService.ts)\n- [src/vs/workbench/services/extensions/electron-browser/nativeExtensionService.ts](src/vs/workbench/services/extensions/electron-browser/nativeExtensionService.ts)\n- [src/vs/workbench/workbench.common.main.ts](src/vs/workbench/workbench.common.main.ts)\n- [src/vs/workbench/workbench.desktop.main.ts](src/vs/workbench/workbench.desktop.main.ts)\n- [src/vs/workbench/workbench.web.main.ts](src/vs/workbench/workbench.web.main.ts)\n\n\u003c/details\u003e\n\n\n\nThis document describes how VS Code's Electron main process initializes when the application launches. It covers the sequence from the initial entry point through service instantiation, security configuration, IPC server setup, and the eventual opening of windows. For information about the renderer process initialization, see the Workbench Bootstrap section [3.4](#3.4). For multi-process architecture concepts, see [3.3](#3.3).\n\n## Entry Point and Main Flow\n\nVS Code's Electron main process begins execution in the `CodeMain` class, which orchestrates the entire startup sequence before any UI is shown.\n\n```mermaid\ngraph TD\n    EntryPoint[\"main.ts: CodeMain\"]\n    Startup[\"CodeMain.startup()\"]\n    CreateServices[\"createServices()\"]\n    InitServices[\"initServices()\"]\n    ClaimInstance[\"claimInstance()\"]\n    CreateApp[\"new CodeApplication()\"]\n    AppStartup[\"CodeApplication.startup()\"]\n    \n    EntryPoint --\u003e Startup\n    Startup --\u003e CreateServices\n    CreateServices --\u003e InitServices\n    InitServices --\u003e ClaimInstance\n    ClaimInstance --\u003e CreateApp\n    CreateApp --\u003e AppStartup\n```\n\n**Main Process Entry Point Flow**\n\nThe `CodeMain.main()` method initiates startup, which then proceeds through these phases:\n\n1. **Error Handler Setup** - Sets an unexpected error handler to prevent default Electron error dialogs\n2. **Service Creation** - Instantiates core platform services\n3. **Service Initialization** - Initializes file system, state, and configuration services\n4. **Instance Claiming** - Establishes IPC server to ensure single instance\n5. **Application Creation** - Instantiates `CodeApplication`\n6. **Startup Execution** - Runs the main application lifecycle\n\nSources: [src/vs/code/electron-main/main.ts:88-160]()\n\n## Service Creation and Instantiation\n\nBefore any application logic runs, the main process creates and wires up essential platform services using dependency injection.\n\n```mermaid\ngraph TB\n    subgraph \"Service Collection\"\n        ProductService[\"IProductService\"]\n        EnvService[\"IEnvironmentMainService\"]\n        LoggerService[\"ILoggerMainService\"]\n        LogService[\"ILogService\"]\n        FileService[\"IFileService\"]\n        StateService[\"IStateService\"]\n        UriIdentityService[\"IUriIdentityService\"]\n        UserDataProfilesService[\"IUserDataProfilesMainService\"]\n        PolicyService[\"IPolicyService\"]\n        ConfigService[\"IConfigurationService\"]\n        LifecycleService[\"ILifecycleMainService\"]\n        ProtocolService[\"IProtocolMainService\"]\n    end\n    \n    InstantiationService[\"InstantiationService\"]\n    \n    InstantiationService --\u003e ProductService\n    InstantiationService --\u003e EnvService\n    InstantiationService --\u003e LoggerService\n    InstantiationService --\u003e LogService\n    InstantiationService --\u003e FileService\n    InstantiationService --\u003e StateService\n    InstantiationService --\u003e UriIdentityService\n    InstantiationService --\u003e UserDataProfilesService\n    InstantiationService --\u003e PolicyService\n    InstantiationService --\u003e ConfigService\n    InstantiationService --\u003e LifecycleService\n    InstantiationService --\u003e ProtocolService\n```\n\n**Core Services Created During Startup**\n\nThe `createServices()` method sets up a `ServiceCollection` with the following key services:\n\n| Service | Implementation | Purpose |\n|---------|---------------|---------|\n| `IProductService` | product constants | Product metadata and configuration |\n| `IEnvironmentMainService` | `EnvironmentMainService` | Paths and command-line arguments |\n| `ILoggerMainService` | `LoggerMainService` | Logger management |\n| `ILogService` | `LogService` with `BufferLogger` | Logging infrastructure |\n| `IFileService` | `FileService` with `DiskFileSystemProvider` | File system operations |\n| `IStateService` | `StateService` | Persistent state storage |\n| `IUserDataProfilesMainService` | `UserDataProfilesMainService` | User profile management |\n| `IPolicyService` | Platform-specific policy service | Enterprise policy enforcement |\n| `IConfigurationService` | `ConfigurationService` | Settings management |\n| `ILifecycleMainService` | `LifecycleMainService` | Application lifecycle events |\n| `IProtocolMainService` | `ProtocolMainService` | Protocol URL handling |\n\nThe services are registered with `ServiceCollection` and then used to create an `InstantiationService`, which provides dependency injection throughout the application.\n\nSources: [src/vs/code/electron-main/main.ts:162-247]()\n\n## Service Initialization\n\nAfter service instances are created, they must be initialized to prepare the application environment.\n\n```mermaid\ngraph LR\n    CreateDirs[\"Create Directories\"]\n    InitState[\"StateService.init()\"]\n    InitConfig[\"ConfigurationService.initialize()\"]\n    InitProfiles[\"UserDataProfilesMainService.init()\"]\n    \n    CreateDirs --\u003e InitState\n    InitState --\u003e InitConfig\n    InitConfig --\u003e InitProfiles\n```\n\n**Directory and Service Initialization Sequence**\n\nThe `initServices()` method performs the following operations:\n\n1. **Directory Creation** - Creates essential directories if they don't exist:\n   - Extensions path\n   - Code cache path\n   - Logs home\n   - Global storage home\n   - Workspace storage home\n   - Local history home\n   - Backup home\n\n2. **State Service Initialization** - Loads persistent application state from disk\n\n3. **Configuration Service Initialization** - Loads user settings\n\n4. **User Data Profiles Initialization** - Initializes profile system after state is loaded\n\nAll these operations run in parallel using `Promises.settled()` to ensure one failure doesn't block others.\n\nSources: [src/vs/code/electron-main/main.ts:267-289]()\n\n## Instance Claiming and IPC Server\n\nVS Code ensures only one instance runs at a time by attempting to create an IPC server on a known handle.\n\n```mermaid\ngraph TD\n    ClaimStart[\"claimInstance()\"]\n    TryServe[\"nodeIPCServe(mainIPCHandle)\"]\n    Success[\"Server Created Successfully\"]\n    AddressInUse[\"Error: EADDRINUSE\"]\n    Connect[\"nodeIPCConnect(mainIPCHandle)\"]\n    ConnectSuccess[\"Send args to existing instance\"]\n    ConnectFail[\"Retry or show error\"]\n    Exit[\"Exit Process\"]\n    \n    ClaimStart --\u003e TryServe\n    TryServe --\u003e Success\n    TryServe --\u003e AddressInUse\n    AddressInUse --\u003e Connect\n    Connect --\u003e ConnectSuccess\n    Connect --\u003e ConnectFail\n    ConnectSuccess --\u003e Exit\n    ConnectFail --\u003e ConnectSuccess\n    Success --\u003e Return[\"Return IPC Server\"]\n```\n\n**Multi-Instance Prevention**\n\nThe `claimInstance()` method implements the following logic:\n\n1. **Attempt Server Creation** - Try to create a `NodeIPCServer` listening on `environmentMainService.mainIPCHandle`\n\n2. **Success Path** - If successful, this is the first instance:\n   - Register shutdown handler to dispose server\n   - Write process ID to lockfile\n   - Return the server\n\n3. **Failure Path (EADDRINUSE)** - If the address is already in use:\n   - Connect as a client to the existing instance\n   - Send command-line arguments via IPC\n   - Show warning dialog if connection takes \u003e10 seconds\n   - Exit the process\n\n4. **Special Cases**:\n   - Extension tests require single instance (error if multiple)\n   - On Linux/macOS, stale pipes may be deleted and retry attempted\n\nSources: [src/vs/code/electron-main/main.ts:303-383]()\n\n## CodeApplication Initialization\n\nOnce services are ready and the instance is claimed, `CodeApplication` is instantiated to manage the application lifecycle.\n\n```mermaid\ngraph TD\n    Constructor[\"CodeApplication constructor\"]\n    ConfigureSession[\"configureSession()\"]\n    RegisterListeners[\"registerListeners()\"]\n    \n    subgraph \"Session Configuration\"\n        Permissions[\"Permission Handlers\"]\n        RequestFiltering[\"Request Filtering\"]\n        SVGBlocking[\"SVG Request Blocking\"]\n        CORSHeaders[\"CORS Headers for PRSS CDN\"]\n        CodeCache[\"Code Cache Path\"]\n        UNCAllowlist[\"UNC Host Allowlist (Windows)\"]\n    end\n    \n    subgraph \"Event Listeners\"\n        Shutdown[\"onWillShutdown\"]\n        ContextMenu[\"Context Menu IPC\"]\n        Accessibility[\"Accessibility Changes\"]\n        MacOSDock[\"macOS Dock Activate\"]\n        WebContents[\"Web Contents Created\"]\n        OpenFile[\"macOS Open File\"]\n        IPCHandlers[\"Bootstrap IPC Handlers\"]\n    end\n    \n    Constructor --\u003e ConfigureSession\n    Constructor --\u003e RegisterListeners\n    ConfigureSession --\u003e Permissions\n    ConfigureSession --\u003e RequestFiltering\n    ConfigureSession --\u003e SVGBlocking\n    ConfigureSession --\u003e CORSHeaders\n    ConfigureSession --\u003e CodeCache\n    ConfigureSession --\u003e UNCAllowlist\n    RegisterListeners --\u003e Shutdown\n    RegisterListeners --\u003e ContextMenu\n    RegisterListeners --\u003e Accessibility\n    RegisterListeners --\u003e MacOSDock\n    RegisterListeners --\u003e WebContents\n    RegisterListeners --\u003e OpenFile\n    RegisterListeners --\u003e IPCHandlers\n```\n\n**CodeApplication Constructor Actions**\n\nThe `CodeApplication` constructor performs two critical setup operations:\n\n1. **Session Configuration** - Configures Electron's session object for security\n2. **Listener Registration** - Registers event handlers for application lifecycle\n\nSources: [src/vs/code/electron-main/app.ts:141-159]()\n\n## Session Security Configuration\n\nThe `configureSession()` method sets up comprehensive security measures for all web content.\n\n**Permission Management**\n\nVS Code implements strict permission controls based on content origin:\n\n| Permission | Webview | Core Window | Other Origins |\n|------------|---------|-------------|---------------|\n| `pointerLock` |  |  |  |\n| `notifications` |  |  |  |\n| `clipboard-read` |  |  |  |\n| `clipboard-sanitized-write` |  |  |  |\n| `media` |  |  |  |\n| `local-fonts` |  |  |  |\n\nThe permission handlers check the requesting URL scheme:\n- `vscode-file://vscode_authority` - Core window content\n- `vscode-webview://` - Webview content\n- All other origins - Denied\n\n**Request Filtering**\n\nThe session's `webRequest` handlers block potentially dangerous requests:\n\n1. **Webview Protection** - Only allows webview index.html to load from main windows\n2. **File Resource Protection** - Only allows `vscode-file:` requests from main windows or shared process\n3. **SVG Blocking** - Blocks SVG loads from unsupported schemes unless from safe contexts (webview or XHR)\n\n**Other Security Measures**\n\n- **Code Cache Partitioning** - Sets custom code cache path to invalidate caches appropriately\n- **UNC Access Control (Windows)** - Restricts UNC path access based on `security.restrictUNCAccess` and `security.allowedUNCHosts` settings\n\nSources: [src/vs/code/electron-main/app.ts:161-376]()\n\n## Application Startup Sequence\n\nThe `CodeApplication.startup()` method orchestrates the main application initialization after construction.\n\n```mermaid\ngraph TD\n    StartupBegin[\"CodeApplication.startup()\"]\n    SetAppUserModelId[\"Set Windows App User Model ID\"]\n    MacOSTabs[\"Configure macOS Native Tabs\"]\n    CreateElectronIPCServer[\"new ElectronIPCServer()\"]\n    ResolveMachineIds[\"Resolve machineId, sqmId, devDeviceId\"]\n    SetupSharedProcess[\"setupSharedProcess()\"]\n    InitServices[\"initServices()\"]\n    InitChannels[\"initChannels()\"]\n    SetupProtocolHandlers[\"setupProtocolUrlHandlers()\"]\n    SetupRemoteResource[\"setupManagedRemoteResourceUrlHandler()\"]\n    PhaseReady[\"lifecycleMainService.phase = Ready\"]\n    OpenFirstWindow[\"openFirstWindow()\"]\n    PhaseAfterWindowOpen[\"lifecycleMainService.phase = AfterWindowOpen\"]\n    AfterWindowOpenTasks[\"afterWindowOpen()\"]\n    PhaseEventually[\"lifecycleMainService.phase = Eventually\"]\n    \n    StartupBegin --\u003e SetAppUserModelId\n    SetAppUserModelId --\u003e MacOSTabs\n    MacOSTabs --\u003e CreateElectronIPCServer\n    CreateElectronIPCServer --\u003e ResolveMachineIds\n    ResolveMachineIds --\u003e SetupSharedProcess\n    SetupSharedProcess --\u003e InitServices\n    InitServices --\u003e InitChannels\n    InitChannels --\u003e SetupProtocolHandlers\n    SetupProtocolHandlers --\u003e SetupRemoteResource\n    SetupRemoteResource --\u003e PhaseReady\n    PhaseReady --\u003e OpenFirstWindow\n    OpenFirstWindow --\u003e PhaseAfterWindowOpen\n    PhaseAfterWindowOpen --\u003e AfterWindowOpenTasks\n    AfterWindowOpenTasks --\u003e PhaseEventually\n```\n\n**Startup Phase Details**\n\nThe startup method executes these key steps:\n\n1. **Windows App User Model ID** - Sets `app.setAppUserModelId()` to associate shortcuts properly on Windows\n\n2. **macOS Compatibility** - Configures native tabs setting if enabled\n\n3. **Electron IPC Server** - Creates `ElectronIPCServer` for renderer-to-main IPC communication\n\n4. **Machine Identification** - Resolves unique identifiers:\n   - `machineId` - Unique machine identifier\n   - `sqmId` - Software Quality Metrics identifier\n   - `devDeviceId` - Development device identifier\n\n5. **Shared Process Setup** - Initializes the shared process for background services\n\n6. **Additional Services** - Initializes application-level services (windows, native host, dialogs, etc.)\n\n7. **IPC Channels** - Registers IPC channels for various services\n\n8. **Protocol URL Handlers** - Sets up handlers for `vscode://` URLs\n\n9. **Lifecycle Phases** - Sets lifecycle phases to coordinate startup:\n   - `LifecycleMainPhase.Ready` - Before opening windows\n   - `LifecycleMainPhase.AfterWindowOpen` - After first window opens\n   - `LifecycleMainPhase.Eventually` - Idle period after startup\n\nSources: [src/vs/code/electron-main/app.ts:526-622]()\n\n## Shared Process Setup\n\nThe shared process runs background services that don't need to be in the main process or renderer.\n\n```mermaid\ngraph LR\n    Setup[\"setupSharedProcess()\"]\n    CreateSharedProcess[\"new SharedProcess()\"]\n    SpawnPromise[\"sharedProcessReady Promise\"]\n    WhenReady[\"sharedProcess.whenReady()\"]\n    CreateClient[\"new MessagePortClient()\"]\n    Return[\"Return client and ready promise\"]\n    \n    Setup --\u003e CreateSharedProcess\n    CreateSharedProcess --\u003e SpawnPromise\n    SpawnPromise --\u003e WhenReady\n    WhenReady --\u003e CreateClient\n    CreateClient --\u003e Return\n```\n\n**Shared Process Responsibilities**\n\nThe `SharedProcess` is a utility process that hosts services like:\n- Extension management\n- Telemetry collection\n- Update service\n- Storage services\n- User data sync\n\nThe main process:\n1. Creates a `SharedProcess` instance with machine IDs\n2. Returns a client (`MessagePortClient`) for IPC communication\n3. Provides a `sharedProcessReady` promise for coordinating initialization\n\nThe shared process won't actually spawn until the first window connects to it.\n\nSources: [src/vs/code/electron-main/app.ts:575](), [src/vs/platform/sharedProcess/electron-main/sharedProcess.ts:24-112]()\n\n## Service Initialization (Application Level)\n\nAfter the shared process is configured, `CodeApplication` initializes application-level services.\n\n```mermaid\ngraph TD\n    InitServicesMethod[\"initServices()\"]\n    \n    subgraph \"Core Services\"\n        WindowsMainService[\"IWindowsMainService\"]\n        NativeHostMainService[\"INativeHostMainService\"]\n        DialogMainService[\"IDialogMainService\"]\n        MenubarMainService[\"IMenubarMainService\"]\n        LaunchMainService[\"ILaunchMainService\"]\n    end\n    \n    subgraph \"Storage \u0026 State\"\n        StorageMainService[\"IStorageMainService\"]\n        ApplicationStorageMainService[\"IApplicationStorageMainService\"]\n        BackupMainService[\"IBackupMainService\"]\n    end\n    \n    subgraph \"Extension \u0026 External\"\n        ExtensionHostStarter[\"IExtensionHostStarter\"]\n        ExternalTerminalService[\"IExternalTerminalMainService\"]\n        UpdateService[\"IUpdateService\"]\n        URLService[\"IURLService\"]\n    end\n    \n    InitServicesMethod --\u003e WindowsMainService\n    InitServicesMethod --\u003e NativeHostMainService\n    InitServicesMethod --\u003e DialogMainService\n    InitServicesMethod --\u003e MenubarMainService\n    InitServicesMethod --\u003e LaunchMainService\n    InitServicesMethod --\u003e StorageMainService\n    InitServicesMethod --\u003e ApplicationStorageMainService\n    InitServicesMethod --\u003e BackupMainService\n    InitServicesMethod --\u003e ExtensionHostStarter\n    InitServicesMethod --\u003e ExternalTerminalService\n    InitServicesMethod --\u003e UpdateService\n    InitServicesMethod --\u003e URLService\n```\n\n**Application Services Instantiation**\n\nThe `initServices()` method creates instances of high-level application services:\n\n**Window Management**\n- `IWindowsMainService` (`WindowsMainService`) - Manages all application windows\n- `INativeHostMainService` (`NativeHostMainService`) - Provides native OS integration APIs\n\n**UI Services**\n- `IDialogMainService` (`DialogMainService`) - Native file dialogs and message boxes\n- `IMenubarMainService` (`MenubarMainService`) - Application menu management\n\n**Data Services**\n- `IStorageMainService` (`StorageMainService`) - Per-workspace persistent storage\n- `IApplicationStorageMainService` (`ApplicationStorageMainService`) - Application-wide storage\n- `IBackupMainService` (`BackupMainService`) - Backup management for untitled files\n\n**Extension System**\n- `IExtensionHostStarter` (`ExtensionHostStarter`) - Spawns extension host processes\n\n**Platform Services**\n- `IUpdateService` - Platform-specific update service (Darwin/Win32/Linux/Snap)\n- `IExternalTerminalMainService` - Opens external terminal applications\n- `IURLService` (`NativeURLService`) - Handles protocol URLs\n\nAll services are created via `instantiationService.createInstance()` or registered as `SyncDescriptor` for lazy instantiation.\n\nSources: [src/vs/code/electron-main/app.ts:578]()\n\n## IPC Channel Registration\n\nAfter services are initialized, IPC channels are registered to expose main process functionality to renderer processes.\n\n**Channel Registration Pattern**\n\nEach service that needs to communicate with renderers gets an IPC channel:\n\n| Service | Channel Name | Channel Class |\n|---------|-------------|---------------|\n| `IUpdateService` | `'update'` | `UpdateChannel` |\n| `IURLService` | `'urlHandler'` | Dynamic routing |\n| `IExtensionHostStarter` | `'extensionHostStarter'` | ProxyChannel |\n| `ILoggerService` | `'logger'` | `LoggerChannel` |\n| `IStorageMainService` | `'storage'` | `StorageDatabaseChannel` |\n| `IPolicyService` | `'policy'` | `PolicyChannel` |\n| Terminal (Pty) | `'localPtyHost'` | Lazy initialization |\n\nThe channels are registered on the `ElectronIPCServer` using `server.registerChannel()`, which allows renderer processes to access main process services via IPC.\n\nSources: [src/vs/code/electron-main/app.ts:590]()\n\n## Protocol URL Handlers\n\nVS Code handles `vscode://` protocol URLs for extension installation, file opening, and other integrations.\n\n```mermaid\ngraph TD\n    Setup[\"setupProtocolUrlHandlers()\"]\n    RegisterHandlers[\"urlService.registerHandler()\"]\n    HandleProtocolUrl[\"handleProtocolUrl()\"]\n    \n    subgraph \"URL Sources\"\n        CommandLine[\"Command Line --open-url\"]\n        MacOSEvent[\"macOS open-url event\"]\n        WindowsProtocol[\"Windows protocol registration\"]\n    end\n    \n    subgraph \"URL Handling\"\n        CheckSecurity[\"shouldBlockOpenable()\"]\n        ShowConfirmation[\"Show security confirmation\"]\n        ParseURL[\"getWindowOpenableFromProtocolUrl()\"]\n        OpenWindow[\"windowsMainService.open()\"]\n        ForwardToActive[\"Forward to active window\"]\n    end\n    \n    Setup --\u003e RegisterHandlers\n    RegisterHandlers --\u003e HandleProtocolUrl\n    CommandLine --\u003e HandleProtocolUrl\n    MacOSEvent --\u003e HandleProtocolUrl\n    WindowsProtocol --\u003e HandleProtocolUrl\n    HandleProtocolUrl --\u003e CheckSecurity\n    CheckSecurity --\u003e ShowConfirmation\n    ShowConfirmation --\u003e ParseURL\n    ParseURL --\u003e OpenWindow\n    ParseURL --\u003e ForwardToActive\n```\n\n**Protocol URL Processing**\n\nThe `setupProtocolUrlHandlers()` method configures handling for `vscode://` URLs:\n\n1. **ElectronURLListener** - Listens for protocol URLs from:\n   - Command-line arguments (`--open-url`)\n   - macOS `open-url` events\n   - Windows protocol registration\n\n2. **Security Confirmation** - For `file://` and `vscode-remote://` schemes, shows a confirmation dialog before opening to prevent malicious URLs\n\n3. **URL Routing**:\n   - File/folder/workspace URLs open new windows\n   - Other URLs are forwarded to the active window for handling (e.g., extension marketplace URLs)\n\n4. **Initial Protocol URLs** - URLs received before the first window opens are queued and processed after window creation\n\nSources: [src/vs/code/electron-main/app.ts:624-655](), [src/vs/code/electron-main/app.ts:679-773]()\n\n## Window Opening\n\nThe final step of startup is opening the initial windows based on command-line arguments and previous session state.\n\n```mermaid\ngraph TD\n    OpenFirstWindow[\"openFirstWindow()\"]\n    GetPathsToOpen[\"getPathsToOpen()\"]\n    CheckProtocolUrls[\"Check initialProtocolUrls\"]\n    CheckArgs[\"Check CLI args\"]\n    RestoreSession[\"Restore previous session\"]\n    OpenEmptyWindow[\"Open empty window\"]\n    WindowsOpen[\"Windows displayed\"]\n    \n    OpenFirstWindow --\u003e GetPathsToOpen\n    GetPathsToOpen --\u003e CheckProtocolUrls\n    CheckProtocolUrls --\u003e CheckArgs\n    CheckArgs --\u003e RestoreSession\n    RestoreSession --\u003e OpenEmptyWindow\n    OpenEmptyWindow --\u003e WindowsOpen\n```\n\n**Window Opening Logic**\n\nThe `openFirstWindow()` method determines what to open:\n\n1. **Protocol URLs** - If protocol URLs were passed, open the corresponding files/folders/workspaces\n\n2. **CLI Arguments** - Process command-line arguments:\n   - Files to open\n   - Folders to open\n   - Workspaces to open\n   - `--new-window` flag\n\n3. **Session Restoration** - On initial startup (not forced new window):\n   - Restore previously opened workspaces\n   - Restore empty windows with backups\n   - Restore untitled workspace windows\n\n4. **Empty Window** - If nothing else applies and `--new-window` wasn't specified, open an empty window\n\nThe `IWindowsMainService.open()` method handles the actual window creation, which creates `CodeWindow` instances and loads the renderer process.\n\nSources: [src/vs/code/electron-main/app.ts:602](), [src/vs/platform/windows/electron-main/windowsMainService.ts:294-456]()"])</script><script>self.__next_f.push([1,"20:T9732,"])</script><script>self.__next_f.push([1,"# Multi-Process Architecture\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [build/lib/i18n.resources.json](build/lib/i18n.resources.json)\n- [cli/src/bin/code/legacy_args.rs](cli/src/bin/code/legacy_args.rs)\n- [extensions/vscode-api-tests/package.json](extensions/vscode-api-tests/package.json)\n- [extensions/vscode-api-tests/src/singlefolder-tests/chat.test.ts](extensions/vscode-api-tests/src/singlefolder-tests/chat.test.ts)\n- [resources/completions/bash/code](resources/completions/bash/code)\n- [resources/completions/zsh/_code](resources/completions/zsh/_code)\n- [src/vs/base/node/terminalEncoding.ts](src/vs/base/node/terminalEncoding.ts)\n- [src/vs/code/browser/workbench/workbench-dev.html](src/vs/code/browser/workbench/workbench-dev.html)\n- [src/vs/code/browser/workbench/workbench.html](src/vs/code/browser/workbench/workbench.html)\n- [src/vs/code/browser/workbench/workbench.ts](src/vs/code/browser/workbench/workbench.ts)\n- [src/vs/code/electron-main/app.ts](src/vs/code/electron-main/app.ts)\n- [src/vs/code/electron-main/main.ts](src/vs/code/electron-main/main.ts)\n- [src/vs/code/node/cli.ts](src/vs/code/node/cli.ts)\n- [src/vs/code/node/cliProcessMain.ts](src/vs/code/node/cliProcessMain.ts)\n- [src/vs/editor/browser/config/charWidthReader.ts](src/vs/editor/browser/config/charWidthReader.ts)\n- [src/vs/editor/browser/editorBrowser.ts](src/vs/editor/browser/editorBrowser.ts)\n- [src/vs/editor/browser/viewParts/minimap/minimap.ts](src/vs/editor/browser/viewParts/minimap/minimap.ts)\n- [src/vs/editor/browser/viewParts/minimap/minimapCharRenderer.ts](src/vs/editor/browser/viewParts/minimap/minimapCharRenderer.ts)\n- [src/vs/editor/browser/viewParts/minimap/minimapCharRendererFactory.ts](src/vs/editor/browser/viewParts/minimap/minimapCharRendererFactory.ts)\n- [src/vs/editor/browser/viewParts/minimap/minimapCharSheet.ts](src/vs/editor/browser/viewParts/minimap/minimapCharSheet.ts)\n- [src/vs/editor/browser/viewParts/minimap/minimapPreBaked.ts](src/vs/editor/browser/viewParts/minimap/minimapPreBaked.ts)\n- [src/vs/editor/browser/widget/codeEditor/codeEditorWidget.ts](src/vs/editor/browser/widget/codeEditor/codeEditorWidget.ts)\n- [src/vs/editor/common/config/editorOptions.ts](src/vs/editor/common/config/editorOptions.ts)\n- [src/vs/editor/common/config/fontInfo.ts](src/vs/editor/common/config/fontInfo.ts)\n- [src/vs/editor/common/editorCommon.ts](src/vs/editor/common/editorCommon.ts)\n- [src/vs/editor/common/languages.ts](src/vs/editor/common/languages.ts)\n- [src/vs/editor/common/standalone/standaloneEnums.ts](src/vs/editor/common/standalone/standaloneEnums.ts)\n- [src/vs/editor/common/textModelEvents.ts](src/vs/editor/common/textModelEvents.ts)\n- [src/vs/editor/common/viewModel/minimapTokensColorTracker.ts](src/vs/editor/common/viewModel/minimapTokensColorTracker.ts)\n- [src/vs/editor/test/browser/view/minimapCharRenderer.test.ts](src/vs/editor/test/browser/view/minimapCharRenderer.test.ts)\n- [src/vs/monaco.d.ts](src/vs/monaco.d.ts)\n- [src/vs/platform/environment/common/argv.ts](src/vs/platform/environment/common/argv.ts)\n- [src/vs/platform/environment/common/environment.ts](src/vs/platform/environment/common/environment.ts)\n- [src/vs/platform/environment/common/environmentService.ts](src/vs/platform/environment/common/environmentService.ts)\n- [src/vs/platform/environment/electron-main/environmentMainService.ts](src/vs/platform/environment/electron-main/environmentMainService.ts)\n- [src/vs/platform/environment/node/argv.ts](src/vs/platform/environment/node/argv.ts)\n- [src/vs/platform/environment/node/argvHelper.ts](src/vs/platform/environment/node/argvHelper.ts)\n- [src/vs/platform/environment/node/environmentService.ts](src/vs/platform/environment/node/environmentService.ts)\n- [src/vs/platform/environment/node/stdin.ts](src/vs/platform/environment/node/stdin.ts)\n- [src/vs/platform/extensionManagement/common/extensionManagementCLI.ts](src/vs/platform/extensionManagement/common/extensionManagementCLI.ts)\n- [src/vs/platform/extensions/common/extensionsApiProposals.ts](src/vs/platform/extensions/common/extensionsApiProposals.ts)\n- [src/vs/platform/terminal/common/terminal.ts](src/vs/platform/terminal/common/terminal.ts)\n- [src/vs/platform/terminal/common/terminalEnvironment.ts](src/vs/platform/terminal/common/terminalEnvironment.ts)\n- [src/vs/platform/terminal/common/terminalRecorder.ts](src/vs/platform/terminal/common/terminalRecorder.ts)\n- [src/vs/platform/terminal/node/ptyHostMain.ts](src/vs/platform/terminal/node/ptyHostMain.ts)\n- [src/vs/platform/terminal/node/ptyHostService.ts](src/vs/platform/terminal/node/ptyHostService.ts)\n- [src/vs/platform/terminal/node/ptyService.ts](src/vs/platform/terminal/node/ptyService.ts)\n- [src/vs/platform/terminal/node/terminalProcess.ts](src/vs/platform/terminal/node/terminalProcess.ts)\n- [src/vs/platform/terminal/test/common/terminalEnvironment.test.ts](src/vs/platform/terminal/test/common/terminalEnvironment.test.ts)\n- [src/vs/platform/terminal/test/common/terminalProfiles.test.ts](src/vs/platform/terminal/test/common/terminalProfiles.test.ts)\n- [src/vs/platform/terminal/test/common/terminalRecorder.test.ts](src/vs/platform/terminal/test/common/terminalRecorder.test.ts)\n- [src/vs/server/node/remoteExtensionHostAgentCli.ts](src/vs/server/node/remoteExtensionHostAgentCli.ts)\n- [src/vs/server/node/server.cli.ts](src/vs/server/node/server.cli.ts)\n- [src/vs/server/node/serverEnvironmentService.ts](src/vs/server/node/serverEnvironmentService.ts)\n- [src/vs/server/node/serverServices.ts](src/vs/server/node/serverServices.ts)\n- [src/vs/workbench/api/browser/extensionHost.contribution.ts](src/vs/workbench/api/browser/extensionHost.contribution.ts)\n- [src/vs/workbench/api/browser/mainThreadLanguageFeatures.ts](src/vs/workbench/api/browser/mainThreadLanguageFeatures.ts)\n- [src/vs/workbench/api/browser/mainThreadTerminalService.ts](src/vs/workbench/api/browser/mainThreadTerminalService.ts)\n- [src/vs/workbench/api/common/extHost.api.impl.ts](src/vs/workbench/api/common/extHost.api.impl.ts)\n- [src/vs/workbench/api/common/extHost.protocol.ts](src/vs/workbench/api/common/extHost.protocol.ts)\n- [src/vs/workbench/api/common/extHostLanguageFeatures.ts](src/vs/workbench/api/common/extHostLanguageFeatures.ts)\n- [src/vs/workbench/api/common/extHostTerminalService.ts](src/vs/workbench/api/common/extHostTerminalService.ts)\n- [src/vs/workbench/api/common/extHostTypeConverters.ts](src/vs/workbench/api/common/extHostTypeConverters.ts)\n- [src/vs/workbench/api/common/extHostTypes.ts](src/vs/workbench/api/common/extHostTypes.ts)\n- [src/vs/workbench/api/node/extHostTerminalService.ts](src/vs/workbench/api/node/extHostTerminalService.ts)\n- [src/vs/workbench/browser/web.api.ts](src/vs/workbench/browser/web.api.ts)\n- [src/vs/workbench/browser/web.factory.ts](src/vs/workbench/browser/web.factory.ts)\n- [src/vs/workbench/browser/web.main.ts](src/vs/workbench/browser/web.main.ts)\n- [src/vs/workbench/contrib/terminal/browser/media/terminal.css](src/vs/workbench/contrib/terminal/browser/media/terminal.css)\n- [src/vs/workbench/contrib/terminal/browser/media/xterm.css](src/vs/workbench/contrib/terminal/browser/media/xterm.css)\n- [src/vs/workbench/contrib/terminal/browser/remotePty.ts](src/vs/workbench/contrib/terminal/browser/remotePty.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminal.contribution.ts](src/vs/workbench/contrib/terminal/browser/terminal.contribution.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminal.ts](src/vs/workbench/contrib/terminal/browser/terminal.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalActions.ts](src/vs/workbench/contrib/terminal/browser/terminalActions.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalEditor.ts](src/vs/workbench/contrib/terminal/browser/terminalEditor.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalEditorInput.ts](src/vs/workbench/contrib/terminal/browser/terminalEditorInput.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalEditorService.ts](src/vs/workbench/contrib/terminal/browser/terminalEditorService.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalGroup.ts](src/vs/workbench/contrib/terminal/browser/terminalGroup.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalGroupService.ts](src/vs/workbench/contrib/terminal/browser/terminalGroupService.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts](src/vs/workbench/contrib/terminal/browser/terminalInstance.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalInstanceService.ts](src/vs/workbench/contrib/terminal/browser/terminalInstanceService.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalMenus.ts](src/vs/workbench/contrib/terminal/browser/terminalMenus.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalProcessExtHostProxy.ts](src/vs/workbench/contrib/terminal/browser/terminalProcessExtHostProxy.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts](src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalService.ts](src/vs/workbench/contrib/terminal/browser/terminalService.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalStatusList.ts](src/vs/workbench/contrib/terminal/browser/terminalStatusList.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalTabbedView.ts](src/vs/workbench/contrib/terminal/browser/terminalTabbedView.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalTabsList.ts](src/vs/workbench/contrib/terminal/browser/terminalTabsList.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalView.ts](src/vs/workbench/contrib/terminal/browser/terminalView.ts)\n- [src/vs/workbench/contrib/terminal/browser/xterm/xtermTerminal.ts](src/vs/workbench/contrib/terminal/browser/xterm/xtermTerminal.ts)\n- [src/vs/workbench/contrib/terminal/common/terminal.ts](src/vs/workbench/contrib/terminal/common/terminal.ts)\n- [src/vs/workbench/contrib/terminal/common/terminalColorRegistry.ts](src/vs/workbench/contrib/terminal/common/terminalColorRegistry.ts)\n- [src/vs/workbench/contrib/terminal/common/terminalConfiguration.ts](src/vs/workbench/contrib/terminal/common/terminalConfiguration.ts)\n- [src/vs/workbench/contrib/terminal/common/terminalEnvironment.ts](src/vs/workbench/contrib/terminal/common/terminalEnvironment.ts)\n- [src/vs/workbench/contrib/terminal/common/terminalStrings.ts](src/vs/workbench/contrib/terminal/common/terminalStrings.ts)\n- [src/vs/workbench/contrib/terminal/test/browser/terminalStatusList.test.ts](src/vs/workbench/contrib/terminal/test/browser/terminalStatusList.test.ts)\n- [src/vs/workbench/contrib/terminal/test/common/terminalEnvironment.test.ts](src/vs/workbench/contrib/terminal/test/common/terminalEnvironment.test.ts)\n- [src/vs/workbench/contrib/terminalContrib/voice/browser/terminal.voice.contribution.ts](src/vs/workbench/contrib/terminalContrib/voice/browser/terminal.voice.contribution.ts)\n- [src/vs/workbench/contrib/terminalContrib/voice/browser/terminalVoice.ts](src/vs/workbench/contrib/terminalContrib/voice/browser/terminalVoice.ts)\n- [src/vs/workbench/contrib/terminalContrib/voice/browser/terminalVoiceActions.ts](src/vs/workbench/contrib/terminalContrib/voice/browser/terminalVoiceActions.ts)\n- [src/vs/workbench/electron-browser/desktop.main.ts](src/vs/workbench/electron-browser/desktop.main.ts)\n- [src/vs/workbench/services/environment/browser/environmentService.ts](src/vs/workbench/services/environment/browser/environmentService.ts)\n- [src/vs/workbench/services/environment/common/environmentService.ts](src/vs/workbench/services/environment/common/environmentService.ts)\n- [src/vs/workbench/services/environment/electron-browser/environmentService.ts](src/vs/workbench/services/environment/electron-browser/environmentService.ts)\n- [src/vs/workbench/services/extensions/electron-browser/nativeExtensionService.ts](src/vs/workbench/services/extensions/electron-browser/nativeExtensionService.ts)\n- [src/vs/workbench/workbench.common.main.ts](src/vs/workbench/workbench.common.main.ts)\n- [src/vs/workbench/workbench.desktop.main.ts](src/vs/workbench/workbench.desktop.main.ts)\n- [src/vs/workbench/workbench.web.main.ts](src/vs/workbench/workbench.web.main.ts)\n- [src/vscode-dts/vscode.d.ts](src/vscode-dts/vscode.d.ts)\n- [src/vscode-dts/vscode.proposed.inlineCompletionsAdditions.d.ts](src/vscode-dts/vscode.proposed.inlineCompletionsAdditions.d.ts)\n\n\u003c/details\u003e\n\n\n\nThis document describes VS Code's multi-process architecture, explaining how the application separates concerns across different operating system processes to achieve stability, security, and isolation. This architecture is primarily relevant to the Electron desktop version of VS Code.\n\nFor information about how services are instantiated and connected within these processes, see [Service Initialization and Dependency Injection](#3.5). For details on the extension system's RPC communication, see [Extension Host Architecture and RPC Protocol](#5.1). For terminal-specific process management, see [Terminal Architecture Overview](#6.1).\n\n## Overview\n\nVS Code employs a multi-process architecture based on Chromium/Electron's design. The application separates execution into multiple operating system processes:\n\n- **Main Process**: Native Node.js process managing application lifecycle and windows\n- **Renderer Process(es)**: Chromium renderer processes hosting the workbench UI (one per window)\n- **Extension Host Process**: Isolated Node.js process running third-party extension code\n- **Shared Process**: Long-running Node.js process hosting services shared across windows\n- **Pty Host Process**: Specialized process managing terminal shell processes\n\nThis separation provides crash isolation (extension or terminal crashes don't affect the main UI), security boundaries (untrusted code runs in separate processes), and resource management (processes can be independently managed and restarted).\n\nSources: [src/vs/code/electron-main/app.ts](), [src/vs/workbench/api/common/extHost.protocol.ts]()\n\n## Process Type Breakdown\n\n### Main Process\n\n```mermaid\ngraph TD\n    CodeMain[\"CodeMain\u003cbr/\u003e(Entry Point)\"]\n    CodeApp[\"CodeApplication\u003cbr/\u003e(Application Controller)\"]\n    IPCServer[\"NodeIPCServer\u003cbr/\u003e(IPC Communication)\"]\n    WindowsMgmt[\"Windows Management\"]\n    Lifecycle[\"Lifecycle Management\"]\n    \n    CodeMain --\u003e CodeApp\n    CodeApp --\u003e IPCServer\n    CodeApp --\u003e WindowsMgmt\n    CodeApp --\u003e Lifecycle\n    \n    IPCServer --\u003e |\"spawns\"| RendererProc[\"Renderer Processes\"]\n    CodeApp --\u003e |\"spawns\"| SharedProc[\"Shared Process\"]\n    \n    WindowsMgmt --\u003e |\"creates\"| BrowserWindow[\"BrowserWindow instances\"]\n```\n\nThe main process is the application entry point and orchestrates the entire application lifecycle. It is a native Node.js process with full system access.\n\n**Key Responsibilities:**\n- **Window Management**: Creates and manages `BrowserWindow` instances for each editor window\n- **Application Lifecycle**: Handles startup, shutdown, updates, and system integration\n- **IPC Server**: Hosts `NodeIPCServer` to coordinate communication with other processes\n- **Menu and Native UI**: Manages native menus, dialogs, and system tray\n- **Instance Claiming**: Ensures single instance behavior and handles command-line arguments from new instances\n\n**Key Classes:**\n- `CodeMain` [src/vs/code/electron-main/main.ts]() - Entry point\n- `CodeApplication` [src/vs/code/electron-main/app.ts:62-1107]() - Main application controller\n- `NodeIPCServer` [src/vs/base/parts/ipc/node/ipc.net.js]() - IPC server implementation\n\nThe main process initializes services via dependency injection and creates the IPC server that other processes connect to. When a renderer needs to communicate with the main process, it uses `ElectronIPCServer` which bridges Electron's IPC mechanism.\n\n**Process Creation:**\n```\napp.on('ready') \n   CodeMain.main() \n   CodeApplication.startup() \n   WindowsManager.openWindow() \n   BrowserWindow.create()\n```\n\nSources: [src/vs/code/electron-main/main.ts](), [src/vs/code/electron-main/app.ts:62-1107]()\n\n### Renderer Process\n\n```mermaid\ngraph TD\n    DesktopMain[\"DesktopMain\u003cbr/\u003e(Renderer Entry)\"]\n    Workbench[\"Workbench\u003cbr/\u003e(UI Container)\"]\n    LayoutService[\"IWorkbenchLayoutService\"]\n    EditorService[\"IEditorService\"]\n    \n    MainClient[\"ElectronIPCMainProcessService\u003cbr/\u003e(Main Process Client)\"]\n    ExtHostProxy[\"Extension Host Proxy\"]\n    \n    DesktopMain --\u003e Workbench\n    Workbench --\u003e LayoutService\n    Workbench --\u003e EditorService\n    \n    Workbench --\u003e MainClient\n    Workbench --\u003e ExtHostProxy\n    \n    MainClient -.IPC.-\u003e MainProcess[\"Main Process\"]\n    ExtHostProxy -.RPC.-\u003e ExtHost[\"Extension Host Process\"]\n```\n\nEach renderer process hosts a workbench instance - the complete VS Code UI including editors, panels, sidebars, and status bar. This is a Chromium renderer process with a Node.js integration layer.\n\n**Key Responsibilities:**\n- **UI Rendering**: Renders all visual components using DOM and Monaco editor\n- **User Input Handling**: Processes keyboard, mouse, and touch input\n- **Editor Management**: Hosts text editors, diff editors, custom editors\n- **View Management**: Manages sidebars, panels, and auxiliary windows\n- **Service Layer**: Runs workbench-level services (editor service, layout service, etc.)\n\n**Key Classes:**\n- `DesktopMain` - Renderer entry point for desktop\n- `Workbench` [src/vs/workbench/browser/workbench.ts]() - Main UI container\n- `IEditorService` - Editor lifecycle management\n- `IWorkbenchLayoutService` - Layout and part management\n\n**Communication Paths:**\n- **To Main Process**: Via `ElectronIPCMainProcessService` using Electron IPC\n- **To Extension Host**: Via RPC protocol defined in `extHost.protocol.ts`\n- **To Shared Process**: Via IPC channels for shared services\n\nMultiple renderer processes can exist simultaneously (one per window). Each is sandboxed and cannot directly access the file system without going through the main process.\n\nSources: [src/vs/workbench/browser/web.main.ts](), [src/vs/workbench/browser/workbench.ts]()\n\n### Extension Host Process\n\n```mermaid\ngraph TD\n    ExtHostMain[\"ExtHostMain\u003cbr/\u003e(Process Entry)\"]\n    APIFactory[\"createApiFactoryAndRegisterActors\u003cbr/\u003e(API Factory)\"]\n    \n    subgraph \"ExtHost Services\"\n        ExtHostDocs[\"ExtHostDocuments\"]\n        ExtHostLang[\"ExtHostLanguageFeatures\"]\n        ExtHostTerminal[\"ExtHostTerminalService\"]\n        ExtHostCommands[\"ExtHostCommands\"]\n    end\n    \n    subgraph \"RPC Layer\"\n        RPCProtocol[\"IExtHostRpcService\"]\n        MainThreadProxy[\"MainThread Proxies\"]\n    end\n    \n    subgraph \"Extension Code\"\n        Extension[\"Extension Code\u003cbr/\u003e(3rd Party)\"]\n        VSCodeAPI[\"vscode.* API\"]\n    end\n    \n    ExtHostMain --\u003e APIFactory\n    APIFactory --\u003e ExtHostDocs\n    APIFactory --\u003e ExtHostLang\n    APIFactory --\u003e ExtHostTerminal\n    APIFactory --\u003e ExtHostCommands\n    \n    ExtHostDocs --\u003e RPCProtocol\n    ExtHostLang --\u003e RPCProtocol\n    ExtHostTerminal --\u003e RPCProtocol\n    ExtHostCommands --\u003e RPCProtocol\n    \n    RPCProtocol --\u003e MainThreadProxy\n    MainThreadProxy -.RPC.-\u003e Renderer[\"Renderer Process\"]\n    \n    Extension --\u003e VSCodeAPI\n    VSCodeAPI --\u003e APIFactory\n```\n\nThe extension host is an isolated Node.js process that executes third-party extension code. This isolation is critical for stability - extension crashes cannot bring down the UI.\n\n**Key Responsibilities:**\n- **Extension Execution**: Loads and runs extension JavaScript/TypeScript code\n- **API Surface**: Provides the `vscode.*` API to extensions\n- **Extension Host Services**: Maintains extension-side state (documents, editors, etc.)\n- **RPC Client**: Communicates with renderer via message passing\n- **Resource Management**: Manages extension lifecycle and disposal\n\n**Key Classes:**\n- `ExtHostMain` - Extension host entry point\n- `createApiFactoryAndRegisterActors` [src/vs/workbench/api/common/extHost.api.impl.ts:132-1058]() - Creates the vscode API\n- `IExtHostRpcService` - RPC protocol implementation\n- `ExtHostDocuments` [src/vs/workbench/api/common/extHostDocuments.ts]() - Document synchronization\n- `ExtHostLanguageFeatures` [src/vs/workbench/api/common/extHostLanguageFeatures.ts]() - Language feature providers\n- `ExtHostTerminalService` [src/vs/workbench/api/common/extHostTerminalService.ts]() - Terminal API implementation\n\n**RPC Protocol:**\n\nThe extension host communicates with the renderer via a bidirectional RPC protocol defined in `extHost.protocol.ts`. This protocol uses message passing with typed interfaces:\n\n- **MainThread...Shape**: Interfaces for renderer-side implementations\n- **ExtHost...Shape**: Interfaces for extension host-side implementations\n- **ProxyIdentifier**: Type-safe references for RPC endpoints\n\nFor example, when an extension calls `vscode.window.showInformationMessage()`:\n1. Call goes to `ExtHostMessageService` in extension host\n2. `ExtHostMessageService` sends RPC message to `MainThreadMessageService` in renderer\n3. Renderer shows notification and sends response back\n\n**Process Spawning:**\n\n```\nMain Process \n   spawn Node.js process\n   env: VSCODE_PARENT_PID\n   execute: bootstrap-fork.js\n   load: extensionHostProcess.js\n   initialize RPC connection\n```\n\nSources: [src/vs/workbench/api/common/extHost.api.impl.ts:132-1058](), [src/vs/workbench/api/common/extHost.protocol.ts](), [src/vs/workbench/api/common/extHostLanguageFeatures.ts]()\n\n### Shared Process\n\n```mermaid\ngraph TD\n    SharedMain[\"Shared Process Main\"]\n    \n    subgraph \"Shared Services\"\n        ExtMgmt[\"Extension Management\u003cbr/\u003eIExtensionManagementService\"]\n        Telemetry[\"Telemetry Service\u003cbr/\u003eITelemetryService\"]\n        Storage[\"Storage Service\u003cbr/\u003eIStorageService\"]\n        ExtGallery[\"Extension Gallery\u003cbr/\u003eIExtensionGalleryService\"]\n        Downloads[\"Download Service\"]\n    end\n    \n    SharedMain --\u003e ExtMgmt\n    SharedMain --\u003e Telemetry\n    SharedMain --\u003e Storage\n    SharedMain --\u003e ExtGallery\n    SharedMain --\u003e Downloads\n    \n    Window1[\"Renderer 1\"] -.IPC.-\u003e SharedMain\n    Window2[\"Renderer 2\"] -.IPC.-\u003e SharedMain\n    Window3[\"Renderer 3\"] -.IPC.-\u003e SharedMain\n```\n\nThe shared process is a long-running Node.js process that hosts services shared across all windows. This avoids duplicating expensive operations like extension scanning or telemetry batching.\n\n**Key Responsibilities:**\n- **Extension Management**: Scans, installs, uninstalls extensions (one instance for all windows)\n- **Telemetry**: Aggregates and sends telemetry data\n- **Storage**: Manages shared storage (global state)\n- **Extension Gallery**: Communicates with marketplace\n- **Downloads**: Manages extension and update downloads\n\n**Service Location:**\n\nServices in the shared process are accessed via IPC channels:\n- Each renderer gets a channel to the shared process\n- Channels are created via `getDelayedChannel` or `ProxyChannel`\n- Services are registered by identifier (e.g., `IExtensionManagementService`)\n\n**Lifecycle:**\n\nThe shared process is created by the main process on first window open and remains alive until application shutdown, even if all windows close. This persistence enables background operations like extension updates.\n\nSources: [src/vs/code/electron-main/app.ts]()\n\n### Pty Host Process\n\n```mermaid\ngraph TD\n    PtyHost[\"PtyService\u003cbr/\u003e(Pty Host Process)\"]\n    \n    subgraph \"Terminal Processes\"\n        Shell1[\"Shell Process 1\u003cbr/\u003e(bash/zsh/powershell)\"]\n        Shell2[\"Shell Process 2\"]\n        Shell3[\"Shell Process 3\"]\n    end\n    \n    subgraph \"Process Management\"\n        TerminalProcesses[\"Terminal Process Tracking\"]\n        Reconnection[\"Reconnection Support\"]\n        Persistence[\"Process Persistence\"]\n    end\n    \n    TerminalService[\"TerminalService\u003cbr/\u003e(Renderer)\"] -.IPC.-\u003e PtyHost\n    TerminalInstance[\"TerminalInstance\"] -.IPC.-\u003e PtyHost\n    \n    PtyHost --\u003e TerminalProcesses\n    PtyHost --\u003e Reconnection\n    PtyHost --\u003e Persistence\n    \n    PtyHost --\u003e |spawns| Shell1\n    PtyHost --\u003e |spawns| Shell2\n    PtyHost --\u003e |spawns| Shell3\n    \n    Shell1 --\u003e |pty data| PtyHost\n    Shell2 --\u003e |pty data| PtyHost\n    Shell3 --\u003e |pty data| PtyHost\n```\n\nThe pty (pseudoterminal) host is a specialized Node.js process that manages terminal shell processes. It provides crash isolation - if a shell process crashes or hangs, it doesn't affect the renderer.\n\n**Key Responsibilities:**\n- **Shell Process Management**: Spawns and manages shell processes (bash, zsh, PowerShell, etc.)\n- **PTY Management**: Creates and manages pseudoterminal pairs\n- **Data Flow**: Streams terminal input/output between shell and renderer\n- **Process Persistence**: Supports terminal reconnection across window reloads\n- **Environment Handling**: Manages shell environment variables and working directories\n\n**Key Classes:**\n- `PtyService` [src/vs/platform/terminal/node/ptyService.ts:63-1090]() - Main pty host service\n- `TerminalProcess` [src/vs/platform/terminal/node/terminalProcess.ts]() - Individual shell process wrapper\n- `TerminalProcessManager` [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts:38-722]() - Renderer-side process coordinator\n\n**Communication Flow:**\n\n```\nUser types in terminal\n   TerminalInstance (Renderer)\n   TerminalProcessManager.write()\n   IPC to PtyService\n   write to PTY master\n   Shell receives input\n\nShell outputs data\n   PTY master receives data\n   PtyService buffers and sends via IPC\n   TerminalProcessManager receives\n   TerminalInstance.xterm.write()\n   XtermTerminal renders\n```\n\n**Process Spawning:**\n\nThe pty host is spawned by the main process when the first terminal is created:\n```\nTerminalService.createTerminal()\n   TerminalInstanceService.createInstance()\n   TerminalBackend.getBackend()\n   spawn pty host process (if not exists)\n   establish IPC connection\n```\n\n**Reconnection Support:**\n\nThe pty host maintains a registry of active terminals by ID, enabling reconnection:\n- Terminals persist across window reloads\n- Layout information stored in `ITerminalsLayoutInfo`\n- Process reconnection via `IReconnectionProperties`\n- Supports \"revive on exit\" and \"revive on window close\" modes\n\nSources: [src/vs/platform/terminal/node/ptyService.ts:63-1090](), [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts:38-722](), [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts]()\n\n## IPC Communication Mechanisms\n\n```mermaid\ngraph TD\n    subgraph \"Main Process\"\n        NodeIPC[\"NodeIPCServer\"]\n        ElectronIPC[\"ElectronIPCServer\"]\n    end\n    \n    subgraph \"Renderer Process\"\n        ElectronClient[\"ElectronIPCMainProcessService\"]\n        RPCClient[\"RPC Client\"]\n    end\n    \n    subgraph \"Extension Host\"\n        RPCServer[\"RPC Server\"]\n    end\n    \n    subgraph \"Shared Process\"\n        SharedServices[\"Shared Services\"]\n    end\n    \n    subgraph \"Pty Host\"\n        PtyIPC[\"Pty IPC Server\"]\n    end\n    \n    ElectronIPC \u003c-.Electron IPC.-\u003e ElectronClient\n    NodeIPC \u003c-.Node IPC.-\u003e SharedServices\n    NodeIPC \u003c-.Node IPC.-\u003e PtyIPC\n    \n    RPCClient \u003c-.MessagePort/WebWorker.-\u003e RPCServer\n```\n\nVS Code uses multiple IPC mechanisms depending on the process types communicating:\n\n### Electron IPC (Main  Renderer)\n\n**Mechanism**: Electron's built-in IPC using `ipcMain` and `ipcRenderer`\n\n**Implementation**:\n- `ElectronIPCServer` [src/vs/base/parts/ipc/electron-main/ipc.electron.ts]() in main process\n- `ElectronIPCMainProcessService` in renderer process\n- Uses Electron's message passing over named channels\n\n**Key APIs**:\n- `validatedIpcMain.handle()` - Register IPC handlers in main process\n- `ipcRenderer.invoke()` - Call from renderer to main\n- Messages are automatically serialized/deserialized\n\n### Node IPC (Main  Shared/Pty Host)\n\n**Mechanism**: Node.js IPC over Unix domain sockets or named pipes\n\n**Implementation**:\n- `NodeIPCServer` [src/vs/base/parts/ipc/node/ipc.net.ts]() creates IPC server\n- Processes connect via `Client` to server's socket path\n- Bi-directional message passing with multiplexed channels\n\n**Server Setup**:\n```typescript\nconst server = new NodeIPCServer('vscode-shared-process');\nserver.registerChannel('extensionManagement', extensionManagementChannel);\n```\n\n**Client Connection**:\n```typescript\nconst client = new Client(socketPath);\nconst channel = client.getChannel('extensionManagement');\n```\n\n### RPC Protocol (Renderer  Extension Host)\n\n**Mechanism**: Custom RPC protocol over MessagePort or WebWorker message passing\n\n**Protocol Definition**: `extHost.protocol.ts` [src/vs/workbench/api/common/extHost.protocol.ts:1-2750]()\n\n**Key Interfaces**:\n- `MainThread...Shape` - Methods callable from extension host\n- `ExtHost...Shape` - Methods callable from renderer\n- `IRPCProtocol` - Protocol implementation interface\n\n**Message Structure**:\n```typescript\ninterface RPCMessage {\n  type: MessageType.Request | Response | ...\n  id: number  // For request/response matching\n  proxyId: ProxyIdentifier\n  methodName: string\n  args: any[]\n}\n```\n\n**Proxy Pattern**:\n\nBoth sides use proxies to make RPC calls appear local:\n\n```typescript\n// Renderer side\nconst proxy = rpcProtocol.getProxy(ExtHostContext.ExtHostDocuments);\nawait proxy.$acceptModelChanged(...);\n\n// Extension host side - implementation\nclass ExtHostDocuments {\n  $acceptModelChanged(...) {\n    // Update local state\n  }\n}\n```\n\n**Data Marshalling**:\n\nThe protocol handles serialization of complex types:\n- `URI`  `UriComponents`\n- `Range`  `IRange` (plain object)\n- `Buffer`  `VSBuffer` (optimized transfer)\n- Circular references detected and prevented\n\n**Type Converters**: [src/vs/workbench/api/common/extHostTypeConverters.ts]() provides bidirectional conversion between VS Code types and protocol DTOs.\n\n### Channel-based Communication\n\nVS Code uses a **channel pattern** for organizing IPC services:\n\n**Channel Interface**:\n```typescript\ninterface IChannel {\n  call\u003cT\u003e(command: string, args?: any): Promise\u003cT\u003e;\n  listen\u003cT\u003e(event: string, args?: any): Event\u003cT\u003e;\n}\n```\n\n**Example Channels**:\n- `LOCAL_FILE_SYSTEM_CHANNEL_NAME` - File system operations\n- `ipcExtensionHostStarterChannelName` - Extension host lifecycle\n- `ipcBrowserViewChannelName` - Browser view management\n\nChannels enable:\n- **Service Multiplexing**: Multiple services over one IPC connection\n- **Type Safety**: Strongly-typed service interfaces\n- **Lazy Connection**: Channels created on first use via `getDelayedChannel`\n\nSources: [src/vs/base/parts/ipc/electron-main/ipc.electron.ts](), [src/vs/base/parts/ipc/node/ipc.net.ts](), [src/vs/workbench/api/common/extHost.protocol.ts:1-2750](), [src/vs/workbench/api/common/extHostTypeConverters.ts]()\n\n## Process Lifecycle\n\n### Startup Sequence\n\n```mermaid\ngraph TD\n    Start[\"Application Start\"]\n    Main[\"Main Process\u003cbr/\u003eCodeMain.main()\"]\n    Services[\"Initialize Main Services\"]\n    \n    Main1[\"Create IPC Servers\u003cbr/\u003eNodeIPCServer\"]\n    Main2[\"Instance Check\u003cbr/\u003eSingleInstance\"]\n    \n    Window[\"Open Window\u003cbr/\u003eWindowsManager\"]\n    Renderer[\"Spawn Renderer\u003cbr/\u003eBrowserWindow\"]\n    \n    Workbench[\"Initialize Workbench\"]\n    WorkbenchServices[\"Create Workbench Services\"]\n    \n    Shared[\"Spawn Shared Process\u003cbr/\u003e(on first window)\"]\n    ExtHost[\"Spawn Extension Host\u003cbr/\u003e(when needed)\"]\n    \n    Start --\u003e Main\n    Main --\u003e Services\n    Services --\u003e Main1\n    Main1 --\u003e Main2\n    Main2 --\u003e Window\n    Window --\u003e Renderer\n    Window --\u003e Shared\n    \n    Renderer --\u003e Workbench\n    Workbench --\u003e WorkbenchServices\n    WorkbenchServices --\u003e ExtHost\n```\n\n**Detailed Steps:**\n\n1. **Main Process Initialization** [src/vs/code/electron-main/main.ts]()\n   - `CodeMain.main()` entry point\n   - Parse command-line arguments via `NativeParsedArgs`\n   - Initialize logging and crash reporting\n   - Load product configuration\n\n2. **Service Creation** [src/vs/code/electron-main/app.ts:200-500]()\n   - Create `ServiceCollection`\n   - Instantiate platform services (IEnvironmentService, ILogService, etc.)\n   - Register IPC channels for main process services\n   - Initialize `CodeApplication`\n\n3. **IPC Server Setup**\n   - Create `NodeIPCServer` for shared/pty host communication\n   - Create `ElectronIPCServer` for renderer communication\n   - Register service channels\n\n4. **Window Opening** [src/vs/code/electron-main/app.ts:700-900]()\n   - `CodeApplication.startup()`\n   - Check for existing instance via `IInstanceService`\n   - If single instance, delegate to existing instance\n   - Otherwise, open window via `WindowsMainService`\n\n5. **Renderer Bootstrap**\n   - Create `BrowserWindow` with preload script\n   - Load `index.html` (workbench entry point)\n   - Execute workbench bootstrap code\n\n6. **Workbench Initialization** [src/vs/workbench/browser/workbench.ts]()\n   - Create renderer-side service collection\n   - Instantiate `Workbench` class\n   - Initialize layout (parts: sidebar, panel, editor area)\n   - Load saved layout state\n\n7. **Extension Host Spawn**\n   - First extension activation triggers spawn\n   - Main process spawns Node.js process\n   - Extension host connects via RPC\n   - Load and activate extensions\n\n8. **Shared Process Spawn** [src/vs/code/electron-main/app.ts]()\n   - Spawned on first window open\n   - Connects via Node IPC\n   - Initializes shared services\n   - Remains alive for application lifetime\n\n### Window Reload\n\nWhen a window reloads (e.g., after extension install):\n\n1. Renderer disposes all services\n2. Extension host is terminated\n3. New renderer loads in same BrowserWindow\n4. New extension host spawned\n5. Terminals reconnect to existing pty host processes\n\n### Shutdown Sequence\n\n```mermaid\ngraph TD\n    Shutdown[\"Shutdown Trigger\"]\n    BeforeShutdown[\"Lifecycle: onBeforeShutdown\"]\n    \n    subgraph \"Cleanup Phase\"\n        Renderer[\"Dispose Renderer Services\"]\n        ExtHost[\"Terminate Extension Host\"]\n        SaveState[\"Save Workbench State\"]\n    end\n    \n    WillShutdown[\"Lifecycle: onWillShutdown\"]\n    \n    subgraph \"Process Termination\"\n        SharedKill[\"Terminate Shared Process\"]\n        PtyKill[\"Terminate Pty Host\"]\n        RendererKill[\"Close Renderer Windows\"]\n    end\n    \n    Exit[\"Main Process Exit\"]\n    \n    Shutdown --\u003e BeforeShutdown\n    BeforeShutdown --\u003e Renderer\n    BeforeShutdown --\u003e ExtHost\n    BeforeShutdown --\u003e SaveState\n    \n    Renderer --\u003e WillShutdown\n    ExtHost --\u003e WillShutdown\n    SaveState --\u003e WillShutdown\n    \n    WillShutdown --\u003e SharedKill\n    WillShutdown --\u003e PtyKill\n    WillShutdown --\u003e RendererKill\n    \n    SharedKill --\u003e Exit\n    PtyKill --\u003e Exit\n    RendererKill --\u003e Exit\n```\n\n**Lifecycle Events**:\n\n- `onBeforeShutdown`: Veto-able event, can prevent shutdown\n- `onWillShutdown`: Guaranteed shutdown, perform cleanup\n- `onDidShutdown`: After all processes terminated\n\n**Cleanup Priorities**:\n\n1. Save user data (open editors, terminal states)\n2. Flush telemetry\n3. Dispose renderer services\n4. Terminate child processes\n5. Close main process\n\n**Terminal Persistence**:\n\nTerminals can be configured to persist via `IReconnectionProperties`:\n- `persistentSessionReviveProcess` setting controls when terminals revive\n- Pty host maintains process registry\n- On next startup, renderers reconnect to existing shells\n\nSources: [src/vs/code/electron-main/main.ts](), [src/vs/code/electron-main/app.ts:200-900](), [src/vs/workbench/browser/workbench.ts]()\n\n## Process Crash Recovery\n\n### Extension Host Crashes\n\nWhen the extension host crashes:\n\n1. Renderer detects connection loss via RPC protocol\n2. `IExtensionService.onDidChangeExtensionsStatus` fires\n3. User sees notification: \"Extension host terminated unexpectedly\"\n4. Option to reload window or continue without extensions\n5. If reloaded, new extension host spawned\n\n**Auto-restart**: Not enabled by default to prevent crash loops from bad extensions.\n\n### Renderer Crashes\n\nIf a renderer process crashes:\n\n1. Main process detects via Electron's `BrowserWindow` events\n2. Window closes automatically\n3. User prompted to reopen or close\n4. Other windows remain unaffected (isolated)\n\n### Pty Host Crashes\n\nTerminal process isolation ensures:\n\n1. Shell process continues running (pty host independent)\n2. Renderer detects pty host crash\n3. New pty host spawned automatically\n4. Terminals attempt reconnection\n5. If reconnection fails, terminal shows disconnected state\n\n### Shared Process Crashes\n\n1. Main process monitors shared process\n2. If crash detected, automatic restart\n3. Renderers re-establish connections\n4. Some state may be lost (in-progress operations)\n\nSources: [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts](), [src/vs/workbench/api/common/extHost.protocol.ts]()\n\n## Security Boundaries\n\nThe multi-process architecture enforces security isolation:\n\n| Process | Trust Level | Capabilities | Restrictions |\n|---------|-------------|--------------|--------------|\n| Main | Full Trust | Full system access, native APIs | None |\n| Renderer | Sandboxed | DOM, limited Node.js APIs | No direct file system access |\n| Extension Host | Untrusted Code | Node.js APIs, controlled vscode API | Cannot access renderer DOM directly |\n| Shared Process | Trusted | File system, network | Cannot interact with windows directly |\n| Pty Host | Trusted | Process spawning, pty management | Limited to terminal operations |\n\n**Key Security Features:**\n\n- Extension host cannot directly manipulate UI (must go through RPC)\n- Renderers cannot directly access file system (must go through main process)\n- Extensions cannot access other extensions' state\n- RPC protocol validates all messages and types\n\n**Context Isolation**: Electron's `contextIsolation` ensures renderer processes have limited Node.js access, with preload scripts providing controlled bridges.\n\nSources: [src/vs/code/electron-main/app.ts](), [src/vs/workbench/api/common/extHost.protocol.ts]()\n\n## Web vs Desktop Differences\n\nWhile the desktop version uses the multi-process architecture described above, the web version has a different model:\n\n| Aspect | Desktop (Electron) | Web (Browser) |\n|--------|-------------------|---------------|\n| Main Process | Separate Node.js process | None (browser controls windows) |\n| Renderer | Chromium renderer with Node.js | Pure web renderer, no Node.js |\n| Extension Host | Separate Node.js process | Web Worker |\n| Shared Process | Separate Node.js process | None (or remote server) |\n| Pty Host | Separate Node.js process | Remote server |\n\n**Web Architecture Key Points**:\n- Extension host runs in a Web Worker (limited APIs)\n- No direct file system access (uses virtual file systems)\n- Terminal backend runs on remote server\n- All IPC replaced with MessageChannel/MessagePort\n\nThe web version's architecture is covered in more detail in [Web Workbench Bootstrap](#3.4).\n\nSources: [src/vs/workbench/browser/web.main.ts]()"])</script><script>self.__next_f.push([1,"21:T55a2,"])</script><script>self.__next_f.push([1,"# Web Workbench Bootstrap\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [build/lib/i18n.resources.json](build/lib/i18n.resources.json)\n- [cli/src/bin/code/legacy_args.rs](cli/src/bin/code/legacy_args.rs)\n- [resources/completions/bash/code](resources/completions/bash/code)\n- [resources/completions/zsh/_code](resources/completions/zsh/_code)\n- [src/vs/base/node/terminalEncoding.ts](src/vs/base/node/terminalEncoding.ts)\n- [src/vs/code/browser/workbench/workbench-dev.html](src/vs/code/browser/workbench/workbench-dev.html)\n- [src/vs/code/browser/workbench/workbench.html](src/vs/code/browser/workbench/workbench.html)\n- [src/vs/code/browser/workbench/workbench.ts](src/vs/code/browser/workbench/workbench.ts)\n- [src/vs/code/electron-main/app.ts](src/vs/code/electron-main/app.ts)\n- [src/vs/code/electron-main/main.ts](src/vs/code/electron-main/main.ts)\n- [src/vs/code/node/cli.ts](src/vs/code/node/cli.ts)\n- [src/vs/code/node/cliProcessMain.ts](src/vs/code/node/cliProcessMain.ts)\n- [src/vs/platform/environment/common/argv.ts](src/vs/platform/environment/common/argv.ts)\n- [src/vs/platform/environment/common/environment.ts](src/vs/platform/environment/common/environment.ts)\n- [src/vs/platform/environment/common/environmentService.ts](src/vs/platform/environment/common/environmentService.ts)\n- [src/vs/platform/environment/electron-main/environmentMainService.ts](src/vs/platform/environment/electron-main/environmentMainService.ts)\n- [src/vs/platform/environment/node/argv.ts](src/vs/platform/environment/node/argv.ts)\n- [src/vs/platform/environment/node/argvHelper.ts](src/vs/platform/environment/node/argvHelper.ts)\n- [src/vs/platform/environment/node/environmentService.ts](src/vs/platform/environment/node/environmentService.ts)\n- [src/vs/platform/environment/node/stdin.ts](src/vs/platform/environment/node/stdin.ts)\n- [src/vs/platform/extensionManagement/common/extensionManagementCLI.ts](src/vs/platform/extensionManagement/common/extensionManagementCLI.ts)\n- [src/vs/server/node/remoteExtensionHostAgentCli.ts](src/vs/server/node/remoteExtensionHostAgentCli.ts)\n- [src/vs/server/node/server.cli.ts](src/vs/server/node/server.cli.ts)\n- [src/vs/server/node/serverEnvironmentService.ts](src/vs/server/node/serverEnvironmentService.ts)\n- [src/vs/server/node/serverServices.ts](src/vs/server/node/serverServices.ts)\n- [src/vs/workbench/browser/web.api.ts](src/vs/workbench/browser/web.api.ts)\n- [src/vs/workbench/browser/web.factory.ts](src/vs/workbench/browser/web.factory.ts)\n- [src/vs/workbench/browser/web.main.ts](src/vs/workbench/browser/web.main.ts)\n- [src/vs/workbench/electron-browser/desktop.main.ts](src/vs/workbench/electron-browser/desktop.main.ts)\n- [src/vs/workbench/services/environment/browser/environmentService.ts](src/vs/workbench/services/environment/browser/environmentService.ts)\n- [src/vs/workbench/services/environment/common/environmentService.ts](src/vs/workbench/services/environment/common/environmentService.ts)\n- [src/vs/workbench/services/environment/electron-browser/environmentService.ts](src/vs/workbench/services/environment/electron-browser/environmentService.ts)\n- [src/vs/workbench/services/extensions/electron-browser/nativeExtensionService.ts](src/vs/workbench/services/extensions/electron-browser/nativeExtensionService.ts)\n- [src/vs/workbench/workbench.common.main.ts](src/vs/workbench/workbench.common.main.ts)\n- [src/vs/workbench/workbench.desktop.main.ts](src/vs/workbench/workbench.desktop.main.ts)\n- [src/vs/workbench/workbench.web.main.ts](src/vs/workbench/workbench.web.main.ts)\n\n\u003c/details\u003e\n\n\n\nThis document describes how VS Code initializes in the web browser environment, detailing the specific bootstrap sequence, service registrations, and differences from the desktop version.\n\nFor information about the desktop Electron bootstrap process, see [Electron Main Process Startup](#3.2). For information about multi-process architecture in general, see [Multi-Process Architecture](#3.3). For service initialization patterns, see [Service Initialization and Dependency Injection](#3.5).\n\n## Overview\n\nThe web workbench bootstrap is the initialization sequence for VS Code running in a browser (without Electron). This process:\n\n1. Loads common workbench infrastructure shared with desktop\n2. Registers browser-specific service implementations\n3. Initializes web-compatible extensions and features\n4. Excludes native/Electron-dependent functionality\n\nThe web version has significant architectural differences from desktop due to browser security constraints, lack of native Node.js APIs, and different execution environments.\n\n**Sources:** [src/vs/workbench/workbench.web.main.ts:1-176]()\n\n## Entry Point Structure\n\nThe web workbench uses a layered entry point architecture where platform-specific code builds upon common infrastructure.\n\n### File Structure\n\n```mermaid\ngraph TB\n    WEB[\"workbench.web.main.ts\u003cbr/\u003eWeb-specific entry\"]\n    COMMON[\"workbench.common.main.ts\u003cbr/\u003eShared workbench code\"]\n    DESKTOP[\"workbench.desktop.main.ts\u003cbr/\u003eDesktop-specific entry\"]\n    EDITOR[\"editor.all.js\u003cbr/\u003eMonaco editor core\"]\n    WEB_MAIN[\"browser/web.main.js\u003cbr/\u003eWeb bootstrap logic\"]\n    \n    WEB --\u003e|imports| COMMON\n    WEB --\u003e|imports| WEB_MAIN\n    DESKTOP --\u003e|imports| COMMON\n    COMMON --\u003e|imports| EDITOR\n    \n    style WEB fill:#f9f9f9\n    style COMMON fill:#f9f9f9\n    style DESKTOP fill:#f9f9f9\n```\n\n**Sources:** [src/vs/workbench/workbench.web.main.ts:16-17](), [src/vs/workbench/workbench.web.main.ts:30-31](), [src/vs/workbench/workbench.desktop.main.ts:15-16]()\n\n### Import Sequence\n\nThe web workbench imports follow a strict ordering:\n\n1. **Common workbench** - Line 16 imports `./workbench.common.main.js`\n2. **Web-specific dialog parts** - Line 23 imports `./browser/parts/dialogs/dialog.web.contribution.js`\n3. **Core web bootstrap** - Line 30 imports `./browser/web.main.js`\n4. **Web-specific services** - Lines 37-72 import browser implementations\n5. **Web-specific contributions** - Lines 127-175 import feature contributions\n\n**Sources:** [src/vs/workbench/workbench.web.main.ts:14-32](), [src/vs/workbench/workbench.web.main.ts:35-72]()\n\n## Common Workbench Foundation\n\nThe common workbench (`workbench.common.main.ts`) provides the foundation shared by all platforms.\n\n### Common Infrastructure\n\n```mermaid\ngraph LR\n    subgraph \"Common Workbench (workbench.common.main.ts)\"\n        MONACO[\"Monaco Editor\u003cbr/\u003eeditor.all.js\"]\n        CONTRIB[\"Workbench Contributions\u003cbr/\u003eActions, Parts, Views\"]\n        SERVICES[\"Core Services\u003cbr/\u003eEditorService, ThemeService, etc\"]\n        API[\"Extension API Points\u003cbr/\u003emenusExtensionPoint, etc\"]\n    end\n    \n    subgraph \"Platform-Specific\"\n        WEB[\"Web Main\"]\n        DESKTOP[\"Desktop Main\"]\n    end\n    \n    MONACO --\u003e CONTRIB\n    MONACO --\u003e SERVICES\n    API --\u003e CONTRIB\n    CONTRIB --\u003e WEB\n    SERVICES --\u003e WEB\n    CONTRIB --\u003e DESKTOP\n    SERVICES --\u003e DESKTOP\n```\n\n**Sources:** [src/vs/workbench/workbench.common.main.ts:6-13](), [src/vs/workbench/workbench.common.main.ts:42-50](), [src/vs/workbench/workbench.common.main.ts:53-136]()\n\n### Core Registrations in Common\n\nThe common workbench registers platform-agnostic services:\n\n| Service Interface | Implementation | Type |\n|------------------|----------------|------|\n| `IUserDataSyncLogService` | `UserDataSyncLogService` | Delayed |\n| `IContextViewService` | `ContextViewService` | Delayed |\n| `IListService` | `ListService` | Delayed |\n| `IMarkerService` | `MarkerService` | Delayed |\n| `IContextKeyService` | `ContextKeyService` | Delayed |\n| `IDownloadService` | `DownloadService` | Delayed |\n| `IOpenerService` | `OpenerService` | Delayed |\n| `IWebWorkerService` | `WebWorkerService` | Delayed |\n\n**Sources:** [src/vs/workbench/workbench.common.main.ts:166-181]()\n\n## Web-Specific Service Implementations\n\nThe web version registers browser-compatible implementations for services that require platform-specific behavior.\n\n### Browser Service Substitutions\n\n```mermaid\ngraph TB\n    subgraph \"Service Interfaces (Platform-agnostic)\"\n        ITF1[\"ITextFileService\"]\n        ITF2[\"IExtensionService\"]\n        ITF3[\"ILifecycleService\"]\n        ITF4[\"IHostService\"]\n        ITF5[\"IClipboardService\"]\n        ITF6[\"IPathService\"]\n    end\n    \n    subgraph \"Browser Implementations\"\n        IMPL1[\"BrowserTextFileService\"]\n        IMPL2[\"ExtensionService (browser)\"]\n        IMPL3[\"BrowserLifecycleService\"]\n        IMPL4[\"BrowserHostService\"]\n        IMPL5[\"BrowserClipboardService\"]\n        IMPL6[\"BrowserPathService\"]\n    end\n    \n    ITF1 -.implemented by.-\u003e IMPL1\n    ITF2 -.implemented by.-\u003e IMPL2\n    ITF3 -.implemented by.-\u003e IMPL3\n    ITF4 -.implemented by.-\u003e IMPL4\n    ITF5 -.implemented by.-\u003e IMPL5\n    ITF6 -.implemented by.-\u003e IMPL6\n```\n\n**Sources:** [src/vs/workbench/workbench.web.main.ts:37-72]()\n\n### Key Web Services\n\nThe following services are specifically imported for web:\n\n| Service File | Purpose |\n|--------------|---------|\n| `services/textfile/browser/browserTextFileService.js` | File handling via browser APIs |\n| `services/extensions/browser/extensionService.js` | Extension loading without Node.js |\n| `services/host/browser/browserHostService.js` | Browser window management |\n| `services/clipboard/browser/clipboardService.js` | Clipboard API integration |\n| `services/path/browser/pathService.js` | Path resolution for web URIs |\n| `services/lifecycle/browser/lifecycleService.js` | Browser page lifecycle hooks |\n| `services/secrets/browser/secretStorageService.js` | Credential storage via browser APIs |\n| `services/workingCopy/browser/workingCopyBackupService.js` | In-browser backup mechanism |\n| `services/tunnel/browser/tunnelService.js` | Port forwarding for web |\n\n**Sources:** [src/vs/workbench/workbench.web.main.ts:39-66]()\n\n## Service Singleton Registrations\n\nAfter importing service implementations, the web workbench registers them as singletons via the dependency injection system.\n\n### Registration Pattern\n\n```mermaid\ngraph LR\n    REGISTER[\"registerSingleton()\"]\n    INTERFACE[\"Service Interface\u003cbr/\u003e(e.g., ITitleService)\"]\n    IMPL[\"Implementation\u003cbr/\u003e(e.g., BrowserTitleService)\"]\n    TYPE[\"InstantiationType\u003cbr/\u003e(Delayed or Eager)\"]\n    \n    REGISTER --\u003e INTERFACE\n    REGISTER --\u003e IMPL\n    REGISTER --\u003e TYPE\n```\n\n**Sources:** [src/vs/workbench/workbench.web.main.ts:74-121]()\n\n### Web Service Registrations\n\nThe web main file registers these platform-specific singletons:\n\n```typescript\n// Extension Management - Web-specific\nregisterSingleton(IWorkbenchExtensionManagementService, ExtensionManagementService, Delayed)\n\n// Accessibility - Browser implementation\nregisterSingleton(IAccessibilityService, AccessibilityService, Delayed)\n\n// Context Menu - Browser-specific\nregisterSingleton(IContextMenuService, ContextMenuService, Delayed)\n\n// User Data Sync - Cloud synchronization\nregisterSingleton(IUserDataSyncStoreService, UserDataSyncStoreService, Delayed)\nregisterSingleton(IUserDataSyncService, UserDataSyncService, Delayed)\nregisterSingleton(IUserDataAutoSyncService, UserDataAutoSyncService, Eager)\n\n// Title Service - Browser window title\nregisterSingleton(ITitleService, BrowserTitleService, Eager)\n\n// Extension Tips\nregisterSingleton(IExtensionTipsService, ExtensionTipsService, Delayed)\n\n// Null Services (Not available in web)\nregisterSingleton(ICustomEndpointTelemetryService, NullEndpointTelemetryService, Delayed)\nregisterSingleton(IDiagnosticsService, NullDiagnosticsService, Delayed)\n```\n\n**Sources:** [src/vs/workbench/workbench.web.main.ts:103-121]()\n\n### Eager vs Delayed Instantiation\n\n| Service | Instantiation Type | Reason |\n|---------|-------------------|--------|\n| `ITitleService` | Eager | Must control window title immediately |\n| `IUserDataAutoSyncService` | Eager | Auto-sync must start on boot |\n| `IAccessibilityService` | Delayed | Only needed when accessed |\n| `IExtensionManagementService` | Delayed | Heavy, load on demand |\n| Most other services | Delayed | Improve startup performance |\n\n**Sources:** [src/vs/workbench/workbench.web.main.ts:103-121]()\n\n## Web-Specific Feature Contributions\n\nAfter service registration, the web workbench imports feature-specific contributions that are tailored for browser environments.\n\n### Contribution Categories\n\n```mermaid\ngraph TB\n    subgraph \"Core Features\"\n        LOGS[\"Logs (browser)\"]\n        LOC[\"Localization\"]\n        PERF[\"Performance (web)\"]\n    end\n    \n    subgraph \"UI Components\"\n        WEBVIEW[\"Webview (web)\"]\n        WELCOME[\"Welcome Banner\"]\n        SPLASH[\"Splash Screen\"]\n    end\n    \n    subgraph \"Development Tools\"\n        DEBUG[\"Extension Host Debug\"]\n        ISSUE[\"Issue Reporter\"]\n        PROC[\"Process Explorer (web)\"]\n    end\n    \n    subgraph \"Extensions\"\n        EXT[\"Extensions (web)\"]\n        TERMINAL[\"Terminal (web)\"]\n        TASKS[\"Task Service\"]\n    end\n    \n    subgraph \"Remote\"\n        REMOTE[\"Remote Start Entry\"]\n        TAGS[\"Workspace Tags\"]\n    end\n```\n\n**Sources:** [src/vs/workbench/workbench.web.main.ts:126-175]()\n\n### Terminal in Web\n\nThe web terminal has special considerations:\n\n| Import | Purpose |\n|--------|---------|\n| `contrib/terminal/browser/terminal.web.contribution.js` | Web-specific terminal features |\n| `contrib/terminal/browser/terminalInstanceService.js` | Terminal instance management |\n| `contrib/externalTerminal/browser/externalTerminal.contribution.js` | External terminal integration (limited in web) |\n\nThe web terminal cannot spawn native PTY processes, so it typically connects to remote terminal backends or uses web-based solutions.\n\n**Sources:** [src/vs/workbench/workbench.web.main.ts:152-155]()\n\n## Web vs Desktop Bootstrap Comparison\n\nUnderstanding the differences helps clarify what the web bootstrap must handle differently.\n\n### Architecture Differences\n\n```mermaid\ngraph TB\n    subgraph \"Desktop Bootstrap\"\n        ELECTRON[\"Electron Main Process\"]\n        NATIVE[\"Native Services\u003cbr/\u003eFile system, PTY, etc\"]\n        LOCAL[\"Local Extension Host\u003cbr/\u003eNode.js process\"]\n    end\n    \n    subgraph \"Web Bootstrap\"\n        BROWSER[\"Browser Window\"]\n        WEB_SERVICES[\"Web Services\u003cbr/\u003eIndexedDB, WebWorkers, etc\"]\n        WEB_EXT[\"Web Extension Host\u003cbr/\u003eWeb Worker\"]\n    end\n    \n    subgraph \"Common\"\n        COMMON_WB[\"Common Workbench\"]\n    end\n    \n    ELECTRON --\u003e NATIVE\n    NATIVE --\u003e LOCAL\n    LOCAL --\u003e COMMON_WB\n    \n    BROWSER --\u003e WEB_SERVICES\n    WEB_SERVICES --\u003e WEB_EXT\n    WEB_EXT --\u003e COMMON_WB\n```\n\n**Sources:** [src/vs/workbench/workbench.web.main.ts:1-176](), [src/vs/workbench/workbench.desktop.main.ts:1-192]()\n\n### Key Differences\n\n| Aspect | Desktop | Web |\n|--------|---------|-----|\n| Entry Point | `workbench.desktop.main.ts` | `workbench.web.main.ts` |\n| Process Model | Electron multi-process | Browser single-page |\n| Native Modules | Full Node.js access | None |\n| File System | Direct OS file system | Virtual file system / remote |\n| Extension Host | Local Node.js process | Web Worker or remote |\n| PTY/Terminal | Native pty via `node-pty` | Remote or web-based |\n| Clipboard | Native clipboard API | Browser Clipboard API |\n| Title Bar | Native window title | Custom HTML title bar |\n| Lifecycle | Electron app lifecycle | Browser page lifecycle |\n\n**Sources:** [src/vs/workbench/workbench.web.main.ts:1-176](), [src/vs/workbench/workbench.desktop.main.ts:1-192]()\n\n### Service Implementation Comparison\n\n```mermaid\ngraph LR\n    subgraph \"Desktop Services\"\n        D1[\"NativeTextFileService\"]\n        D2[\"NativeExtensionService\"]\n        D3[\"NativeHostService\"]\n        D4[\"ElectronClipboardService\"]\n    end\n    \n    subgraph \"Web Services\"\n        W1[\"BrowserTextFileService\"]\n        W2[\"ExtensionService (browser)\"]\n        W3[\"BrowserHostService\"]\n        W4[\"BrowserClipboardService\"]\n    end\n    \n    subgraph \"Shared Interfaces\"\n        I1[\"ITextFileService\"]\n        I2[\"IExtensionService\"]\n        I3[\"IHostService\"]\n        I4[\"IClipboardService\"]\n    end\n    \n    D1 -.implements.-\u003e I1\n    W1 -.implements.-\u003e I1\n    D2 -.implements.-\u003e I2\n    W2 -.implements.-\u003e I2\n    D3 -.implements.-\u003e I3\n    W3 -.implements.-\u003e I3\n    D4 -.implements.-\u003e I4\n    W4 -.implements.-\u003e I4\n```\n\n**Sources:** [src/vs/workbench/workbench.web.main.ts:37-66](), [src/vs/workbench/workbench.desktop.main.ts:37-93]()\n\n## Extension System in Web\n\nThe web workbench has a fundamentally different extension architecture due to browser limitations.\n\n### Extension Host Differences\n\n```mermaid\ngraph TB\n    subgraph \"Desktop Extension Hosts\"\n        LOCAL_PROC[\"Local Process\u003cbr/\u003eNode.js + Native APIs\"]\n        REMOTE_PROC[\"Remote Process\u003cbr/\u003eSSH/Remote server\"]\n        LOCAL_WORKER[\"Local Web Worker\u003cbr/\u003e(optional)\"]\n    end\n    \n    subgraph \"Web Extension Hosts\"\n        WEB_WORKER[\"Web Worker\u003cbr/\u003eBrowser sandbox\"]\n        REMOTE_WEB[\"Remote Process\u003cbr/\u003eRemote server\"]\n    end\n    \n    subgraph \"Extension Types\"\n        UI[\"UI Extensions\"]\n        WORKSPACE[\"Workspace Extensions\"]\n        WEB_EXT[\"Web Extensions\"]\n    end\n    \n    UI --\u003e LOCAL_PROC\n    UI --\u003e WEB_WORKER\n    WORKSPACE --\u003e REMOTE_PROC\n    WORKSPACE --\u003e REMOTE_WEB\n    WEB_EXT --\u003e WEB_WORKER\n```\n\n**Sources:** [src/vs/workbench/workbench.web.main.ts:41-45]()\n\n### Web Extension Scanner\n\nThe web version uses specialized extension scanning:\n\n| Component | Purpose |\n|-----------|---------|\n| `extensionsScannerService.js` (browser) | Scans available extensions |\n| `webExtensionsScannerService.js` | Specifically handles web extensions |\n| `extensionsProfileScannerService.js` | Profile-specific extension management |\n| `extensionGalleryManifestService.js` | Fetches extension manifests from gallery |\n\nThese services scan extensions that are:\n- Hosted on CDN/web server\n- Compiled to browser-compatible JavaScript\n- Marked with `\"extensionKind\": [\"web\"]` in manifest\n\n**Sources:** [src/vs/workbench/workbench.web.main.ts:42-47]()\n\n## Null and Stub Services\n\nThe web version registers \"null\" implementations for services that don't make sense in a browser environment.\n\n### Unavailable Services\n\n```typescript\n// Services that don't exist in web context\nregisterSingleton(ICustomEndpointTelemetryService, NullEndpointTelemetryService, Delayed)\nregisterSingleton(IDiagnosticsService, NullDiagnosticsService, Delayed)\nregisterSingleton(IWebContentExtractorService, NullWebContentExtractorService, Delayed)\nregisterSingleton(ISharedWebContentExtractorService, NullSharedWebContentExtractorService, Delayed)\n```\n\nThese services:\n- Have no-op implementations\n- Prevent code paths that depend on them from crashing\n- Allow shared code to work in both desktop and web\n\n**Sources:** [src/vs/workbench/workbench.web.main.ts:116-120]()\n\n### Why Null Services?\n\n| Service | Why Not Available in Web |\n|---------|-------------------------|\n| `ICustomEndpointTelemetryService` | Requires native network access |\n| `IDiagnosticsService` | Needs OS-level diagnostics |\n| `IWebContentExtractorService` | Uses native libraries for content extraction |\n| `ISharedWebContentExtractorService` | Same as above, shared worker variant |\n\n**Sources:** [src/vs/workbench/workbench.web.main.ts:116-120]()\n\n## Bootstrap Sequence Summary\n\nThe complete web workbench bootstrap follows this sequence:\n\n```mermaid\nsequenceDiagram\n    participant Browser\n    participant WebMain as workbench.web.main.ts\n    participant Common as workbench.common.main.ts\n    participant Services as Service Registry\n    participant WebBootstrap as browser/web.main.js\n    \n    Browser-\u003e\u003eWebMain: Load web.main.ts\n    WebMain-\u003e\u003eCommon: Import common workbench\n    Common-\u003e\u003eServices: Register common services\n    Common--\u003e\u003eWebMain: Common setup complete\n    \n    WebMain-\u003e\u003eServices: Import browser service impls\n    WebMain-\u003e\u003eServices: Register web-specific singletons\n    Note over Services: ITitleService -\u003e BrowserTitleService\n    Note over Services: IExtensionService -\u003e ExtensionService (browser)\n    Note over Services: IHostService -\u003e BrowserHostService\n    \n    WebMain-\u003e\u003eWebBootstrap: Import browser/web.main.js\n    WebBootstrap-\u003e\u003eServices: Initialize service instances\n    WebBootstrap-\u003e\u003eBrowser: Render workbench UI\n```\n\n**Sources:** [src/vs/workbench/workbench.web.main.ts:1-176]()\n\n### Step-by-Step Process\n\n1. **Load Entry Point** - Browser loads `workbench.web.main.ts`\n2. **Import Common** - Includes all shared workbench infrastructure\n3. **Import Web Services** - Loads browser-specific service implementations\n4. **Register Singletons** - Registers services with dependency injection\n5. **Import Contributions** - Loads web-specific feature contributions\n6. **Execute Bootstrap** - Runs `browser/web.main.js` to actually start the workbench\n\n**Sources:** [src/vs/workbench/workbench.web.main.ts:1-176]()\n\n## Localization and Language Packs\n\nThe web workbench includes special handling for language packs.\n\n### Language Pack Service\n\n```typescript\nregisterSingleton(ILanguagePackService, WebLanguagePacksService, Delayed)\n```\n\nThe `WebLanguagePacksService` fetches language packs from the server rather than reading them from the local file system.\n\n**Sources:** [src/vs/workbench/workbench.web.main.ts:118](), [src/vs/workbench/workbench.web.main.ts:131-132]()\n\n## Key Takeaways\n\nThe web workbench bootstrap:\n\n1. **Builds on Common Foundation** - Reuses 80%+ of workbench code\n2. **Substitutes Browser Services** - Replaces native implementations\n3. **Uses Null Services** - Stubs unavailable functionality\n4. **Adapts Extension System** - Web workers instead of Node.js processes\n5. **Manages Different Lifecycle** - Page lifecycle vs app lifecycle\n6. **Registers Services Declaratively** - Via `registerSingleton()` pattern\n\nThe architecture allows VS Code to run in the browser with minimal code duplication while maintaining the same API surface for extensions and features.\n\n**Sources:** [src/vs/workbench/workbench.web.main.ts:1-176](), [src/vs/workbench/workbench.common.main.ts:1-434]()"])</script><script>self.__next_f.push([1,"22:T7b36,"])</script><script>self.__next_f.push([1,"# Service Initialization and Dependency Injection\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [build/lib/i18n.resources.json](build/lib/i18n.resources.json)\n- [cli/src/bin/code/legacy_args.rs](cli/src/bin/code/legacy_args.rs)\n- [resources/completions/bash/code](resources/completions/bash/code)\n- [resources/completions/zsh/_code](resources/completions/zsh/_code)\n- [src/vs/base/node/terminalEncoding.ts](src/vs/base/node/terminalEncoding.ts)\n- [src/vs/code/browser/workbench/workbench-dev.html](src/vs/code/browser/workbench/workbench-dev.html)\n- [src/vs/code/browser/workbench/workbench.html](src/vs/code/browser/workbench/workbench.html)\n- [src/vs/code/browser/workbench/workbench.ts](src/vs/code/browser/workbench/workbench.ts)\n- [src/vs/code/electron-main/app.ts](src/vs/code/electron-main/app.ts)\n- [src/vs/code/electron-main/main.ts](src/vs/code/electron-main/main.ts)\n- [src/vs/code/node/cli.ts](src/vs/code/node/cli.ts)\n- [src/vs/code/node/cliProcessMain.ts](src/vs/code/node/cliProcessMain.ts)\n- [src/vs/platform/editor/common/editor.ts](src/vs/platform/editor/common/editor.ts)\n- [src/vs/platform/environment/common/argv.ts](src/vs/platform/environment/common/argv.ts)\n- [src/vs/platform/environment/common/environment.ts](src/vs/platform/environment/common/environment.ts)\n- [src/vs/platform/environment/common/environmentService.ts](src/vs/platform/environment/common/environmentService.ts)\n- [src/vs/platform/environment/electron-main/environmentMainService.ts](src/vs/platform/environment/electron-main/environmentMainService.ts)\n- [src/vs/platform/environment/node/argv.ts](src/vs/platform/environment/node/argv.ts)\n- [src/vs/platform/environment/node/argvHelper.ts](src/vs/platform/environment/node/argvHelper.ts)\n- [src/vs/platform/environment/node/environmentService.ts](src/vs/platform/environment/node/environmentService.ts)\n- [src/vs/platform/environment/node/stdin.ts](src/vs/platform/environment/node/stdin.ts)\n- [src/vs/platform/extensionManagement/common/extensionManagementCLI.ts](src/vs/platform/extensionManagement/common/extensionManagementCLI.ts)\n- [src/vs/server/node/remoteExtensionHostAgentCli.ts](src/vs/server/node/remoteExtensionHostAgentCli.ts)\n- [src/vs/server/node/server.cli.ts](src/vs/server/node/server.cli.ts)\n- [src/vs/server/node/serverEnvironmentService.ts](src/vs/server/node/serverEnvironmentService.ts)\n- [src/vs/server/node/serverServices.ts](src/vs/server/node/serverServices.ts)\n- [src/vs/workbench/browser/actions/layoutActions.ts](src/vs/workbench/browser/actions/layoutActions.ts)\n- [src/vs/workbench/browser/contextkeys.ts](src/vs/workbench/browser/contextkeys.ts)\n- [src/vs/workbench/browser/dnd.ts](src/vs/workbench/browser/dnd.ts)\n- [src/vs/workbench/browser/layout.ts](src/vs/workbench/browser/layout.ts)\n- [src/vs/workbench/browser/parts/auxiliarybar/auxiliaryBarActions.ts](src/vs/workbench/browser/parts/auxiliarybar/auxiliaryBarActions.ts)\n- [src/vs/workbench/browser/parts/editor/editor.contribution.ts](src/vs/workbench/browser/parts/editor/editor.contribution.ts)\n- [src/vs/workbench/browser/parts/editor/editor.ts](src/vs/workbench/browser/parts/editor/editor.ts)\n- [src/vs/workbench/browser/parts/editor/editorActions.ts](src/vs/workbench/browser/parts/editor/editorActions.ts)\n- [src/vs/workbench/browser/parts/editor/editorCommands.ts](src/vs/workbench/browser/parts/editor/editorCommands.ts)\n- [src/vs/workbench/browser/parts/editor/editorDropTarget.ts](src/vs/workbench/browser/parts/editor/editorDropTarget.ts)\n- [src/vs/workbench/browser/parts/editor/editorGroupView.ts](src/vs/workbench/browser/parts/editor/editorGroupView.ts)\n- [src/vs/workbench/browser/parts/editor/editorPart.ts](src/vs/workbench/browser/parts/editor/editorPart.ts)\n- [src/vs/workbench/browser/parts/panel/panelActions.ts](src/vs/workbench/browser/parts/panel/panelActions.ts)\n- [src/vs/workbench/browser/parts/titlebar/titlebarActions.ts](src/vs/workbench/browser/parts/titlebar/titlebarActions.ts)\n- [src/vs/workbench/browser/web.api.ts](src/vs/workbench/browser/web.api.ts)\n- [src/vs/workbench/browser/web.factory.ts](src/vs/workbench/browser/web.factory.ts)\n- [src/vs/workbench/browser/web.main.ts](src/vs/workbench/browser/web.main.ts)\n- [src/vs/workbench/browser/workbench.contribution.ts](src/vs/workbench/browser/workbench.contribution.ts)\n- [src/vs/workbench/browser/workbench.ts](src/vs/workbench/browser/workbench.ts)\n- [src/vs/workbench/common/contextkeys.ts](src/vs/workbench/common/contextkeys.ts)\n- [src/vs/workbench/common/editor.ts](src/vs/workbench/common/editor.ts)\n- [src/vs/workbench/electron-browser/desktop.main.ts](src/vs/workbench/electron-browser/desktop.main.ts)\n- [src/vs/workbench/services/editor/browser/editorService.ts](src/vs/workbench/services/editor/browser/editorService.ts)\n- [src/vs/workbench/services/editor/common/editorGroupsService.ts](src/vs/workbench/services/editor/common/editorGroupsService.ts)\n- [src/vs/workbench/services/editor/common/editorService.ts](src/vs/workbench/services/editor/common/editorService.ts)\n- [src/vs/workbench/services/editor/test/browser/editorGroupsService.test.ts](src/vs/workbench/services/editor/test/browser/editorGroupsService.test.ts)\n- [src/vs/workbench/services/editor/test/browser/editorService.test.ts](src/vs/workbench/services/editor/test/browser/editorService.test.ts)\n- [src/vs/workbench/services/environment/browser/environmentService.ts](src/vs/workbench/services/environment/browser/environmentService.ts)\n- [src/vs/workbench/services/environment/common/environmentService.ts](src/vs/workbench/services/environment/common/environmentService.ts)\n- [src/vs/workbench/services/environment/electron-browser/environmentService.ts](src/vs/workbench/services/environment/electron-browser/environmentService.ts)\n- [src/vs/workbench/services/extensions/electron-browser/nativeExtensionService.ts](src/vs/workbench/services/extensions/electron-browser/nativeExtensionService.ts)\n- [src/vs/workbench/services/layout/browser/layoutService.ts](src/vs/workbench/services/layout/browser/layoutService.ts)\n- [src/vs/workbench/test/browser/workbenchTestServices.ts](src/vs/workbench/test/browser/workbenchTestServices.ts)\n- [src/vs/workbench/workbench.common.main.ts](src/vs/workbench/workbench.common.main.ts)\n- [src/vs/workbench/workbench.desktop.main.ts](src/vs/workbench/workbench.desktop.main.ts)\n- [src/vs/workbench/workbench.web.main.ts](src/vs/workbench/workbench.web.main.ts)\n\n\u003c/details\u003e\n\n\n\nThis document explains how VS Code initializes services and implements dependency injection across different runtime contexts. For information about the multi-process architecture, see [Multi-Process Architecture](#3.3). For details on specific workbench services, see [Workbench Architecture](#4).\n\n## Overview\n\nVS Code uses a dependency injection (DI) system to manage service instantiation, dependencies, and lifecycle. The system is based on:\n- **ServiceCollection**: A registry mapping service identifiers to implementations\n- **InstantiationService**: Creates service instances and resolves their dependencies\n- **Service Descriptors**: Define how services should be instantiated (immediate vs. lazy)\n- **Service Decorators**: `createDecorator()` creates unique service identifiers\n\nThe DI system operates across multiple runtime contexts (main process, renderer, web, CLI, shared process), each with its own service initialization sequence.\n\n## Core Concepts\n\n### Service Collection and Instantiation Service Architecture\n\n```mermaid\ngraph TB\n    ServiceId[\"IServiceIdentifier\u0026lt;T\u0026gt;\u003cbr/\u003e(created by createDecorator)\"]\n    ServiceCollection[\"ServiceCollection\u003cbr/\u003e(stores service registrations)\"]\n    SyncDescriptor[\"SyncDescriptor\u003cbr/\u003e(lazy instantiation config)\"]\n    InstantiationService[\"InstantiationService\u003cbr/\u003e(resolves dependencies)\"]\n    \n    ServiceId --\u003e|\"used as key in\"| ServiceCollection\n    SyncDescriptor --\u003e|\"registered in\"| ServiceCollection\n    DirectInstance[\"Direct Instance\u003cbr/\u003e(eager instantiation)\"] --\u003e|\"registered in\"| ServiceCollection\n    \n    ServiceCollection --\u003e|\"passed to constructor\"| InstantiationService\n    InstantiationService --\u003e|\"createInstance()\u003cbr/\u003einvokeFunction()\"| ServiceInstance[\"Service Instance\u003cbr/\u003e(with dependencies injected)\"]\n    \n    ServiceConstructor[\"Service Constructor\u003cbr/\u003e(@IServiceName params)\"] -.-\u003e|\"dependencies declared via\"| ServiceId\n    InstantiationService --\u003e|\"reads constructor\u003cbr/\u003eresolves deps\"| ServiceConstructor\n```\n\nSources: [src/vs/platform/instantiation/common/serviceCollection.ts](), [src/vs/platform/instantiation/common/instantiationService.ts](), [src/vs/platform/instantiation/common/descriptors.ts]()\n\n### Dependency Injection Pattern\n\n```mermaid\ngraph LR\n    subgraph \"Service Definition\"\n        IMyService[\"interface IMyService\"]\n        ServiceId[\"IMyService = createDecorator('myService')\"]\n        IMyService -.-\u003e|\"identifier\"| ServiceId\n    end\n    \n    subgraph \"Service Implementation\"\n        MyService[\"class MyService {\u003cbr/\u003e  constructor(\u003cbr/\u003e    @ILogService logService,\u003cbr/\u003e    @IFileService fileService\u003cbr/\u003e  )\u003cbr/\u003e}\"]\n    end\n    \n    subgraph \"Service Registration\"\n        Register[\"serviceCollection.set(\u003cbr/\u003e  IMyService,\u003cbr/\u003e  new SyncDescriptor(MyService)\u003cbr/\u003e)\"]\n    end\n    \n    subgraph \"Service Usage\"\n        Consumer[\"class Consumer {\u003cbr/\u003e  constructor(\u003cbr/\u003e    @IMyService myService\u003cbr/\u003e  )\u003cbr/\u003e}\"]\n    end\n    \n    ServiceId --\u003e|\"used in\"| Register\n    MyService --\u003e|\"implementation\"| Register\n    InstSvc[\"InstantiationService\"] --\u003e|\"resolves\"| Register\n    InstSvc --\u003e|\"injects into\"| Consumer\n    InstSvc --\u003e|\"creates with deps\"| MyService\n```\n\nSources: [src/vs/platform/instantiation/common/instantiation.ts](), [src/vs/platform/instantiation/common/extensions.ts]()\n\n### Service Descriptor Types\n\n| Descriptor Type | Creation Timing | Use Case | Example |\n|----------------|----------------|----------|---------|\n| Direct Instance | Immediate (at registration) | Already created, shared instance | `serviceCollection.set(IProductService, productService)` |\n| `SyncDescriptor` | Lazy (on first access) | Most services, deferred instantiation | `new SyncDescriptor(FileService)` |\n| `SyncDescriptor` with `supportsDelayedInstantiation: true` | Lazy (on first access after delay) | Optional optimization | `new SyncDescriptor(MyService, [], true)` |\n| `registerSingleton` | Lazy (global registration) | Common services shared across contexts | `registerSingleton(ILogService, LogService)` |\n\nSources: [src/vs/platform/instantiation/common/descriptors.ts:11-52](), [src/vs/platform/instantiation/common/extensions.ts:53-98]()\n\n## Service Registration Patterns\n\n### Pattern 1: Direct Instance Registration\n\nUsed when a service is already instantiated or needs immediate initialization:\n\n```typescript\n// Create service immediately\nconst productService = { _serviceBrand: undefined, ...product };\nservices.set(IProductService, productService);\n\n// Or with a constructed instance\nconst environmentService = new EnvironmentMainService(args, productService);\nservices.set(IEnvironmentMainService, environmentService);\n```\n\nSources: [src/vs/code/electron-main/main.ts:168-174]()\n\n### Pattern 2: Lazy Instantiation with SyncDescriptor\n\nMost services use `SyncDescriptor` for deferred creation:\n\n```typescript\n// Service created only when first requested\nservices.set(IFileService, new SyncDescriptor(FileService, [logService], true));\n\n// Constructor parameters can be provided\nservices.set(IBackupMainService, new SyncDescriptor(BackupMainService, undefined, true));\n```\n\nSources: [src/vs/code/electron-main/app.ts:652-658](), [src/vs/code/node/cliProcessMain.ts:228-237]()\n\n### Pattern 3: Singleton Registration (Common Services)\n\nServices shared across desktop and web are registered globally using `registerSingleton`:\n\n```typescript\nimport { registerSingleton } from '../platform/instantiation/common/extensions.js';\nimport { InstantiationType } from '../platform/instantiation/common/extensions.js';\n\nregisterSingleton(IContextKeyService, ContextKeyService, InstantiationType.Delayed);\nregisterSingleton(IMarkerService, MarkerService, InstantiationType.Delayed);\nregisterSingleton(IDownloadService, DownloadService, InstantiationType.Delayed);\n```\n\nSources: [src/vs/workbench/workbench.common.main.ts:165-181]()\n\n## Initialization Flows by Runtime Context\n\n### Main Process Service Initialization (Electron)\n\n```mermaid\ngraph TB\n    Entry[\"CodeMain.startup()\"]\n    CreateSvc[\"CodeMain.createServices()\"]\n    InitSvc[\"CodeMain.initServices()\"]\n    CreateApp[\"instantiationService.createInstance(\u003cbr/\u003eCodeApplication)\"]\n    AppStartup[\"CodeApplication.startup()\"]\n    InitAppSvc[\"CodeApplication.initServices()\"]\n    \n    Entry --\u003e CreateSvc\n    CreateSvc --\u003e InitSvc\n    InitSvc --\u003e CreateApp\n    CreateApp --\u003e AppStartup\n    AppStartup --\u003e InitAppSvc\n    \n    subgraph \"createServices() - Core Services\"\n        ProdSvc[\"IProductService\u003cbr/\u003e(product config)\"]\n        EnvSvc[\"IEnvironmentMainService\u003cbr/\u003e(args, paths)\"]\n        LogSvc[\"ILogService\u003cbr/\u003e(logging)\"]\n        FileSvc[\"IFileService\u003cbr/\u003e(file operations)\"]\n        StateSvc[\"IStateService\u003cbr/\u003e(persistent state)\"]\n        ProfileSvc[\"IUserDataProfilesMainService\u003cbr/\u003e(profiles)\"]\n    end\n    \n    subgraph \"initServices() - Async Init\"\n        StateInit[\"stateService.init()\"]\n        ConfigInit[\"configurationService.initialize()\"]\n        ProfileInit[\"userDataProfilesService.init()\"]\n    end\n    \n    subgraph \"CodeApplication.initServices() - App Services\"\n        BackupSvc[\"IBackupMainService\"]\n        WindowsSvc[\"IWindowsMainService\"]\n        StorageSvc[\"IStorageMainService\"]\n        TelemetrySvc[\"ITelemetryService\"]\n        UpdateSvc[\"IUpdateService\"]\n    end\n    \n    CreateSvc --\u003e ProdSvc\n    CreateSvc --\u003e EnvSvc\n    CreateSvc --\u003e LogSvc\n    CreateSvc --\u003e FileSvc\n    CreateSvc --\u003e StateSvc\n    CreateSvc --\u003e ProfileSvc\n    \n    InitSvc --\u003e StateInit\n    InitSvc --\u003e ConfigInit\n    InitSvc --\u003e ProfileInit\n    \n    InitAppSvc --\u003e BackupSvc\n    InitAppSvc --\u003e WindowsSvc\n    InitAppSvc --\u003e StorageSvc\n    InitAppSvc --\u003e TelemetrySvc\n    InitAppSvc --\u003e UpdateSvc\n```\n\n**Key initialization steps:**\n\n1. **Bootstrap Services** (`createServices`): Core services that don't have async dependencies\n   - Product service, Environment service, Logger service, File service, State service\n   \n2. **Async Initialization** (`initServices`): Services requiring async setup\n   - State service initialization, Configuration loading, Profile initialization\n   \n3. **Application Services** (`CodeApplication.initServices`): Higher-level services\n   - Backup, Windows management, Storage, Telemetry, Update service\n\nSources: [src/vs/code/electron-main/main.ts:97-160](), [src/vs/code/electron-main/main.ts:162-240](), [src/vs/code/electron-main/app.ts:577-736]()\n\n### Renderer/Workbench Service Initialization (Desktop)\n\n```mermaid\ngraph TB\n    Entry[\"main() entry point\"]\n    DomReady[\"domContentLoaded()\"]\n    InitSvc[\"initServices()\"]\n    CreateWB[\"new Workbench()\"]\n    WBStartup[\"workbench.startup()\"]\n    CreateInstSvc[\"workbench creates\u003cbr/\u003eInstantiationService\"]\n    \n    Entry --\u003e DomReady\n    DomReady --\u003e InitSvc\n    InitSvc --\u003e CreateWB\n    CreateWB --\u003e WBStartup\n    WBStartup --\u003e CreateInstSvc\n    \n    subgraph \"Early Services (initServices)\"\n        ProductSvc[\"IProductService\"]\n        EnvSvc[\"INativeWorkbenchEnvironmentService\"]\n        LoggerSvc[\"ILoggerService\"]\n        RemoteAuthSvc[\"IRemoteAuthorityResolverService\"]\n        SignSvc[\"ISignService\"]\n        RemoteAgentSvc[\"IRemoteAgentService\"]\n    end\n    \n    subgraph \"Long-running Services\"\n        ConfigSvc[\"IWorkbenchConfigurationService\u003cbr/\u003e(WorkspaceService)\"]\n        StorageSvc[\"IStorageService\u003cbr/\u003e(NativeWorkbenchStorageService)\"]\n    end\n    \n    subgraph \"Workbench Creates Final Services\"\n        CommonSvc[\"Common services\u003cbr/\u003e(from workbench.common.main.ts)\"]\n        DesktopSvc[\"Desktop-specific services\u003cbr/\u003e(from workbench.desktop.main.ts)\"]\n        ContribSvc[\"Contribution services\u003cbr/\u003e(from various contributions)\"]\n    end\n    \n    InitSvc --\u003e ProductSvc\n    InitSvc --\u003e EnvSvc\n    InitSvc --\u003e LoggerSvc\n    InitSvc --\u003e RemoteAuthSvc\n    InitSvc --\u003e SignSvc\n    InitSvc --\u003e RemoteAgentSvc\n    InitSvc --\u003e ConfigSvc\n    InitSvc --\u003e StorageSvc\n    \n    WBStartup --\u003e CommonSvc\n    WBStartup --\u003e DesktopSvc\n    WBStartup --\u003e ContribSvc\n```\n\n**Service initialization phases:**\n\n1. **Early Services**: Created before DOM/workbench, minimal dependencies\n2. **Long-running Services**: Configuration and Storage (require async initialization)\n3. **Workbench Services**: Full service registry created during `workbench.startup()`\n\nSources: [src/vs/workbench/electron-browser/desktop.main.ts:51-160](), [src/vs/workbench/browser/workbench.ts:89-213]()\n\n### Web Workbench Service Initialization\n\n```mermaid\ngraph TB\n    BrowserMain[\"BrowserMain.open()\"]\n    InitSvc[\"BrowserMain.initServices()\"]\n    CreateWB[\"new Workbench()\"]\n    WBStartup[\"workbench.startup()\"]\n    \n    BrowserMain --\u003e InitSvc\n    InitSvc --\u003e CreateWB\n    CreateWB --\u003e WBStartup\n    \n    subgraph \"Web-Specific Early Services\"\n        ProductSvc[\"IProductService\u003cbr/\u003e(with config override)\"]\n        EnvSvc[\"BrowserWorkbenchEnvironmentService\u003cbr/\u003e(web environment)\"]\n        FileSvc[\"IFileService\u003cbr/\u003e(web file providers)\"]\n        LoggerSvc[\"ILoggerService\u003cbr/\u003e(FileLoggerService)\"]\n    end\n    \n    subgraph \"IndexedDB Services\"\n        IndexedDBCheck[\"IndexedDB.create()\u003cbr/\u003evscode-web-db\"]\n        UserDataProvider[\"IndexedDBFileSystemProvider\u003cbr/\u003e(vscode-userdata)\"]\n        LogsProvider[\"IndexedDBFileSystemProvider\u003cbr/\u003e(vscode-log)\"]\n        InMemoryFallback[\"InMemoryFileSystemProvider\u003cbr/\u003e(if IndexedDB unavailable)\"]\n    end\n    \n    subgraph \"Web Configuration Services\"\n        RemoteAuthSvc[\"RemoteAuthorityResolverService\u003cbr/\u003e(with connectionToken)\"]\n        UriIdentitySvc[\"UriIdentityService\"]\n        ProfilesSvc[\"BrowserUserDataProfilesService\"]\n        RemoteAgentSvc[\"RemoteAgentService\u003cbr/\u003e(web socket factory)\"]\n    end\n    \n    subgraph \"Long-running Web Services\"\n        ConfigSvc[\"WorkspaceService\u003cbr/\u003e(configuration)\"]\n        StorageSvc[\"BrowserStorageService\u003cbr/\u003e(storage)\"]\n    end\n    \n    InitSvc --\u003e ProductSvc\n    InitSvc --\u003e EnvSvc\n    InitSvc --\u003e FileSvc\n    InitSvc --\u003e LoggerSvc\n    \n    FileSvc --\u003e IndexedDBCheck\n    IndexedDBCheck --\u003e UserDataProvider\n    IndexedDBCheck --\u003e LogsProvider\n    IndexedDBCheck --\u003e InMemoryFallback\n    \n    InitSvc --\u003e RemoteAuthSvc\n    InitSvc --\u003e UriIdentitySvc\n    InitSvc --\u003e ProfilesSvc\n    InitSvc --\u003e RemoteAgentSvc\n    \n    InitSvc --\u003e ConfigSvc\n    InitSvc --\u003e StorageSvc\n```\n\n**Web-specific considerations:**\n\n1. **IndexedDB for persistence**: User data and logs stored in IndexedDB, with in-memory fallback\n2. **Remote authority resolution**: Connection token management for remote workspaces\n3. **Browser constraints**: No native file system access, different storage mechanisms\n4. **Configuration precedence**: Web configuration overrides product defaults\n\nSources: [src/vs/workbench/browser/web.main.ts:122-444](), [src/vs/workbench/browser/web.main.ts:462-506]()\n\n### CLI Process Service Initialization\n\n```mermaid\ngraph TB\n    CliMain[\"CliMain.run()\"]\n    InitSvc[\"CliMain.initServices()\"]\n    InvokeFunc[\"instantiationService.invokeFunction()\"]\n    DoRun[\"CliMain.doRun()\"]\n    \n    CliMain --\u003e InitSvc\n    InitSvc --\u003e InvokeFunc\n    InvokeFunc --\u003e DoRun\n    \n    subgraph \"Core CLI Services\"\n        ProductSvc[\"IProductService\"]\n        EnvSvc[\"NativeEnvironmentService\u003cbr/\u003e(CLI args)\"]\n        LoggerSvc[\"ILoggerService\"]\n        LogSvc[\"ILogService\"]\n        FileSvc[\"IFileService\"]\n        UriIdentitySvc[\"IUriIdentityService\"]\n    end\n    \n    subgraph \"User Data Services\"\n        StateSvc[\"StateReadonlyService\u003cbr/\u003e(read-only state)\"]\n        ProfilesSvc[\"UserDataProfilesReadonlyService\u003cbr/\u003e(read-only profiles)\"]\n        FileUserDataProvider[\"FileUserDataProvider\u003cbr/\u003e(vscode-userdata scheme)\"]\n    end\n    \n    subgraph \"Extension Management Services\"\n        ExtScannerSvc[\"IExtensionsScannerService\"]\n        ExtMgmtSvc[\"INativeServerExtensionManagementService\"]\n        ExtGallerySvc[\"IExtensionGalleryService\"]\n        ExtSignatureSvc[\"IExtensionSignatureVerificationService\"]\n    end\n    \n    subgraph \"Policy \u0026 Configuration\"\n        PolicySvc[\"IPolicyService\u003cbr/\u003e(platform-specific)\"]\n        ConfigSvc[\"ConfigurationService\"]\n    end\n    \n    subgraph \"Telemetry Services\"\n        TelemetrySvc[\"ITelemetryService\u003cbr/\u003e(with machine ID)\"]\n        RequestSvc[\"IRequestService\"]\n    end\n    \n    InitSvc --\u003e ProductSvc\n    InitSvc --\u003e EnvSvc\n    InitSvc --\u003e LoggerSvc\n    InitSvc --\u003e LogSvc\n    InitSvc --\u003e FileSvc\n    InitSvc --\u003e UriIdentitySvc\n    \n    InitSvc --\u003e StateSvc\n    InitSvc --\u003e ProfilesSvc\n    FileSvc --\u003e FileUserDataProvider\n    \n    InitSvc --\u003e ExtScannerSvc\n    InitSvc --\u003e ExtMgmtSvc\n    InitSvc --\u003e ExtGallerySvc\n    InitSvc --\u003e ExtSignatureSvc\n    \n    InitSvc --\u003e PolicySvc\n    InitSvc --\u003e ConfigSvc\n    \n    InitSvc --\u003e TelemetrySvc\n    InitSvc --\u003e RequestSvc\n```\n\n**CLI-specific patterns:**\n\n1. **Read-only services**: State and profiles are read-only to avoid conflicts with running instances\n2. **Extension management focus**: CLI primarily manages extensions, so those services are critical\n3. **Minimal UI services**: No workbench or editor services needed\n4. **Platform-specific policy**: Different policy service implementations per platform (Windows registry, macOS defaults, Linux files)\n\nSources: [src/vs/code/node/cliProcessMain.ts:97-269]()\n\n## Service Registration Order and Dependencies\n\n### Bootstrap Service Order\n\nThe initialization order is critical to avoid circular dependencies:\n\n| Phase | Services | Characteristics |\n|-------|----------|----------------|\n| **Phase 1: Foundation** | Product, Environment, Logger | No dependencies, provide configuration |\n| **Phase 2: File System** | File Service, File System Providers | Depends on Logger only |\n| **Phase 3: State \u0026 Profiles** | State Service, URI Identity, User Data Profiles | Depends on File Service |\n| **Phase 4: Configuration** | Policy Service, Configuration Service | Depends on File Service, State, Profiles |\n| **Phase 5: Remote** | Remote Authority Resolver, Remote Agent | Depends on Configuration |\n| **Phase 6: Storage** | Storage Service | Depends on Configuration, Profiles, State |\n| **Phase 7: Application** | All other services | Can depend on any earlier phase |\n\nSources: [src/vs/code/electron-main/main.ts:162-240](), [src/vs/workbench/browser/web.main.ts:257-444]()\n\n### Common Service Registration (workbench.common.main.ts)\n\n```mermaid\ngraph LR\n    subgraph \"Platform Services\"\n        ContextKeyService[\"IContextKeyService\u003cbr/\u003eContextKeyService\"]\n        MarkerService[\"IMarkerService\u003cbr/\u003eMarkerService\"]\n        DownloadService[\"IDownloadService\u003cbr/\u003eDownloadService\"]\n        OpenerService[\"IOpenerService\u003cbr/\u003eOpenerService\"]\n    end\n    \n    subgraph \"Editor Services\"\n        TextResourceConfigService[\"ITextResourceConfigurationService\"]\n        MarkerDecorationsService[\"IMarkerDecorationsService\"]\n    end\n    \n    subgraph \"Extension Services\"\n        GlobalExtEnablementService[\"IGlobalExtensionEnablementService\"]\n        AllowedExtensionsService[\"IAllowedExtensionsService\"]\n        ExtensionStorageService[\"IExtensionStorageService\"]\n    end\n    \n    subgraph \"User Data Sync\"\n        UserDataSyncLogService[\"IUserDataSyncLogService\"]\n        IgnoredExtensionsMgmtService[\"IIgnoredExtensionsManagementService\"]\n    end\n    \n    subgraph \"UI Services\"\n        ContextViewService[\"IContextViewService\"]\n        ListService[\"IListService\"]\n    end\n    \n    RegisterSingleton[\"registerSingleton()\u003cbr/\u003e(InstantiationType.Delayed)\"]\n    \n    ContextKeyService -.-\u003e RegisterSingleton\n    MarkerService -.-\u003e RegisterSingleton\n    DownloadService -.-\u003e RegisterSingleton\n    OpenerService -.-\u003e RegisterSingleton\n    TextResourceConfigService -.-\u003e RegisterSingleton\n    MarkerDecorationsService -.-\u003e RegisterSingleton\n    GlobalExtEnablementService -.-\u003e RegisterSingleton\n    AllowedExtensionsService -.-\u003e RegisterSingleton\n    ExtensionStorageService -.-\u003e RegisterSingleton\n    UserDataSyncLogService -.-\u003e RegisterSingleton\n    IgnoredExtensionsMgmtService -.-\u003e RegisterSingleton\n    ContextViewService -.-\u003e RegisterSingleton\n    ListService -.-\u003e RegisterSingleton\n```\n\nThese services are registered in `workbench.common.main.ts` and loaded automatically when the workbench starts. They are shared between desktop and web.\n\nSources: [src/vs/workbench/workbench.common.main.ts:136-181]()\n\n## Service Lifecycle and Access Patterns\n\n### Creating Service Instances\n\nThe `InstantiationService` provides multiple ways to create instances:\n\n```typescript\n// Method 1: Create an instance with dependencies injected\nconst myService = instantiationService.createInstance(MyService);\n\n// Method 2: Create with additional arguments\nconst myService = instantiationService.createInstance(MyService, arg1, arg2);\n\n// Method 3: Invoke a function with service injection\ninstantiationService.invokeFunction(accessor =\u003e {\n  const logService = accessor.get(ILogService);\n  const fileService = accessor.get(IFileService);\n  // Use services...\n});\n\n// Method 4: Create a child instantiation service with additional services\nconst child = instantiationService.createChild(new ServiceCollection([\n  [IMyService, myServiceInstance]\n]));\n```\n\nSources: [src/vs/platform/instantiation/common/instantiation.ts:99-129]()\n\n### Service Access in Code\n\nServices are accessed via constructor injection or `ServicesAccessor`:\n\n```typescript\n// Pattern 1: Constructor injection (preferred)\nclass MyClass {\n  constructor(\n    @ILogService private readonly logService: ILogService,\n    @IFileService private readonly fileService: IFileService\n  ) {\n    this.logService.info('MyClass created');\n  }\n}\n\n// Pattern 2: ServicesAccessor (for functions)\nfunction myFunction(accessor: ServicesAccessor) {\n  const logService = accessor.get(ILogService);\n  logService.info('Function called');\n}\n\n// Pattern 3: Manual service collection access (rare)\nconst logService = serviceCollection.get(ILogService);\n```\n\nSources: [src/vs/platform/instantiation/common/instantiation.ts:69-97]()\n\n### Shared Process Service Initialization\n\n```mermaid\ngraph TB\n    SharedProcess[\"SharedProcess.spawn()\"]\n    WaitReady[\"wait for 'vscode:createSharedProcessIPC'\"]\n    InitReady[\"initialization barrier\"]\n    CreateServices[\"createServices()\"]\n    RegisterChannels[\"register IPC channels\"]\n    \n    SharedProcess --\u003e WaitReady\n    WaitReady --\u003e InitReady\n    InitReady --\u003e CreateServices\n    CreateServices --\u003e RegisterChannels\n    \n    subgraph \"Shared Process Services\"\n        ExtMgmtSvc[\"IExtensionManagementService\"]\n        ExtGallerySvc[\"IExtensionGalleryService\"]\n        ExtTipsSvc[\"IExtensionTipsService\"]\n        LanguagePackSvc[\"ILanguagePackService\"]\n        StorageSvc[\"IStorageMainService\"]\n        LogSvc[\"ILogService\"]\n        RequestSvc[\"IRequestService\"]\n    end\n    \n    subgraph \"IPC Channels\"\n        ExtMgmtChannel[\"ExtensionManagementChannel\"]\n        ExtGalleryChannel[\"ExtensionGalleryChannel\"]\n        ExtTipsChannel[\"ExtensionTipsChannel\"]\n        StorageChannel[\"StorageDatabaseChannel\"]\n        LogChannel[\"LoggerChannel\"]\n    end\n    \n    CreateServices --\u003e ExtMgmtSvc\n    CreateServices --\u003e ExtGallerySvc\n    CreateServices --\u003e ExtTipsSvc\n    CreateServices --\u003e LanguagePackSvc\n    CreateServices --\u003e StorageSvc\n    CreateServices --\u003e LogSvc\n    CreateServices --\u003e RequestSvc\n    \n    RegisterChannels --\u003e ExtMgmtChannel\n    RegisterChannels --\u003e ExtGalleryChannel\n    RegisterChannels --\u003e ExtTipsChannel\n    RegisterChannels --\u003e StorageChannel\n    RegisterChannels --\u003e LogChannel\n```\n\nThe shared process runs background services that are shared across all windows. Services are exposed via IPC channels for communication with renderer processes.\n\nSources: [src/vs/platform/sharedProcess/electron-main/sharedProcess.ts:53-145](), [src/vs/code/electron-main/app.ts:574-576]()\n\n## Key Implementation Details\n\n### SyncDescriptor Mechanism\n\n`SyncDescriptor` delays service instantiation until first access:\n\n```typescript\n// Definition\nclass SyncDescriptor\u003cT\u003e {\n  constructor(\n    readonly ctor: new (...args: any[]) =\u003e T,\n    readonly staticArguments: any[] = [],\n    readonly supportsDelayedInstantiation: boolean = false\n  ) {}\n}\n\n// Usage\nservices.set(IFileService, new SyncDescriptor(FileService, [logService], true));\n\n// When instantiationService.get(IFileService) is called:\n// 1. Reads constructor parameters from FileService\n// 2. Resolves each @IServiceName parameter from the service collection\n// 3. Calls new FileService(...resolvedDependencies, ...staticArguments)\n// 4. Caches the result for subsequent calls\n```\n\nSources: [src/vs/platform/instantiation/common/descriptors.ts:11-52]()\n\n### Service Identifier Creation\n\nService identifiers are created using decorators:\n\n```typescript\n// Create a unique service identifier\nexport interface IMyService {\n  _serviceBrand: undefined;\n  doSomething(): void;\n}\n\nexport const IMyService = createDecorator\u003cIMyService\u003e('myService');\n\n// createDecorator generates:\n// 1. A unique symbol for the service\n// 2. A decorator function for parameter injection\n// 3. Type information for the service\n```\n\nSources: [src/vs/platform/instantiation/common/instantiation.ts:24-48]()\n\n### Circular Dependency Prevention\n\nThe instantiation service detects circular dependencies:\n\n```typescript\n// If ServiceA depends on ServiceB, and ServiceB depends on ServiceA:\n// InstantiationService throws: \"Cyclic dependency detected: IServiceA -\u003e IServiceB -\u003e IServiceA\"\n\n// To break cycles, use accessor pattern:\nclass ServiceA {\n  constructor(@IInstantiationService private readonly instantiationService: IInstantiationService) {\n    // Defer ServiceB access until needed\n  }\n  \n  method() {\n    const serviceB = this.instantiationService.invokeFunction(accessor =\u003e accessor.get(IServiceB));\n  }\n}\n```\n\nSources: [src/vs/platform/instantiation/common/instantiationService.ts:147-263]()\n\n### InstantiationType Enum\n\nServices registered with `registerSingleton` specify their instantiation timing:\n\n```typescript\nenum InstantiationType {\n  /**\n   * Instantiated eagerly when the service collection is created\n   */\n  Eager = 0,\n  \n  /**\n   * Instantiated lazily when first requested (default)\n   */\n  Delayed = 1\n}\n\n// Usage\nregisterSingleton(ILogService, LogService, InstantiationType.Delayed);\n```\n\nMost services use `InstantiationType.Delayed` to optimize startup performance.\n\nSources: [src/vs/platform/instantiation/common/extensions.ts:16-31]()\n\n## Summary\n\nVS Code's service initialization and dependency injection system provides:\n\n1. **Centralized service management** via `ServiceCollection` and `InstantiationService`\n2. **Automatic dependency resolution** through constructor parameter decorators\n3. **Lazy instantiation** via `SyncDescriptor` to optimize startup performance\n4. **Context-specific initialization** with different service sets for main process, renderer, web, and CLI\n5. **Shared service registry** through `registerSingleton` for common services\n6. **Circular dependency detection** to catch configuration errors\n7. **Type-safe service access** via TypeScript interfaces and decorators\n\nThe system enables VS Code to bootstrap different runtime contexts with appropriate services while maintaining clean separation of concerns and testability."])</script><script>self.__next_f.push([1,"23:Tb414,"])</script><script>self.__next_f.push([1,"# Workbench Architecture\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [src/vs/platform/editor/common/editor.ts](src/vs/platform/editor/common/editor.ts)\n- [src/vs/workbench/browser/actions/layoutActions.ts](src/vs/workbench/browser/actions/layoutActions.ts)\n- [src/vs/workbench/browser/contextkeys.ts](src/vs/workbench/browser/contextkeys.ts)\n- [src/vs/workbench/browser/dnd.ts](src/vs/workbench/browser/dnd.ts)\n- [src/vs/workbench/browser/layout.ts](src/vs/workbench/browser/layout.ts)\n- [src/vs/workbench/browser/parts/auxiliarybar/auxiliaryBarActions.ts](src/vs/workbench/browser/parts/auxiliarybar/auxiliaryBarActions.ts)\n- [src/vs/workbench/browser/parts/editor/editor.contribution.ts](src/vs/workbench/browser/parts/editor/editor.contribution.ts)\n- [src/vs/workbench/browser/parts/editor/editor.ts](src/vs/workbench/browser/parts/editor/editor.ts)\n- [src/vs/workbench/browser/parts/editor/editorActions.ts](src/vs/workbench/browser/parts/editor/editorActions.ts)\n- [src/vs/workbench/browser/parts/editor/editorCommands.ts](src/vs/workbench/browser/parts/editor/editorCommands.ts)\n- [src/vs/workbench/browser/parts/editor/editorDropTarget.ts](src/vs/workbench/browser/parts/editor/editorDropTarget.ts)\n- [src/vs/workbench/browser/parts/editor/editorGroupView.ts](src/vs/workbench/browser/parts/editor/editorGroupView.ts)\n- [src/vs/workbench/browser/parts/editor/editorPart.ts](src/vs/workbench/browser/parts/editor/editorPart.ts)\n- [src/vs/workbench/browser/parts/panel/panelActions.ts](src/vs/workbench/browser/parts/panel/panelActions.ts)\n- [src/vs/workbench/browser/parts/titlebar/titlebarActions.ts](src/vs/workbench/browser/parts/titlebar/titlebarActions.ts)\n- [src/vs/workbench/browser/workbench.contribution.ts](src/vs/workbench/browser/workbench.contribution.ts)\n- [src/vs/workbench/browser/workbench.ts](src/vs/workbench/browser/workbench.ts)\n- [src/vs/workbench/common/contextkeys.ts](src/vs/workbench/common/contextkeys.ts)\n- [src/vs/workbench/common/editor.ts](src/vs/workbench/common/editor.ts)\n- [src/vs/workbench/services/editor/browser/editorService.ts](src/vs/workbench/services/editor/browser/editorService.ts)\n- [src/vs/workbench/services/editor/common/editorGroupsService.ts](src/vs/workbench/services/editor/common/editorGroupsService.ts)\n- [src/vs/workbench/services/editor/common/editorService.ts](src/vs/workbench/services/editor/common/editorService.ts)\n- [src/vs/workbench/services/editor/test/browser/editorGroupsService.test.ts](src/vs/workbench/services/editor/test/browser/editorGroupsService.test.ts)\n- [src/vs/workbench/services/editor/test/browser/editorService.test.ts](src/vs/workbench/services/editor/test/browser/editorService.test.ts)\n- [src/vs/workbench/services/layout/browser/layoutService.ts](src/vs/workbench/services/layout/browser/layoutService.ts)\n- [src/vs/workbench/test/browser/workbenchTestServices.ts](src/vs/workbench/test/browser/workbenchTestServices.ts)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis document describes the workbench UI infrastructure in VS Code, including the layout system, parts management, editor organization, and service layer. The workbench is the main container that manages all visible UI components, their arrangement, and interactions.\n\nFor information about the editor input and pane lifecycle, see [Editor Input and Pane System](#4.3). For view contributions and registration, see [View System and Contributions](#4.4). For the multi-process architecture and extension host, see [Multi-Process Architecture](#3.3) and [Extension System](#5).\n\n---\n\n## Architecture Overview\n\nThe workbench architecture is organized into several layers:\n\n```mermaid\ngraph TB\n    subgraph \"Workbench Container\"\n        Layout[\"Layout\u003cbr/\u003e(layout.ts)\"]\n    end\n    \n    subgraph \"Parts Layer\"\n        TitleBar[\"TitlebarPart\"]\n        ActivityBar[\"ActivityBarPart\"]\n        SideBar[\"SidebarPart\"]\n        EditorPart[\"EditorPart\"]\n        Panel[\"PanelPart\"]\n        AuxBar[\"AuxiliaryBarPart\"]\n        StatusBar[\"StatusbarPart\"]\n    end\n    \n    subgraph \"Editor Infrastructure\"\n        EditorGroups[\"EditorGroupsService\"]\n        EditorService[\"EditorService\"]\n        Groups[\"EditorGroupView[]\"]\n        Panes[\"EditorPanes\"]\n    end\n    \n    subgraph \"View Infrastructure\"\n        ViewsService[\"IViewsService\"]\n        ViewRegistry[\"ViewsRegistry\"]\n        PaneComposite[\"PaneComposite\"]\n    end\n    \n    subgraph \"Services\"\n        LayoutService[\"IWorkbenchLayoutService\"]\n        InstService[\"IInstantiationService\"]\n        ContextKeys[\"IContextKeyService\"]\n    end\n    \n    Layout --\u003e TitleBar\n    Layout --\u003e ActivityBar\n    Layout --\u003e SideBar\n    Layout --\u003e EditorPart\n    Layout --\u003e Panel\n    Layout --\u003e AuxBar\n    Layout --\u003e StatusBar\n    \n    EditorPart --\u003e EditorGroups\n    EditorPart --\u003e Groups\n    Groups --\u003e Panes\n    EditorService --\u003e EditorGroups\n    \n    SideBar --\u003e PaneComposite\n    Panel --\u003e PaneComposite\n    AuxBar --\u003e PaneComposite\n    PaneComposite --\u003e ViewsService\n    ViewsService --\u003e ViewRegistry\n    \n    Layout -.implements.-\u003e LayoutService\n    LayoutService --\u003e InstService\n    LayoutService --\u003e ContextKeys\n```\n\n**Diagram: Workbench Architecture Layers**\n\nThe workbench is structured as:\n1. **Layout** - Grid-based container managing all parts\n2. **Parts** - Discrete UI areas (titlebar, sidebar, editor, panel, statusbar)\n3. **Editor Infrastructure** - Groups and panes for document editing\n4. **View Infrastructure** - Contributed views in sidebars and panels\n5. **Services** - Dependency injection and cross-cutting concerns\n\nSources: [src/vs/workbench/browser/layout.ts:138-337](), [src/vs/workbench/browser/part.ts](), [src/vs/workbench/services/layout/browser/layoutService.ts:1-100]()\n\n---\n\n## Layout System and Parts\n\n### The Layout Class\n\nThe `Layout` class ([src/vs/workbench/browser/layout.ts:138]()) is the core container that manages the workbench layout. It extends `Disposable` and implements `IWorkbenchLayoutService`.\n\nKey responsibilities:\n- **Grid Management** - Uses `SerializableGrid` to arrange parts\n- **Part Lifecycle** - Creates and manages part instances\n- **State Persistence** - Saves/restores layout configuration\n- **Event Coordination** - Fires events for layout changes\n\n```mermaid\ngraph TB\n    subgraph \"Layout Core\"\n        Layout[\"Layout\"]\n        Grid[\"SerializableGrid\u003cISerializableView\u003e\"]\n        Parts[\"Map\u003cstring, Part\u003e\"]\n    end\n    \n    subgraph \"Views in Grid\"\n        TitleView[\"titleBarPartView\"]\n        BannerView[\"bannerPartView\"]\n        ActivityView[\"activityBarPartView\"]\n        SidebarView[\"sideBarPartView\"]\n        EditorView[\"editorPartView\"]\n        PanelView[\"panelPartView\"]\n        AuxView[\"auxiliaryBarPartView\"]\n        StatusView[\"statusBarPartView\"]\n    end\n    \n    subgraph \"State Management\"\n        StateModel[\"LayoutStateModel\"]\n        Storage[\"IStorageService\"]\n        Config[\"IConfigurationService\"]\n    end\n    \n    Layout --\u003e Grid\n    Layout --\u003e Parts\n    Layout --\u003e StateModel\n    \n    Grid --\u003e TitleView\n    Grid --\u003e BannerView\n    Grid --\u003e ActivityView\n    Grid --\u003e SidebarView\n    Grid --\u003e EditorView\n    Grid --\u003e PanelView\n    Grid --\u003e AuxView\n    Grid --\u003e StatusView\n    \n    StateModel --\u003e Storage\n    StateModel --\u003e Config\n    \n    TitleView -.wraps.-\u003e Parts\n    SidebarView -.wraps.-\u003e Parts\n    EditorView -.wraps.-\u003e Parts\n    PanelView -.wraps.-\u003e Parts\n```\n\n**Diagram: Layout System Structure**\n\nSources: [src/vs/workbench/browser/layout.ts:138-337](), [src/vs/workbench/browser/layout.ts:262-275]()\n\n### Parts Enumeration\n\nThe workbench defines these part identifiers in `Parts` enum:\n\n| Part | ID | Description | Position |\n|------|----|-----------|----|\n| TITLEBAR_PART | `workbench.parts.titlebar` | Window title and menus | Top |\n| BANNER_PART | `workbench.parts.banner` | Notification banner | Above titlebar |\n| ACTIVITYBAR_PART | `workbench.parts.activitybar` | View container icons | Left/right edge |\n| SIDEBAR_PART | `workbench.parts.sidebar` | Primary sidebar | Left/right |\n| AUXILIARYBAR_PART | `workbench.parts.auxiliarybar` | Secondary sidebar | Opposite of sidebar |\n| PANEL_PART | `workbench.parts.panel` | Bottom/side panel | Bottom/right |\n| EDITOR_PART | `workbench.parts.editor` | Main editor area | Center |\n| STATUSBAR_PART | `workbench.parts.statusbar` | Status bar | Bottom |\n\nSources: [src/vs/workbench/services/layout/browser/layoutService.ts:60-119]()\n\n### Grid-Based Layout\n\nThe layout uses `SerializableGrid` from [src/vs/base/browser/ui/grid/grid.ts]() to arrange parts. The grid supports:\n\n**Orientation Modes:**\n- Horizontal (left-to-right)\n- Vertical (top-to-bottom)\n- Mixed (nested grids)\n\n**Dynamic Operations:**\n- `addView()` - Add a new part to the grid\n- `removeView()` - Remove a part from the grid\n- `resizeView()` - Change part dimensions\n- `moveView()` - Reposition parts\n- `setViewVisible()` - Show/hide parts\n\n**Serialization:**\n```typescript\ninterface ISerializedGrid {\n    root: ISerializedNode;\n    orientation: Orientation;\n    width: number;\n    height: number;\n}\n```\n\nThe grid state is serialized to storage for restoration on restart.\n\nSources: [src/vs/workbench/browser/layout.ts:265](), [src/vs/base/browser/ui/grid/grid.ts]()\n\n### Part Base Class\n\nAll parts extend the `Part` base class ([src/vs/workbench/browser/part.ts]()):\n\n```typescript\nabstract class Part extends Themable implements ISerializableView {\n    readonly element: HTMLElement;\n    readonly minimumWidth: number;\n    readonly maximumWidth: number;\n    readonly minimumHeight: number;\n    readonly maximumHeight: number;\n    \n    abstract layout(width: number, height: number): void;\n    abstract toJSON(): object;\n}\n```\n\nEach part:\n- Creates its own DOM structure in `element`\n- Defines size constraints\n- Implements `layout()` for responsive sizing\n- Implements `toJSON()` for state persistence\n- Subscribes to theme changes via `Themable`\n\nSources: [src/vs/workbench/browser/part.ts]()\n\n### Layout State Management\n\nThe `LayoutStateModel` ([src/vs/workbench/browser/layout.ts]()) manages layout state:\n\n**Stored State:**\n- Part visibility (sidebar, panel, auxiliary bar, statusbar)\n- Part positions (sidebar left/right, panel bottom/right)\n- Panel alignment (left, center, right, justify)\n- Editor layout (centered, maximized groups)\n- Zen mode configuration\n\n**State Keys:**\n```typescript\nenum LayoutStateKeys {\n    SIDEBAR_HIDDEN = 'sideBar.hidden',\n    SIDEBAR_POSITON = 'sideBar.position',\n    PANEL_HIDDEN = 'panel.hidden',\n    PANEL_POSITION = 'panel.position',\n    PANEL_ALIGNMENT = 'panel.alignment',\n    MAIN_EDITOR_CENTERED = 'editor.centered',\n    // ... more keys\n}\n```\n\nState is stored in:\n- **Workspace storage** - Layout-specific to the current workspace\n- **Profile storage** - User preferences across workspaces\n\nSources: [src/vs/workbench/browser/layout.ts:633-704]()\n\n---\n\n## Editor Part Architecture\n\n### EditorPart Overview\n\nThe `EditorPart` ([src/vs/workbench/browser/parts/editor/editorPart.ts:91]()) is a specialized part that manages multiple editor groups. It implements both `IEditorPart` and `IEditorGroupsView`.\n\n```mermaid\ngraph TB\n    subgraph \"EditorPart\"\n        EditorPart[\"EditorPart\u003cbr/\u003e(extends Part)\"]\n        GridWidget[\"GridWidgetView\u003cIEditorGroupView\u003e\"]\n        GroupViews[\"Map\u003cGroupIdentifier, IEditorGroupView\u003e\"]\n        Container[\"HTMLElement container\"]\n    end\n    \n    subgraph \"Editor Groups\"\n        Group1[\"EditorGroupView #1\"]\n        Group2[\"EditorGroupView #2\"]\n        Group3[\"EditorGroupView #3\"]\n        \n        Group1Title[\"EditorTitleControl\"]\n        Group1Panes[\"EditorPanes\"]\n        \n        Group1 --\u003e Group1Title\n        Group1 --\u003e Group1Panes\n    end\n    \n    subgraph \"Services\"\n        GroupsService[\"IEditorGroupsService\"]\n        EditorService[\"IEditorService\"]\n        EditorResolverService[\"IEditorResolverService\"]\n    end\n    \n    EditorPart --\u003e GridWidget\n    EditorPart --\u003e GroupViews\n    EditorPart --\u003e Container\n    \n    GridWidget --\u003e Group1\n    GridWidget --\u003e Group2\n    GridWidget --\u003e Group3\n    \n    GroupViews --\u003e Group1\n    GroupViews --\u003e Group2\n    GroupViews --\u003e Group3\n    \n    EditorPart -.implements.-\u003e GroupsService\n    EditorService --\u003e GroupsService\n    EditorService --\u003e EditorResolverService\n```\n\n**Diagram: EditorPart Structure**\n\nSources: [src/vs/workbench/browser/parts/editor/editorPart.ts:91-220]()\n\n### EditorGroupView\n\n`EditorGroupView` ([src/vs/workbench/browser/parts/editor/editorGroupView.ts:62]()) represents a single editor group and manages:\n\n**Components:**\n- `EditorGroupModel` - Data model for editors in the group\n- `EditorTitleControl` - Tabs or title bar rendering\n- `EditorPanes` - Container for active editor panes\n- `EditorDropTarget` - Drag-and-drop handler\n\n**Responsibilities:**\n- Open/close editors\n- Track active editor\n- Manage editor lifecycle\n- Handle tab interactions\n- Fire group events\n\n**Key Methods:**\n```typescript\nclass EditorGroupView {\n    openEditor(editor: EditorInput, options?: IEditorOptions): Promise\u003cIEditorPane\u003e;\n    closeEditor(editor?: EditorInput, options?: ICloseEditorOptions): Promise\u003cvoid\u003e;\n    closeAllEditors(options?: ICloseAllEditorsOptions): Promise\u003cvoid\u003e;\n    moveEditor(editor: EditorInput, target: IEditorGroup, options?: IEditorOptions): void;\n    pinEditor(editor?: EditorInput): void;\n    stickEditor(editor?: EditorInput): void;\n    focus(): void;\n}\n```\n\nSources: [src/vs/workbench/browser/parts/editor/editorGroupView.ts:62-247]()\n\n### Editor Group Model\n\n`EditorGroupModel` ([src/vs/workbench/common/editor/editorGroupModel.ts]()) maintains the state of editors in a group:\n\n**State Tracked:**\n- List of open editors (`EditorInput[]`)\n- Active editor index\n- Preview editor state\n- Pinned/sticky editor flags\n- Editor capabilities\n\n**Events Fired:**\n```typescript\ninterface IGroupModelChangeEvent {\n    readonly kind: GroupModelChangeKind;\n    readonly editor?: EditorInput;\n    readonly editorIndex?: number;\n}\n\nenum GroupModelChangeKind {\n    EDITOR_OPEN,\n    EDITOR_CLOSE,\n    EDITOR_ACTIVE,\n    EDITOR_PIN,\n    EDITOR_STICKY,\n    EDITOR_LABEL,\n    // ...\n}\n```\n\nSources: [src/vs/workbench/common/editor/editorGroupModel.ts]()\n\n### Editor Panes\n\n`EditorPanes` ([src/vs/workbench/browser/parts/editor/editorPanes.ts]()) manages the container for active editor panes:\n\n**Responsibilities:**\n- Show/hide editor panes based on active editor\n- Manage pane lifecycle (create, dispose)\n- Handle pane transitions\n- Track visible pane\n\n**Pane Lifecycle:**\n1. Editor opens  Resolve `EditorInput` to `EditorPane` descriptor\n2. Create pane instance if not cached\n3. Call `pane.setInput()` with the editor input\n4. Show pane in container\n5. Layout pane to available space\n\nThe pane registry maps editor types to pane implementations:\n```typescript\nRegistry.as\u003cIEditorPaneRegistry\u003e(EditorExtensions.EditorPane)\n    .registerEditorPane(\n        EditorPaneDescriptor.create(\n            TextResourceEditor,\n            TextResourceEditor.ID,\n            \"Text Editor\"\n        ),\n        [new SyncDescriptor(TextResourceEditorInput)]\n    );\n```\n\nSources: [src/vs/workbench/browser/parts/editor/editorPanes.ts](), [src/vs/workbench/browser/parts/editor/editor.contribution.ts:79-89]()\n\n### Multi-Window Support\n\nThe workbench supports opening editors in auxiliary windows through `IAuxiliaryEditorPart`:\n\n**Auxiliary Windows:**\n- Created via `AuxiliaryWindowService`\n- Each window has its own `EditorPart` instance\n- Editors can be dragged between windows\n- Share services with main window\n\n**Key Configuration:**\n```typescript\ninterface IAuxiliaryWindowOpenOptions {\n    readonly bounds?: Partial\u003cIRectangle\u003e;\n    readonly auxiliaryEditorPart?: IAuxiliaryEditorPart;\n}\n```\n\nSources: [src/vs/workbench/browser/parts/editor/editor.ts:1-50](), [src/vs/workbench/services/auxiliaryWindow/browser/auxiliaryWindowService.ts]()\n\n---\n\n## Editor Groups Service\n\nThe `IEditorGroupsService` ([src/vs/workbench/services/editor/common/editorGroupsService.ts:21]()) is the main API for managing editor groups:\n\n```mermaid\ngraph LR\n    subgraph \"Service API\"\n        GroupsService[\"IEditorGroupsService\"]\n        MainPart[\"mainPart: IEditorPart\"]\n        ActiveGroup[\"activeGroup: IEditorGroup\"]\n        Groups[\"groups: IEditorGroup[]\"]\n    end\n    \n    subgraph \"Operations\"\n        AddGroup[\"addGroup(location, direction)\"]\n        RemoveGroup[\"removeGroup(group)\"]\n        MoveGroup[\"moveGroup(group, location, direction)\"]\n        MergeGroup[\"mergeGroup(source, target)\"]\n        CopyGroup[\"copyGroup(source, target)\"]\n    end\n    \n    subgraph \"Layouts\"\n        Arrangement[\"arrangeGroups(arrangement)\"]\n        ToggleMaximize[\"toggleMaximizeGroup()\"]\n        ApplyLayout[\"applyLayout(layout)\"]\n    end\n    \n    GroupsService --\u003e MainPart\n    GroupsService --\u003e ActiveGroup\n    GroupsService --\u003e Groups\n    \n    GroupsService --\u003e AddGroup\n    GroupsService --\u003e RemoveGroup\n    GroupsService --\u003e MoveGroup\n    GroupsService --\u003e MergeGroup\n    GroupsService --\u003e CopyGroup\n    \n    GroupsService --\u003e Arrangement\n    GroupsService --\u003e ToggleMaximize\n    GroupsService --\u003e ApplyLayout\n```\n\n**Diagram: IEditorGroupsService API Surface**\n\n### Group Management Operations\n\n**Adding Groups:**\n```typescript\naddGroup(\n    location: IEditorGroup | GroupIdentifier | GroupLocation,\n    direction: GroupDirection,\n    options?: IAddGroupOptions\n): IEditorGroup;\n```\n\nDirection options: `UP`, `DOWN`, `LEFT`, `RIGHT`\n\n**Removing Groups:**\n```typescript\nremoveGroup(group: IEditorGroup | GroupIdentifier): void;\n```\nIf the group has editors, prompts for save/discard.\n\n**Moving Groups:**\n```typescript\nmoveGroup(\n    group: IEditorGroup | GroupIdentifier,\n    location: IEditorGroup | GroupIdentifier | GroupLocation,\n    direction: GroupDirection\n): IEditorGroup;\n```\n\n**Merging Groups:**\n```typescript\nmergeGroup(\n    source: IEditorGroup | GroupIdentifier,\n    target: IEditorGroup | GroupIdentifier,\n    options?: IMergeGroupOptions\n): IEditorGroup;\n\ninterface IMergeGroupOptions {\n    mode?: MergeGroupMode; // COPY_EDITORS, MOVE_EDITORS\n    index?: number; // target index for editors\n}\n```\n\nSources: [src/vs/workbench/services/editor/common/editorGroupsService.ts:200-350]()\n\n### Group Arrangements\n\nPredefined arrangements:\n\n| Arrangement | Description |\n|------------|-------------|\n| `MAXIMIZE` | Active group fills entire editor area |\n| `EXPAND` | Active group expands to maximum space |\n| `EVEN` | All groups sized equally |\n\n**Layout Templates:**\n```typescript\nenum EditorGroupLayout {\n    SINGLE,           // One group\n    TWO_COLUMNS,      // Side by side\n    THREE_COLUMNS,    // Three columns\n    TWO_ROWS,         // Stacked\n    THREE_ROWS,       // Three rows\n    TWO_BY_TWO_GRID,  // 2x2 grid\n}\n```\n\nSources: [src/vs/workbench/services/editor/common/editorGroupsService.ts:47-116]()\n\n### Group Navigation\n\n**Finding Groups:**\n```typescript\nfindGroup(\n    scope: IFindGroupScope,\n    source?: IEditorGroup | GroupIdentifier,\n    wrap?: boolean\n): IEditorGroup | undefined;\n\ninterface IFindGroupScope {\n    direction?: GroupDirection;\n    location?: GroupLocation;\n}\n```\n\n**Groups Order:**\n```typescript\ngetGroups(order: GroupsOrder): readonly IEditorGroup[];\n\nenum GroupsOrder {\n    CREATION_TIME,          // Order created\n    MOST_RECENTLY_ACTIVE,   // By last activation\n    GRID_APPEARANCE,        // Visual left-to-right, top-to-bottom\n}\n```\n\nSources: [src/vs/workbench/services/editor/common/editorGroupsService.ts:250-300]()\n\n---\n\n## Editor Service\n\nThe `IEditorService` ([src/vs/workbench/services/editor/common/editorService.ts:17]()) provides high-level editor operations:\n\n```mermaid\ngraph TB\n    subgraph \"EditorService API\"\n        EditorService[\"IEditorService\"]\n        ActiveEditor[\"activeEditor: EditorInput\"]\n        ActivePane[\"activeEditorPane: IEditorPane\"]\n        VisiblePanes[\"visibleEditorPanes: IEditorPane[]\"]\n        Editors[\"editors: EditorInput[]\"]\n    end\n    \n    subgraph \"Open Operations\"\n        OpenEditor[\"openEditor(editor, group)\"]\n        OpenEditors[\"openEditors(editors[])\"]\n        ReplaceEditors[\"replaceEditors(replacements[])\"]\n    end\n    \n    subgraph \"Close Operations\"\n        CloseEditor[\"closeEditor(editor, group)\"]\n        CloseEditors[\"closeEditors(editors[])\"]\n    end\n    \n    subgraph \"Save Operations\"\n        Save[\"save(editor)\"]\n        SaveAll[\"saveAll()\"]\n        Revert[\"revert(editor)\"]\n        RevertAll[\"revertAll()\"]\n    end\n    \n    subgraph \"Events\"\n        OnActiveChange[\"onDidActiveEditorChange\"]\n        OnVisibleChange[\"onDidVisibleEditorsChange\"]\n        OnClose[\"onDidCloseEditor\"]\n        OnOpen[\"onWillOpenEditor\"]\n    end\n    \n    EditorService --\u003e ActiveEditor\n    EditorService --\u003e ActivePane\n    EditorService --\u003e VisiblePanes\n    EditorService --\u003e Editors\n    \n    EditorService --\u003e OpenEditor\n    EditorService --\u003e OpenEditors\n    EditorService --\u003e ReplaceEditors\n    \n    EditorService --\u003e CloseEditor\n    EditorService --\u003e CloseEditors\n    \n    EditorService --\u003e Save\n    EditorService --\u003e SaveAll\n    EditorService --\u003e Revert\n    EditorService --\u003e RevertAll\n    \n    EditorService --\u003e OnActiveChange\n    EditorService --\u003e OnVisibleChange\n    EditorService --\u003e OnClose\n    EditorService --\u003e OnOpen\n```\n\n**Diagram: IEditorService API Surface**\n\n### Opening Editors\n\n**Basic Open:**\n```typescript\nopenEditor(\n    editor: EditorInput | IUntypedEditorInput,\n    options?: IEditorOptions,\n    group?: PreferredGroup\n): Promise\u003cIEditorPane | undefined\u003e;\n```\n\n**PreferredGroup Options:**\n- `ACTIVE_GROUP` (-1) - Open in active group\n- `SIDE_GROUP` (-2) - Open to side of active group\n- `AUX_WINDOW_GROUP` (-3) - Open in auxiliary window\n- `IEditorGroup` - Specific group instance\n- `GroupIdentifier` - Group ID\n\n**Opening Multiple Editors:**\n```typescript\nopenEditors(\n    editors: EditorInputWithOptions[],\n    group?: PreferredGroup,\n    options?: IOpenEditorsOptions\n): Promise\u003cIEditorPane[]\u003e;\n\ninterface IOpenEditorsOptions {\n    readonly validateTrust?: boolean;\n    readonly context?: EditorOpenContext;\n}\n```\n\nSources: [src/vs/workbench/services/editor/common/editorService.ts:100-180](), [src/vs/workbench/services/editor/browser/editorService.ts:600-700]()\n\n### Editor Resolution\n\nThe `IEditorResolverService` handles mapping editor inputs to panes:\n\n**Resolution Flow:**\n1. Check for explicit editor ID in options\n2. Query registered editor resolvers (from extensions)\n3. Fall back to built-in editor registry\n4. Create `EditorInput` and `EditorPane`\n\n**Custom Editors:**\nExtensions can register custom editors via:\n```typescript\nvscode.window.registerCustomEditorProvider(\n    viewType: string,\n    provider: CustomTextEditorProvider\n);\n```\n\nSources: [src/vs/workbench/services/editor/common/editorResolverService.ts](), [src/vs/workbench/services/editor/browser/editorResolverService.ts]()\n\n### File Event Handling\n\nThe `EditorService` watches for file operations and updates editors:\n\n**Move/Rename Handling:**\n- Calls `editor.rename(groupId, targetResource)` on affected editors\n- Replaces editor with updated resource\n- Preserves pin/sticky state and position\n\n**Delete Handling:**\n- Closes editors for deleted files (if `closeOnFileDelete: true`)\n- Prompts to save dirty editors before closing\n- Handles delete from within vs outside VS Code differently\n\nSources: [src/vs/workbench/services/editor/browser/editorService.ts:236-317]()\n\n---\n\n## Context Key System\n\nThe workbench uses context keys to manage reactive UI state. Context keys are defined in [src/vs/workbench/common/contextkeys.ts]() and drive:\n- Menu item visibility\n- Command enablement\n- Keybinding activation\n- UI element rendering\n\n```mermaid\ngraph TB\n    subgraph \"Context Key Infrastructure\"\n        ContextKeyService[\"IContextKeyService\"]\n        ScopedService[\"ScopedContextKeyService\"]\n        ContextKeyValue[\"IContextKey\u003cT\u003e\"]\n    end\n    \n    subgraph \"Workbench Context Keys\"\n        WorkbenchState[\"WorkbenchStateContext\"]\n        SidebarVisible[\"SideBarVisibleContext\"]\n        PanelVisible[\"PanelVisibleContext\"]\n        EditorArea[\"MainEditorAreaVisibleContext\"]\n        Fullscreen[\"IsMainWindowFullscreenContext\"]\n        ZenMode[\"InEditorZenModeContext\"]\n    end\n    \n    subgraph \"Editor Context Keys\"\n        ActiveEditor[\"ActiveEditorContext\"]\n        EditorDirty[\"ActiveEditorDirtyContext\"]\n        EditorPinned[\"ActiveEditorPinnedContext\"]\n        EditorSticky[\"ActiveEditorStickyContext\"]\n        EditorGroupEmpty[\"ActiveEditorGroupEmptyContext\"]\n        EditorGroupLocked[\"ActiveEditorGroupLockedContext\"]\n        MultipleGroups[\"MultipleEditorGroupsContext\"]\n    end\n    \n    subgraph \"Consumers\"\n        MenuService[\"MenuService\"]\n        KeybindingService[\"KeybindingService\"]\n        CommandService[\"CommandService\"]\n    end\n    \n    ContextKeyService --\u003e ScopedService\n    ScopedService --\u003e ContextKeyValue\n    \n    ContextKeyValue --\u003e WorkbenchState\n    ContextKeyValue --\u003e SidebarVisible\n    ContextKeyValue --\u003e PanelVisible\n    ContextKeyValue --\u003e EditorArea\n    ContextKeyValue --\u003e Fullscreen\n    ContextKeyValue --\u003e ZenMode\n    \n    ContextKeyValue --\u003e ActiveEditor\n    ContextKeyValue --\u003e EditorDirty\n    ContextKeyValue --\u003e EditorPinned\n    ContextKeyValue --\u003e EditorSticky\n    ContextKeyValue --\u003e EditorGroupEmpty\n    ContextKeyValue --\u003e EditorGroupLocked\n    ContextKeyValue --\u003e MultipleGroups\n    \n    ContextKeyValue --\u003e MenuService\n    ContextKeyValue --\u003e KeybindingService\n    ContextKeyValue --\u003e CommandService\n```\n\n**Diagram: Context Key System**\n\n### Common Context Keys\n\n**Layout Context Keys:**\n\n| Context Key | Type | Description |\n|------------|------|-------------|\n| `sideBarVisible` | boolean | Primary sidebar visible |\n| `auxiliaryBarVisible` | boolean | Secondary sidebar visible |\n| `panelVisible` | boolean | Panel visible |\n| `mainEditorAreaVisible` | boolean | Editor area not maximized away |\n| `isMainWindowFullscreen` | boolean | Main window in fullscreen |\n| `inZenMode` | boolean | Zen mode active |\n| `isCenteredLayout` | boolean | Editor centered layout |\n| `panelPosition` | string | Panel position (bottom/right) |\n| `panelAlignment` | string | Panel alignment when bottom |\n\n**Editor Context Keys:**\n\n| Context Key | Type | Description |\n|------------|------|-------------|\n| `activeEditor` | string | Active editor pane ID |\n| `activeEditorIsDirty` | boolean | Active editor has unsaved changes |\n| `activeEditorIsPinned` | boolean | Active editor is pinned |\n| `activeEditorIsSticky` | boolean | Active editor is sticky |\n| `activeEditorGroupEmpty` | boolean | Active group has no editors |\n| `activeEditorGroupLocked` | boolean | Active group is locked |\n| `multipleEditorGroups` | boolean | More than one group exists |\n| `editorTabsVisible` | boolean | Editor tabs are visible |\n\nSources: [src/vs/workbench/common/contextkeys.ts:1-250]()\n\n### Scoped Context Keys\n\nEach UI component can create a scoped context key service:\n\n```typescript\nclass EditorGroupView {\n    readonly scopedContextKeyService: IContextKeyService;\n    \n    constructor(\n        @IContextKeyService contextKeyService: IContextKeyService\n    ) {\n        // Create scoped service for this group\n        this.scopedContextKeyService = contextKeyService.createScoped(this.element);\n        \n        // Bind context keys\n        this.activeEditorDirty = ActiveEditorDirtyContext.bindTo(this.scopedContextKeyService);\n        this.activeEditorPinned = ActiveEditorPinnedContext.bindTo(this.scopedContextKeyService);\n    }\n    \n    private updateContextKeys(): void {\n        this.activeEditorDirty.set(this.activeEditor?.isDirty() ?? false);\n        this.activeEditorPinned.set(this.activeEditor?.isPinned() ?? false);\n    }\n}\n```\n\nScoped services allow context keys to vary by DOM element scope, enabling context menus and keybindings to work differently in different parts of the UI.\n\nSources: [src/vs/workbench/browser/parts/editor/editorGroupView.ts:249-319]()\n\n### Context Key Expressions\n\nContext keys are combined using expressions:\n\n```typescript\n// Simple key\nwhen: 'sideBarVisible'\n\n// Negation\nwhen: '!sideBarVisible'\n\n// AND\nwhen: 'sideBarVisible \u0026\u0026 !panelVisible'\n\n// OR\nwhen: 'sideBarVisible || auxiliaryBarVisible'\n\n// Equality\nwhen: 'activeEditor == workbench.editors.textDiffEditor'\n\n// Regex\nwhen: 'resourceExtname =~ /\\\\.(ts|js)$/'\n```\n\nThese expressions are used in:\n- `MenuRegistry` - Control menu item visibility\n- `KeybindingsRegistry` - Control keybinding activation\n- `CommandsRegistry` - Control command availability\n\nSources: [src/vs/platform/contextkey/common/contextkey.ts]()\n\n---\n\n## View System and Containers\n\nThe workbench allows extensions and built-in features to contribute views to sidebars and panels through the view system.\n\n```mermaid\ngraph TB\n    subgraph \"View Registry\"\n        ViewsRegistry[\"ViewsRegistry\"]\n        ViewDescriptor[\"IViewDescriptor[]\"]\n        ViewContainer[\"ViewContainer\"]\n    end\n    \n    subgraph \"View Locations\"\n        Sidebar[\"ViewContainerLocation.Sidebar\"]\n        Panel[\"ViewContainerLocation.Panel\"]\n        AuxiliaryBar[\"ViewContainerLocation.AuxiliaryBar\"]\n    end\n    \n    subgraph \"Services\"\n        ViewsService[\"IViewsService\"]\n        ViewDescriptorService[\"IViewDescriptorService\"]\n        PaneCompositeService[\"IPaneCompositePartService\"]\n    end\n    \n    subgraph \"UI Components\"\n        ViewPaneContainer[\"ViewPaneContainer\"]\n        ViewPane[\"ViewPane[]\"]\n        TreeView[\"TreeView\"]\n        WebView[\"WebView\"]\n    end\n    \n    ViewsRegistry --\u003e ViewDescriptor\n    ViewDescriptor --\u003e ViewContainer\n    ViewContainer --\u003e Sidebar\n    ViewContainer --\u003e Panel\n    ViewContainer --\u003e AuxiliaryBar\n    \n    ViewsService --\u003e ViewDescriptor\n    ViewDescriptorService --\u003e ViewContainer\n    PaneCompositeService --\u003e ViewPaneContainer\n    \n    ViewPaneContainer --\u003e ViewPane\n    ViewPane --\u003e TreeView\n    ViewPane --\u003e WebView\n```\n\n**Diagram: View System Architecture**\n\n### View Descriptors\n\nViews are registered through descriptors:\n\n```typescript\ninterface IViewDescriptor {\n    readonly id: string;                    // Unique view ID\n    readonly name: string;                  // Display name\n    readonly containerIcon?: ThemeIcon;     // Container icon\n    readonly when?: ContextKeyExpression;   // Visibility condition\n    readonly order?: number;                // Sort order\n    readonly weight?: number;               // Initial size weight\n    readonly collapsed?: boolean;           // Initially collapsed\n    readonly canToggleVisibility?: boolean; // User can hide\n    readonly hideByDefault?: boolean;       // Hidden by default\n}\n```\n\n### View Containers\n\nViews are grouped into containers:\n\n```typescript\ninterface ViewContainer {\n    readonly id: string;                           // Container ID\n    readonly title: string;                        // Container title\n    readonly icon?: ThemeIcon;                     // Icon in activity bar\n    readonly order?: number;                       // Position in activity bar\n    readonly ctorDescriptor: SyncDescriptor;       // Container constructor\n    readonly storageId?: string;                   // Storage key\n    readonly hideIfEmpty?: boolean;                // Auto-hide when empty\n}\n```\n\n**Default Containers:**\n- Explorer - File tree, outline, timeline\n- SCM - Source control providers\n- Debug - Debug sessions and variables\n- Extensions - Extension list\n\nSources: [src/vs/workbench/common/views.ts:100-250]()\n\n### View Panes\n\nIndividual views are implemented as `ViewPane`:\n\n```typescript\nabstract class ViewPane extends Pane {\n    abstract renderBody(container: HTMLElement): void;\n    abstract layoutBody(height: number, width: number): void;\n    abstract focus(): void;\n    \n    protected abstract renderHeader(container: HTMLElement): void;\n    protected abstract renderContent(container: HTMLElement): void;\n}\n```\n\nCommon view pane types:\n- `TreeView` - Hierarchical tree\n- `ListView` - Flat list\n- `WebView` - Custom HTML content\n- `EditorPane` - Embedded editor\n\nSources: [src/vs/workbench/browser/parts/views/viewPane.ts]()\n\n### PaneComposite System\n\nThe `IPaneCompositePartService` manages view containers in sidebars and panels:\n\n**Operations:**\n```typescript\nopenPaneComposite(id: string, viewContainerLocation: ViewContainerLocation): Promise\u003cIPaneComposite\u003e;\ngetActivePaneComposite(viewContainerLocation: ViewContainerLocation): IPaneComposite | undefined;\ngetPaneComposite(id: string, viewContainerLocation: ViewContainerLocation): IPaneCompositeDescriptor;\ngetPaneComposites(viewContainerLocation: ViewContainerLocation): IPaneCompositeDescriptor[];\n```\n\nSources: [src/vs/workbench/services/panecomposite/browser/panecomposite.ts]()\n\n---\n\n## Drag and Drop Infrastructure\n\nThe workbench provides a comprehensive drag-and-drop system for moving editors, files, and UI elements.\n\n```mermaid\ngraph TB\n    subgraph \"DND Core\"\n        DragAndDropObserver[\"DragAndDropObserver\"]\n        DataTransfers[\"DataTransfers\"]\n        LocalSelectionTransfer[\"LocalSelectionTransfer\"]\n    end\n    \n    subgraph \"Editor DND\"\n        EditorDropTarget[\"EditorDropTarget\"]\n        DraggedEditorIdentifier[\"DraggedEditorIdentifier\"]\n        DraggedEditorGroupIdentifier[\"DraggedEditorGroupIdentifier\"]\n    end\n    \n    subgraph \"Resource DND\"\n        ResourcesDropHandler[\"ResourcesDropHandler\"]\n        ExtractEditorsDropData[\"extractEditorsAndFilesDropData()\"]\n        DraggedResourceEditorInput[\"IDraggedResourceEditorInput\"]\n    end\n    \n    subgraph \"Composite DND\"\n        CompositeDragAndDropObserver[\"CompositeDragAndDropObserver\"]\n        ViewletDND[\"Viewlet DND\"]\n        PanelDND[\"Panel DND\"]\n    end\n    \n    subgraph \"Contributions\"\n        DragAndDropRegistry[\"IDragAndDropContributionRegistry\"]\n        CustomHandlers[\"Custom Drop Handlers\"]\n    end\n    \n    DragAndDropObserver --\u003e DataTransfers\n    DataTransfers --\u003e LocalSelectionTransfer\n    \n    EditorDropTarget --\u003e DraggedEditorIdentifier\n    EditorDropTarget --\u003e DraggedEditorGroupIdentifier\n    EditorDropTarget --\u003e ResourcesDropHandler\n    \n    ResourcesDropHandler --\u003e ExtractEditorsDropData\n    ExtractEditorsDropData --\u003e DraggedResourceEditorInput\n    \n    CompositeDragAndDropObserver --\u003e ViewletDND\n    CompositeDragAndDropObserver --\u003e PanelDND\n    \n    DragAndDropRegistry --\u003e CustomHandlers\n    ResourcesDropHandler --\u003e DragAndDropRegistry\n```\n\n**Diagram: Drag and Drop System**\n\n### Editor Drop Targets\n\n`EditorDropTarget` ([src/vs/workbench/browser/parts/editor/editorDropTarget.ts]()) handles dropping into editor groups:\n\n**Drop Zones:**\n- `CENTER` - Replace active editor\n- `LEFT` - Create group to left\n- `RIGHT` - Create group to right\n- `UP` - Create group above\n- `DOWN` - Create group below\n\n**Overlay Display:**\nThe drop target shows an overlay with visual feedback:\n```typescript\ninterface IEditorDropTargetDelegate {\n    groupContainsPredicate?(group: IEditorGroup): boolean;\n}\n```\n\n**Drop Operations:**\n1. Parse drag data (files, editors, external)\n2. Determine drop zone from mouse position\n3. Create/find target group\n4. Open editors in target group\n5. Optionally close source editors (move vs copy)\n\nSources: [src/vs/workbench/browser/parts/editor/editorDropTarget.ts:1-600]()\n\n### Resource Drop Handler\n\n`ResourcesDropHandler` ([src/vs/workbench/browser/dnd.ts:86]()) processes dropped resources:\n\n**Handled Resources:**\n- Local files from explorer\n- Workspace files from tree views\n- External files from OS\n- URLs from browser\n- Editor inputs from other groups\n\n**Workspace Detection:**\nDropped folders and `.code-workspace` files can:\n- Open as new workspace\n- Add to multi-root workspace\n- Open in new window\n\n**Configuration:**\n```typescript\ninterface IResourcesDropHandlerOptions {\n    allowWorkspaceOpen: boolean;\n}\n```\n\nSources: [src/vs/workbench/browser/dnd.ts:86-250]()\n\n### Local Selection Transfer\n\n`LocalSelectionTransfer` enables in-app drag-and-drop:\n\n```typescript\nclass LocalSelectionTransfer\u003cT\u003e {\n    private static INSTANCE: LocalSelectionTransfer\u003cany\u003e;\n    private data?: T[];\n    \n    static getInstance\u003cT\u003e(): LocalSelectionTransfer\u003cT\u003e;\n    \n    hasData(proto: T): boolean;\n    getData(proto: T): T[] | undefined;\n    setData(data: T[], proto: T): void;\n    clearData(proto: T): void;\n}\n```\n\nUsed for:\n- Moving editors between groups\n- Reordering tabs\n- Moving view panes\n- Dragging tree items\n\nSources: [src/vs/platform/dnd/browser/dnd.ts]()\n\n---\n\n## Configuration and Options\n\n### Editor Part Options\n\nEditor part behavior is configured through `IEditorPartOptions` ([src/vs/workbench/browser/parts/editor/editor.ts:31-60]()):\n\n| Option | Type | Default | Description |\n|--------|------|---------|-------------|\n| `showTabs` | `'multiple' \\| 'single' \\| 'none'` | `'multiple'` | Tab display mode |\n| `tabSizing` | `'fit' \\| 'shrink' \\| 'fixed'` | `'fit'` | Tab width behavior |\n| `pinnedTabSizing` | `'normal' \\| 'compact' \\| 'shrink'` | `'normal'` | Pinned tab sizing |\n| `pinnedTabsOnSeparateRow` | `boolean` | `false` | Pinned tabs on separate row |\n| `wrapTabs` | `boolean` | `false` | Wrap tabs to multiple rows |\n| `enablePreview` | `boolean` | `true` | Enable preview editors |\n| `openPositioning` | `'left' \\| 'right' \\| 'first' \\| 'last'` | `'right'` | Where to open new editors |\n| `openSideBySideDirection` | `'right' \\| 'down'` | `'right'` | Split direction |\n| `closeEmptyGroups` | `boolean` | `true` | Auto-close empty groups |\n| `labelFormat` | `'default' \\| 'short' \\| 'medium' \\| 'long'` | `'default'` | Editor label format |\n| `splitSizing` | `'auto' \\| 'distribute' \\| 'split'` | `'auto'` | Split group sizing |\n\n**Derived Options:**\n```typescript\nfunction getEditorPartOptions(configurationService: IConfigurationService): IEditorPartOptions {\n    const config = configurationService.getValue\u003cIWorkbenchEditorConfiguration\u003e();\n    \n    return {\n        showTabs: config.workbench?.editor?.showTabs ?? 'multiple',\n        tabSizing: config.workbench?.editor?.tabSizing ?? 'fit',\n        // ... more options\n    };\n}\n```\n\nSources: [src/vs/workbench/browser/parts/editor/editor.ts:31-90]()\n\n### Layout Configuration\n\nLayout behavior is configured through settings:\n\n```typescript\ninterface LayoutSettings {\n    ACTIVITY_BAR_LOCATION = 'workbench.activityBar.location';\n    SIDEBAR_POSITION = 'workbench.sideBar.location';\n    PANEL_POSITION = 'workbench.panel.defaultLocation';\n    PANEL_ALIGNMENT = 'workbench.panel.alignment';\n    COMMAND_CENTER = 'workbench.commandCenter';\n    LAYOUT_ACTIONS = 'workbench.layoutControl.enabled';\n    EDITOR_ACTIONS_LOCATION = 'workbench.editor.editorActionsLocation';\n    ZEN_MODE_CONFIG = 'zenMode.*';\n}\n```\n\n**Zen Mode Configuration:**\n```typescript\ninterface ZenModeSettings {\n    centerLayout: boolean;\n    fullScreen: boolean;\n    hideActivityBar: boolean;\n    hideLineNumbers: boolean;\n    hideStatusBar: boolean;\n    hideEditorTabs: boolean;\n    restore: boolean;\n    silentNotifications: boolean;\n}\n```\n\nSources: [src/vs/workbench/services/layout/browser/layoutService.ts:125-200]()\n\n---\n\n## Event Flow and Coordination\n\nThe workbench coordinates events between services and components:\n\n```mermaid\nsequenceDiagram\n    participant User\n    participant EditorGroup\n    participant EditorService\n    participant LayoutService\n    participant ContextKeys\n    participant MenuService\n    \n    User-\u003e\u003eEditorGroup: Click tab\n    EditorGroup-\u003e\u003eEditorGroup: setActive(editor)\n    EditorGroup-\u003e\u003eEditorService: _onDidActiveEditorChange.fire()\n    EditorService-\u003e\u003eContextKeys: Update activeEditor context\n    ContextKeys-\u003e\u003eMenuService: Rebuild menus\n    MenuService-\u003e\u003eUser: Update visible commands\n    \n    User-\u003e\u003eLayoutService: Toggle sidebar\n    LayoutService-\u003e\u003eLayoutService: setPanelVisible(false)\n    LayoutService-\u003e\u003eLayoutService: layout()\n    LayoutService-\u003e\u003eContextKeys: Update sideBarVisible\n    LayoutService-\u003e\u003eEditorService: _onDidLayoutActiveContainer.fire()\n    EditorService-\u003e\u003eEditorGroup: relayout editors\n```\n\n**Diagram: Event Coordination Flow**\n\n### Key Event Patterns\n\n**Editor Events:**\n```typescript\ninterface IEditorService {\n    onDidActiveEditorChange: Event\u003cvoid\u003e;\n    onDidVisibleEditorsChange: Event\u003cvoid\u003e;\n    onDidCloseEditor: Event\u003cIEditorCloseEvent\u003e;\n    onWillOpenEditor: Event\u003cIEditorWillOpenEvent\u003e;\n    onDidOpenEditorFail: Event\u003cIEditorIdentifier\u003e;\n}\n```\n\n**Layout Events:**\n```typescript\ninterface IWorkbenchLayoutService {\n    onDidChangePartVisibility: Event\u003cvoid\u003e;\n    onDidChangePanelPosition: Event\u003cstring\u003e;\n    onDidChangeWindowMaximized: Event\u003c{ windowId: number; maximized: boolean }\u003e;\n    onDidLayoutMainContainer: Event\u003cIDimension\u003e;\n    onDidLayoutActiveContainer: Event\u003cIDimension\u003e;\n}\n```\n\n**Group Events:**\n```typescript\ninterface IEditorGroupsService {\n    onDidAddGroup: Event\u003cIEditorGroup\u003e;\n    onDidRemoveGroup: Event\u003cIEditorGroup\u003e;\n    onDidMoveGroup: Event\u003cIEditorGroup\u003e;\n    onDidChangeActiveGroup: Event\u003cIEditorGroup\u003e;\n    onDidChangeGroupMaximized: Event\u003cboolean\u003e;\n}\n```\n\nSources: [src/vs/workbench/services/editor/common/editorService.ts:40-70](), [src/vs/workbench/services/layout/browser/layoutService.ts:300-350]()\n\n### Relay Pattern\n\nThe workbench uses the `Relay` pattern to forward events:\n\n```typescript\nclass Layout {\n    private readonly _onDidChangeSizeConstraints = new Relay\u003c{ width: number; height: number }\u003e();\n    readonly onDidChangeSizeConstraints = Event.any(\n        this.onDidSetGridWidget.event,\n        this._onDidChangeSizeConstraints.event\n    );\n    \n    createPart(part: Part): void {\n        this._onDidChangeSizeConstraints.input = part.onDidChangeSizeConstraints;\n    }\n}\n```\n\nThis allows dynamically switching which underlying event source is relayed to consumers.\n\nSources: [src/vs/workbench/browser/parts/editor/editorPart.ts:133]()\n\n---\n\n## Initialization and Lifecycle\n\n### Workbench Bootstrap\n\nThe workbench initializes through these phases ([src/vs/workbench/browser/workbench.ts:54-200]()):\n\n**Phase 1: DOM Setup**\n```typescript\nclass Workbench {\n    startup(): IInstantiationService {\n        // Create main container\n        this.parent.classList.add('monaco-workbench');\n        \n        // Register services\n        const services = this.initServices();\n        const instantiationService = new InstantiationService(services);\n        \n        // Create layout\n        this.layout = instantiationService.createInstance(Layout, this.parent);\n        \n        return instantiationService;\n    }\n}\n```\n\n**Phase 2: Layout Creation**\n```typescript\nclass Layout {\n    create(): void {\n        // Create grid container\n        this.container = $('.content');\n        this.parent.appendChild(this.container);\n        \n        // Create parts\n        this.createParts();\n        \n        // Build grid\n        this.workbenchGrid = new SerializableGrid(/* ... */);\n        \n        // Restore state\n        this.restoreState();\n    }\n}\n```\n\n**Phase 3: Parts Initialization**\nEach part creates its DOM:\n```typescript\nclass EditorPart extends Part {\n    create(parent: HTMLElement): void {\n        // Create container\n        this.container.classList.add('part', 'editor');\n        parent.appendChild(this.container);\n        \n        // Create groups\n        this.restoreGroups();\n        \n        // Setup DND\n        this.registerDragAndDrop();\n    }\n}\n```\n\n**Phase 4: Editor Restoration**\n```typescript\nclass EditorPart {\n    private async restoreEditors(): Promise\u003cvoid\u003e {\n        // Load serialized state\n        const state = this.loadState();\n        \n        // Restore groups\n        for (const group of state.groups) {\n            await this.restoreGroup(group);\n        }\n        \n        // Set active group\n        this.setActiveGroup(state.activeGroup);\n    }\n}\n```\n\nSources: [src/vs/workbench/browser/workbench.ts:100-350](), [src/vs/workbench/browser/layout.ts:700-900]()\n\n### State Persistence\n\n**Storage Scopes:**\n- `StorageScope.WORKSPACE` - Per workspace\n- `StorageScope.PROFILE` - Per user profile\n- `StorageScope.APPLICATION` - Global\n\n**Layout State:**\n```typescript\ninterface IEditorPartUIState {\n    serializedGrid: ISerializedGrid;\n    activeGroup: GroupIdentifier;\n    mostRecentActiveGroups: GroupIdentifier[];\n}\n```\n\n**Serialization:**\n```typescript\nclass EditorPart {\n    private saveState(): void {\n        const state: IEditorPartUIState = {\n            serializedGrid: this.gridWidget.serialize(),\n            activeGroup: this.activeGroup.id,\n            mostRecentActiveGroups: this.mostRecentActiveGroups.slice(0, 10)\n        };\n        \n        this.storageService.store(\n            'editorpart.state',\n            JSON.stringify(state),\n            StorageScope.WORKSPACE,\n            StorageTarget.USER\n        );\n    }\n}\n```\n\nSources: [src/vs/workbench/browser/parts/editor/editorPart.ts:900-1000]()\n\n---\n\n## Summary\n\nThe Workbench Architecture provides:\n\n1. **Grid-Based Layout** - Flexible arrangement of UI parts using `SerializableGrid`\n2. **Part System** - Modular UI components (titlebar, sidebar, editor, panel, statusbar)\n3. **Editor Infrastructure** - Groups and panes for document editing with multi-window support\n4. **View System** - Extensible views in sidebars and panels\n5. **Service Layer** - Dependency injection for clean separation of concerns\n6. **Context Keys** - Reactive state management for UI behavior\n7. **Event Coordination** - Centralized event handling across components\n8. **State Persistence** - Save/restore layout and editor state\n\nThe architecture emphasizes:\n- **Modularity** - Parts are independent and reusable\n- **Extensibility** - Views, editors, and handlers can be contributed\n- **Flexibility** - Layout can be customized and persisted\n- **Performance** - Lazy initialization and efficient updates\n\nKey entry points:\n- [src/vs/workbench/browser/layout.ts:138]() - Main `Layout` class\n- [src/vs/workbench/browser/parts/editor/editorPart.ts:91]() - `EditorPart` implementation\n- [src/vs/workbench/services/layout/browser/layoutService.ts:1]() - `IWorkbenchLayoutService` interface\n- [src/vs/workbench/services/editor/common/editorGroupsService.ts:21]() - `IEditorGroupsService` interface\n- [src/vs/workbench/services/editor/common/editorService.ts:17]() - `IEditorService` interface"])</script><script>self.__next_f.push([1,"24:T5433,"])</script><script>self.__next_f.push([1,"# Layout System and Parts\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [src/vs/platform/editor/common/editor.ts](src/vs/platform/editor/common/editor.ts)\n- [src/vs/workbench/browser/actions/layoutActions.ts](src/vs/workbench/browser/actions/layoutActions.ts)\n- [src/vs/workbench/browser/contextkeys.ts](src/vs/workbench/browser/contextkeys.ts)\n- [src/vs/workbench/browser/dnd.ts](src/vs/workbench/browser/dnd.ts)\n- [src/vs/workbench/browser/layout.ts](src/vs/workbench/browser/layout.ts)\n- [src/vs/workbench/browser/parts/auxiliarybar/auxiliaryBarActions.ts](src/vs/workbench/browser/parts/auxiliarybar/auxiliaryBarActions.ts)\n- [src/vs/workbench/browser/parts/editor/editor.contribution.ts](src/vs/workbench/browser/parts/editor/editor.contribution.ts)\n- [src/vs/workbench/browser/parts/editor/editor.ts](src/vs/workbench/browser/parts/editor/editor.ts)\n- [src/vs/workbench/browser/parts/editor/editorActions.ts](src/vs/workbench/browser/parts/editor/editorActions.ts)\n- [src/vs/workbench/browser/parts/editor/editorCommands.ts](src/vs/workbench/browser/parts/editor/editorCommands.ts)\n- [src/vs/workbench/browser/parts/editor/editorDropTarget.ts](src/vs/workbench/browser/parts/editor/editorDropTarget.ts)\n- [src/vs/workbench/browser/parts/editor/editorGroupView.ts](src/vs/workbench/browser/parts/editor/editorGroupView.ts)\n- [src/vs/workbench/browser/parts/editor/editorPart.ts](src/vs/workbench/browser/parts/editor/editorPart.ts)\n- [src/vs/workbench/browser/parts/panel/panelActions.ts](src/vs/workbench/browser/parts/panel/panelActions.ts)\n- [src/vs/workbench/browser/parts/titlebar/titlebarActions.ts](src/vs/workbench/browser/parts/titlebar/titlebarActions.ts)\n- [src/vs/workbench/browser/workbench.contribution.ts](src/vs/workbench/browser/workbench.contribution.ts)\n- [src/vs/workbench/browser/workbench.ts](src/vs/workbench/browser/workbench.ts)\n- [src/vs/workbench/common/contextkeys.ts](src/vs/workbench/common/contextkeys.ts)\n- [src/vs/workbench/common/editor.ts](src/vs/workbench/common/editor.ts)\n- [src/vs/workbench/services/editor/browser/editorService.ts](src/vs/workbench/services/editor/browser/editorService.ts)\n- [src/vs/workbench/services/editor/common/editorGroupsService.ts](src/vs/workbench/services/editor/common/editorGroupsService.ts)\n- [src/vs/workbench/services/editor/common/editorService.ts](src/vs/workbench/services/editor/common/editorService.ts)\n- [src/vs/workbench/services/editor/test/browser/editorGroupsService.test.ts](src/vs/workbench/services/editor/test/browser/editorGroupsService.test.ts)\n- [src/vs/workbench/services/editor/test/browser/editorService.test.ts](src/vs/workbench/services/editor/test/browser/editorService.test.ts)\n- [src/vs/workbench/services/layout/browser/layoutService.ts](src/vs/workbench/services/layout/browser/layoutService.ts)\n- [src/vs/workbench/test/browser/workbenchTestServices.ts](src/vs/workbench/test/browser/workbenchTestServices.ts)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThe Layout System manages the spatial organization of VS Code's workbench UI, dividing the window into distinct regions called **Parts** and arranging them using a grid-based layout system. This document covers the core layout infrastructure, part management, grid organization, and layout state persistence.\n\nFor information about specific parts' internal content (views, panels, editors), see:\n- Editor-specific layout and groups: [4.2](#4.2) Editor Service and Groups\n- View system and contributions: [4.4](#4.4) View System and Contributions\n- Multi-window management: [4.7](#4.7) Multi-Window Support\n\n---\n\n## Architecture Overview\n\nThe layout system consists of three main layers:\n\n1. **Layout Service** (`IWorkbenchLayoutService`) - High-level API for controlling part visibility, positions, and dimensions\n2. **Layout Implementation** (`Layout` class) - Orchestrates the grid, manages state, and coordinates parts\n3. **Parts** - Individual UI regions (titlebar, sidebar, panel, etc.) that participate in the layout\n\n```mermaid\ngraph TD\n    subgraph \"Layout Service API\"\n        LayoutService[\"IWorkbenchLayoutService\u003cbr/\u003e(Interface)\"]\n    end\n    \n    subgraph \"Core Implementation\"\n        Layout[\"Layout class\u003cbr/\u003elayout.ts\"]\n        Grid[\"SerializableGrid\u003cbr/\u003eGrid-based positioning\"]\n        StateModel[\"LayoutStateModel\u003cbr/\u003eState persistence\"]\n    end\n    \n    subgraph \"Parts\"\n        TitleBar[\"TitleBarPart\"]\n        Banner[\"BannerPart\"]\n        ActivityBar[\"ActivityBarPart\"]\n        SideBar[\"SidebarPart\"]\n        Panel[\"PanelPart\"]\n        AuxBar[\"AuxiliaryBarPart\"]\n        Editor[\"EditorPart\"]\n        StatusBar[\"StatusBarPart\"]\n    end\n    \n    LayoutService --\u003e Layout\n    Layout --\u003e Grid\n    Layout --\u003e StateModel\n    Layout --\u003e TitleBar\n    Layout --\u003e Banner\n    Layout --\u003e ActivityBar\n    Layout --\u003e SideBar\n    Layout --\u003e Panel\n    Layout --\u003e AuxBar\n    Layout --\u003e Editor\n    Layout --\u003e StatusBar\n    \n    Grid --\u003e TitleBar\n    Grid --\u003e SideBar\n    Grid --\u003e Panel\n    Grid --\u003e Editor\n```\n\n**Sources:** [src/vs/workbench/browser/layout.ts:138-699](), [src/vs/workbench/services/layout/browser/layoutService.ts:1-600]()\n\n---\n\n## Parts System\n\n### Part Definitions\n\nVS Code's workbench is divided into eight distinct parts, defined in the `Parts` enumeration:\n\n| Part ID | Constant | Description | Multi-Window |\n|---------|----------|-------------|--------------|\n| `TITLEBAR_PART` | `'workbench.parts.titlebar'` | Window title, menu bar, window controls | Single window only |\n| `BANNER_PART` | `'workbench.parts.banner'` | Temporary notification banner at top | Single window only |\n| `ACTIVITYBAR_PART` | `'workbench.parts.activitybar'` | Icon bar for switching primary sidebar views | Single window only |\n| `SIDEBAR_PART` | `'workbench.parts.sidebar'` | Primary sidebar (Explorer, Search, etc.) | Single window only |\n| `PANEL_PART` | `'workbench.parts.panel'` | Bottom/side panel (Terminal, Problems, etc.) | Multi-window capable |\n| `AUXILIARYBAR_PART` | `'workbench.parts.auxiliarybar'` | Secondary sidebar | Single window only |\n| `EDITOR_PART` | `'workbench.parts.editor'` | Editor area | Multi-window capable |\n| `STATUSBAR_PART` | `'workbench.parts.statusbar'` | Status bar at bottom | Multi-window capable |\n\n```mermaid\ngraph TB\n    subgraph \"Main Window Layout\"\n        TitleBar[\"TITLEBAR_PART\u003cbr/\u003eMenu, Controls\"]\n        Banner[\"BANNER_PART\u003cbr/\u003eNotifications\"]\n        \n        subgraph \"Main Content Row\"\n            ActivityBar[\"ACTIVITYBAR_PART\u003cbr/\u003eIcons\"]\n            SideBar[\"SIDEBAR_PART\u003cbr/\u003ePrimary Views\"]\n            EditorArea[\"EDITOR_PART\u003cbr/\u003eEditors\"]\n            AuxBar[\"AUXILIARYBAR_PART\u003cbr/\u003eSecondary Views\"]\n        end\n        \n        Panel[\"PANEL_PART\u003cbr/\u003eTerminal, Problems\"]\n        StatusBar[\"STATUSBAR_PART\u003cbr/\u003eStatus Info\"]\n    end\n    \n    TitleBar --\u003e Banner\n    Banner --\u003e ActivityBar\n    Banner --\u003e SideBar\n    Banner --\u003e EditorArea\n    Banner --\u003e AuxBar\n    EditorArea --\u003e Panel\n    Panel --\u003e StatusBar\n```\n\n**Sources:** [src/vs/workbench/services/layout/browser/layoutService.ts:57-102](), [src/vs/workbench/browser/layout.ts:262-275]()\n\n### Part Base Class\n\nAll parts extend the `Part` abstract class, which provides common functionality:\n\n```mermaid\nclassDiagram\n    class Part {\n        \u003c\u003cabstract\u003e\u003e\n        +HTMLElement element\n        +Dimension minimumWidth\n        +Dimension minimumHeight\n        +Dimension maximumWidth\n        +Dimension maximumHeight\n        +onDidChange Event\n        +create(parent: HTMLElement)\n        +updateStyles()\n        +layout(width, height, top, left)\n        +setVisible(visible: boolean)\n    }\n    \n    class TitlebarPart {\n        +create()\n        +layout()\n    }\n    \n    class SidebarPart {\n        +create()\n        +layout()\n    }\n    \n    class PanelPart {\n        +create()\n        +layout()\n    }\n    \n    class EditorPart {\n        +create()\n        +layout()\n    }\n    \n    class StatusbarPart {\n        +create()\n        +layout()\n    }\n    \n    Part \u003c|-- TitlebarPart\n    Part \u003c|-- SidebarPart\n    Part \u003c|-- PanelPart\n    Part \u003c|-- EditorPart\n    Part \u003c|-- StatusbarPart\n```\n\nParts implement `ISerializableView` interface to participate in the grid layout system, providing size constraints and handling layout changes.\n\n**Sources:** [src/vs/workbench/browser/part.ts:1-150](), [src/vs/workbench/browser/layout.ts:262-275]()\n\n---\n\n## Grid Layout System\n\n### Grid Structure\n\nThe layout uses a `SerializableGrid` to arrange parts in a flexible, resizable grid structure. The grid organizes parts hierarchically with branch nodes (containers) and leaf nodes (parts).\n\n```mermaid\ngraph TD\n    Root[\"Root Grid Node\"]\n    \n    subgraph \"Vertical Split\"\n        TopSection[\"Top Section\u003cbr/\u003e(Titlebar, Banner)\"]\n        MiddleSection[\"Middle Section\u003cbr/\u003e(Content Area)\"]\n        BottomSection[\"Bottom Section\u003cbr/\u003e(Panel, Statusbar)\"]\n    end\n    \n    subgraph \"Horizontal Split in Middle\"\n        LeftArea[\"Activity Bar +\u003cbr/\u003eSidebar\"]\n        CenterArea[\"Editor Area\"]\n        RightArea[\"Auxiliary Bar\"]\n    end\n    \n    Root --\u003e TopSection\n    Root --\u003e MiddleSection\n    Root --\u003e BottomSection\n    \n    MiddleSection --\u003e LeftArea\n    MiddleSection --\u003e CenterArea\n    MiddleSection --\u003e RightArea\n```\n\nThe grid is created in `Layout.createGridDescriptor()` and supports:\n- Dynamic addition/removal of parts\n- Resizable sashes between parts\n- Size constraints from parts\n- Serialization for state persistence\n\n**Sources:** [src/vs/workbench/browser/layout.ts:1084-1300]()\n\n### Grid View Wrappers\n\nParts are wrapped in view objects to participate in the grid:\n\n- **titleBarPartView** - Wraps `TITLEBAR_PART`\n- **bannerPartView** - Wraps `BANNER_PART`  \n- **activityBarPartView** - Wraps `ACTIVITYBAR_PART`\n- **sideBarPartView** - Wraps `SIDEBAR_PART`\n- **panelPartView** - Wraps `PANEL_PART`\n- **auxiliaryBarPartView** - Wraps `AUXILIARYBAR_PART`\n- **editorPartView** - Wraps `EDITOR_PART`\n- **statusBarPartView** - Wraps `STATUSBAR_PART`\n\nThese views are created in `Layout.initLayout()` and registered with the grid.\n\n**Sources:** [src/vs/workbench/browser/layout.ts:267-274](), [src/vs/workbench/browser/layout.ts:765-890]()\n\n### Dynamic Layout Changes\n\nThe grid supports runtime modifications:\n\n```mermaid\nsequenceDiagram\n    participant User\n    participant LayoutService\n    participant Layout\n    participant Grid\n    participant Part\n    \n    User-\u003e\u003eLayoutService: setPanelPosition(Position.RIGHT)\n    LayoutService-\u003e\u003eLayout: setPanelPosition()\n    Layout-\u003e\u003eLayout: adjustPartPositions()\n    Layout-\u003e\u003eGrid: removeView(panelPartView)\n    Layout-\u003e\u003eGrid: addView(panelPartView, targetLocation)\n    Grid-\u003e\u003ePart: layout(width, height)\n    Layout-\u003e\u003eStateModel: setRuntimeValue(PANEL_POSITION)\n```\n\n**Sources:** [src/vs/workbench/browser/layout.ts:1632-1738]()\n\n---\n\n## Layout Service API\n\n### Core Methods\n\nThe `IWorkbenchLayoutService` provides methods for controlling the layout:\n\n**Visibility Control:**\n- `isVisible(part: Parts): boolean` - Check if part is visible\n- `setPartHidden(hidden: boolean, part: Parts)` - Show/hide parts\n- `toggleMaximizedPanel()` - Toggle panel maximization\n- `toggleMaximizedAuxiliaryBar()` - Toggle auxiliary bar maximization\n\n**Position Control:**\n- `getPanelPosition(): Position` - Get panel position (bottom/left/right)\n- `setPanelPosition(position: Position)` - Set panel position\n- `getSideBarPosition(): Position` - Get sidebar position (left/right)\n- `getPanelAlignment(): PanelAlignment` - Get panel alignment when at bottom\n\n**Dimensions:**\n- `getContainerDimension(part: Parts): IDimension` - Get part dimensions\n- `hasMainWindowBorder(): boolean` - Check for window border\n- `getMainWindowBorderRadius(): string | undefined` - Get border radius\n\n**Layout Modes:**\n- `centerMainEditorLayout(active: boolean)` - Enable/disable centered layout\n- `isMainEditorLayoutCentered(): boolean` - Check centered layout state\n- `toggleZenMode()` - Enter/exit zen mode\n- `isZenModeActive(): boolean` - Check zen mode state\n\n**Sources:** [src/vs/workbench/services/layout/browser/layoutService.ts:220-500]()\n\n### Events\n\nThe layout service emits events for monitoring layout changes:\n\n- `onDidChangeZenMode: Event\u003cboolean\u003e` - Zen mode state changed\n- `onDidChangeMainEditorCenteredLayout: Event\u003cboolean\u003e` - Centered layout changed\n- `onDidChangePanelAlignment: Event\u003cPanelAlignment\u003e` - Panel alignment changed\n- `onDidChangePanelPosition: Event\u003cstring\u003e` - Panel position changed\n- `onDidChangePartVisibility: Event\u003cvoid\u003e` - Any part visibility changed\n- `onDidChangeWindowMaximized: Event\u003c{windowId, maximized}\u003e` - Window maximization changed\n- `onDidLayoutMainContainer: Event\u003cIDimension\u003e` - Main container laid out\n- `onDidLayoutActiveContainer: Event\u003cIDimension\u003e` - Active container laid out\n- `onDidChangeActiveContainer: Event\u003cvoid\u003e` - Active container changed\n\n**Sources:** [src/vs/workbench/browser/layout.ts:144-182]()\n\n---\n\n## State Management\n\n### State Model\n\nThe `LayoutStateModel` manages layout state persistence across two scopes:\n\n**Workspace Scope** (varies per workspace):\n- Part visibility states\n- Part positions (sidebar, panel)\n- Panel alignment\n- Zen mode state\n\n**Profile Scope** (varies per user profile):\n- Activity bar visibility\n- Status bar visibility\n- Centered layout preference\n\n```mermaid\ngraph LR\n    subgraph \"State Sources\"\n        Storage[\"IStorageService\u003cbr/\u003ePersistent Storage\"]\n        Config[\"IConfigurationService\u003cbr/\u003eSettings\"]\n        Defaults[\"Default Values\"]\n    end\n    \n    subgraph \"LayoutStateModel\"\n        RuntimeState[\"Runtime State\u003cbr/\u003e(in-memory)\"]\n        InitState[\"Initialization State\u003cbr/\u003e(startup)\"]\n    end\n    \n    subgraph \"State Keys\"\n        SidebarHidden[\"SIDEBAR_HIDDEN\"]\n        PanelHidden[\"PANEL_HIDDEN\"]\n        PanelPosition[\"PANEL_POSITION\"]\n        PanelAlignment[\"PANEL_ALIGNMENT\"]\n        ActivityBarHidden[\"ACTIVITYBAR_HIDDEN\"]\n        CenteredLayout[\"MAIN_EDITOR_CENTERED\"]\n    end\n    \n    Storage --\u003e RuntimeState\n    Config --\u003e RuntimeState\n    Defaults --\u003e RuntimeState\n    \n    RuntimeState --\u003e SidebarHidden\n    RuntimeState --\u003e PanelHidden\n    RuntimeState --\u003e PanelPosition\n    RuntimeState --\u003e PanelAlignment\n    RuntimeState --\u003e ActivityBarHidden\n    RuntimeState --\u003e CenteredLayout\n```\n\n**Sources:** [src/vs/workbench/browser/layout.ts:2247-2700]()\n\n### Serialization\n\nThe layout state is serialized to storage keys:\n\n**Workspace Storage Keys:**\n- `workbench.sidebar.hidden` - Sidebar visibility\n- `workbench.panel.hidden` - Panel visibility  \n- `workbench.panel.position` - Panel position\n- `workbench.panel.alignment` - Panel alignment\n- `workbench.auxiliarybar.hidden` - Auxiliary bar visibility\n\n**Profile Storage Keys:**\n- `workbench.activityBar.hidden` - Activity bar visibility\n- `workbench.statusbar.hidden` - Status bar visibility\n- `workbench.centerededitorlayout.active` - Centered layout state\n\nGrid state is serialized separately for workspace restoration:\n```typescript\ninterface IEditorPartUIState {\n    readonly serializedGrid: ISerializedGrid;\n    readonly activeGroup: GroupIdentifier;\n    readonly mostRecentActiveGroups: GroupIdentifier[];\n}\n```\n\n**Sources:** [src/vs/workbench/browser/layout.ts:633-704](), [src/vs/workbench/browser/parts/editor/editorPart.ts:40-49]()\n\n---\n\n## Layout Configurations\n\n### Position and Alignment\n\n**Sidebar Position:**\n- Configuration: `workbench.sideBar.location`\n- Values: `'left'` (default) | `'right'`\n- Affects both sidebar and auxiliary bar positions (mirrored)\n\n**Panel Position:**\n- Configuration: `workbench.panel.defaultLocation`\n- Values: `'bottom'` (default) | `'left'` | `'right'`\n- Can be positioned at bottom or either side\n\n**Panel Alignment** (when at bottom):\n- Configuration: `workbench.panel.alignment`\n- Values: `'left'` | `'center'` (default) | `'right'` | `'justify'`\n- Controls horizontal alignment in bottom position\n\n```mermaid\ngraph TD\n    subgraph \"Panel Position Options\"\n        Bottom[\"Bottom\u003cbr/\u003e(default)\"]\n        Left[\"Left\"]\n        Right[\"Right\"]\n    end\n    \n    subgraph \"Panel Alignment (when bottom)\"\n        AlignLeft[\"Left aligned\"]\n        AlignCenter[\"Center aligned\u003cbr/\u003e(default)\"]\n        AlignRight[\"Right aligned\"]\n        AlignJustify[\"Justified\u003cbr/\u003e(full width)\"]\n    end\n    \n    Bottom --\u003e AlignLeft\n    Bottom --\u003e AlignCenter\n    Bottom --\u003e AlignRight\n    Bottom --\u003e AlignJustify\n```\n\n**Sources:** [src/vs/workbench/browser/layout.ts:555-661](), [src/vs/workbench/services/layout/browser/layoutService.ts:130-180]()\n\n### Special Modes\n\n**Zen Mode:**\n- Hides all UI chrome except editor area\n- Configurable via `zenMode.*` settings\n- Settings control: status bar, tabs, activity bar visibility in zen mode\n- Enters fullscreen by default (configurable)\n\n**Centered Layout:**\n- Centers editor area with fixed width\n- Configurable width via `workbench.editor.centeredLayoutFixedWidth`\n- Auto-disables for diff editors\n- Persists per workspace\n\n**Maximized Panels:**\n- Panel can be maximized to hide editor area\n- Auxiliary bar can be maximized to hide editor area\n- Only one can be maximized at a time\n- Restores previous layout when de-maximized\n\n**Sources:** [src/vs/workbench/browser/layout.ts:1742-2050](), [src/vs/workbench/services/layout/browser/layoutService.ts:440-530]()\n\n---\n\n## Multi-Window Support\n\n### Window-Specific Parts\n\nParts are categorized by window support:\n\n**Single-Window Parts** (main window only):\n- `TITLEBAR_PART`\n- `BANNER_PART`\n- `ACTIVITYBAR_PART`\n- `SIDEBAR_PART`\n- `AUXILIARYBAR_PART`\n\n**Multi-Window Parts** (can appear in auxiliary windows):\n- `PANEL_PART`\n- `EDITOR_PART`\n- `STATUSBAR_PART`\n\nThis distinction is defined in the `MULTI_WINDOW_PARTS` and `SINGLE_WINDOW_PARTS` constants.\n\n**Sources:** [src/vs/workbench/services/layout/browser/layoutService.ts:104-128]()\n\n### Container Management\n\nThe layout manages multiple containers (main + auxiliary windows):\n\n```mermaid\ngraph TD\n    Layout[\"Layout\u003cbr/\u003e(manages all containers)\"]\n    \n    subgraph \"Main Window\"\n        MainContainer[\"mainContainer\u003cbr/\u003e(HTMLElement)\"]\n        MainParts[\"Single-window parts\u003cbr/\u003e+ Editor/Panel/Status instances\"]\n    end\n    \n    subgraph \"Auxiliary Window 1\"\n        AuxContainer1[\"Auxiliary Container\u003cbr/\u003e(HTMLElement)\"]\n        AuxParts1[\"Editor/Panel/Status\u003cbr/\u003einstances\"]\n    end\n    \n    subgraph \"Auxiliary Window 2\"\n        AuxContainer2[\"Auxiliary Container\u003cbr/\u003e(HTMLElement)\"]\n        AuxParts2[\"Editor/Panel/Status\u003cbr/\u003einstances\"]\n    end\n    \n    Layout --\u003e MainContainer\n    Layout --\u003e AuxContainer1\n    Layout --\u003e AuxContainer2\n    \n    MainContainer --\u003e MainParts\n    AuxContainer1 --\u003e AuxParts1\n    AuxContainer2 --\u003e AuxParts2\n```\n\nThe `activeContainer` property tracks which window is currently focused, and layout events distinguish between main/active/specific containers.\n\n**Sources:** [src/vs/workbench/browser/layout.ts:187-225](), [src/vs/workbench/browser/layout.ts:434-445]()\n\n---\n\n## Implementation Details\n\n### Initialization Sequence\n\n```mermaid\nsequenceDiagram\n    participant Workbench\n    participant Layout\n    participant StateModel\n    participant Grid\n    participant Parts\n    \n    Workbench-\u003e\u003eLayout: initLayout(accessor)\n    Layout-\u003e\u003eStateModel: new LayoutStateModel()\n    StateModel-\u003e\u003eStateModel: load() state from storage\n    \n    Layout-\u003e\u003eLayout: createParts()\n    Layout-\u003e\u003eParts: create(container)\n    \n    Layout-\u003e\u003eLayout: createGridDescriptor()\n    Layout-\u003e\u003eGrid: new SerializableGrid(descriptor)\n    \n    Layout-\u003e\u003eLayout: registerLayoutListeners()\n    Layout-\u003e\u003eLayout: restoreState()\n    \n    Layout-\u003e\u003eGrid: layout(dimension)\n    Grid-\u003e\u003eParts: layout(width, height)\n```\n\n**Sources:** [src/vs/workbench/browser/layout.ts:307-337](), [src/vs/workbench/browser/layout.ts:765-900]()\n\n### Layout Calculation\n\nThe layout system calculates dimensions considering:\n\n1. **Container Offset** - Top offset from banner/titlebar\n2. **Window Border** - Custom titlebar window border\n3. **Size Constraints** - Min/max from parts\n4. **Grid Distribution** - Proportional sizing\n\n```typescript\n// Example from layout.ts\nprivate computeContainerOffset(targetWindow: Window) {\n    let top = 0;\n    let quickPickTop = 0;\n    \n    if (this.isVisible(Parts.BANNER_PART)) {\n        top = this.getPart(Parts.BANNER_PART).maximumHeight;\n        quickPickTop = top;\n    }\n    \n    const titlebarVisible = this.isVisible(Parts.TITLEBAR_PART, targetWindow);\n    if (titlebarVisible) {\n        top += this.getPart(Parts.TITLEBAR_PART).maximumHeight;\n        quickPickTop = top;\n    }\n    \n    // Command center affects quick pick position\n    const isCommandCenterVisible = titlebarVisible \u0026\u0026 \n        this.configurationService.getValue(LayoutSettings.COMMAND_CENTER) !== false;\n    if (isCommandCenterVisible) {\n        quickPickTop = 6;\n    }\n    \n    return { top, quickPickTop };\n}\n```\n\n**Sources:** [src/vs/workbench/browser/layout.ts:227-258]()\n\n### Part Visibility Toggle\n\n```mermaid\nsequenceDiagram\n    participant Action\n    participant LayoutService\n    participant Layout\n    participant StateModel\n    participant Grid\n    participant Part\n    \n    Action-\u003e\u003eLayoutService: toggleSidebar()\n    LayoutService-\u003e\u003eLayout: setPartHidden(!isVisible(), SIDEBAR_PART)\n    Layout-\u003e\u003eStateModel: setRuntimeValue(SIDEBAR_HIDDEN, hidden)\n    StateModel-\u003e\u003eStateModel: onDidChangeState.fire()\n    Layout-\u003e\u003eGrid: setViewVisible(sideBarPartView, !hidden)\n    Grid-\u003e\u003ePart: setVisible(!hidden)\n    Part-\u003e\u003ePart: updateStyles()\n    Layout-\u003e\u003eLayout: _onDidChangePartVisibility.fire()\n```\n\n**Sources:** [src/vs/workbench/browser/layout.ts:1485-1565]()"])</script><script>self.__next_f.push([1,"25:T5c48,"])</script><script>self.__next_f.push([1,"# Editor Service and Groups\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [src/vs/platform/editor/common/editor.ts](src/vs/platform/editor/common/editor.ts)\n- [src/vs/workbench/browser/actions/layoutActions.ts](src/vs/workbench/browser/actions/layoutActions.ts)\n- [src/vs/workbench/browser/contextkeys.ts](src/vs/workbench/browser/contextkeys.ts)\n- [src/vs/workbench/browser/dnd.ts](src/vs/workbench/browser/dnd.ts)\n- [src/vs/workbench/browser/layout.ts](src/vs/workbench/browser/layout.ts)\n- [src/vs/workbench/browser/parts/auxiliarybar/auxiliaryBarActions.ts](src/vs/workbench/browser/parts/auxiliarybar/auxiliaryBarActions.ts)\n- [src/vs/workbench/browser/parts/editor/editor.contribution.ts](src/vs/workbench/browser/parts/editor/editor.contribution.ts)\n- [src/vs/workbench/browser/parts/editor/editor.ts](src/vs/workbench/browser/parts/editor/editor.ts)\n- [src/vs/workbench/browser/parts/editor/editorActions.ts](src/vs/workbench/browser/parts/editor/editorActions.ts)\n- [src/vs/workbench/browser/parts/editor/editorCommands.ts](src/vs/workbench/browser/parts/editor/editorCommands.ts)\n- [src/vs/workbench/browser/parts/editor/editorDropTarget.ts](src/vs/workbench/browser/parts/editor/editorDropTarget.ts)\n- [src/vs/workbench/browser/parts/editor/editorGroupView.ts](src/vs/workbench/browser/parts/editor/editorGroupView.ts)\n- [src/vs/workbench/browser/parts/editor/editorPart.ts](src/vs/workbench/browser/parts/editor/editorPart.ts)\n- [src/vs/workbench/browser/parts/panel/panelActions.ts](src/vs/workbench/browser/parts/panel/panelActions.ts)\n- [src/vs/workbench/browser/parts/titlebar/titlebarActions.ts](src/vs/workbench/browser/parts/titlebar/titlebarActions.ts)\n- [src/vs/workbench/browser/workbench.contribution.ts](src/vs/workbench/browser/workbench.contribution.ts)\n- [src/vs/workbench/browser/workbench.ts](src/vs/workbench/browser/workbench.ts)\n- [src/vs/workbench/common/contextkeys.ts](src/vs/workbench/common/contextkeys.ts)\n- [src/vs/workbench/common/editor.ts](src/vs/workbench/common/editor.ts)\n- [src/vs/workbench/services/editor/browser/editorService.ts](src/vs/workbench/services/editor/browser/editorService.ts)\n- [src/vs/workbench/services/editor/common/editorGroupsService.ts](src/vs/workbench/services/editor/common/editorGroupsService.ts)\n- [src/vs/workbench/services/editor/common/editorService.ts](src/vs/workbench/services/editor/common/editorService.ts)\n- [src/vs/workbench/services/editor/test/browser/editorGroupsService.test.ts](src/vs/workbench/services/editor/test/browser/editorGroupsService.test.ts)\n- [src/vs/workbench/services/editor/test/browser/editorService.test.ts](src/vs/workbench/services/editor/test/browser/editorService.test.ts)\n- [src/vs/workbench/services/layout/browser/layoutService.ts](src/vs/workbench/services/layout/browser/layoutService.ts)\n- [src/vs/workbench/test/browser/workbenchTestServices.ts](src/vs/workbench/test/browser/workbenchTestServices.ts)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis document describes the editor service and editor groups system in VS Code's workbench. It covers how editors are opened, closed, and organized into groups; how the grid-based layout system manages multiple editor groups; and how multi-window support enables auxiliary editor parts.\n\nFor information about individual editor panes and editor inputs, see [Editor Input and Pane System](#4.3). For the overall workbench layout system, see [Layout System and Parts](#4.1).\n\n## Architecture Overview\n\nThe editor service and groups system consists of several key components working together to manage the editor area:\n\n```mermaid\ngraph TB\n    IEditorService[\"IEditorService\u003cbr/\u003e(editorService.ts)\"]\n    IEditorGroupsService[\"IEditorGroupsService\u003cbr/\u003e(editorGroupsService.ts)\"]\n    EditorServiceImpl[\"EditorService\u003cbr/\u003e(browser/editorService.ts)\"]\n    EditorParts[\"EditorParts\u003cbr/\u003e(editorParts.ts)\"]\n    MainEditorPart[\"MainEditorPart\u003cbr/\u003e(editorPart.ts)\"]\n    AuxiliaryEditorPart[\"AuxiliaryEditorPart\u003cbr/\u003e(auxiliaryEditorPart.ts)\"]\n    EditorGroupView[\"EditorGroupView\u003cbr/\u003e(editorGroupView.ts)\"]\n    SerializableGrid[\"SerializableGrid\u003cbr/\u003e(base/ui/grid/grid.ts)\"]\n    \n    IEditorService --\u003e|\"implements\"| EditorServiceImpl\n    IEditorGroupsService --\u003e|\"implements\"| EditorParts\n    EditorParts --\u003e|\"manages\"| MainEditorPart\n    EditorParts --\u003e|\"manages\"| AuxiliaryEditorPart\n    MainEditorPart --\u003e|\"contains\"| SerializableGrid\n    SerializableGrid --\u003e|\"arranges\"| EditorGroupView\n    EditorServiceImpl --\u003e|\"uses\"| EditorParts\n    EditorServiceImpl --\u003e|\"uses\"| EditorGroupView\n```\n\n**Sources:**\n- [src/vs/workbench/services/editor/common/editorService.ts:1-70]()\n- [src/vs/workbench/services/editor/common/editorGroupsService.ts:1-100]()\n- [src/vs/workbench/services/editor/browser/editorService.ts:1-96]()\n- [src/vs/workbench/browser/parts/editor/editorParts.ts:1-50]()\n\n## IEditorService - Editor Lifecycle Management\n\n`IEditorService` is the primary service for opening, closing, and managing editors across all groups and windows. It provides a unified API for editor operations regardless of which group or window contains the editor.\n\n### Key Responsibilities\n\n| Responsibility | Key Methods |\n|----------------|-------------|\n| Opening editors | `openEditor()`, `openEditors()`, `replaceEditors()` |\n| Closing editors | `closeEditor()`, `closeEditors()` |\n| Active editor tracking | `activeEditor`, `activeEditorPane`, `onDidActiveEditorChange` |\n| Visible editors | `visibleEditors`, `visibleEditorPanes`, `onDidVisibleEditorsChange` |\n| Editor history | Most recently used editors, editor change events |\n| Multi-group coordination | Finding editors across groups, moving/copying editors |\n\n### Opening Editors\n\n```mermaid\ngraph TB\n    ClientCode[\"Client Code\"]\n    IEditorService[\"IEditorService.openEditor()\"]\n    EditorResolverService[\"EditorResolverService\"]\n    FindGroup[\"findGroup()\u003cbr/\u003e(editorGroupFinder.ts)\"]\n    TargetGroup[\"Target IEditorGroup\"]\n    OpenInGroup[\"group.openEditor()\"]\n    EditorPane[\"IEditorPane\"]\n    \n    ClientCode --\u003e|\"editor input + options\"| IEditorService\n    IEditorService --\u003e|\"resolve editor\"| EditorResolverService\n    IEditorService --\u003e|\"determine target\"| FindGroup\n    FindGroup --\u003e|\"ACTIVE_GROUP, SIDE_GROUP, etc.\"| TargetGroup\n    TargetGroup --\u003e|\"open in group\"| OpenInGroup\n    OpenInGroup --\u003e|\"creates/reuses\"| EditorPane\n```\n\n**Sources:**\n- [src/vs/workbench/services/editor/browser/editorService.ts:308-450]()\n- [src/vs/workbench/services/editor/common/editorService.ts:1-100]()\n\n### Group and Editor Targeting\n\nThe editor service supports multiple patterns for targeting where editors open:\n\n- **`ACTIVE_GROUP`** (-1): Opens in the currently active group\n- **`SIDE_GROUP`** (-2): Opens to the side of the active group\n- **`PreferredGroup`**: Union of ACTIVE_GROUP, SIDE_GROUP, or GroupIdentifier\n- **`GroupIdentifier`**: Specific numeric group ID\n- **`IEditorGroup`**: Direct group reference\n\n**Sources:**\n- [src/vs/workbench/services/editor/common/editorService.ts:18-35]()\n- [src/vs/workbench/services/editor/browser/editorService.ts:308-350]()\n\n## IEditorGroupsService - Group Management\n\n`IEditorGroupsService` manages the organization and lifecycle of editor groups. It controls how groups are created, arranged, split, merged, and navigated.\n\n### Editor Groups Hierarchy\n\n```mermaid\ngraph TB\n    IEditorGroupsService[\"IEditorGroupsService\"]\n    MainPart[\"mainPart: IEditorPart\"]\n    AuxParts[\"auxiliaryParts: IAuxiliaryEditorPart[]\"]\n    Groups[\"groups: IEditorGroup[]\"]\n    ActiveGroup[\"activeGroup: IEditorGroup\"]\n    EditorGroupView1[\"EditorGroupView (id=1)\"]\n    EditorGroupView2[\"EditorGroupView (id=2)\"]\n    EditorGroupView3[\"EditorGroupView (id=3)\"]\n    \n    IEditorGroupsService --\u003e|\"contains\"| MainPart\n    IEditorGroupsService --\u003e|\"contains\"| AuxParts\n    MainPart --\u003e|\"manages\"| Groups\n    Groups --\u003e|\"active\"| ActiveGroup\n    Groups --\u003e EditorGroupView1\n    Groups --\u003e EditorGroupView2\n    Groups --\u003e EditorGroupView3\n```\n\n**Sources:**\n- [src/vs/workbench/services/editor/common/editorGroupsService.ts:400-650]()\n- [src/vs/workbench/browser/parts/editor/editorParts.ts:1-200]()\n\n### Group Operations\n\n| Operation | Methods | Description |\n|-----------|---------|-------------|\n| **Creation** | `addGroup()`, `copyGroup()` | Create new groups with optional editors |\n| **Splitting** | `createEditorDropTarget()` | Split in directions (UP, DOWN, LEFT, RIGHT) |\n| **Merging** | `mergeGroup()`, `mergeAllGroups()` | Combine groups and their editors |\n| **Navigation** | `getGroup()`, `findGroup()` | Find groups by location, direction, or identifier |\n| **Arrangement** | `arrangeGroups()`, `setGroupOrientation()` | Change layout (horizontal/vertical) |\n| **Closing** | `removeGroup()` | Close groups and optionally move editors |\n\n**Sources:**\n- [src/vs/workbench/services/editor/common/editorGroupsService.ts:400-750]()\n- [src/vs/workbench/browser/parts/editor/editorPart.ts:400-800]()\n\n### Group Direction and Orientation\n\nGroups are arranged in a grid with configurable orientation:\n\n```mermaid\ngraph LR\n    subgraph \"Horizontal Orientation\"\n        H1[\"Group 1\"] --- H2[\"Group 2\"] --- H3[\"Group 3\"]\n    end\n    \n    subgraph \"Vertical Orientation\"\n        V1[\"Group 1\"]\n        V2[\"Group 2\"]\n        V3[\"Group 3\"]\n        V1 --- V2 --- V3\n    end\n```\n\n| Enum | Values | Description |\n|------|--------|-------------|\n| `GroupDirection` | UP, DOWN, LEFT, RIGHT | Direction relative to current group |\n| `GroupOrientation` | HORIZONTAL, VERTICAL | Overall grid layout |\n| `GroupLocation` | FIRST, LAST, NEXT, PREVIOUS | Named positions |\n\n**Sources:**\n- [src/vs/workbench/services/editor/common/editorGroupsService.ts:23-50]()\n- [src/vs/workbench/browser/parts/editor/editorPart.ts:500-700]()\n\n## EditorPart - The Container\n\n`EditorPart` is the physical part of the workbench that hosts editor groups. It extends `Part` and implements `IEditorGroupsView` to provide the grid-based layout system.\n\n### EditorPart Structure\n\n```mermaid\ngraph TB\n    EditorPart[\"EditorPart\u003cbr/\u003e(extends Part)\"]\n    Container[\"container: HTMLElement\"]\n    GridWidget[\"GridWidgetView\u0026lt;EditorGroupView\u0026gt;\"]\n    SerializableGrid[\"SerializableGrid\u0026lt;EditorGroupView\u0026gt;\"]\n    GroupView1[\"EditorGroupView 1\"]\n    GroupView2[\"EditorGroupView 2\"]\n    GroupView3[\"EditorGroupView 3\"]\n    CenteredLayout[\"CenteredViewLayout\"]\n    \n    EditorPart --\u003e|\"contains\"| Container\n    Container --\u003e|\"hosts\"| GridWidget\n    GridWidget --\u003e|\"wraps\"| SerializableGrid\n    SerializableGrid --\u003e|\"arranges\"| GroupView1\n    SerializableGrid --\u003e|\"arranges\"| GroupView2\n    SerializableGrid --\u003e|\"arranges\"| GroupView3\n    EditorPart --\u003e|\"optionally uses\"| CenteredLayout\n```\n\n**Sources:**\n- [src/vs/workbench/browser/parts/editor/editorPart.ts:91-200]()\n- [src/vs/workbench/browser/parts/editor/editor.ts:1-100]()\n\n### Main vs Auxiliary Editor Parts\n\nVS Code supports multiple windows, each with its own editor part:\n\n| Part Type | Class | Purpose |\n|-----------|-------|---------|\n| **Main** | `MainEditorPart` | Primary editor part in main window |\n| **Auxiliary** | `AuxiliaryEditorPart` | Additional editor parts in auxiliary windows |\n\nBoth implement `IEditorPart` and share the same grid-based architecture. The `EditorParts` class coordinates between them.\n\n**Sources:**\n- [src/vs/workbench/browser/parts/editor/editorParts.ts:50-300]()\n- [src/vs/workbench/browser/parts/editor/auxiliaryEditorPart.ts:1-100]()\n\n### Grid Serialization and Restoration\n\nThe editor part persists its layout state to storage:\n\n```mermaid\ngraph LR\n    State[\"IEditorPartUIState\"]\n    SerializedGrid[\"serializedGrid\"]\n    ActiveGroup[\"activeGroup: GroupIdentifier\"]\n    MRU[\"mostRecentActiveGroups[]\"]\n    Storage[\"IStorageService\"]\n    \n    State --\u003e SerializedGrid\n    State --\u003e ActiveGroup\n    State --\u003e MRU\n    State --\u003e|\"saved to\"| Storage\n```\n\n**Key Types:**\n- **`IEditorPartUIState`**: Contains serialized grid structure, active group, and MRU list\n- **`ISerializedGrid`**: Grid layout with orientation and nested nodes\n- Storage key: `'editorpart.state'`\n\n**Sources:**\n- [src/vs/workbench/browser/parts/editor/editorPart.ts:40-95]()\n- [src/vs/workbench/browser/parts/editor/editorPart.ts:200-400]()\n\n## EditorGroupView - Individual Groups\n\n`EditorGroupView` represents a single editor group within an editor part. It manages the lifecycle of editors within that group and handles the tab UI.\n\n### EditorGroupView Architecture\n\n```mermaid\ngraph TB\n    EditorGroupView[\"EditorGroupView\u003cbr/\u003e(implements IEditorGroupView)\"]\n    Model[\"EditorGroupModel\"]\n    TitleControl[\"EditorTitleControl\"]\n    EditorPane[\"EditorPanes\"]\n    ScopedServices[\"Scoped Services\"]\n    ContextKeys[\"Context Keys\"]\n    \n    EditorGroupView --\u003e|\"contains\"| Model\n    EditorGroupView --\u003e|\"contains\"| TitleControl\n    EditorGroupView --\u003e|\"contains\"| EditorPane\n    EditorGroupView --\u003e|\"creates\"| ScopedServices\n    EditorGroupView --\u003e|\"manages\"| ContextKeys\n    \n    Model --\u003e|\"tracks editors\"| EditorList[\"editors[]\"]\n    Model --\u003e|\"tracks state\"| ActiveEditor[\"activeEditor\"]\n    TitleControl --\u003e|\"renders\"| Tabs[\"Tabs UI\"]\n    EditorPane --\u003e|\"renders\"| ActivePane[\"Active IEditorPane\"]\n```\n\n**Sources:**\n- [src/vs/workbench/browser/parts/editor/editorGroupView.ts:62-250]()\n- [src/vs/workbench/common/editor/editorGroupModel.ts:1-100]()\n\n### Group Properties and State\n\nEach `EditorGroupView` maintains:\n\n| Property | Type | Description |\n|----------|------|-------------|\n| `id` | `GroupIdentifier` | Unique numeric identifier |\n| `label` | `string` | Display label (e.g., \"Group 1\") |\n| `index` | `number` | Position in editor part |\n| `activeEditor` | `EditorInput \\| undefined` | Currently active editor |\n| `editors` | `EditorInput[]` | All editors in group |\n| `count` | `number` | Number of editors |\n| `isEmpty` | `boolean` | Whether group has no editors |\n| `isLocked` | `boolean` | Whether group is locked (prevents certain operations) |\n\n**Sources:**\n- [src/vs/workbench/browser/parts/editor/editorGroupView.ts:62-150]()\n- [src/vs/workbench/services/editor/common/editorGroupsService.ts:100-250]()\n\n### Editor Opening Flow in a Group\n\n```mermaid\nsequenceDiagram\n    participant Client\n    participant GroupView as EditorGroupView\n    participant Model as EditorGroupModel\n    participant TitleControl\n    participant EditorPane as EditorPanes\n    participant Pane as IEditorPane\n    \n    Client-\u003e\u003eGroupView: openEditor(input, options)\n    GroupView-\u003e\u003eGroupView: doOpenEditor()\n    GroupView-\u003e\u003eModel: openEditor(input)\n    Model-\u003e\u003eModel: splice editor into list\n    Model--\u003e\u003eGroupView: change event\n    GroupView-\u003e\u003eTitleControl: openEditor(index)\n    GroupView-\u003e\u003eEditorPane: openEditor(input, options)\n    EditorPane-\u003e\u003ePane: create/setInput()\n    Pane--\u003e\u003eEditorPane: ready\n    EditorPane--\u003e\u003eGroupView: opened\n    GroupView--\u003e\u003eClient: IEditorPane\n```\n\n**Sources:**\n- [src/vs/workbench/browser/parts/editor/editorGroupView.ts:800-1200]()\n- [src/vs/workbench/common/editor/editorGroupModel.ts:200-500]()\n\n### Context Keys\n\nEach `EditorGroupView` manages scoped context keys for keybindings and menu visibility:\n\n| Context Key | Value | Description |\n|-------------|-------|-------------|\n| `ActiveEditorContext` | Editor type ID | Active editor pane type |\n| `ActiveEditorDirtyContext` | boolean | Whether active editor is dirty |\n| `ActiveEditorPinnedContext` | boolean | Whether active editor is pinned |\n| `ActiveEditorStickyContext` | boolean | Whether active editor is sticky |\n| `ActiveEditorGroupLockedContext` | boolean | Whether group is locked |\n| `EditorGroupEditorsCountContext` | number | Number of editors in group |\n| `ActiveEditorGroupEmptyContext` | boolean | Whether group is empty |\n\n**Sources:**\n- [src/vs/workbench/browser/parts/editor/editorGroupView.ts:249-320]()\n- [src/vs/workbench/common/contextkeys.ts:1-150]()\n\n## Grid Layout System\n\nThe editor groups are arranged using a `SerializableGrid` from the base UI library. This provides flexible splitting, resizing, and persistence.\n\n### Grid Structure\n\n```mermaid\ngraph TB\n    Grid[\"SerializableGrid\"]\n    RootNode[\"GridBranchNode\u003cbr/\u003e(orientation: HORIZONTAL)\"]\n    Branch1[\"GridBranchNode\u003cbr/\u003e(orientation: VERTICAL)\"]\n    Leaf1[\"GridLeafNode\u003cbr/\u003e(EditorGroupView 1)\"]\n    Leaf2[\"GridLeafNode\u003cbr/\u003e(EditorGroupView 2)\"]\n    Leaf3[\"GridLeafNode\u003cbr/\u003e(EditorGroupView 3)\"]\n    \n    Grid --\u003e|\"root\"| RootNode\n    RootNode --\u003e|\"child[0]\"| Branch1\n    RootNode --\u003e|\"child[1]\"| Leaf3\n    Branch1 --\u003e|\"child[0]\"| Leaf1\n    Branch1 --\u003e|\"child[1]\"| Leaf2\n```\n\n**Grid Concepts:**\n- **Branch Nodes**: Containers with orientation (HORIZONTAL or VERTICAL) and size\n- **Leaf Nodes**: Actual views (EditorGroupView instances)\n- **Orientation**: Determines split direction (horizontal = side-by-side, vertical = top-bottom)\n- **Sizing**: Each node has size, minimum, maximum constraints\n\n**Sources:**\n- [src/vs/base/browser/ui/grid/grid.ts:1-200]()\n- [src/vs/workbench/browser/parts/editor/editorPart.ts:400-600]()\n\n### Split Operations\n\nWhen splitting a group, the grid is reorganized:\n\n```mermaid\ngraph LR\n    Before[\"Before Split\u003cbr/\u003eGrid with Group A\"]\n    Operation[\"Split Operation\u003cbr/\u003edirection: RIGHT\"]\n    After[\"After Split\u003cbr/\u003eGrid with Branch(A, B)\"]\n    \n    Before --\u003e|\"splitGroup()\"| Operation\n    Operation --\u003e|\"reorganize\"| After\n```\n\n**Split Process:**\n1. Client calls `editorGroupService.addGroup(referenceGroup, direction)`\n2. `EditorPart` determines where to insert new group in grid\n3. Grid creates new branch node if needed with correct orientation\n4. New `EditorGroupView` is instantiated and added\n5. Grid is laid out with new dimensions\n\n**Sources:**\n- [src/vs/workbench/browser/parts/editor/editorPart.ts:700-900]()\n- [src/vs/workbench/services/editor/common/editorGroupsService.ts:400-500]()\n\n### Merge Operations\n\nMerging groups combines their editors:\n\n| Mode | Enum Value | Behavior |\n|------|------------|----------|\n| Copy editors to target | `COPY_EDITORS` | Copy source editors to target, keep source |\n| Move editors to target | `MOVE_EDITORS` | Move source editors to target, close source |\n| Move all to new group | `GROUP_TO_NEW_GROUP` | Create new group with all editors from both |\n\n**Sources:**\n- [src/vs/workbench/browser/parts/editor/editorPart.ts:1000-1200]()\n- [src/vs/workbench/services/editor/common/editorGroupsService.ts:60-90]()\n\n## Multi-Window Support\n\nVS Code supports opening editors in auxiliary windows through the `EditorParts` service, which coordinates between the main editor part and auxiliary editor parts.\n\n### EditorParts Coordination\n\n```mermaid\ngraph TB\n    EditorParts[\"EditorParts\u003cbr/\u003e(implements IEditorGroupsService)\"]\n    MainPart[\"mainPart: EditorPart\"]\n    AuxParts[\"auxiliaryParts: Map\u0026lt;number, AuxiliaryEditorPart\u0026gt;\"]\n    AuxWindow1[\"AuxiliaryEditorPart\u003cbr/\u003e(window 1)\"]\n    AuxWindow2[\"AuxiliaryEditorPart\u003cbr/\u003e(window 2)\"]\n    \n    EditorParts --\u003e|\"always present\"| MainPart\n    EditorParts --\u003e|\"manages\"| AuxParts\n    AuxParts --\u003e|\"windowId -\u0026gt; part\"| AuxWindow1\n    AuxParts --\u003e|\"windowId -\u0026gt; part\"| AuxWindow2\n    \n    AuxWindow1 --\u003e|\"creates via\"| IAuxiliaryWindowService[\"IAuxiliaryWindowService\"]\n```\n\n### Moving Editors Between Windows\n\nEditors can be moved between main and auxiliary windows:\n\n| Command | ID | Description |\n|---------|----|-|\n| Move to New Window | `MOVE_EDITOR_INTO_NEW_WINDOW_COMMAND_ID` | Move active editor to new auxiliary window |\n| Copy to New Window | `COPY_EDITOR_INTO_NEW_WINDOW_COMMAND_ID` | Copy active editor to new auxiliary window |\n| Move Group to New Window | `MOVE_EDITOR_GROUP_INTO_NEW_WINDOW_COMMAND_ID` | Move entire group to new window |\n| Copy Group to New Window | `COPY_EDITOR_GROUP_INTO_NEW_WINDOW_COMMAND_ID` | Copy entire group to new window |\n\n**Sources:**\n- [src/vs/workbench/browser/parts/editor/editorParts.ts:100-500]()\n- [src/vs/workbench/browser/parts/editor/editorCommands.ts:1-100]()\n\n### Auxiliary Editor Part Lifecycle\n\n```mermaid\nsequenceDiagram\n    participant Client\n    participant EditorParts\n    participant AuxWindowService\n    participant AuxWindow\n    participant AuxEditorPart\n    \n    Client-\u003e\u003eEditorParts: moveEditorToNewWindow()\n    EditorParts-\u003e\u003eAuxWindowService: createAuxiliaryWindow()\n    AuxWindowService-\u003e\u003eAuxWindow: open new window\n    AuxWindow--\u003e\u003eAuxWindowService: window created\n    AuxWindowService-\u003e\u003eAuxEditorPart: createAuxiliaryTitlebarPart()\n    AuxEditorPart--\u003e\u003eEditorParts: part registered\n    EditorParts-\u003e\u003eAuxEditorPart: openEditor(editor)\n    AuxEditorPart--\u003e\u003eClient: editor opened\n```\n\n**Sources:**\n- [src/vs/workbench/browser/parts/editor/editorParts.ts:200-400]()\n- [src/vs/workbench/browser/parts/editor/auxiliaryEditorPart.ts:1-200]()\n\n## Editor Options and Configuration\n\nEditor behavior is controlled through `IEditorPartOptions`, which are synchronized across all editor parts.\n\n### Configuration Properties\n\n| Setting | Type | Default | Description |\n|---------|------|---------|-------------|\n| `showTabs` | `EditorTabsMode` | `'multiple'` | How to show editor tabs (multiple, single, none) |\n| `openPositioning` | `'left'\\|'right'\\|'first'\\|'last'` | `'right'` | Where new editors open |\n| `enablePreview` | `boolean` | `true` | Whether preview mode is enabled |\n| `tabCloseButton` | `'left'\\|'right'\\|'off'` | `'right'` | Tab close button position |\n| `tabSizing` | `'fit'\\|'shrink'\\|'fixed'` | `'fit'` | How tab sizes are computed |\n| `pinnedTabSizing` | `'normal'\\|'compact'\\|'shrink'` | `'normal'` | How pinned tabs are sized |\n| `splitSizing` | `'auto'\\|'distribute'\\|'split'` | `'auto'` | How groups are sized when splitting |\n\n**Sources:**\n- [src/vs/workbench/browser/parts/editor/editor.ts:30-150]()\n- [src/vs/workbench/browser/workbench.contribution.ts:60-290]()\n\n### Options Change Handling\n\n```mermaid\ngraph LR\n    ConfigService[\"IConfigurationService\u003cbr/\u003eonDidChangeConfiguration\"]\n    GetOptions[\"getEditorPartOptions()\"]\n    Compare[\"impactsEditorPartOptions()\"]\n    EditorPart[\"EditorPart\"]\n    Groups[\"All EditorGroupViews\"]\n    \n    ConfigService --\u003e|\"config change event\"| GetOptions\n    GetOptions --\u003e Compare\n    Compare --\u003e|\"if impacts\"| EditorPart\n    EditorPart --\u003e|\"fire event\"| Groups\n    Groups --\u003e|\"update UI\"| Groups\n```\n\n**Sources:**\n- [src/vs/workbench/browser/parts/editor/editor.ts:200-350]()\n- [src/vs/workbench/browser/parts/editor/editorPart.ts:300-500]()\n\n## Summary\n\nThe editor service and groups system provides:\n\n1. **`IEditorService`** - Unified API for opening, closing, and managing editors across all groups and windows\n2. **`IEditorGroupsService`** - Management of editor groups, their arrangement, and lifecycle\n3. **`EditorPart`** - Physical container using a grid-based layout system for flexible editor organization\n4. **`EditorGroupView`** - Individual groups managing their own set of editors, tabs, and state\n5. **Multi-window support** - Auxiliary editor parts enabling editors in separate windows\n6. **Grid layout** - Flexible splitting, merging, and resizing of editor groups\n7. **Scoped services** - Each group has its own context keys and service scope\n\nThis architecture enables VS Code's flexible editor management while maintaining clean separation between UI (groups), lifecycle (service), and individual editors (panes).\n\n**Sources:**\n- [src/vs/workbench/services/editor/common/editorService.ts:1-100]()\n- [src/vs/workbench/services/editor/common/editorGroupsService.ts:1-100]()\n- [src/vs/workbench/browser/parts/editor/editor.ts:1-100]()\n- [src/vs/workbench/browser/parts/editor/editorPart.ts:1-200]()\n- [src/vs/workbench/browser/parts/editor/editorGroupView.ts:1-250]()"])</script><script>self.__next_f.push([1,"26:T72b3,"])</script><script>self.__next_f.push([1,"# Editor Input and Pane System\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [src/vs/platform/editor/common/editor.ts](src/vs/platform/editor/common/editor.ts)\n- [src/vs/workbench/browser/actions/layoutActions.ts](src/vs/workbench/browser/actions/layoutActions.ts)\n- [src/vs/workbench/browser/contextkeys.ts](src/vs/workbench/browser/contextkeys.ts)\n- [src/vs/workbench/browser/dnd.ts](src/vs/workbench/browser/dnd.ts)\n- [src/vs/workbench/browser/layout.ts](src/vs/workbench/browser/layout.ts)\n- [src/vs/workbench/browser/parts/auxiliarybar/auxiliaryBarActions.ts](src/vs/workbench/browser/parts/auxiliarybar/auxiliaryBarActions.ts)\n- [src/vs/workbench/browser/parts/editor/editor.contribution.ts](src/vs/workbench/browser/parts/editor/editor.contribution.ts)\n- [src/vs/workbench/browser/parts/editor/editor.ts](src/vs/workbench/browser/parts/editor/editor.ts)\n- [src/vs/workbench/browser/parts/editor/editorActions.ts](src/vs/workbench/browser/parts/editor/editorActions.ts)\n- [src/vs/workbench/browser/parts/editor/editorCommands.ts](src/vs/workbench/browser/parts/editor/editorCommands.ts)\n- [src/vs/workbench/browser/parts/editor/editorDropTarget.ts](src/vs/workbench/browser/parts/editor/editorDropTarget.ts)\n- [src/vs/workbench/browser/parts/editor/editorGroupView.ts](src/vs/workbench/browser/parts/editor/editorGroupView.ts)\n- [src/vs/workbench/browser/parts/editor/editorPart.ts](src/vs/workbench/browser/parts/editor/editorPart.ts)\n- [src/vs/workbench/browser/parts/panel/panelActions.ts](src/vs/workbench/browser/parts/panel/panelActions.ts)\n- [src/vs/workbench/browser/parts/titlebar/titlebarActions.ts](src/vs/workbench/browser/parts/titlebar/titlebarActions.ts)\n- [src/vs/workbench/browser/workbench.contribution.ts](src/vs/workbench/browser/workbench.contribution.ts)\n- [src/vs/workbench/browser/workbench.ts](src/vs/workbench/browser/workbench.ts)\n- [src/vs/workbench/common/contextkeys.ts](src/vs/workbench/common/contextkeys.ts)\n- [src/vs/workbench/common/editor.ts](src/vs/workbench/common/editor.ts)\n- [src/vs/workbench/services/editor/browser/editorService.ts](src/vs/workbench/services/editor/browser/editorService.ts)\n- [src/vs/workbench/services/editor/common/editorGroupsService.ts](src/vs/workbench/services/editor/common/editorGroupsService.ts)\n- [src/vs/workbench/services/editor/common/editorService.ts](src/vs/workbench/services/editor/common/editorService.ts)\n- [src/vs/workbench/services/editor/test/browser/editorGroupsService.test.ts](src/vs/workbench/services/editor/test/browser/editorGroupsService.test.ts)\n- [src/vs/workbench/services/editor/test/browser/editorService.test.ts](src/vs/workbench/services/editor/test/browser/editorService.test.ts)\n- [src/vs/workbench/services/layout/browser/layoutService.ts](src/vs/workbench/services/layout/browser/layoutService.ts)\n- [src/vs/workbench/test/browser/workbenchTestServices.ts](src/vs/workbench/test/browser/workbenchTestServices.ts)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis document describes the editor input and pane system, which is the core abstraction for representing editable content (inputs) and their visual presentation (panes) in VS Code. This system enables VS Code to support multiple editor types (text, diff, custom) and provides the foundation for editor lifecycle management, serialization, and the multi-editor experience.\n\nFor information about how editors are organized into groups and the overall editor part layout, see [Editor Service and Groups](#4.2). For information about view system contributions, see [View System and Contributions](#4.4).\n\n## Core Abstractions\n\nThe editor system is built around two primary abstractions: **EditorInput** and **EditorPane**.\n\n### EditorInput: Representing Editable Content\n\n`EditorInput` is an abstract class that represents a unit of editable content. It is the model layer in the editor architecture and is independent of any visual representation.\n\n```mermaid\ngraph TB\n    EditorInput[\"EditorInput\u003cbr/\u003e(abstract class)\"]\n    FileEditorInput[\"FileEditorInput\u003cbr/\u003e(file:// resources)\"]\n    UntitledTextEditorInput[\"UntitledTextEditorInput\u003cbr/\u003e(unsaved files)\"]\n    DiffEditorInput[\"DiffEditorInput\u003cbr/\u003e(comparison view)\"]\n    SideBySideEditorInput[\"SideBySideEditorInput\u003cbr/\u003e(dual pane view)\"]\n    TextResourceEditorInput[\"TextResourceEditorInput\u003cbr/\u003e(read-only resources)\"]\n    CustomEditorInput[\"Custom Editor Inputs\u003cbr/\u003e(extension-provided)\"]\n    \n    EditorInput --\u003e FileEditorInput\n    EditorInput --\u003e UntitledTextEditorInput\n    EditorInput --\u003e DiffEditorInput\n    EditorInput --\u003e SideBySideEditorInput\n    EditorInput --\u003e TextResourceEditorInput\n    EditorInput --\u003e CustomEditorInput\n```\n\n**Key responsibilities of EditorInput:**\n\n| Responsibility | Description |\n|----------------|-------------|\n| Identity | Provides unique identification via `typeId` and `resource` |\n| Capabilities | Declares capabilities via `EditorInputCapabilities` enum |\n| Lifecycle | Manages resolve/save/revert operations |\n| Metadata | Provides name, description, title, icon |\n| Dirty state | Tracks unsaved changes |\n| Serialization | Supports persistence across sessions |\n\nSources: [src/vs/workbench/common/editor.ts:710-1057](), [src/vs/workbench/common/editor/editorInput.ts]()\n\n### EditorPane: Visual Container for Editors\n\n`EditorPane` is an abstract class that represents the visual container and UI for editing content. An `EditorPane` renders and manages the UI for one or more `EditorInput` instances.\n\n```mermaid\ngraph TB\n    IEditorPane[\"IEditorPane\u003cbr/\u003e(interface)\"]\n    EditorPane[\"EditorPane\u003cbr/\u003e(abstract base)\"]\n    TextResourceEditor[\"TextResourceEditor\u003cbr/\u003e(text files)\"]\n    TextDiffEditor[\"TextDiffEditor\u003cbr/\u003e(diff view)\"]\n    SideBySideEditor[\"SideBySideEditor\u003cbr/\u003e(side-by-side view)\"]\n    CustomEditorPane[\"Custom Editor Panes\u003cbr/\u003e(extension-provided)\"]\n    \n    IEditorPane --\u003e EditorPane\n    EditorPane --\u003e TextResourceEditor\n    EditorPane --\u003e TextDiffEditor\n    EditorPane --\u003e SideBySideEditor\n    EditorPane --\u003e CustomEditorPane\n    \n    EditorPane -.\"`input: EditorInput`\".-\u003e EditorInput[\"EditorInput\"]\n    EditorPane -.\"`getControl(): IEditorControl`\".-\u003e ICodeEditor[\"ICodeEditor\u003cbr/\u003eIDiffEditor\u003cbr/\u003eetc.\"]\n```\n\n**Key responsibilities of EditorPane:**\n\n| Responsibility | Description |\n|----------------|-------------|\n| Rendering | Creates and manages DOM elements for editing |\n| Input lifecycle | Handles `setInput()` to bind EditorInput to the pane |\n| Control access | Provides access to underlying editor widget via `getControl()` |\n| View state | Manages editor-specific view state (scroll, selection) |\n| Size constraints | Defines minimum/maximum width/height |\n| Context | Provides scoped `IContextKeyService` |\n\nSources: [src/vs/workbench/common/editor.ts:85-210](), [src/vs/workbench/browser/parts/editor/editorPane.ts]()\n\n### Relationship: Input to Pane Mapping\n\nThe mapping between `EditorInput` types and `EditorPane` implementations is managed through a registration system.\n\n```mermaid\ngraph LR\n    OpenEditor[\"editorService.openEditor()\"]\n    ResolvePane[\"EditorResolverService\u003cbr/\u003eresolve input  pane\"]\n    Registry[\"EditorPaneRegistry\u003cbr/\u003etypeId  descriptor\"]\n    Instantiate[\"Instantiate EditorPane\"]\n    SetInput[\"editorPane.setInput(input)\"]\n    \n    OpenEditor --\u003e ResolvePane\n    ResolvePane --\u003e Registry\n    Registry --\u003e Instantiate\n    Instantiate --\u003e SetInput\n```\n\nSources: [src/vs/workbench/services/editor/browser/editorResolverService.ts](), [src/vs/workbench/browser/editor.ts:77-83]()\n\n## Editor Input Lifecycle\n\n### Creation and Identity\n\nEvery `EditorInput` must provide:\n- **typeId**: A unique string identifying the input type\n- **resource**: Optional URI representing the underlying resource\n- **capabilities**: Bitmask of `EditorInputCapabilities` flags\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e Created: Instantiate EditorInput\n    Created --\u003e Resolving: resolve() called\n    Resolving --\u003e Resolved: Model loaded\n    Resolved --\u003e Dirty: User edits\n    Dirty --\u003e Saving: save() called\n    Saving --\u003e Resolved: Save complete\n    Resolved --\u003e Disposed: dispose() called\n    Dirty --\u003e Disposed: dispose() called\n    Disposed --\u003e [*]\n```\n\n**EditorInputCapabilities** define behavioral characteristics:\n\n| Capability | Description |\n|------------|-------------|\n| `Readonly` | Input cannot be edited |\n| `Untitled` | Input has no backing file |\n| `RequiresTrust` | Requires workspace trust to open |\n| `Singleton` | Only one instance can exist globally |\n| `CanDropIntoEditor` | Supports dropping into editor area |\n| `CanSplitInGroup` | Can be split within a single group |\n\nSources: [src/vs/workbench/common/editor.ts:795-827]()\n\n### Resolution and Model Loading\n\nWhen an editor input is opened, it may need to load its underlying model via `resolve()`:\n\n```mermaid\nsequenceDiagram\n    participant ES as EditorService\n    participant EGV as EditorGroupView\n    participant EP as EditorPane\n    participant EI as EditorInput\n    participant Model as Model/Document\n    \n    ES-\u003e\u003eEGV: openEditor(input, options)\n    EGV-\u003e\u003eEP: openEditor(input, options)\n    EP-\u003e\u003eEI: resolve()\n    EI-\u003e\u003eModel: Load/create model\n    Model--\u003e\u003eEI: Return model\n    EI--\u003e\u003eEP: Return resolved model\n    EP-\u003e\u003eEP: setInput(input)\n    EP-\u003e\u003eEP: Render UI with model\n```\n\nSources: [src/vs/workbench/browser/parts/editor/editorGroupView.ts:1031-1172]()\n\n### Dirty State and Save Lifecycle\n\nEditors track unsaved changes through the `isDirty()` method:\n\n```mermaid\ngraph TB\n    Clean[\"Clean State\u003cbr/\u003eisDirty() = false\"]\n    Dirty[\"Dirty State\u003cbr/\u003eisDirty() = true\"]\n    Saving[\"Saving\u003cbr/\u003eisSaving() = true\"]\n    Reverting[\"Reverting\"]\n    \n    Clean --\u003e|\"User edits\"| Dirty\n    Dirty --\u003e|\"save()\"| Saving\n    Saving --\u003e|\"Success\"| Clean\n    Saving --\u003e|\"Failure\"| Dirty\n    Dirty --\u003e|\"revert()\"| Reverting\n    Reverting --\u003e Clean\n    \n    Dirty -.\"`onDidChangeDirty` event\".-\u003e Listeners[\"Listeners\u003cbr/\u003e(tab UI, context keys, etc.)\"]\n```\n\nKey methods:\n- `isDirty(): boolean` - Check if input has unsaved changes\n- `isSaving(): boolean` - Check if save is in progress\n- `save(group, options): Promise\u003cIEditorInput | undefined\u003e` - Save changes\n- `revert(group, options): Promise\u003cvoid\u003e` - Discard changes\n- `onDidChangeDirty: Event\u003cvoid\u003e` - Fired when dirty state changes\n\nSources: [src/vs/workbench/common/editor.ts:877-932]()\n\n### Disposal and Cleanup\n\nWhen an editor input is no longer needed:\n\n```mermaid\nsequenceDiagram\n    participant EGM as EditorGroupModel\n    participant EI as EditorInput\n    participant Listeners as Event Listeners\n    \n    EGM-\u003e\u003eEI: dispose()\n    EI-\u003e\u003eListeners: Fire onWillDispose event\n    EI-\u003e\u003eEI: Clean up resources\n    EI-\u003e\u003eEI: Dispose underlying model\n    EI--\u003e\u003eEGM: Disposed\n```\n\nImportant: Editor inputs may be reference-counted when shared across groups. Actual disposal only occurs when the last reference is removed.\n\nSources: [src/vs/workbench/common/editor/editorInput.ts]()\n\n## Editor Pane Lifecycle\n\n### Instantiation and Registration\n\nEditor panes are registered using `EditorPaneDescriptor` in the `EditorPaneRegistry`:\n\n```mermaid\ngraph LR\n    Register[\"Registry.as\u003cbr/\u003eEditorExtensions.EditorPane\"]\n    Descriptor[\"EditorPaneDescriptor.create\u003cbr/\u003e(ctor, typeId, name)\"]\n    InputTypes[\"SyncDescriptor array\u003cbr/\u003e(compatible input types)\"]\n    \n    Register --\u003e Descriptor\n    Descriptor --\u003e InputTypes\n```\n\nExample registration structure:\n\n```\nEditorPaneDescriptor.create(\n  TextResourceEditor,           // Pane class\n  TextResourceEditor.ID,        // Unique pane ID\n  \"Text Editor\"                 // Display name\n)\nSupported inputs: [\n  UntitledTextEditorInput,\n  TextResourceEditorInput\n]\n```\n\nSources: [src/vs/workbench/browser/parts/editor/editor.contribution.ts:79-89]()\n\n### Input Assignment via setInput()\n\nThe `setInput()` method binds an `EditorInput` to the pane:\n\n```mermaid\nsequenceDiagram\n    participant EGV as EditorGroupView\n    participant EP as EditorPane\n    participant EI as EditorInput\n    participant Control as Editor Control\n    \n    EGV-\u003e\u003eEP: setInput(input, options, context)\n    EP-\u003e\u003eEI: resolve()\n    EI--\u003e\u003eEP: Resolved model\n    EP-\u003e\u003eEP: createEditor(parent)\n    EP-\u003e\u003eControl: Create/update editor control\n    EP-\u003e\u003eControl: setModel(model)\n    EP-\u003e\u003eEP: Apply options (selection, etc.)\n    EP--\u003e\u003eEGV: Input set\n```\n\nThe `setInput()` implementation pattern:\n\n1. Check if input is already set (optimization)\n2. Call `super.setInput()` to update base state\n3. Resolve the input to get its model\n4. Update the underlying editor control\n5. Apply any editor options (selection, reveal, etc.)\n6. Handle any errors\n\nSources: [src/vs/workbench/browser/parts/editor/textResourceEditor.ts](), [src/vs/workbench/browser/parts/editor/textEditor.ts]()\n\n### Editor Control Access\n\nThe `getControl()` method provides access to the underlying editor widget:\n\n```mermaid\ngraph TB\n    EditorPane[\"EditorPane\u003cbr/\u003egetControl(): IEditorControl\"]\n    TextEditorPane[\"TextEditorPane\u003cbr/\u003egetControl(): ICodeEditor\"]\n    DiffEditorPane[\"TextDiffEditor\u003cbr/\u003egetControl(): IDiffEditor\"]\n    CustomPane[\"CustomEditorPane\u003cbr/\u003egetControl(): custom widget\"]\n    \n    EditorPane --\u003e TextEditorPane\n    EditorPane --\u003e DiffEditorPane\n    EditorPane --\u003e CustomPane\n    \n    TextEditorPane -.returns.-\u003e ICodeEditor[\"ICodeEditor\u003cbr/\u003e(Monaco editor)\"]\n    DiffEditorPane -.returns.-\u003e IDiffEditor[\"IDiffEditor\u003cbr/\u003e(Monaco diff)\"]\n    CustomPane -.returns.-\u003e CustomControl[\"Custom Control\"]\n```\n\nCallers must cast to the specific control type using helpers like:\n- `isCodeEditor(control)` \n- `isDiffEditor(control)`\n- `isCompositeEditor(control)`\n\nSources: [src/vs/workbench/common/editor.ts:168](), [src/vs/editor/browser/editorBrowser.ts]()\n\n### View State Persistence\n\nEditor panes can save and restore view state (scroll position, selection, etc.):\n\n```mermaid\nsequenceDiagram\n    participant EGV as EditorGroupView\n    participant EP as EditorPane\n    participant VS as ViewState Storage\n    \n    Note over EGV,VS: When editor is hidden\n    EGV-\u003e\u003eEP: getViewState()\n    EP--\u003e\u003eEGV: Return view state object\n    EGV-\u003e\u003eVS: Store view state\n    \n    Note over EGV,VS: When editor is reopened\n    VS-\u003e\u003eEGV: Retrieve view state\n    EGV-\u003e\u003eEP: setInput(input, {viewState})\n    EP-\u003e\u003eEP: Apply view state\n```\n\nView state includes:\n- Text editor: Scroll position, selection, folding state\n- Diff editor: Scroll sync, ignore trim whitespace setting\n- Custom editors: Editor-specific state\n\nSources: [src/vs/workbench/common/editor.ts:176-177](), [src/vs/workbench/browser/parts/editor/textEditor.ts]()\n\n## Editor Registration System\n\n### EditorPaneRegistry\n\nThe `EditorPaneRegistry` maintains the mapping from editor pane IDs to their descriptors:\n\n```mermaid\ngraph TB\n    subgraph \"Registry.as\u003cEditorExtensions.EditorPane\u003e\"\n        EPR[\"IEditorPaneRegistry\"]\n    end\n    \n    subgraph \"Registered Panes\"\n        TEP[\"TextResourceEditor\u003cbr/\u003eID: 'workbench.editors.textResourceEditor'\"]\n        TDE[\"TextDiffEditor\u003cbr/\u003eID: 'workbench.editors.textDiffEditor'\"]\n        BRDE[\"BinaryResourceDiffEditor\u003cbr/\u003eID: 'workbench.editors.binaryResourceDiffEditor'\"]\n        SBSE[\"SideBySideEditor\u003cbr/\u003eID: 'workbench.editor.sidebysideEditor'\"]\n    end\n    \n    EPR --\u003e TEP\n    EPR --\u003e TDE\n    EPR --\u003e BRDE\n    EPR --\u003e SBSE\n    \n    TEP -.supports.-\u003e UTI[\"UntitledTextEditorInput\u003cbr/\u003eTextResourceEditorInput\"]\n    TDE -.supports.-\u003e DEI[\"DiffEditorInput\"]\n    SBSE -.supports.-\u003e SBSEI[\"SideBySideEditorInput\"]\n```\n\nSources: [src/vs/workbench/browser/parts/editor/editor.contribution.ts:79-122](), [src/vs/workbench/browser/editor.ts:115-146]()\n\n### EditorFactoryRegistry\n\nThe `EditorFactoryRegistry` manages serialization/deserialization of editor inputs for session restore:\n\n```mermaid\ngraph TB\n    Registry[\"IEditorFactoryRegistry\"]\n    Serializers[\"Registered Serializers\"]\n    \n    Registry --\u003e UTI_S[\"UntitledTextEditorInputSerializer\"]\n    Registry --\u003e SBSEI_S[\"SideBySideEditorInputSerializer\"]\n    Registry --\u003e DEI_S[\"DiffEditorInputSerializer\"]\n    Registry --\u003e FEI_F[\"FileEditorFactory\"]\n    \n    UTI_S -.serializes.-\u003e UTI[\"UntitledTextEditorInput\"]\n    SBSEI_S -.serializes.-\u003e SBSEI[\"SideBySideEditorInput\"]\n    DEI_S -.serializes.-\u003e DEI[\"DiffEditorInput\"]\n    FEI_F -.creates.-\u003e FEI[\"FileEditorInput\"]\n```\n\n**IEditorSerializer interface:**\n\n```\ninterface IEditorSerializer {\n  canSerialize(editor: EditorInput): boolean\n  serialize(editor: EditorInput): string | undefined\n  deserialize(instantiationService, serialized: string): EditorInput | undefined\n}\n```\n\nSerialization flow:\n1. On window close: Each open `EditorInput` is serialized to JSON\n2. Stored in workspace/profile storage\n3. On window open: JSON is deserialized back to `EditorInput` instances\n4. Inputs are reopened in their original groups\n\nSources: [src/vs/workbench/common/editor.ts:423-475](), [src/vs/workbench/browser/parts/editor/editor.contribution.ts:124-126]()\n\n## Editor Resolution Process\n\n### Resolution Pipeline\n\nWhen opening an editor, the system resolves the input to determine which pane should display it:\n\n```mermaid\ngraph TB\n    Open[\"editorService.openEditor(input)\"]\n    Resolver[\"EditorResolverService\"]\n    Override[\"Check for override\u003cbr/\u003e(user preference/extension)\"]\n    Default[\"Find default editor\"]\n    Registry[\"Query EditorPaneRegistry\"]\n    Instantiate[\"Instantiate EditorPane\"]\n    \n    Open --\u003e Resolver\n    Resolver --\u003e Override\n    Override --\u003e|\"Has override\"| Instantiate\n    Override --\u003e|\"No override\"| Default\n    Default --\u003e Registry\n    Registry --\u003e Instantiate\n```\n\nSources: [src/vs/workbench/services/editor/browser/editorResolverService.ts]()\n\n### Priority System\n\nThe editor resolver uses a priority system to determine which editor to use:\n\n| Priority Level | Description | Example |\n|----------------|-------------|---------|\n| `exclusive` | Only editor that can open this input | Binary file editor |\n| `default` | Preferred editor for this input type | Text editor for .txt files |\n| `option` | Available as alternative | Hex editor for any file |\n\n```mermaid\ngraph LR\n    Input[\"EditorInput\u003cbr/\u003eResource: file.json\"]\n    Check1{Has exclusive\u003cbr/\u003eeditor?}\n    Check2{Has default\u003cbr/\u003eeditor?}\n    Check3{Show picker}\n    \n    Input --\u003e Check1\n    Check1 --\u003e|Yes| Exclusive[\"Use exclusive editor\"]\n    Check1 --\u003e|No| Check2\n    Check2 --\u003e|Yes| Default[\"Use default editor\"]\n    Check2 --\u003e|No| Check3\n    Check3 --\u003e User[\"User selects from options\"]\n```\n\nSources: [src/vs/workbench/services/editor/common/editorResolverService.ts]()\n\n### Custom Editor Association\n\nUsers can override default editor associations:\n\n```mermaid\nsequenceDiagram\n    participant User\n    participant Resolver as EditorResolverService\n    participant Config as Configuration Service\n    participant Registry as EditorPaneRegistry\n    \n    User-\u003e\u003eResolver: \"Reopen With...\" command\n    Resolver-\u003e\u003eRegistry: Get available editors for resource\n    Registry--\u003e\u003eResolver: List of compatible editors\n    Resolver-\u003e\u003eUser: Show quick pick\n    User-\u003e\u003eResolver: Select editor\n    Resolver-\u003e\u003eConfig: Save association (if \"remember\")\n    Resolver-\u003e\u003eRegistry: Get selected editor descriptor\n    Registry--\u003e\u003eResolver: Editor descriptor\n```\n\nConfiguration format:\n```json\n\"workbench.editorAssociations\": {\n  \"*.md\": \"vscode.markdown.preview.editor\",\n  \"*.ipynb\": \"jupyter.notebook.ipynb\"\n}\n```\n\nSources: [src/vs/workbench/browser/parts/editor/editorCommands.ts:63-64]()\n\n## Built-in Editor Input Types\n\n### FileEditorInput\n\nRepresents a file from the file system:\n\n```mermaid\ngraph TB\n    FileEditorInput[\"FileEditorInput\"]\n    Props[\"Properties\"]\n    Caps[\"Capabilities\"]\n    \n    FileEditorInput --\u003e Props\n    FileEditorInput --\u003e Caps\n    \n    Props --\u003e Resource[\"resource: URI\u003cbr/\u003e(file path)\"]\n    Props --\u003e PreferredResource[\"preferredResource: URI\u003cbr/\u003e(for symbolic links)\"]\n    Props --\u003e Encoding[\"preferredEncoding: string\"]\n    Props --\u003e Language[\"preferredLanguage: string\"]\n    Props --\u003e Contents[\"preferredContents: string\u003cbr/\u003e(initial content)\"]\n    \n    Caps --\u003e Saveable[\" Can be saved\"]\n    Caps --\u003e Dirty[\" Tracks dirty state\"]\n    Caps --\u003e Encoding2[\" Encoding support\"]\n    Caps --\u003e Rename[\" Supports rename\"]\n```\n\nKey features:\n- Backed by `ITextFileService` for save/revert operations\n- Supports encoding detection and conversion\n- Integrates with file watcher for external changes\n- Provides `IEncodingSupport` and `ILanguageSupport`\n\nSources: [src/vs/workbench/contrib/files/browser/editors/fileEditorInput.ts]()\n\n### UntitledTextEditorInput\n\nRepresents a new, unsaved text file:\n\n```mermaid\ngraph TB\n    UntitledInput[\"UntitledTextEditorInput\"]\n    Model[\"UntitledTextEditorModel\"]\n    Service[\"IUntitledTextEditorService\"]\n    \n    UntitledInput -.uses.-\u003e Service\n    Service -.manages.-\u003e Model\n    \n    UntitledInput --\u003e Props[\"Properties\"]\n    Props --\u003e Resource[\"resource: URI\u003cbr/\u003e(untitled:// scheme)\"]\n    Props --\u003e InitialValue[\"initialValue: string\"]\n    Props --\u003e Language[\"language: string\"]\n    Props --\u003e AssociatedPath[\"associatedResource: URI\u003cbr/\u003e(for save as target)\"]\n    \n    UntitledInput --\u003e Behavior[\"Behavior\"]\n    Behavior --\u003e AlwaysDirty[\"Always dirty until saved\"]\n    Behavior --\u003e SaveAs[\"Prompts for path on save\"]\n    Behavior --\u003e Associated[\"Associated path = suggested name\"]\n```\n\nCharacteristics:\n- `resource.scheme === 'untitled'`\n- Always considered dirty (`isDirty() === true`)\n- Can have associated file path (for \"Save As\" hint)\n- Saved via \"Save As\" workflow\n\nSources: [src/vs/workbench/services/untitled/common/untitledTextEditorInput.ts]()\n\n### DiffEditorInput\n\nRepresents a comparison between two editor inputs:\n\n```mermaid\ngraph TB\n    DiffEditorInput[\"DiffEditorInput\"]\n    Original[\"original: EditorInput\u003cbr/\u003e(left/modified)\"]\n    Modified[\"modified: EditorInput\u003cbr/\u003e(right/original)\"]\n    Pane[\"TextDiffEditor\u003cbr/\u003e(pane)\"]\n    \n    DiffEditorInput --\u003e Original\n    DiffEditorInput --\u003e Modified\n    DiffEditorInput -.rendered by.-\u003e Pane\n    \n    Pane --\u003e DiffControl[\"IDiffEditor\u003cbr/\u003e(Monaco diff widget)\"]\n    DiffControl --\u003e OriginalEditor[\"Original Editor\u003cbr/\u003e(left side)\"]\n    DiffControl --\u003e ModifiedEditor[\"Modified Editor\u003cbr/\u003e(right side)\"]\n    \n    DiffEditorInput --\u003e Metadata[\"Metadata\"]\n    Metadata --\u003e Label[\"Combines names\u003cbr/\u003e'left  right'\"]\n    Metadata --\u003e Dirty[\"Dirty if modified is dirty\"]\n    Metadata --\u003e Save[\"Save delegates to modified\"]\n```\n\nKey behaviors:\n- Name combines both inputs: `{original.name}  {modified.name}`\n- Dirty state follows the `modified` input\n- Save operations delegate to the `modified` input\n- Supports swap operation (`DIFF_SWAP_SIDES` command)\n\nSources: [src/vs/workbench/common/editor/diffEditorInput.ts]()\n\n### SideBySideEditorInput\n\nShows two editors side-by-side without comparison highlighting:\n\n```mermaid\ngraph TB\n    SideBySide[\"SideBySideEditorInput\"]\n    Primary[\"primary: EditorInput\u003cbr/\u003e(right/main)\"]\n    Secondary[\"secondary: EditorInput\u003cbr/\u003e(left/auxiliary)\"]\n    Pane[\"SideBySideEditor\u003cbr/\u003e(pane)\"]\n    \n    SideBySide --\u003e Primary\n    SideBySide --\u003e Secondary\n    SideBySide -.rendered by.-\u003e Pane\n    \n    Pane --\u003e PrimaryPane[\"Primary Pane\u003cbr/\u003e(right side)\"]\n    Pane --\u003e SecondaryPane[\"Secondary Pane\u003cbr/\u003e(left side)\"]\n    \n    SideBySide --\u003e Focus[\"Focus Management\"]\n    Focus --\u003e Commands[\"FOCUS_FIRST_SIDE_EDITOR\u003cbr/\u003eFOCUS_SECOND_SIDE_EDITOR\u003cbr/\u003eFOCUS_OTHER_SIDE_EDITOR\"]\n```\n\nDifference from DiffEditorInput:\n- No diff highlighting or decoration\n- Each side is an independent editor pane\n- Used for reference/comparison without merge semantics\n- Focus can be independently controlled per side\n\nSources: [src/vs/workbench/common/editor/sideBySideEditorInput.ts](), [src/vs/workbench/browser/parts/editor/sideBySideEditor.ts]()\n\n### TextResourceEditorInput\n\nRepresents read-only text content (often from non-file sources):\n\n```mermaid\ngraph TB\n    TextResource[\"TextResourceEditorInput\"]\n    Props[\"Properties\"]\n    Use[\"Use Cases\"]\n    \n    TextResource --\u003e Props\n    Props --\u003e Resource[\"resource: URI\u003cbr/\u003e(any scheme)\"]\n    Props --\u003e Name[\"name: string\u003cbr/\u003e(display name)\"]\n    Props --\u003e Description[\"description: string\"]\n    Props --\u003e Contents[\"contents: string\u003cbr/\u003e(initial value)\"]\n    \n    TextResource --\u003e Use\n    Use --\u003e Output[\"Extension output\"]\n    Use --\u003e Virtual[\"Virtual documents\"]\n    Use --\u003e Readonly[\"Read-only views\"]\n    Use --\u003e Search[\"Search results\"]\n```\n\nCharacteristics:\n- Typically read-only (no save capability)\n- Can represent any URI scheme (not just `file://`)\n- Used by extensions for virtual documents\n- Lightweight compared to `FileEditorInput`\n\nSources: [src/vs/workbench/common/editor/textResourceEditorInput.ts]()\n\n## Integration with Editor Groups\n\n### Active Editor Concept\n\nWithin an editor group, one input can be active at a time:\n\n```mermaid\ngraph TB\n    Group[\"EditorGroupView\"]\n    Model[\"EditorGroupModel\"]\n    Editors[\"Editor Stack\"]\n    ActiveEditor[\"Active Editor\"]\n    Pane[\"EditorPane\"]\n    \n    Group --\u003e Model\n    Model --\u003e Editors\n    Editors --\u003e E1[\"EditorInput 1\"]\n    Editors --\u003e E2[\"EditorInput 2\"]\n    Editors --\u003e E3[\"EditorInput 3\u003cbr/\u003e(active)\"]\n    Editors --\u003e E4[\"EditorInput 4\"]\n    \n    Model -.tracks.-\u003e ActiveEditor\n    ActiveEditor -.corresponds to.-\u003e E3\n    E3 -.displayed in.-\u003e Pane\n    \n    Group --\u003e ContextKeys[\"Context Keys\"]\n    ContextKeys --\u003e ActiveEditorContext[\"ActiveEditorContext\"]\n    ContextKeys --\u003e ActiveEditorDirtyContext[\"ActiveEditorDirtyContext\"]\n    ContextKeys --\u003e ActiveEditorPinnedContext[\"ActiveEditorPinnedContext\"]\n```\n\nThe active editor determines:\n- Which `EditorPane` is visible\n- Which context keys are active\n- Which commands are available\n- What appears in the editor title area\n\nSources: [src/vs/workbench/browser/parts/editor/editorGroupView.ts:249-327]()\n\n### Opening Editors in Groups\n\nThe flow from opening an editor to displaying it:\n\n```mermaid\nsequenceDiagram\n    participant ES as EditorService\n    participant EGS as EditorGroupsService\n    participant EGV as EditorGroupView\n    participant Model as EditorGroupModel\n    participant Pane as EditorPane\n    \n    ES-\u003e\u003eEGS: openEditor(input, group)\n    EGS-\u003e\u003eEGV: Find/create group\n    EGV-\u003e\u003eModel: openEditor(input, options)\n    Model-\u003e\u003eModel: Add to editor stack\n    Model-\u003e\u003eModel: Set as active\n    Model--\u003e\u003eEGV: Group model changed\n    EGV-\u003e\u003eEGV: Fire onDidModelChange\n    EGV-\u003e\u003ePane: openEditor(input, options)\n    Pane-\u003e\u003ePane: setInput(input)\n    Pane-\u003e\u003ePane: Render UI\n    EGV--\u003e\u003eES: IEditorPane\n```\n\nSources: [src/vs/workbench/browser/parts/editor/editorGroupView.ts:988-1172](), [src/vs/workbench/services/editor/browser/editorService.ts:588-724]()\n\n### Editor Stack Management\n\nEach group maintains a stack of opened editors:\n\n```mermaid\ngraph TB\n    subgraph \"EditorGroupModel\"\n        Stack[\"Editor Stack\"]\n        Active[\"Active Index\"]\n        Preview[\"Preview Mode\"]\n        Pinned[\"Pinned Set\"]\n        Sticky[\"Sticky Set\"]\n    end\n    \n    Stack --\u003e E1[\"Editor 1 (sticky)\"]\n    Stack --\u003e E2[\"Editor 2 (pinned)\"]\n    Stack --\u003e E3[\"Editor 3 (active)\"]\n    Stack --\u003e E4[\"Editor 4 (preview)\"]\n    \n    Active -.points to.-\u003e E3\n    Pinned --\u003e E1\n    Pinned --\u003e E2\n    Sticky --\u003e E1\n    Preview -.is.-\u003e E4\n    \n    Operations[\"Operations\"]\n    Operations --\u003e OpenOp[\"openEditor()\"]\n    Operations --\u003e CloseOp[\"closeEditor()\"]\n    Operations --\u003e MoveOp[\"moveEditor()\"]\n    Operations --\u003e PinOp[\"pinEditor()\"]\n    Operations --\u003e StickOp[\"stickEditor()\"]\n```\n\nKey concepts:\n- **Sticky editors**: Always appear first, typically pinned\n- **Pinned editors**: Persist in the group (not preview)\n- **Preview editor**: Temporary editor, replaced by next preview\n- **Active editor**: Currently visible editor\n\nSources: [src/vs/workbench/common/editor/editorGroupModel.ts]()\n\n### Pane Reuse and Pooling\n\nEditor panes are pooled for performance:\n\n```mermaid\ngraph TB\n    EditorPanes[\"EditorPanes\u003cbr/\u003e(container)\"]\n    Registry[\"IEditorPaneRegistry\"]\n    Pool[\"Pane Pool\"]\n    \n    EditorPanes --\u003e Registry\n    EditorPanes --\u003e Pool\n    \n    Pool --\u003e Pane1[\"TextResourceEditor\u003cbr/\u003e(instance 1)\"]\n    Pool --\u003e Pane2[\"TextDiffEditor\u003cbr/\u003e(instance 1)\"]\n    Pool --\u003e Pane3[\"CustomEditor\u003cbr/\u003e(instance 1)\"]\n    \n    Request[\"openEditor(FileEditorInput)\"]\n    Request --\u003e Lookup[\"Lookup pane type\"]\n    Lookup --\u003e Check{\"Pane exists\u003cbr/\u003ein pool?\"}\n    Check --\u003e|Yes| Reuse[\"Reuse existing pane\"]\n    Check --\u003e|No| Create[\"Create new pane\"]\n    Reuse --\u003e SetInput[\"setInput(input)\"]\n    Create --\u003e SetInput\n```\n\nBenefits:\n- Reduces DOM manipulation\n- Preserves editor widget state (when possible)\n- Improves perceived performance\n\nSources: [src/vs/workbench/browser/parts/editor/editorPanes.ts]()\n\n---\n\n## Summary\n\nThe Editor Input and Pane System provides the foundation for VS Code's flexible editor architecture:\n\n- **EditorInput** represents the model/content layer\n- **EditorPane** represents the view/UI layer\n- **Registration system** connects inputs to panes\n- **Resolution system** determines which pane to use\n- **Lifecycle management** handles opening, saving, and closing\n- **Integration with groups** enables multi-editor workflows\n\nThis separation of concerns enables:\n- Multiple views of the same content (split editors)\n- Custom editor implementations\n- Flexible serialization and session restore\n- Extension-provided editor types\n- Efficient resource management through pane pooling"])</script><script>self.__next_f.push([1,"27:T5da7,"])</script><script>self.__next_f.push([1,"# View System and Contributions\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [src/vs/platform/editor/common/editor.ts](src/vs/platform/editor/common/editor.ts)\n- [src/vs/workbench/browser/actions/layoutActions.ts](src/vs/workbench/browser/actions/layoutActions.ts)\n- [src/vs/workbench/browser/contextkeys.ts](src/vs/workbench/browser/contextkeys.ts)\n- [src/vs/workbench/browser/dnd.ts](src/vs/workbench/browser/dnd.ts)\n- [src/vs/workbench/browser/layout.ts](src/vs/workbench/browser/layout.ts)\n- [src/vs/workbench/browser/parts/auxiliarybar/auxiliaryBarActions.ts](src/vs/workbench/browser/parts/auxiliarybar/auxiliaryBarActions.ts)\n- [src/vs/workbench/browser/parts/editor/editor.contribution.ts](src/vs/workbench/browser/parts/editor/editor.contribution.ts)\n- [src/vs/workbench/browser/parts/editor/editor.ts](src/vs/workbench/browser/parts/editor/editor.ts)\n- [src/vs/workbench/browser/parts/editor/editorActions.ts](src/vs/workbench/browser/parts/editor/editorActions.ts)\n- [src/vs/workbench/browser/parts/editor/editorCommands.ts](src/vs/workbench/browser/parts/editor/editorCommands.ts)\n- [src/vs/workbench/browser/parts/editor/editorDropTarget.ts](src/vs/workbench/browser/parts/editor/editorDropTarget.ts)\n- [src/vs/workbench/browser/parts/editor/editorGroupView.ts](src/vs/workbench/browser/parts/editor/editorGroupView.ts)\n- [src/vs/workbench/browser/parts/editor/editorPart.ts](src/vs/workbench/browser/parts/editor/editorPart.ts)\n- [src/vs/workbench/browser/parts/panel/panelActions.ts](src/vs/workbench/browser/parts/panel/panelActions.ts)\n- [src/vs/workbench/browser/parts/titlebar/titlebarActions.ts](src/vs/workbench/browser/parts/titlebar/titlebarActions.ts)\n- [src/vs/workbench/browser/workbench.contribution.ts](src/vs/workbench/browser/workbench.contribution.ts)\n- [src/vs/workbench/browser/workbench.ts](src/vs/workbench/browser/workbench.ts)\n- [src/vs/workbench/common/contextkeys.ts](src/vs/workbench/common/contextkeys.ts)\n- [src/vs/workbench/common/editor.ts](src/vs/workbench/common/editor.ts)\n- [src/vs/workbench/services/editor/browser/editorService.ts](src/vs/workbench/services/editor/browser/editorService.ts)\n- [src/vs/workbench/services/editor/common/editorGroupsService.ts](src/vs/workbench/services/editor/common/editorGroupsService.ts)\n- [src/vs/workbench/services/editor/common/editorService.ts](src/vs/workbench/services/editor/common/editorService.ts)\n- [src/vs/workbench/services/editor/test/browser/editorGroupsService.test.ts](src/vs/workbench/services/editor/test/browser/editorGroupsService.test.ts)\n- [src/vs/workbench/services/editor/test/browser/editorService.test.ts](src/vs/workbench/services/editor/test/browser/editorService.test.ts)\n- [src/vs/workbench/services/layout/browser/layoutService.ts](src/vs/workbench/services/layout/browser/layoutService.ts)\n- [src/vs/workbench/test/browser/workbenchTestServices.ts](src/vs/workbench/test/browser/workbenchTestServices.ts)\n\n\u003c/details\u003e\n\n\n\nThis document describes the view system architecture in VS Code, which provides the framework for rendering side panels, explorers, and other UI components in the workbench. The view system manages view containers (sidebar, panel, auxiliary bar), individual views, pane composites, and their lifecycle.\n\nFor information about editor management and editor groups, see [Editor Service and Groups](#4.2). For layout management of parts, see [Layout System and Parts](#4.1). For the action and menu system that integrates with views, see [Action and Menu System](#4.4).\n\n## Overview and Core Concepts\n\nThe view system consists of several layers:\n\n1. **View Containers** - Top-level containers that can hold multiple views (e.g., the Explorer, Source Control containers)\n2. **Views** - Individual UI components within a container (e.g., the file tree, outline view)\n3. **Pane Composites** - The composite UI component that hosts views in a container\n4. **View Services** - Service layer managing view registration, lifecycle, and state\n\nViews are declaratively registered through contribution points and instantiated on-demand when their container is shown.\n\n**Sources:** [src/vs/workbench/common/views.ts:1-150](), [src/vs/workbench/test/browser/workbenchTestServices.ts:130-180]()\n\n## View System Architecture\n\n```mermaid\ngraph TB\n    subgraph \"View Container Locations\"\n        Sidebar[\"Sidebar\u003cbr/\u003e(Parts.SIDEBAR_PART)\"]\n        Panel[\"Panel\u003cbr/\u003e(Parts.PANEL_PART)\"]\n        AuxBar[\"Auxiliary Bar\u003cbr/\u003e(Parts.AUXILIARYBAR_PART)\"]\n    end\n    \n    subgraph \"Service Layer\"\n        ViewDescriptorService[\"IViewDescriptorService\u003cbr/\u003eRegistry of view descriptors\"]\n        ViewsService[\"IViewsService\u003cbr/\u003eView lifecycle management\"]\n        PaneCompositeService[\"IPaneCompositePartService\u003cbr/\u003eComposite part management\"]\n    end\n    \n    subgraph \"UI Components\"\n        PaneComposite[\"PaneComposite\u003cbr/\u003eContainer UI component\"]\n        ViewPane[\"ViewPane\u003cbr/\u003eIndividual view UI\"]\n        TreeView[\"Tree-based views\"]\n    end\n    \n    subgraph \"Registration\"\n        ViewContainerRegistry[\"ViewContainerRegistry\u003cbr/\u003eRegister containers\"]\n        ViewRegistry[\"ViewsRegistry\u003cbr/\u003eRegister views\"]\n        Extensions[\"Extension Contributions\"]\n    end\n    \n    Extensions --\u003e ViewContainerRegistry\n    Extensions --\u003e ViewRegistry\n    ViewContainerRegistry --\u003e ViewDescriptorService\n    ViewRegistry --\u003e ViewDescriptorService\n    \n    ViewDescriptorService --\u003e ViewsService\n    PaneCompositeService --\u003e PaneComposite\n    ViewsService --\u003e ViewPane\n    \n    PaneComposite --\u003e ViewPane\n    ViewPane --\u003e TreeView\n    \n    Sidebar --\u003e PaneComposite\n    Panel --\u003e PaneComposite\n    AuxBar --\u003e PaneComposite\n```\n\n**Sources:** [src/vs/workbench/common/views.ts:1-200](), [src/vs/workbench/services/views/common/viewsService.ts:1-100](), [src/vs/workbench/browser/parts/paneCompositePart.ts:1-150]()\n\n## View Container Locations\n\nViews are organized into containers, which can be placed in three primary locations within the workbench:\n\n| Location | Enum Value | Description | Default Containers |\n|----------|-----------|-------------|-------------------|\n| Sidebar | `ViewContainerLocation.Sidebar` | Primary side bar on the left/right | Explorer, Search, SCM, Extensions |\n| Panel | `ViewContainerLocation.Panel` | Bottom panel area | Terminal, Output, Problems, Debug Console |\n| Auxiliary Bar | `ViewContainerLocation.AuxiliaryBar` | Secondary side bar opposite the primary | Additional views when enabled |\n\nThe location determines where the view container appears in the workbench layout. Containers can be moved between locations by users, and extensions can specify preferred locations when registering containers.\n\n**Sources:** [src/vs/workbench/common/views.ts:40-80](), [src/vs/workbench/browser/layout.ts:700-750](), [src/vs/workbench/services/layout/browser/layoutService.ts:100-200]()\n\n## View Descriptors and View Containers\n\n### View Container Structure\n\n```mermaid\ngraph TB\n    ViewContainer[\"ViewContainer\u003cbr/\u003e{id, title, icon, location}\"]\n    ViewDescriptor1[\"IViewDescriptor\u003cbr/\u003e{id, name, when, canToggleVisibility}\"]\n    ViewDescriptor2[\"IViewDescriptor\u003cbr/\u003e{id, name, when, canToggleVisibility}\"]\n    ViewDescriptor3[\"IViewDescriptor\u003cbr/\u003e{id, name, when, canToggleVisibility}\"]\n    \n    ViewContainer --\u003e ViewDescriptor1\n    ViewContainer --\u003e ViewDescriptor2\n    ViewContainer --\u003e ViewDescriptor3\n    \n    ViewDescriptor1 --\u003e ViewPane1[\"ViewPane instance\u003cbr/\u003eRendered UI\"]\n    ViewDescriptor2 --\u003e ViewPane2[\"ViewPane instance\u003cbr/\u003eRendered UI\"]\n    ViewDescriptor3 --\u003e ViewPane3[\"ViewPane instance\u003cbr/\u003eRendered UI\"]\n    \n    ViewPane1 --\u003e TreeImpl[\"TreeView implementation\"]\n    ViewPane2 --\u003e CustomImpl[\"Custom rendering\"]\n    ViewPane3 --\u003e ListImpl[\"List implementation\"]\n```\n\nA `ViewContainer` is defined by:\n- **id**: Unique identifier (e.g., `'workbench.view.explorer'`)\n- **title**: Display name shown in the UI\n- **icon**: Icon shown in the activity bar\n- **location**: Where the container is placed (`Sidebar`, `Panel`, or `AuxiliaryBar`)\n\nA `IViewDescriptor` defines an individual view within a container:\n- **id**: Unique identifier\n- **name**: Display name\n- **containerTitle**: Optional title when shown in the container\n- **when**: Context key expression determining visibility\n- **canToggleVisibility**: Whether users can hide/show the view\n- **canMoveView**: Whether the view can be moved to other containers\n- **order**: Display order within the container\n- **weight**: Size weight for layout\n\n**Sources:** [src/vs/workbench/common/views.ts:150-300](), [src/vs/workbench/browser/parts/paneCompositePart.ts:50-150]()\n\n## View Descriptor Service\n\nThe `IViewDescriptorService` is the central registry for all view containers and view descriptors:\n\n```typescript\ninterface IViewDescriptorService {\n    // View containers\n    readonly viewContainers: ReadonlyArray\u003cViewContainer\u003e;\n    getViewContainerById(id: string): ViewContainer | null;\n    getViewContainerLocation(container: ViewContainer): ViewContainerLocation;\n    getViewContainerModel(container: ViewContainer): IViewContainerModel;\n    \n    // View descriptors\n    getViewDescriptorById(id: string): IViewDescriptor | null;\n    getViewContainerByViewId(id: string): ViewContainer | null;\n    getDefaultContainerById(id: string): ViewContainer | null;\n    \n    // Events\n    onDidChangeContainer: Event\u003c{ views: IViewDescriptor[]; from: ViewContainer; to: ViewContainer }\u003e;\n    onDidChangeLocation: Event\u003c{ views: IViewDescriptor[]; from: ViewContainerLocation; to: ViewContainerLocation }\u003e;\n}\n```\n\nThe service provides:\n1. **Registry access** - Query all registered containers and views\n2. **Location management** - Track where containers are placed\n3. **View container models** - Access the model for each container including its views\n4. **Change notifications** - Events when views move between containers or locations\n\n**Sources:** [src/vs/workbench/common/views.ts:300-450](), [src/vs/workbench/test/browser/workbenchTestServices.ts:180-220]()\n\n## Pane Composites (Viewlets)\n\nA `PaneComposite` is the UI component that hosts views within a container. The term \"viewlet\" was historically used but has been superseded by \"pane composite\".\n\n### Pane Composite Lifecycle\n\n```mermaid\ngraph LR\n    Registration[\"View Container\u003cbr/\u003eRegistration\"]\n    Descriptor[\"PaneCompositeDescriptor\"]\n    Factory[\"Composite Factory\"]\n    Instance[\"PaneComposite\u003cbr/\u003eInstance\"]\n    ViewPanes[\"ViewPane\u003cbr/\u003eInstances\"]\n    \n    Registration --\u003e Descriptor\n    Descriptor --\u003e Factory\n    Factory --\u003e Instance\n    Instance --\u003e ViewPanes\n    \n    Instance --\u003e |\"create()\"| ViewPanes\n    Instance --\u003e |\"setVisible()\"| ViewPanes\n    Instance --\u003e |\"layout()\"| ViewPanes\n```\n\nKey classes:\n- **`PaneComposite`** - Base class for all pane composites [src/vs/workbench/browser/panecomposite.ts:1-100]()\n- **`PaneCompositeDescriptor`** - Descriptor for registering composites [src/vs/workbench/browser/panecomposite.ts:100-150]()\n- **`IPaneCompositePartService`** - Service for managing composite parts [src/vs/workbench/services/panecomposite/browser/panecomposite.ts:1-100]()\n\nThe `IPaneCompositePartService` provides methods to:\n- `openPaneComposite(id, location, focus?)` - Open a composite in a specific location\n- `getActivePaneComposite(location)` - Get the currently active composite\n- `getPaneComposite(id, location)` - Get a specific composite instance\n- `getPaneComposites(location)` - List all composites in a location\n- `getProgressIndicator(id, location)` - Get progress indicator for a composite\n\n**Sources:** [src/vs/workbench/browser/panecomposite.ts:1-200](), [src/vs/workbench/services/panecomposite/browser/panecomposite.ts:1-150](), [src/vs/workbench/test/browser/workbenchTestServices.ts:350-400]()\n\n## Views Service\n\nThe `IViewsService` manages the lifecycle of individual view instances:\n\n```mermaid\ngraph TB\n    ViewsService[\"IViewsService\"]\n    \n    OpenView[\"openView(id, focus)\"]\n    CloseView[\"closeView(id)\"]\n    GetView[\"getViewWithId(id)\"]\n    IsVisible[\"isViewVisible(id)\"]\n    \n    ViewsService --\u003e OpenView\n    ViewsService --\u003e CloseView\n    ViewsService --\u003e GetView\n    ViewsService --\u003e IsVisible\n    \n    OpenView --\u003e ViewInstance[\"IView instance\u003cbr/\u003eCreated on demand\"]\n    GetView --\u003e ViewInstance\n    \n    ViewInstance --\u003e |\"implements\"| IView[\"IView interface\u003cbr/\u003e{onDidChangeBodyVisibility,\u003cbr/\u003eisBodyVisible(),\u003cbr/\u003egetContainer()}\"]\n```\n\nThe service coordinates with `IViewDescriptorService` to:\n1. Determine which views should be shown based on context keys\n2. Instantiate view panes when needed\n3. Track view visibility and state\n4. Handle view focus and activation\n5. Persist view state across sessions\n\nExample usage:\n```typescript\n// Open a view\nawait viewsService.openView('workbench.explorer.fileView', true);\n\n// Get a view instance\nconst view = viewsService.getViewWithId('workbench.explorer.fileView');\nif (view) {\n    // Interact with the view\n    view.focus();\n}\n\n// Check visibility\nconst isVisible = viewsService.isViewVisible('workbench.explorer.fileView');\n```\n\n**Sources:** [src/vs/workbench/services/views/common/viewsService.ts:1-150](), [src/vs/workbench/common/views.ts:400-500]()\n\n## Tree Views\n\nTree views are a specialized type of view that display hierarchical data. They are commonly used for file explorers, outlines, and extension-contributed trees.\n\n### Tree View Architecture\n\n```mermaid\ngraph TB\n    subgraph \"Extension API Layer\"\n        TreeDataProvider[\"TreeDataProvider\u003cbr/\u003e(Extension implements)\"]\n        TreeView[\"vscode.createTreeView()\"]\n    end\n    \n    subgraph \"Main Thread\"\n        MainThreadTreeViews[\"MainThreadTreeViews\"]\n        TreeViewPane[\"TreeViewPane\u003cbr/\u003e(extends ViewPane)\"]\n        TreeWidget[\"WorkbenchDataTree\u003cbr/\u003eor WorkbenchAsyncDataTree\"]\n    end\n    \n    subgraph \"Extension Host\"\n        ExtHostTreeViews[\"ExtHostTreeViews\"]\n        ExtensionImpl[\"Extension Tree Logic\"]\n    end\n    \n    TreeView --\u003e ExtHostTreeViews\n    ExtensionImpl --\u003e TreeDataProvider\n    TreeDataProvider --\u003e ExtHostTreeViews\n    \n    ExtHostTreeViews \u003c--\u003e |\"RPC\"| MainThreadTreeViews\n    MainThreadTreeViews --\u003e TreeViewPane\n    TreeViewPane --\u003e TreeWidget\n```\n\nKey components:\n- **`TreeDataProvider`** - Extension-implemented interface providing tree data\n- **`TreeViewPane`** - Main thread UI component rendering the tree\n- **`WorkbenchDataTree`** / **`WorkbenchAsyncDataTree`** - Underlying tree widget implementations\n- **`ExtHostTreeViews`** - Extension host side managing tree data providers\n- **`MainThreadTreeViews`** - Main thread side coordinating with UI\n\nTree views support:\n- **Lazy loading** - Children fetched on expand\n- **Drag and drop** - Custom handlers for d\u0026d operations\n- **Decorations** - Icons, tooltips, badges on tree items\n- **Commands** - Actions on tree items\n- **Filtering** - Built-in search/filter capabilities\n- **Multi-select** - Selection of multiple items\n- **Context menus** - Right-click menus on items\n\n**Sources:** [src/vs/workbench/common/views.ts:500-700](), [src/vs/workbench/browser/parts/editor/editorGroupView.ts:200-250]()\n\n## View Contribution and Registration\n\nViews and view containers are registered through contribution points. Both built-in and extension views use the same registration mechanism.\n\n### Registration Flow\n\n```mermaid\nsequenceDiagram\n    participant Extension\n    participant Registry\n    participant ViewDescriptorService\n    participant ViewsService\n    participant UI\n    \n    Extension-\u003e\u003eRegistry: Register ViewContainer\n    Extension-\u003e\u003eRegistry: Register ViewDescriptor(s)\n    \n    Registry-\u003e\u003eViewDescriptorService: Store descriptors\n    \n    Note over UI: User opens container\n    \n    UI-\u003e\u003eViewDescriptorService: Get views for container\n    ViewDescriptorService-\u003e\u003eUI: Return descriptors\n    \n    UI-\u003e\u003eViewsService: Open view by ID\n    ViewsService-\u003e\u003eViewsService: Instantiate ViewPane\n    ViewsService-\u003e\u003eUI: Return view instance\n    \n    UI-\u003e\u003eExtension: Request tree data (if tree view)\n    Extension-\u003e\u003eUI: Return tree items\n```\n\n### View Container Registration\n\nView containers are registered using the `ViewContainerRegistry`:\n\n```typescript\n// Get the registry\nconst registry = Registry.as\u003cIViewContainersRegistry\u003e(ViewExtensions.ViewContainersRegistry);\n\n// Register a container\nconst container = registry.registerViewContainer({\n    id: 'workbench.view.myContainer',\n    title: 'My Container',\n    icon: myIcon,\n    order: 5,\n    ctorDescriptor: new SyncDescriptor(MyPaneComposite)\n}, ViewContainerLocation.Sidebar);\n```\n\n### View Descriptor Registration\n\nIndividual views are registered to containers:\n\n```typescript\n// Get the registry\nconst registry = Registry.as\u003cIViewsRegistry\u003e(ViewExtensions.ViewsRegistry);\n\n// Register a view\nregistry.registerViews([{\n    id: 'workbench.view.myView',\n    name: 'My View',\n    containerTitle: 'My Container',\n    canToggleVisibility: true,\n    canMoveView: true,\n    when: ContextKeyExpr.equals('myCondition', true),\n    order: 1,\n    weight: 20\n}], container);\n```\n\n### Context Key Integration\n\nViews are shown/hidden based on context key expressions. The `when` clause in a view descriptor determines when the view is available:\n\n```typescript\n// View only shown when in a Git repository\nwhen: ContextKeyExpr.equals('gitOpenRepositoryCount', '\u003e 0')\n\n// View only shown in specific modes\nwhen: ContextKeyExpr.and(\n    ContextKeyExpr.equals('isInDiffEditor', true),\n    ContextKeyExpr.equals('resourceScheme', 'file')\n)\n```\n\nThe view descriptor service automatically evaluates these expressions and fires change events when view visibility changes.\n\n**Sources:** [src/vs/workbench/common/views.ts:700-900](), [src/vs/workbench/browser/layout.ts:700-800](), [src/vs/workbench/browser/contextkeys.ts:50-100]()\n\n## View State Persistence\n\nView state is persisted across sessions through the storage service:\n\n```mermaid\ngraph LR\n    ViewPane[\"ViewPane\"]\n    ViewState[\"saveState()\"]\n    Storage[\"IStorageService\"]\n    Restore[\"restoreState()\"]\n    \n    ViewPane --\u003e ViewState\n    ViewState --\u003e Storage\n    Storage --\u003e Restore\n    Restore --\u003e ViewPane\n    \n    Storage --\u003e |\"StorageScope.WORKSPACE\"| WorkspaceStorage[\"Workspace Storage\"]\n    Storage --\u003e |\"StorageScope.PROFILE\"| ProfileStorage[\"Profile Storage\"]\n```\n\nKey aspects:\n- **Workspace scope** - State specific to the current workspace (e.g., expanded tree nodes)\n- **Profile scope** - State shared across workspaces (e.g., view size, visibility preferences)\n- **Storage targets** - USER (synced) vs MACHINE (local only)\n\nEach `ViewPane` can override:\n- `saveState()` - Called before disposal or window close\n- `restoreState()` - Called after creation to restore previous state\n\nCommon persisted state includes:\n- Tree expansion state\n- Scroll position\n- View dimensions\n- Filter/search text\n- Sort order\n- Selected items\n\n**Sources:** [src/vs/workbench/browser/panecomposite.ts:150-250](), [src/vs/workbench/browser/layout.ts:630-680](), [src/vs/platform/storage/common/storage.ts:1-100]()\n\n## View Actions and Toolbars\n\nViews integrate with the action system to provide toolbars, context menus, and commands.\n\n### Menu Contributions for Views\n\n```mermaid\ngraph TB\n    ViewContainer[\"ViewContainer\u003cbr/\u003e(e.g., Explorer)\"]\n    \n    ViewTitleMenu[\"MenuId.ViewTitle\u003cbr/\u003eContainer toolbar\"]\n    ViewItemMenu[\"MenuId.ViewItemContext\u003cbr/\u003eItem context menu\"]\n    \n    Actions[\"Action2 registrations\u003cbr/\u003eCommands\"]\n    \n    ViewContainer --\u003e ViewTitleMenu\n    ViewContainer --\u003e ViewItemMenu\n    \n    Actions --\u003e ViewTitleMenu\n    Actions --\u003e ViewItemMenu\n    \n    ViewTitleMenu --\u003e When[\"when: viewContainer == 'workbench.view.explorer'\"]\n    ViewItemMenu --\u003e When2[\"when: viewItem == 'folder'\"]\n```\n\nCommon menu IDs for views:\n- `MenuId.ViewTitle` - Toolbar at the top of the view\n- `MenuId.ViewItemContext` - Right-click context menu on view items\n- `MenuId.ViewContainerTitle` - Actions on the container itself\n- `MenuId.ViewContainerTitleContext` - Context menu on container title\n\nActions specify targeting through context key expressions:\n```typescript\nregisterAction2(class extends Action2 {\n    constructor() {\n        super({\n            id: 'myView.action',\n            title: 'My Action',\n            menu: {\n                id: MenuId.ViewTitle,\n                when: ContextKeyExpr.equals('view', 'workbench.view.myView'),\n                group: 'navigation',\n                order: 1\n            }\n        });\n    }\n});\n```\n\nThe view system automatically:\n1. Queries the menu service for actions matching the view\n2. Renders toolbar buttons for `group: 'navigation'` actions\n3. Places other actions in overflow menus\n4. Updates action enablement based on context keys\n5. Handles action execution and result handling\n\n**Sources:** [src/vs/workbench/browser/actions/layoutActions.ts:170-220](), [src/vs/workbench/browser/parts/editor/editorActions.ts:40-100](), [src/vs/platform/actions/common/actions.ts:1-100]()\n\n## View Sizing and Layout\n\nViews within a container share space and can be resized by users. The layout system manages view dimensions and constraints.\n\n### Size Constraints\n\nEach view can specify:\n- **`minimumBodySize`** - Minimum height/width for the view content\n- **`maximumBodySize`** - Maximum height/width \n- **`weight`** - Relative size weight (used for initial sizing)\n- **`snap`** - Whether to snap to min/max sizes when close\n\n```typescript\nclass MyViewPane extends ViewPane {\n    protected override get minimumBodySize(): number { return 100; }\n    protected override get maximumBodySize(): number { return 500; }\n    protected override get weight(): number { return 30; }\n}\n```\n\n### Layout Algorithm\n\nWhen a view container is resized:\n1. Each view's constraints are collected\n2. Available space is distributed according to weights\n3. Views are resized respecting their min/max constraints\n4. Sashes (resize handles) are positioned between views\n5. User resize actions update stored view sizes\n\nThe layout respects:\n- Fixed-size views (when min === max)\n- Collapsible views (can shrink to header only)\n- Priority views (weighted higher in space distribution)\n\n**Sources:** [src/vs/workbench/browser/panecomposite.ts:200-350](), [src/vs/workbench/browser/parts/editor/editorPart.ts:150-250](), [src/vs/base/browser/ui/grid/grid.ts:1-100]()\n\n## Integration with Parts System\n\nThe view system integrates with the workbench parts system through specific part implementations:\n\n```mermaid\ngraph TB\n    LayoutService[\"IWorkbenchLayoutService\"]\n    \n    SidebarPart[\"SidebarPart\u003cbr/\u003e(Parts.SIDEBAR_PART)\"]\n    PanelPart[\"PanelPart\u003cbr/\u003e(Parts.PANEL_PART)\"]\n    AuxiliaryBarPart[\"AuxiliaryBarPart\u003cbr/\u003e(Parts.AUXILIARYBAR_PART)\"]\n    \n    PaneCompositePart[\"PaneCompositePart\u003cbr/\u003eBase class\"]\n    \n    LayoutService --\u003e SidebarPart\n    LayoutService --\u003e PanelPart\n    LayoutService --\u003e AuxiliaryBarPart\n    \n    SidebarPart --\u003e PaneCompositePart\n    PanelPart --\u003e PaneCompositePart\n    AuxiliaryBarPart --\u003e PaneCompositePart\n    \n    PaneCompositePart --\u003e ActivityBar[\"Activity Bar\u003cbr/\u003eContainer icons\"]\n    PaneCompositePart --\u003e CompositeBar[\"Composite Bar\u003cbr/\u003eView switching\"]\n    PaneCompositePart --\u003e ContentArea[\"Content Area\u003cbr/\u003eActive composite\"]\n```\n\nEach part:\n1. Extends `Part` base class [src/vs/workbench/browser/part.ts:1-100]()\n2. Implements `PaneCompositePart` for hosting composites\n3. Manages an activity bar or composite bar for switching\n4. Hosts the currently active pane composite\n5. Handles visibility, sizing, and state persistence\n\nPart-specific features:\n- **SidebarPart** - Supports left/right positioning, toggle sidebar position action\n- **PanelPart** - Supports bottom/left/right positioning, panel alignment settings\n- **AuxiliaryBarPart** - Secondary sidebar, mirrors opposite of primary sidebar\n\n**Sources:** [src/vs/workbench/browser/layout.ts:550-650](), [src/vs/workbench/browser/parts/panel/panelActions.ts:1-100](), [src/vs/workbench/browser/parts/auxiliarybar/auxiliaryBarActions.ts:1-100]()"])</script><script>self.__next_f.push([1,"28:T5eb0,"])</script><script>self.__next_f.push([1,"# Context Keys and State Management\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [src/vs/platform/editor/common/editor.ts](src/vs/platform/editor/common/editor.ts)\n- [src/vs/workbench/browser/actions/layoutActions.ts](src/vs/workbench/browser/actions/layoutActions.ts)\n- [src/vs/workbench/browser/contextkeys.ts](src/vs/workbench/browser/contextkeys.ts)\n- [src/vs/workbench/browser/dnd.ts](src/vs/workbench/browser/dnd.ts)\n- [src/vs/workbench/browser/layout.ts](src/vs/workbench/browser/layout.ts)\n- [src/vs/workbench/browser/parts/auxiliarybar/auxiliaryBarActions.ts](src/vs/workbench/browser/parts/auxiliarybar/auxiliaryBarActions.ts)\n- [src/vs/workbench/browser/parts/editor/editor.contribution.ts](src/vs/workbench/browser/parts/editor/editor.contribution.ts)\n- [src/vs/workbench/browser/parts/editor/editor.ts](src/vs/workbench/browser/parts/editor/editor.ts)\n- [src/vs/workbench/browser/parts/editor/editorActions.ts](src/vs/workbench/browser/parts/editor/editorActions.ts)\n- [src/vs/workbench/browser/parts/editor/editorCommands.ts](src/vs/workbench/browser/parts/editor/editorCommands.ts)\n- [src/vs/workbench/browser/parts/editor/editorDropTarget.ts](src/vs/workbench/browser/parts/editor/editorDropTarget.ts)\n- [src/vs/workbench/browser/parts/editor/editorGroupView.ts](src/vs/workbench/browser/parts/editor/editorGroupView.ts)\n- [src/vs/workbench/browser/parts/editor/editorPart.ts](src/vs/workbench/browser/parts/editor/editorPart.ts)\n- [src/vs/workbench/browser/parts/panel/panelActions.ts](src/vs/workbench/browser/parts/panel/panelActions.ts)\n- [src/vs/workbench/browser/parts/titlebar/titlebarActions.ts](src/vs/workbench/browser/parts/titlebar/titlebarActions.ts)\n- [src/vs/workbench/browser/workbench.contribution.ts](src/vs/workbench/browser/workbench.contribution.ts)\n- [src/vs/workbench/browser/workbench.ts](src/vs/workbench/browser/workbench.ts)\n- [src/vs/workbench/common/contextkeys.ts](src/vs/workbench/common/contextkeys.ts)\n- [src/vs/workbench/common/editor.ts](src/vs/workbench/common/editor.ts)\n- [src/vs/workbench/services/editor/browser/editorService.ts](src/vs/workbench/services/editor/browser/editorService.ts)\n- [src/vs/workbench/services/editor/common/editorGroupsService.ts](src/vs/workbench/services/editor/common/editorGroupsService.ts)\n- [src/vs/workbench/services/editor/common/editorService.ts](src/vs/workbench/services/editor/common/editorService.ts)\n- [src/vs/workbench/services/editor/test/browser/editorGroupsService.test.ts](src/vs/workbench/services/editor/test/browser/editorGroupsService.test.ts)\n- [src/vs/workbench/services/editor/test/browser/editorService.test.ts](src/vs/workbench/services/editor/test/browser/editorService.test.ts)\n- [src/vs/workbench/services/layout/browser/layoutService.ts](src/vs/workbench/services/layout/browser/layoutService.ts)\n- [src/vs/workbench/test/browser/workbenchTestServices.ts](src/vs/workbench/test/browser/workbenchTestServices.ts)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis page documents VS Code's context key system, which serves as the primary reactive state management mechanism for controlling UI behavior throughout the workbench. Context keys are boolean or string values that determine command availability, menu item visibility, keybinding activation, and other conditional behaviors based on the current application state.\n\nFor information about editor state and lifecycle, see [Editor Service and Groups](#4.2). For action and command registration, see [Action and Menu System](#4.4).\n\n## Architecture Overview\n\n```mermaid\ngraph TB\n    subgraph \"Context Key System\"\n        IContextKeyService[\"IContextKeyService\u003cbr/\u003e(Platform Service)\"]\n        RawContextKey[\"RawContextKey\u0026lt;T\u0026gt;\u003cbr/\u003e(Key Definition)\"]\n        IContextKey[\"IContextKey\u0026lt;T\u0026gt;\u003cbr/\u003e(Writable Handle)\"]\n        ContextKeyExpr[\"ContextKeyExpr\u003cbr/\u003e(Boolean Expressions)\"]\n    end\n    \n    subgraph \"State Providers\"\n        WorkbenchContextKeysHandler[\"WorkbenchContextKeysHandler\"]\n        EditorGroupView[\"EditorGroupView\"]\n        LayoutService[\"IWorkbenchLayoutService\"]\n        EditorService[\"IEditorService\"]\n    end\n    \n    subgraph \"State Consumers\"\n        Actions[\"Action2\u003cbr/\u003e(Commands)\"]\n        Menus[\"MenuRegistry\"]\n        Keybindings[\"KeybindingsRegistry\"]\n        UIComponents[\"UI Components\u003cbr/\u003e(Parts, Views)\"]\n    end\n    \n    RawContextKey --\u003e|\"bind()\"| IContextKey\n    IContextKey --\u003e|\"set(value)\"| IContextKeyService\n    IContextKeyService --\u003e|\"createScoped()\"| ScopedService[\"Scoped Service\"]\n    \n    WorkbenchContextKeysHandler --\u003e|\"updates\"| IContextKeyService\n    EditorGroupView --\u003e|\"updates\"| IContextKeyService\n    LayoutService --\u003e|\"updates\"| IContextKeyService\n    EditorService --\u003e|\"updates\"| IContextKeyService\n    \n    IContextKeyService --\u003e|\"evaluates\"| ContextKeyExpr\n    ContextKeyExpr --\u003e|\"when conditions\"| Actions\n    ContextKeyExpr --\u003e|\"when conditions\"| Menus\n    ContextKeyExpr --\u003e|\"when conditions\"| Keybindings\n    IContextKeyService --\u003e|\"observes\"| UIComponents\n```\n\n**Sources:** [src/vs/workbench/browser/contextkeys.ts:1-290](), [src/vs/workbench/common/contextkeys.ts:1-400](), [src/vs/workbench/browser/parts/editor/editorGroupView.ts:249-320]()\n\n## Context Key System Components\n\n### IContextKeyService\n\nThe `IContextKeyService` is the platform service that manages all context keys. It provides methods to create scoped services, bind keys, and evaluate expressions.\n\n```mermaid\ngraph LR\n    IContextKeyService[\"IContextKeyService\"]\n    \n    IContextKeyService --\u003e|\"createKey()\"| CreateKey[\"Create/Bind Key\"]\n    IContextKeyService --\u003e|\"createScoped()\"| Scoped[\"Scoped Service\u003cbr/\u003e(Per Editor Group)\"]\n    IContextKeyService --\u003e|\"contextMatchesRules()\"| Evaluate[\"Evaluate Expression\"]\n    IContextKeyService --\u003e|\"bufferChangeEvents()\"| Buffer[\"Batch Updates\"]\n    \n    CreateKey --\u003e|\"returns\"| IContextKey[\"IContextKey\u0026lt;T\u0026gt;\"]\n    IContextKey --\u003e|\"set(value)\"| Update[\"Update Value\"]\n    IContextKey --\u003e|\"reset()\"| Reset[\"Reset to Default\"]\n```\n\n**Sources:** [src/vs/platform/contextkey/common/contextkey.ts](), [src/vs/workbench/browser/contextkeys.ts:27-290]()\n\n### RawContextKey Definitions\n\nContext keys are defined as `RawContextKey\u003cT\u003e` instances, which specify the key name, default value, and optional metadata:\n\n| Key Definition | Type | Purpose |\n|---------------|------|---------|\n| `ActiveEditorContext` | `string \\| undefined` | ID of active editor |\n| `ActiveEditorDirtyContext` | `boolean` | Whether active editor is dirty |\n| `ActiveEditorGroupEmptyContext` | `boolean` | Whether active group has no editors |\n| `MultipleEditorGroupsContext` | `boolean` | Whether multiple groups exist |\n| `SideBarVisibleContext` | `boolean` | Whether sidebar is visible |\n| `PanelVisibleContext` | `boolean` | Whether panel is visible |\n| `IsMainEditorCenteredLayoutContext` | `boolean` | Whether centered layout is active |\n\n**Sources:** [src/vs/workbench/common/contextkeys.ts:20-400]()\n\n### Context Key Expressions\n\nContext key expressions allow combining keys with boolean logic:\n\n```typescript\n// Example from editorCommands.ts\nconst canSplitContext = ContextKeyExpr.and(\n    ActiveEditorCanSplitInGroupContext,\n    ActiveEditorGroupLockedContext.toNegated()\n);\n\n// Example from layoutActions.ts\nconst toggleCenteredLayoutWhen = ContextKeyExpr.and(\n    IsAuxiliaryWindowFocusedContext.toNegated(),\n    IsMainEditorCenteredLayoutContext\n);\n```\n\n**Expression Types:**\n- `ContextKeyExpr.and()` - All conditions must be true\n- `ContextKeyExpr.or()` - Any condition must be true\n- `ContextKeyExpr.not()` / `.toNegated()` - Negation\n- `ContextKeyExpr.equals()` - Value equality\n- `ContextKeyExpr.has()` - Key existence\n\n**Sources:** [src/vs/workbench/browser/parts/editor/editorCommands.ts:29-116](), [src/vs/workbench/browser/actions/layoutActions.ts:66-94]()\n\n## Major Context Key Categories\n\n### Editor Context Keys\n\nEditor-related context keys track the state of the active editor and editor groups:\n\n```mermaid\ngraph TB\n    subgraph \"Active Editor State\"\n        ActiveEditorContext[\"ActiveEditorContext\u003cbr/\u003e(editor ID)\"]\n        ActiveEditorDirtyContext[\"ActiveEditorDirtyContext\"]\n        ActiveEditorPinnedContext[\"ActiveEditorPinnedContext\"]\n        ActiveEditorStickyContext[\"ActiveEditorStickyContext\"]\n        ActiveEditorReadonlyContext[\"ActiveEditorReadonlyContext\"]\n        ActiveEditorCanRevertContext[\"ActiveEditorCanRevertContext\"]\n    end\n    \n    subgraph \"Editor Position\"\n        ActiveEditorFirstInGroupContext[\"ActiveEditorFirstInGroupContext\"]\n        ActiveEditorLastInGroupContext[\"ActiveEditorLastInGroupContext\"]\n    end\n    \n    subgraph \"Editor Capabilities\"\n        ActiveEditorCanSplitInGroupContext[\"ActiveEditorCanSplitInGroupContext\"]\n        ActiveEditorAvailableEditorIdsContext[\"ActiveEditorAvailableEditorIdsContext\"]\n        SideBySideEditorActiveContext[\"SideBySideEditorActiveContext\"]\n    end\n    \n    subgraph \"Editor Type\"\n        TextCompareEditorActiveContext[\"TextCompareEditorActiveContext\"]\n        TextCompareEditorVisibleContext[\"TextCompareEditorVisibleContext\"]\n        ActiveCompareEditorCanSwapContext[\"ActiveCompareEditorCanSwapContext\"]\n    end\n```\n\nThese keys are updated in `EditorGroupView.handleGroupContextKeys()`:\n\n**Sources:** [src/vs/workbench/browser/parts/editor/editorGroupView.ts:249-320](), [src/vs/workbench/common/contextkeys.ts:100-180]()\n\n### Editor Group Context Keys\n\nGroup-level context keys track the state of editor groups:\n\n| Context Key | Updated By | Purpose |\n|------------|------------|---------|\n| `ActiveEditorGroupEmptyContext` | EditorGroupView | No editors in active group |\n| `ActiveEditorGroupIndexContext` | EditorGroupView | Index of active group |\n| `ActiveEditorGroupLastContext` | EditorGroupView | Active group is last |\n| `ActiveEditorGroupLockedContext` | EditorGroupView | Group is locked |\n| `EditorGroupEditorsCountContext` | EditorGroupView | Number of editors in group |\n| `MultipleEditorGroupsContext` | WorkbenchContextKeysHandler | More than one group exists |\n| `EditorsVisibleContext` | WorkbenchContextKeysHandler | Any editors are visible |\n| `MultipleEditorsSelectedInGroupContext` | EditorGroupView | Multiple editors selected |\n\n**Sources:** [src/vs/workbench/browser/parts/editor/editorGroupView.ts:249-273](), [src/vs/workbench/browser/contextkeys.ts:27-65]()\n\n### Layout Context Keys\n\nLayout context keys control visibility and state of workbench parts:\n\n```mermaid\ngraph TB\n    subgraph \"Part Visibility\"\n        SideBarVisibleContext[\"SideBarVisibleContext\"]\n        PanelVisibleContext[\"PanelVisibleContext\"]\n        AuxiliaryBarVisibleContext[\"AuxiliaryBarVisibleContext\"]\n        TitleBarVisibleContext[\"TitleBarVisibleContext\"]\n        MainEditorAreaVisibleContext[\"MainEditorAreaVisibleContext\"]\n    end\n    \n    subgraph \"Part Configuration\"\n        PanelPositionContext[\"PanelPositionContext\u003cbr/\u003e(bottom/left/right)\"]\n        PanelAlignmentContext[\"PanelAlignmentContext\u003cbr/\u003e(left/center/right/justify)\"]\n        PanelMaximizedContext[\"PanelMaximizedContext\"]\n        AuxiliaryBarMaximizedContext[\"AuxiliaryBarMaximizedContext\"]\n    end\n    \n    subgraph \"Layout Modes\"\n        IsMainEditorCenteredLayoutContext[\"IsMainEditorCenteredLayoutContext\"]\n        InEditorZenModeContext[\"InEditorZenModeContext\"]\n        IsMainWindowFullscreenContext[\"IsMainWindowFullscreenContext\"]\n        EditorPartMaximizedEditorGroupContext[\"EditorPartMaximizedEditorGroupContext\"]\n    end\n    \n    WorkbenchContextKeysHandler[\"WorkbenchContextKeysHandler\"] --\u003e|\"updates\"| SideBarVisibleContext\n    WorkbenchContextKeysHandler --\u003e|\"updates\"| PanelVisibleContext\n    WorkbenchContextKeysHandler --\u003e|\"updates\"| IsMainEditorCenteredLayoutContext\n    WorkbenchContextKeysHandler --\u003e|\"updates\"| InEditorZenModeContext\n```\n\n**Sources:** [src/vs/workbench/browser/contextkeys.ts:66-165](), [src/vs/workbench/common/contextkeys.ts:50-100]()\n\n### Resource Context Keys\n\nThe `ResourceContextKey` class manages context keys related to the active editor's resource:\n\n```typescript\n// From contextkeys.ts\nexport class ResourceContextKey {\n    private resourceKey: IContextKey\u003cURI | undefined\u003e;\n    private folderKey: IContextKey\u003cURI | undefined\u003e;\n    private nameKey: IContextKey\u003cstring | undefined\u003e;\n    private schemeKey: IContextKey\u003cstring | undefined\u003e;\n    private filenameKey: IContextKey\u003cstring | undefined\u003e;\n    private dirnameKey: IContextKey\u003cstring | undefined\u003e;\n    private pathKey: IContextKey\u003cstring | undefined\u003e;\n    private langIdKey: IContextKey\u003cstring | undefined\u003e;\n    private resourceExtKey: IContextKey\u003cstring | undefined\u003e;\n    \n    set(resource: URI | null): void {\n        // Updates all resource-related context keys\n    }\n}\n```\n\n**Resource Context Keys:**\n- `resource` - Full URI of the resource\n- `resourceScheme` - URI scheme (file, untitled, etc.)\n- `resourceFileName` - File name without extension\n- `resourceExtname` - File extension\n- `resourceDirname` - Directory name\n- `resourcePath` - Full path\n- `resourceLangId` - Language identifier\n\n**Sources:** [src/vs/workbench/common/contextkeys.ts:200-350]()\n\n## Context Key Scoping\n\n### Global vs Scoped Services\n\nContext keys can be scoped to specific parts of the UI, allowing different values in different contexts:\n\n```mermaid\ngraph TB\n    GlobalService[\"Global IContextKeyService\"]\n    \n    GlobalService --\u003e|\"createScoped(element)\"| EditorGroupScope1[\"EditorGroupView #1\u003cbr/\u003eScoped Service\"]\n    GlobalService --\u003e|\"createScoped(element)\"| EditorGroupScope2[\"EditorGroupView #2\u003cbr/\u003eScoped Service\"]\n    GlobalService --\u003e|\"createScoped(element)\"| SidebarScope[\"Sidebar\u003cbr/\u003eScoped Service\"]\n    \n    EditorGroupScope1 --\u003e|\"activeEditorContext\"| Value1[\"'textEditor'\"]\n    EditorGroupScope2 --\u003e|\"activeEditorContext\"| Value2[\"'diffEditor'\"]\n    \n    EditorGroupScope1 --\u003e|\"activates when\"| DOM1[\"Editor Group 1 DOM focused\"]\n    EditorGroupScope2 --\u003e|\"activates when\"| DOM2[\"Editor Group 2 DOM focused\"]\n```\n\n**Example from EditorGroupView:**\n\n```typescript\n// Create scoped context key service for this editor group\nthis.scopedContextKeyService = this._register(\n    this.contextKeyService.createScoped(this.element)\n);\n\n// Create scoped instantiation service\nthis.scopedInstantiationService = this._register(\n    this.instantiationService.createChild(new ServiceCollection(\n        [IContextKeyService, this.scopedContextKeyService]\n    ))\n);\n```\n\n**Sources:** [src/vs/workbench/browser/parts/editor/editorGroupView.ts:178-204]()\n\n### Editor Group Context Key Provider\n\nThe `IEditorGroupContextKeyProvider` interface allows parts to bind context keys specific to their editor groups:\n\n```typescript\nexport interface IEditorGroupContextKeyProvider\u003cT extends ContextKeyValue\u003e {\n    readonly contextKey: RawContextKey\u003cT\u003e;\n    getGroupContextKeyValue(group: IEditorGroupView): T;\n}\n\n// Example usage in EditorPartsView\nbind\u003cT extends ContextKeyValue\u003e(\n    key: RawContextKey\u003cT\u003e,\n    group: IEditorGroupView\n): IContextKey\u003cT\u003e {\n    const contextKeyService = this.getGroupContextKeyService(group);\n    const contextKey = key.bindTo(contextKeyService);\n    \n    // Update when group becomes active\n    this.onDidChangeActiveGroup(() =\u003e {\n        if (this.activeGroup === group) {\n            contextKey.set(value);\n        }\n    });\n    \n    return contextKey;\n}\n```\n\n**Sources:** [src/vs/workbench/browser/parts/editor/editor.ts:1-100](), [src/vs/workbench/services/editor/common/editorGroupsService.ts:500-550]()\n\n## State Update Patterns\n\n### Buffered Updates\n\nContext key services support buffering changes to avoid excessive re-evaluation:\n\n```typescript\n// From EditorGroupView.handleGroupContextKeys()\nthis.scopedContextKeyService.bufferChangeEvents(() =\u003e {\n    const activeEditor = this.activeEditor;\n    const activeEditorPane = this.activeEditorPane;\n    \n    // Set multiple context keys atomically\n    this.resourceContext.set(\n        EditorResourceAccessor.getOriginalUri(activeEditor, { \n            supportSideBySide: SideBySideEditor.PRIMARY \n        })\n    );\n    \n    if (activeEditor) {\n        groupActiveEditorCanSplitInGroupContext.set(\n            activeEditor.hasCapability(EditorInputCapabilities.CanSplitInGroup)\n        );\n        groupActiveEditorIsSideBySideEditorContext.set(\n            activeEditor.typeId === SideBySideEditorInput.ID\n        );\n        // ... more updates\n    }\n    \n    // All changes fire as single event\n});\n```\n\n**Sources:** [src/vs/workbench/browser/parts/editor/editorGroupView.ts:276-320]()\n\n### Event-Driven Updates\n\nContext keys are typically updated in response to model or service events:\n\n```mermaid\ngraph LR\n    subgraph \"Event Sources\"\n        ModelChange[\"EditorGroupModel\u003cbr/\u003eonDidModelChange\"]\n        ActiveEditorChange[\"EditorService\u003cbr/\u003eonDidActiveEditorChange\"]\n        LayoutChange[\"LayoutService\u003cbr/\u003eonDidChangePart\"]\n        ConfigChange[\"ConfigurationService\u003cbr/\u003eonDidChangeConfiguration\"]\n    end\n    \n    subgraph \"Context Key Updates\"\n        UpdateHandler[\"Update Handler\"]\n        BufferChanges[\"bufferChangeEvents()\"]\n        SetKeys[\"set() multiple keys\"]\n    end\n    \n    ModelChange --\u003e UpdateHandler\n    ActiveEditorChange --\u003e UpdateHandler\n    LayoutChange --\u003e UpdateHandler\n    ConfigChange --\u003e UpdateHandler\n    \n    UpdateHandler --\u003e BufferChanges\n    BufferChanges --\u003e SetKeys\n```\n\n**Example from WorkbenchContextKeysHandler:**\n\n```typescript\n// Update context keys when editors change\nthis._register(this.editorService.onDidActiveEditorChange(() =\u003e {\n    this.activeEditorGroupEmpty.set(\n        !this.editorGroupService.activeGroup.activeEditor\n    );\n    this.editorsVisibleContext.set(\n        this.editorService.visibleEditors.length \u003e 0\n    );\n}));\n\n// Update when layout changes\nthis._register(this.layoutService.onDidChangePartVisibility(() =\u003e {\n    this.sideBarVisibleContext.set(this.layoutService.isVisible(Parts.SIDEBAR_PART));\n    this.panelVisibleContext.set(this.layoutService.isVisible(Parts.PANEL_PART));\n}));\n```\n\n**Sources:** [src/vs/workbench/browser/contextkeys.ts:66-200]()\n\n### Dirty State Tracking\n\nTracking dirty state requires listening to individual editor changes:\n\n```typescript\n// From EditorGroupView\nconst activeEditorListener = this._register(new MutableDisposable());\n\nconst observeActiveEditor = () =\u003e {\n    activeEditorListener.clear();\n    \n    const activeEditor = this.activeEditor;\n    if (activeEditor) {\n        // Set initial state\n        groupActiveEditorDirtyContext.set(\n            activeEditor.isDirty() \u0026\u0026 !activeEditor.isSaving()\n        );\n        \n        // Listen for changes\n        activeEditorListener.value = activeEditor.onDidChangeDirty(() =\u003e {\n            groupActiveEditorDirtyContext.set(\n                activeEditor.isDirty() \u0026\u0026 !activeEditor.isSaving()\n            );\n        });\n    } else {\n        groupActiveEditorDirtyContext.set(false);\n    }\n};\n\n// Re-observe when active editor changes\nthis._register(this.onDidActiveEditorChange(() =\u003e {\n    observeActiveEditor();\n}));\n```\n\n**Sources:** [src/vs/workbench/browser/parts/editor/editorGroupView.ts:274-299]()\n\n## Integration with Commands and Actions\n\n### Command Preconditions\n\nActions can specify `precondition` expressions that must be satisfied for the command to be available:\n\n```typescript\n// From layoutActions.ts\nexport class ToggleCenteredLayoutAction extends Action2 {\n    constructor() {\n        super({\n            id: 'workbench.action.toggleCenteredLayout',\n            title: localize2('toggleCenteredLayout', 'Toggle Centered Layout'),\n            precondition: IsAuxiliaryWindowFocusedContext.toNegated(),\n            toggled: IsMainEditorCenteredLayoutContext,\n            category: Categories.View,\n            f1: true\n        });\n    }\n}\n\n// From editorCommands.ts\nregisterAction2(class extends Action2 {\n    constructor() {\n        super({\n            id: SPLIT_EDITOR_IN_GROUP,\n            precondition: ContextKeyExpr.and(\n                ActiveEditorCanSplitInGroupContext,\n                ActiveEditorGroupLockedContext.toNegated()\n            )\n        });\n    }\n});\n```\n\n**Sources:** [src/vs/workbench/browser/actions/layoutActions.ts:66-94](), [src/vs/workbench/browser/parts/editor/editorCommands.ts:82-116]()\n\n### Menu Item Visibility\n\nMenu items use `when` conditions to control visibility:\n\n```typescript\n// From editor.contribution.ts\nMenuRegistry.appendMenuItem(MenuId.EditorTitle, {\n    command: {\n        id: CLOSE_EDITOR_COMMAND_ID,\n        title: localize('close', \"Close\")\n    },\n    when: ContextKeyExpr.and(\n        ActiveEditorContext,\n        ActiveEditorGroupLockedContext.toNegated()\n    ),\n    group: 'navigation',\n    order: 1\n});\n\nMenuRegistry.appendMenuItem(MenuId.EditorTitleContext, {\n    command: {\n        id: PIN_EDITOR_COMMAND_ID,\n        title: localize('pin', \"Pin\")\n    },\n    when: ContextKeyExpr.and(\n        ActiveEditorPinnedContext.toNegated(),\n        ActiveEditorStickyContext.toNegated()\n    ),\n    group: '1_close'\n});\n```\n\n**Sources:** [src/vs/workbench/browser/parts/editor/editor.contribution.ts:200-300]()\n\n### Keybinding Conditions\n\nKeybindings use `when` clauses to activate only in specific contexts:\n\n```typescript\n// From editorCommands.ts\nKeybindingsRegistry.registerCommandAndKeybindingRule({\n    id: CLOSE_EDITOR_COMMAND_ID,\n    weight: KeybindingWeight.WorkbenchContrib,\n    when: ContextKeyExpr.and(\n        EditorContextKeys.editorTextFocus.toNegated(),\n        ActiveEditorContext\n    ),\n    primary: KeyMod.CtrlCmd | KeyCode.KeyW,\n    win: { primary: KeyMod.CtrlCmd | KeyCode.F4, secondary: [KeyMod.CtrlCmd | KeyCode.KeyW] },\n    handler: (accessor) =\u003e {\n        // Close active editor\n    }\n});\n```\n\n**Sources:** [src/vs/workbench/browser/parts/editor/editorCommands.ts:164-600]()\n\n## Testing Context Keys\n\n### MockContextKeyService\n\nThe test infrastructure provides `MockContextKeyService` for testing context key behavior:\n\n```typescript\n// From workbenchTestServices.ts\nimport { MockContextKeyService } from '../../../../platform/keybinding/test/common/mockKeybindingService.js';\n\nconst instantiationService = workbenchInstantiationService();\nconst contextKeyService = instantiationService.createInstance(MockContextKeyService);\ninstantiationService.stub(IContextKeyService, contextKeyService);\n\n// Test context key evaluation\nconst when = ContextKeyExpr.and(\n    ActiveEditorContext,\n    ActiveEditorDirtyContext\n);\nconst matches = contextKeyService.contextMatchesRules(when);\n```\n\n### MockScopableContextKeyService\n\nFor testing scoped context keys:\n\n```typescript\n// From editorGroupsService.test.ts\nimport { MockScopableContextKeyService } from '../../../../../platform/keybinding/test/common/mockKeybindingService.js';\n\nconst scopedContextKeyService = new MockScopableContextKeyService();\nconst editorGroup = new EditorGroupView(\n    /* ... */,\n    scopedContextKeyService,\n    /* ... */\n);\n\n// Verify context key values\nassert.strictEqual(\n    scopedContextKeyService.getContextKeyValue('activeEditorContext'),\n    'textEditor'\n);\n```\n\n**Sources:** [src/vs/workbench/test/browser/workbenchTestServices.ts:268-282](), [src/vs/workbench/services/editor/test/browser/editorGroupsService.test.ts:1-100]()\n\n## Context Key Lifecycle\n\n```mermaid\nsequenceDiagram\n    participant Service as State Provider\n    participant ContextKeyService as IContextKeyService\n    participant ContextKey as IContextKey\n    participant Consumer as Action/Menu/Keybinding\n    \n    Service-\u003e\u003eContextKeyService: bind(RawContextKey)\n    ContextKeyService-\u003e\u003eContextKey: create handle\n    ContextKeyService--\u003e\u003eService: return IContextKey\n    \n    Service-\u003e\u003eService: observe state changes\n    Service-\u003e\u003eContextKey: set(newValue)\n    ContextKey-\u003e\u003eContextKeyService: update internal state\n    ContextKeyService-\u003e\u003eConsumer: fire onDidChangeContext\n    \n    Consumer-\u003e\u003eContextKeyService: contextMatchesRules(expr)\n    ContextKeyService--\u003e\u003eConsumer: boolean result\n    \n    Service-\u003e\u003eContextKey: reset()\n    ContextKey-\u003e\u003eContextKeyService: restore default value\n    \n    Service-\u003e\u003eContextKey: dispose()\n    ContextKey-\u003e\u003eContextKeyService: cleanup\n```\n\n**Sources:** [src/vs/workbench/browser/contextkeys.ts:27-290](), [src/vs/workbench/browser/parts/editor/editorGroupView.ts:249-320]()"])</script><script>self.__next_f.push([1,"29:T724e,"])</script><script>self.__next_f.push([1,"# Drag and Drop System\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [src/vs/platform/editor/common/editor.ts](src/vs/platform/editor/common/editor.ts)\n- [src/vs/workbench/browser/actions/layoutActions.ts](src/vs/workbench/browser/actions/layoutActions.ts)\n- [src/vs/workbench/browser/contextkeys.ts](src/vs/workbench/browser/contextkeys.ts)\n- [src/vs/workbench/browser/dnd.ts](src/vs/workbench/browser/dnd.ts)\n- [src/vs/workbench/browser/layout.ts](src/vs/workbench/browser/layout.ts)\n- [src/vs/workbench/browser/parts/auxiliarybar/auxiliaryBarActions.ts](src/vs/workbench/browser/parts/auxiliarybar/auxiliaryBarActions.ts)\n- [src/vs/workbench/browser/parts/editor/editor.contribution.ts](src/vs/workbench/browser/parts/editor/editor.contribution.ts)\n- [src/vs/workbench/browser/parts/editor/editor.ts](src/vs/workbench/browser/parts/editor/editor.ts)\n- [src/vs/workbench/browser/parts/editor/editorActions.ts](src/vs/workbench/browser/parts/editor/editorActions.ts)\n- [src/vs/workbench/browser/parts/editor/editorCommands.ts](src/vs/workbench/browser/parts/editor/editorCommands.ts)\n- [src/vs/workbench/browser/parts/editor/editorDropTarget.ts](src/vs/workbench/browser/parts/editor/editorDropTarget.ts)\n- [src/vs/workbench/browser/parts/editor/editorGroupView.ts](src/vs/workbench/browser/parts/editor/editorGroupView.ts)\n- [src/vs/workbench/browser/parts/editor/editorPart.ts](src/vs/workbench/browser/parts/editor/editorPart.ts)\n- [src/vs/workbench/browser/parts/panel/panelActions.ts](src/vs/workbench/browser/parts/panel/panelActions.ts)\n- [src/vs/workbench/browser/parts/titlebar/titlebarActions.ts](src/vs/workbench/browser/parts/titlebar/titlebarActions.ts)\n- [src/vs/workbench/browser/workbench.contribution.ts](src/vs/workbench/browser/workbench.contribution.ts)\n- [src/vs/workbench/browser/workbench.ts](src/vs/workbench/browser/workbench.ts)\n- [src/vs/workbench/common/contextkeys.ts](src/vs/workbench/common/contextkeys.ts)\n- [src/vs/workbench/common/editor.ts](src/vs/workbench/common/editor.ts)\n- [src/vs/workbench/services/editor/browser/editorService.ts](src/vs/workbench/services/editor/browser/editorService.ts)\n- [src/vs/workbench/services/editor/common/editorGroupsService.ts](src/vs/workbench/services/editor/common/editorGroupsService.ts)\n- [src/vs/workbench/services/editor/common/editorService.ts](src/vs/workbench/services/editor/common/editorService.ts)\n- [src/vs/workbench/services/editor/test/browser/editorGroupsService.test.ts](src/vs/workbench/services/editor/test/browser/editorGroupsService.test.ts)\n- [src/vs/workbench/services/editor/test/browser/editorService.test.ts](src/vs/workbench/services/editor/test/browser/editorService.test.ts)\n- [src/vs/workbench/services/layout/browser/layoutService.ts](src/vs/workbench/services/layout/browser/layoutService.ts)\n- [src/vs/workbench/test/browser/workbenchTestServices.ts](src/vs/workbench/test/browser/workbenchTestServices.ts)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis document describes VS Code's drag and drop system, which enables users to rearrange editors, open files, and organize workspaces through drag-and-drop interactions. The system handles dragging editors between groups, dropping files from the operating system, dragging resources within the workbench, and dragging entire editor groups to new locations or windows.\n\nFor information about editor management and groups, see [Editor Service and Groups](#4.2). For details on window management and auxiliary windows, see [Multi-Process Architecture](#3.3).\n\n## System Architecture\n\nThe drag and drop system consists of distinct layers handling different aspects of DND operations:\n\n```mermaid\ngraph TB\n    subgraph \"Global DND Coordination\"\n        CompositeDragAndDropObserver[\"CompositeDragAndDropObserver\u003cbr/\u003eregisterListeners()\u003cbr/\u003eonDragStart/Over/End\"]\n        DragAndDropObserver[\"DragAndDropObserver\u003cbr/\u003e(base/browser/dnd)\"]\n    end\n    \n    subgraph \"Editor-Specific DND\"\n        EditorDropTarget[\"EditorDropTarget\u003cbr/\u003eshowOverlay()\u003cbr/\u003epositionOverlay()\u003cbr/\u003edoHandleDrop()\"]\n        EditorGroupView[\"EditorGroupView\u003cbr/\u003eDND handlers for tabs\"]\n        EditorTitleControl[\"EditorTitleControl\u003cbr/\u003eonDragStart on tabs\"]\n    end\n    \n    subgraph \"Data Transfer Protocol\"\n        LocalSelectionTransfer[\"LocalSelectionTransfer\u0026lt;T\u0026gt;\u003cbr/\u003esetData()\u003cbr/\u003egetData()\u003cbr/\u003eclearData()\"]\n        DraggedEditorIdentifier[\"DraggedEditorIdentifier\u003cbr/\u003e.identifier: IEditorIdentifier\"]\n        DraggedEditorGroupIdentifier[\"DraggedEditorGroupIdentifier\u003cbr/\u003e.identifier: GroupIdentifier\"]\n        CodeDataTransfers[\"CodeDataTransfers\u003cbr/\u003e.EDITORS\u003cbr/\u003e.FILES\"]\n    end\n    \n    subgraph \"Resource Drop Handling\"\n        ResourcesDropHandler[\"ResourcesDropHandler\u003cbr/\u003ehandleDrop()\u003cbr/\u003eIResourcesDropHandlerOptions\"]\n        extractEditorsAndFilesDropData[\"extractEditorsAndFilesDropData()\u003cbr/\u003eplatform/dnd\"]\n        extractTreeDropData[\"extractTreeDropData()\u003cbr/\u003eVSDataTransfer\"]\n    end\n    \n    subgraph \"Service Integration\"\n        IEditorGroupsService[\"IEditorGroupsService\u003cbr/\u003eaddGroup()\u003cbr/\u003emoveGroup()\"]\n        IEditorService[\"IEditorService\u003cbr/\u003eopenEditor()\u003cbr/\u003emoveEditors()\"]\n        IWorkspacesService[\"IWorkspacesService\u003cbr/\u003eopenWorkspace()\"]\n    end\n    \n    CompositeDragAndDropObserver --\u003e EditorDropTarget\n    DragAndDropObserver --\u003e CompositeDragAndDropObserver\n    \n    EditorTitleControl --\u003e LocalSelectionTransfer\n    EditorGroupView --\u003e LocalSelectionTransfer\n    \n    LocalSelectionTransfer --\u003e DraggedEditorIdentifier\n    LocalSelectionTransfer --\u003e DraggedEditorGroupIdentifier\n    \n    EditorDropTarget --\u003e extractEditorsAndFilesDropData\n    EditorDropTarget --\u003e ResourcesDropHandler\n    ResourcesDropHandler --\u003e extractTreeDropData\n    \n    EditorDropTarget --\u003e IEditorGroupsService\n    EditorDropTarget --\u003e IEditorService\n    ResourcesDropHandler --\u003e IWorkspacesService\n    \n    DraggedEditorIdentifier --\u003e CodeDataTransfers\n    DraggedEditorGroupIdentifier --\u003e CodeDataTransfers\n```\n\n**Sources:** [src/vs/workbench/browser/dnd.ts:1-40, 550-800](), [src/vs/workbench/browser/parts/editor/editorDropTarget.ts:40-100](), [src/vs/base/browser/dnd.ts:1-50](), [src/vs/platform/dnd/browser/dnd.ts:1-150]()\n\n## Core Data Transfer Types\n\nThe system defines specific classes to represent dragged items:\n\n```mermaid\nclassDiagram\n    class DraggedEditorIdentifier {\n        +identifier: IEditorIdentifier\n        +constructor(identifier)\n    }\n    \n    class DraggedEditorGroupIdentifier {\n        +identifier: GroupIdentifier\n        +constructor(identifier)\n    }\n    \n    class IDraggedResourceEditorInput {\n        +resource: URI\n        +isExternal?: boolean\n        +allowWorkspaceOpen?: boolean\n    }\n    \n    class LocalSelectionTransfer~T~ {\n        +hasData(proto): boolean\n        +getData(proto): T[]\n        +setData(data, proto)\n        +clearData(proto)\n    }\n    \n    class CodeDataTransfers {\n        +EDITORS: string\n        +FILES: string\n        +INTERNAL_URI_LIST: string\n    }\n    \n    DraggedEditorIdentifier --\u003e LocalSelectionTransfer\n    DraggedEditorGroupIdentifier --\u003e LocalSelectionTransfer\n    IDraggedResourceEditorInput --\u003e CodeDataTransfers\n```\n\nThese types are used to identify what is being dragged:\n- `DraggedEditorIdentifier`: Represents a single editor being dragged [src/vs/workbench/browser/dnd.ts:43-46]()\n- `DraggedEditorGroupIdentifier`: Represents an entire editor group being dragged [src/vs/workbench/browser/dnd.ts:48-51]()\n- `LocalSelectionTransfer`: Platform service for transferring data within the same application instance [src/vs/platform/dnd/browser/dnd.ts]()\n\n**Sources:** [src/vs/workbench/browser/dnd.ts:43-51](), [src/vs/platform/dnd/browser/dnd.ts:1-100]()\n\n## EditorDropTarget Component\n\n`EditorDropTarget` manages drop zones and coordinates with `IEditorGroupsService` to handle drops:\n\n**EditorDropTarget Class Structure**\n\n```mermaid\nclassDiagram\n    class EditorDropTarget {\n        -editorPartsView: IEditorPartsView\n        -groupTransfer: LocalSelectionTransfer~DraggedEditorGroupIdentifier~\n        -editorTransfer: LocalSelectionTransfer~DraggedEditorIdentifier~\n        -containers: Map~HTMLElement, IDisposable~\n        -overlay: HTMLElement\n        +constructor(accessor, editorPartsView, groupView)\n        +dispose()\n        -createOverlay()\n        -updateContainer(groupView, container)\n        -showOverlay(target)\n        -positionOverlay(mousePosX, mousePosY, isDraggingGroup)\n        -doHandleDrop(event, targetGroupView, targetIndex, isNewWindowOperation)\n        -findTargetGroupView(accessor, mousePosX, mousePosY)\n    }\n    \n    class IEditorPartsView {\n        \u003c\u003cinterface\u003e\u003e\n        +activeGroup: IEditorGroupView\n        +groups: IEditorGroupView[]\n    }\n    \n    class IEditorGroupView {\n        \u003c\u003cinterface\u003e\u003e\n        +element: HTMLElement\n        +isEmpty: boolean\n        +isLocked: boolean\n    }\n    \n    EditorDropTarget --\u003e IEditorPartsView\n    EditorDropTarget --\u003e IEditorGroupView\n```\n\n**Drop Zone Layout Algorithm**\n\nThe overlay divides each editor group into five zones calculated by `positionOverlay()`:\n\n| Zone | Position | Action | Method Called |\n|------|----------|--------|---------------|\n| Center | Middle 40% x 40% | Merge into group | `editorGroupsService.getGroup(id)` |\n| Top | Top 20% height | Split vertically above | `editorGroupsService.addGroup(location, GroupDirection.UP)` |\n| Bottom | Bottom 20% height | Split vertically below | `editorGroupsService.addGroup(location, GroupDirection.DOWN)` |\n| Left | Left 20% width | Split horizontally left | `editorGroupsService.addGroup(location, GroupDirection.LEFT)` |\n| Right | Right 20% width | Split horizontally right | `editorGroupsService.addGroup(location, GroupDirection.RIGHT)` |\n\n**Sources:** [src/vs/workbench/browser/parts/editor/editorDropTarget.ts:40-120, 200-450, 500-600]()\n\n## Drop Zone Calculation\n\nThe `positionOverlay` method divides the editor area into drop zones:\n\n```mermaid\ngraph TB\n    subgraph \"Drop Zone Layout\"\n        FULL_AREA[\"Full Editor Area\u003cbr/\u003e(getDimension)\"]\n        \n        GROUP_VIEWS[\"Active Group Views\u003cbr/\u003e(groupViews)\"]\n        \n        CALC_ZONES[\"Calculate Zones per Group\"]\n        \n        TOP_ZONE[\"Top Zone\u003cbr/\u003esplitVertically()\"]\n        BOTTOM_ZONE[\"Bottom Zone\u003cbr/\u003esplitVertically()\"]\n        LEFT_ZONE[\"Left Zone\u003cbr/\u003esplitHorizontally()\"]\n        RIGHT_ZONE[\"Right Zone\u003cbr/\u003esplitHorizontally()\"]\n        CENTER_ZONE[\"Center Zone\u003cbr/\u003emerge()\"]\n        \n        OVERLAY_UI[\"Overlay UI Elements\u003cbr/\u003e.overlay-{top,left,right,bottom,center}\"]\n    end\n    \n    FULL_AREA --\u003e GROUP_VIEWS\n    GROUP_VIEWS --\u003e CALC_ZONES\n    \n    CALC_ZONES --\u003e TOP_ZONE\n    CALC_ZONES --\u003e BOTTOM_ZONE\n    CALC_ZONES --\u003e LEFT_ZONE\n    CALC_ZONES --\u003e RIGHT_ZONE\n    CALC_ZONES --\u003e CENTER_ZONE\n    \n    TOP_ZONE --\u003e OVERLAY_UI\n    BOTTOM_ZONE --\u003e OVERLAY_UI\n    LEFT_ZONE --\u003e OVERLAY_UI\n    RIGHT_ZONE --\u003e OVERLAY_UI\n    CENTER_ZONE --\u003e OVERLAY_UI\n```\n\nThe algorithm in `positionOverlay()` [src/vs/workbench/browser/parts/editor/editorDropTarget.ts:200-400]():\n1. Iterates through visible editor groups\n2. Calculates boundaries for each drop zone (typically 20-30% of group dimensions for edges)\n3. Positions overlay elements with CSS transforms\n4. Handles special cases for maximized groups and grid layouts\n\n**Sources:** [src/vs/workbench/browser/parts/editor/editorDropTarget.ts:200-450]()\n\n## ResourcesDropHandler\n\n`ResourcesDropHandler` processes file system resources dropped onto the workbench:\n\n**ResourcesDropHandler Class**\n\n```mermaid\ngraph TB\n    subgraph \"ResourcesDropHandler Methods\"\n        handleDrop[\"handleDrop(event, targetWindow, resolveTargetGroup, afterDrop, options)\"]\n        extractData[\"extractEditorsAndFilesDropData(accessor, event)\"]\n    end\n    \n    subgraph \"Resource Classification\"\n        checkWorkspace[\"hasWorkspaceFileExtension(resource)\"]\n        checkFolder[\"fileService.stat(resource)\u003cbr/\u003e.isDirectory\"]\n        checkDirty[\"Check for dirty editor metadata\"]\n    end\n    \n    subgraph \"Service Actions\"\n        workspacesService[\"IWorkspacesService\u003cbr/\u003e.enterWorkspace()\"]\n        workspaceEditingService[\"IWorkspaceEditingService\u003cbr/\u003e.addFolders()\"]\n        editorService[\"IEditorService\u003cbr/\u003e.openEditor()\"]\n        textFileService[\"ITextFileService\u003cbr/\u003e.read()\"]\n    end\n    \n    subgraph \"DND Contribution Registry\"\n        dndRegistry[\"Registry.as(Extensions.DragAndDropContribution)\"]\n        handleResourceDrop[\"handleResourceDrop(resource, accessor)\"]\n    end\n    \n    handleDrop --\u003e extractData\n    extractData --\u003e checkWorkspace\n    extractData --\u003e checkFolder\n    extractData --\u003e checkDirty\n    \n    handleDrop --\u003e dndRegistry\n    dndRegistry --\u003e handleResourceDrop\n    \n    checkWorkspace --\u003e workspacesService\n    checkFolder --\u003e workspaceEditingService\n    checkDirty --\u003e textFileService\n    extractData --\u003e editorService\n```\n\n**Drop Handling Decision Tree**\n\n```typescript\n// Pseudocode from handleDrop method\nfor (const { resource, isExternal } of editors) {\n    // Check custom DND handlers first\n    if (await dndRegistry.handleResourceDrop(resource)) continue;\n    \n    if (options.allowWorkspaceOpen) {\n        // Check for workspace file\n        if (hasWorkspaceFileExtension(resource)) {\n            await workspacesService.enterWorkspace(resource);\n            continue;\n        }\n        \n        // Check for folder\n        const stat = await fileService.stat(resource);\n        if (stat.isDirectory) {\n            await workspaceEditingService.addFolders([{ uri: resource }]);\n            continue;\n        }\n    }\n    \n    // Default: open as editor\n    await editorService.openEditor({ resource, options });\n}\n```\n\n**Configuration:**\n\n- `IResourcesDropHandlerOptions.allowWorkspaceOpen`: Controls whether folders/workspaces can be opened (vs. only files)\n- Dirty editor metadata is stored in `CodeDataTransfers.EDITORS` for cross-window restoration\n\n**Sources:** [src/vs/workbench/browser/dnd.ts:86-250, 300-350](), [src/vs/platform/dnd/browser/dnd.ts:150-300]()\n\n## Editor Drag and Drop Flow\n\nEditor tab dragging involves coordination between `EditorTitleControl`, `LocalSelectionTransfer`, and `EditorDropTarget`:\n\n```mermaid\nsequenceDiagram\n    participant Tab as Tab Element\n    participant TitleControl as EditorTitleControl\n    participant LocalTransfer as LocalSelectionTransfer\n    participant DataTransfer as event.dataTransfer\n    participant DropTarget as EditorDropTarget\n    participant GroupsService as IEditorGroupsService\n    participant EditorService as IEditorService\n    \n    Tab-\u003e\u003eTitleControl: dragstart event\n    TitleControl-\u003e\u003eTitleControl: onDragStart(e, editor, group)\n    TitleControl-\u003e\u003eLocalTransfer: setData([new DraggedEditorIdentifier()])\n    TitleControl-\u003e\u003eDataTransfer: setData(CodeDataTransfers.EDITORS, JSON)\n    TitleControl-\u003e\u003eDataTransfer: setDragImage(label, offsetX, offsetY)\n    \n    Tab-\u003e\u003eDropTarget: dragover event\n    DropTarget-\u003e\u003eDropTarget: showOverlay(targetGroup)\n    DropTarget-\u003e\u003eDropTarget: positionOverlay(x, y, isDraggingGroup)\n    Note over DropTarget: Calculate 5 drop zones per group\n    \n    Tab-\u003e\u003eDropTarget: drop event\n    DropTarget-\u003e\u003eLocalTransfer: getData(DraggedEditorIdentifier)\n    DropTarget-\u003e\u003eDropTarget: findTargetGroupView(x, y)\n    \n    alt Edge Drop (Split)\n        DropTarget-\u003e\u003eGroupsService: addGroup(target, direction)\n        GroupsService--\u003e\u003eDropTarget: newGroup: IEditorGroup\n        DropTarget-\u003e\u003eEditorService: openEditor(editor, newGroup)\n    else Center Drop (Merge)\n        DropTarget-\u003e\u003eGroupsService: getGroup(targetId)\n        GroupsService--\u003e\u003eDropTarget: targetGroup\n        DropTarget-\u003e\u003eEditorService: openEditor(editor, targetGroup)\n    end\n    \n    EditorService-\u003e\u003eGroupsService: moveEditor(editor, source, target, options)\n    DropTarget-\u003e\u003eLocalTransfer: clearData()\n    DropTarget-\u003e\u003eDropTarget: hideOverlay()\n```\n\n**Key Methods:**\n\n- `EditorTitleControl.onDragStart()`: Initiates drag, sets `LocalSelectionTransfer` data [src/vs/workbench/browser/parts/editor/editorTitleControl.ts:400-450]()\n- `EditorDropTarget.positionOverlay()`: Calculates drop zone boundaries [src/vs/workbench/browser/parts/editor/editorDropTarget.ts:200-350]()\n- `EditorDropTarget.doHandleDrop()`: Executes drop action based on zone [src/vs/workbench/browser/parts/editor/editorDropTarget.ts:450-550]()\n- `IEditorGroupsService.addGroup()`: Creates new group for split operations [src/vs/workbench/services/editor/common/editorGroupsService.ts:150-200]()\n\n**Sources:** [src/vs/workbench/browser/parts/editor/editorDropTarget.ts:200-600](), [src/vs/workbench/browser/dnd.ts:43-51](), [src/vs/workbench/browser/parts/editor/editorTitleControl.ts:400-500]()\n\n## Configuration Options\n\nThe drag and drop system respects several configuration settings:\n\n| Setting | Purpose | Default |\n|---------|---------|---------|\n| `workbench.editor.splitOnDragAndDrop` | Enable splitting editor groups by dropping on edges | `true` |\n| `workbench.editor.dragToOpenWindow` | Allow dragging editors out to new window | `true` |\n| `workbench.editor.closeEmptyGroups` | Close groups when last editor is dragged out | `true` |\n\nConfiguration is accessed via `IConfigurationService` throughout the drag and drop handlers [src/vs/workbench/browser/parts/editor/editorDropTarget.ts:100-150]().\n\n**Sources:** [src/vs/workbench/browser/workbench.contribution.ts:290-299](), [src/vs/workbench/browser/parts/editor/editorDropTarget.ts:100-150]()\n\n## CompositeDragAndDropObserver\n\n`CompositeDragAndDropObserver` provides global drag-drop coordination across all workbench windows:\n\n**Observer Architecture**\n\n```mermaid\nclassDiagram\n    class CompositeDragAndDropObserver {\n        -editorTransfer: LocalSelectionTransfer~DraggedEditorIdentifier~\n        -groupTransfer: LocalSelectionTransfer~DraggedEditorGroupIdentifier~\n        -disposables: Map~Window, DisposableStore~\n        +constructor(instantiationService)\n        -registerListeners(window, disposables)\n        -onDragStart(e)\n        -onDragOver(e)\n        -onDragEnd(e)\n        -onDrop(e)\n        -disposeCurrentOperation(scheduler)\n    }\n    \n    class DragAndDropObserver {\n        \u003c\u003cbase class\u003e\u003e\n        +registerListeners(element)\n        #onDragStart(e)\n        #onDragOver(e)\n        #onDrop(e)\n        #onDragEnd(e)\n    }\n    \n    class LocalSelectionTransfer~T~ {\n        +setData(data: T[], proto: T)\n        +getData(proto: T): T[] | undefined\n        +clearData(proto: T)\n        +hasData(proto: T): boolean\n    }\n    \n    CompositeDragAndDropObserver --|\u003e DragAndDropObserver\n    CompositeDragAndDropObserver --\u003e LocalSelectionTransfer\n```\n\n**Window Registration Flow**\n\n```typescript\n// Listens for new windows and registers DND handlers\nonDidRegisterWindow(({ window, disposables }) =\u003e {\n    this.registerListeners(window, disposables);\n});\n\n// Per-window event listeners\nregisterListeners(window: Window, disposables: DisposableStore) {\n    disposables.add(addDisposableListener(window.document.body, EventType.DRAG_START, e =\u003e this.onDragStart(e)));\n    disposables.add(addDisposableListener(window.document.body, EventType.DRAG_OVER, e =\u003e this.onDragOver(e)));\n    disposables.add(addDisposableListener(window.document.body, EventType.DROP, e =\u003e this.onDrop(e)));\n    disposables.add(addDisposableListener(window.document.body, EventType.DRAG_END, e =\u003e this.onDragEnd(e)));\n}\n```\n\n**State Cleanup**\n\nThe observer schedules cleanup via `RunOnceScheduler` after drag operations:\n- Clears `LocalSelectionTransfer` data after 100ms timeout\n- Handles cases where `dragend`/`drop` events don't fire (e.g., drag to external app)\n- Maintains separate state per drag operation to avoid conflicts\n\n**Sources:** [src/vs/workbench/browser/dnd.ts:550-650, 700-800](), [src/vs/base/browser/dnd.ts:100-200]()\n\n## Drop Target Delegate Interface\n\nThe `IEditorDropTargetDelegate` interface allows editor parts to customize drop behavior:\n\n```mermaid\nclassDiagram\n    class IEditorDropTargetDelegate {\n        \u003c\u003cinterface\u003e\u003e\n        +containsGroup(group: IEditorGroup): boolean\n        +getEditorDropTargetArea(): HTMLElement\n        +getEditorDropTargetContainerForGroup(group: IEditorGroup): HTMLElement\n    }\n    \n    class EditorPart {\n        +implements IEditorDropTargetDelegate\n        +containsGroup(group): boolean\n        +getEditorDropTargetArea(): HTMLElement\n    }\n    \n    class EditorDropTarget {\n        -editorPartsView: IEditorPartsView\n        -delegate?: IEditorDropTargetDelegate\n        +constructor(editorPartsView, delegate)\n    }\n    \n    IEditorDropTargetDelegate \u003c|.. EditorPart\n    EditorDropTarget --\u003e IEditorDropTargetDelegate\n```\n\nThis allows:\n- Custom drop zones for auxiliary windows\n- Per-part drop configuration\n- Integration with the multi-window editor architecture\n\n**Sources:** [src/vs/workbench/browser/parts/editor/editor.ts:500-550](), [src/vs/workbench/browser/parts/editor/editorDropTarget.ts:40-100]()\n\n## Data Transfer Protocol\n\nThe system uses a layered protocol for drag-drop data transfer:\n\n**Data Transfer Types**\n\n```mermaid\ngraph TB\n    subgraph \"In-Process Transfer (LocalSelectionTransfer)\"\n        EditorIdentifier[\"DraggedEditorIdentifier\u003cbr/\u003e{editor: IEditorIdentifier}\"]\n        GroupIdentifier[\"DraggedEditorGroupIdentifier\u003cbr/\u003e{identifier: GroupIdentifier}\"]\n    end\n    \n    subgraph \"Standard DataTransfer API\"\n        CodeEditors[\"CodeDataTransfers.EDITORS\u003cbr/\u003eMIME: 'vscode-editor'\u003cbr/\u003eJSON.stringify(metadata)\"]\n        CodeFiles[\"CodeDataTransfers.FILES\u003cbr/\u003eMIME: 'vscode-resource'\u003cbr/\u003eJSON.stringify(URIs)\"]\n        UriList[\"Mimes.uriList\u003cbr/\u003eMIME: 'text/uri-list'\u003cbr/\u003eNewline-separated URIs\"]\n        TextPlain[\"DataTransfers.TEXT\u003cbr/\u003eMIME: 'text/plain'\u003cbr/\u003eFile paths\"]\n    end\n    \n    subgraph \"Platform Integration\"\n        BrowserFiles[\"DataTransfers.FILES\u003cbr/\u003eBrowser FileList API\u003cbr/\u003eFile objects\"]\n    end\n    \n    EditorIdentifier --\u003e CodeEditors\n    GroupIdentifier --\u003e CodeEditors\n    CodeFiles --\u003e UriList\n    UriList --\u003e TextPlain\n    BrowserFiles --\u003e CodeFiles\n```\n\n**Data Extraction Priority in `extractEditorsAndFilesDropData()`**\n\n```typescript\n// Priority order for data extraction\nasync function extractEditorsAndFilesDropData(accessor: ServicesAccessor, event: DragEvent) {\n    const editors: IDraggedResourceEditorInput[] = [];\n    \n    // 1. LocalSelectionTransfer (in-process only)\n    const draggedEditors = editorTransfer.getData(DraggedEditorIdentifier);\n    if (draggedEditors) {\n        for (const { editor } of draggedEditors) {\n            editors.push({ resource: editor.resource, ... });\n        }\n    }\n    \n    // 2. CodeDataTransfers.EDITORS (cross-window dirty editors)\n    const rawEditorsData = event.dataTransfer?.getData(CodeDataTransfers.EDITORS);\n    if (rawEditorsData) {\n        editors.push(...createDraggedEditorInputFromRawResourcesData(rawEditorsData));\n    }\n    \n    // 3. CodeDataTransfers.FILES (internal VS Code resources)\n    const rawResourcesData = event.dataTransfer?.getData(CodeDataTransfers.FILES);\n    if (rawResourcesData) {\n        editors.push(...JSON.parse(rawResourcesData));\n    }\n    \n    // 4. Browser FileList (OS file drag)\n    if (event.dataTransfer?.files) {\n        for (const file of event.dataTransfer.files) {\n            editors.push({ resource: URI.file(file.path) });\n        }\n    }\n    \n    // 5. Mimes.uriList (standard format)\n    const rawUriList = event.dataTransfer?.getData(Mimes.uriList);\n    if (rawUriList) {\n        const uris = UriList.parse(rawUriList);\n        editors.push(...uris.map(uri =\u003e ({ resource: URI.parse(uri) })));\n    }\n    \n    return editors;\n}\n```\n\n**LocalSelectionTransfer Singleton**\n\n`LocalSelectionTransfer\u003cT\u003e` maintains typed in-process state:\n- Indexed by prototype object for type safety\n- Cleared automatically after drop or timeout\n- Shared across all windows in same renderer process\n- Not serialized to `DataTransfer` (stays in memory)\n\n**Sources:** [src/vs/platform/dnd/browser/dnd.ts:50-150, 200-350](), [src/vs/workbench/browser/dnd.ts:53-69](), [src/vs/base/common/dataTransfer.ts:1-100]()\n\n## Integration with Editor Groups\n\nThe drag and drop system tightly integrates with the editor group system:\n\n```mermaid\ngraph TB\n    subgraph \"IEditorGroupsService\"\n        MAIN_PART[\"mainPart: IEditorPart\"]\n        AUX_PARTS[\"Auxiliary Parts\"]\n        GET_GROUP[\"getGroup(id)\"]\n        ADD_GROUP[\"addGroup(location, direction)\"]\n        MOVE_GROUP[\"moveGroup(group, location)\"]\n    end\n    \n    subgraph \"IEditorGroup\"\n        MOVE_EDITOR[\"moveEditor(editor, target, options)\"]\n        COPY_EDITOR[\"copyEditor(editor, target, options)\"]\n        CLOSE_EDITOR[\"closeEditor(editor, options)\"]\n        CONTAINS[\"contains(editor): boolean\"]\n    end\n    \n    subgraph \"Drop Actions\"\n        DROP_SPLIT[\"Drop to Split\u003cbr/\u003e(edge zones)\"]\n        DROP_MERGE[\"Drop to Merge\u003cbr/\u003e(center zone)\"]\n        DROP_MOVE[\"Drop to Move Window\u003cbr/\u003e(Alt key)\"]\n    end\n    \n    DROP_SPLIT --\u003e ADD_GROUP\n    ADD_GROUP --\u003e MOVE_EDITOR\n    \n    DROP_MERGE --\u003e GET_GROUP\n    GET_GROUP --\u003e MOVE_EDITOR\n    \n    DROP_MOVE --\u003e MOVE_GROUP\n    MOVE_GROUP --\u003e AUX_PARTS\n    \n    MAIN_PART --\u003e GET_GROUP\n```\n\nKey integration points:\n- `IEditorGroupsService.addGroup()` creates new groups when dropping on split zones [src/vs/workbench/services/editor/common/editorGroupsService.ts:200-250]()\n- `IEditorGroup.moveEditor()` transfers editors between groups [src/vs/workbench/services/editor/common/editorGroupsService.ts:400-450]()\n- Drop zones respect locked groups (no merging allowed) [src/vs/workbench/browser/parts/editor/editorGroupView.ts:2500-2600]()\n\n**Sources:** [src/vs/workbench/services/editor/common/editorGroupsService.ts:200-450](), [src/vs/workbench/browser/parts/editor/editorDropTarget.ts:400-600]()\n\n## Multi-Window and Cross-Window DND\n\nThe system supports dragging editors between main and auxiliary windows via shared `LocalSelectionTransfer` state:\n\n**Cross-Window Transfer Mechanism**\n\n```mermaid\nsequenceDiagram\n    participant MainTab as Tab (Main Window)\n    participant MainTransfer as LocalSelectionTransfer (Singleton)\n    participant AuxDrop as EditorDropTarget (Aux Window)\n    participant AuxGroup as IEditorGroupsService (Aux Part)\n    participant HostService as IHostService\n    \n    MainTab-\u003e\u003eMainTransfer: setData([DraggedEditorIdentifier{editor, group}])\n    Note over MainTransfer: Singleton instance shared across all windows\n    \n    MainTab-\u003e\u003eAuxDrop: User drags to auxiliary window\n    AuxDrop-\u003e\u003eAuxDrop: dragover event fires\n    AuxDrop-\u003e\u003eMainTransfer: getData(DraggedEditorIdentifier)\n    MainTransfer--\u003e\u003eAuxDrop: [identifier]\n    AuxDrop-\u003e\u003eAuxDrop: showOverlay(targetGroup)\n    \n    AuxDrop-\u003e\u003eAuxDrop: drop event fires\n    AuxDrop-\u003e\u003eHostService: focus(auxWindow)\n    Note over HostService: Activates auxiliary window\n    \n    AuxDrop-\u003e\u003eAuxGroup: addGroup(location, direction)\n    AuxGroup--\u003e\u003eAuxDrop: newGroup\n    \n    AuxDrop-\u003e\u003eAuxGroup: openEditor(identifier.editor, newGroup)\n    AuxDrop-\u003e\u003eMainTransfer: clearData(DraggedEditorIdentifier)\n```\n\n**EditorDropTarget Per-Window Instances**\n\nEach editor part (main and auxiliary) has its own `EditorDropTarget` instance:\n\n```typescript\nclass EditorPart {\n    private editorDropTarget: EditorDropTarget;\n    \n    constructor(editorPartsView: IEditorPartsView) {\n        // Each part creates its own drop target\n        this.editorDropTarget = this.instantiationService.createInstance(\n            EditorDropTarget,\n            this,           // editorPartsView\n            this,           // groupsView\n        );\n    }\n}\n```\n\n**Configuration:**\n\n| Setting | Effect | Implementation |\n|---------|--------|----------------|\n| `workbench.editor.dragToOpenWindow` | Alt+drag opens editor in new window | Checked in `EditorDropTarget.doHandleDrop()` |\n| `workbench.editor.closeEmptyGroups` | Close source group if emptied by drag | Applied after `moveEditor()` completes |\n\n**Window Focus Management:**\n\n`ResourcesDropHandler.handleDrop()` calls `hostService.focus(targetWindow)` before processing to ensure:\n- Target window receives focus before drop processing\n- File dialogs appear on correct screen\n- Editor activation works correctly\n\n**Sources:** [src/vs/workbench/browser/dnd.ts:100-150](), [src/vs/workbench/browser/parts/editor/editorDropTarget.ts:150-250, 500-600](), [src/vs/workbench/browser/parts/editor/editorPart.ts:200-300]()\n\n## CSS and Visual Feedback\n\nThe drop overlay uses CSS classes for visual feedback:\n\n| CSS Class | Purpose | Applied When |\n|-----------|---------|--------------|\n| `.editor-drop-target` | Main overlay container | Drop is possible |\n| `.editor-drop-target-grid` | Grid layout container | Multiple groups visible |\n| `.overlay-drop-zone` | Individual drop zone | Always |\n| `.overlay-drop-zone-active` | Active/hovered zone | Mouse over zone |\n| `.split-{top,bottom,left,right}` | Split direction indicators | Edge zones |\n| `.merge-center` | Merge indicator | Center zone |\n\nThe overlay is styled with semi-transparent backgrounds and border indicators defined in [src/vs/workbench/browser/parts/editor/media/editordroptarget.css]().\n\n**Sources:** [src/vs/workbench/browser/parts/editor/editorDropTarget.ts:60-150](), [src/vs/workbench/browser/parts/editor/media/editordroptarget.css:1-100]()"])</script><script>self.__next_f.push([1,"2a:T5132,"])</script><script>self.__next_f.push([1,"# Multi-Window Support\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [src/vs/platform/editor/common/editor.ts](src/vs/platform/editor/common/editor.ts)\n- [src/vs/workbench/browser/actions/layoutActions.ts](src/vs/workbench/browser/actions/layoutActions.ts)\n- [src/vs/workbench/browser/contextkeys.ts](src/vs/workbench/browser/contextkeys.ts)\n- [src/vs/workbench/browser/dnd.ts](src/vs/workbench/browser/dnd.ts)\n- [src/vs/workbench/browser/layout.ts](src/vs/workbench/browser/layout.ts)\n- [src/vs/workbench/browser/parts/auxiliarybar/auxiliaryBarActions.ts](src/vs/workbench/browser/parts/auxiliarybar/auxiliaryBarActions.ts)\n- [src/vs/workbench/browser/parts/editor/editor.contribution.ts](src/vs/workbench/browser/parts/editor/editor.contribution.ts)\n- [src/vs/workbench/browser/parts/editor/editor.ts](src/vs/workbench/browser/parts/editor/editor.ts)\n- [src/vs/workbench/browser/parts/editor/editorActions.ts](src/vs/workbench/browser/parts/editor/editorActions.ts)\n- [src/vs/workbench/browser/parts/editor/editorCommands.ts](src/vs/workbench/browser/parts/editor/editorCommands.ts)\n- [src/vs/workbench/browser/parts/editor/editorDropTarget.ts](src/vs/workbench/browser/parts/editor/editorDropTarget.ts)\n- [src/vs/workbench/browser/parts/editor/editorGroupView.ts](src/vs/workbench/browser/parts/editor/editorGroupView.ts)\n- [src/vs/workbench/browser/parts/editor/editorPart.ts](src/vs/workbench/browser/parts/editor/editorPart.ts)\n- [src/vs/workbench/browser/parts/panel/panelActions.ts](src/vs/workbench/browser/parts/panel/panelActions.ts)\n- [src/vs/workbench/browser/parts/titlebar/titlebarActions.ts](src/vs/workbench/browser/parts/titlebar/titlebarActions.ts)\n- [src/vs/workbench/browser/workbench.contribution.ts](src/vs/workbench/browser/workbench.contribution.ts)\n- [src/vs/workbench/browser/workbench.ts](src/vs/workbench/browser/workbench.ts)\n- [src/vs/workbench/common/contextkeys.ts](src/vs/workbench/common/contextkeys.ts)\n- [src/vs/workbench/common/editor.ts](src/vs/workbench/common/editor.ts)\n- [src/vs/workbench/services/editor/browser/editorService.ts](src/vs/workbench/services/editor/browser/editorService.ts)\n- [src/vs/workbench/services/editor/common/editorGroupsService.ts](src/vs/workbench/services/editor/common/editorGroupsService.ts)\n- [src/vs/workbench/services/editor/common/editorService.ts](src/vs/workbench/services/editor/common/editorService.ts)\n- [src/vs/workbench/services/editor/test/browser/editorGroupsService.test.ts](src/vs/workbench/services/editor/test/browser/editorGroupsService.test.ts)\n- [src/vs/workbench/services/editor/test/browser/editorService.test.ts](src/vs/workbench/services/editor/test/browser/editorService.test.ts)\n- [src/vs/workbench/services/layout/browser/layoutService.ts](src/vs/workbench/services/layout/browser/layoutService.ts)\n- [src/vs/workbench/test/browser/workbenchTestServices.ts](src/vs/workbench/test/browser/workbenchTestServices.ts)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis document describes VS Code's multi-window architecture, which enables users to open editors in separate native windows (auxiliary windows) beyond the main workbench window. Multi-window support allows for flexible workspace arrangements across multiple monitors and provides isolated editing contexts while maintaining shared services and state.\n\nFor information about the general workbench layout and parts, see [Workbench Architecture](#4).\n\n## Architecture Overview\n\nVS Code's multi-window support centers around the concept of **auxiliary windows** - secondary native windows that contain a subset of workbench functionality, primarily focused on editor hosting. The main window contains the full workbench (sidebar, panel, auxiliary bar, status bar, etc.), while auxiliary windows are optimized for editor display.\n\n**Key Architectural Principles:**\n\n```mermaid\ngraph TB\n    MainWindow[\"Main Window\u003cbr/\u003e(Full Workbench)\"]\n    AuxWindow1[\"Auxiliary Window 1\u003cbr/\u003e(Editor-Focused)\"]\n    AuxWindow2[\"Auxiliary Window 2\u003cbr/\u003e(Editor-Focused)\"]\n    \n    subgraph SharedServices[\"Shared Services Layer\"]\n        EditorService[\"EditorService\"]\n        EditorGroupsService[\"EditorGroupsService\"]\n        LayoutService[\"IWorkbenchLayoutService\"]\n        AuxWindowService[\"IAuxiliaryWindowService\"]\n    end\n    \n    MainWindow --\u003e SharedServices\n    AuxWindow1 --\u003e SharedServices\n    AuxWindow2 --\u003e SharedServices\n    \n    MainWindow --\u003e|\"contains\"| MainEditorPart[\"Main EditorPart\"]\n    AuxWindow1 --\u003e|\"contains\"| AuxEditorPart1[\"Auxiliary EditorPart\"]\n    AuxWindow2 --\u003e|\"contains\"| AuxEditorPart2[\"Auxiliary EditorPart\"]\n    \n    EditorGroupsService --\u003e|\"manages\"| MainEditorPart\n    EditorGroupsService --\u003e|\"manages\"| AuxEditorPart1\n    EditorGroupsService --\u003e|\"manages\"| AuxEditorPart2\n```\n\nSources: [src/vs/workbench/browser/layout.ts:48-49](), [src/vs/workbench/services/editor/common/editorGroupsService.ts:21]()\n\n## Core Components\n\n### Auxiliary Window Service\n\nThe `IAuxiliaryWindowService` is responsible for creating and managing auxiliary windows. When a new window is created, it fires the `onDidOpenAuxiliaryWindow` event that provides the window instance and a disposable store for window-specific lifecycle management.\n\n```mermaid\ngraph LR\n    subgraph \"Auxiliary Window Lifecycle\"\n        Request[\"User Action\u003cbr/\u003e(Move/Copy Editor)\"]\n        Service[\"IAuxiliaryWindowService\"]\n        Create[\"Create Native Window\"]\n        Initialize[\"Initialize Container\"]\n        LoadStyles[\"Load Styles\"]\n        FireEvent[\"onDidOpenAuxiliaryWindow\"]\n        \n        Request --\u003e Service\n        Service --\u003e Create\n        Create --\u003e Initialize\n        Initialize --\u003e LoadStyles\n        LoadStyles --\u003e FireEvent\n    end\n```\n\nThe layout service listens to auxiliary window creation and tracks each window's container:\n\n[src/vs/workbench/browser/layout.ts:433-444]()\n```typescript\nthis._register(this.auxiliaryWindowService.onDidOpenAuxiliaryWindow(({ window, disposables }) =\u003e {\n    const windowId = window.window.vscodeWindowId;\n    this.containerStylesLoaded.set(windowId, window.whenStylesHaveLoaded);\n    window.whenStylesHaveLoaded.then(() =\u003e this.containerStylesLoaded.delete(windowId));\n    disposables.add(toDisposable(() =\u003e this.containerStylesLoaded.delete(windowId)));\n\n    const eventDisposables = disposables.add(new DisposableStore());\n    this._onDidAddContainer.fire({ container: window.container, disposables: eventDisposables });\n\n    disposables.add(window.onDidLayout(dimension =\u003e this.handleContainerDidLayout(window.container, dimension)));\n}));\n```\n\nSources: [src/vs/workbench/browser/layout.ts:293](), [src/vs/workbench/browser/layout.ts:433-444]()\n\n### Multi-Container Layout Management\n\nThe layout service manages multiple containers - one for the main window and one for each auxiliary window. Each container represents a separate DOM context.\n\n**Container Tracking:**\n\n[src/vs/workbench/browser/layout.ts:187-205]()\n```typescript\nreadonly mainContainer = document.createElement('div');\nget activeContainer() { return this.getContainerFromDocument(getActiveDocument()); }\nget containers(): Iterable\u003cHTMLElement\u003e {\n    const containers: HTMLElement[] = [];\n    for (const { window } of getWindows()) {\n        containers.push(this.getContainerFromDocument(window.document));\n    }\n    return containers;\n}\n\nprivate getContainerFromDocument(targetDocument: Document): HTMLElement {\n    if (targetDocument === this.mainContainer.ownerDocument) {\n        return this.mainContainer; // main window\n    } else {\n        // eslint-disable-next-line no-restricted-syntax\n        return targetDocument.body.getElementsByClassName('monaco-workbench')[0] as HTMLElement; // auxiliary window\n    }\n}\n```\n\nThe layout tracks:\n- **Active container**: The container in the currently focused window\n- **Main container**: The primary workbench window container\n- **All containers**: Iterable collection of all window containers\n\nSources: [src/vs/workbench/browser/layout.ts:187-205](), [src/vs/workbench/browser/layout.ts:207-210]()\n\n### Editor Parts in Auxiliary Windows\n\nEach auxiliary window contains an `IAuxiliaryEditorPart` - a specialized editor part that provides full editor functionality but without the surrounding workbench parts.\n\n```mermaid\ngraph TB\n    subgraph MainWindow[\"Main Window\"]\n        MainPart[\"MainEditorPart\u003cbr/\u003e(extends EditorPart)\"]\n        MainGroups[\"Editor Groups\"]\n        MainPart --\u003e MainGroups\n    end\n    \n    subgraph AuxWindow[\"Auxiliary Window\"]\n        AuxPart[\"IAuxiliaryEditorPart\u003cbr/\u003e(extends IEditorPart)\"]\n        AuxGroups[\"Editor Groups\"]\n        AuxPart --\u003e AuxGroups\n    end\n    \n    IEditorGroupsService[\"IEditorGroupsService\"]\n    IEditorGroupsService --\u003e|\"mainPart\"| MainPart\n    IEditorGroupsService --\u003e|\"createAuxiliaryEditorPart()\"| AuxPart\n    \n    EditorService[\"EditorService\"]\n    EditorService --\u003e|\"scoped instance\"| MainPart\n    EditorService --\u003e|\"scoped instance\"| AuxPart\n```\n\nThe `IEditorGroupsService` interface defines auxiliary editor part management:\n\n[src/vs/workbench/services/editor/common/editorGroupsService.ts:280-340]()\n\nKey methods include:\n- `createAuxiliaryEditorPart()`: Creates a new editor part for an auxiliary window\n- `getPart()`: Retrieves an editor part by container\n- `getParts()`: Returns all editor parts (main + auxiliary)\n\nSources: [src/vs/workbench/services/editor/common/editorGroupsService.ts:21](), [src/vs/workbench/services/editor/common/editorGroupsService.ts:280-340]()\n\n## Window Management Operations\n\n### Opening Editors in New Windows\n\nUsers can move or copy editors to new auxiliary windows through several commands:\n\n**Command Constants:**\n\n[src/vs/workbench/browser/parts/editor/editorCommands.ts:98-104]()\n```typescript\nexport const MOVE_EDITOR_INTO_NEW_WINDOW_COMMAND_ID = 'workbench.action.moveEditorToNewWindow';\nexport const COPY_EDITOR_INTO_NEW_WINDOW_COMMAND_ID = 'workbench.action.copyEditorToNewWindow';\nexport const MOVE_EDITOR_GROUP_INTO_NEW_WINDOW_COMMAND_ID = 'workbench.action.moveEditorGroupToNewWindow';\nexport const COPY_EDITOR_GROUP_INTO_NEW_WINDOW_COMMAND_ID = 'workbench.action.copyEditorGroupToNewWindow';\nexport const NEW_EMPTY_EDITOR_WINDOW_COMMAND_ID = 'workbench.action.newEmptyEditorWindow';\n```\n\n**Opening Flow:**\n\n```mermaid\nsequenceDiagram\n    participant User\n    participant Action\n    participant EditorService\n    participant AuxWindowService\n    participant EditorGroupsService\n    \n    User-\u003e\u003eAction: Execute Move/Copy Command\n    Action-\u003e\u003eEditorService: openEditor(input, AUX_WINDOW_GROUP)\n    EditorService-\u003e\u003eEditorGroupsService: resolveGroup(AUX_WINDOW_GROUP)\n    EditorGroupsService-\u003e\u003eAuxWindowService: createAuxiliaryEditorPart()\n    AuxWindowService-\u003e\u003eAuxWindowService: Create native window\n    AuxWindowService--\u003e\u003eEditorGroupsService: New IAuxiliaryEditorPart\n    EditorGroupsService--\u003e\u003eEditorService: Group in auxiliary part\n    EditorService-\u003e\u003eEditorService: Open editor in group\n```\n\nThe `AUX_WINDOW_GROUP` constant signals to the editor service that an editor should open in a new auxiliary window:\n\n[src/vs/workbench/services/editor/common/editorService.ts:28-35]()\n```typescript\n/**\n * Open an editor in a new auxiliary window.\n */\nexport const AUX_WINDOW_GROUP = -3;\nexport type AUX_WINDOW_GROUP_TYPE = typeof AUX_WINDOW_GROUP;\n\nexport type PreferredGroup = IEditorGroup | GroupIdentifier | SIDE_GROUP_TYPE | ACTIVE_GROUP_TYPE | AUX_WINDOW_GROUP_TYPE;\n```\n\nSources: [src/vs/workbench/browser/parts/editor/editorCommands.ts:98-104](), [src/vs/workbench/services/editor/common/editorService.ts:28-35]()\n\n### Move vs Copy Operations\n\nVS Code provides both **move** and **copy** operations for transferring editors to auxiliary windows:\n\n- **Move**: Closes the editor in the source window and opens it in the auxiliary window\n- **Copy**: Keeps the editor open in the source window and opens a duplicate in the auxiliary window\n\nThe actions are implemented in [src/vs/workbench/browser/parts/editor/editorActions.ts]():\n\n**Action Implementations:**\n\n| Action Class | Command ID | Behavior |\n|--------------|------------|----------|\n| `MoveEditorToNewWindowAction` | `workbench.action.moveEditorToNewWindow` | Moves single editor to new window |\n| `CopyEditorToNewindowAction` | `workbench.action.copyEditorToNewWindow` | Copies single editor to new window |\n| `MoveEditorGroupToNewWindowAction` | `workbench.action.moveEditorGroupToNewWindow` | Moves entire group to new window |\n| `CopyEditorGroupToNewWindowAction` | `workbench.action.copyEditorGroupToNewWindow` | Copies entire group to new window |\n| `NewEmptyEditorWindowAction` | `workbench.action.newEmptyEditorWindow` | Opens empty auxiliary window |\n\nSources: [src/vs/workbench/browser/parts/editor/editorActions.ts]()\n\n### Drag and Drop to New Windows\n\nEditors can be dragged from the main window to create auxiliary windows. The drag operation is controlled by the `workbench.editor.dragToOpenWindow` setting and can be toggled by holding the `Alt` key during drag.\n\n[src/vs/workbench/browser/workbench.contribution.ts:295-299]()\n```typescript\n'workbench.editor.dragToOpenWindow': {\n    'type': 'boolean',\n    'default': true,\n    'markdownDescription': localize('dragToOpenWindow', \"Controls if editors can be dragged out of the window to open them in a new window. Press and hold the `Alt` key while dragging to toggle this dynamically.\")\n}\n```\n\nSources: [src/vs/workbench/browser/workbench.contribution.ts:295-299](), [src/vs/workbench/browser/parts/editor/editorDropTarget.ts]()\n\n## Context Keys and Window State\n\nVS Code uses context keys to track auxiliary window state and control command visibility:\n\n**Key Context Keys:**\n\n```mermaid\ngraph TD\n    subgraph \"Context Keys\"\n        IsAuxWindow[\"IsAuxiliaryWindowContext\u003cbr/\u003eDocument is auxiliary window\"]\n        IsAuxFocused[\"IsAuxiliaryWindowFocusedContext\u003cbr/\u003eAuxiliary window has focus\"]\n        ActiveContainer[\"state.runtime.activeContainerId\u003cbr/\u003eID of active container\"]\n    end\n    \n    subgraph \"Usage\"\n        Commands[\"Command Visibility\"]\n        Menus[\"Menu Items\"]\n        KeyBindings[\"Keybindings\"]\n        \n        IsAuxWindow --\u003e Commands\n        IsAuxWindow --\u003e Menus\n        IsAuxFocused --\u003e KeyBindings\n    end\n```\n\n[src/vs/workbench/common/contextkeys.ts:87-94]()\n```typescript\nexport const IsAuxiliaryWindowContext = new RawContextKey\u003cboolean\u003e('isAuxiliaryWindow', false, localize('isAuxiliaryWindow', \"Whether the current window is an auxiliary window.\"));\nexport const IsAuxiliaryWindowFocusedContext = new RawContextKey\u003cboolean\u003e('isAuxiliaryWindowFocused', false, localize('isAuxiliaryWindowFocused', \"Whether an auxiliary window is focused.\"));\n```\n\nMany workbench actions are restricted to the main window using these context keys. For example:\n\n[src/vs/workbench/browser/actions/layoutActions.ts:75]()\n```typescript\nprecondition: IsAuxiliaryWindowFocusedContext.toNegated()\n```\n\nSources: [src/vs/workbench/common/contextkeys.ts:87-94](), [src/vs/workbench/browser/actions/layoutActions.ts:75]()\n\n## Service Scoping Across Windows\n\nMany workbench services need to operate differently depending on which window they're associated with. VS Code achieves this through **service scoping**.\n\n### Scoped Editor Service\n\nThe `EditorService` can create scoped instances for each editor part:\n\n[src/vs/workbench/services/editor/browser/editorService.ts:93-95]()\n```typescript\ncreateScoped(editorGroupsContainer: IEditorGroupsContainer, disposables: DisposableStore): IEditorService {\n    return disposables.add(new EditorService(editorGroupsContainer, this.editorGroupService, this.instantiationService, this.fileService, this.configurationService, this.contextService, this.uriIdentityService, this.editorResolverService, this.workspaceTrustRequestService, this.hostService, this.textEditorService));\n}\n```\n\nThis allows each window to have its own editor service instance that operates on its specific editor part, while sharing underlying services.\n\n### Scoped Context Keys\n\nContext key services are scoped per window container to ensure context keys reflect the state of the specific window:\n\n[src/vs/workbench/browser/layout.ts:516-525]()\n```typescript\nprivate onActiveWindowChanged(): void {\n    const activeContainerId = this.getActiveContainerId();\n    if (this.state.runtime.activeContainerId !== activeContainerId) {\n        this.state.runtime.activeContainerId = activeContainerId;\n\n        // Indicate active window border\n        this.updateWindowBorder();\n\n        this._onDidChangeActiveContainer.fire();\n    }\n}\n```\n\nSources: [src/vs/workbench/services/editor/browser/editorService.ts:93-95](), [src/vs/workbench/browser/layout.ts:516-525]()\n\n## Window Lifecycle and Events\n\nThe layout service provides events to track container lifecycle:\n\n**Key Events:**\n\n| Event | Description | Usage |\n|-------|-------------|-------|\n| `onDidAddContainer` | Fired when auxiliary window created | Initialize window-specific UI |\n| `onDidChangeActiveContainer` | Fired when focus changes between windows | Update active state |\n| `onDidLayoutContainer` | Fired when any container is laid out | Respond to resize |\n\n[src/vs/workbench/browser/layout.ts:177-182]()\n```typescript\nprivate readonly _onDidAddContainer = this._register(new Emitter\u003c{ container: HTMLElement; disposables: DisposableStore }\u003e());\nreadonly onDidAddContainer = this._onDidAddContainer.event;\n\nprivate readonly _onDidChangeActiveContainer = this._register(new Emitter\u003cvoid\u003e());\nreadonly onDidChangeActiveContainer = this._onDidChangeActiveContainer.event;\n```\n\n**Style Loading:**\n\nEach auxiliary window needs styles loaded before it can be used. The layout tracks this:\n\n[src/vs/workbench/browser/layout.ts:207-210]()\n```typescript\nprivate readonly containerStylesLoaded = new Map\u003cnumber /* window ID */, Promise\u003cvoid\u003e\u003e();\nwhenContainerStylesLoaded(window: CodeWindow): Promise\u003cvoid\u003e | undefined {\n    return this.containerStylesLoaded.get(window.vscodeWindowId);\n}\n```\n\nSources: [src/vs/workbench/browser/layout.ts:177-182](), [src/vs/workbench/browser/layout.ts:207-210]()\n\n## Implementation Details\n\n### Window Border Styling\n\nThe layout service manages window borders differently for main and auxiliary windows, updating border colors based on focus state:\n\n[src/vs/workbench/browser/layout.ts:588-631]()\n\nThe border styling:\n- Only applies to custom title bar mode (not native)\n- Uses `WINDOW_ACTIVE_BORDER` and `WINDOW_INACTIVE_BORDER` theme colors\n- Applies to both main and auxiliary windows\n- Updates when focus changes between windows\n\n### Container Dimension Tracking\n\nEach container's dimensions are tracked separately:\n\n[src/vs/workbench/browser/layout.ts:212-225]()\n```typescript\nprivate _mainContainerDimension!: IDimension;\nget mainContainerDimension(): IDimension { return this._mainContainerDimension; }\n\nget activeContainerDimension(): IDimension {\n    return this.getContainerDimension(this.activeContainer);\n}\n\nprivate getContainerDimension(container: HTMLElement): IDimension {\n    if (container === this.mainContainer) {\n        return this.mainContainerDimension; // main window\n    } else {\n        return getClientArea(container);    // auxiliary window\n    }\n}\n```\n\n### Restrictions on Auxiliary Windows\n\nCertain workbench features are intentionally restricted to the main window:\n\n**Examples from layout actions:**\n\n- Centered layout toggle: `precondition: IsAuxiliaryWindowFocusedContext.toNegated()` [src/vs/workbench/browser/actions/layoutActions.ts:75]()\n- Layout control menu: `when: IsAuxiliaryWindowContext.negate()` [src/vs/workbench/browser/actions/layoutActions.ts:178]()\n- Panel actions: Not available in auxiliary windows [src/vs/workbench/browser/parts/panel/panelActions.ts]()\n- Auxiliary bar actions: Not available in auxiliary windows [src/vs/workbench/browser/parts/auxiliarybar/auxiliaryBarActions.ts]()\n\nThis is because auxiliary windows are focused on editor functionality and don't contain the full workbench layout.\n\nSources: [src/vs/workbench/browser/layout.ts:588-631](), [src/vs/workbench/browser/layout.ts:212-225](), [src/vs/workbench/browser/actions/layoutActions.ts:75](), [src/vs/workbench/browser/actions/layoutActions.ts:178]()\n\n## Testing\n\nMulti-window support is tested through the editor group service test suite:\n\n[src/vs/workbench/services/editor/test/browser/editorGroupsService.test.ts]()\n\nThe test infrastructure provides utilities for creating and managing editor parts:\n- `createEditorPart()`: Creates a single editor part\n- `createEditorParts()`: Creates multiple editor parts for multi-window scenarios\n\n[src/vs/workbench/test/browser/workbenchTestServices.ts]()\n\nSources: [src/vs/workbench/services/editor/test/browser/editorGroupsService.test.ts](), [src/vs/workbench/test/browser/workbenchTestServices.ts]()"])</script><script>self.__next_f.push([1,"2b:Tb99a,"])</script><script>self.__next_f.push([1,"# Extension System\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [extensions/vscode-api-tests/package.json](extensions/vscode-api-tests/package.json)\n- [extensions/vscode-api-tests/src/singlefolder-tests/chat.test.ts](extensions/vscode-api-tests/src/singlefolder-tests/chat.test.ts)\n- [src/vs/editor/browser/config/charWidthReader.ts](src/vs/editor/browser/config/charWidthReader.ts)\n- [src/vs/editor/browser/editorBrowser.ts](src/vs/editor/browser/editorBrowser.ts)\n- [src/vs/editor/browser/viewParts/minimap/minimap.ts](src/vs/editor/browser/viewParts/minimap/minimap.ts)\n- [src/vs/editor/browser/viewParts/minimap/minimapCharRenderer.ts](src/vs/editor/browser/viewParts/minimap/minimapCharRenderer.ts)\n- [src/vs/editor/browser/viewParts/minimap/minimapCharRendererFactory.ts](src/vs/editor/browser/viewParts/minimap/minimapCharRendererFactory.ts)\n- [src/vs/editor/browser/viewParts/minimap/minimapCharSheet.ts](src/vs/editor/browser/viewParts/minimap/minimapCharSheet.ts)\n- [src/vs/editor/browser/viewParts/minimap/minimapPreBaked.ts](src/vs/editor/browser/viewParts/minimap/minimapPreBaked.ts)\n- [src/vs/editor/browser/widget/codeEditor/codeEditorWidget.ts](src/vs/editor/browser/widget/codeEditor/codeEditorWidget.ts)\n- [src/vs/editor/common/config/editorOptions.ts](src/vs/editor/common/config/editorOptions.ts)\n- [src/vs/editor/common/config/fontInfo.ts](src/vs/editor/common/config/fontInfo.ts)\n- [src/vs/editor/common/editorCommon.ts](src/vs/editor/common/editorCommon.ts)\n- [src/vs/editor/common/languages.ts](src/vs/editor/common/languages.ts)\n- [src/vs/editor/common/standalone/standaloneEnums.ts](src/vs/editor/common/standalone/standaloneEnums.ts)\n- [src/vs/editor/common/textModelEvents.ts](src/vs/editor/common/textModelEvents.ts)\n- [src/vs/editor/common/viewModel/minimapTokensColorTracker.ts](src/vs/editor/common/viewModel/minimapTokensColorTracker.ts)\n- [src/vs/editor/test/browser/view/minimapCharRenderer.test.ts](src/vs/editor/test/browser/view/minimapCharRenderer.test.ts)\n- [src/vs/monaco.d.ts](src/vs/monaco.d.ts)\n- [src/vs/platform/extensionManagement/common/abstractExtensionManagementService.ts](src/vs/platform/extensionManagement/common/abstractExtensionManagementService.ts)\n- [src/vs/platform/extensionManagement/common/extensionGalleryService.ts](src/vs/platform/extensionManagement/common/extensionGalleryService.ts)\n- [src/vs/platform/extensionManagement/common/extensionManagement.ts](src/vs/platform/extensionManagement/common/extensionManagement.ts)\n- [src/vs/platform/extensionManagement/common/extensionManagementIpc.ts](src/vs/platform/extensionManagement/common/extensionManagementIpc.ts)\n- [src/vs/platform/extensionManagement/common/extensionManagementUtil.ts](src/vs/platform/extensionManagement/common/extensionManagementUtil.ts)\n- [src/vs/platform/extensionManagement/node/extensionDownloader.ts](src/vs/platform/extensionManagement/node/extensionDownloader.ts)\n- [src/vs/platform/extensionManagement/node/extensionManagementService.ts](src/vs/platform/extensionManagement/node/extensionManagementService.ts)\n- [src/vs/platform/extensionManagement/node/extensionSignatureVerificationService.ts](src/vs/platform/extensionManagement/node/extensionSignatureVerificationService.ts)\n- [src/vs/platform/extensionManagement/test/node/extensionDownloader.test.ts](src/vs/platform/extensionManagement/test/node/extensionDownloader.test.ts)\n- [src/vs/platform/extensions/common/extensionsApiProposals.ts](src/vs/platform/extensions/common/extensionsApiProposals.ts)\n- [src/vs/platform/sign/browser/signService.ts](src/vs/platform/sign/browser/signService.ts)\n- [src/vs/platform/sign/common/abstractSignService.ts](src/vs/platform/sign/common/abstractSignService.ts)\n- [src/vs/platform/sign/common/sign.ts](src/vs/platform/sign/common/sign.ts)\n- [src/vs/platform/sign/node/signService.ts](src/vs/platform/sign/node/signService.ts)\n- [src/vs/platform/telemetry/browser/1dsAppender.ts](src/vs/platform/telemetry/browser/1dsAppender.ts)\n- [src/vs/platform/telemetry/common/1dsAppender.ts](src/vs/platform/telemetry/common/1dsAppender.ts)\n- [src/vs/platform/telemetry/node/1dsAppender.ts](src/vs/platform/telemetry/node/1dsAppender.ts)\n- [src/vs/platform/telemetry/test/browser/1dsAppender.test.ts](src/vs/platform/telemetry/test/browser/1dsAppender.test.ts)\n- [src/vs/workbench/api/browser/extensionHost.contribution.ts](src/vs/workbench/api/browser/extensionHost.contribution.ts)\n- [src/vs/workbench/api/browser/mainThreadLanguageFeatures.ts](src/vs/workbench/api/browser/mainThreadLanguageFeatures.ts)\n- [src/vs/workbench/api/common/extHost.api.impl.ts](src/vs/workbench/api/common/extHost.api.impl.ts)\n- [src/vs/workbench/api/common/extHost.protocol.ts](src/vs/workbench/api/common/extHost.protocol.ts)\n- [src/vs/workbench/api/common/extHostLanguageFeatures.ts](src/vs/workbench/api/common/extHostLanguageFeatures.ts)\n- [src/vs/workbench/api/common/extHostTypeConverters.ts](src/vs/workbench/api/common/extHostTypeConverters.ts)\n- [src/vs/workbench/api/common/extHostTypes.ts](src/vs/workbench/api/common/extHostTypes.ts)\n- [src/vs/workbench/contrib/extensions/browser/extensionEditor.ts](src/vs/workbench/contrib/extensions/browser/extensionEditor.ts)\n- [src/vs/workbench/contrib/extensions/browser/extensions.contribution.ts](src/vs/workbench/contrib/extensions/browser/extensions.contribution.ts)\n- [src/vs/workbench/contrib/extensions/browser/extensionsActions.ts](src/vs/workbench/contrib/extensions/browser/extensionsActions.ts)\n- [src/vs/workbench/contrib/extensions/browser/extensionsIcons.ts](src/vs/workbench/contrib/extensions/browser/extensionsIcons.ts)\n- [src/vs/workbench/contrib/extensions/browser/extensionsList.ts](src/vs/workbench/contrib/extensions/browser/extensionsList.ts)\n- [src/vs/workbench/contrib/extensions/browser/extensionsViewer.ts](src/vs/workbench/contrib/extensions/browser/extensionsViewer.ts)\n- [src/vs/workbench/contrib/extensions/browser/extensionsViewlet.ts](src/vs/workbench/contrib/extensions/browser/extensionsViewlet.ts)\n- [src/vs/workbench/contrib/extensions/browser/extensionsViews.ts](src/vs/workbench/contrib/extensions/browser/extensionsViews.ts)\n- [src/vs/workbench/contrib/extensions/browser/extensionsWidgets.ts](src/vs/workbench/contrib/extensions/browser/extensionsWidgets.ts)\n- [src/vs/workbench/contrib/extensions/browser/extensionsWorkbenchService.ts](src/vs/workbench/contrib/extensions/browser/extensionsWorkbenchService.ts)\n- [src/vs/workbench/contrib/extensions/browser/media/extension.css](src/vs/workbench/contrib/extensions/browser/media/extension.css)\n- [src/vs/workbench/contrib/extensions/browser/media/extensionActions.css](src/vs/workbench/contrib/extensions/browser/media/extensionActions.css)\n- [src/vs/workbench/contrib/extensions/browser/media/extensionEditor.css](src/vs/workbench/contrib/extensions/browser/media/extensionEditor.css)\n- [src/vs/workbench/contrib/extensions/browser/media/extensionsViewlet.css](src/vs/workbench/contrib/extensions/browser/media/extensionsViewlet.css)\n- [src/vs/workbench/contrib/extensions/browser/media/extensionsWidgets.css](src/vs/workbench/contrib/extensions/browser/media/extensionsWidgets.css)\n- [src/vs/workbench/contrib/extensions/common/extensions.ts](src/vs/workbench/contrib/extensions/common/extensions.ts)\n- [src/vs/workbench/services/extensionManagement/common/extensionManagement.ts](src/vs/workbench/services/extensionManagement/common/extensionManagement.ts)\n- [src/vs/workbench/services/extensionManagement/common/extensionManagementChannelClient.ts](src/vs/workbench/services/extensionManagement/common/extensionManagementChannelClient.ts)\n- [src/vs/workbench/services/extensionManagement/common/extensionManagementService.ts](src/vs/workbench/services/extensionManagement/common/extensionManagementService.ts)\n- [src/vs/workbench/services/extensionManagement/common/webExtensionManagementService.ts](src/vs/workbench/services/extensionManagement/common/webExtensionManagementService.ts)\n- [src/vscode-dts/vscode.d.ts](src/vscode-dts/vscode.d.ts)\n- [src/vscode-dts/vscode.proposed.inlineCompletionsAdditions.d.ts](src/vscode-dts/vscode.proposed.inlineCompletionsAdditions.d.ts)\n\n\u003c/details\u003e\n\n\n\n**Purpose**: This document describes VS Code's extension system architecture, including how extensions are loaded, executed, and managed. The extension system allows third-party code to extend VS Code's functionality through a well-defined API surface while maintaining isolation and stability.\n\nFor information about specific extension contributions like terminals, notebooks, or chat, see their respective feature documentation pages. For the Extension Management UI specifically, see the Extensions Viewlet sections in [#6.6](#6.6).\n\n## Architecture Overview\n\nThe extension system in VS Code is built around a multi-process architecture where extensions run in a separate **Extension Host** process, isolated from the main UI thread. This architecture provides stability (extension crashes don't crash the editor) and security (extensions have limited access to system resources).\n\n### High-Level Process Architecture\n\n```mermaid\ngraph TB\n    subgraph \"Main Process (Electron)\"\n        MAIN[\"Main Process\"]\n    end\n    \n    subgraph \"Renderer Process (Workbench)\"\n        WORKBENCH[\"Workbench UI\"]\n        MAIN_THREAD_SERVICES[\"Main Thread Services\u003cbr/\u003eMainThreadCommands\u003cbr/\u003eMainThreadLanguageFeatures\u003cbr/\u003eMainThreadTerminalService\"]\n        EXT_MGMT[\"Extension Management\u003cbr/\u003eExtensionsWorkbenchService\u003cbr/\u003eExtensionManagementService\"]\n    end\n    \n    subgraph \"Extension Host Process\"\n        EXT_HOST_RUNTIME[\"Extension Host Runtime\u003cbr/\u003eextHostExtensionService\"]\n        EXT_HOST_SERVICES[\"ExtHost Services\u003cbr/\u003eExtHostCommands\u003cbr/\u003eExtHostLanguageFeatures\u003cbr/\u003eExtHostTerminalService\"]\n        API_IMPL[\"API Implementation\u003cbr/\u003eextHost.api.impl.ts\u003cbr/\u003evscode namespace\"]\n        EXTENSIONS[\"Extensions\u003cbr/\u003eExtension 1\u003cbr/\u003eExtension 2\u003cbr/\u003eExtension N\"]\n    end\n    \n    subgraph \"API Surface\"\n        STABLE_API[\"Stable API\u003cbr/\u003evscode.d.ts\"]\n        PROPOSED_API[\"Proposed APIs\u003cbr/\u003evscode.proposed.*.d.ts\"]\n    end\n    \n    MAIN --\u003e WORKBENCH\n    WORKBENCH --\u003e MAIN_THREAD_SERVICES\n    WORKBENCH --\u003e EXT_MGMT\n    \n    MAIN_THREAD_SERVICES \u003c--\u003e|\"RPC Protocol\u003cbr/\u003eextHost.protocol.ts\"| EXT_HOST_SERVICES\n    \n    EXT_HOST_RUNTIME --\u003e EXT_HOST_SERVICES\n    EXT_HOST_SERVICES --\u003e API_IMPL\n    API_IMPL --\u003e EXTENSIONS\n    \n    STABLE_API -.defines.-\u003e API_IMPL\n    PROPOSED_API -.defines.-\u003e API_IMPL\n    EXTENSIONS -.uses.-\u003e STABLE_API\n    EXTENSIONS -.uses.-\u003e PROPOSED_API\n```\n\n**Sources**: \n- [src/vs/workbench/api/common/extHost.protocol.ts:1-980]()\n- [src/vs/workbench/api/common/extHost.api.impl.ts:131-243]()\n- Diagram 2 from high-level architecture\n\n### Core Components\n\n| Component | Location | Purpose |\n|-----------|----------|---------|\n| **Extension Host** | Extension Host Process | Executes extension code in isolated environment |\n| **RPC Protocol** | `extHost.protocol.ts` | Defines bidirectional communication interface |\n| **ExtHost Services** | `extHost*.ts` files | Extension-side implementations of VS Code services |\n| **MainThread Services** | `mainThread*.ts` files | Workbench-side counterparts to ExtHost services |\n| **API Implementation** | `extHost.api.impl.ts` | Creates the `vscode` API object exposed to extensions |\n| **Extension Management** | Various services | Handles installation, updates, enablement |\n\n**Sources**: \n- [src/vs/workbench/api/common/extHost.api.impl.ts:119-126]()\n- [src/vs/workbench/api/common/extHost.protocol.ts:116-132]()\n\n## Extension Loading and Activation\n\n### Extension Discovery and Scanning\n\nExtensions are discovered through several mechanisms:\n\n1. **Built-in Extensions**: Shipped with VS Code in the `extensions/` directory\n2. **User Extensions**: Installed to `~/.vscode/extensions` (or platform-specific locations)\n3. **Workspace Extensions**: Installed in `.vscode/extensions` for workspace-scoped extensions\n4. **Remote Extensions**: Installed on remote servers for remote development\n\n```mermaid\ngraph LR\n    subgraph \"Extension Sources\"\n        BUILTIN[\"Built-in Extensions\u003cbr/\u003eextensions/\"]\n        USER[\"User Extensions\u003cbr/\u003e~/.vscode/extensions\"]\n        WORKSPACE[\"Workspace Extensions\u003cbr/\u003e.vscode/extensions\"]\n    end\n    \n    subgraph \"Scanning\"\n        SCANNER[\"ExtensionsScannerService\"]\n        PROFILE_SCANNER[\"ExtensionsProfileScannerService\"]\n    end\n    \n    subgraph \"Extension Registry\"\n        REGISTRY[\"ExtensionDescriptionRegistry\u003cbr/\u003eAll extension metadata\"]\n        MINE[\"Mine Registry\u003cbr/\u003eSame extension host\"]\n        ALL[\"All Registry\u003cbr/\u003eAll extension hosts\"]\n    end\n    \n    BUILTIN --\u003e SCANNER\n    USER --\u003e SCANNER\n    WORKSPACE --\u003e SCANNER\n    \n    SCANNER --\u003e PROFILE_SCANNER\n    PROFILE_SCANNER --\u003e REGISTRY\n    REGISTRY --\u003e MINE\n    REGISTRY --\u003e ALL\n```\n\n**Sources**:\n- [src/vs/platform/extensionManagement/node/extensionManagementService.ts:72-100]()\n- [src/vs/workbench/api/common/extHost.api.impl.ts:119-122]()\n\n### Extension Activation\n\nExtensions are activated based on **activation events** defined in their `package.json`:\n\n```mermaid\ngraph TB\n    subgraph \"Activation Triggers\"\n        STARTUP[\"onStartupFinished\"]\n        LANGUAGE[\"onLanguage:languageId\"]\n        COMMAND[\"onCommand:commandId\"]\n        VIEW[\"onView:viewId\"]\n        CUSTOM[\"onCustom:*\"]\n    end\n    \n    subgraph \"Activation Flow\"\n        EVENT[\"Activation Event\"]\n        CHECK[\"ExtensionService\u003cbr/\u003echeckActivationEvent\"]\n        LOAD[\"Load Extension Module\u003cbr/\u003erequire(main)\"]\n        ACTIVATE[\"Call activate(context)\"]\n        CONTEXT[\"ExtensionContext\u003cbr/\u003esubscriptions, etc.\"]\n    end\n    \n    subgraph \"Extension State\"\n        INACTIVE[\"Inactive\"]\n        ACTIVATING[\"Activating\"]\n        ACTIVE[\"Active\"]\n        FAILED[\"Failed\"]\n    end\n    \n    STARTUP --\u003e EVENT\n    LANGUAGE --\u003e EVENT\n    COMMAND --\u003e EVENT\n    VIEW --\u003e EVENT\n    CUSTOM --\u003e EVENT\n    \n    EVENT --\u003e CHECK\n    CHECK --\u003e LOAD\n    LOAD --\u003e ACTIVATE\n    ACTIVATE --\u003e CONTEXT\n    \n    INACTIVE --\u003e ACTIVATING\n    ACTIVATING --\u003e ACTIVE\n    ACTIVATING --\u003e FAILED\n```\n\nThe activation lifecycle is managed by `ExtensionService`:\n\n- **Activation Kinds**: `ActivationKind.Normal` (standard) or `ActivationKind.Immediate` (eager)\n- **Dependency Resolution**: Extensions with dependencies are activated after their dependencies\n- **Context Creation**: Each extension receives an `ExtensionContext` object with subscriptions, storage, etc.\n\n**Sources**:\n- [src/vs/workbench/api/common/extHost.protocol.ts:87-89]()\n- [src/vs/workbench/api/common/extHost.api.impl.ts:255-384]()\n\n### Extension Context\n\nWhen an extension is activated, it receives an `ExtensionContext` object:\n\n```typescript\ninterface ExtensionContext {\n  subscriptions: Disposable[];           // Cleanup on deactivation\n  workspaceState: Memento;               // Workspace-scoped storage\n  globalState: Memento \u0026 { setKeysForSync(keys: string[]): void };\n  secrets: SecretStorage;                // Secure storage\n  extensionUri: Uri;                     // Extension's install location\n  extensionPath: string;                 // File system path\n  environmentVariableCollection: EnvironmentVariableCollection;\n  asAbsolutePath(relativePath: string): string;\n  storageUri: Uri | undefined;           // Workspace storage location\n  globalStorageUri: Uri;                 // Global storage location\n  logUri: Uri;                           // Log directory\n  extensionMode: ExtensionMode;          // Development, Test, or Production\n  extension: Extension\u003cany\u003e;             // Extension metadata\n  // ... additional properties\n}\n```\n\n**Sources**: \n- [src/vscode-dts/vscode.d.ts:7000-7200]() (approximate range for ExtensionContext)\n- [src/vs/workbench/api/common/extHost.api.impl.ts:255-476]()\n\n## Extension Host Architecture\n\n### Extension Host Types\n\nVS Code supports multiple types of extension hosts to accommodate different execution environments:\n\n```mermaid\ngraph TB\n    subgraph \"Extension Host Kinds\"\n        LOCAL_PROCESS[\"LocalProcess\u003cbr/\u003eNode.js extension host\u003cbr/\u003eFull system access\"]\n        LOCAL_WORKER[\"LocalWebWorker\u003cbr/\u003eWeb Worker extension host\u003cbr/\u003eSandboxed, no Node.js\"]\n        REMOTE[\"Remote\u003cbr/\u003eExtension host on remote server\u003cbr/\u003eSSH, Container, WSL\"]\n    end\n    \n    subgraph \"Extension Types\"\n        UI[\"UI Extensions\u003cbr/\u003eRun in local host\u003cbr/\u003eWorkspace-independent\"]\n        WORKSPACE[\"Workspace Extensions\u003cbr/\u003eRun in workspace host\u003cbr/\u003eWorkspace-dependent\"]\n    end\n    \n    subgraph \"Selection Logic\"\n        MANIFEST[\"Extension Manifest\u003cbr/\u003eextensionKind property\"]\n        PROPS[\"ExtensionManifestProperties\u003cbr/\u003eprefersExecuteOnUI()\u003cbr/\u003eprefersExecuteOnWorkspace()\"]\n    end\n    \n    UI --\u003e LOCAL_PROCESS\n    UI --\u003e LOCAL_WORKER\n    WORKSPACE --\u003e LOCAL_PROCESS\n    WORKSPACE --\u003e LOCAL_WORKER\n    WORKSPACE --\u003e REMOTE\n    \n    MANIFEST --\u003e PROPS\n    PROPS --\u003e UI\n    PROPS --\u003e WORKSPACE\n```\n\n**Extension Kind Determination**:\n- Extensions can specify `\"extensionKind\": [\"ui\"]` or `[\"workspace\"]` in their manifest\n- VS Code uses `ExtensionManifestPropertiesService` to determine the preferred execution location\n- Some extensions (like debuggers, language servers) require workspace access and run remotely\n- UI-focused extensions (like themes) run in the local extension host\n\n**Sources**:\n- [src/vs/workbench/api/common/extHost.api.impl.ts:510-512]()\n- [src/vs/workbench/api/common/extHost.protocol.ts:87-89]()\n\n### Extension Host Initialization\n\nThe extension host initialization follows this sequence:\n\n```mermaid\nsequenceDiagram\n    participant Main as Main Process\n    participant Workbench as Workbench\n    participant ExtHost as Extension Host\n    participant Services as ExtHost Services\n    participant API as API Factory\n    participant Ext as Extension\n\n    Main-\u003e\u003eExtHost: Fork Extension Host Process\n    ExtHost-\u003e\u003eServices: Initialize ExtHost Services\n    Services-\u003e\u003eServices: Register RPC Endpoints\n    Workbench-\u003e\u003eExtHost: $initData (InitData)\n    ExtHost-\u003e\u003eAPI: createApiFactoryAndRegisterActors()\n    API-\u003e\u003eServices: Create ExtHost* Services\n    Services--\u003e\u003eAPI: Service Instances\n    API-\u003e\u003eAPI: Register RPC Protocol Handlers\n    ExtHost-\u003e\u003eExt: Scan \u0026 Load Extensions\n    Ext-\u003e\u003eExt: activate(context)\n    Ext-\u003e\u003eAPI: Use vscode API\n    API-\u003e\u003eServices: Delegate to ExtHost Services\n    Services-\u003e\u003eWorkbench: RPC Call to MainThread\n```\n\n**Sources**:\n- [src/vs/workbench/api/common/extHost.api.impl.ts:131-243]()\n- [src/vs/workbench/services/extensions/common/extensionHostProtocol.ts:1-100]() (approximate)\n\n## RPC Protocol and Communication\n\n### Protocol Architecture\n\nThe RPC protocol enables bidirectional communication between the workbench and extension host:\n\n```mermaid\ngraph TB\n    subgraph \"MainThread (Workbench)\"\n        MT_COMMANDS[\"MainThreadCommands\u003cbr/\u003e$registerCommand\u003cbr/\u003e$executeCommand\"]\n        MT_LANGS[\"MainThreadLanguageFeatures\u003cbr/\u003e$registerDocumentSymbolProvider\u003cbr/\u003e$registerCompletionProvider\"]\n        MT_EDITORS[\"MainThreadTextEditors\u003cbr/\u003e$tryShowTextDocument\u003cbr/\u003e$tryApplyEdits\"]\n        MT_TERMINAL[\"MainThreadTerminalService\u003cbr/\u003e$createTerminal\u003cbr/\u003e$sendText\"]\n    end\n    \n    subgraph \"RPC Protocol Layer\"\n        PROTOCOL[\"IRPCProtocol\u003cbr/\u003eextHost.protocol.ts\u003cbr/\u003eSerialization\u003cbr/\u003eType Converters\"]\n        MSG_QUEUE[\"Message Queue\u003cbr/\u003eBuffering\u003cbr/\u003eRequest/Response Matching\"]\n    end\n    \n    subgraph \"ExtHost (Extension Host)\"\n        EH_COMMANDS[\"ExtHostCommands\u003cbr/\u003eregisterCommand\u003cbr/\u003eexecuteCommand\"]\n        EH_LANGS[\"ExtHostLanguageFeatures\u003cbr/\u003eDocumentSymbolAdapter\u003cbr/\u003eCompletionAdapter\"]\n        EH_EDITORS[\"ExtHostEditors\u003cbr/\u003eTextEditor instances\u003cbr/\u003eEdit operations\"]\n        EH_TERMINAL[\"ExtHostTerminalService\u003cbr/\u003eTerminal instances\u003cbr/\u003eProcess management\"]\n    end\n    \n    MT_COMMANDS \u003c--\u003e|\"Commands\"| PROTOCOL\n    MT_LANGS \u003c--\u003e|\"Language Features\"| PROTOCOL\n    MT_EDITORS \u003c--\u003e|\"Editor Operations\"| PROTOCOL\n    MT_TERMINAL \u003c--\u003e|\"Terminal Operations\"| PROTOCOL\n    \n    PROTOCOL --\u003e MSG_QUEUE\n    MSG_QUEUE --\u003e PROTOCOL\n    \n    PROTOCOL \u003c--\u003e|\"Commands\"| EH_COMMANDS\n    PROTOCOL \u003c--\u003e|\"Language Features\"| EH_LANGS\n    PROTOCOL \u003c--\u003e|\"Editor Operations\"| EH_EDITORS\n    PROTOCOL \u003c--\u003e|\"Terminal Operations\"| EH_TERMINAL\n```\n\n### Key Protocol Interfaces\n\nThe protocol defines paired interfaces for each subsystem:\n\n| MainThread Interface | ExtHost Interface | Purpose |\n|---------------------|------------------|---------|\n| `MainThreadCommandsShape` | `ExtHostCommandsShape` | Command registration and execution |\n| `MainThreadLanguageFeaturesShape` | `ExtHostLanguageFeaturesShape` | Language providers (completions, diagnostics, etc.) |\n| `MainThreadTextEditorsShape` | `ExtHostEditorsShape` | Text editor manipulation |\n| `MainThreadTerminalServiceShape` | `ExtHostTerminalServiceShape` | Terminal creation and management |\n| `MainThreadDocumentsShape` | `ExtHostDocumentsShape` | Document synchronization |\n| `MainThreadNotebookShape` | `ExtHostNotebookShape` | Notebook operations |\n| `MainThreadChatAgents2Shape` | `ExtHostChatAgents2Shape` | Chat agents and participants |\n\n**Sources**:\n- [src/vs/workbench/api/common/extHost.protocol.ts:116-800]()\n\n### Type Conversion Layer\n\nData crossing the RPC boundary must be serialized. VS Code uses type converters defined in `ExtHostTypeConverters`:\n\n```mermaid\ngraph LR\n    subgraph \"Extension API Types\"\n        VS_POS[\"vscode.Position\"]\n        VS_RANGE[\"vscode.Range\"]\n        VS_DIAG[\"vscode.Diagnostic\"]\n        VS_EDIT[\"vscode.TextEdit\"]\n    end\n    \n    subgraph \"Type Converters\"\n        CONV[\"ExtHostTypeConverters\u003cbr/\u003ePosition.from/to\u003cbr/\u003eRange.from/to\u003cbr/\u003eDiagnostic.from/to\"]\n    end\n    \n    subgraph \"Internal Types\"\n        I_POS[\"IPosition\"]\n        I_RANGE[\"IRange\"]\n        I_MARKER[\"IMarkerData\"]\n        I_EDIT[\"ISingleEditOperation\"]\n    end\n    \n    VS_POS \u003c--\u003e|\"from/to\"| CONV\n    VS_RANGE \u003c--\u003e|\"from/to\"| CONV\n    VS_DIAG \u003c--\u003e|\"from/to\"| CONV\n    VS_EDIT \u003c--\u003e|\"from/to\"| CONV\n    \n    CONV \u003c--\u003e|\"from/to\"| I_POS\n    CONV \u003c--\u003e|\"from/to\"| I_RANGE\n    CONV \u003c--\u003e|\"from/to\"| I_MARKER\n    CONV \u003c--\u003e|\"from/to\"| I_EDIT\n```\n\nKey conversion patterns:\n- **Position**: API uses 0-based line/character, internal uses 1-based lineNumber/column\n- **Range**: Converts between `vscode.Range` and `IRange`\n- **URI**: Handles URI transformation and scheme conversion\n- **Commands**: Wraps commands with disposables for cleanup\n- **Markdown**: Extracts URIs and sanitizes content\n\n**Sources**:\n- [src/vs/workbench/api/common/extHostTypeConverters.ts:1-500]()\n- [src/vs/workbench/api/common/extHostTypeConverters.ts:94-175]()\n\n### RPC Call Flow Example\n\nHere's a concrete example of a language feature call (document symbols):\n\n```mermaid\nsequenceDiagram\n    participant Editor as Text Editor\n    participant MainLang as MainThreadLanguageFeatures\n    participant Protocol as RPC Protocol\n    participant ExtLang as ExtHostLanguageFeatures\n    participant Provider as Extension Provider\n\n    Editor-\u003e\u003eMainLang: Request document symbols\n    MainLang-\u003e\u003eProtocol: $provideDocumentSymbols(handle, resource)\n    Protocol-\u003e\u003eExtLang: provideDocumentSymbols(handle, resource)\n    ExtLang-\u003e\u003eProvider: provideDocumentSymbols(document, token)\n    Provider--\u003e\u003eExtLang: vscode.DocumentSymbol[]\n    ExtLang-\u003e\u003eExtLang: Convert to DTO\n    ExtLang--\u003e\u003eProtocol: languages.DocumentSymbol[]\n    Protocol--\u003e\u003eMainLang: languages.DocumentSymbol[]\n    MainLang--\u003e\u003eEditor: Display symbols\n```\n\n**Sources**:\n- [src/vs/workbench/api/browser/mainThreadLanguageFeatures.ts:1-100]()\n- [src/vs/workbench/api/common/extHostLanguageFeatures.ts:45-104]()\n\n## Extension API Implementation\n\n### API Object Creation\n\nThe `vscode` API object is created by `createApiFactoryAndRegisterActors` and is unique per extension:\n\n```mermaid\ngraph TB\n    subgraph \"API Factory\"\n        FACTORY[\"createApiFactoryAndRegisterActors\u003cbr/\u003eextHost.api.impl.ts\"]\n        SERVICES[\"ExtHost Services\u003cbr/\u003eCommands, Languages,\u003cbr/\u003eEditors, etc.\"]\n    end\n    \n    subgraph \"API Namespaces\"\n        AUTH[\"authentication\"]\n        COMMANDS[\"commands\"]\n        ENV[\"env\"]\n        EXTENSIONS[\"extensions\"]\n        LANGUAGES[\"languages\"]\n        WINDOW[\"window\"]\n        WORKSPACE[\"workspace\"]\n        NOTEBOOKS[\"notebooks\"]\n        CHAT[\"chat\"]\n        TASKS[\"tasks\"]\n        DEBUG[\"debug\"]\n    end\n    \n    subgraph \"Extension-Specific\"\n        EXT_CTX[\"ExtensionContext\"]\n        EXT_API[\"vscode API object\u003cbr/\u003eUnique per extension\"]\n    end\n    \n    FACTORY --\u003e SERVICES\n    SERVICES --\u003e AUTH\n    SERVICES --\u003e COMMANDS\n    SERVICES --\u003e ENV\n    SERVICES --\u003e EXTENSIONS\n    SERVICES --\u003e LANGUAGES\n    SERVICES --\u003e WINDOW\n    SERVICES --\u003e WORKSPACE\n    SERVICES --\u003e NOTEBOOKS\n    SERVICES --\u003e CHAT\n    SERVICES --\u003e TASKS\n    SERVICES --\u003e DEBUG\n    \n    AUTH --\u003e EXT_API\n    COMMANDS --\u003e EXT_API\n    ENV --\u003e EXT_API\n    EXTENSIONS --\u003e EXT_API\n    LANGUAGES --\u003e EXT_API\n    WINDOW --\u003e EXT_API\n    WORKSPACE --\u003e EXT_API\n    NOTEBOOKS --\u003e EXT_API\n    CHAT --\u003e EXT_API\n    TASKS --\u003e EXT_API\n    DEBUG --\u003e EXT_API\n    \n    EXT_CTX --\u003e EXT_API\n```\n\n**Sources**:\n- [src/vs/workbench/api/common/extHost.api.impl.ts:131-253]()\n\n### Key API Namespaces\n\n#### Commands API\n\n```typescript\nnamespace commands {\n  registerCommand(id, command, thisArgs?): Disposable\n  registerTextEditorCommand(id, callback, thisArg?): Disposable\n  executeCommand\u003cT\u003e(id, ...args): Thenable\u003cT\u003e\n  getCommands(filterInternal?): Thenable\u003cstring[]\u003e\n}\n```\n\nImplementation:\n- `ExtHostCommands` manages command registration\n- Commands are registered with the main thread via `MainThreadCommands.$registerCommand`\n- Execution flows through `CommandsConverter` for serialization\n\n**Sources**: \n- [src/vs/workbench/api/common/extHost.api.impl.ts:341-384]()\n\n#### Languages API\n\n```typescript\nnamespace languages {\n  registerCompletionItemProvider(selector, provider, ...triggerCharacters): Disposable\n  registerCodeActionsProvider(selector, provider, metadata?): Disposable\n  registerCodeLensProvider(selector, provider): Disposable\n  registerDefinitionProvider(selector, provider): Disposable\n  registerHoverProvider(selector, provider): Disposable\n  registerDocumentSymbolProvider(selector, provider): Disposable\n  // ... many more providers\n}\n```\n\nImplementation:\n- `ExtHostLanguageFeatures` creates adapter classes (e.g., `CompletionAdapter`, `DefinitionAdapter`)\n- Adapters handle conversion between API types and internal DTOs\n- Providers are registered with `MainThreadLanguageFeatures`\n\n**Sources**:\n- [src/vs/workbench/api/common/extHost.api.impl.ts:800-1200]() (approximate range)\n- [src/vs/workbench/api/common/extHostLanguageFeatures.ts:45-3000]()\n\n#### Window API\n\n```typescript\nnamespace window {\n  showInformationMessage(message, ...items): Thenable\u003cT | undefined\u003e\n  showWarningMessage(message, ...items): Thenable\u003cT | undefined\u003e\n  showErrorMessage(message, ...items): Thenable\u003cT | undefined\u003e\n  showQuickPick(items, options?, token?): Thenable\u003cT | undefined\u003e\n  showInputBox(options?, token?): Thenable\u003cstring | undefined\u003e\n  createOutputChannel(name): OutputChannel\n  createTerminal(options): Terminal\n  // ... more methods\n}\n```\n\n**Sources**: \n- [src/vs/workbench/api/common/extHost.api.impl.ts:1500-2000]() (approximate)\n\n### Proposed APIs\n\nVS Code uses **proposed APIs** for experimental features:\n\n```mermaid\ngraph TB\n    subgraph \"API Stability Levels\"\n        STABLE[\"Stable API\u003cbr/\u003evscode.d.ts\u003cbr/\u003eFrozen, backward compatible\"]\n        PROPOSED[\"Proposed APIs\u003cbr/\u003evscode.proposed.*.d.ts\u003cbr/\u003eUnder development\"]\n    end\n    \n    subgraph \"Proposed API System\"\n        PROPOSALS[\"API Proposals\u003cbr/\u003eextensionsApiProposals.ts\u003cbr/\u003eRegistry of all proposals\"]\n        MANIFEST[\"Extension Manifest\u003cbr/\u003eenabledApiProposals: []\"]\n        CHECK[\"checkProposedApiEnabled()\u003cbr/\u003eRuntime validation\"]\n    end\n    \n    subgraph \"Extension Access\"\n        BUILTIN[\"Built-in Extensions\u003cbr/\u003eCan use proposed APIs\"]\n        DEVELOPMENT[\"Development Extensions\u003cbr/\u003eCan enable proposals\"]\n        PRODUCTION[\"Published Extensions\u003cbr/\u003eCannot use proposed APIs\"]\n    end\n    \n    STABLE -.evolves into.-\u003e PROPOSED\n    PROPOSED --\u003e PROPOSALS\n    PROPOSALS --\u003e MANIFEST\n    MANIFEST --\u003e CHECK\n    \n    CHECK --\u003e BUILTIN\n    CHECK --\u003e DEVELOPMENT\n    CHECK -.blocks.-\u003e PRODUCTION\n```\n\nExamples of proposed APIs (as of current codebase):\n- `aiRelatedInformation`: AI-powered related information\n- `chatParticipantPrivate`: Private chat participant APIs\n- `diffCommand`: Enhanced diff command support\n- `embeddings`: Text embeddings API\n- `extensionRuntime`: Extension runtime control\n\n**Sources**:\n- [src/vs/platform/extensions/common/extensionsApiProposals.ts:1-500]()\n- [extensions/vscode-api-tests/package.json:7-44]()\n\n## Extension Management Service\n\nThe extension management service handles installation, updates, and lifecycle of extensions.\n\n### Extension Management Architecture\n\n```mermaid\ngraph TB\n    subgraph \"UI Layer\"\n        VIEWLET[\"Extensions Viewlet\u003cbr/\u003eExtensionsViewPaneContainer\"]\n        EDITOR[\"Extension Editor\u003cbr/\u003eExtensionEditor\"]\n        ACTIONS[\"Extension Actions\u003cbr/\u003eInstallAction\u003cbr/\u003eUninstallAction\u003cbr/\u003eUpdateAction\"]\n    end\n    \n    subgraph \"Workbench Service Layer\"\n        WORKBENCH_SVC[\"ExtensionsWorkbenchService\u003cbr/\u003eIExtensionsWorkbenchService\u003cbr/\u003eHigh-level operations\"]\n        LOCAL_EXT[\"Extension class\u003cbr/\u003eWraps ILocalExtension\u003cbr/\u003e+ IGalleryExtension\"]\n    end\n    \n    subgraph \"Extension Management Layer\"\n        MGMT_SVC[\"ExtensionManagementService\u003cbr/\u003eIExtensionManagementService\u003cbr/\u003eInstall/Uninstall/Update\"]\n        MULTI_SERVER[\"Multi-Server Support\u003cbr/\u003eLocal + Remote servers\"]\n        SCANNER[\"ExtensionScanner\u003cbr/\u003eDiscover extensions\"]\n        DOWNLOADER[\"ExtensionsDownloader\u003cbr/\u003eDownload .vsix files\"]\n    end\n    \n    subgraph \"Gallery Service\"\n        GALLERY[\"ExtensionGalleryService\u003cbr/\u003eIExtensionGalleryService\u003cbr/\u003eMarketplace API\"]\n        MANIFEST_SVC[\"ExtensionGalleryManifestService\u003cbr/\u003eFetch manifests\"]\n    end\n    \n    subgraph \"Storage\"\n        FS[\"File System\u003cbr/\u003e~/.vscode/extensions\"]\n        PROFILE[\"User Profile Storage\u003cbr/\u003eExtension metadata\"]\n    end\n    \n    VIEWLET --\u003e WORKBENCH_SVC\n    EDITOR --\u003e WORKBENCH_SVC\n    ACTIONS --\u003e WORKBENCH_SVC\n    \n    WORKBENCH_SVC --\u003e LOCAL_EXT\n    WORKBENCH_SVC --\u003e MGMT_SVC\n    \n    MGMT_SVC --\u003e MULTI_SERVER\n    MGMT_SVC --\u003e SCANNER\n    MGMT_SVC --\u003e DOWNLOADER\n    MGMT_SVC --\u003e GALLERY\n    \n    GALLERY --\u003e MANIFEST_SVC\n    \n    SCANNER --\u003e FS\n    DOWNLOADER --\u003e FS\n    MGMT_SVC --\u003e PROFILE\n```\n\n**Sources**:\n- [src/vs/workbench/contrib/extensions/browser/extensionsWorkbenchService.ts:1-100]()\n- [src/vs/platform/extensionManagement/node/extensionManagementService.ts:72-100]()\n\n### Extension Installation Flow\n\n```mermaid\nsequenceDiagram\n    participant User as User\n    participant UI as Extensions UI\n    participant Workbench as ExtensionsWorkbenchService\n    participant Mgmt as ExtensionManagementService\n    participant Gallery as ExtensionGalleryService\n    participant Download as ExtensionsDownloader\n    participant Scanner as ExtensionScanner\n    participant ExtHost as Extension Host\n\n    User-\u003e\u003eUI: Click Install\n    UI-\u003e\u003eWorkbench: install(extension)\n    Workbench-\u003e\u003eGallery: getExtension(id)\n    Gallery--\u003e\u003eWorkbench: IGalleryExtension\n    Workbench-\u003e\u003eMgmt: installFromGallery(gallery, options)\n    Mgmt-\u003e\u003eDownload: download(gallery)\n    Download-\u003e\u003eGallery: Download .vsix\n    Gallery--\u003e\u003eDownload: .vsix file\n    Download--\u003e\u003eMgmt: Local .vsix path\n    Mgmt-\u003e\u003eMgmt: extractExtension(vsix)\n    Mgmt-\u003e\u003eScanner: scanExtension(location)\n    Scanner--\u003e\u003eMgmt: ILocalExtension\n    Mgmt-\u003e\u003eExtHost: $didInstallExtensions(installed)\n    ExtHost-\u003e\u003eExtHost: Activate if needed\n    Mgmt--\u003e\u003eWorkbench: InstallExtensionResult\n    Workbench--\u003e\u003eUI: Update UI\n```\n\n**Sources**:\n- [src/vs/platform/extensionManagement/node/extensionManagementService.ts:200-500]()\n- [src/vs/workbench/contrib/extensions/browser/extensionsWorkbenchService.ts:500-800]()\n\n### Extension States and Enablement\n\nExtensions can be in various states:\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e Uninstalled\n    Uninstalled --\u003e Installing : install()\n    Installing --\u003e Installed : success\n    Installing --\u003e Uninstalled : failure\n    \n    Installed --\u003e Enabled : enable()\n    Installed --\u003e Disabled : disable()\n    \n    Enabled --\u003e DisabledGlobally : disableGlobally()\n    Enabled --\u003e DisabledWorkspace : disableForWorkspace()\n    \n    DisabledGlobally --\u003e Enabled : enableGlobally()\n    DisabledWorkspace --\u003e Enabled : enableForWorkspace()\n    \n    Installed --\u003e Uninstalling : uninstall()\n    Enabled --\u003e Uninstalling : uninstall()\n    DisabledGlobally --\u003e Uninstalling : uninstall()\n    DisabledWorkspace --\u003e Uninstalling : uninstall()\n    Uninstalling --\u003e Uninstalled : complete\n    \n    note right of Enabled\n        Extension is active\n        Can contribute features\n    end note\n    \n    note right of DisabledGlobally\n        Disabled in all workspaces\n    end note\n    \n    note right of DisabledWorkspace\n        Disabled only in current workspace\n    end note\n```\n\nEnablement is managed by `IWorkbenchExtensionEnablementService` with states:\n- `EnablementState.EnabledGlobally`: Enabled for all workspaces\n- `EnablementState.EnabledWorkspace`: Enabled for current workspace\n- `EnablementState.DisabledGlobally`: Disabled for all workspaces\n- `EnablementState.DisabledWorkspace`: Disabled for current workspace\n- `EnablementState.DisabledByTrustRequirement`: Disabled due to workspace trust\n- `EnablementState.DisabledByExtensionKind`: Disabled due to incompatible kind (UI vs Workspace)\n\n**Sources**:\n- [src/vs/workbench/services/extensionManagement/common/extensionManagement.ts:1-200]()\n- [src/vs/workbench/contrib/extensions/browser/extensionsWorkbenchService.ts:93-150]()\n\n### Extension Metadata and Storage\n\nExtension metadata is stored in multiple locations:\n\n| Storage | Purpose | Location |\n|---------|---------|----------|\n| **Extension Manifest** | `package.json` with capabilities | Extension directory |\n| **Gallery Metadata** | Publisher, stats, ratings | Retrieved from marketplace |\n| **Local Metadata** | Install timestamp, pinned state | `extensions.json` in profile |\n| **Extension Storage** | Extension-specific data | `globalStorage/` or `workspaceStorage/` |\n| **Secrets Storage** | Secure storage via `secrets` API | Platform keychain |\n\n**Sources**:\n- [src/vs/platform/extensionManagement/common/extensionManagement.ts:100-400]()\n- [src/vs/workbench/contrib/extensions/browser/extensionsWorkbenchService.ts:93-200]()\n\n### Multi-Server Extension Management\n\nVS Code supports installing extensions to different servers:\n\n```mermaid\ngraph TB\n    subgraph \"Extension Management Servers\"\n        LOCAL[\"Local Extension Management Server\u003cbr/\u003eDesktop/Web local extensions\"]\n        REMOTE[\"Remote Extension Management Server\u003cbr/\u003eSSH/Container/WSL extensions\"]\n        WEB[\"Web Extension Management Server\u003cbr/\u003eBrowser-only extensions\"]\n    end\n    \n    subgraph \"Server Selection Logic\"\n        MANIFEST_PROPS[\"ExtensionManifestPropertiesService\u003cbr/\u003eAnalyze manifest\"]\n        UI_PREF[\"prefersExecuteOnUI()\"]\n        WORKSPACE_PREF[\"prefersExecuteOnWorkspace()\"]\n        CAN_EXECUTE[\"canExecuteOnUI()\u003cbr/\u003ecanExecuteOnWorkspace()\"]\n    end\n    \n    subgraph \"Installation Routing\"\n        INSTALL_ACTION[\"InstallAction\"]\n        LOCAL_INSTALL[\"LocalInstallAction\"]\n        REMOTE_INSTALL[\"RemoteInstallAction\"]\n        WEB_INSTALL[\"WebInstallAction\"]\n    end\n    \n    MANIFEST_PROPS --\u003e UI_PREF\n    MANIFEST_PROPS --\u003e WORKSPACE_PREF\n    UI_PREF --\u003e CAN_EXECUTE\n    WORKSPACE_PREF --\u003e CAN_EXECUTE\n    \n    CAN_EXECUTE --\u003e INSTALL_ACTION\n    INSTALL_ACTION --\u003e LOCAL_INSTALL\n    INSTALL_ACTION --\u003e REMOTE_INSTALL\n    INSTALL_ACTION --\u003e WEB_INSTALL\n    \n    LOCAL_INSTALL --\u003e LOCAL\n    REMOTE_INSTALL --\u003e REMOTE\n    WEB_INSTALL --\u003e WEB\n```\n\n**Sources**:\n- [src/vs/workbench/services/extensionManagement/common/extensionManagementService.ts:1-100]()\n- [src/vs/workbench/contrib/extensions/browser/extensionsActions.ts:1-100]()\n\n## Extension Management UI\n\n### Extensions Viewlet\n\nThe Extensions viewlet provides a comprehensive UI for discovering, installing, and managing extensions:\n\n```mermaid\ngraph TB\n    subgraph \"Extensions Viewlet\"\n        CONTAINER[\"ExtensionsViewPaneContainer\u003cbr/\u003eMain container\"]\n        SEARCH[\"Search Input\u003cbr/\u003eQuery parsing\"]\n    end\n    \n    subgraph \"Extension Views\"\n        INSTALLED[\"Installed Extensions\u003cbr/\u003eExtensionsListView\"]\n        ENABLED[\"Enabled Extensions\u003cbr/\u003eEnabledExtensionsView\"]\n        DISABLED[\"Disabled Extensions\u003cbr/\u003eDisabledExtensionsView\"]\n        RECOMMENDED[\"Recommended\u003cbr/\u003eRecommendedExtensionsView\"]\n        WORKSPACE_REC[\"Workspace Recommendations\u003cbr/\u003eWorkspaceRecommendedExtensionsView\"]\n        POPULAR[\"Popular\u003cbr/\u003eDefaultPopularExtensionsView\"]\n        OUTDATED[\"Outdated\u003cbr/\u003eOutdatedExtensionsView\"]\n        MARKETPLACE[\"Search Results\u003cbr/\u003eSearchMarketplaceExtensionsView\"]\n    end\n    \n    subgraph \"Extension List\"\n        LIST[\"WorkbenchPagedList\u003cbr/\u003eVirtual scrolling\"]\n        RENDERER[\"ExtensionRenderer\u003cbr/\u003eExtension card rendering\"]\n        DELEGATE[\"Delegate\u003cbr/\u003eList behavior\"]\n    end\n    \n    CONTAINER --\u003e SEARCH\n    CONTAINER --\u003e INSTALLED\n    CONTAINER --\u003e ENABLED\n    CONTAINER --\u003e DISABLED\n    CONTAINER --\u003e RECOMMENDED\n    CONTAINER --\u003e WORKSPACE_REC\n    CONTAINER --\u003e POPULAR\n    CONTAINER --\u003e OUTDATED\n    CONTAINER --\u003e MARKETPLACE\n    \n    INSTALLED --\u003e LIST\n    ENABLED --\u003e LIST\n    DISABLED --\u003e LIST\n    RECOMMENDED --\u003e LIST\n    \n    LIST --\u003e RENDERER\n    LIST --\u003e DELEGATE\n```\n\n**Sources**:\n- [src/vs/workbench/contrib/extensions/browser/extensionsViewlet.ts:1-200]()\n- [src/vs/workbench/contrib/extensions/browser/extensionsViews.ts:1-100]()\n\n### Extension Editor\n\nThe Extension Editor provides detailed information about a single extension:\n\n```mermaid\ngraph TB\n    subgraph \"Extension Editor Tabs\"\n        DETAILS[\"Details Tab\u003cbr/\u003eREADME content\"]\n        FEATURES[\"Features Tab\u003cbr/\u003eContribution points\"]\n        CHANGELOG[\"Changelog Tab\u003cbr/\u003eVersion history\"]\n        DEPENDENCIES[\"Dependencies Tab\u003cbr/\u003eExtension dependencies\"]\n    end\n    \n    subgraph \"Header Section\"\n        ICON[\"Extension Icon\"]\n        NAME[\"Name \u0026 Publisher\"]\n        VERSION[\"Version Info\"]\n        ACTIONS[\"Action Bar\u003cbr/\u003eInstall/Update/Uninstall\"]\n    end\n    \n    subgraph \"Metadata Widgets\"\n        INSTALLS[\"Install Count\"]\n        RATING[\"Rating Widget\"]\n        SPONSOR[\"Sponsor Widget\"]\n        RECOMMENDATION[\"Recommendation Widget\"]\n        STATUS[\"Extension Status\"]\n        BADGE[\"Remote Badge\"]\n    end\n    \n    subgraph \"Content Rendering\"\n        WEBVIEW[\"Webview\u003cbr/\u003eMarkdown rendering\"]\n        TREE[\"Features Tree\u003cbr/\u003eCommands, settings, etc.\"]\n    end\n    \n    ICON --\u003e ACTIONS\n    NAME --\u003e ACTIONS\n    VERSION --\u003e ACTIONS\n    \n    ACTIONS --\u003e INSTALLS\n    ACTIONS --\u003e RATING\n    ACTIONS --\u003e SPONSOR\n    ACTIONS --\u003e RECOMMENDATION\n    ACTIONS --\u003e STATUS\n    ACTIONS --\u003e BADGE\n    \n    DETAILS --\u003e WEBVIEW\n    FEATURES --\u003e TREE\n    CHANGELOG --\u003e WEBVIEW\n    DEPENDENCIES --\u003e TREE\n```\n\n**Sources**:\n- [src/vs/workbench/contrib/extensions/browser/extensionEditor.ts:1-232]()\n- [src/vs/workbench/contrib/extensions/browser/extensionsWidgets.ts:1-100]()\n\n### Extension Actions\n\nCommon extension actions and their implementations:\n\n| Action | Class | Behavior |\n|--------|-------|----------|\n| **Install** | `InstallAction` | Installs extension from gallery |\n| **Uninstall** | `UninstallAction` | Removes installed extension |\n| **Update** | `UpdateAction` | Updates to latest version |\n| **Enable** | `EnableDropDownAction` | Enables disabled extension |\n| **Disable** | `DisableDropDownAction` | Disables active extension |\n| **Install Another Version** | `InstallAnotherVersionAction` | Shows version picker |\n| **Set Color Theme** | `SetColorThemeAction` | Applies theme extension |\n| **Reload** | `ReloadAction` | Reloads window to activate |\n| **Toggle Auto-Update** | `ToggleAutoUpdateForExtensionAction` | Controls auto-update |\n| **Toggle Pre-Release** | `TogglePreReleaseExtensionAction` | Switches release channel |\n\n**Sources**:\n- [src/vs/workbench/contrib/extensions/browser/extensionsActions.ts:79-320]()\n\n## Extension Query System\n\nVS Code includes a sophisticated query system for finding extensions:\n\n### Query Syntax\n\nThe query parser in `Query` class supports:\n- **Tag filters**: `@installed`, `@enabled`, `@disabled`, `@builtin`, `@recommended`, `@deprecated`, `@outdated`\n- **Category filters**: `@category:themes`, `@category:programming languages`\n- **ID filters**: `@id:publisher.extension`\n- **Sort options**: `@sort:installs`, `@sort:rating`, `@sort:name`, `@sort:publishedDate`\n- **Feature filters**: `@feature:xyz` (searches in feature contributions)\n- **Text search**: Free-form text searches extension names, descriptions, and tags\n\n**Sources**:\n- [src/vs/workbench/contrib/extensions/common/extensionQuery.ts:1-300]() (approximate)\n\n### Gallery Service Query\n\nThe `ExtensionGalleryService` translates queries into marketplace API calls:\n\n```mermaid\ngraph LR\n    subgraph \"Query Input\"\n        USER_QUERY[\"User Query\u003cbr/\u003e@category:themes react\"]\n    end\n    \n    subgraph \"Query Parser\"\n        PARSE[\"Query.parse()\"]\n        TOKENS[\"Query Tokens\u003cbr/\u003etags, text, sort\"]\n    end\n    \n    subgraph \"Gallery Query Builder\"\n        BUILDER[\"Build Gallery Query\"]\n        FILTERS[\"Criteria Filters\"]\n        SORT[\"Sort Order\"]\n        FLAGS[\"Query Flags\"]\n    end\n    \n    subgraph \"Marketplace API\"\n        API[\"POST /extensionquery\"]\n        RESULTS[\"IRawGalleryQueryResult\"]\n    end\n    \n    USER_QUERY --\u003e PARSE\n    PARSE --\u003e TOKENS\n    TOKENS --\u003e BUILDER\n    BUILDER --\u003e FILTERS\n    BUILDER --\u003e SORT\n    BUILDER --\u003e FLAGS\n    FILTERS --\u003e API\n    SORT --\u003e API\n    FLAGS --\u003e API\n    API --\u003e RESULTS\n```\n\n**Sources**:\n- [src/vs/platform/extensionManagement/common/extensionGalleryService.ts:1-200]()\n\n## Extension Signing and Verification\n\nVS Code supports extension signature verification for security:\n\n### Signature Verification Flow\n\n```mermaid\nsequenceDiagram\n    participant Download as ExtensionsDownloader\n    participant Verify as Signature Verifier\n    participant Install as ExtensionManagementService\n    participant Config as Configuration Service\n    participant User as User\n\n    Download-\u003e\u003eDownload: Download .vsix\n    Download-\u003e\u003eVerify: verifySignature(vsix)\n    Verify-\u003e\u003eConfig: Check verifyExtensionSignature setting\n    \n    alt Verification Required\n        Verify-\u003e\u003eVerify: Validate signature\n        alt Signature Valid\n            Verify--\u003e\u003eDownload: Success\n            Download-\u003e\u003eInstall: Proceed with installation\n        else Signature Invalid\n            Verify--\u003e\u003eDownload: ExtensionManagementError\u003cbr/\u003eSignatureVerificationFailed\n            Download-\u003e\u003eUser: Show error dialog\n            User-\u003e\u003eUser: Choose: Install anyway or Cancel\n            alt Install Anyway\n                User-\u003e\u003eDownload: Install with donotVerifySignature=true\n            end\n        end\n    else Verification Not Required\n        Verify--\u003e\u003eDownload: Skip verification\n        Download-\u003e\u003eInstall: Proceed with installation\n    end\n```\n\nVerification codes:\n- `ExtensionSignatureVerificationCode.Success`: Signature valid\n- `ExtensionSignatureVerificationCode.PackageIsInvalidZip`: Invalid .vsix format\n- `ExtensionSignatureVerificationCode.SignatureManifestIsMissing`: No signature manifest\n- `ExtensionSignatureVerificationCode.SignatureArchiveIsInvalid`: Corrupted signature\n- `ExtensionSignatureVerificationCode.SignatureInvalid`: Signature doesn't match\n\n**Sources**:\n- [src/vs/platform/extensionManagement/common/extensionManagement.ts:300-400]()\n- [src/vs/workbench/contrib/extensions/browser/extensionsActions.ts:145-210]()\n\n## Extension Storage and Secrets\n\nExtensions have access to several storage mechanisms:\n\n### Storage Types\n\n```mermaid\ngraph TB\n    subgraph \"Extension Context Storage APIs\"\n        WORKSPACE_STATE[\"workspaceState: Memento\u003cbr/\u003eWorkspace-scoped key-value\"]\n        GLOBAL_STATE[\"globalState: Memento\u003cbr/\u003eGlobal key-value + sync\"]\n        SECRETS[\"secrets: SecretStorage\u003cbr/\u003eEncrypted storage\"]\n    end\n    \n    subgraph \"File-Based Storage\"\n        WORKSPACE_STORAGE[\"Workspace Storage URI\u003cbr/\u003estorageUri property\"]\n        GLOBAL_STORAGE[\"Global Storage URI\u003cbr/\u003eglobalStorageUri property\"]\n        LOG_DIR[\"Log Directory\u003cbr/\u003elogUri property\"]\n    end\n    \n    subgraph \"Backend Implementation\"\n        STORAGE_SVC[\"IStorageService\"]\n        SECRET_SVC[\"ISecretStorageService\"]\n        FILE_SVC[\"IFileService\"]\n        KEYCHAIN[\"Platform Keychain\u003cbr/\u003emacOS Keychain\u003cbr/\u003eWindows Credential Manager\u003cbr/\u003eLinux Secret Service\"]\n    end\n    \n    WORKSPACE_STATE --\u003e STORAGE_SVC\n    GLOBAL_STATE --\u003e STORAGE_SVC\n    SECRETS --\u003e SECRET_SVC\n    \n    WORKSPACE_STORAGE --\u003e FILE_SVC\n    GLOBAL_STORAGE --\u003e FILE_SVC\n    LOG_DIR --\u003e FILE_SVC\n    \n    SECRET_SVC --\u003e KEYCHAIN\n```\n\n**Storage Locations** (Desktop):\n- **Workspace State**: `.vscode/settings.json` or workspace state file\n- **Global State**: `~/.vscode/globalStorage/\u003cextension-id\u003e/`\n- **Secrets**: Platform keychain (encrypted)\n- **Workspace Storage**: `\u003cworkspace\u003e/.vscode/workspaceStorage/\u003cid\u003e/`\n- **Global Storage**: `~/.vscode/extensions/\u003cextension-id\u003e/globalStorage/`\n\n**Sources**:\n- [src/vscode-dts/vscode.d.ts:7000-7200]() (ExtensionContext definition)\n- [src/vs/workbench/api/common/extHost.api.impl.ts:255-476]()\n\n## Extension Telemetry\n\nExtensions can report telemetry through the VS Code telemetry service:\n\n### Telemetry Flow\n\n```mermaid\ngraph TB\n    subgraph \"Extension\"\n        EXT_LOGGER[\"TelemetryLogger\u003cbr/\u003elogger.logUsage()\"]\n        EXT_SENDER[\"TelemetrySender\u003cbr/\u003eCustom sender\"]\n    end\n    \n    subgraph \"ExtHost Telemetry\"\n        EXTHOST_TEL[\"ExtHostTelemetry\u003cbr/\u003eIExtHostTelemetry\"]\n        TEL_LOGGER[\"ExtHostTelemetryLogger\"]\n    end\n    \n    subgraph \"Main Thread\"\n        MAIN_TEL[\"MainThreadTelemetry\"]\n        TEL_SVC[\"ITelemetryService\"]\n    end\n    \n    subgraph \"Telemetry Backend\"\n        APPINSIGHTS[\"Application Insights\"]\n        CUSTOM[\"Custom Backend\"]\n    end\n    \n    EXT_LOGGER --\u003e TEL_LOGGER\n    EXT_SENDER --\u003e TEL_LOGGER\n    TEL_LOGGER --\u003e EXTHOST_TEL\n    EXTHOST_TEL --\u003e|RPC| MAIN_TEL\n    MAIN_TEL --\u003e TEL_SVC\n    TEL_SVC --\u003e APPINSIGHTS\n    TEL_SVC --\u003e CUSTOM\n```\n\nExtensions can create telemetry loggers:\n```typescript\nconst logger = env.createTelemetryLogger(sender, options);\nlogger.logUsage('eventName', { property: 'value' });\nlogger.logError(error);\n```\n\n**Sources**:\n- [src/vs/workbench/api/common/extHostTelemetry.ts:1-200]() (approximate)\n- [src/vs/workbench/api/common/extHost.api.impl.ts:423-426]()\n\n## Configuration\n\nExtension system behavior can be configured through settings:\n\n| Setting | Purpose |\n|---------|---------|\n| `extensions.autoUpdate` | Automatically update extensions |\n| `extensions.autoCheckUpdates` | Check for updates automatically |\n| `extensions.autoRestart` | Restart automatically after updates |\n| `extensions.ignoreRecommendations` | Hide extension recommendations |\n| `extensions.closeExtensionDetailsOnViewChange` | Close details when switching views |\n| `extensions.verifySignature` | Verify extension signatures |\n| `extensions.requestsTimeout` | Timeout for extension requests (ms) |\n| `extensionsGallery.serviceUrl` | Custom marketplace URL |\n\n**Sources**:\n- [src/vs/workbench/contrib/extensions/browser/extensions.contribution.ts:1-200]()\n- [src/vs/platform/extensionManagement/common/extensionManagement.ts:50-100]()"])</script><script>self.__next_f.push([1,"2c:T6d13,"])</script><script>self.__next_f.push([1,"# Extension Host Architecture and RPC Protocol\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [extensions/vscode-api-tests/package.json](extensions/vscode-api-tests/package.json)\n- [extensions/vscode-api-tests/src/singlefolder-tests/chat.test.ts](extensions/vscode-api-tests/src/singlefolder-tests/chat.test.ts)\n- [src/vs/editor/browser/config/charWidthReader.ts](src/vs/editor/browser/config/charWidthReader.ts)\n- [src/vs/editor/browser/editorBrowser.ts](src/vs/editor/browser/editorBrowser.ts)\n- [src/vs/editor/browser/viewParts/minimap/minimap.ts](src/vs/editor/browser/viewParts/minimap/minimap.ts)\n- [src/vs/editor/browser/viewParts/minimap/minimapCharRenderer.ts](src/vs/editor/browser/viewParts/minimap/minimapCharRenderer.ts)\n- [src/vs/editor/browser/viewParts/minimap/minimapCharRendererFactory.ts](src/vs/editor/browser/viewParts/minimap/minimapCharRendererFactory.ts)\n- [src/vs/editor/browser/viewParts/minimap/minimapCharSheet.ts](src/vs/editor/browser/viewParts/minimap/minimapCharSheet.ts)\n- [src/vs/editor/browser/viewParts/minimap/minimapPreBaked.ts](src/vs/editor/browser/viewParts/minimap/minimapPreBaked.ts)\n- [src/vs/editor/browser/widget/codeEditor/codeEditorWidget.ts](src/vs/editor/browser/widget/codeEditor/codeEditorWidget.ts)\n- [src/vs/editor/common/config/editorOptions.ts](src/vs/editor/common/config/editorOptions.ts)\n- [src/vs/editor/common/config/fontInfo.ts](src/vs/editor/common/config/fontInfo.ts)\n- [src/vs/editor/common/editorCommon.ts](src/vs/editor/common/editorCommon.ts)\n- [src/vs/editor/common/languages.ts](src/vs/editor/common/languages.ts)\n- [src/vs/editor/common/standalone/standaloneEnums.ts](src/vs/editor/common/standalone/standaloneEnums.ts)\n- [src/vs/editor/common/textModelEvents.ts](src/vs/editor/common/textModelEvents.ts)\n- [src/vs/editor/common/viewModel/minimapTokensColorTracker.ts](src/vs/editor/common/viewModel/minimapTokensColorTracker.ts)\n- [src/vs/editor/test/browser/view/minimapCharRenderer.test.ts](src/vs/editor/test/browser/view/minimapCharRenderer.test.ts)\n- [src/vs/monaco.d.ts](src/vs/monaco.d.ts)\n- [src/vs/platform/extensions/common/extensionsApiProposals.ts](src/vs/platform/extensions/common/extensionsApiProposals.ts)\n- [src/vs/workbench/api/browser/extensionHost.contribution.ts](src/vs/workbench/api/browser/extensionHost.contribution.ts)\n- [src/vs/workbench/api/browser/mainThreadLanguageFeatures.ts](src/vs/workbench/api/browser/mainThreadLanguageFeatures.ts)\n- [src/vs/workbench/api/common/extHost.api.impl.ts](src/vs/workbench/api/common/extHost.api.impl.ts)\n- [src/vs/workbench/api/common/extHost.protocol.ts](src/vs/workbench/api/common/extHost.protocol.ts)\n- [src/vs/workbench/api/common/extHostLanguageFeatures.ts](src/vs/workbench/api/common/extHostLanguageFeatures.ts)\n- [src/vs/workbench/api/common/extHostTypeConverters.ts](src/vs/workbench/api/common/extHostTypeConverters.ts)\n- [src/vs/workbench/api/common/extHostTypes.ts](src/vs/workbench/api/common/extHostTypes.ts)\n- [src/vscode-dts/vscode.d.ts](src/vscode-dts/vscode.d.ts)\n- [src/vscode-dts/vscode.proposed.inlineCompletionsAdditions.d.ts](src/vscode-dts/vscode.proposed.inlineCompletionsAdditions.d.ts)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis document describes VS Code's extension host architecture, which isolates third-party extension code in a separate process from the main workbench UI. It covers the RPC (Remote Procedure Call) protocol that enables communication between the extension host and the main renderer process, the type conversion system for marshalling data across process boundaries, and how the `vscode.*` extension API is implemented on top of this infrastructure.\n\nFor information about how the extension API surface is exposed to extensions, see [Extension API Implementation](#5.2). For details on specific language feature providers, see [Language Features Provider System](#5.3).\n\n## Extension Host Process Isolation\n\nVS Code runs extensions in a dedicated **Extension Host Process**, separate from the main UI (renderer) process. This architectural decision provides several critical benefits:\n\n- **Stability**: Extension crashes do not bring down the entire application\n- **Security**: Extensions have limited access to main process capabilities\n- **Performance**: Heavy extension operations don't block the UI thread\n- **Resource Management**: Extension memory and CPU usage can be monitored and limited\n\nThe extension host process communicates with the main process through an IPC channel, with all communication flowing through a strictly typed RPC protocol.\n\n**Process Architecture Diagram:**\n\n```mermaid\ngraph TB\n    subgraph \"Renderer Process (UI)\"\n        MainThreadServices[\"Main Thread Services\u003cbr/\u003eMainThreadLanguageFeatures\u003cbr/\u003eMainThreadCommands\u003cbr/\u003eMainThreadDocuments\"]\n        RPCServer[\"RPC Protocol Server\u003cbr/\u003eIRPCProtocol\"]\n        CoreServices[\"Core Workbench Services\u003cbr/\u003eILanguageFeaturesService\u003cbr/\u003eIEditorService\"]\n    end\n    \n    subgraph \"Extension Host Process\"\n        ExtHostAPI[\"Extension Host API\u003cbr/\u003ecreateApiFactoryAndRegisterActors\"]\n        ExtHostServices[\"ExtHost Services\u003cbr/\u003eExtHostLanguageFeatures\u003cbr/\u003eExtHostCommands\u003cbr/\u003eExtHostDocuments\"]\n        RPCClient[\"RPC Protocol Client\u003cbr/\u003eIRPCProtocol\"]\n        ExtensionCode[\"Extension Code\u003cbr/\u003eactivate(context)\"]\n    end\n    \n    subgraph \"IPC Boundary\"\n        IPCChannel[\"IPC Channel\u003cbr/\u003eMessage Passing\"]\n    end\n    \n    ExtensionCode --\u003e|\"vscode.* API calls\"| ExtHostAPI\n    ExtHostAPI --\u003e ExtHostServices\n    ExtHostServices --\u003e RPCClient\n    RPCClient \u003c--\u003e|\"Serialized Messages\"| IPCChannel\n    IPCChannel \u003c--\u003e|\"Serialized Messages\"| RPCServer\n    RPCServer --\u003e MainThreadServices\n    MainThreadServices --\u003e CoreServices\n    CoreServices -.-\u003e|\"Events/Responses\"| MainThreadServices\n```\n\nSources: [src/vs/workbench/api/common/extHost.api.impl.ts:132-244](), [src/vs/workbench/api/common/extHost.protocol.ts:117-119]()\n\n## RPC Protocol Definition\n\nThe RPC protocol is defined in `extHost.protocol.ts`, which establishes a type-safe contract between the extension host and main thread. The protocol uses a **bidirectional proxy pattern** where both sides can initiate calls.\n\n### Protocol Structure\n\nThe protocol defines two types of interfaces:\n\n1. **MainThread*Shape**: Interfaces implemented in the renderer process, callable from extension host\n2. **ExtHost*Shape**: Interfaces implemented in the extension host, callable from renderer process\n\nEach interface extends `IDisposable` and declares methods that can be called across the process boundary. Methods are prefixed with `$` to indicate they are RPC-callable.\n\n**Protocol Interface Pattern:**\n\n```mermaid\ngraph LR\n    subgraph \"extHost.protocol.ts\"\n        MainThreadShape[\"MainThread*Shape Interfaces\u003cbr/\u003e$methodName(): Promise\u0026lt;T\u0026gt;\"]\n        ExtHostShape[\"ExtHost*Shape Interfaces\u003cbr/\u003e$methodName(): Promise\u0026lt;T\u0026gt;\"]\n        ProxyIdentifiers[\"ProxyIdentifier\u0026lt;T\u0026gt;\u003cbr/\u003eMainContext.MainThread*\u003cbr/\u003eExtHostContext.ExtHost*\"]\n    end\n    \n    subgraph \"Main Thread\"\n        MainThreadImpl[\"MainThread* Classes\u003cbr/\u003e@extHostNamedCustomer\"]\n    end\n    \n    subgraph \"Extension Host\"\n        ExtHostImpl[\"ExtHost* Classes\u003cbr/\u003erpcProtocol.set()\"]\n    end\n    \n    ProxyIdentifiers --\u003e|\"identifies\"| MainThreadShape\n    ProxyIdentifiers --\u003e|\"identifies\"| ExtHostShape\n    MainThreadImpl -.-\u003e|\"implements\"| MainThreadShape\n    ExtHostImpl -.-\u003e|\"implements\"| ExtHostShape\n```\n\nSources: [src/vs/workbench/api/common/extHost.protocol.ts:120-126](), [src/vs/workbench/api/common/extHost.protocol.ts:498-560]()\n\n### Key Protocol Interfaces\n\nThe protocol defines interfaces for major subsystems:\n\n| Interface | Purpose | Key Methods |\n|-----------|---------|-------------|\n| `MainThreadLanguageFeaturesShape` | Language provider registration | `$registerCodeLensSupport`, `$registerCompletionsProvider` |\n| `MainThreadCommandsShape` | Command execution | `$registerCommand`, `$executeCommand` |\n| `MainThreadDocumentsShape` | Document operations | `$tryOpenDocument`, `$trySaveDocument` |\n| `MainThreadTextEditorsShape` | Editor manipulation | `$tryShowTextDocument`, `$trySetDecorations` |\n| `ExtHostDocumentsShape` | Document events | `$acceptModelChanged`, `$acceptModelSaved` |\n| `ExtHostCommandsShape` | Command registration | `$executeContributedCommand` |\n\nSources: [src/vs/workbench/api/common/extHost.protocol.ts:498-560](), [src/vs/workbench/api/common/extHost.protocol.ts:127-133](), [src/vs/workbench/api/common/extHost.protocol.ts:280-284]()\n\n### Proxy Identifier System\n\nEach interface is associated with a unique `ProxyIdentifier\u003cT\u003e`, which acts as a typed key for routing RPC calls:\n\n```mermaid\ngraph TD\n    ProxyId[\"ProxyIdentifier\u0026lt;MainThreadCommandsShape\u0026gt;\u003cbr/\u003eMainContext.MainThreadCommands\"]\n    \n    subgraph \"Main Thread\"\n        Registry[\"RPC Registry\u003cbr/\u003eMap\u0026lt;ProxyIdentifier, Instance\u0026gt;\"]\n        MainImpl[\"MainThreadCommands Instance\"]\n    end\n    \n    subgraph \"Extension Host\"\n        Proxy[\"Proxy Object\u003cbr/\u003egetProxy(MainContext.MainThreadCommands)\"]\n        ExtCode[\"Extension calls proxy.$executeCommand()\"]\n    end\n    \n    ProxyId --\u003e|\"key\"| Registry\n    Registry --\u003e|\"lookup\"| MainImpl\n    ExtCode --\u003e|\"invoke\"| Proxy\n    Proxy --\u003e|\"serialize call with identifier\"| MainImpl\n```\n\nSources: [src/vs/workbench/api/common/extHost.protocol.ts:32](), [src/vs/workbench/services/extensions/common/proxyIdentifier.ts]()\n\n## Communication Flow\n\n### Request-Response Pattern\n\nRPC calls follow an asynchronous request-response pattern. The calling side serializes method arguments, sends them over IPC, and receives a promise that resolves when the remote side responds.\n\n**Typical Communication Flow:**\n\n```mermaid\nsequenceDiagram\n    participant Ext as Extension Code\n    participant ExtAPI as ExtHost API\n    participant ExtHost as ExtHost Service\n    participant RPC as RPC Protocol\n    participant Main as MainThread Service\n    participant Core as Core Service\n    \n    Ext-\u003e\u003eExtAPI: vscode.commands.executeCommand('id', args)\n    ExtAPI-\u003e\u003eExtHost: extHostCommands.executeCommand()\n    ExtHost-\u003e\u003eRPC: proxy.$executeCommand(id, args)\n    Note over RPC: Serialize args\u003cbr/\u003eSend via IPC\n    RPC-\u003e\u003eMain: mainThreadCommands.$executeCommand()\n    Main-\u003e\u003eCore: commandService.executeCommand()\n    Core--\u003e\u003eMain: result\n    Main--\u003e\u003eRPC: return result\n    Note over RPC: Serialize result\u003cbr/\u003eSend via IPC\n    RPC--\u003e\u003eExtHost: resolve promise\n    ExtHost--\u003e\u003eExtAPI: return result\n    ExtAPI--\u003e\u003eExt: return result\n```\n\nSources: [src/vs/workbench/api/common/extHost.api.impl.ts:379-381](), [src/vs/workbench/api/common/extHost.protocol.ts:131]()\n\n### Bidirectional Communication\n\nThe protocol supports calls in both directions. While extensions primarily call main thread methods, the main thread also calls into the extension host to notify of events or request provider results:\n\n```mermaid\ngraph LR\n    subgraph \"Call Directions\"\n        direction TB\n        A[\"Extension  Main Thread\u003cbr/\u003eAPI calls, commands\"]\n        B[\"Main Thread  Extension Host\u003cbr/\u003eEvents, provider invocation\"]\n    end\n    \n    subgraph \"Example: Document Change\"\n        M1[\"Main: Document edited\"]\n        M2[\"Main: $acceptModelChanged()\"]\n        E1[\"ExtHost: Emit onDidChangeTextDocument\"]\n        E2[\"Extension: Event handler\"]\n    end\n    \n    subgraph \"Example: Language Provider\"\n        E3[\"Extension: registerHoverProvider()\"]\n        E4[\"ExtHost: Register handle\"]\n        M3[\"Main: User hovers\"]\n        M4[\"Main: Call $provideHover()\"]\n        E5[\"ExtHost: Invoke provider\"]\n        E6[\"Extension: Provider function\"]\n    end\n    \n    M1 --\u003e M2 --\u003e E1 --\u003e E2\n    E3 --\u003e E4\n    M3 --\u003e M4 --\u003e E5 --\u003e E6\n```\n\nSources: [src/vs/workbench/api/common/extHostLanguageFeatures.ts:45-105](), [src/vs/workbench/api/browser/mainThreadLanguageFeatures.ts:45-98]()\n\n## Type Conversion and Marshalling\n\nData crossing the process boundary must be serialized and deserialized. The `extHostTypeConverters.ts` module provides conversion functions between the `vscode.*` API types used by extensions and the internal types used by the core workbench.\n\n### Conversion Patterns\n\nType converters follow naming conventions:\n- `from()`: Converts extension API types to internal types (for sending to main thread)\n- `to()`: Converts internal types to extension API types (for sending to extension host)\n\n**Type Conversion Architecture:**\n\n```mermaid\ngraph TB\n    subgraph \"Extension Space\"\n        VSCodeTypes[\"vscode.* Types\u003cbr/\u003ePosition, Range, Location\u003cbr/\u003eDiagnostic, CompletionItem\"]\n    end\n    \n    subgraph \"Type Converters\u003cbr/\u003eextHostTypeConverters.ts\"\n        FromFuncs[\"from() functions\u003cbr/\u003ePosition.from()\u003cbr/\u003eRange.from()\u003cbr/\u003eDiagnostic.from()\"]\n        ToFuncs[\"to() functions\u003cbr/\u003ePosition.to()\u003cbr/\u003eRange.to()\u003cbr/\u003eDiagnostic.to()\"]\n    end\n    \n    subgraph \"Internal Space\"\n        InternalTypes[\"Internal Types\u003cbr/\u003eIPosition, IRange\u003cbr/\u003eILocationDto, IMarkerData\"]\n    end\n    \n    subgraph \"Protocol DTOs\"\n        DTOs[\"Data Transfer Objects\u003cbr/\u003eSerializable representations\"]\n    end\n    \n    VSCodeTypes --\u003e|\"Extension  Main\"| FromFuncs\n    FromFuncs --\u003e InternalTypes\n    InternalTypes --\u003e DTOs\n    \n    DTOs --\u003e InternalTypes\n    InternalTypes --\u003e|\"Main  Extension\"| ToFuncs\n    ToFuncs --\u003e VSCodeTypes\n```\n\nSources: [src/vs/workbench/api/common/extHostTypeConverters.ts:113-141](), [src/vs/workbench/api/common/extHostTypeConverters.ts:169-175]()\n\n### Common Conversions\n\n| Extension Type | Internal Type | Converter |\n|----------------|---------------|-----------|\n| `vscode.Position` | `IPosition` | `Position.from()` / `Position.to()` |\n| `vscode.Range` | `IRange` | `Range.from()` / `Range.to()` |\n| `vscode.Selection` | `ISelection` | `Selection.from()` / `Selection.to()` |\n| `vscode.Location` | `languages.Location` | `Location.from()` / `Location.to()` |\n| `vscode.Diagnostic` | `IMarkerData` | `Diagnostic.from()` / `Diagnostic.to()` |\n| `vscode.CompletionItem` | `languages.CompletionItem` | Complex conversion in adapters |\n\nSources: [src/vs/workbench/api/common/extHostTypeConverters.ts:168-175](), [src/vs/workbench/api/common/extHostTypeConverters.ts:237-270]()\n\n### Serialization Constraints\n\nNot all objects can be directly serialized across the IPC boundary:\n\n- **Simple Types**: Primitives, strings, numbers, booleans pass through directly\n- **Structured Data**: Plain objects and arrays are serialized as JSON\n- **URIs**: `URI` objects are serialized to `UriComponents` and revived on the other side\n- **Complex Objects**: Rich objects (like `TextDocument`) are represented by handles or DTOs\n- **Functions**: Cannot be serialized; must use handle-based callbacks\n\n**Handle-Based Pattern for Complex Objects:**\n\n```mermaid\ngraph LR\n    subgraph \"Extension Host\"\n        ExtObj[\"Provider Object\u003cbr/\u003e{provideHover: fn}\"]\n        Cache[\"Cache\u0026lt;handle  object\u0026gt;\"]\n        ExtHost[\"ExtHost Service\"]\n    end\n    \n    subgraph \"Main Thread\"\n        Main[\"MainThread Service\"]\n        HandleRef[\"Handle Reference\u003cbr/\u003ehandle: number\"]\n    end\n    \n    ExtObj --\u003e|\"register\"| Cache\n    Cache --\u003e|\"generate handle\"| ExtHost\n    ExtHost --\u003e|\"send handle via RPC\"| Main\n    Main --\u003e|\"store\"| HandleRef\n    \n    HandleRef -.-\u003e|\"later: $provideHover(handle)\"| ExtHost\n    ExtHost -.-\u003e|\"lookup in cache\"| Cache\n    Cache -.-\u003e|\"invoke\"| ExtObj\n```\n\nSources: [src/vs/workbench/api/common/extHostLanguageFeatures.ts:107-193](), [src/vs/workbench/api/common/cache.ts]()\n\n## API Implementation\n\nThe `vscode.*` API exposed to extensions is implemented as a facade over the RPC protocol. The `createApiFactoryAndRegisterActors` function in `extHost.api.impl.ts` is the entry point for creating the extension API surface.\n\n### API Factory Pattern\n\nEach extension receives its own API object when it activates. The factory function creates namespaces like `vscode.commands`, `vscode.window`, `vscode.languages` that wrap underlying ExtHost services:\n\n```mermaid\ngraph TB\n    subgraph \"Extension Activation\"\n        ExtActivate[\"extension.activate(context)\"]\n        APIObject[\"vscode API object\"]\n    end\n    \n    subgraph \"API Factory\u003cbr/\u003ecreateApiFactoryAndRegisterActors\"\n        Factory[\"API Factory Function\"]\n        Namespaces[\"API Namespaces\u003cbr/\u003ecommands, window, languages, etc.\"]\n    end\n    \n    subgraph \"ExtHost Services\"\n        ExtHostCmds[\"ExtHostCommands\"]\n        ExtHostDocs[\"ExtHostDocuments\"]\n        ExtHostLang[\"ExtHostLanguageFeatures\"]\n        ExtHostTerminal[\"ExtHostTerminalService\"]\n    end\n    \n    subgraph \"RPC Layer\"\n        RPCProxy[\"RPC Proxy\u003cbr/\u003egetProxy(MainContext.*)\"]\n    end\n    \n    ExtActivate --\u003e|\"receives\"| APIObject\n    Factory --\u003e|\"creates\"| APIObject\n    Factory --\u003e Namespaces\n    \n    Namespaces --\u003e|\"commands namespace\"| ExtHostCmds\n    Namespaces --\u003e|\"workspace namespace\"| ExtHostDocs\n    Namespaces --\u003e|\"languages namespace\"| ExtHostLang\n    Namespaces --\u003e|\"window.createTerminal\"| ExtHostTerminal\n    \n    ExtHostCmds --\u003e RPCProxy\n    ExtHostDocs --\u003e RPCProxy\n    ExtHostLang --\u003e RPCProxy\n    ExtHostTerminal --\u003e RPCProxy\n```\n\nSources: [src/vs/workbench/api/common/extHost.api.impl.ts:132-255](), [src/vs/workbench/api/common/extHost.api.impl.ts:342-385]()\n\n### Example: Commands Namespace\n\nThe `vscode.commands` namespace demonstrates the pattern:\n\n1. **API Surface**: Extension calls `vscode.commands.executeCommand(id, ...args)`\n2. **ExtHost Service**: Call routes to `ExtHostCommands.executeCommand()`\n3. **RPC Call**: ExtHostCommands calls `proxy.$executeCommand(id, args)`\n4. **Main Thread**: `MainThreadCommands.$executeCommand()` receives the call\n5. **Core Service**: Delegates to `ICommandService.executeCommand()`\n\n```mermaid\nsequenceDiagram\n    participant Ext as Extension\n    participant API as vscode.commands\n    participant ExtHost as ExtHostCommands\n    participant Proxy as RPC Proxy\n    participant Main as MainThreadCommands\n    participant Core as ICommandService\n    \n    Ext-\u003e\u003eAPI: executeCommand('workbench.action.files.save')\n    API-\u003e\u003eExtHost: executeCommand(id, args)\n    ExtHost-\u003e\u003eProxy: $executeCommand(id, args, retry)\n    Note over Proxy: Serialize \u0026 send via IPC\n    Proxy-\u003e\u003eMain: $executeCommand(id, args, retry)\n    Main-\u003e\u003eCore: executeCommand(id, args)\n    Core--\u003e\u003eMain: result\n    Main--\u003e\u003eProxy: return result\n    Note over Proxy: Deserialize \u0026 send via IPC\n    Proxy--\u003e\u003eExtHost: Promise\u0026lt;result\u0026gt;\n    ExtHost--\u003e\u003eAPI: result\n    API--\u003e\u003eExt: result\n```\n\nSources: [src/vs/workbench/api/common/extHost.api.impl.ts:379-381](), [src/vs/workbench/api/common/extHostCommands.ts](), [src/vs/workbench/api/browser/mainThreadCommands.ts]()\n\n## Key Components\n\n### ExtHost Services\n\nEach ExtHost service manages a specific domain of functionality and maintains extension-side state:\n\n| Service | Responsibility | Protocol Interface |\n|---------|---------------|-------------------|\n| `ExtHostCommands` | Command registration and execution | `ExtHostCommandsShape` |\n| `ExtHostDocuments` | Document model synchronization | `ExtHostDocumentsShape` |\n| `ExtHostLanguageFeatures` | Language provider registration | `ExtHostLanguageFeaturesShape` |\n| `ExtHostTerminalService` | Terminal creation and management | `ExtHostTerminalServiceShape` |\n| `ExtHostDiagnostics` | Diagnostic collection management | `ExtHostDiagnosticsShape` |\n| `ExtHostTreeViews` | Tree view provider registration | `ExtHostTreeViewsShape` |\n\nEach service is registered with the RPC protocol during initialization:\n\n```mermaid\ngraph TD\n    subgraph \"RPC Registration\u003cbr/\u003eextHost.api.impl.ts\"\n        Register[\"rpcProtocol.set(ExtHostContext.*, instance)\"]\n    end\n    \n    subgraph \"Service Instances\"\n        ExtHostCmds[\"ExtHostCommands\"]\n        ExtHostDocs[\"ExtHostDocuments\"]\n        ExtHostLang[\"ExtHostLanguageFeatures\"]\n    end\n    \n    subgraph \"Protocol Identifiers\"\n        Id1[\"ExtHostContext.ExtHostCommands\"]\n        Id2[\"ExtHostContext.ExtHostDocuments\"]\n        Id3[\"ExtHostContext.ExtHostLanguageFeatures\"]\n    end\n    \n    ExtHostCmds --\u003e|\"register\"| Register\n    ExtHostDocs --\u003e|\"register\"| Register\n    ExtHostLang --\u003e|\"register\"| Register\n    \n    Register -.-\u003e|\"associates with\"| Id1\n    Register -.-\u003e|\"associates with\"| Id2\n    Register -.-\u003e|\"associates with\"| Id3\n```\n\nSources: [src/vs/workbench/api/common/extHost.api.impl.ts:184-244]()\n\n### MainThread Services\n\nMainThread services implement the main process side of the protocol and typically delegate to core workbench services:\n\n**MainThread Service Pattern:**\n\n```mermaid\ngraph LR\n    subgraph \"MainThread Service\"\n        Decorator[\"@extHostNamedCustomer\u003cbr/\u003e(MainContext.MainThread*)\"]\n        Service[\"MainThread* Class\u003cbr/\u003eimplements MainThread*Shape\"]\n        Dispose[\"Disposable registration map\"]\n    end\n    \n    subgraph \"Core Services\"\n        LangFeatures[\"ILanguageFeaturesService\"]\n        EditorService[\"IEditorService\"]\n        CmdService[\"ICommandService\"]\n    end\n    \n    subgraph \"Registration\"\n        Registry[\"Global customer registry\"]\n    end\n    \n    Decorator --\u003e Registry\n    Service --\u003e|\"delegates to\"| LangFeatures\n    Service --\u003e|\"delegates to\"| EditorService\n    Service --\u003e|\"delegates to\"| CmdService\n    Service --\u003e Dispose\n```\n\nSources: [src/vs/workbench/api/browser/mainThreadLanguageFeatures.ts:45-98](), [src/vs/workbench/services/extensions/common/extHostCustomers.ts]()\n\n### Language Features Example\n\nLanguage features (hover, completion, diagnostics, etc.) demonstrate the full RPC pattern:\n\n**Provider Registration Flow:**\n\n```mermaid\nsequenceDiagram\n    participant Ext as Extension\n    participant API as vscode.languages\n    participant ExtLang as ExtHostLanguageFeatures\n    participant Adapter as Provider Adapter\n    participant Proxy as RPC Proxy\n    participant Main as MainThreadLanguageFeatures\n    participant LangSvc as ILanguageFeaturesService\n    \n    Ext-\u003e\u003eAPI: registerHoverProvider(selector, provider)\n    API-\u003e\u003eExtLang: registerHoverProvider()\n    ExtLang-\u003e\u003eAdapter: Create HoverAdapter(provider)\n    ExtLang-\u003e\u003eExtLang: Generate handle\n    ExtLang-\u003e\u003eProxy: $registerHoverProvider(handle, selector)\n    Proxy-\u003e\u003eMain: $registerHoverProvider(handle, selector)\n    Main-\u003e\u003eLangSvc: registerHoverProvider(selector, ...)\n    Main--\u003e\u003eProxy: Registration disposable\n    Proxy--\u003e\u003eExtLang: Success\n    ExtLang--\u003e\u003eAPI: Disposable\n    API--\u003e\u003eExt: Disposable\n    \n    Note over Ext,LangSvc: Later, when hover is requested...\n    \n    LangSvc-\u003e\u003eMain: provideHover(model, position)\n    Main-\u003e\u003eProxy: $provideHover(handle, resource, position)\n    Proxy-\u003e\u003eExtLang: $provideHover()\n    ExtLang-\u003e\u003eAdapter: provideHover()\n    Adapter-\u003e\u003eExt: Call provider.provideHover()\n    Ext--\u003e\u003eAdapter: Hover result\n    Adapter--\u003e\u003eExtLang: Converted hover\n    ExtLang--\u003e\u003eProxy: Hover DTO\n    Proxy--\u003e\u003eMain: Hover DTO\n    Main--\u003e\u003eLangSvc: Hover result\n```\n\nSources: [src/vs/workbench/api/common/extHostLanguageFeatures.ts:2565-2611](), [src/vs/workbench/api/browser/mainThreadLanguageFeatures.ts:276-328]()\n\n## Protocol Message Format\n\nWhile the RPC protocol abstracts away the low-level message format, understanding the structure helps debug communication issues:\n\n### Message Structure\n\nRPC calls are serialized as structured messages containing:\n\n- **Type**: Request, response, or notification\n- **Request ID**: Unique identifier for matching responses to requests\n- **Method**: The protocol method being invoked (`$methodName`)\n- **Arguments**: Serialized method parameters\n- **Proxy ID**: Identifier of the target service\n\n**Message Flow:**\n\n```mermaid\ngraph LR\n    subgraph \"Extension Host\"\n        Call[\"Method Call\"]\n        Serialize[\"Serialize Arguments\"]\n        SendMsg[\"Send Message\"]\n    end\n    \n    subgraph \"Message\"\n        Msg[\"{ type: 'request',\u003cbr/\u003ereqId: 123,\u003cbr/\u003eproxyId: 'MainThreadCommands',\u003cbr/\u003emethod: '$executeCommand',\u003cbr/\u003eargs: [...] }\"]\n    end\n    \n    subgraph \"IPC Channel\"\n        IPC[\"postMessage()\"]\n    end\n    \n    subgraph \"Main Thread\"\n        ReceiveMsg[\"Receive Message\"]\n        Deserialize[\"Deserialize Arguments\"]\n        Dispatch[\"Dispatch to Service\"]\n        Response[\"Generate Response\"]\n    end\n    \n    Call --\u003e Serialize --\u003e SendMsg\n    SendMsg --\u003e Msg\n    Msg --\u003e IPC\n    IPC --\u003e ReceiveMsg\n    ReceiveMsg --\u003e Deserialize --\u003e Dispatch\n    Dispatch --\u003e Response\n    Response -.-\u003e|\"Response message\"| IPC\n```\n\nSources: [src/vs/workbench/services/extensions/common/proxyIdentifier.ts](), [src/vs/workbench/services/extensions/common/rpcProtocol.ts]()\n\n### Special Handling\n\nCertain types require special handling during serialization:\n\n- **URIs**: Converted to `UriComponents` and revived using `URI.revive()`\n- **Buffers**: Large data uses `VSBuffer` for efficient transfer\n- **SerializableObjectWithBuffers**: Allows mixing JSON-serializable data with binary buffers\n- **Revive Functions**: Nested objects with URIs use custom revivers\n\nSources: [src/vs/base/common/uri.ts](), [src/vs/workbench/services/extensions/common/proxyIdentifier.ts]()\n\n## Performance Considerations\n\n### Minimizing Round-Trips\n\nEach RPC call incurs IPC overhead. Best practices:\n\n- **Batch Operations**: Combine multiple operations into single calls\n- **Cache Data**: Store frequently accessed data in the extension host\n- **Use Events**: Prefer event notifications over polling\n- **Lazy Loading**: Defer provider registration until needed\n\n### Handle Management\n\nProviders and complex objects use handle-based references to avoid sending large objects over IPC. The cache system maintains handle-to-object mappings:\n\n```mermaid\ngraph TB\n    subgraph \"Extension Host Cache\"\n        HandleGen[\"Handle Generator\u003cbr/\u003eincrementing counter\"]\n        Cache[\"Map\u0026lt;handle, object\u0026gt;\"]\n    end\n    \n    subgraph \"Lifecycle\"\n        Register[\"Provider registered\"]\n        Store[\"Store with handle\"]\n        Invoke[\"Main thread invokes\"]\n        Lookup[\"Look up by handle\"]\n        Dispose[\"Provider disposed\"]\n        Remove[\"Remove from cache\"]\n    end\n    \n    Register --\u003e HandleGen\n    HandleGen --\u003e Store\n    Store --\u003e Cache\n    Invoke --\u003e Lookup\n    Lookup --\u003e Cache\n    Dispose --\u003e Remove\n    Remove --\u003e Cache\n```\n\nSources: [src/vs/workbench/api/common/cache.ts](), [src/vs/workbench/api/common/extHostLanguageFeatures.ts:107-130]()\n\n## Error Handling\n\n### Remote Errors\n\nErrors thrown in remote method calls are serialized and re-thrown on the calling side:\n\n- **SerializedError**: Errors are converted to a serializable format\n- **Stack Preservation**: Stack traces are preserved where possible\n- **Cancellation**: `CancellationToken` cancellation propagates across the boundary\n\n### Disposed Providers\n\nIf a provider is disposed while an invocation is in progress:\n\n1. Main thread calls `$provideXYZ(handle, ...)`\n2. Extension host looks up handle in cache\n3. If not found (already disposed), returns `undefined`\n4. Main thread gracefully handles missing result\n\nSources: [src/vs/workbench/api/common/extHostLanguageFeatures.ts:150-186](), [src/vs/base/common/errors.ts]()\n\n## Summary\n\nThe Extension Host Architecture provides a robust foundation for VS Code's extensibility through:\n\n- **Process Isolation**: Extensions run in a separate process for stability and security\n- **Type-Safe RPC**: The protocol uses TypeScript interfaces to define contracts\n- **Bidirectional Communication**: Both extension host and main thread can initiate calls\n- **Handle-Based References**: Complex objects avoid serialization overhead\n- **Type Conversion**: Seamless marshalling between extension API types and internal types\n- **Graceful Degradation**: Errors and disposed objects are handled gracefully\n\nThis architecture enables VS Code to support thousands of extensions while maintaining stability and performance.\n\nSources: [src/vs/workbench/api/common/extHost.protocol.ts:1-103](), [src/vs/workbench/api/common/extHost.api.impl.ts:132-255](), [src/vs/workbench/api/common/extHostTypeConverters.ts:72-175]()"])</script><script>self.__next_f.push([1,"2d:T6fa8,"])</script><script>self.__next_f.push([1,"# Extension API Implementation\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [extensions/vscode-api-tests/package.json](extensions/vscode-api-tests/package.json)\n- [extensions/vscode-api-tests/src/singlefolder-tests/chat.test.ts](extensions/vscode-api-tests/src/singlefolder-tests/chat.test.ts)\n- [src/vs/editor/browser/config/charWidthReader.ts](src/vs/editor/browser/config/charWidthReader.ts)\n- [src/vs/editor/browser/editorBrowser.ts](src/vs/editor/browser/editorBrowser.ts)\n- [src/vs/editor/browser/viewParts/minimap/minimap.ts](src/vs/editor/browser/viewParts/minimap/minimap.ts)\n- [src/vs/editor/browser/viewParts/minimap/minimapCharRenderer.ts](src/vs/editor/browser/viewParts/minimap/minimapCharRenderer.ts)\n- [src/vs/editor/browser/viewParts/minimap/minimapCharRendererFactory.ts](src/vs/editor/browser/viewParts/minimap/minimapCharRendererFactory.ts)\n- [src/vs/editor/browser/viewParts/minimap/minimapCharSheet.ts](src/vs/editor/browser/viewParts/minimap/minimapCharSheet.ts)\n- [src/vs/editor/browser/viewParts/minimap/minimapPreBaked.ts](src/vs/editor/browser/viewParts/minimap/minimapPreBaked.ts)\n- [src/vs/editor/browser/widget/codeEditor/codeEditorWidget.ts](src/vs/editor/browser/widget/codeEditor/codeEditorWidget.ts)\n- [src/vs/editor/common/config/editorOptions.ts](src/vs/editor/common/config/editorOptions.ts)\n- [src/vs/editor/common/config/fontInfo.ts](src/vs/editor/common/config/fontInfo.ts)\n- [src/vs/editor/common/editorCommon.ts](src/vs/editor/common/editorCommon.ts)\n- [src/vs/editor/common/languages.ts](src/vs/editor/common/languages.ts)\n- [src/vs/editor/common/standalone/standaloneEnums.ts](src/vs/editor/common/standalone/standaloneEnums.ts)\n- [src/vs/editor/common/textModelEvents.ts](src/vs/editor/common/textModelEvents.ts)\n- [src/vs/editor/common/viewModel/minimapTokensColorTracker.ts](src/vs/editor/common/viewModel/minimapTokensColorTracker.ts)\n- [src/vs/editor/test/browser/view/minimapCharRenderer.test.ts](src/vs/editor/test/browser/view/minimapCharRenderer.test.ts)\n- [src/vs/monaco.d.ts](src/vs/monaco.d.ts)\n- [src/vs/platform/extensions/common/extensionsApiProposals.ts](src/vs/platform/extensions/common/extensionsApiProposals.ts)\n- [src/vs/workbench/api/browser/extensionHost.contribution.ts](src/vs/workbench/api/browser/extensionHost.contribution.ts)\n- [src/vs/workbench/api/browser/mainThreadLanguageFeatures.ts](src/vs/workbench/api/browser/mainThreadLanguageFeatures.ts)\n- [src/vs/workbench/api/common/extHost.api.impl.ts](src/vs/workbench/api/common/extHost.api.impl.ts)\n- [src/vs/workbench/api/common/extHost.protocol.ts](src/vs/workbench/api/common/extHost.protocol.ts)\n- [src/vs/workbench/api/common/extHostLanguageFeatures.ts](src/vs/workbench/api/common/extHostLanguageFeatures.ts)\n- [src/vs/workbench/api/common/extHostTypeConverters.ts](src/vs/workbench/api/common/extHostTypeConverters.ts)\n- [src/vs/workbench/api/common/extHostTypes.ts](src/vs/workbench/api/common/extHostTypes.ts)\n- [src/vscode-dts/vscode.d.ts](src/vscode-dts/vscode.d.ts)\n- [src/vscode-dts/vscode.proposed.inlineCompletionsAdditions.d.ts](src/vscode-dts/vscode.proposed.inlineCompletionsAdditions.d.ts)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis document explains how the `vscode.*` API is implemented and exposed to extensions. It covers the API factory pattern, type conversion system, and how ExtHost services provide the backing implementation for API namespaces. For information about the RPC protocol and extension host architecture, see [Extension Host Architecture and RPC Protocol](#5.1). For language provider specifics, see [Language Features Provider System](#5.3).\n\n---\n\n## API Factory Architecture\n\n### The createApiFactoryAndRegisterActors Function\n\nThe extension API is created by `createApiFactoryAndRegisterActors` in [src/vs/workbench/api/common/extHost.api.impl.ts:132](), which:\n\n1. **Registers ExtHost services with the RPC protocol** - Makes them addressable by the main thread\n2. **Creates ExtHost service instances** - Instantiates services that implement API functionality\n3. **Returns an API factory function** - Produces a unique `vscode.*` API object for each extension\n\n```mermaid\ngraph TD\n    Accessor[\"ServicesAccessor\u003cbr/\u003e(DI Container)\"]\n    CreateFactory[\"createApiFactoryAndRegisterActors()\"]\n    \n    Accessor --\u003e CreateFactory\n    \n    CreateFactory --\u003e RegisterServices[\"Register ExtHost Services\u003cbr/\u003ewith RPC Protocol\"]\n    CreateFactory --\u003e InstantiateServices[\"Instantiate ExtHost Services\u003cbr/\u003e(Commands, Documents, etc.)\"]\n    CreateFactory --\u003e ReturnFactory[\"Return API Factory Function\"]\n    \n    RegisterServices --\u003e RPCProtocol[\"rpcProtocol.set(ExtHostContext.*)\"]\n    \n    InstantiateServices --\u003e ExtHostDocs[\"ExtHostDocuments\"]\n    InstantiateServices --\u003e ExtHostCmds[\"ExtHostCommands\"]\n    InstantiateServices --\u003e ExtHostLang[\"ExtHostLanguageFeatures\"]\n    InstantiateServices --\u003e ExtHostTerms[\"ExtHostTerminalService\"]\n    \n    ReturnFactory --\u003e FactoryFn[\"(extension, registries, config)\u003cbr/\u003e=\u003e vscode API object\"]\n    \n    FactoryFn --\u003e PerExtAPI[\"Per-Extension\u003cbr/\u003evscode.* API\"]\n```\n\n**Diagram: API Factory Creation Process**\n\nSources: [src/vs/workbench/api/common/extHost.api.impl.ts:132-244]()\n\n### Per-Extension API Instances\n\nEach extension receives its own `vscode.*` API instance created by the factory function. This allows:\n\n- **Extension identity tracking** - API calls are attributed to specific extensions for telemetry and security\n- **Proposed API access control** - Different extensions can access different proposed APIs\n- **Error isolation** - Extension-specific error handling and reporting\n- **Event wrapping** - Events are wrapped with extension-specific error boundaries\n\nThe factory function signature:\n\n```typescript\nfunction(extension: IExtensionDescription, \n         extensionInfo: IExtensionRegistries, \n         configProvider: ExtHostConfigProvider): typeof vscode\n```\n\nSources: [src/vs/workbench/api/common/extHost.api.impl.ts:256]()\n\n---\n\n## ExtHost Services Registration\n\n### RPC Protocol Registration\n\nExtHost services are registered with the RPC protocol to make them callable from the main thread:\n\n| ExtHost Service | Registration ID | Purpose |\n|----------------|----------------|---------|\n| `ExtHostWorkspace` | `ExtHostContext.ExtHostWorkspace` | Workspace folders, file operations |\n| `ExtHostConfiguration` | `ExtHostContext.ExtHostConfiguration` | Configuration settings |\n| `ExtHostCommands` | `ExtHostContext.ExtHostCommands` | Command registration and execution |\n| `ExtHostDocuments` | `ExtHostContext.ExtHostDocuments` | Text document management |\n| `ExtHostLanguageFeatures` | `ExtHostContext.ExtHostLanguageFeatures` | Language providers (completion, hover, etc.) |\n| `ExtHostTerminalService` | `ExtHostContext.ExtHostTerminalService` | Terminal creation and control |\n| `ExtHostDebugService` | `ExtHostContext.ExtHostDebugService` | Debug sessions and configurations |\n| `ExtHostAuthentication` | `ExtHostContext.ExtHostAuthentication` | Authentication providers |\n\n```mermaid\ngraph LR\n    subgraph \"Extension Host Process\"\n        ExtHostSvc[\"ExtHost Service\u003cbr/\u003e(e.g., ExtHostDocuments)\"]\n        RPCProto[\"RPC Protocol\"]\n        \n        ExtHostSvc --\u003e RPCProto\n    end\n    \n    subgraph \"Main Thread Process\"\n        MainProxy[\"Main Thread Proxy\u003cbr/\u003e(e.g., MainThreadDocuments)\"]\n        CoreService[\"Core Service\u003cbr/\u003e(e.g., ITextModelService)\"]\n        \n        MainProxy --\u003e CoreService\n    end\n    \n    RPCProto \u003c--\u003e|\"IPC Messages\"| MainProxy\n    \n    ExtHostSvc --\u003e|\"rpcProtocol.set()\"| RPCProto\n```\n\n**Diagram: ExtHost Service Registration and Communication**\n\nSources: [src/vs/workbench/api/common/extHost.api.impl.ts:162-191]()\n\n### Key ExtHost Service Instances\n\nThe factory creates these core service instances:\n\n**Document Management:**\n- `ExtHostDocuments` - Tracks open text documents [src/vs/workbench/api/common/extHost.api.impl.ts:194]()\n- `ExtHostDocumentContentProviders` - Virtual document providers [src/vs/workbench/api/common/extHost.api.impl.ts:195]()\n- `ExtHostDocumentSaveParticipant` - Pre-save document handlers [src/vs/workbench/api/common/extHost.api.impl.ts:196]()\n\n**Editor Management:**\n- `ExtHostEditors` - Active editor instances [src/vs/workbench/api/common/extHost.api.impl.ts:203]()\n- `ExtHostDocumentsAndEditors` - Combined document/editor tracking [src/vs/workbench/api/common/extHost.api.impl.ts:183]()\n\n**Language Features:**\n- `ExtHostLanguageFeatures` - Providers for completion, hover, etc. [src/vs/workbench/api/common/extHost.api.impl.ts:208]()\n- `ExtHostLanguages` - Language configuration [src/vs/workbench/api/common/extHost.api.impl.ts:207]()\n- `ExtHostDiagnostics` - Diagnostic collections [src/vs/workbench/api/common/extHost.api.impl.ts:206]()\n\n**Terminal \u0026 Debug:**\n- `ExtHostTerminalService` - Terminal management [src/vs/workbench/api/common/extHost.api.impl.ts:185]()\n- `ExtHostDebugService` - Debug sessions [src/vs/workbench/api/common/extHost.api.impl.ts:187]()\n\n**UI Contributions:**\n- `ExtHostTreeViews` - Tree view providers [src/vs/workbench/api/common/extHost.api.impl.ts:204]()\n- `ExtHostWebviews` - Webview management [src/vs/workbench/api/common/extHost.api.impl.ts:220]()\n- `ExtHostStatusBar` - Status bar items [src/vs/workbench/api/common/extHost.api.impl.ts:236]()\n\nSources: [src/vs/workbench/api/common/extHost.api.impl.ts:194-238]()\n\n---\n\n## API Namespace Implementation\n\n### Commands Namespace\n\nThe `vscode.commands` namespace provides command registration and execution:\n\n```mermaid\ngraph TD\n    API[\"vscode.commands API\"]\n    \n    API --\u003e RegCmd[\"registerCommand(id, handler)\"]\n    API --\u003e ExecCmd[\"executeCommand(id, ...args)\"]\n    API --\u003e GetCmds[\"getCommands(filterInternal?)\"]\n    \n    RegCmd --\u003e ExtHostCmds[\"extHostCommands.registerCommand()\"]\n    ExecCmd --\u003e ExtHostCmds\n    GetCmds --\u003e ExtHostCmds\n    \n    ExtHostCmds --\u003e MainProxy[\"MainThreadCommands\u003cbr/\u003e(via RPC)\"]\n    MainProxy --\u003e CmdService[\"ICommandService\"]\n```\n\n**Diagram: Commands Namespace Implementation**\n\nImplementation details:\n- `registerCommand` - Registers command handler, tracks extension identity [src/vs/workbench/api/common/extHost.api.impl.ts:343-344]()\n- `registerTextEditorCommand` - Specialized for text editor commands [src/vs/workbench/api/common/extHost.api.impl.ts:346]()\n- `executeCommand` - Executes any registered command [src/vs/workbench/api/common/extHost.api.impl.ts:379-380]()\n- `getCommands` - Lists available commands [src/vs/workbench/api/common/extHost.api.impl.ts:382-384]()\n\nSources: [src/vs/workbench/api/common/extHost.api.impl.ts:342-385]()\n\n### Env Namespace\n\nThe `vscode.env` namespace exposes environment information:\n\n| Property/Method | Implementation | Description |\n|----------------|----------------|-------------|\n| `machineId` | `initData.telemetryInfo.machineId` | Machine identifier |\n| `sessionId` | `initData.telemetryInfo.sessionId` | Session identifier |\n| `language` | `initData.environment.appLanguage` | Application language |\n| `appName` | `initData.environment.appName` | Application name |\n| `uriScheme` | `initData.environment.appUriScheme` | URI scheme |\n| `clipboard` | `extHostClipboard.value` | Clipboard access |\n| `shell` | `extHostTerminalService.getDefaultShell()` | Default shell path |\n| `openExternal()` | `extHostWindow.openUri()` | Open external URIs |\n| `asExternalUri()` | `extHostWindow.asExternalUri()` | Convert to external URI |\n\nSources: [src/vs/workbench/api/common/extHost.api.impl.ts:388-477]()\n\n### Authentication Namespace\n\nThe `vscode.authentication` namespace manages authentication providers:\n\n```mermaid\ngraph TD\n    AuthAPI[\"vscode.authentication\"]\n    \n    AuthAPI --\u003e GetSession[\"getSession(providerId, scopes, options)\"]\n    AuthAPI --\u003e GetAccounts[\"getAccounts(providerId)\"]\n    AuthAPI --\u003e OnChange[\"onDidChangeSessions event\"]\n    AuthAPI --\u003e Register[\"registerAuthenticationProvider()\"]\n    \n    GetSession --\u003e ExtHostAuth[\"extHostAuthentication\"]\n    GetAccounts --\u003e ExtHostAuth\n    OnChange --\u003e ExtHostAuth\n    Register --\u003e ExtHostAuth\n    \n    ExtHostAuth --\u003e MainAuth[\"MainThreadAuthentication\"]\n    MainAuth --\u003e AuthService[\"IAuthenticationService\"]\n```\n\n**Diagram: Authentication Namespace Flow**\n\nKey features:\n- Extension-scoped session events using `getExtensionScopedSessionsEvent()` [src/vs/workbench/api/common/extHost.api.impl.ts:331]()\n- Proposed API checks for advanced features (learnMore, authorizationServer) [src/vs/workbench/api/common/extHost.api.impl.ts:313-316]()\n- Provider registration with options [src/vs/workbench/api/common/extHost.api.impl.ts:333-338]()\n\nSources: [src/vs/workbench/api/common/extHost.api.impl.ts:307-339]()\n\n### Languages Namespace\n\nThe `vscode.languages` namespace provides language feature registration. The implementation delegates to `ExtHostLanguageFeatures`:\n\n**Provider Registration Methods:**\n- `registerCompletionItemProvider` - Code completion\n- `registerHoverProvider` - Hover information\n- `registerDefinitionProvider` - Go to definition\n- `registerCodeActionsProvider` - Code actions/quick fixes\n- `registerDocumentFormattingEditProvider` - Document formatting\n- `registerRenameProvider` - Symbol renaming\n- And many more...\n\nEach registration method:\n1. Validates the document selector using `checkSelector()` [src/vs/workbench/api/common/extHost.api.impl.ts:281-305]()\n2. Calls the corresponding `ExtHostLanguageFeatures.register*()` method\n3. Returns a `Disposable` to unregister the provider\n\nSources: [src/vs/workbench/api/common/extHost.api.impl.ts:1114-1644]()\n\n### Workspace Namespace\n\nThe `vscode.workspace` namespace provides workspace operations:\n\n```mermaid\ngraph TD\n    WsAPI[\"vscode.workspace\"]\n    \n    WsAPI --\u003e Props[\"Properties\u003cbr/\u003eworkspaceFolders, name, textDocuments\"]\n    WsAPI --\u003e FileOps[\"File Operations\u003cbr/\u003eopenTextDocument, save, createFileSystemWatcher\"]\n    WsAPI --\u003e Config[\"Configuration\u003cbr/\u003egetConfiguration, onDidChangeConfiguration\"]\n    WsAPI --\u003e Search[\"Search\u003cbr/\u003efindFiles, findTextInFiles\"]\n    \n    Props --\u003e ExtHostWs[\"extHostWorkspace\"]\n    FileOps --\u003e ExtHostDocs[\"extHostDocuments\"]\n    Config --\u003e ExtHostConfig[\"extHostConfiguration\"]\n    Search --\u003e ExtHostSearch[\"extHostSearch\"]\n```\n\n**Diagram: Workspace Namespace Components**\n\nSources: [src/vs/workbench/api/common/extHost.api.impl.ts:1645-1908]()\n\n### Window Namespace\n\nThe `vscode.window` namespace manages UI elements:\n\n**UI Components:**\n- `activeTextEditor` / `visibleTextEditors` - Editor access\n- `showInformationMessage()` / `showWarningMessage()` / `showErrorMessage()` - Message boxes\n- `showQuickPick()` / `showInputBox()` - Quick pick and input UI\n- `createStatusBarItem()` - Status bar items\n- `createOutputChannel()` - Output channels\n- `createTerminal()` - Terminal instances\n- `createWebviewPanel()` - Webview panels\n- `createTreeView()` - Tree views\n\nSources: [src/vs/workbench/api/common/extHost.api.impl.ts:1909-2291]()\n\n---\n\n## Type Conversion System\n\n### Conversion Architecture\n\nType converters bridge the gap between extension API types (defined in `extHostTypes.ts`) and internal VS Code types:\n\n```mermaid\ngraph LR\n    subgraph \"Extension Process\"\n        ExtTypes[\"Extension Types\u003cbr/\u003evscode.Position\u003cbr/\u003evscode.Range\u003cbr/\u003evscode.Location\"]\n    end\n    \n    subgraph \"Type Converters\"\n        ToInternal[\"to Internal\u003cbr/\u003ePosition.from()\u003cbr/\u003eRange.from()\u003cbr/\u003eLocation.from()\"]\n        FromInternal[\"from Internal\u003cbr/\u003ePosition.to()\u003cbr/\u003eRange.to()\u003cbr/\u003eLocation.to()\"]\n    end\n    \n    subgraph \"Internal Types\"\n        Internal[\"Internal Types\u003cbr/\u003eIPosition\u003cbr/\u003eIRange\u003cbr/\u003elanguages.Location\"]\n    end\n    \n    ExtTypes --\u003e|\"Conversion\"| ToInternal\n    ToInternal --\u003e Internal\n    \n    Internal --\u003e|\"Conversion\"| FromInternal\n    FromInternal --\u003e ExtTypes\n```\n\n**Diagram: Type Conversion Bidirectional Flow**\n\nSources: [src/vs/workbench/api/common/extHostTypeConverters.ts:1-70]()\n\n### Core Type Converters\n\n#### Position and Range Conversion\n\nThe `Position` and `Range` converters handle coordinate transformations:\n\n**Position Conversion:**\n- Extension uses 0-based line/character: `vscode.Position(line, character)`\n- Internal uses 1-based lineNumber/column: `{ lineNumber, column }`\n- `Position.to()` converts internal  extension (subtract 1) [src/vs/workbench/api/common/extHostTypeConverters.ts:169-171]()\n- `Position.from()` converts extension  internal (add 1) [src/vs/workbench/api/common/extHostTypeConverters.ts:172-174]()\n\n**Range Conversion:**\n- `Range.from()` converts extension range to internal [src/vs/workbench/api/common/extHostTypeConverters.ts:118-129]()\n- `Range.to()` converts internal range to extension [src/vs/workbench/api/common/extHostTypeConverters.ts:134-140]()\n\nSources: [src/vs/workbench/api/common/extHostTypeConverters.ts:113-175]()\n\n#### Selection Conversion\n\nSelection extends Range with anchor/active positions:\n\n```typescript\n// Extension  Internal\nSelection.from(selection: SelectionLike): ISelection\n// Creates { selectionStartLineNumber, selectionStartColumn, \n//           positionLineNumber, positionColumn }\n\n// Internal  Extension  \nSelection.to(selection: ISelection): types.Selection\n// Creates vscode.Selection with anchor and active positions\n```\n\nSources: [src/vs/workbench/api/common/extHostTypeConverters.ts:94-112]()\n\n#### Diagnostic Conversion\n\nDiagnostics require conversion of markers, severity, and related information:\n\n| Extension Type | Internal Type | Converter |\n|----------------|---------------|-----------|\n| `vscode.DiagnosticSeverity` | `MarkerSeverity` | `DiagnosticSeverity.from/to()` |\n| `vscode.DiagnosticTag` | `MarkerTag` | `DiagnosticTag.from/to()` |\n| `vscode.Diagnostic` | `IMarkerData` | `Diagnostic.from/to()` |\n| `vscode.DiagnosticRelatedInformation` | `IRelatedInformation` | `DiagnosticRelatedInformation.from/to()` |\n\nSources: [src/vs/workbench/api/common/extHostTypeConverters.ts:215-315]()\n\n#### Language Feature Converters\n\nComplex converters for language features:\n\n**CompletionItem:** [src/vs/workbench/api/common/extHostTypeConverters.ts:537-705]()\n- Converts `vscode.CompletionItem` to `languages.CompletionItem`\n- Handles completion kind, tags, range, insert text, additional edits\n- Manages command conversion for command triggers\n\n**CodeAction:** [src/vs/workbench/api/common/extHostTypeConverters.ts:777-827]()\n- Converts `vscode.CodeAction` to `languages.CodeAction`\n- Handles workspace edits, diagnostics, kind hierarchies\n- Supports disabled actions with reasons\n\n**Hover:** [src/vs/workbench/api/common/extHostTypeConverters.ts:1015-1041]()\n- Converts hover contents (markdown strings)\n- Handles ranges and verbosity controls\n\nSources: [src/vs/workbench/api/common/extHostTypeConverters.ts:537-1041]()\n\n### DocumentSelector Conversion\n\nDocument selectors specify which documents a provider applies to:\n\n```mermaid\ngraph TD\n    ExtSelector[\"Extension DocumentSelector\u003cbr/\u003estring | DocumentFilter | array\"]\n    \n    ExtSelector --\u003e Transform[\"DocumentSelector.from()\"]\n    \n    Transform --\u003e CheckScheme[\"Check \u0026 Transform Scheme\"]\n    Transform --\u003e GlobPattern[\"Convert GlobPattern\"]\n    Transform --\u003e AddMetadata[\"Add Extension Metadata\"]\n    \n    CheckScheme --\u003e Internal[\"IDocumentFilterDto[]\"]\n    GlobPattern --\u003e Internal\n    AddMetadata --\u003e Internal\n    \n    Internal --\u003e MainThread[\"Main Thread\u003cbr/\u003eLanguage Features Service\"]\n```\n\n**Diagram: DocumentSelector Transformation**\n\nConversion handles:\n- String selectors (language ID only) [src/vs/workbench/api/common/extHostTypeConverters.ts:184-190]()\n- Document filter objects with language, scheme, pattern [src/vs/workbench/api/common/extHostTypeConverters.ts:192-202]()\n- URI scheme transformation for remote connections [src/vs/workbench/api/common/extHostTypeConverters.ts:207-212]()\n- Extension builtin flag [src/vs/workbench/api/common/extHostTypeConverters.ts:188]()\n\nSources: [src/vs/workbench/api/common/extHostTypeConverters.ts:177-213]()\n\n### Data Transfer and Serialization\n\nComplex types require special serialization for IPC transfer:\n\n**WorkspaceEdit:** [src/vs/workbench/api/common/extHostTypeConverters.ts:1270-1416]()\n- Converts file operations (create, delete, rename)\n- Handles text edits with optional metadata\n- Preserves notebook cell edits\n\n**DataTransfer:** [src/vs/workbench/api/common/extHostTypeConverters.ts:2197-2276]()\n- Serializes data transfer items for drag/drop and paste operations\n- Handles file URIs and custom MIME types\n- Caches file data for deferred resolution\n\nSources: [src/vs/workbench/api/common/extHostTypeConverters.ts:1270-2276]()\n\n---\n\n## API Surface Generation\n\n### The vscode.d.ts Type Definitions\n\nThe public API contract is defined in [src/vscode-dts/vscode.d.ts](). This file:\n\n1. **Defines all stable API types** - Classes, interfaces, enums exposed to extensions\n2. **Documents API behavior** - JSDoc comments become extension API documentation\n3. **Serves as implementation contract** - The runtime implementation must match these signatures\n\nKey API areas in vscode.d.ts:\n- Core types: `Position`, `Range`, `Selection`, `Uri` [src/vscode-dts/vscode.d.ts:269-259]()\n- Documents: `TextDocument`, `TextEditor` [src/vscode-dts/vscode.d.ts:88-259]()\n- Language features: `CompletionItem`, `Hover`, `CodeAction` [src/vscode-dts/vscode.d.ts:3500-6500]()\n- Namespaces: `commands`, `window`, `workspace`, `languages` [src/vscode-dts/vscode.d.ts:15000-18000]()\n\nSources: [src/vscode-dts/vscode.d.ts:1-20000]()\n\n### Proposed API Handling\n\nProposed APIs are unstable features under development:\n\n```mermaid\ngraph TD\n    Extension[\"Extension\"]\n    \n    Extension --\u003e CheckProposed[\"checkProposedApiEnabled()\"]\n    \n    CheckProposed --\u003e ExtManifest[\"Check package.json\u003cbr/\u003eenabledApiProposals\"]\n    \n    ExtManifest --\u003e|\"Enabled\"| AllowAPI[\"Allow API Access\"]\n    ExtManifest --\u003e|\"Not Enabled\"| ThrowError[\"Throw Error\u003cbr/\u003e'Proposed API not enabled'\"]\n    \n    AllowAPI --\u003e ProposedDTS[\"vscode.proposed.*.d.ts\u003cbr/\u003eType Definitions\"]\n```\n\n**Diagram: Proposed API Access Control**\n\n**Proposed API Registration:**\n- Extensions declare enabled proposals in `package.json`: `\"enabledApiProposals\": [\"chatParticipantPrivate\", \"testObserver\"]` [extensions/vscode-api-tests/package.json:7-56]()\n- Each proposal has a corresponding `.d.ts` file [src/platform/extensions/common/extensionsApiProposals.ts:8-240]()\n- Runtime checks using `checkProposedApiEnabled(extension, 'proposalName')` [src/vs/workbench/api/common/extHost.api.impl.ts:300]()\n\n**Example checks in API implementation:**\n- Authentication learn more: [src/vs/workbench/api/common/extHost.api.impl.ts:313]()\n- Dev device ID: [src/vs/workbench/api/common/extHost.api.impl.ts:391]()\n- Telemetry configuration: [src/vs/workbench/api/common/extHost.api.impl.ts:414]()\n\nSources: [src/vs/workbench/api/common/extHost.api.impl.ts:300-414](), [src/platform/extensions/common/extensionsApiProposals.ts:8-240]()\n\n### API Event Wrapping\n\nExtension API events are wrapped with error handling to prevent extension errors from propagating:\n\n```typescript\nfunction _asExtensionEvent\u003cT\u003e(actual: vscode.Event\u003cT\u003e): vscode.Event\u003cT\u003e {\n    return (listener, thisArgs, disposables) =\u003e {\n        const handle = actual(e =\u003e {\n            try {\n                listener.call(thisArgs, e);\n            } catch (err) {\n                errors.onUnexpectedExternalError(\n                    new ExtensionError(extension.identifier, err, 'FAILED to handle event')\n                );\n            }\n        });\n        disposables?.push(handle);\n        return handle;\n    };\n}\n```\n\nThis wrapper:\n1. Catches exceptions in event listeners [src/vs/workbench/api/common/extHost.api.impl.ts:265-268]()\n2. Reports errors with extension attribution [src/vs/workbench/api/common/extHost.api.impl.ts:267]()\n3. Prevents one extension's errors from affecting others\n4. Adds disposables to cleanup lists [src/vs/workbench/api/common/extHost.api.impl.ts:270]()\n\nAll events exposed through the API use this wrapper:\n- `env.onDidChangeShell` [src/vs/workbench/api/common/extHost.api.impl.ts:405]()\n- `env.onDidChangeTelemetryEnabled` [src/vs/workbench/api/common/extHost.api.impl.ts:411]()\n- `authentication.onDidChangeSessions` [src/vs/workbench/api/common/extHost.api.impl.ts:331]()\n\nSources: [src/vs/workbench/api/common/extHost.api.impl.ts:261-273]()\n\n### Extension Context and Identity\n\nEach API instance is bound to extension identity for:\n\n**Telemetry and Diagnostics:**\n- Extension ID tracked in error reports\n- Telemetry attributed to specific extensions\n- Performance metrics per extension\n\n**Security and Isolation:**\n- Proposed API access control\n- Resource access scoping\n- Command attribution\n\n**Storage and State:**\n- Extension-specific storage paths [src/vs/workbench/api/common/extHost.api.impl.ts:144-145]()\n- Secret storage scoping [src/vs/workbench/api/common/extHost.api.impl.ts:152]()\n- Global/workspace state isolation\n\nThe extension context flows through:\n1. API factory receives `IExtensionDescription` [src/vs/workbench/api/common/extHost.api.impl.ts:256]()\n2. Extension identity passed to service calls\n3. Services check permissions and track usage\n4. Main thread receives extension ID for attribution\n\nSources: [src/vs/workbench/api/common/extHost.api.impl.ts:256-273]()\n\n---\n\n## Command Registration and Execution\n\n### Command Converter\n\nThe `CommandsConverter` handles command serialization across the RPC boundary:\n\n```mermaid\ngraph LR\n    subgraph \"Extension Side\"\n        ExtCmd[\"vscode.Command\u003cbr/\u003e{title, command, arguments}\"]\n    end\n    \n    subgraph \"Converter\"\n        ToInternal[\"toInternal()\"]\n        FromInternal[\"fromInternal()\"]\n    end\n    \n    subgraph \"Internal Side\"\n        CmdDTO[\"ICommandDto\u003cbr/\u003e{id, title, arguments}\"]\n        CmdService[\"ICommandService\"]\n    end\n    \n    ExtCmd --\u003e ToInternal\n    ToInternal --\u003e CmdDTO\n    CmdDTO --\u003e CmdService\n    \n    CmdService --\u003e FromInternal\n    FromInternal --\u003e ExtCmd\n```\n\n**Diagram: Command Conversion Flow**\n\nThe converter:\n- Serializes command objects for RPC [src/vs/workbench/api/common/extHostCommands.ts]()\n- Handles command disposal tracking\n- Manages argument serialization including `SerializableObjectWithBuffers`\n\nSources: [src/vs/workbench/api/common/extHostCommands.ts](), [src/vs/workbench/api/common/extHostTypeConverters.ts:72-78]()\n\n### Command Registration Flow\n\n```mermaid\nsequenceDiagram\n    participant Ext as Extension\n    participant API as vscode.commands\n    participant ExtHostCmds as ExtHostCommands\n    participant MainCmds as MainThreadCommands\n    participant CmdSvc as ICommandService\n    \n    Ext-\u003e\u003eAPI: registerCommand(id, handler)\n    API-\u003e\u003eExtHostCmds: registerCommand(true, id, handler, extension)\n    ExtHostCmds-\u003e\u003eExtHostCmds: Store handler in map\n    ExtHostCmds-\u003e\u003eMainCmds: $registerCommand(id)\n    MainCmds-\u003e\u003eCmdSvc: Register command\n    \n    Note over Ext,CmdSvc: Later: Command Execution\n    \n    CmdSvc-\u003e\u003eMainCmds: Execute command(id, args)\n    MainCmds-\u003e\u003eExtHostCmds: $executeContributedCommand(id, args)\n    ExtHostCmds-\u003e\u003eExtHostCmds: Look up handler\n    ExtHostCmds-\u003e\u003eExt: handler(...args)\n    Ext--\u003e\u003eExtHostCmds: result\n    ExtHostCmds--\u003e\u003eMainCmds: result\n    MainCmds--\u003e\u003eCmdSvc: result\n```\n\n**Diagram: Command Registration and Execution Sequence**\n\nSources: [src/vs/workbench/api/common/extHost.api.impl.ts:343-344](), [src/vs/workbench/api/common/extHostCommands.ts]()\n\n---\n\n## Summary\n\nThe Extension API implementation follows a layered architecture:\n\n1. **API Factory** - `createApiFactoryAndRegisterActors` creates per-extension API instances with identity tracking and error isolation\n2. **ExtHost Services** - Service instances (Commands, Documents, Languages, etc.) provide API implementation and register with RPC protocol\n3. **Type Converters** - Bidirectional conversion between extension types and internal types for RPC marshalling\n4. **API Namespaces** - Organized API surface (commands, env, workspace, window, languages) delegates to ExtHost services\n5. **Protocol Layer** - RPC communication with main thread defined in extHost.protocol.ts (see [Extension Host Architecture and RPC Protocol](#5.1))\n\nThis architecture enables:\n- **Isolation** - Extensions run in separate processes with controlled API access\n- **Security** - Proposed API checks and extension identity tracking\n- **Stability** - Extension errors don't crash the main editor\n- **Extensibility** - New APIs can be added incrementally via proposed APIs\n\nSources: [src/vs/workbench/api/common/extHost.api.impl.ts:132-2700](), [src/vs/workbench/api/common/extHostTypeConverters.ts:1-2600]()"])</script><script>self.__next_f.push([1,"2e:T62c0,"])</script><script>self.__next_f.push([1,"# Language Features Provider System\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [extensions/vscode-api-tests/package.json](extensions/vscode-api-tests/package.json)\n- [extensions/vscode-api-tests/src/singlefolder-tests/chat.test.ts](extensions/vscode-api-tests/src/singlefolder-tests/chat.test.ts)\n- [src/vs/editor/browser/config/charWidthReader.ts](src/vs/editor/browser/config/charWidthReader.ts)\n- [src/vs/editor/browser/editorBrowser.ts](src/vs/editor/browser/editorBrowser.ts)\n- [src/vs/editor/browser/viewParts/minimap/minimap.ts](src/vs/editor/browser/viewParts/minimap/minimap.ts)\n- [src/vs/editor/browser/viewParts/minimap/minimapCharRenderer.ts](src/vs/editor/browser/viewParts/minimap/minimapCharRenderer.ts)\n- [src/vs/editor/browser/viewParts/minimap/minimapCharRendererFactory.ts](src/vs/editor/browser/viewParts/minimap/minimapCharRendererFactory.ts)\n- [src/vs/editor/browser/viewParts/minimap/minimapCharSheet.ts](src/vs/editor/browser/viewParts/minimap/minimapCharSheet.ts)\n- [src/vs/editor/browser/viewParts/minimap/minimapPreBaked.ts](src/vs/editor/browser/viewParts/minimap/minimapPreBaked.ts)\n- [src/vs/editor/browser/widget/codeEditor/codeEditorWidget.ts](src/vs/editor/browser/widget/codeEditor/codeEditorWidget.ts)\n- [src/vs/editor/common/config/editorOptions.ts](src/vs/editor/common/config/editorOptions.ts)\n- [src/vs/editor/common/config/fontInfo.ts](src/vs/editor/common/config/fontInfo.ts)\n- [src/vs/editor/common/editorCommon.ts](src/vs/editor/common/editorCommon.ts)\n- [src/vs/editor/common/languages.ts](src/vs/editor/common/languages.ts)\n- [src/vs/editor/common/standalone/standaloneEnums.ts](src/vs/editor/common/standalone/standaloneEnums.ts)\n- [src/vs/editor/common/textModelEvents.ts](src/vs/editor/common/textModelEvents.ts)\n- [src/vs/editor/common/viewModel/minimapTokensColorTracker.ts](src/vs/editor/common/viewModel/minimapTokensColorTracker.ts)\n- [src/vs/editor/test/browser/view/minimapCharRenderer.test.ts](src/vs/editor/test/browser/view/minimapCharRenderer.test.ts)\n- [src/vs/monaco.d.ts](src/vs/monaco.d.ts)\n- [src/vs/platform/extensions/common/extensionsApiProposals.ts](src/vs/platform/extensions/common/extensionsApiProposals.ts)\n- [src/vs/workbench/api/browser/extensionHost.contribution.ts](src/vs/workbench/api/browser/extensionHost.contribution.ts)\n- [src/vs/workbench/api/browser/mainThreadLanguageFeatures.ts](src/vs/workbench/api/browser/mainThreadLanguageFeatures.ts)\n- [src/vs/workbench/api/common/extHost.api.impl.ts](src/vs/workbench/api/common/extHost.api.impl.ts)\n- [src/vs/workbench/api/common/extHost.protocol.ts](src/vs/workbench/api/common/extHost.protocol.ts)\n- [src/vs/workbench/api/common/extHostLanguageFeatures.ts](src/vs/workbench/api/common/extHostLanguageFeatures.ts)\n- [src/vs/workbench/api/common/extHostTypeConverters.ts](src/vs/workbench/api/common/extHostTypeConverters.ts)\n- [src/vs/workbench/api/common/extHostTypes.ts](src/vs/workbench/api/common/extHostTypes.ts)\n- [src/vscode-dts/vscode.d.ts](src/vscode-dts/vscode.d.ts)\n- [src/vscode-dts/vscode.proposed.inlineCompletionsAdditions.d.ts](src/vscode-dts/vscode.proposed.inlineCompletionsAdditions.d.ts)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThe Language Features Provider System is the architecture that enables extensions to contribute language-specific editor features such as code completion, hover information, go-to-definition, find references, diagnostics, and many others. This system handles the registration, invocation, and result caching of language feature providers that run in the extension host process.\n\nFor information about the broader extension API surface, see [Extension API Implementation](#5.2). For details on the RPC protocol that underpins this system, see [Extension Host Architecture and RPC Protocol](#5.1).\n\n---\n\n## System Architecture\n\nThe Language Features Provider System operates across two processes with an RPC boundary:\n\n```mermaid\ngraph TB\n    subgraph \"Extension Process\"\n        ExtensionCode[\"Extension Code\u003cbr/\u003e(uses vscode.languages API)\"]\n        ExtHostLanguageFeatures[\"ExtHostLanguageFeatures\"]\n        Adapters[\"Provider Adapters\u003cbr/\u003eDocumentSymbolAdapter\u003cbr/\u003eHoverAdapter\u003cbr/\u003eCompletionAdapter\u003cbr/\u003eetc.\"]\n        Cache[\"Cache\u0026lt;T\u0026gt;\u003cbr/\u003e(result caching)\"]\n        TypeConverters[\"extHostTypeConverters\u003cbr/\u003e(marshalling)\"]\n    end\n    \n    subgraph \"RPC Boundary\"\n        Protocol[\"extHost.protocol.ts\u003cbr/\u003eMainThreadLanguageFeaturesShape\u003cbr/\u003eExtHostLanguageFeaturesShape\"]\n    end\n    \n    subgraph \"Main Thread (Renderer)\"\n        MainThreadLanguageFeatures[\"MainThreadLanguageFeatures\"]\n        LanguageFeaturesService[\"ILanguageFeaturesService\"]\n        Editor[\"Editor / Code Editor Widget\"]\n        LanguageSelector[\"Document Selector Matching\"]\n    end\n    \n    ExtensionCode --\u003e|\"registerXxxProvider()\"| ExtHostLanguageFeatures\n    ExtHostLanguageFeatures --\u003e|\"creates\"| Adapters\n    Adapters --\u003e|\"uses\"| Cache\n    Adapters --\u003e|\"uses\"| TypeConverters\n    Adapters \u003c--\u003e|\"RPC calls\"| Protocol\n    Protocol \u003c--\u003e|\"RPC calls\"| MainThreadLanguageFeatures\n    MainThreadLanguageFeatures --\u003e|\"registers providers\"| LanguageFeaturesService\n    LanguageFeaturesService --\u003e|\"queries providers\"| LanguageSelector\n    Editor --\u003e|\"requests features\"| LanguageFeaturesService\n```\n\n**Sources:** [src/vs/workbench/api/common/extHostLanguageFeatures.ts:1-2600](), [src/vs/workbench/api/browser/mainThreadLanguageFeatures.ts:1-300](), [src/vs/workbench/api/common/extHost.protocol.ts:498-560]()\n\n---\n\n## Provider Registration Flow\n\nWhen an extension registers a language feature provider, the following sequence occurs:\n\n```mermaid\nsequenceDiagram\n    participant Ext as Extension Code\n    participant API as vscode.languages API\n    participant ExtHost as ExtHostLanguageFeatures\n    participant Adapter as Provider Adapter\n    participant RPC as RPC Protocol\n    participant Main as MainThreadLanguageFeatures\n    participant LFS as ILanguageFeaturesService\n    \n    Ext-\u003e\u003eAPI: registerHoverProvider(selector, provider)\n    API-\u003e\u003eExtHost: createLanguagesApiFactory()\n    ExtHost-\u003e\u003eAdapter: new HoverAdapter(provider)\n    ExtHost-\u003e\u003eExtHost: assign handle number\n    ExtHost-\u003e\u003eRPC: $registerHoverProvider(handle, selector)\n    RPC-\u003e\u003eMain: $registerHoverProvider(handle, selector)\n    Main-\u003e\u003eLFS: registerHoverProvider(selector, proxy)\n    LFS--\u003e\u003eMain: IDisposable\n    Main-\u003e\u003eMain: store in _registrations map\n    Main--\u003e\u003eRPC: (registration complete)\n    RPC--\u003e\u003eExtHost: (registration complete)\n    ExtHost--\u003e\u003eAPI: return Disposable\n    API--\u003e\u003eExt: return Disposable\n```\n\n**Sources:** [src/vs/workbench/api/common/extHost.api.impl.ts:700-1000](), [src/vs/workbench/api/common/extHostLanguageFeatures.ts:2400-2600](), [src/vs/workbench/api/browser/mainThreadLanguageFeatures.ts:100-200]()\n\n---\n\n## Provider Invocation Flow\n\nWhen the editor needs to invoke a language feature (e.g., showing hover information):\n\n```mermaid\nsequenceDiagram\n    participant Editor as Code Editor Widget\n    participant LFS as ILanguageFeaturesService\n    participant Main as MainThread Provider Proxy\n    participant RPC as RPC Protocol\n    participant Adapter as HoverAdapter\n    participant Provider as Extension Provider\n    participant Conv as Type Converters\n    \n    Editor-\u003e\u003eLFS: getHover(model, position)\n    LFS-\u003e\u003eLFS: filter by document selector\n    LFS-\u003e\u003eMain: provideHover(resource, position, token)\n    Main-\u003e\u003eRPC: $provideHover(handle, resource, position)\n    RPC-\u003e\u003eAdapter: provideHover()\n    Adapter-\u003e\u003eAdapter: get TextDocument from resource\n    Adapter-\u003e\u003eConv: Position.to(position)\n    Adapter-\u003e\u003eProvider: provideHover(doc, pos, token)\n    Provider--\u003e\u003eAdapter: Hover | undefined\n    Adapter-\u003e\u003eConv: Hover.from(result)\n    Adapter--\u003e\u003eRPC: HoverDto\n    RPC--\u003e\u003eMain: HoverDto\n    Main-\u003e\u003eMain: revive URIs\n    Main--\u003e\u003eLFS: Hover\n    LFS--\u003e\u003eEditor: Hover\n```\n\n**Sources:** [src/vs/workbench/api/common/extHostLanguageFeatures.ts:250-350](), [src/vs/workbench/api/browser/mainThreadLanguageFeatures.ts:300-500](), [src/vs/workbench/api/common/extHostTypeConverters.ts:1-200]()\n\n---\n\n## Key Components\n\n### ExtHostLanguageFeatures\n\nThe `ExtHostLanguageFeatures` class is the central coordinator on the extension host side. It maintains a handle-based registry of all registered providers and creates adapter instances.\n\n| Method | Purpose |\n|--------|---------|\n| `registerHoverProvider()` | Registers hover provider with handle |\n| `registerCompletionItemProvider()` | Registers completion provider |\n| `registerDefinitionProvider()` | Registers definition provider |\n| `$provideHover()` | RPC method invoked from main thread |\n| `$provideCompletionItems()` | RPC method for completions |\n\n**Sources:** [src/vs/workbench/api/common/extHostLanguageFeatures.ts:2400-2600]()\n\n### MainThreadLanguageFeatures\n\nThe `MainThreadLanguageFeatures` class receives provider registrations from the extension host and registers them with the `ILanguageFeaturesService`. It acts as a proxy that forwards requests back to the extension host.\n\nKey responsibilities:\n- Receives `$registerXxxProvider` calls via RPC\n- Creates provider proxies that implement core language feature interfaces\n- Marshals data between main thread and extension host representations\n- Manages provider lifecycle via the `_registrations` disposable map\n\n**Sources:** [src/vs/workbench/api/browser/mainThreadLanguageFeatures.ts:45-100]()\n\n### ILanguageFeaturesService\n\nThe core service that manages all language feature providers in the main thread. It handles:\n- Provider registration by document selector\n- Provider querying and filtering based on document matching\n- Provider invocation with cancellation token support\n- Results aggregation from multiple providers\n\n**Sources:** [src/vs/editor/common/services/languageFeatures.ts]()\n\n---\n\n## Adapter Pattern\n\nEach language feature type has a corresponding adapter class that bridges between the extension API and the internal protocol:\n\n```mermaid\ngraph LR\n    subgraph \"Adapter Classes\"\n        DocSymbol[\"DocumentSymbolAdapter\"]\n        CodeLens[\"CodeLensAdapter\"]\n        Definition[\"DefinitionAdapter\"]\n        Hover[\"HoverAdapter\"]\n        Completion[\"CompletionAdapter\"]\n        SignatureHelp[\"SignatureHelpAdapter\"]\n        References[\"ReferenceAdapter\"]\n        Formatting[\"FormattingAdapter\"]\n    end\n    \n    ExtProvider[\"Extension Provider\u003cbr/\u003e(vscode.XxxProvider)\"]\n    Docs[\"ExtHostDocuments\"]\n    Commands[\"CommandsConverter\"]\n    TypeConv[\"Type Converters\"]\n    \n    ExtProvider --\u003e|\"wrapped by\"| DocSymbol\n    ExtProvider --\u003e|\"wrapped by\"| CodeLens\n    ExtProvider --\u003e|\"wrapped by\"| Definition\n    ExtProvider --\u003e|\"wrapped by\"| Hover\n    \n    DocSymbol --\u003e|\"uses\"| Docs\n    CodeLens --\u003e|\"uses\"| Commands\n    Definition --\u003e|\"uses\"| TypeConv\n    Hover --\u003e|\"uses\"| TypeConv\n    \n    Docs --\u003e|\"provides TextDocument\"| DocSymbol\n```\n\n### Example: CodeLensAdapter\n\nThe `CodeLensAdapter` demonstrates key adapter responsibilities:\n- **Caching**: Maintains a `Cache\u003cvscode.CodeLens\u003e` to store lenses across resolve calls\n- **Command conversion**: Uses `CommandsConverter` to marshal commands with disposables\n- **Lifecycle management**: Tracks disposables per cache ID\n- **Telemetry**: Reports errors to extension telemetry service\n\n**Sources:** [src/vs/workbench/api/common/extHostLanguageFeatures.ts:107-193]()\n\n### Example: CompletionAdapter\n\nThe `CompletionAdapter` shows advanced caching patterns:\n- Two-level cache for incomplete results (`ChainedCacheId`)\n- Partial result support via streaming\n- Suggestion resolution for additional details\n- Complex data transformation for `CompletionItem` with `additionalTextEdits`, `command`, etc.\n\n**Sources:** [src/vs/workbench/api/common/extHostLanguageFeatures.ts:800-1100]()\n\n---\n\n## Caching Strategies\n\nThe system employs sophisticated caching to optimize performance and maintain object identity across RPC calls:\n\n### Cache Class\n\nThe generic `Cache\u003cT\u003e` class provides handle-based storage:\n\n```mermaid\ngraph TB\n    Cache[\"Cache\u0026lt;T\u0026gt;\"]\n    Map[\"Map\u0026lt;number, T[]\u0026gt;\"]\n    IdGenerator[\"IdGenerator\"]\n    \n    Cache --\u003e|\"uses\"| Map\n    Cache --\u003e|\"uses\"| IdGenerator\n    \n    Cache --\u003e|\"add(items: T[])\"| Returns[\"returns cacheId: number\"]\n    Cache --\u003e|\"get(cacheId, index)\"| ReturnsItem[\"returns T | undefined\"]\n    Cache --\u003e|\"delete(cacheId)\"| Deletes[\"removes all items\"]\n```\n\n**Key methods:**\n- `add(items)`: Stores items array and returns unique cache ID\n- `get(cacheId, index)`: Retrieves item by cache ID and array index  \n- `delete(cacheId)`: Removes all cached items for given ID\n\n**Sources:** [src/vs/workbench/api/common/cache.ts:1-100]()\n\n### CacheId Types\n\nDifferent cache ID strategies are used depending on the feature:\n\n| Type | Structure | Used By |\n|------|-----------|---------|\n| `number` | Single cache ID | Most providers |\n| `[number, number]` | `[cacheId, itemIndex]` | CodeLens, InlayHints |\n| `ChainedCacheId` | `[number, number, number?]` | Completions with incomplete results |\n\n**Sources:** [src/vs/workbench/api/common/extHost.protocol.ts:100-200]()\n\n---\n\n## Type Converters\n\nThe `extHostTypeConverters` module provides bidirectional conversion between VS Code API types and internal protocol types:\n\n### Conversion Patterns\n\n```mermaid\ngraph LR\n    subgraph \"Extension API Types\"\n        Position[\"vscode.Position\"]\n        Range[\"vscode.Range\"]\n        Location[\"vscode.Location\"]\n        Hover[\"vscode.Hover\"]\n        CompletionItem[\"vscode.CompletionItem\"]\n    end\n    \n    subgraph \"Internal Types\"\n        IPosition[\"IPosition\"]\n        IRange[\"IRange\"]\n        LocationDto[\"languages.Location\"]\n        HoverDto[\"languages.Hover\"]\n        SuggestDto[\"ISuggestDataDto\"]\n    end\n    \n    Position \u003c--\u003e|\"Position.from/to\"| IPosition\n    Range \u003c--\u003e|\"Range.from/to\"| IRange\n    Location \u003c--\u003e|\"Location.from/to\"| LocationDto\n    Hover \u003c--\u003e|\"Hover.from/to\"| HoverDto\n    CompletionItem --\u003e|\"Suggest.from\"| SuggestDto\n```\n\n### Common Converters\n\n| Converter | From API | To Internal | Notes |\n|-----------|----------|-------------|-------|\n| `Position` | `vscode.Position` | `IPosition` | Adjusts 0-based to 1-based line/column |\n| `Range` | `vscode.Range` | `IRange` | Converts start/end positions |\n| `Location` | `vscode.Location` | `languages.Location` | Includes URI + range |\n| `DocumentSelector` | `vscode.DocumentSelector` | `IDocumentFilterDto[]` | Handles language/scheme/pattern |\n| `Diagnostic` | `vscode.Diagnostic` | `IMarkerData` | Includes severity, tags, related info |\n\n**Sources:** [src/vs/workbench/api/common/extHostTypeConverters.ts:1-500]()\n\n### URI Transformation\n\nURIs are transformed to handle remote development scenarios:\n\n```typescript\n// Uses IURITransformer to convert between local and remote URIs\nfunction _transformScheme(scheme: string | undefined, uriTransformer: IURITransformer | undefined): string | undefined {\n    if (uriTransformer \u0026\u0026 typeof scheme === 'string') {\n        return uriTransformer.transformOutgoingScheme(scheme);\n    }\n    return scheme;\n}\n```\n\n**Sources:** [src/vs/workbench/api/common/extHostTypeConverters.ts:207-213]()\n\n---\n\n## Document Selector Matching\n\nDocument selectors determine which providers apply to which documents:\n\n### IDocumentFilterDto Structure\n\n```typescript\ninterface IDocumentFilterDto {\n    $serialized: true;\n    language?: string;          // e.g., \"typescript\"\n    scheme?: string;            // e.g., \"file\", \"untitled\"\n    pattern?: GlobPattern;      // e.g., \"**/*.ts\"\n    exclusive?: boolean;        // Proposed API\n    notebookType?: string;      // For notebook cells\n    isBuiltin?: boolean;        // Internal flag\n}\n```\n\n**Sources:** [src/vs/workbench/api/common/extHost.protocol.ts:423-431]()\n\n### Selector Evaluation\n\nThe main thread evaluates document selectors using the `languageSelector` module:\n\n```mermaid\ngraph TD\n    Document[\"Text Document\"]\n    Filters[\"Document Filters\"]\n    Score[\"Score Calculation\"]\n    Match[\"Match Result\"]\n    \n    Document --\u003e|\"languageId, uri\"| Score\n    Filters --\u003e|\"language, scheme, pattern\"| Score\n    Score --\u003e|\"score(selector, doc)\"| Match\n    Match --\u003e|\"0 = no match\u003cbr/\u003e1-10 = match strength\"| Result[\"Provider Selected\"]\n```\n\n**Scoring rules:**\n- Base score of 10 for exact language match\n- Scheme match adds to score\n- Glob pattern match adds to score  \n- Score of 0 means no match\n- Higher scores indicate better matches\n\n**Sources:** [src/vs/editor/common/languageSelector.ts:1-200]()\n\n---\n\n## Provider Types and Interfaces\n\nThe system supports numerous language feature provider types:\n\n### Core Provider Interfaces\n\n| Provider Type | Main Interface | Adapter Class | Key Methods |\n|---------------|----------------|---------------|-------------|\n| Document Symbols | `DocumentSymbolProvider` | `DocumentSymbolAdapter` | `provideDocumentSymbols()` |\n| Hover | `HoverProvider` | `HoverAdapter` | `provideHover()` |\n| Completion | `CompletionItemProvider` | `CompletionAdapter` | `provideCompletionItems()`, `resolveCompletionItem()` |\n| Definition | `DefinitionProvider` | `DefinitionAdapter` | `provideDefinition()` |\n| References | `ReferenceProvider` | `ReferenceAdapter` | `provideReferences()` |\n| Code Actions | `CodeActionProvider` | `CodeActionAdapter` | `provideCodeActions()`, `resolveCodeAction()` |\n| Code Lens | `CodeLensProvider` | `CodeLensAdapter` | `provideCodeLenses()`, `resolveCodeLens()` |\n| Formatting | `DocumentFormattingEditProvider` | `DocumentFormattingAdapter` | `provideDocumentFormattingEdits()` |\n| Signature Help | `SignatureHelpProvider` | `SignatureHelpAdapter` | `provideSignatureHelp()` |\n| Semantic Tokens | `DocumentSemanticTokensProvider` | `SemanticTokensAdapter` | `provideDocumentSemanticTokens()` |\n| Inlay Hints | `InlayHintsProvider` | `InlayHintsAdapter` | `provideInlayHints()`, `resolveInlayHint()` |\n\n**Sources:** [src/vscode-dts/vscode.d.ts:4500-6000](), [src/vs/workbench/api/common/extHostLanguageFeatures.ts:45-2600]()\n\n### Registration Methods\n\nAll registration methods follow the same pattern in the `vscode.languages` namespace:\n\n```typescript\n// Example from the public API\nexport namespace languages {\n    export function registerHoverProvider(\n        selector: DocumentSelector,\n        provider: HoverProvider\n    ): Disposable;\n    \n    export function registerCompletionItemProvider(\n        selector: DocumentSelector,\n        provider: CompletionItemProvider,\n        ...triggerCharacters: string[]\n    ): Disposable;\n}\n```\n\n**Sources:** [src/vscode-dts/vscode.d.ts:4500-5000]()\n\n---\n\n## Protocol Definitions\n\nThe RPC protocol defines the contract between extension host and main thread:\n\n### MainThreadLanguageFeaturesShape\n\nDefines methods the main thread exposes to the extension host:\n\n```typescript\nexport interface MainThreadLanguageFeaturesShape extends IDisposable {\n    $unregister(handle: number): void;\n    $registerDocumentSymbolProvider(handle: number, selector: IDocumentFilterDto[], label: string): void;\n    $registerHoverProvider(handle: number, selector: IDocumentFilterDto[]): void;\n    $registerCompletionsProvider(handle: number, selector: IDocumentFilterDto[], \n        triggerCharacters: string[], supportsResolveDetails: boolean, \n        extensionId: ExtensionIdentifier): void;\n    // ... many more registration methods\n}\n```\n\n**Sources:** [src/vs/workbench/api/common/extHost.protocol.ts:498-560]()\n\n### ExtHostLanguageFeaturesShape\n\nDefines methods the extension host exposes to the main thread for provider invocation:\n\n```typescript\nexport interface ExtHostLanguageFeaturesShape {\n    $provideDocumentSymbols(handle: number, resource: UriComponents, token: CancellationToken): Promise\u003clanguages.DocumentSymbol[] | undefined\u003e;\n    $provideHover(handle: number, resource: UriComponents, position: IPosition, token: CancellationToken): Promise\u003cHover | undefined\u003e;\n    $provideCompletionItems(handle: number, resource: UriComponents, position: IPosition, \n        context: languages.CompletionContext, token: CancellationToken): Promise\u003cISuggestResultDto | undefined\u003e;\n    // ... provider invocation methods\n}\n```\n\n**Sources:** [src/vs/workbench/api/common/extHost.protocol.ts:1800-2000]()\n\n---\n\n## Performance Optimizations\n\nThe system includes several performance optimizations:\n\n### 1. Result Caching\n\nProviders that return resolv-able items (CodeLens, CompletionItem, InlayHint) cache results:\n- Initial result set is cached with a numeric ID\n- Resolve operations reference items by `[cacheId, itemIndex]`\n- Cache is cleared when provider is disposed or new results are requested\n\n**Sources:** [src/vs/workbench/api/common/extHostLanguageFeatures.ts:109-193]()\n\n### 2. Incomplete Results Support\n\nCompletion providers support partial/streaming results:\n- Provider can return `isIncomplete: true` to indicate more results available\n- System caches incomplete results for subsequent refinement requests\n- Uses `ChainedCacheId` to track result chains across invocations\n\n**Sources:** [src/vs/workbench/api/common/extHostLanguageFeatures.ts:900-1000]()\n\n### 3. Document Selector Pre-filtering\n\nThe main thread filters providers by document selector before invoking:\n- Uses efficient scoring algorithm from `languageSelector` module\n- Only invokes providers with non-zero match scores\n- Caches match results per document\n\n**Sources:** [src/vs/editor/common/languageSelector.ts:50-150]()\n\n### 4. Cancellation Token Support\n\nAll provider methods receive cancellation tokens:\n- User actions can cancel in-flight requests\n- Prevents unnecessary work and RPC traffic\n- Providers should check `token.isCancellationRequested` frequently\n\n**Sources:** [src/vs/workbench/api/common/extHostLanguageFeatures.ts:52-60]()\n\n---\n\n## Error Handling and Telemetry\n\nThe system includes comprehensive error handling:\n\n### Extension Error Tracking\n\nErrors from extension providers are caught and reported:\n\n```typescript\ntry {\n    const value = await provider.provideXxx(doc, pos, token);\n    return convertResult(value);\n} catch (err) {\n    if (!isCancellationError(err)) {\n        this._logService.error('Provider error:', err);\n        this._telemetry.onExtensionError(this._extension.identifier, err);\n    }\n    return undefined;\n}\n```\n\n**Sources:** [src/vs/workbench/api/common/extHostLanguageFeatures.ts:180-185]()\n\n### Validation\n\nAdapters validate extension provider results:\n- Check for required properties (e.g., CodeLens must have a range)\n- Log warnings for invalid results without crashing\n- Filter out invalid items from result arrays\n\n**Example from CodeLensAdapter:**\n\n```typescript\nif (!Range.isRange(lenses[i].range)) {\n    console.warn('INVALID code lens, range is not defined', \n        this._extension.identifier.value);\n    continue;\n}\n```\n\n**Sources:** [src/vs/workbench/api/common/extHostLanguageFeatures.ts:137-140]()\n\n---\n\n## Data Transfer Objects (DTOs)\n\nThe protocol uses specialized DTO types for efficient serialization:\n\n### Common DTO Patterns\n\n| API Type | DTO Type | Key Differences |\n|----------|----------|-----------------|\n| `vscode.Location` | `ILocationDto` | URI as UriComponents, serializable |\n| `vscode.Range` | `IRange` | 1-based line/column numbers |\n| `vscode.CompletionItem` | `ISuggestDataDto` | Flattened structure, no methods |\n| `vscode.CodeLens` | `ICodeLensDto` | Includes cache ID tuple |\n| `vscode.SemanticTokens` | Uint32Array | Encoded binary format |\n\n**Sources:** [src/vs/workbench/api/common/extHost.protocol.ts:433-470]()\n\n### Serialization Helpers\n\nThe protocol includes helpers for complex types:\n\n- `SerializableObjectWithBuffers\u003cT\u003e`: Wraps objects containing VSBuffer instances\n- `UriComponents`: Serializable representation of URI (scheme, authority, path, query, fragment)\n- `revive()`: Reconstructs URI instances on the receiving end\n\n**Sources:** [src/vs/base/common/uri.ts:1-100](), [src/vs/workbench/services/extensions/common/proxyIdentifier.ts:50-100]()\n\n---\n\n## Integration with ILanguageFeaturesService\n\nThe main thread integrates with the core editor's language features service:\n\n```mermaid\ngraph TB\n    MainThread[\"MainThreadLanguageFeatures\"]\n    LFS[\"ILanguageFeaturesService\"]\n    Registry[\"Provider Registry\"]\n    \n    subgraph \"Feature-Specific Registries\"\n        HoverReg[\"HoverProviderRegistry\"]\n        CompletionReg[\"CompletionProviderRegistry\"]\n        DefinitionReg[\"DefinitionProviderRegistry\"]\n    end\n    \n    MainThread --\u003e|\"registerHoverProvider()\"| LFS\n    MainThread --\u003e|\"registerCompletionItemProvider()\"| LFS\n    MainThread --\u003e|\"registerDefinitionProvider()\"| LFS\n    \n    LFS --\u003e|\"manages\"| Registry\n    Registry --\u003e|\"contains\"| HoverReg\n    Registry --\u003e|\"contains\"| CompletionReg\n    Registry --\u003e|\"contains\"| DefinitionReg\n    \n    HoverReg --\u003e|\"queries\"| ProviderProxy[\"Provider Proxy\u003cbr/\u003e(calls back to ExtHost)\"]\n    CompletionReg --\u003e|\"queries\"| ProviderProxy\n    DefinitionReg --\u003e|\"queries\"| ProviderProxy\n```\n\n**Key service methods:**\n- `registerXxxProvider(selector, provider)`: Returns IDisposable for lifecycle management\n- `getXxx(model, position, token)`: Queries all matching providers\n- Feature-specific registries handle provider ordering and parallel invocation\n\n**Sources:** [src/vs/editor/common/services/languageFeatures.ts](), [src/vs/workbench/api/browser/mainThreadLanguageFeatures.ts:150-250]()"])</script><script>self.__next_f.push([1,"2f:T9b4d,"])</script><script>self.__next_f.push([1,"# Extension Management and Marketplace\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [src/vs/platform/extensionManagement/common/abstractExtensionManagementService.ts](src/vs/platform/extensionManagement/common/abstractExtensionManagementService.ts)\n- [src/vs/platform/extensionManagement/common/extensionGalleryService.ts](src/vs/platform/extensionManagement/common/extensionGalleryService.ts)\n- [src/vs/platform/extensionManagement/common/extensionManagement.ts](src/vs/platform/extensionManagement/common/extensionManagement.ts)\n- [src/vs/platform/extensionManagement/common/extensionManagementIpc.ts](src/vs/platform/extensionManagement/common/extensionManagementIpc.ts)\n- [src/vs/platform/extensionManagement/common/extensionManagementUtil.ts](src/vs/platform/extensionManagement/common/extensionManagementUtil.ts)\n- [src/vs/platform/extensionManagement/node/extensionDownloader.ts](src/vs/platform/extensionManagement/node/extensionDownloader.ts)\n- [src/vs/platform/extensionManagement/node/extensionManagementService.ts](src/vs/platform/extensionManagement/node/extensionManagementService.ts)\n- [src/vs/platform/extensionManagement/node/extensionSignatureVerificationService.ts](src/vs/platform/extensionManagement/node/extensionSignatureVerificationService.ts)\n- [src/vs/platform/extensionManagement/test/node/extensionDownloader.test.ts](src/vs/platform/extensionManagement/test/node/extensionDownloader.test.ts)\n- [src/vs/platform/sign/browser/signService.ts](src/vs/platform/sign/browser/signService.ts)\n- [src/vs/platform/sign/common/abstractSignService.ts](src/vs/platform/sign/common/abstractSignService.ts)\n- [src/vs/platform/sign/common/sign.ts](src/vs/platform/sign/common/sign.ts)\n- [src/vs/platform/sign/node/signService.ts](src/vs/platform/sign/node/signService.ts)\n- [src/vs/platform/telemetry/browser/1dsAppender.ts](src/vs/platform/telemetry/browser/1dsAppender.ts)\n- [src/vs/platform/telemetry/common/1dsAppender.ts](src/vs/platform/telemetry/common/1dsAppender.ts)\n- [src/vs/platform/telemetry/node/1dsAppender.ts](src/vs/platform/telemetry/node/1dsAppender.ts)\n- [src/vs/platform/telemetry/test/browser/1dsAppender.test.ts](src/vs/platform/telemetry/test/browser/1dsAppender.test.ts)\n- [src/vs/workbench/contrib/extensions/browser/extensionEditor.ts](src/vs/workbench/contrib/extensions/browser/extensionEditor.ts)\n- [src/vs/workbench/contrib/extensions/browser/extensions.contribution.ts](src/vs/workbench/contrib/extensions/browser/extensions.contribution.ts)\n- [src/vs/workbench/contrib/extensions/browser/extensionsActions.ts](src/vs/workbench/contrib/extensions/browser/extensionsActions.ts)\n- [src/vs/workbench/contrib/extensions/browser/extensionsIcons.ts](src/vs/workbench/contrib/extensions/browser/extensionsIcons.ts)\n- [src/vs/workbench/contrib/extensions/browser/extensionsList.ts](src/vs/workbench/contrib/extensions/browser/extensionsList.ts)\n- [src/vs/workbench/contrib/extensions/browser/extensionsViewer.ts](src/vs/workbench/contrib/extensions/browser/extensionsViewer.ts)\n- [src/vs/workbench/contrib/extensions/browser/extensionsViewlet.ts](src/vs/workbench/contrib/extensions/browser/extensionsViewlet.ts)\n- [src/vs/workbench/contrib/extensions/browser/extensionsViews.ts](src/vs/workbench/contrib/extensions/browser/extensionsViews.ts)\n- [src/vs/workbench/contrib/extensions/browser/extensionsWidgets.ts](src/vs/workbench/contrib/extensions/browser/extensionsWidgets.ts)\n- [src/vs/workbench/contrib/extensions/browser/extensionsWorkbenchService.ts](src/vs/workbench/contrib/extensions/browser/extensionsWorkbenchService.ts)\n- [src/vs/workbench/contrib/extensions/browser/media/extension.css](src/vs/workbench/contrib/extensions/browser/media/extension.css)\n- [src/vs/workbench/contrib/extensions/browser/media/extensionActions.css](src/vs/workbench/contrib/extensions/browser/media/extensionActions.css)\n- [src/vs/workbench/contrib/extensions/browser/media/extensionEditor.css](src/vs/workbench/contrib/extensions/browser/media/extensionEditor.css)\n- [src/vs/workbench/contrib/extensions/browser/media/extensionsViewlet.css](src/vs/workbench/contrib/extensions/browser/media/extensionsViewlet.css)\n- [src/vs/workbench/contrib/extensions/browser/media/extensionsWidgets.css](src/vs/workbench/contrib/extensions/browser/media/extensionsWidgets.css)\n- [src/vs/workbench/contrib/extensions/common/extensions.ts](src/vs/workbench/contrib/extensions/common/extensions.ts)\n- [src/vs/workbench/services/extensionManagement/common/extensionManagement.ts](src/vs/workbench/services/extensionManagement/common/extensionManagement.ts)\n- [src/vs/workbench/services/extensionManagement/common/extensionManagementChannelClient.ts](src/vs/workbench/services/extensionManagement/common/extensionManagementChannelClient.ts)\n- [src/vs/workbench/services/extensionManagement/common/extensionManagementService.ts](src/vs/workbench/services/extensionManagement/common/extensionManagementService.ts)\n- [src/vs/workbench/services/extensionManagement/common/webExtensionManagementService.ts](src/vs/workbench/services/extensionManagement/common/webExtensionManagementService.ts)\n\n\u003c/details\u003e\n\n\n\nThis document covers the extension management and marketplace system in VS Code, including how extensions are discovered, downloaded, installed, uninstalled, and managed across different execution contexts. This includes the gallery service for querying the VS Code Marketplace, signature verification, the multi-server architecture for local/remote/web environments, and the UI components for managing extensions.\n\nFor information about the extension host runtime and how extensions are loaded and activated, see [Extension Host Architecture and RPC Protocol](#5.1). For details about the Extensions viewlet UI, see [Extension Management UI](#5.5).\n\n## Service Architecture\n\nThe extension management system is organized into several layered services that interact to provide a complete extension lifecycle management experience.\n\n```mermaid\ngraph TB\n    subgraph \"Workbench Layer\"\n        ExtensionsWorkbenchService[\"IExtensionsWorkbenchService\u003cbr/\u003e(ExtensionsWorkbenchService)\"]\n        ExtManagementService[\"IWorkbenchExtensionManagementService\u003cbr/\u003e(ExtensionManagementService)\"]\n    end\n    \n    subgraph \"Platform Layer\"\n        GalleryService[\"IExtensionGalleryService\u003cbr/\u003e(ExtensionGalleryService)\"]\n        LocalExtManagement[\"IExtensionManagementService\u003cbr/\u003e(ExtensionManagementService - Node)\"]\n        RemoteExtManagement[\"IExtensionManagementService\u003cbr/\u003e(Remote Server)\"]\n        WebExtManagement[\"IExtensionManagementService\u003cbr/\u003e(WebExtensionManagementService)\"]\n    end\n    \n    subgraph \"Server Management\"\n        ServerService[\"IExtensionManagementServerService\"]\n        LocalServer[\"Local Server\"]\n        RemoteServer[\"Remote Server\"]\n        WebServer[\"Web Server\"]\n    end\n    \n    subgraph \"Storage and Scanning\"\n        ScannerService[\"IExtensionsScannerService\"]\n        ProfileScanner[\"IExtensionsProfileScannerService\"]\n        FileService[\"IFileService\"]\n    end\n    \n    ExtensionsWorkbenchService --\u003e ExtManagementService\n    ExtensionsWorkbenchService --\u003e GalleryService\n    ExtManagementService --\u003e ServerService\n    ExtManagementService --\u003e GalleryService\n    \n    ServerService --\u003e LocalServer\n    ServerService --\u003e RemoteServer\n    ServerService --\u003e WebServer\n    \n    LocalServer --\u003e LocalExtManagement\n    RemoteServer --\u003e RemoteExtManagement\n    WebServer --\u003e WebExtManagement\n    \n    LocalExtManagement --\u003e ScannerService\n    LocalExtManagement --\u003e ProfileScanner\n    LocalExtManagement --\u003e FileService\n    \n    WebExtManagement --\u003e ScannerService\n    WebExtManagement --\u003e ProfileScanner\n```\n\n**IExtensionsWorkbenchService** is the primary workbench-level service that coordinates all extension operations. It provides a unified `IExtension` model that wraps both local and gallery extensions with UI state like installation state, enablement, and recommendations.\n\n**IWorkbenchExtensionManagementService** orchestrates extension operations across multiple servers (local, remote, web) and handles cross-cutting concerns like signature verification, workspace trust, and profile management.\n\n**IExtensionGalleryService** interfaces with the VS Code Marketplace to query, download, and report statistics for extensions.\n\nSources: [src/vs/workbench/contrib/extensions/browser/extensionsWorkbenchService.ts:1-2500](), [src/vs/workbench/services/extensionManagement/common/extensionManagementService.ts:1-600](), [src/vs/platform/extensionManagement/common/extensionGalleryService.ts:1-400]()\n\n## Extension Model and State Management\n\nThe `Extension` class provides a unified view of an extension regardless of whether it's installed locally or exists only in the gallery.\n\n```mermaid\ngraph LR\n    subgraph \"Extension State\"\n        Extension[\"Extension\u003cbr/\u003e(IExtension)\"]\n        Local[\"local?: ILocalExtension\"]\n        Gallery[\"gallery?: IGalleryExtension\"]\n        ResourceExt[\"resourceExtension?: IResourceExtension\"]\n    end\n    \n    subgraph \"State Providers\"\n        StateProvider[\"stateProvider\u003cbr/\u003e(ExtensionState)\"]\n        RuntimeStateProvider[\"runtimeStateProvider\u003cbr/\u003e(ExtensionRuntimeState)\"]\n    end\n    \n    subgraph \"Derived Properties\"\n        State[\"state: ExtensionState\u003cbr/\u003e(Installing/Installed/Uninstalling/Uninstalled)\"]\n        RuntimeState[\"runtimeState?: ExtensionRuntimeState\u003cbr/\u003e(ReloadWindow/RestartExtensions/etc)\"]\n        Enablement[\"enablementState: EnablementState\"]\n        Outdated[\"outdated: boolean\"]\n    end\n    \n    Extension --\u003e Local\n    Extension --\u003e Gallery\n    Extension --\u003e ResourceExt\n    \n    StateProvider --\u003e State\n    RuntimeStateProvider --\u003e RuntimeState\n    \n    Extension --\u003e State\n    Extension --\u003e RuntimeState\n    Extension --\u003e Enablement\n    Extension --\u003e Outdated\n```\n\nThe `Extension` class merges information from three potential sources:\n- **`local`**: An installed extension from `ILocalExtension`\n- **`gallery`**: Gallery metadata from `IGalleryExtension`\n- **`resourceExtension`**: A workspace-scoped extension from `IResourceExtension`\n\nState is computed dynamically through provider functions rather than stored directly, ensuring consistency across the system. The `state` property indicates installation lifecycle (Installing  Installed  Uninstalling  Uninstalled), while `runtimeState` indicates required actions (reload window, restart extensions, etc.).\n\nSources: [src/vs/workbench/contrib/extensions/browser/extensionsWorkbenchService.ts:93-586]()\n\n## Extension Gallery Service\n\nThe `ExtensionGalleryService` communicates with the VS Code Marketplace API to discover and download extensions.\n\n```mermaid\ngraph TB\n    subgraph \"Query API\"\n        QueryMethod[\"query(options, token)\"]\n        GetExtensions[\"getExtensions(infos, options, token)\"]\n        QueryState[\"Query State\u003cbr/\u003epageNumber, pageSize\u003cbr/\u003esortBy, sortOrder\u003cbr/\u003eflags, criteria\"]\n    end\n    \n    subgraph \"Marketplace API\"\n        PostAPI[\"POST extensionquery\"]\n        AssetAPI[\"GET {assetUri}/{assetType}\"]\n    end\n    \n    subgraph \"Request Construction\"\n        QueryClass[\"Query class\"]\n        Criteria[\"ICriterium[]\u003cbr/\u003e(FilterType: ExtensionId, SearchText, Tag, etc)\"]\n        Flags[\"Flag[]\u003cbr/\u003e(IncludeVersions, IncludeFiles, etc)\"]\n    end\n    \n    subgraph \"Response Processing\"\n        RawGallery[\"IRawGalleryQueryResult\"]\n        ToGallery[\"toExtension(raw, ...)\"]\n        GalleryExtension[\"IGalleryExtension\"]\n    end\n    \n    QueryMethod --\u003e QueryClass\n    GetExtensions --\u003e QueryClass\n    QueryClass --\u003e Criteria\n    QueryClass --\u003e Flags\n    QueryClass --\u003e QueryState\n    \n    QueryState --\u003e PostAPI\n    PostAPI --\u003e RawGallery\n    RawGallery --\u003e ToGallery\n    ToGallery --\u003e GalleryExtension\n    \n    GalleryExtension --\u003e AssetAPI\n```\n\n**Query Construction**: The `Query` class builds marketplace queries with filters (search text, tags, extension IDs), sorting (relevance, install count, rating), and pagination. Flags control what data is returned (versions, files, statistics).\n\n**API Communication**: Queries are sent via POST to the marketplace's `extensionquery` endpoint. The service constructs a JSON request with criteria and flags, then processes the `IRawGalleryQueryResult` response.\n\n**Asset Downloads**: Extension assets (VSIX packages, icons, READMEs, manifests) are downloaded from the `assetUri` or `fallbackAssetUri` provided in the gallery response.\n\nSources: [src/vs/platform/extensionManagement/common/extensionGalleryService.ts:244-368](), [src/vs/platform/extensionManagement/common/extensionGalleryService.ts:690-850]()\n\n### Gallery Query Telemetry\n\nEvery gallery query is instrumented with detailed telemetry to monitor marketplace performance and usage patterns:\n\n```typescript\ntype GalleryServiceQueryEvent = {\n    filterTypes: string[];      // Filters used (SearchText, Tag, etc)\n    flags: string[];            // Requested flags\n    sortBy: string;             // Sort criteria\n    sortOrder: string;          // Ascending/Descending\n    pageNumber: string;         // Requested page\n    duration: number;           // Request duration\n    success: boolean;           // Success/failure\n    requestBodySize: string;    // Size of request\n    responseBodySize?: string;  // Size of response\n    statusCode?: string;        // HTTP status\n    count?: string;             // Results returned\n}\n```\n\nSources: [src/vs/platform/extensionManagement/common/extensionGalleryService.ts:165-208]()\n\n## Extension Installation Flow\n\nExtension installation involves downloading, verifying, extracting, and registering the extension. The process differs based on the installation source (gallery vs VSIX file).\n\n```mermaid\ngraph TB\n    Install[\"install(extension, options)\"]\n    \n    subgraph \"Gallery Installation\"\n        CreateTask[\"createInstallExtensionTask(manifest, gallery, options)\"]\n        DownloadExtract[\"downloadAndExtractGalleryExtension()\"]\n        Download[\"extensionsDownloader.download(gallery, operation, verifySignature)\"]\n        Verify[\"Signature Verification\u003cbr/\u003e(ExtensionSignatureVerificationCode)\"]\n        Extract[\"extensionsScanner.extractUserExtension(key, location)\"]\n    end\n    \n    subgraph \"VSIX Installation\"\n        DownloadVsix[\"downloadVsix(vsixUri)\"]\n        GetManifest[\"getManifest(zipPath)\"]\n        ExtractVSIX[\"extractVSIX(extensionKey, vsixLocation)\"]\n    end\n    \n    subgraph \"Registration\"\n        AddToProfile[\"addExtensionsToProfile([[extension, metadata]], profileLocation)\"]\n        UpdateCache[\"manifestCache.invalidate(profileLocation)\"]\n        FireEvent[\"_onDidInstallExtensions.fire(results)\"]\n    end\n    \n    Install --\u003e CreateTask\n    CreateTask --\u003e DownloadExtract\n    DownloadExtract --\u003e Download\n    Download --\u003e Verify\n    Verify --\u003e Extract\n    \n    Install --\u003e DownloadVsix\n    DownloadVsix --\u003e GetManifest\n    GetManifest --\u003e ExtractVSIX\n    \n    Extract --\u003e AddToProfile\n    ExtractVSIX --\u003e AddToProfile\n    AddToProfile --\u003e UpdateCache\n    UpdateCache --\u003e FireEvent\n```\n\n**Download Phase**: For gallery extensions, `ExtensionsDownloader` fetches the VSIX from the marketplace. For VSIX URIs, the file is downloaded or read from the local filesystem.\n\n**Verification Phase**: If signature verification is enabled, the downloaded VSIX is checked against its signature. The result is one of: `Success`, `NotSigned`, `SignatureArchiveNotFound`, `PackagingError`, `SignatureVerificationError`, etc.\n\n**Extraction Phase**: The VSIX ZIP is extracted to a temporary location, validated, then moved to the extensions directory under a directory named `{publisher}.{name}-{version}`.\n\n**Registration Phase**: The extension metadata is written to the profile's extensions manifest. The manifest cache is invalidated, and installation events are fired for UI updates.\n\nSources: [src/vs/platform/extensionManagement/node/extensionManagementService.ts:145-338](), [src/vs/platform/extensionManagement/common/abstractExtensionManagementService.ts:200-450]()\n\n### Installation Task Architecture\n\nInstallation is managed through `IInstallExtensionTask` instances that handle async operations, cancellation, and coordination:\n\n```mermaid\ngraph LR\n    subgraph \"Task Interface\"\n        ITask[\"IInstallExtensionTask\"]\n        Run[\"run(): Promise\u0026lt;ILocalExtension\u0026gt;\"]\n        Wait[\"waitUntilTaskIsFinished()\"]\n        Cancel[\"cancel()\"]\n    end\n    \n    subgraph \"Implementation\"\n        InstallTask[\"InstallExtensionInProfileTask\"]\n        Barrier[\"Barrier (for synchronization)\"]\n        DoRun[\"doRun(token)\"]\n        Extract[\"extract(operation, token)\"]\n    end\n    \n    subgraph \"State Management\"\n        Installing[\"installing: Extension[]\"]\n        Installed[\"installed: Extension[]\"]\n        OnChange[\"_onChange.fire(extension, operation)\"]\n    end\n    \n    ITask --\u003e Run\n    ITask --\u003e Wait\n    ITask --\u003e Cancel\n    \n    InstallTask --\u003e Barrier\n    InstallTask --\u003e DoRun\n    DoRun --\u003e Extract\n    \n    Extract --\u003e Installing\n    Extract --\u003e Installed\n    Installed --\u003e OnChange\n```\n\nTasks use a `Barrier` for coordination, allowing multiple callers to wait for the same task to complete. The `installing` array tracks in-progress installations, while `installed` holds completed ones.\n\nSources: [src/vs/platform/extensionManagement/common/abstractExtensionManagementService.ts:40-59](), [src/vs/platform/extensionManagement/node/extensionManagementService.ts:280-338]()\n\n## Multi-Server Architecture\n\nVS Code supports installing extensions to different targets (local, remote, web) through the `IExtensionManagementServerService`.\n\n```mermaid\ngraph TB\n    subgraph \"Server Service\"\n        ServerService[\"IExtensionManagementServerService\"]\n        GetServer[\"getExtensionManagementServer(extension)\"]\n        GetLocation[\"getExtensionInstallLocation(extension)\"]\n    end\n    \n    subgraph \"Servers\"\n        LocalServer[\"localExtensionManagementServer\u003cbr/\u003e{id: 'local', label: 'Local'}\"]\n        RemoteServer[\"remoteExtensionManagementServer\u003cbr/\u003e{id: 'remote', label: 'Remote - SSH/WSL/etc'}\"]\n        WebServer[\"webExtensionManagementServer\u003cbr/\u003e{id: 'web', label: 'Browser'}\"]\n    end\n    \n    subgraph \"Server Properties\"\n        ServerId[\"id: string\"]\n        ServerLabel[\"label: string\"]\n        ExtManagement[\"extensionManagementService: IProfileAwareExtensionManagementService\"]\n    end\n    \n    subgraph \"Location Determination\"\n        ManifestProps[\"IExtensionManifestPropertiesService\"]\n        PrefersUI[\"prefersExecuteOnUI(manifest)\"]\n        PrefersWorkspace[\"prefersExecuteOnWorkspace(manifest)\"]\n        PrefersWeb[\"prefersExecuteOnWeb(manifest)\"]\n    end\n    \n    ServerService --\u003e LocalServer\n    ServerService --\u003e RemoteServer\n    ServerService --\u003e WebServer\n    \n    LocalServer --\u003e ServerId\n    LocalServer --\u003e ServerLabel\n    LocalServer --\u003e ExtManagement\n    \n    GetServer --\u003e ManifestProps\n    ManifestProps --\u003e PrefersUI\n    ManifestProps --\u003e PrefersWorkspace\n    ManifestProps --\u003e PrefersWeb\n```\n\nEach server has its own `IExtensionManagementService` instance that manages extensions in that context. The `getExtensionManagementServer()` method determines which server should manage an extension based on its manifest properties:\n\n- **`main` kind** or **UI-only APIs**: Local server\n- **`workspace` kind** or **workspace APIs**: Remote/Web server\n- **Language packs**: All applicable servers\n\nThe workbench-level `ExtensionManagementService` coordinates operations across servers, ensuring extensions are installed to the correct location and handling dependencies/extension packs that may span servers.\n\nSources: [src/vs/workbench/services/extensionManagement/common/extensionManagementService.ts:91-280](), [src/vs/workbench/services/extensionManagement/common/extensionManagement.ts:1-150]()\n\n### Cross-Server Operations\n\nThe `ExtensionManagementService` handles installing extensions that need to run on a different server than the one they're being installed from:\n\n```mermaid\ngraph TB\n    InstallGallery[\"installFromGallery(extension, options)\"]\n    \n    subgraph \"Server Resolution\"\n        GetTargetServer[\"getTargetServer(extension)\"]\n        CheckCompat[\"Check Compatibility\u003cbr/\u003e(canInstall, workspace trust, etc)\"]\n    end\n    \n    subgraph \"Target Server\"\n        TargetInstall[\"server.extensionManagementService.installFromGallery()\"]\n    end\n    \n    subgraph \"Extension Pack Handling\"\n        GetPack[\"getExtensionPackExtensionsToInstall()\"]\n        ResolveServers[\"Resolve server for each dependency\"]\n        InstallDeps[\"Install dependencies on their target servers\"]\n    end\n    \n    subgraph \"Post-Install\"\n        SyncIgnored[\"Update sync ignored list\"]\n        FireEvents[\"Fire onDidInstallExtensions\"]\n    end\n    \n    InstallGallery --\u003e GetTargetServer\n    GetTargetServer --\u003e CheckCompat\n    CheckCompat --\u003e TargetInstall\n    \n    TargetInstall --\u003e GetPack\n    GetPack --\u003e ResolveServers\n    ResolveServers --\u003e InstallDeps\n    \n    InstallDeps --\u003e SyncIgnored\n    SyncIgnored --\u003e FireEvents\n```\n\nExtension packs and dependencies are automatically resolved and installed to their appropriate servers. For example, installing an extension pack on the local server may trigger installations on both local and remote servers if the pack contains both UI and workspace extensions.\n\nSources: [src/vs/workbench/services/extensionManagement/common/extensionManagementService.ts:281-550]()\n\n## Signature Verification\n\nExtension signature verification ensures the integrity and authenticity of extensions downloaded from the marketplace.\n\n```mermaid\ngraph TB\n    subgraph \"Download Phase\"\n        Download[\"ExtensionsDownloader.download()\"]\n        CheckRequire[\"shouldRequireRepositorySignatureFor(private, manifest)\"]\n        RequestDownload[\"galleryService.download(extension, location, operation)\"]\n    end\n    \n    subgraph \"Verification Phase\"\n        VerifyService[\"IExtensionSignatureVerificationService\"]\n        Verify[\"verify(vsixPath, signaturePath)\"]\n        SignedCheck[\"Check .signature.p7s file\"]\n    end\n    \n    subgraph \"Verification Result\"\n        Success[\"ExtensionSignatureVerificationCode.Success\"]\n        NotSigned[\"ExtensionSignatureVerificationCode.NotSigned\"]\n        Error[\"Error codes:\u003cbr/\u003eSignatureArchiveNotFound\u003cbr/\u003ePackagingError\u003cbr/\u003eSignatureVerificationError\"]\n    end\n    \n    subgraph \"Enforcement\"\n        Config[\"VerifyExtensionSignatureConfigKey\u003cbr/\u003e(default: true)\"]\n        GalleryManifest[\"IExtensionGalleryManifest\u003cbr/\u003eallRepositorySigned flag\"]\n        Enforce[\"Enforce if:\u003cbr/\u003e- Config enabled\u003cbr/\u003e- Built environment\u003cbr/\u003e- Requires signature\"]\n    end\n    \n    Download --\u003e CheckRequire\n    CheckRequire --\u003e RequestDownload\n    RequestDownload --\u003e VerifyService\n    VerifyService --\u003e Verify\n    Verify --\u003e SignedCheck\n    \n    SignedCheck --\u003e Success\n    SignedCheck --\u003e NotSigned\n    SignedCheck --\u003e Error\n    \n    Config --\u003e Enforce\n    GalleryManifest --\u003e Enforce\n    Enforce --\u003e VerifyService\n```\n\n**Signature Files**: Signed extensions include a `.signature.p7s` file in the VSIX that contains a cryptographic signature.\n\n**Verification Process**: The `IExtensionSignatureVerificationService` validates the signature against the VSIX contents. On native platforms, this uses native crypto APIs; on web, verification is not available.\n\n**Error Handling**: If verification fails and the extension requires a signature (based on the gallery manifest's `allRepositorySigned` flag or if it's a private extension), installation is blocked with an appropriate error message.\n\n**User Override**: Users can bypass signature verification through the `donotVerifySignature` install option, though this is not recommended.\n\nSources: [src/vs/platform/extensionManagement/node/extensionManagementService.ts:340-362](), [src/vs/platform/extensionManagement/node/extensionDownloader.ts:100-250]()\n\n## Extension Uninstallation\n\nUninstalling extensions involves removing them from the profile and optionally deleting the extension files.\n\n```mermaid\ngraph TB\n    Uninstall[\"uninstall(extension, options)\"]\n    \n    subgraph \"Profile Removal\"\n        RemoveFromProfile[\"removeExtensionFromProfile(extension, profileLocation)\"]\n        CheckOtherProfiles[\"Check if used in other profiles\"]\n    end\n    \n    subgraph \"Dependency Checking\"\n        GetDeps[\"getDependentsAfterUninstall(extension)\"]\n        PromptDeps[\"Prompt user about dependent extensions\"]\n    end\n    \n    subgraph \"File Deletion\"\n        MarkForDeletion[\"Mark extension for deletion\"]\n        ActualDelete[\"deleteExtension(extension)\"]\n        CleanUp[\"cleanUp() - Delete marked extensions\"]\n    end\n    \n    subgraph \"Post-Uninstall\"\n        ReportStats[\"Report uninstall statistics to gallery\"]\n        FireEvents[\"_onDidUninstallExtension.fire()\"]\n        InvalidateCache[\"manifestCache.invalidate()\"]\n    end\n    \n    Uninstall --\u003e GetDeps\n    GetDeps --\u003e PromptDeps\n    PromptDeps --\u003e RemoveFromProfile\n    \n    RemoveFromProfile --\u003e CheckOtherProfiles\n    CheckOtherProfiles --\u003e|\"Not used elsewhere\"| MarkForDeletion\n    CheckOtherProfiles --\u003e|\"Used in other profile\"| FireEvents\n    \n    MarkForDeletion --\u003e ActualDelete\n    ActualDelete --\u003e ReportStats\n    ReportStats --\u003e FireEvents\n    FireEvents --\u003e InvalidateCache\n    \n    CleanUp --\u003e ActualDelete\n```\n\n**Dependency Checking**: Before uninstallation, the system checks if other installed extensions depend on the extension being removed. If dependencies exist, the user is prompted to uninstall them as well.\n\n**Profile Management**: Extensions are removed from the current profile's manifest. If the extension is still referenced by other profiles, the files are retained; otherwise, they're deleted.\n\n**Delayed Deletion**: Extension directories are marked for deletion (renamed with `.vsctmp` suffix) and deleted asynchronously during cleanup. This prevents file-locking issues.\n\n**Telemetry**: Uninstall statistics are reported to the marketplace (if the extension was from the gallery) to help publishers understand user behavior.\n\nSources: [src/vs/platform/extensionManagement/common/abstractExtensionManagementService.ts:550-750](), [src/vs/platform/extensionManagement/node/extensionManagementService.ts:220-242]()\n\n## Extension Actions\n\nThe UI layer provides numerous actions for managing extensions, organized into several key action classes:\n\n| Action Class | Purpose | Key Methods |\n|---|---|---|\n| `InstallAction` | Install an extension | `run()`, `computeAndUpdateEnablement()` |\n| `UpdateAction` | Update an installed extension | `run()`, checks for `outdated` |\n| `UninstallAction` | Uninstall an extension | `run()` |\n| `EnableDropDownAction` | Enable extension with options | Dropdown with EnableGloballyAction, EnableWorkspaceAction |\n| `DisableDropDownAction` | Disable extension with options | Dropdown with DisableGloballyAction, DisableWorkspaceAction |\n| `InstallAnotherVersionAction` | Install specific version | Shows version picker, installs selected |\n| `TogglePreReleaseExtensionAction` | Switch pre-release/release | Toggles `installPreReleaseVersion` option |\n| `ToggleAutoUpdateForExtensionAction` | Control auto-updates | Checkbox action for per-extension auto-update |\n\nThese actions implement the `ExtensionAction` base class which provides:\n- Automatic `enabled`/`hidden` state management based on extension state\n- Event-driven updates when extension state changes\n- Integration with the workbench's action bar system\n\nSources: [src/vs/workbench/contrib/extensions/browser/extensionsActions.ts:427-1200]()\n\n### Action State Management\n\nActions dynamically update their enabled/hidden state based on extension state:\n\n```typescript\nabstract class ExtensionAction extends Action {\n    private _extension: IExtension | null = null;\n    get extension(): IExtension | null { return this._extension; }\n    set extension(extension: IExtension | null) { \n        this._extension = extension; \n        this.update(); \n    }\n    \n    protected hideOnDisabled: boolean = true;\n    \n    protected _setEnabled(value: boolean): void {\n        super._setEnabled(value);\n        if (this.hideOnDisabled) {\n            this.hidden = !value;\n        }\n    }\n    \n    abstract update(): void;\n}\n```\n\nFor example, `InstallAction` computes its enabled state based on whether the extension is uninstalled, not builtin, installable, and passes permission checks.\n\nSources: [src/vs/workbench/contrib/extensions/browser/extensionsActions.ts:285-318]()\n\n### Button with Dropdown Actions\n\nSeveral actions use a dropdown pattern to provide multiple related options:\n\n```mermaid\ngraph LR\n    ButtonAction[\"ButtonWithDropDownExtensionAction\"]\n    \n    subgraph \"Action Groups\"\n        PrimaryGroup[\"Primary Action Group\"]\n        SecondaryGroup[\"Secondary Action Groups\"]\n    end\n    \n    subgraph \"Rendering\"\n        Primary[\"Primary action (first visible)\"]\n        Dropdown[\"Dropdown menu (if \u003e1 visible)\"]\n    end\n    \n    ButtonAction --\u003e PrimaryGroup\n    ButtonAction --\u003e SecondaryGroup\n    \n    PrimaryGroup --\u003e Primary\n    SecondaryGroup --\u003e Dropdown\n    \n    Primary --\u003e|\"click\"| Execute[\"Execute primary action\"]\n    Dropdown --\u003e|\"select\"| ExecuteSelected[\"Execute selected action\"]\n```\n\nThe `ButtonWithDropDownExtensionAction` aggregates multiple actions and displays the first visible one as the primary button. If multiple actions are visible, a dropdown menu is shown with all options.\n\nSources: [src/vs/workbench/contrib/extensions/browser/extensionsActions.ts:320-393]()\n\n## Extension Recommendations\n\nThe `ExtensionsWorkbenchService` integrates with the `IExtensionRecommendationsService` to provide intelligent extension suggestions:\n\n```mermaid\ngraph TB\n    subgraph \"Recommendation Types\"\n        Workspace[\"Workspace Recommendations\u003cbr/\u003e(from .vscode/extensions.json)\"]\n        FileType[\"File-based Recommendations\u003cbr/\u003e(based on opened files)\"]\n        Executable[\"Executable-based\u003cbr/\u003e(based on installed programs)\"]\n        Dynamic[\"Dynamic Recommendations\u003cbr/\u003e(from marketplace)\"]\n    end\n    \n    subgraph \"Recommendation Reasons\"\n        WorkspaceReason[\"ExtensionRecommendationReason.Workspace\"]\n        FileReason[\"ExtensionRecommendationReason.File\"]\n        ExeReason[\"ExtensionRecommendationReason.Executable\"]\n        DynamicReason[\"ExtensionRecommendationReason.DynamicWorkspace\"]\n    end\n    \n    subgraph \"Integration\"\n        GetRecs[\"extensionRecommendationsService.getAllRecommendationsWithReason()\"]\n        IgnoredService[\"IExtensionIgnoredRecommendationsService\"]\n        Filter[\"Filter out ignored recommendations\"]\n    end\n    \n    subgraph \"UI Display\"\n        RecommendedView[\"Recommended Extensions View\"]\n        Badges[\"Recommendation badges on extensions\"]\n        Notifications[\"Recommendation notifications\"]\n    end\n    \n    Workspace --\u003e WorkspaceReason\n    FileType --\u003e FileReason\n    Executable --\u003e ExeReason\n    Dynamic --\u003e DynamicReason\n    \n    GetRecs --\u003e Filter\n    Filter --\u003e RecommendedView\n    Filter --\u003e Badges\n    Filter --\u003e Notifications\n    \n    IgnoredService --\u003e Filter\n```\n\nUsers can ignore recommendations through the `IExtensionIgnoredRecommendationsService`, which persists ignored extension IDs. The UI reflects recommendation status through badges, dedicated views, and periodic prompts.\n\nSources: [src/vs/workbench/contrib/extensions/browser/extensionsWorkbenchService.ts:1200-1400]()\n\n## Extension Metadata and Profiles\n\nVS Code supports user data profiles, allowing different sets of extensions per profile. Extension metadata tracks which profiles an extension is installed in.\n\n```mermaid\ngraph TB\n    subgraph \"Metadata Structure\"\n        Metadata[\"Metadata\"]\n        GalleryMeta[\"IGalleryMetadata\u003cbr/\u003e(id, publisherId, isPreReleaseVersion, etc)\"]\n        ProfileMeta[\"Profile Metadata\u003cbr/\u003e(isApplicationScoped, isMachineScoped, pinned)\"]\n        InstallMeta[\"Installation Metadata\u003cbr/\u003e(installedTimestamp, source, size)\"]\n    end\n    \n    subgraph \"Profile Management\"\n        ProfileScanner[\"IExtensionsProfileScannerService\"]\n        AddToProfile[\"addExtensionsToProfile(extensions, profileLocation)\"]\n        RemoveFromProfile[\"removeExtensionFromProfile(identifier, profileLocation)\"]\n        CopyProfile[\"copyExtensions(fromProfile, toProfile)\"]\n    end\n    \n    subgraph \"Metadata Storage\"\n        ManifestFile[\"extensions.json in profile directory\"]\n        MetadataWrite[\"scanMetadata() / updateMetadata()\"]\n        Cache[\"ExtensionsManifestCache\"]\n    end\n    \n    Metadata --\u003e GalleryMeta\n    Metadata --\u003e ProfileMeta\n    Metadata --\u003e InstallMeta\n    \n    ProfileScanner --\u003e AddToProfile\n    ProfileScanner --\u003e RemoveFromProfile\n    ProfileScanner --\u003e CopyProfile\n    \n    AddToProfile --\u003e MetadataWrite\n    MetadataWrite --\u003e ManifestFile\n    ManifestFile --\u003e Cache\n```\n\n**Metadata Fields**:\n- `id`, `publisherId`: Gallery identifiers\n- `isPreReleaseVersion`, `hasPreReleaseVersion`: Pre-release tracking\n- `installedTimestamp`: When the extension was installed\n- `pinned`: Whether auto-update is disabled\n- `isApplicationScoped`, `isMachineScoped`: Scope flags\n- `source`: Installation source (gallery, vsix, resource)\n\n**Profile Operations**: Extensions can be installed to specific profiles, copied between profiles, or removed from profiles without deleting the files (if used elsewhere).\n\nSources: [src/vs/platform/extensionManagement/node/extensionManagementService.ts:197-238](), [src/vs/platform/extensionManagement/common/extensionsProfileScannerService.ts]()\n\n## Extension Auto-Update\n\nThe `ExtensionsWorkbenchService` implements automatic extension updates based on user preferences:\n\n```typescript\nexport const enum AutoUpdateConfigurationValue {\n    Enabled = true,\n    OnlyEnabledExtensions = 'onlyEnabledExtensions',\n    Disabled = false\n}\n\nexport const AutoUpdateConfigurationKey = 'extensions.autoUpdate';\nexport const AutoCheckUpdatesConfigurationKey = 'extensions.autoCheckUpdates';\n```\n\n```mermaid\ngraph TB\n    subgraph \"Auto-Update Flow\"\n        CheckUpdates[\"checkForUpdates()\"]\n        SyncWithGallery[\"syncInstalledExtensionsWithGallery()\"]\n        GetOutdated[\"Filter extensions where outdated === true\"]\n        CheckConfig[\"Check AutoUpdateConfigurationKey\"]\n    end\n    \n    subgraph \"Update Logic\"\n        Config[\"AutoUpdateConfigurationValue\"]\n        All[\"Enabled: Update all\"]\n        OnlyEnabled[\"OnlyEnabledExtensions: Update only enabled\"]\n        Disabled[\"Disabled: No auto-update\"]\n    end\n    \n    subgraph \"Installation\"\n        InstallExt[\"install(extension, installOptions)\"]\n        SetOperation[\"operation: InstallOperation.Update\"]\n        UpdateUI[\"Update extension state to Installing\"]\n    end\n    \n    CheckUpdates --\u003e SyncWithGallery\n    SyncWithGallery --\u003e GetOutdated\n    GetOutdated --\u003e CheckConfig\n    \n    CheckConfig --\u003e Config\n    Config --\u003e All\n    Config --\u003e OnlyEnabled\n    Config --\u003e Disabled\n    \n    All --\u003e InstallExt\n    OnlyEnabled --\u003e InstallExt\n    InstallExt --\u003e SetOperation\n    SetOperation --\u003e UpdateUI\n```\n\n**Check for Updates**: Periodically (or manually via command), the service syncs installed extensions with the gallery to identify outdated extensions.\n\n**Auto-Update Configuration**:\n- `true`: Update all extensions automatically\n- `'onlyEnabledExtensions'`: Only update enabled extensions\n- `false`: No automatic updates (manual only)\n\n**Per-Extension Control**: Users can pin individual extensions to prevent auto-updates via the `ToggleAutoUpdateForExtensionAction`.\n\nSources: [src/vs/workbench/contrib/extensions/browser/extensionsWorkbenchService.ts:800-1000](), [src/vs/workbench/contrib/extensions/common/extensions.ts:150-200]()\n\n## Extension Management UI Components\n\nThe extension management UI is built from several composable widgets and actions:\n\n| Component | File | Purpose |\n|---|---|---|\n| `ExtensionEditor` | extensionEditor.ts | Full-page extension details view |\n| `ExtensionsListView` | extensionsViews.ts | List of extensions with filtering |\n| `ExtensionsList` | extensionsList.ts | List rendering and templates |\n| `ExtensionWidget` | extensionsWidgets.ts | Reusable UI widgets (badges, ratings, etc) |\n| Various actions | extensionsActions.ts | Install, update, enable, disable, etc |\n\n**ExtensionEditor**: Displays comprehensive extension information including README, changelog, features, dependencies, and runtime status. Uses tabs for different content sections.\n\n**ExtensionsListView**: Provides filtered views of extensions (installed, recommended, outdated, etc.) with search and sorting capabilities.\n\n**Widgets**: Reusable components like `RatingsWidget`, `InstallCountWidget`, `RecommendationWidget`, `RemoteBadgeWidget`, etc., that display specific extension properties.\n\nSources: [src/vs/workbench/contrib/extensions/browser/extensionEditor.ts:209-600](), [src/vs/workbench/contrib/extensions/browser/extensionsViews.ts:112-400](), [src/vs/workbench/contrib/extensions/browser/extensionsWidgets.ts:1-500]()\n\n### Extension Editor Architecture\n\n```mermaid\ngraph TB\n    subgraph \"Editor Structure\"\n        ExtEditor[\"ExtensionEditor\u003cbr/\u003e(EditorPane)\"]\n        Template[\"IExtensionEditorTemplate\"]\n        Navbar[\"NavBar (tabs)\"]\n        Content[\"Content area (webviews/widgets)\"]\n    end\n    \n    subgraph \"Tabs\"\n        Readme[\"Readme (webview)\"]\n        Features[\"Features (tree)\"]\n        Changelog[\"Changelog (webview)\"]\n        ExtPack[\"Extension Pack (list)\"]\n        Dependencies[\"Dependencies (list)\"]\n    end\n    \n    subgraph \"Actions\"\n        ActionBar[\"ActionBar with extension actions\"]\n        StatusWidget[\"ExtensionStatusWidget\"]\n        RecommendationWidget[\"ExtensionRecommendationWidget\"]\n    end\n    \n    subgraph \"Data Sources\"\n        ReadmeCache[\"extensionReadme: Cache\u003cstring\u003e\"]\n        ChangelogCache[\"extensionChangelog: Cache\u003cstring\u003e\"]\n        ManifestCache[\"extensionManifest: Cache\u003cIExtensionManifest\u003e\"]\n    end\n    \n    ExtEditor --\u003e Template\n    Template --\u003e Navbar\n    Template --\u003e Content\n    Template --\u003e ActionBar\n    \n    Navbar --\u003e Readme\n    Navbar --\u003e Features\n    Navbar --\u003e Changelog\n    Navbar --\u003e ExtPack\n    Navbar --\u003e Dependencies\n    \n    ExtEditor --\u003e ReadmeCache\n    ExtEditor --\u003e ChangelogCache\n    ExtEditor --\u003e ManifestCache\n    \n    ActionBar --\u003e StatusWidget\n    ActionBar --\u003e RecommendationWidget\n```\n\nThe editor uses `Cache` instances to lazily load README, changelog, and manifest data from either the local extension or the gallery. Content is rendered in webviews (for markdown) or custom widgets.\n\nSources: [src/vs/workbench/contrib/extensions/browser/extensionEditor.ts:209-700]()\n\n## Allowed Extensions Service\n\nThe `IAllowedExtensionsService` enforces policies on which extensions can be installed:\n\n```mermaid\ngraph TB\n    subgraph \"Service Interface\"\n        IsAllowed[\"isAllowed(extensionInfo)\"]\n        OnChange[\"onDidChangeAllowedExtensionsConfigValue\"]\n    end\n    \n    subgraph \"Configuration\"\n        ConfigKey[\"AllowedExtensionsConfigKey\"]\n        AllowedList[\"List of allowed extension patterns\"]\n        DisallowedList[\"List of disallowed extension patterns\"]\n    end\n    \n    subgraph \"Result\"\n        Allowed[\"true (allowed)\"]\n        Disallowed[\"{value: string} (reason not allowed)\"]\n    end\n    \n    IsAllowed --\u003e ConfigKey\n    ConfigKey --\u003e AllowedList\n    ConfigKey --\u003e DisallowedList\n    \n    AllowedList --\u003e Allowed\n    DisallowedList --\u003e Disallowed\n    \n    OnChange --\u003e ConfigKey\n```\n\nThe service checks extension IDs against allow/deny lists configured through settings or policy. If an extension is not allowed, installation is blocked with a message explaining why.\n\nThis is used in enterprise environments to restrict which extensions can be installed for security or compliance reasons.\n\nSources: [src/vs/platform/extensionManagement/common/extensionManagement.ts:565-590]()"])</script><script>self.__next_f.push([1,"30:T9b92,"])</script><script>self.__next_f.push([1,"# Extension Management UI\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [src/vs/platform/extensionManagement/common/abstractExtensionManagementService.ts](src/vs/platform/extensionManagement/common/abstractExtensionManagementService.ts)\n- [src/vs/platform/extensionManagement/common/extensionGalleryService.ts](src/vs/platform/extensionManagement/common/extensionGalleryService.ts)\n- [src/vs/platform/extensionManagement/common/extensionManagement.ts](src/vs/platform/extensionManagement/common/extensionManagement.ts)\n- [src/vs/platform/extensionManagement/common/extensionManagementIpc.ts](src/vs/platform/extensionManagement/common/extensionManagementIpc.ts)\n- [src/vs/platform/extensionManagement/common/extensionManagementUtil.ts](src/vs/platform/extensionManagement/common/extensionManagementUtil.ts)\n- [src/vs/platform/extensionManagement/node/extensionDownloader.ts](src/vs/platform/extensionManagement/node/extensionDownloader.ts)\n- [src/vs/platform/extensionManagement/node/extensionManagementService.ts](src/vs/platform/extensionManagement/node/extensionManagementService.ts)\n- [src/vs/platform/extensionManagement/node/extensionSignatureVerificationService.ts](src/vs/platform/extensionManagement/node/extensionSignatureVerificationService.ts)\n- [src/vs/platform/extensionManagement/test/node/extensionDownloader.test.ts](src/vs/platform/extensionManagement/test/node/extensionDownloader.test.ts)\n- [src/vs/platform/sign/browser/signService.ts](src/vs/platform/sign/browser/signService.ts)\n- [src/vs/platform/sign/common/abstractSignService.ts](src/vs/platform/sign/common/abstractSignService.ts)\n- [src/vs/platform/sign/common/sign.ts](src/vs/platform/sign/common/sign.ts)\n- [src/vs/platform/sign/node/signService.ts](src/vs/platform/sign/node/signService.ts)\n- [src/vs/platform/telemetry/browser/1dsAppender.ts](src/vs/platform/telemetry/browser/1dsAppender.ts)\n- [src/vs/platform/telemetry/common/1dsAppender.ts](src/vs/platform/telemetry/common/1dsAppender.ts)\n- [src/vs/platform/telemetry/node/1dsAppender.ts](src/vs/platform/telemetry/node/1dsAppender.ts)\n- [src/vs/platform/telemetry/test/browser/1dsAppender.test.ts](src/vs/platform/telemetry/test/browser/1dsAppender.test.ts)\n- [src/vs/workbench/contrib/extensions/browser/extensionEditor.ts](src/vs/workbench/contrib/extensions/browser/extensionEditor.ts)\n- [src/vs/workbench/contrib/extensions/browser/extensions.contribution.ts](src/vs/workbench/contrib/extensions/browser/extensions.contribution.ts)\n- [src/vs/workbench/contrib/extensions/browser/extensionsActions.ts](src/vs/workbench/contrib/extensions/browser/extensionsActions.ts)\n- [src/vs/workbench/contrib/extensions/browser/extensionsIcons.ts](src/vs/workbench/contrib/extensions/browser/extensionsIcons.ts)\n- [src/vs/workbench/contrib/extensions/browser/extensionsList.ts](src/vs/workbench/contrib/extensions/browser/extensionsList.ts)\n- [src/vs/workbench/contrib/extensions/browser/extensionsViewer.ts](src/vs/workbench/contrib/extensions/browser/extensionsViewer.ts)\n- [src/vs/workbench/contrib/extensions/browser/extensionsViewlet.ts](src/vs/workbench/contrib/extensions/browser/extensionsViewlet.ts)\n- [src/vs/workbench/contrib/extensions/browser/extensionsViews.ts](src/vs/workbench/contrib/extensions/browser/extensionsViews.ts)\n- [src/vs/workbench/contrib/extensions/browser/extensionsWidgets.ts](src/vs/workbench/contrib/extensions/browser/extensionsWidgets.ts)\n- [src/vs/workbench/contrib/extensions/browser/extensionsWorkbenchService.ts](src/vs/workbench/contrib/extensions/browser/extensionsWorkbenchService.ts)\n- [src/vs/workbench/contrib/extensions/browser/media/extension.css](src/vs/workbench/contrib/extensions/browser/media/extension.css)\n- [src/vs/workbench/contrib/extensions/browser/media/extensionActions.css](src/vs/workbench/contrib/extensions/browser/media/extensionActions.css)\n- [src/vs/workbench/contrib/extensions/browser/media/extensionEditor.css](src/vs/workbench/contrib/extensions/browser/media/extensionEditor.css)\n- [src/vs/workbench/contrib/extensions/browser/media/extensionsViewlet.css](src/vs/workbench/contrib/extensions/browser/media/extensionsViewlet.css)\n- [src/vs/workbench/contrib/extensions/browser/media/extensionsWidgets.css](src/vs/workbench/contrib/extensions/browser/media/extensionsWidgets.css)\n- [src/vs/workbench/contrib/extensions/common/extensions.ts](src/vs/workbench/contrib/extensions/common/extensions.ts)\n- [src/vs/workbench/services/extensionManagement/common/extensionManagement.ts](src/vs/workbench/services/extensionManagement/common/extensionManagement.ts)\n- [src/vs/workbench/services/extensionManagement/common/extensionManagementChannelClient.ts](src/vs/workbench/services/extensionManagement/common/extensionManagementChannelClient.ts)\n- [src/vs/workbench/services/extensionManagement/common/extensionManagementService.ts](src/vs/workbench/services/extensionManagement/common/extensionManagementService.ts)\n- [src/vs/workbench/services/extensionManagement/common/webExtensionManagementService.ts](src/vs/workbench/services/extensionManagement/common/webExtensionManagementService.ts)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis document describes the user interface components and architecture for managing extensions in VS Code. It covers the Extensions viewlet, extension editor, search functionality, list rendering, and UI widgets. For information about the underlying extension management service layer and marketplace integration, see [Extension Management and Marketplace](#5.4). For details about the extension host and API surface, see [Extension Host Architecture and RPC Protocol](#5.1).\n\nThe Extension Management UI provides users with the ability to discover, install, configure, and manage extensions through various visual components including list views, detail editors, and action buttons.\n\n---\n\n## Architecture Overview\n\nThe Extension Management UI follows a layered architecture with clear separation between view containers, individual views, renderers, and actions.\n\n**High-Level Component Architecture**\n\n```mermaid\ngraph TB\n    ExtensionsViewPaneContainer[\"ExtensionsViewPaneContainer\"]\n    ExtensionEditor[\"ExtensionEditor\"]\n    \n    subgraph \"View Layer\"\n        ExtensionsListView[\"ExtensionsListView\"]\n        RecommendedExtensionsView[\"RecommendedExtensionsView\"]\n        InstalledExtensionsView[\"EnabledExtensionsView\u003cbr/\u003eDisabledExtensionsView\"]\n        MarketplaceView[\"SearchMarketplaceExtensionsView\"]\n    end\n    \n    subgraph \"Rendering Layer\"\n        Renderer[\"Renderer\"]\n        Delegate[\"Delegate\"]\n        ExtensionsList[\"ExtensionsList\"]\n    end\n    \n    subgraph \"Widget Layer\"\n        ExtensionWidgets[\"ExtensionIconWidget\u003cbr/\u003eRatingsWidget\u003cbr/\u003eInstallCountWidget\u003cbr/\u003ePublisherWidget\"]\n    end\n    \n    subgraph \"Action Layer\"\n        ExtensionActions[\"InstallAction\u003cbr/\u003eUpdateAction\u003cbr/\u003eUninstallAction\u003cbr/\u003eEnableDropDownAction\"]\n    end\n    \n    ExtensionsViewPaneContainer --\u003e ExtensionsListView\n    ExtensionsViewPaneContainer --\u003e RecommendedExtensionsView\n    ExtensionsViewPaneContainer --\u003e InstalledExtensionsView\n    ExtensionsViewPaneContainer --\u003e MarketplaceView\n    \n    ExtensionsListView --\u003e Renderer\n    Renderer --\u003e Delegate\n    Renderer --\u003e ExtensionsList\n    \n    ExtensionsListView --\u003e ExtensionWidgets\n    ExtensionEditor --\u003e ExtensionWidgets\n    \n    ExtensionsListView --\u003e ExtensionActions\n    ExtensionEditor --\u003e ExtensionActions\n    \n    ExtensionsWorkbenchService[\"IExtensionsWorkbenchService\"]\n    ExtensionsListView --\u003e ExtensionsWorkbenchService\n    ExtensionEditor --\u003e ExtensionsWorkbenchService\n```\n\nSources: [src/vs/workbench/contrib/extensions/browser/extensionsViewlet.ts:1-1000](), [src/vs/workbench/contrib/extensions/browser/extensionEditor.ts:1-300](), [src/vs/workbench/contrib/extensions/browser/extensionsList.ts:1-200]()\n\n---\n\n## Extensions Viewlet Container\n\nThe `ExtensionsViewPaneContainer` is the main container for the Extensions viewlet (accessible via `Ctrl+Shift+X`). It manages the search input, view registration, and coordination between different extension views.\n\n**ExtensionsViewPaneContainer Structure**\n\n```mermaid\ngraph TB\n    EVPC[\"ExtensionsViewPaneContainer\"]\n    SearchBox[\"SuggestEnabledInput\u003cbr/\u003e(search box)\"]\n    SearchActionsMenu[\"MenuWorkbenchToolBar\u003cbr/\u003e(filter actions)\"]\n    ViewRegistry[\"IViewDescriptorService\"]\n    \n    EVPC --\u003e SearchBox\n    EVPC --\u003e SearchActionsMenu\n    EVPC --\u003e ViewRegistry\n    \n    subgraph \"Dynamic Views\"\n        DefaultView[\"Default/Popular View\"]\n        InstalledView[\"Installed Extensions\"]\n        RecommendedView[\"Recommended Extensions\"]\n        MarketplaceView[\"Marketplace Search\"]\n        OutdatedView[\"Outdated Extensions\"]\n    end\n    \n    EVPC --\u003e DefaultView\n    EVPC --\u003e InstalledView\n    EVPC --\u003e RecommendedView\n    EVPC --\u003e MarketplaceView\n    EVPC --\u003e OutdatedView\n    \n    ContextKeys[\"Context Keys:\u003cbr/\u003eSearchMarketplaceExtensionsContext\u003cbr/\u003eSearchHasTextContext\u003cbr/\u003eBuiltInExtensionsContext\"]\n    \n    EVPC --\u003e ContextKeys\n```\n\nThe container implements search functionality with autocomplete support for extension categories and commands:\n\n- **Search Input**: Uses `SuggestEnabledInput` with completions for `@category`, `@builtin`, `@installed`, `@recommended`, etc.\n- **Context-Aware Views**: Different views are shown/hidden based on search context and query type\n- **Search Actions Toolbar**: Provides filtering options (sort by, clear search, etc.)\n\nKey implementation details:\n- Search query is parsed by `Query` class to determine which views to show [src/vs/workbench/contrib/extensions/common/extensionQuery.ts]()\n- Context keys control view visibility via `when` clauses [src/vs/workbench/contrib/extensions/browser/extensionsViewlet.ts:74-92]()\n- Search state is persisted in storage and synchronized across window reloads\n\nSources: [src/vs/workbench/contrib/extensions/browser/extensionsViewlet.ts:600-900](), [src/vs/workbench/contrib/extensions/common/extensionQuery.ts]()\n\n---\n\n## Extension Views\n\nExtension views display filtered lists of extensions based on different criteria. Each view extends `ExtensionsListView` and provides its own query logic.\n\n**View Type Hierarchy**\n\n```mermaid\ngraph TB\n    ViewPane[\"ViewPane\"]\n    AbstractExtensionsListView[\"AbstractExtensionsListView\"]\n    ExtensionsListView[\"ExtensionsListView\"]\n    \n    ViewPane --\u003e AbstractExtensionsListView\n    AbstractExtensionsListView --\u003e ExtensionsListView\n    \n    subgraph \"Concrete Views\"\n        EnabledExtensionsView[\"EnabledExtensionsView\"]\n        DisabledExtensionsView[\"DisabledExtensionsView\"]\n        RecommendedExtensionsView[\"RecommendedExtensionsView\"]\n        WorkspaceRecommendedExtensionsView[\"WorkspaceRecommendedExtensionsView\"]\n        SearchMarketplaceExtensionsView[\"SearchMarketplaceExtensionsView\"]\n        DefaultPopularExtensionsView[\"DefaultPopularExtensionsView\"]\n        OutdatedExtensionsView[\"OutdatedExtensionsView\"]\n        DeprecatedExtensionsView[\"DeprecatedExtensionsView\"]\n    end\n    \n    ExtensionsListView --\u003e EnabledExtensionsView\n    ExtensionsListView --\u003e DisabledExtensionsView\n    ExtensionsListView --\u003e RecommendedExtensionsView\n    ExtensionsListView --\u003e WorkspaceRecommendedExtensionsView\n    ExtensionsListView --\u003e SearchMarketplaceExtensionsView\n    ExtensionsListView --\u003e DefaultPopularExtensionsView\n    ExtensionsListView --\u003e OutdatedExtensionsView\n    ExtensionsListView --\u003e DeprecatedExtensionsView\n```\n\n### ExtensionsListView Base Class\n\nThe `ExtensionsListView` provides common functionality for all extension list views:\n\n| Feature | Description | Implementation |\n|---------|-------------|----------------|\n| **List Component** | `WorkbenchPagedList\u003cIExtension\u003e` for rendering extensions | [extensionsViews.ts:120-128]() |\n| **Query Execution** | Executes queries via `IExtensionsWorkbenchService` | [extensionsViews.ts:300-400]() |\n| **Badge Display** | Shows count badge when `hideBadge` option is false | [extensionsViews.ts:180-200]() |\n| **Context Menu** | Provides extension-specific actions | [extensionsViews.ts:500-600]() |\n| **Focus Management** | Tracks focused extensions via `ExtensionsViewState` | [extensionsViews.ts:64-83]() |\n\n### Key View Types\n\n**Installed Extensions Views**\n- `EnabledExtensionsView`: Shows enabled extensions with query `@enabled`\n- `DisabledExtensionsView`: Shows disabled extensions with query `@disabled`\n- `OutdatedExtensionsView`: Shows extensions with available updates using `@updates` or `@outdated`\n\n**Recommendation Views**\n- `RecommendedExtensionsView`: General recommendations based on `@recommended` query\n- `WorkspaceRecommendedExtensionsView`: Workspace-specific recommendations from `.vscode/extensions.json`\n- Implements `IWorkspaceRecommendedExtensionsView` interface with `installWorkspaceRecommendations()` method\n\n**Marketplace Views**\n- `SearchMarketplaceExtensionsView`: Full marketplace search results\n- `DefaultPopularExtensionsView`: Popular extensions shown by default\n- Uses `IExtensionGalleryService` to query the marketplace\n\nSources: [src/vs/workbench/contrib/extensions/browser/extensionsViews.ts:112-1000](), [src/vs/workbench/contrib/extensions/browser/extensionsViewlet.ts:168-300]()\n\n---\n\n## Extension Editor\n\nThe `ExtensionEditor` provides a detailed view of a single extension with tabs for documentation, features, changelog, and dependencies.\n\n**Extension Editor Layout**\n\n```mermaid\ngraph TB\n    ExtensionEditor[\"ExtensionEditor\"]\n    \n    subgraph \"Header Section\"\n        IconWidget[\"ExtensionIconWidget\u003cbr/\u003eRemoteBadgeWidget\"]\n        TitleArea[\"Name + Version\u003cbr/\u003eVersionWidget\u003cbr/\u003ePreview/Builtin badges\"]\n        Subtitle[\"PublisherWidget\u003cbr/\u003eInstallCountWidget\u003cbr/\u003eRatingsWidget\u003cbr/\u003eSponsorWidget\"]\n        Description[\"Extension description\"]\n        ActionBar[\"ActionBar with\u003cbr/\u003eInstallAction/UpdateAction/\u003cbr/\u003eUninstallAction/EnableAction\"]\n    end\n    \n    subgraph \"Navigation Bar\"\n        NavBar[\"NavBar\"]\n        DetailsTab[\"Details Tab\"]\n        FeaturesTab[\"Features Tab\"]\n        ChangelogTab[\"Changelog Tab\"]\n        DependenciesTab[\"Dependencies Tab\"]\n    end\n    \n    subgraph \"Content Area\"\n        Webview[\"IWebview\u003cbr/\u003e(for Readme/Changelog)\"]\n        FeaturesTree[\"ExtensionFeaturesTab\u003cbr/\u003e(shows contributions)\"]\n        DependencyTree[\"ExtensionsTree\u003cbr/\u003e(shows dependencies)\"]\n    end\n    \n    ExtensionEditor --\u003e IconWidget\n    ExtensionEditor --\u003e TitleArea\n    ExtensionEditor --\u003e Subtitle\n    ExtensionEditor --\u003e Description\n    ExtensionEditor --\u003e ActionBar\n    \n    ExtensionEditor --\u003e NavBar\n    NavBar --\u003e DetailsTab\n    NavBar --\u003e FeaturesTab\n    NavBar --\u003e ChangelogTab\n    NavBar --\u003e DependenciesTab\n    \n    DetailsTab --\u003e Webview\n    FeaturesTab --\u003e FeaturesTree\n    ChangelogTab --\u003e Webview\n    DependenciesTab --\u003e DependencyTree\n```\n\n### Editor Implementation Details\n\nThe editor uses `ExtensionsInput` as its input type and supports options for:\n- Pre-release version display via `showPreReleaseVersion` option\n- Tab selection via `tab` option\n- Focus preservation via `preserveFocus` option\n\n**Key Components**:\n\n| Component | Class | Purpose |\n|-----------|-------|---------|\n| Icon Display | `ExtensionIconWidget` | Shows extension icon with remote/web badges |\n| Version Widget | `VersionWidget` | Displays \"pre-release\" tag for pre-release versions |\n| Action Bar | `ActionBar` | Contains install/update/uninstall/enable actions |\n| Navigation | `NavBar` | Tab navigation between details/features/changelog/dependencies |\n| Content | `IWebview` | Renders markdown content for readme and changelog |\n\nThe editor creates different actions based on extension state:\n\n```mermaid\ngraph LR\n    ExtensionState{\"Extension State\"}\n    \n    ExtensionState --\u003e|\"Uninstalled\"| InstallDropdownAction\n    ExtensionState --\u003e|\"Installed + Outdated\"| UpdateAction\n    ExtensionState --\u003e|\"Installed\"| UninstallAction\n    ExtensionState --\u003e|\"Installing\"| InstallingLabelAction\n    ExtensionState --\u003e|\"Any\"| EnableDropDownAction\n    \n    InstallDropdownAction[\"InstallDropdownAction\u003cbr/\u003e(Install/Install Pre-Release)\"]\n    UpdateAction[\"UpdateAction\"]\n    UninstallAction[\"ButtonWithDropDownExtensionAction\u003cbr/\u003e+ InstallAnotherVersionAction\"]\n    InstallingLabelAction[\"InstallingLabelAction\"]\n    EnableDropDownAction[\"EnableDropDownAction/\u003cbr/\u003eDisableDropDownAction\"]\n```\n\n### Webview Content\n\nThe editor uses webviews to render extension documentation:\n- **Readme Tab**: Fetches from `extension.getReadme()` or `galleryService.getReadme()`\n- **Changelog Tab**: Fetches from `extension.getChangelog()` or `galleryService.getChangelog()`\n- Content is rendered as markdown using `renderMarkdownDocument()`\n- Scroll position is tracked and restored per tab [src/vs/workbench/contrib/extensions/browser/extensionEditor.ts:220-225]()\n\nSources: [src/vs/workbench/contrib/extensions/browser/extensionEditor.ts:209-700](), [src/vs/workbench/contrib/extensions/browser/extensionsWidgets.ts:1-500]()\n\n---\n\n## Extension List Rendering\n\nExtension lists use a paged rendering approach with the `WorkbenchPagedList` component and custom renderers.\n\n**Rendering Pipeline**\n\n```mermaid\ngraph LR\n    IExtension[\"IExtension[]\u003cbr/\u003e(data model)\"]\n    PagedModel[\"IPagedModel\u0026lt;IExtension\u0026gt;\"]\n    WorkbenchPagedList[\"WorkbenchPagedList\u0026lt;IExtension\u0026gt;\"]\n    \n    Delegate[\"Delegate\u003cbr/\u003e(height: 72px)\"]\n    Renderer[\"Renderer\u003cbr/\u003e(template rendering)\"]\n    ITemplateData[\"ITemplateData\u003cbr/\u003e(cached DOM elements)\"]\n    \n    IExtension --\u003e PagedModel\n    PagedModel --\u003e WorkbenchPagedList\n    \n    WorkbenchPagedList --\u003e Delegate\n    WorkbenchPagedList --\u003e Renderer\n    Renderer --\u003e ITemplateData\n    \n    ITemplateData --\u003e ExtensionWidgets[\"Extension Widgets\"]\n    ITemplateData --\u003e ExtensionActions[\"Action Bar\"]\n```\n\n### Template Structure\n\nThe `Renderer` creates a template with the following structure:\n\n```typescript\ninterface ITemplateData {\n    root: HTMLElement;              // Container element\n    element: HTMLElement;           // Main extension row\n    name: HTMLElement;              // Extension name\n    description: HTMLElement;       // Short description\n    installCount: HTMLElement;      // Install count container\n    ratings: HTMLElement;           // Ratings container\n    extension: IExtension | null;   // Current extension\n    disposables: IDisposable[];     // General disposables\n    extensionDisposables: IDisposable[]; // Extension-specific disposables\n    actionbar: ActionBar;           // Action buttons\n}\n```\n\n### Widget Integration\n\nEach extension row includes multiple widgets that update based on extension state:\n\n| Widget | Class | Display |\n|--------|-------|---------|\n| Icon | `ExtensionIconWidget` | Extension icon with badges |\n| Name | Direct rendering | Extension display name |\n| Publisher | `PublisherWidget` | Publisher with verification badge |\n| Ratings | `RatingsWidget` | Star rating display |\n| Install Count | `InstallCountWidget` | Download count |\n| Sync Status | `SyncIgnoredWidget` | Settings sync ignore status |\n| Pre-release | `PreReleaseBookmarkWidget` | Pre-release indicator |\n| Remote Badge | `RemoteBadgeWidget` | Remote/web extension badge |\n| Extension Kind | `ExtensionKindIndicatorWidget` | UI/Workspace extension indicator |\n\nAll widgets extend `ExtensionWidget` base class and implement `render()` method that updates based on current extension.\n\n### Action Bar Configuration\n\nThe action bar in each list row shows context-appropriate actions:\n\n```mermaid\ngraph TB\n    ActionBar[\"ActionBar\"]\n    \n    subgraph \"Primary Actions\"\n        InstallDropdown[\"InstallDropdownAction\u003cbr/\u003e(Release/Pre-Release)\"]\n        Update[\"UpdateAction\"]\n        Uninstall[\"UninstallAction\"]\n    end\n    \n    subgraph \"Secondary Actions\"\n        Enable[\"EnableDropDownAction\"]\n        Disable[\"DisableDropDownAction\"]\n        RemoteInstall[\"RemoteInstallAction\"]\n        LocalInstall[\"LocalInstallAction\"]\n    end\n    \n    subgraph \"Status Actions\"\n        InstallingLabel[\"InstallingLabelAction\"]\n        RuntimeState[\"ExtensionRuntimeStateAction\"]\n        StatusLabel[\"ExtensionStatusLabelAction\"]\n    end\n    \n    ActionBar --\u003e InstallDropdown\n    ActionBar --\u003e Update\n    ActionBar --\u003e Uninstall\n    ActionBar --\u003e Enable\n    ActionBar --\u003e Disable\n    ActionBar --\u003e RemoteInstall\n    ActionBar --\u003e LocalInstall\n    ActionBar --\u003e InstallingLabel\n    ActionBar --\u003e RuntimeState\n    ActionBar --\u003e StatusLabel\n```\n\nSources: [src/vs/workbench/contrib/extensions/browser/extensionsList.ts:1-300](), [src/vs/workbench/contrib/extensions/browser/extensionsViewer.ts:1-500]()\n\n---\n\n## Extension Actions\n\nExtension actions are implemented as `ExtensionAction` subclasses that update their visibility, enablement, and label based on extension state.\n\n**Action Class Hierarchy**\n\n```mermaid\ngraph TB\n    Action[\"Action\u003cbr/\u003e(base class)\"]\n    ExtensionAction[\"ExtensionAction\u003cbr/\u003e+ extension property\u003cbr/\u003e+ update() method\"]\n    \n    Action --\u003e ExtensionAction\n    \n    subgraph \"Install Actions\"\n        InstallAction[\"InstallAction\"]\n        InstallDropdownAction[\"InstallDropdownAction\u003cbr/\u003e(Release + Pre-Release)\"]\n        InstallingLabelAction[\"InstallingLabelAction\"]\n    end\n    \n    subgraph \"Update Actions\"\n        UpdateAction[\"UpdateAction\"]\n        InstallAnotherVersionAction[\"InstallAnotherVersionAction\"]\n    end\n    \n    subgraph \"Uninstall Actions\"\n        UninstallAction[\"UninstallAction\"]\n        MigrateDeprecatedExtensionAction[\"MigrateDeprecatedExtensionAction\"]\n    end\n    \n    subgraph \"Enable/Disable Actions\"\n        EnableDropDownAction[\"EnableDropDownAction\"]\n        DisableDropDownAction[\"DisableDropDownAction\"]\n    end\n    \n    subgraph \"Remote Actions\"\n        RemoteInstallAction[\"RemoteInstallAction\"]\n        LocalInstallAction[\"LocalInstallAction\"]\n        WebInstallAction[\"WebInstallAction\"]\n    end\n    \n    subgraph \"Theme Actions\"\n        SetColorThemeAction[\"SetColorThemeAction\"]\n        SetFileIconThemeAction[\"SetFileIconThemeAction\"]\n        SetProductIconThemeAction[\"SetProductIconThemeAction\"]\n    end\n    \n    ExtensionAction --\u003e InstallAction\n    ExtensionAction --\u003e UpdateAction\n    ExtensionAction --\u003e UninstallAction\n    ExtensionAction --\u003e EnableDropDownAction\n    ExtensionAction --\u003e DisableDropDownAction\n    ExtensionAction --\u003e RemoteInstallAction\n    ExtensionAction --\u003e SetColorThemeAction\n    \n    InstallAction --\u003e InstallDropdownAction\n    InstallAction --\u003e InstallingLabelAction\n    UpdateAction --\u003e InstallAnotherVersionAction\n    UninstallAction --\u003e MigrateDeprecatedExtensionAction\n    EnableDropDownAction --\u003e DisableDropDownAction\n    RemoteInstallAction --\u003e LocalInstallAction\n    RemoteInstallAction --\u003e WebInstallAction\n    SetColorThemeAction --\u003e SetFileIconThemeAction\n    SetColorThemeAction --\u003e SetProductIconThemeAction\n```\n\n### Action Update Pattern\n\nAll extension actions follow a reactive update pattern:\n\n1. **Set Extension**: When `extension` property is set, `update()` is called\n2. **State Computation**: Each action computes its visibility and enablement based on extension state\n3. **Event Emission**: Changes trigger `onDidChange` event to update UI\n4. **Dispose on Change**: Previous disposables are cleaned up when extension changes\n\nExample from `InstallAction`:\n\n```typescript\n// Computes enablement asynchronously\nprotected async computeAndUpdateEnablement(): Promise\u003cvoid\u003e {\n    this.enabled = false;\n    this.hidden = true;\n    \n    if (!this.extension) return;\n    if (this.extension.isBuiltin) return;\n    if (this.extension.state !== ExtensionState.Uninstalled) return;\n    \n    this.hidden = false;\n    if (await this.extensionsWorkbenchService.canInstall(this.extension)) {\n        this.enabled = true;\n    }\n}\n```\n\n### Button with Dropdown Pattern\n\nSome actions use a dropdown to show related options:\n\n```mermaid\ngraph LR\n    ButtonWithDropDownExtensionAction[\"ButtonWithDropDownExtensionAction\"]\n    PrimaryAction[\"Primary Action\u003cbr/\u003e(displayed as button)\"]\n    MenuActions[\"Menu Actions[]\u003cbr/\u003e(shown in dropdown)\"]\n    \n    ButtonWithDropDownExtensionAction --\u003e PrimaryAction\n    ButtonWithDropDownExtensionAction --\u003e MenuActions\n    \n    Example1[\"InstallDropdownAction:\u003cbr/\u003ePrimary: Install Release\u003cbr/\u003eMenu: Install Pre-Release\"]\n    Example2[\"UninstallAction:\u003cbr/\u003ePrimary: Uninstall\u003cbr/\u003eMenu: Install Another Version\"]\n    \n    ButtonWithDropDownExtensionAction -.example.-\u003e Example1\n    ButtonWithDropDownExtensionAction -.example.-\u003e Example2\n```\n\nThe `ButtonWithDropDownExtensionAction` aggregates multiple actions and shows the first visible/enabled action as the primary button, with others in a dropdown menu.\n\n### Action Execution Flow\n\n**Install Action Flow**\n\n```mermaid\nsequenceDiagram\n    participant User\n    participant InstallAction\n    participant ExtensionsWorkbenchService\n    participant ExtensionManagementService\n    participant ExtensionGalleryService\n    \n    User-\u003e\u003eInstallAction: Click Install\n    InstallAction-\u003e\u003eInstallAction: Check for deprecation\n    InstallAction-\u003e\u003eInstallAction: Check signature requirements\n    InstallAction-\u003e\u003eExtensionsWorkbenchService: install(extension, options)\n    ExtensionsWorkbenchService-\u003e\u003eExtensionManagementService: installFromGallery(galleryExtension)\n    ExtensionManagementService-\u003e\u003eExtensionGalleryService: download(extension)\n    ExtensionGalleryService--\u003e\u003eExtensionManagementService: vsix location\n    ExtensionManagementService-\u003e\u003eExtensionManagementService: extract and validate\n    ExtensionManagementService--\u003e\u003eExtensionsWorkbenchService: ILocalExtension\n    ExtensionsWorkbenchService-\u003e\u003eInstallAction: Check if theme extension\n    InstallAction-\u003e\u003eInstallAction: Show theme selection if applicable\n```\n\nSources: [src/vs/workbench/contrib/extensions/browser/extensionsActions.ts:427-686](), [src/vs/workbench/contrib/extensions/browser/extensionsActions.ts:79-393]()\n\n---\n\n## Search and Filtering\n\nThe Extensions viewlet provides sophisticated search and filtering capabilities through query parsing and context-based view selection.\n\n**Query Processing Flow**\n\n```mermaid\ngraph TB\n    UserInput[\"User Search Input\"]\n    Query[\"Query.parse()\"]\n    \n    subgraph \"Query Components\"\n        SearchText[\"Text Search\u003cbr/\u003ee.g., 'eslint'\"]\n        Commands[\"@ Commands\u003cbr/\u003e@installed, @builtin,\u003cbr/\u003e@recommended, etc.\"]\n        Filters[\"Filters\u003cbr/\u003ecategory:themes,\u003cbr/\u003etag:snippets\"]\n        SortBy[\"Sort Options\u003cbr/\u003e@sort:installs,\u003cbr/\u003e@sort:rating\"]\n    end\n    \n    UserInput --\u003e Query\n    Query --\u003e SearchText\n    Query --\u003e Commands\n    Query --\u003e Filters\n    Query --\u003e SortBy\n    \n    ContextKeys[\"Context Keys Updated:\u003cbr/\u003eSearchMarketplaceExtensionsContext\u003cbr/\u003eSearchHasTextContext\u003cbr/\u003eBuiltInExtensionsContext\u003cbr/\u003eRecommendedExtensionsContext\"]\n    \n    Query --\u003e ContextKeys\n    \n    ViewVisibility[\"View Visibility Changes\"]\n    ContextKeys --\u003e ViewVisibility\n    \n    ViewExecution[\"View Executes Query\"]\n    ViewVisibility --\u003e ViewExecution\n```\n\n### Supported Query Commands\n\nThe `Query` class parses special commands prefixed with `@`:\n\n| Command | Description | Context Key |\n|---------|-------------|-------------|\n| `@installed` | Shows installed extensions | `SearchInstalledExtensionsContext` |\n| `@builtin` | Shows built-in extensions | `BuiltInExtensionsContext` |\n| `@enabled` | Shows enabled extensions | `SearchEnabledExtensionsContext` |\n| `@disabled` | Shows disabled extensions | `SearchDisabledExtensionsContext` |\n| `@outdated` / `@updates` | Shows extensions with updates | `SearchOutdatedExtensionsContext` |\n| `@recommended` | Shows recommended extensions | `RecommendedExtensionsContext` |\n| `@popular` | Shows popular extensions | N/A |\n| `@deprecated` | Shows deprecated extensions | `SearchDeprecatedExtensionsContext` |\n| `@sort:` | Sorts results (installs, rating, name, etc.) | `ExtensionsSortByContext` |\n| `category:` | Filters by category | N/A |\n| `tag:` | Filters by tag | N/A |\n| `id:` | Searches by extension ID | N/A |\n\n### Query Execution\n\nEach view transforms the parsed query into appropriate API calls:\n\n**Local Query Execution**:\n```typescript\n// For installed/enabled/disabled extensions\nconst installed = await this.extensionsWorkbenchService.queryLocal();\nconst filtered = installed.filter(e =\u003e {\n    // Apply query filters\n    if (query.value) return matchesQuery(e, query.value);\n    if (query.isEnabledQuery) return e.enablementState === EnablementState.EnabledGlobally;\n    return true;\n});\n```\n\n**Marketplace Query Execution**:\n```typescript\n// For marketplace search\nconst options: IQueryOptions = {\n    text: query.value,\n    sortBy: query.sortBy,\n    pageSize: 100\n};\nconst pager = await this.extensionGalleryService.query(options, token);\n```\n\n### Auto-Complete Support\n\nThe search box provides auto-completion via `SuggestEnabledInput`:\n\n```mermaid\ngraph LR\n    SuggestEnabledInput[\"SuggestEnabledInput\"]\n    CompletionProvider[\"ExtensionsCompletionItemsProvider\"]\n    \n    subgraph \"Completion Items\"\n        Commands[\"@ Commands\"]\n        Categories[\"category: values\"]\n        ExtIds[\"extension IDs\"]\n    end\n    \n    SuggestEnabledInput --\u003e CompletionProvider\n    CompletionProvider --\u003e Commands\n    CompletionProvider --\u003e Categories\n    CompletionProvider --\u003e ExtIds\n```\n\nThe `ExtensionsCompletionItemsProvider` suggests:\n- All `@` commands with descriptions\n- Extension categories from `EXTENSION_CATEGORIES`\n- Recently installed extension IDs\n\nSources: [src/vs/workbench/common/extensionQuery.ts](), [src/vs/workbench/contrib/extensions/browser/extensionsViewlet.ts:600-800](), [src/vs/workbench/contrib/extensions/browser/extensionsCompletionItemsProvider.ts]()\n\n---\n\n## Extension Widgets\n\nExtension widgets are reusable UI components that display specific aspects of an extension. All widgets extend `ExtensionWidget` base class.\n\n**Widget Architecture**\n\n```mermaid\ngraph TB\n    ExtensionWidget[\"ExtensionWidget\u003cbr/\u003e(abstract base)\"]\n    \n    subgraph \"Display Widgets\"\n        ExtensionIconWidget[\"ExtensionIconWidget\u003cbr/\u003eShows icon + default icon\"]\n        RatingsWidget[\"RatingsWidget\u003cbr/\u003eStar rating display\"]\n        InstallCountWidget[\"InstallCountWidget\u003cbr/\u003eDownload count\"]\n        PublisherWidget[\"PublisherWidget\u003cbr/\u003ePublisher + verified badge\"]\n        SponsorWidget[\"SponsorWidget\u003cbr/\u003eSponsor link\"]\n        VersionWidget[\"VersionWidget\u003cbr/\u003ePre-release indicator\"]\n    end\n    \n    subgraph \"Badge Widgets\"\n        RemoteBadgeWidget[\"RemoteBadgeWidget\u003cbr/\u003eRemote/Web indicator\"]\n        ExtensionKindIndicatorWidget[\"ExtensionKindIndicatorWidget\u003cbr/\u003eUI/Workspace indicator\"]\n        PreReleaseBookmarkWidget[\"PreReleaseBookmarkWidget\u003cbr/\u003ePre-release bookmark\"]\n        SyncIgnoredWidget[\"SyncIgnoredWidget\u003cbr/\u003eSync ignored indicator\"]\n        ExtensionPackBadgeWidget[\"ExtensionPackBadgeWidget\u003cbr/\u003eExtension pack count\"]\n    end\n    \n    subgraph \"Status Widgets\"\n        ExtensionStatusWidget[\"ExtensionStatusWidget\u003cbr/\u003eShows warnings/errors\"]\n        RecommendationWidget[\"RecommendationWidget\u003cbr/\u003eRecommendation badge\"]\n        ExtensionRuntimeStatusWidget[\"ExtensionRuntimeStatusWidget\u003cbr/\u003eRuntime status\"]\n    end\n    \n    ExtensionWidget --\u003e ExtensionIconWidget\n    ExtensionWidget --\u003e RatingsWidget\n    ExtensionWidget --\u003e InstallCountWidget\n    ExtensionWidget --\u003e PublisherWidget\n    ExtensionWidget --\u003e RemoteBadgeWidget\n    ExtensionWidget --\u003e ExtensionStatusWidget\n    \n    ExtensionWidget --\u003e SponsorWidget\n    ExtensionWidget --\u003e VersionWidget\n    ExtensionWidget --\u003e ExtensionKindIndicatorWidget\n    ExtensionWidget --\u003e PreReleaseBookmarkWidget\n    ExtensionWidget --\u003e SyncIgnoredWidget\n    ExtensionWidget --\u003e ExtensionPackBadgeWidget\n    ExtensionWidget --\u003e RecommendationWidget\n    ExtensionWidget --\u003e ExtensionRuntimeStatusWidget\n```\n\n### Widget Base Class\n\nThe `ExtensionWidget` base class provides the reactive update pattern:\n\n```typescript\nabstract class ExtensionWidget extends Disposable implements IExtensionContainer {\n    private _extension: IExtension | null = null;\n    \n    get extension(): IExtension | null { return this._extension; }\n    \n    set extension(extension: IExtension | null) {\n        this._extension = extension;\n        this.update();\n    }\n    \n    update(): void { this.render(); }\n    abstract render(): void;\n}\n```\n\n### Key Widget Implementations\n\n**RatingsWidget**\n\nDisplays star ratings using a combination of filled, half-filled, and empty star icons:\n\n```typescript\nrender(): void {\n    if (this.extension?.rating) {\n        const rating = Math.round(this.extension.rating * 2) / 2;\n        // Render stars: full, half, empty\n        const stars = generateStars(rating);\n        this.container.appendChild(stars);\n    }\n}\n```\n\nIcons used: `starFullIcon`, `starHalfIcon`, `starEmptyIcon` [src/vs/workbench/contrib/extensions/browser/extensionsIcons.ts]()\n\n**PublisherWidget**\n\nShows publisher name with optional verification badge:\n\n```typescript\nrender(): void {\n    const publisherName = this.extension?.publisherDisplayName;\n    const verified = this.extension?.publisherDomain?.verified;\n    \n    this.publisherElement.textContent = publisherName;\n    \n    if (verified) {\n        this.verifiedIcon.className = ThemeIcon.asClassName(verifiedPublisherIcon);\n        show(this.verifiedIcon);\n    } else {\n        hide(this.verifiedIcon);\n    }\n}\n```\n\n**ExtensionStatusWidget**\n\nDisplays warnings, errors, and status messages about an extension:\n\n```typescript\nrender(): void {\n    const status = this.extensionStatusAction.status;\n    if (status) {\n        const severity = status.severity;\n        const icon = severity === Severity.Error ? errorIcon :\n                     severity === Severity.Warning ? warningIcon : infoIcon;\n        \n        this.element.appendChild(renderIcon(icon));\n        this.element.appendChild(status.message);\n    }\n}\n```\n\n**RemoteBadgeWidget**\n\nShows badges for remote/web extensions:\n\n```mermaid\ngraph TB\n    RemoteBadgeWidget[\"RemoteBadgeWidget\"]\n    \n    CheckLocation{\"Extension Location\"}\n    CheckLocation --\u003e|\"Remote\"| ShowRemoteBadge[\"Show 'Remote' badge\"]\n    CheckLocation --\u003e|\"Web\"| ShowWebBadge[\"Show 'Web' badge\"]\n    CheckLocation --\u003e|\"Local\"| HideBadge[\"Hide badge\"]\n    \n    RemoteBadgeWidget --\u003e CheckLocation\n```\n\n### Widget Lifecycle\n\nWidgets follow this lifecycle:\n1. **Construction**: Widget is created with container element\n2. **Extension Assignment**: `extension` property is set\n3. **Render**: `render()` method updates DOM based on extension\n4. **Update**: When extension changes, `update()`  `render()` is called\n5. **Disposal**: Disposables are cleaned up when widget is disposed\n\nSources: [src/vs/workbench/contrib/extensions/browser/extensionsWidgets.ts:1-1000]()\n\n---\n\n## Context Menu Integration\n\nExtension list items and the extension editor integrate with VS Code's context menu system to provide extension-specific actions.\n\n**Context Menu Structure**\n\n```mermaid\ngraph TB\n    ContextMenu[\"Context Menu\"]\n    \n    subgraph \"Menu Groups\"\n        INSTALL_GROUP[\"INSTALL_ACTIONS_GROUP\u003cbr/\u003eInstall/Update\"]\n        UPDATE_GROUP[\"UPDATE_ACTIONS_GROUP\u003cbr/\u003eSwitch Version\"]\n        THEME_GROUP[\"THEME_ACTIONS_GROUP\u003cbr/\u003eSet Theme\"]\n        ManageGroup[\"Manage Group\u003cbr/\u003eEnable/Disable/Uninstall\"]\n        IgnoreGroup[\"Ignore Group\u003cbr/\u003eAdd to Sync Ignored\"]\n    end\n    \n    ContextMenu --\u003e INSTALL_GROUP\n    ContextMenu --\u003e UPDATE_GROUP\n    ContextMenu --\u003e THEME_GROUP\n    ContextMenu --\u003e ManageGroup\n    ContextMenu --\u003e IgnoreGroup\n    \n    MenuId[\"MenuId.ExtensionContext\"]\n    MenuRegistry[\"MenuRegistry\"]\n    \n    MenuId --\u003e MenuRegistry\n    MenuRegistry --\u003e ContextMenu\n```\n\nContext menu groups are defined in [src/vs/workbench/contrib/extensions/common/extensions.ts:120-150]():\n- `INSTALL_ACTIONS_GROUP = '0_install'`\n- `UPDATE_ACTIONS_GROUP = '1_update'`\n- `THEME_ACTIONS_GROUP = '2_theme'`\n\nActions register themselves to `MenuId.ExtensionContext` with appropriate `when` clauses to control visibility based on extension state.\n\nSources: [src/vs/workbench/contrib/extensions/browser/extensions.contribution.ts:1-900](), [src/vs/workbench/contrib/extensions/common/extensions.ts:1-200]()\n\n---\n\n## View Registration and Contribution\n\nExtension views are dynamically registered through the `ExtensionsViewletViewsContribution` class, which creates view descriptors based on workspace and configuration state.\n\n**View Registration Flow**\n\n```mermaid\ngraph TB\n    ExtensionsViewletViewsContribution[\"ExtensionsViewletViewsContribution\"]\n    ViewContainer[\"ViewContainer\u003cbr/\u003e(VIEWLET_ID)\"]\n    ViewsRegistry[\"IViewsRegistry\"]\n    \n    subgraph \"View Descriptor Creation\"\n        DefaultViews[\"createDefaultExtensionsViewDescriptors()\"]\n        SearchViews[\"createSearchExtensionsViewDescriptors()\"]\n        RecommendedViews[\"createRecommendedExtensionsViewDescriptors()\"]\n        BuiltinViews[\"createBuiltinExtensionsViewDescriptors()\"]\n        UnsupportedViews[\"createUnsupportedWorkspaceExtensionsViewDescriptors()\"]\n    end\n    \n    ExtensionsViewletViewsContribution --\u003e DefaultViews\n    ExtensionsViewletViewsContribution --\u003e SearchViews\n    ExtensionsViewletViewsContribution --\u003e RecommendedViews\n    ExtensionsViewletViewsContribution --\u003e BuiltinViews\n    ExtensionsViewletViewsContribution --\u003e UnsupportedViews\n    \n    DefaultViews --\u003e ViewsRegistry\n    SearchViews --\u003e ViewsRegistry\n    RecommendedViews --\u003e ViewsRegistry\n    BuiltinViews --\u003e ViewsRegistry\n    UnsupportedViews --\u003e ViewsRegistry\n    \n    ViewsRegistry --\u003e ViewContainer\n```\n\nEach view descriptor includes:\n- **id**: Unique view identifier\n- **name**: Localized display name\n- **ctorDescriptor**: `SyncDescriptor` pointing to view class\n- **when**: Context key expression for visibility\n- **order**: Display order within container\n- **weight**: Initial size weight\n- **canToggleVisibility**: Whether user can hide/show\n\nExample view descriptor:\n\n```typescript\n{\n    id: 'workbench.views.extensions.installed',\n    name: localize('installed', \"Installed\"),\n    ctorDescriptor: new SyncDescriptor(ServerInstalledExtensionsView),\n    when: ContextKeyExpr.and(DefaultViewsContext, SearchInstalledExtensionsContext),\n    order: 1\n}\n```\n\nSources: [src/vs/workbench/contrib/extensions/browser/extensionsViewlet.ts:99-500]()\n\n---\n\n## Styling and Theming\n\nExtension UI components support VS Code's theming system through CSS variables and theme participants.\n\n**Key CSS Classes**\n\n| Component | CSS Class | Purpose |\n|-----------|-----------|---------|\n| Viewlet Container | `.extensions-viewlet` | Main container styling |\n| Search Box | `.search-box` | Search input styling |\n| Extension List | `.extension-list-item` | Individual extension row |\n| Extension Icon | `.icon-container .extension-icon` | Icon display area |\n| Extension Badge | `.extension-badge` | Badge overlay on icon |\n| Extension Editor | `.extension-editor` | Editor container |\n| Extension Header | `.extension-editor \u003e .header` | Editor header section |\n| Action Button | `.extension-action.label` | Action button styling |\n\n**Theme Colors**\n\nCustom theme colors defined for extensions:\n\n```typescript\n// Extension badge colors\nextensionBadgeRemoteForeground\nextensionBadgeRemoteBackground\n\n// Extension icon colors\nextensionIconPreReleaseForeground\nextensionIconStarForeground\n\n// Extension button colors\nextensionButtonProminentBackground\nextensionButtonProminentForeground\nextensionButtonProminentHoverBackground\n```\n\nTheme participants register color customizations in:\n- [src/vs/workbench/contrib/extensions/browser/extensionsActions.ts:30-50]()\n- [src/vs/workbench/contrib/extensions/browser/extensionEditor.ts:40-60]()\n\nSources: [src/vs/workbench/contrib/extensions/browser/media/extensionsViewlet.css:1-300](), [src/vs/workbench/contrib/extensions/browser/media/extension.css:1-200](), [src/vs/workbench/contrib/extensions/browser/media/extensionEditor.css:1-400]()"])</script><script>self.__next_f.push([1,"31:T989f,"])</script><script>self.__next_f.push([1,"# Integrated Terminal\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [src/vs/platform/terminal/common/terminal.ts](src/vs/platform/terminal/common/terminal.ts)\n- [src/vs/platform/terminal/common/terminalEnvironment.ts](src/vs/platform/terminal/common/terminalEnvironment.ts)\n- [src/vs/platform/terminal/common/terminalRecorder.ts](src/vs/platform/terminal/common/terminalRecorder.ts)\n- [src/vs/platform/terminal/node/ptyHostMain.ts](src/vs/platform/terminal/node/ptyHostMain.ts)\n- [src/vs/platform/terminal/node/ptyHostService.ts](src/vs/platform/terminal/node/ptyHostService.ts)\n- [src/vs/platform/terminal/node/ptyService.ts](src/vs/platform/terminal/node/ptyService.ts)\n- [src/vs/platform/terminal/node/terminalProcess.ts](src/vs/platform/terminal/node/terminalProcess.ts)\n- [src/vs/platform/terminal/test/common/terminalEnvironment.test.ts](src/vs/platform/terminal/test/common/terminalEnvironment.test.ts)\n- [src/vs/platform/terminal/test/common/terminalProfiles.test.ts](src/vs/platform/terminal/test/common/terminalProfiles.test.ts)\n- [src/vs/platform/terminal/test/common/terminalRecorder.test.ts](src/vs/platform/terminal/test/common/terminalRecorder.test.ts)\n- [src/vs/workbench/api/browser/mainThreadTerminalService.ts](src/vs/workbench/api/browser/mainThreadTerminalService.ts)\n- [src/vs/workbench/api/common/extHostTerminalService.ts](src/vs/workbench/api/common/extHostTerminalService.ts)\n- [src/vs/workbench/api/node/extHostTerminalService.ts](src/vs/workbench/api/node/extHostTerminalService.ts)\n- [src/vs/workbench/contrib/terminal/browser/media/terminal.css](src/vs/workbench/contrib/terminal/browser/media/terminal.css)\n- [src/vs/workbench/contrib/terminal/browser/media/xterm.css](src/vs/workbench/contrib/terminal/browser/media/xterm.css)\n- [src/vs/workbench/contrib/terminal/browser/remotePty.ts](src/vs/workbench/contrib/terminal/browser/remotePty.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminal.contribution.ts](src/vs/workbench/contrib/terminal/browser/terminal.contribution.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminal.ts](src/vs/workbench/contrib/terminal/browser/terminal.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalActions.ts](src/vs/workbench/contrib/terminal/browser/terminalActions.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalEditor.ts](src/vs/workbench/contrib/terminal/browser/terminalEditor.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalEditorInput.ts](src/vs/workbench/contrib/terminal/browser/terminalEditorInput.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalEditorService.ts](src/vs/workbench/contrib/terminal/browser/terminalEditorService.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalGroup.ts](src/vs/workbench/contrib/terminal/browser/terminalGroup.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalGroupService.ts](src/vs/workbench/contrib/terminal/browser/terminalGroupService.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts](src/vs/workbench/contrib/terminal/browser/terminalInstance.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalInstanceService.ts](src/vs/workbench/contrib/terminal/browser/terminalInstanceService.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalMenus.ts](src/vs/workbench/contrib/terminal/browser/terminalMenus.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalProcessExtHostProxy.ts](src/vs/workbench/contrib/terminal/browser/terminalProcessExtHostProxy.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts](src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalService.ts](src/vs/workbench/contrib/terminal/browser/terminalService.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalStatusList.ts](src/vs/workbench/contrib/terminal/browser/terminalStatusList.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalTabbedView.ts](src/vs/workbench/contrib/terminal/browser/terminalTabbedView.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalTabsList.ts](src/vs/workbench/contrib/terminal/browser/terminalTabsList.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalView.ts](src/vs/workbench/contrib/terminal/browser/terminalView.ts)\n- [src/vs/workbench/contrib/terminal/browser/xterm/xtermTerminal.ts](src/vs/workbench/contrib/terminal/browser/xterm/xtermTerminal.ts)\n- [src/vs/workbench/contrib/terminal/common/terminal.ts](src/vs/workbench/contrib/terminal/common/terminal.ts)\n- [src/vs/workbench/contrib/terminal/common/terminalColorRegistry.ts](src/vs/workbench/contrib/terminal/common/terminalColorRegistry.ts)\n- [src/vs/workbench/contrib/terminal/common/terminalConfiguration.ts](src/vs/workbench/contrib/terminal/common/terminalConfiguration.ts)\n- [src/vs/workbench/contrib/terminal/common/terminalEnvironment.ts](src/vs/workbench/contrib/terminal/common/terminalEnvironment.ts)\n- [src/vs/workbench/contrib/terminal/common/terminalStrings.ts](src/vs/workbench/contrib/terminal/common/terminalStrings.ts)\n- [src/vs/workbench/contrib/terminal/test/browser/terminalStatusList.test.ts](src/vs/workbench/contrib/terminal/test/browser/terminalStatusList.test.ts)\n- [src/vs/workbench/contrib/terminal/test/common/terminalEnvironment.test.ts](src/vs/workbench/contrib/terminal/test/common/terminalEnvironment.test.ts)\n- [src/vs/workbench/contrib/terminalContrib/voice/browser/terminal.voice.contribution.ts](src/vs/workbench/contrib/terminalContrib/voice/browser/terminal.voice.contribution.ts)\n- [src/vs/workbench/contrib/terminalContrib/voice/browser/terminalVoice.ts](src/vs/workbench/contrib/terminalContrib/voice/browser/terminalVoice.ts)\n- [src/vs/workbench/contrib/terminalContrib/voice/browser/terminalVoiceActions.ts](src/vs/workbench/contrib/terminalContrib/voice/browser/terminalVoiceActions.ts)\n\n\u003c/details\u003e\n\n\n\nThe Integrated Terminal system provides terminal emulation capabilities within VS Code, supporting local, remote, and web-based terminal sessions. It manages terminal instances, processes (PTY), rendering via xterm.js, and exposes an extension API for terminal customization and automation.\n\nFor information about terminal contributions (links, quick fixes, suggestions), see the respective contribution pages. For notebook-related terminals, see [Notebooks](#9).\n\n## Architecture Overview\n\nThe terminal system spans multiple processes and architectural layers:\n\n```mermaid\ngraph TB\n    subgraph RendererProcess[\"Renderer Process - Workbench\"]\n        TerminalService[\"TerminalService\u003cbr/\u003esrc/vs/workbench/contrib/terminal/browser/terminalService.ts\"]\n        TerminalGroupService[\"TerminalGroupService\u003cbr/\u003esrc/vs/workbench/contrib/terminal/browser/terminalGroupService.ts\"]\n        TerminalEditorService[\"TerminalEditorService\u003cbr/\u003esrc/vs/workbench/contrib/terminal/browser/terminalEditorService.ts\"]\n        TerminalInstanceService[\"TerminalInstanceService\u003cbr/\u003esrc/vs/workbench/contrib/terminal/browser/terminalInstanceService.ts\"]\n        \n        TerminalInstance[\"TerminalInstance\u003cbr/\u003esrc/vs/workbench/contrib/terminal/browser/terminalInstance.ts\"]\n        TerminalProcessManager[\"TerminalProcessManager\u003cbr/\u003esrc/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts\"]\n        XtermTerminal[\"XtermTerminal\u003cbr/\u003esrc/vs/workbench/contrib/terminal/browser/xterm/xtermTerminal.ts\"]\n        \n        TerminalViewPane[\"TerminalViewPane\u003cbr/\u003esrc/vs/workbench/contrib/terminal/browser/terminalView.ts\"]\n        TerminalTabbedView[\"TerminalTabbedView\u003cbr/\u003esrc/vs/workbench/contrib/terminal/browser/terminalTabbedView.ts\"]\n        TerminalEditor[\"TerminalEditor\u003cbr/\u003esrc/vs/workbench/contrib/terminal/browser/terminalEditor.ts\"]\n    end\n    \n    subgraph ExtensionHost[\"Extension Host Process\"]\n        ExtHostTerminalService[\"ExtHostTerminalService\u003cbr/\u003esrc/vs/workbench/api/common/extHostTerminalService.ts\"]\n        ExtHostTerminal[\"ExtHostTerminal\"]\n        Pseudoterminal[\"Pseudoterminal API\"]\n    end\n    \n    subgraph PtyHostProcess[\"Backend - PTY Host Process\"]\n        PtyService[\"PtyService\u003cbr/\u003esrc/vs/platform/terminal/node/ptyService.ts\"]\n        PersistentTerminalProcess[\"PersistentTerminalProcess\"]\n        TerminalProcess[\"TerminalProcess\u003cbr/\u003esrc/vs/platform/terminal/node/terminalProcess.ts\"]\n        NodePty[\"node-pty\u003cbr/\u003eNative Module\"]\n    end\n    \n    TerminalService --\u003e TerminalGroupService\n    TerminalService --\u003e TerminalEditorService\n    TerminalService --\u003e TerminalInstanceService\n    \n    TerminalInstanceService --\u003e TerminalInstance\n    TerminalInstance --\u003e TerminalProcessManager\n    TerminalInstance --\u003e XtermTerminal\n    \n    TerminalViewPane --\u003e TerminalTabbedView\n    TerminalTabbedView --\u003e TerminalInstance\n    TerminalEditor --\u003e TerminalInstance\n    \n    TerminalProcessManager --\u003e|\"IPC Channel\"| PtyService\n    ExtHostTerminalService --\u003e|\"RPC Protocol\"| TerminalService\n    ExtHostTerminal --\u003e Pseudoterminal\n    \n    PtyService --\u003e PersistentTerminalProcess\n    PersistentTerminalProcess --\u003e TerminalProcess\n    TerminalProcess --\u003e NodePty\n```\n\n**Terminal Architecture Overview**: This diagram shows the major services and classes involved in the terminal system and how they communicate across process boundaries.\n\nSources: [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts:130-410](), [src/vs/workbench/contrib/terminal/browser/terminalService.ts:66-238](), [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts:74-167](), [src/vs/platform/terminal/node/ptyService.ts:77-121]()\n\n## Service Layer\n\n### ITerminalService\n\n`ITerminalService` is the primary entry point for creating and managing terminal instances across both the terminal view (panel) and terminal editors.\n\n| Responsibility | Description |\n|---------------|-------------|\n| Instance Management | Tracks all terminal instances (view, editor, background) |\n| Creation | Provides `createTerminal()` to instantiate new terminals |\n| Backend Registration | Manages `ITerminalBackend` instances for local/remote |\n| Connection State | Tracks `TerminalConnectionState` (Connecting/Connected) |\n| Layout Persistence | Saves and restores terminal layout on reload |\n\nKey properties:\n- `instances`: All terminal instances (view + editor + background)\n- `foregroundInstances`: Only visible terminals (view + editor)\n- `activeInstance`: Currently focused terminal\n- `connectionState`: Connection status to PTY host\n\nSources: [src/vs/workbench/contrib/terminal/browser/terminalService.ts:66-238](), [src/vs/workbench/contrib/terminal/browser/terminal.ts:412-437]()\n\n### ITerminalInstanceService\n\n`ITerminalInstanceService` is responsible for the actual instantiation of terminal instances and managing backends.\n\n```mermaid\ngraph LR\n    ITerminalInstanceService[\"ITerminalInstanceService\"]\n    \n    ITerminalInstanceService --\u003e|\"createInstance()\"| TerminalInstance\n    ITerminalInstanceService --\u003e|\"getBackend()\"| LocalBackend[\"Local Backend\"]\n    ITerminalInstanceService --\u003e|\"getBackend(remoteAuthority)\"| RemoteBackend[\"Remote Backend\"]\n    ITerminalInstanceService --\u003e|\"getBackend(remoteAuthority)\"| WebBackend[\"Web Backend\"]\n    \n    LocalBackend --\u003e LocalPtyService[\"Local PtyService\"]\n    RemoteBackend --\u003e RemotePtyService[\"Remote PtyService\"]\n    WebBackend --\u003e WebPtyService[\"Web PtyService\"]\n```\n\n**Purpose**: Shows how `ITerminalInstanceService` brokers backend selection based on remote authority.\n\nSources: [src/vs/workbench/contrib/terminal/browser/terminal.ts:66-103](), [src/vs/workbench/contrib/terminal/browser/terminalService.ts:280-337]()\n\n### ITerminalGroupService and ITerminalEditorService\n\nTerminal instances can be hosted in two locations:\n\n| Location | Service | Description |\n|----------|---------|-------------|\n| Terminal Panel | `ITerminalGroupService` | Groups terminals in tabs/split panes in the terminal view |\n| Editor Area | `ITerminalEditorService` | Opens terminals as editors in editor groups |\n\nBoth implement `ITerminalInstanceHost` and forward events like `onDidChangeActiveInstance`, `onDidDisposeInstance`, etc.\n\nSources: [src/vs/workbench/contrib/terminal/browser/terminalService.ts:350-362](), [src/vs/workbench/contrib/terminal/browser/terminal.ts:296-321]()\n\n## Terminal Instance Lifecycle\n\n### TerminalInstance\n\n`TerminalInstance` is the primary class representing a single terminal. It coordinates between the UI (xterm.js), process management, and capabilities.\n\n```mermaid\ngraph TB\n    TerminalInstanceCtor[\"TerminalInstance\u003cbr/\u003econstructor()\"]\n    \n    subgraph ConstructionPhase[\"Construction Phase\"]\n        InitDimensions[\"_initDimensions()\"]\n        CreateProcessManager[\"_createProcessManager()\"]\n        CreateXterm[\"_createXterm()\"]\n    end\n    \n    subgraph StartupPhase[\"Startup Phase\"]\n        ContainerReady[\"_containerReadyBarrier.wait()\"]\n        ResolveProfile[\"resolveShellLaunchConfig()\"]\n        CreateProcess[\"_createProcess()\"]\n        AttachToElement[\"attachToElement()\"]\n    end\n    \n    subgraph RunningPhase[\"Running Phase\"]\n        XtermReady[\"xterm ready\"]\n        ProcessReady[\"process ready\"]\n        DataFlow[\"data flow active\"]\n        CapabilitiesDetected[\"capabilities detected\"]\n    end\n    \n    subgraph DisposalPhase[\"Disposal Phase\"]\n        Dispose[\"dispose()\"]\n        DetachProcess[\"detachProcessAndDispose()\"]\n        SafeDispose[\"safeDisposeTerminal()\"]\n    end\n    \n    TerminalInstanceCtor --\u003e InitDimensions\n    TerminalInstanceCtor --\u003e CreateProcessManager\n    TerminalInstanceCtor --\u003e CreateXterm\n    \n    CreateXterm --\u003e ContainerReady\n    ContainerReady --\u003e ResolveProfile\n    ResolveProfile --\u003e CreateProcess\n    CreateProcess --\u003e AttachToElement\n    \n    AttachToElement --\u003e XtermReady\n    CreateProcess --\u003e ProcessReady\n    XtermReady --\u003e DataFlow\n    ProcessReady --\u003e DataFlow\n    DataFlow --\u003e CapabilitiesDetected\n    \n    CapabilitiesDetected --\u003e Dispose\n    Dispose --\u003e DetachProcess\n    DetachProcess --\u003e SafeDispose\n```\n\n**TerminalInstance Lifecycle**: Illustrates the lifecycle phases of a `TerminalInstance` from construction to disposal.\n\nKey lifecycle events:\n- `onProcessReady`: Fired when PTY process is ready (has PID)\n- `onProcessReplayComplete`: Fired after reconnection replay finishes\n- `onData`: Data from the process to be rendered\n- `onExit`: Process has exited\n- `onDisposed`: Instance is fully disposed\n\nSources: [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts:366-573](), [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts:1293-1330]()\n\n### TerminalProcessManager\n\n`TerminalProcessManager` manages the underlying terminal process (PTY) and its lifecycle, separate from the UI concerns.\n\n```mermaid\ngraph TB\n    TerminalProcessManager[\"TerminalProcessManager\"]\n    \n    subgraph ProcessStates[\"Process States (ProcessState enum)\"]\n        Uninitialized[\"Uninitialized = 1\"]\n        Launching[\"Launching = 2\"]\n        Running[\"Running = 3\"]\n        KilledDuringLaunch[\"KilledDuringLaunch = 4\"]\n        KilledByUser[\"KilledByUser = 5\"]\n        KilledByProcess[\"KilledByProcess = 6\"]\n    end\n    \n    subgraph BackendCommunication[\"Backend Communication Methods\"]\n        GetBackend[\"getBackend()\"]\n        CreateProcess[\"createProcess()\"]\n        Write[\"write()\"]\n        SetDimensions[\"setDimensions()\"]\n    end\n    \n    subgraph Capabilities[\"Terminal Capabilities\"]\n        TerminalCapabilityStore[\"TerminalCapabilityStore\"]\n        CommandDetection[\"CommandDetectionCapability\"]\n        CwdDetection[\"CwdDetectionCapability\"]\n        ShellIntegration[\"ShellIntegrationAddon\"]\n    end\n    \n    Uninitialized --\u003e Launching\n    Launching --\u003e Running\n    Launching --\u003e KilledDuringLaunch\n    Running --\u003e KilledByUser\n    Running --\u003e KilledByProcess\n    \n    TerminalProcessManager --\u003e GetBackend\n    GetBackend --\u003e CreateProcess\n    CreateProcess --\u003e Write\n    Write --\u003e SetDimensions\n    \n    TerminalProcessManager --\u003e TerminalCapabilityStore\n    TerminalCapabilityStore --\u003e CommandDetection\n    TerminalCapabilityStore --\u003e CwdDetection\n    TerminalCapabilityStore --\u003e ShellIntegration\n```\n\n**TerminalProcessManager State Machine**: Shows process state transitions and how `TerminalProcessManager` communicates with backends.\n\nThe process manager maintains:\n- `processState`: Current lifecycle state (ProcessState enum)\n- `capabilities`: Detected terminal capabilities (shell integration, command detection, etc.)\n- `shellProcessId`: PID of the shell process\n- `backend`: The `ITerminalBackend` (local/remote) handling the actual PTY\n\nSources: [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts:74-167](), [src/vs/workbench/contrib/terminal/common/terminal.ts:316-333]()\n\n## Xterm.js Integration\n\n### XtermTerminal\n\n`XtermTerminal` wraps the raw xterm.js `Terminal` instance and manages addons, theming, and rendering.\n\n```mermaid\ngraph TB\n    XtermTerminal[\"XtermTerminal\u003cbr/\u003ewrapper class\"]\n    RawXtermTerminal[\"Terminal\u003cbr/\u003e@xterm/xterm\"]\n    \n    subgraph Addons[\"Xterm.js Addons\"]\n        SearchAddon[\"SearchAddon\u003cbr/\u003e@xterm/addon-search\"]\n        Unicode11Addon[\"Unicode11Addon\u003cbr/\u003e@xterm/addon-unicode11\"]\n        WebglAddon[\"WebglAddon\u003cbr/\u003e@xterm/addon-webgl\"]\n        LigaturesAddon[\"LigaturesAddon\u003cbr/\u003e@xterm/addon-ligatures\"]\n        ImageAddon[\"ImageAddon\u003cbr/\u003e@xterm/addon-image\"]\n        ClipboardAddon[\"ClipboardAddon\u003cbr/\u003e@xterm/addon-clipboard\"]\n        SerializeAddon[\"SerializeAddon\u003cbr/\u003e@xterm/addon-serialize\"]\n        ShellIntegrationAddon[\"ShellIntegrationAddon\u003cbr/\u003eplatform/terminal/common/xterm\"]\n        DecorationAddon[\"DecorationAddon\u003cbr/\u003edecorationAddon.ts\"]\n        MarkNavigationAddon[\"MarkNavigationAddon\u003cbr/\u003emarkNavigationAddon.ts\"]\n    end\n    \n    subgraph Configuration[\"Configuration Sources\"]\n        ITerminalFont[\"ITerminalFont\"]\n        ITheme[\"ITheme\"]\n        ITerminalOptions[\"ITerminalOptions\"]\n    end\n    \n    XtermTerminal --\u003e RawXtermTerminal\n    \n    RawXtermTerminal --\u003e SearchAddon\n    RawXtermTerminal --\u003e Unicode11Addon\n    RawXtermTerminal --\u003e WebglAddon\n    RawXtermTerminal --\u003e LigaturesAddon\n    RawXtermTerminal --\u003e ImageAddon\n    RawXtermTerminal --\u003e ClipboardAddon\n    RawXtermTerminal --\u003e SerializeAddon\n    RawXtermTerminal --\u003e ShellIntegrationAddon\n    RawXtermTerminal --\u003e DecorationAddon\n    RawXtermTerminal --\u003e MarkNavigationAddon\n    \n    ITerminalFont --\u003e XtermTerminal\n    ITheme --\u003e XtermTerminal\n    ITerminalOptions --\u003e XtermTerminal\n```\n\n**XtermTerminal Addon Architecture**: Shows the addon architecture and how `XtermTerminal` configures the raw xterm.js instance.\n\nKey responsibilities:\n- **Rendering**: Manages canvas/DOM rendering via WebGL addon when available\n- **Theme**: Updates terminal colors based on VS Code theme (`updateTheme()`)\n- **Font**: Applies font family, size, line height, letter spacing\n- **Addons**: Loads and manages xterm.js addons for extended functionality\n- **Shell Integration**: Coordinates with `ShellIntegrationAddon` for capabilities\n\nSources: [src/vs/workbench/contrib/terminal/browser/xterm/xtermTerminal.ts:72-191](), [src/vs/workbench/contrib/terminal/browser/xterm/xtermTerminal.ts:285-379]()\n\n### Shell Integration and Capabilities\n\nShell integration enables advanced features by injecting scripts into the shell that emit special escape sequences:\n\n```mermaid\ngraph LR\n    subgraph \"Shell Integration Flow\"\n        ShellLaunch[\"Shell Launch\"]\n        InjectionScript[\"Shell Integration Script\"]\n        EscapeSequences[\"OSC Escape Sequences\"]\n        ShellIntegrationAddon[\"ShellIntegrationAddon\"]\n        Capabilities[\"Terminal Capabilities\"]\n    end\n    \n    ShellLaunch --\u003e|inject| InjectionScript\n    InjectionScript --\u003e|\"emits OSC 633\"| EscapeSequences\n    EscapeSequences --\u003e|parsed by| ShellIntegrationAddon\n    ShellIntegrationAddon --\u003e|activates| Capabilities\n    \n    subgraph \"Capability Types\"\n        CommandDetection[\"CommandDetectionCapability\"]\n        CwdDetection[\"CwdDetectionCapability\"]\n        BufferMarkDetection[\"BufferMarkDetectionCapability\"]\n        PromptTypeDetection[\"PromptTypeDetectionCapability\"]\n    end\n    \n    Capabilities --\u003e CommandDetection\n    Capabilities --\u003e CwdDetection\n    Capabilities --\u003e BufferMarkDetection\n    Capabilities --\u003e PromptTypeDetection\n```\n\n**Purpose**: Illustrates how shell integration scripts enable capability detection.\n\nSupported shells with integration:\n- Bash (`PosixShellType.Bash`)\n- Zsh (`PosixShellType.Zsh`)\n- PowerShell (`GeneralShellType.PowerShell`)\n- Python (`GeneralShellType.Python`)\n\nSources: [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts:123-128](), [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts:463-505](), [src/vs/platform/terminal/common/xterm/shellIntegrationAddon.ts:1-50]()\n\n## Multi-Backend Architecture\n\nThe terminal system supports multiple backend types for different execution contexts:\n\n```mermaid\ngraph TB\n    subgraph \"Renderer Process\"\n        TerminalProcessManager[\"TerminalProcessManager\"]\n        ITerminalInstanceService[\"ITerminalInstanceService\"]\n    end\n    \n    subgraph \"Backend Registry\"\n        LocalBackend[\"Local Backend\"]\n        RemoteBackend[\"Remote Backend\u003cbr/\u003e(SSH/Container)\"]\n        WebBackend[\"Web Backend\"]\n    end\n    \n    subgraph \"Local PTY Host\"\n        LocalPtyService[\"PtyService\u003cbr/\u003e(Node.js Process)\"]\n        LocalPty[\"node-pty\"]\n    end\n    \n    subgraph \"Remote PTY Host\"\n        RemotePtyService[\"Remote PtyService\u003cbr/\u003e(SSH/Container)\"]\n        RemotePty[\"node-pty (remote)\"]\n    end\n    \n    subgraph \"Web Worker\"\n        WebPtyService[\"Web PtyService\u003cbr/\u003e(Web Worker)\"]\n        WebTerminalBackend[\"Web Terminal Backend\"]\n    end\n    \n    ITerminalInstanceService --\u003e|\"getBackend(undefined)\"| LocalBackend\n    ITerminalInstanceService --\u003e|\"getBackend(remoteAuthority)\"| RemoteBackend\n    ITerminalInstanceService --\u003e|\"getBackend(web)\"| WebBackend\n    \n    TerminalProcessManager --\u003e|IPC| LocalBackend\n    TerminalProcessManager --\u003e|IPC| RemoteBackend\n    TerminalProcessManager --\u003e|IPC| WebBackend\n    \n    LocalBackend --\u003e LocalPtyService\n    RemoteBackend --\u003e RemotePtyService\n    WebBackend --\u003e WebPtyService\n    \n    LocalPtyService --\u003e LocalPty\n    RemotePtyService --\u003e RemotePty\n```\n\n**Purpose**: Shows how different backends are selected and communicate with their respective PTY hosts.\n\nBackend selection logic in `TerminalProcessManager.getBackend()`:\n1. No remote authority  Local backend\n2. Remote authority present  Remote backend (resolved via `IRemoteAgentService`)\n3. Web environment  Web backend\n\nSources: [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts:334-358](), [src/vs/workbench/contrib/terminal/browser/terminalService.ts:280-341]()\n\n## PTY Service Layer\n\n### IPtyService\n\n`IPtyService` is the interface for managing pseudo-terminals in the backend (PTY host) process.\n\n| Method | Description |\n|--------|-------------|\n| `createProcess()` | Creates a new PTY process with shell launch config |\n| `start()` | Starts a previously created process |\n| `shutdown()` | Shuts down a process by ID |\n| `write()` | Writes data to a process |\n| `resize()` | Resizes a process to new dimensions |\n| `getTerminalLayoutInfo()` | Gets saved layout for reconnection |\n| `setTerminalLayoutInfo()` | Saves layout for persistence |\n\nEvents emitted:\n- `onProcessData`: Data from PTY to be displayed\n- `onProcessReady`: Process is ready with PID\n- `onProcessExit`: Process has exited\n- `onDidChangeProperty`: Process property changed (cwd, title, etc.)\n\nSources: [src/vs/platform/terminal/common/terminal.ts:296-387](), [src/vs/platform/terminal/node/ptyService.ts:77-121]()\n\n### PersistentTerminalProcess\n\n`PersistentTerminalProcess` wraps `TerminalProcess` and adds persistence/reconnection capabilities:\n\n```mermaid\ngraph TB\n    PersistentTerminalProcess[\"PersistentTerminalProcess\"]\n    TerminalProcess[\"TerminalProcess\"]\n    XtermTerminal_Backend[\"Terminal (xterm.js headless)\"]\n    NodePty[\"IPty (node-pty)\"]\n    \n    subgraph \"Persistence Features\"\n        Serialization[\"SerializeAddon\u003cbr/\u003e(save state)\"]\n        Replay[\"Replay buffer\"]\n        Orphan[\"Orphan detection\"]\n        Reconnection[\"Reconnection support\"]\n    end\n    \n    PersistentTerminalProcess --\u003e TerminalProcess\n    PersistentTerminalProcess --\u003e Serialization\n    PersistentTerminalProcess --\u003e Replay\n    PersistentTerminalProcess --\u003e Orphan\n    PersistentTerminalProcess --\u003e Reconnection\n    \n    TerminalProcess --\u003e XtermTerminal_Backend\n    TerminalProcess --\u003e NodePty\n    \n    XtermTerminal_Backend --\u003e|\"loadAddon()\"| Serialization\n```\n\n**Purpose**: Shows how persistence is layered on top of basic terminal process management.\n\nThe persistence mechanism:\n1. **Serialize**: `SerializeAddon` captures terminal state on shutdown\n2. **Store**: State saved to disk with workspace ID mapping\n3. **Detect**: On reconnection, orphaned processes are detected\n4. **Replay**: Buffered output replayed to restore visible state\n\nSources: [src/vs/platform/terminal/node/ptyService.ts:579-791](), [src/vs/platform/terminal/node/ptyService.ts:387-462]()\n\n### TerminalProcess\n\n`TerminalProcess` is the low-level wrapper around node-pty's `IPty`:\n\n```mermaid\ngraph LR\n    TerminalProcess[\"TerminalProcess\"]\n    IPty[\"IPty (node-pty)\"]\n    Shell[\"Shell Process\u003cbr/\u003e(bash, pwsh, etc.)\"]\n    \n    subgraph \"Process Management\"\n        Spawn[\"spawn()\"]\n        Write[\"write()\"]\n        Resize[\"resize()\"]\n        Kill[\"kill()\"]\n        AckData[\"acknowledgeDataEvent()\"]\n    end\n    \n    subgraph \"Monitoring\"\n        ChildProcessMonitor[\"ChildProcessMonitor\"]\n        WindowsShellHelper[\"WindowsShellHelper\"]\n    end\n    \n    TerminalProcess --\u003e Spawn\n    TerminalProcess --\u003e Write\n    TerminalProcess --\u003e Resize\n    TerminalProcess --\u003e Kill\n    TerminalProcess --\u003e AckData\n    \n    Spawn --\u003e IPty\n    IPty --\u003e Shell\n    \n    TerminalProcess --\u003e ChildProcessMonitor\n    TerminalProcess --\u003e WindowsShellHelper\n```\n\n**Purpose**: Shows the direct interface to node-pty and monitoring utilities.\n\nFlow control:\n- Uses `FlowControlConstants` to pause/resume based on buffer size\n- Implements `acknowledgeDataEvent()` for back-pressure\n- `ChildProcessMonitor` detects child processes (for confirmOnKill)\n\nSources: [src/vs/platform/terminal/node/terminalProcess.ts:60-198](), [src/vs/platform/terminal/node/terminalProcess.ts:301-441]()\n\n## UI Components\n\n### Terminal Panel View\n\nThe terminal panel view consists of a tabbed interface with split support:\n\n```mermaid\ngraph TB\n    TerminalViewPane[\"TerminalViewPane\u003cbr/\u003eextends ViewPane\"]\n    TerminalTabbedView[\"TerminalTabbedView\"]\n    SplitView[\"SplitView\u003cbr/\u003eui/splitview\"]\n    \n    subgraph LeftSide[\"Left Side (Tabs)\"]\n        TerminalTabsList[\"TerminalTabsList\u003cbr/\u003eextends WorkbenchList\"]\n        TabTree[\"WorkbenchList\"]\n        PlusButton[\"_plusButton\"]\n    end\n    \n    subgraph RightSide[\"Right Side (Content)\"]\n        TerminalGroupsContainer[\"_terminalContainer\"]\n        TerminalGroup[\"TerminalGroup\"]\n        TerminalSplitPane[\"SplitView\u003cbr/\u003esplit panes\"]\n        TerminalInstanceDOM[\"TerminalInstance.domElement\"]\n    end\n    \n    TerminalViewPane --\u003e TerminalTabbedView\n    TerminalTabbedView --\u003e SplitView\n    \n    SplitView --\u003e TerminalTabsList\n    SplitView --\u003e TerminalGroupsContainer\n    \n    TerminalTabsList --\u003e TabTree\n    TerminalTabsList --\u003e PlusButton\n    \n    TerminalGroupsContainer --\u003e TerminalGroup\n    TerminalGroup --\u003e TerminalSplitPane\n    TerminalSplitPane --\u003e TerminalInstanceDOM\n```\n\n**Terminal Panel UI Hierarchy**: Shows the UI hierarchy of the terminal panel view with tabs and content area.\n\nLayout configuration:\n- `terminal.integrated.tabs.enabled`: Show/hide tabs list\n- `terminal.integrated.tabs.location`: Position tabs left or right (`'left' | 'right'`)\n- `terminal.integrated.defaultLocation`: Default to panel or editor (`'view' | 'editor'`)\n\nSources: [src/vs/workbench/contrib/terminal/browser/terminalView.ts:57-115](), [src/vs/workbench/contrib/terminal/browser/terminalTabbedView.ts:43-100](), [src/vs/workbench/contrib/terminal/browser/terminalGroup.ts:1-100]()\n\n### Terminal Editor\n\nTerminals can also be opened as editors in the editor area:\n\n```mermaid\ngraph TB\n    TerminalEditorInput[\"TerminalEditorInput\u003cbr/\u003e(editorInput)\"]\n    TerminalEditor[\"TerminalEditor\u003cbr/\u003e(editor pane)\"]\n    TerminalInstance[\"TerminalInstance\"]\n    \n    subgraph \"Editor Integration\"\n        IEditorService[\"IEditorService\"]\n        EditorGroup[\"Editor Group\"]\n        EditorPane[\"Editor Pane\"]\n    end\n    \n    TerminalEditorInput --\u003e|\"matches()\"| TerminalInstance\n    TerminalEditor --\u003e|\"setInput()\"| TerminalEditorInput\n    TerminalEditor --\u003e|\"renders\"| TerminalInstance\n    \n    IEditorService --\u003e EditorGroup\n    EditorGroup --\u003e EditorPane\n    EditorPane --\u003e TerminalEditor\n```\n\n**Purpose**: Shows how terminals integrate with the editor system.\n\nKey differences from panel terminals:\n- Target is `TerminalLocation.Editor` instead of `TerminalLocation.Panel`\n- Managed by `ITerminalEditorService` instead of `ITerminalGroupService`\n- Serialized via `TerminalInputSerializer` for persistence\n\nSources: [src/vs/workbench/contrib/terminal/browser/terminalEditor.ts:1-70](), [src/vs/workbench/contrib/terminal/browser/terminalEditorInput.ts:1-120](), [src/vs/workbench/contrib/terminal/browser/terminalEditorService.ts:1-80]()\n\n## Extension API\n\n### ExtHostTerminalService\n\nExtensions interact with terminals through the `vscode.window.createTerminal()` API, implemented by `ExtHostTerminalService`:\n\n```mermaid\ngraph TB\n    ExtensionAPI[\"vscode.window API\"]\n    ExtHostTerminalService[\"ExtHostTerminalService\"]\n    MainThreadTerminalService[\"MainThreadTerminalService\"]\n    ITerminalService[\"ITerminalService\"]\n    \n    subgraph \"Extension Host\"\n        ExtHostTerminal[\"ExtHostTerminal\"]\n        EnvironmentVariableCollection[\"EnvironmentVariableCollection\"]\n        TerminalLinkProvider[\"TerminalLinkProvider\"]\n        TerminalProfileProvider[\"TerminalProfileProvider\"]\n        Pseudoterminal[\"Pseudoterminal\"]\n    end\n    \n    ExtensionAPI --\u003e|\"createTerminal()\"| ExtHostTerminalService\n    ExtHostTerminalService --\u003e|RPC| MainThreadTerminalService\n    MainThreadTerminalService --\u003e ITerminalService\n    \n    ExtHostTerminalService --\u003e ExtHostTerminal\n    ExtHostTerminalService --\u003e EnvironmentVariableCollection\n    ExtHostTerminalService --\u003e TerminalLinkProvider\n    ExtHostTerminalService --\u003e TerminalProfileProvider\n    ExtHostTerminalService --\u003e Pseudoterminal\n```\n\n**Purpose**: Shows the RPC bridge between extension host and main thread for terminal API.\n\nAPI surface in `ExtHostTerminalService`:\n- `createTerminal()`: Creates terminal with options\n- `createTerminalFromOptions()`: Advanced creation\n- `createExtensionTerminal()`: Creates custom PTY-backed terminal\n- `getEnvironmentVariableCollection()`: Modifies terminal environment\n- `registerLinkProvider()`: Adds custom link detection\n- `registerProfileProvider()`: Contributes terminal profiles\n\nSources: [src/vs/workbench/api/common/extHostTerminalService.ts:33-62](), [src/vs/workbench/api/browser/mainThreadTerminalService.ts:1-120]()\n\n### Pseudoterminal\n\nExtensions can provide custom terminal implementations via `Pseudoterminal`:\n\n```mermaid\ngraph LR\n    Extension[\"Extension Code\"]\n    Pseudoterminal[\"Pseudoterminal\u003cbr/\u003e(vscode.d.ts)\"]\n    ExtHostTerminal[\"ExtHostTerminal\"]\n    TerminalProcessExtHostProxy[\"TerminalProcessExtHostProxy\"]\n    TerminalInstance[\"TerminalInstance\"]\n    \n    Extension --\u003e|\"implements\"| Pseudoterminal\n    Extension --\u003e|\"createExtensionTerminal()\"| ExtHostTerminal\n    \n    ExtHostTerminal --\u003e|RPC| TerminalProcessExtHostProxy\n    TerminalProcessExtHostProxy --\u003e|\"proxies ITerminalChildProcess\"| TerminalInstance\n    \n    Pseudoterminal --\u003e|\"onDidWrite\"| ExtHostTerminal\n    Pseudoterminal --\u003e|\"onDidClose\"| ExtHostTerminal\n    Pseudoterminal --\u003e|\"open()\"| ExtHostTerminal\n    Pseudoterminal --\u003e|\"handleInput()\"| ExtHostTerminal\n```\n\n**Purpose**: Shows how custom PTY implementations work through the extension API.\n\nThe `Pseudoterminal` interface:\n- `onDidWrite`: Event for output data\n- `onDidClose`: Event for terminal close\n- `open()`: Called when terminal is opened\n- `close()`: Called when terminal is closed\n- `handleInput()`: Called when user types\n\nSources: [src/vs/workbench/api/common/extHostTerminalService.ts:332-496](), [src/vs/workbench/contrib/terminal/browser/terminalProcessExtHostProxy.ts:1-100]()\n\n## Data Flow\n\n### Write Path (User Input  Shell)\n\n```mermaid\nsequenceDiagram\n    participant User\n    participant XtermTerminal\n    participant TerminalInstance\n    participant TerminalProcessManager\n    participant IPtyService\n    participant TerminalProcess\n    participant Shell\n    \n    User-\u003e\u003eXtermTerminal: Key press\n    XtermTerminal-\u003e\u003eTerminalInstance: onData event\n    TerminalInstance-\u003e\u003eTerminalProcessManager: write(data)\n    TerminalProcessManager-\u003e\u003eIPtyService: write(id, data)\n    IPtyService-\u003e\u003eTerminalProcess: write(data)\n    TerminalProcess-\u003e\u003eShell: write to stdin\n```\n\n**Purpose**: Traces how user keyboard input flows to the shell process.\n\nKey points:\n- Xterm.js captures keyboard events via hidden textarea\n- Data flows through instance  process manager  backend  PTY\n- Flow control via `acknowledgeDataEvent()` prevents buffer overflow\n\nSources: [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts:657-660](), [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts:613-618]()\n\n### Read Path (Shell  Display)\n\n```mermaid\nsequenceDiagram\n    participant Shell\n    participant TerminalProcess\n    participant IPtyService\n    participant TerminalProcessManager\n    participant TerminalInstance\n    participant XtermTerminal\n    participant Display\n    \n    Shell-\u003e\u003eTerminalProcess: stdout/stderr data\n    TerminalProcess-\u003e\u003eIPtyService: onProcessData event\n    IPtyService-\u003e\u003eTerminalProcessManager: onProcessData event\n    TerminalProcessManager-\u003e\u003eTerminalInstance: onProcessData event\n    TerminalInstance-\u003e\u003eXtermTerminal: write(data)\n    XtermTerminal-\u003e\u003eDisplay: render via canvas/DOM\n```\n\n**Purpose**: Traces how shell output flows to the display.\n\nData buffering:\n- `TerminalDataBufferer` buffers data before xterm.js is ready\n- `SeamlessRelaunchDataFilter` filters data during relaunch to prevent duplicates\n- Xterm.js renders incrementally via requestAnimationFrame\n\nSources: [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts:789-820](), [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts:1628-1642]()\n\n## Configuration and Settings\n\nKey terminal settings (prefix: `terminal.integrated.`):\n\n| Setting | Description | Default |\n|---------|-------------|---------|\n| `defaultProfile.*` | Default shell profile per OS | OS-dependent |\n| `profiles.*` | Available shell profiles per OS | Auto-detected |\n| `fontFamily` | Terminal font | Editor font |\n| `fontSize` | Font size in pixels | 14 (macOS: 12) |\n| `shellIntegration.enabled` | Enable shell integration | true |\n| `enablePersistentSessions` | Reconnect terminals on reload | true |\n| `tabs.enabled` | Show terminal tabs list | true |\n| `defaultLocation` | Create in panel or editor | 'view' |\n\nProfile resolution:\n1. Check `shellLaunchConfig.executable`\n2. Fall back to `defaultProfile.\u003cos\u003e` setting\n3. Resolve via `ITerminalProfileResolverService`\n4. Apply shell integration injection if enabled\n\nSources: [src/vs/workbench/contrib/terminal/common/terminalConfiguration.ts:45-226](), [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts:512-563]()\n\n## Advanced Features\n\n### Shell Integration Detection\n\nShell integration is detected via injected scripts that emit OSC 633 sequences:\n\n| Shell Type | Injection Method | Script Location |\n|------------|------------------|-----------------|\n| Bash | `PROMPT_COMMAND` | `shellIntegration-bash.sh` |\n| Zsh | `.zshrc` hook | `shellIntegration-zsh.zsh` |\n| PowerShell | Profile script | `shellIntegration.ps1` |\n\nDetection flow:\n1. `getShellIntegrationInjection()` determines injection method\n2. Script injected via args or environment\n3. Script emits `OSC 633;A` on prompt\n4. `ShellIntegrationAddon` parses sequences\n5. Capabilities activated on detection\n\nSources: [src/vs/platform/terminal/node/terminalEnvironment.ts:100-300](), [src/vs/platform/terminal/common/xterm/shellIntegrationAddon.ts:1-100]()\n\n### Terminal Persistence and Reconnection\n\nPersistent sessions are managed through serialization:\n\n```mermaid\ngraph TB\n    subgraph \"Shutdown\"\n        SerializeAddon[\"SerializeAddon\"]\n        TerminalState[\"ISerializedTerminalState\"]\n        LayoutInfo[\"ITerminalsLayoutInfo\"]\n        Storage[\"Workspace Storage\"]\n    end\n    \n    subgraph \"Startup\"\n        RestoreLayout[\"getTerminalLayoutInfo()\"]\n        AttachPersistent[\"attachPersistentProcess\"]\n        Replay[\"Replay buffer\"]\n        RestoreState[\"Restore xterm state\"]\n    end\n    \n    SerializeAddon --\u003e TerminalState\n    TerminalState --\u003e LayoutInfo\n    LayoutInfo --\u003e Storage\n    \n    Storage --\u003e RestoreLayout\n    RestoreLayout --\u003e AttachPersistent\n    AttachPersistent --\u003e Replay\n    Replay --\u003e RestoreState\n```\n\n**Purpose**: Shows the persistence flow for terminal reconnection.\n\nReconnection logic in `TerminalService._reconnectToLocalTerminals()`:\n1. Fetch layout info from `ITerminalBackend.getTerminalLayoutInfo()`\n2. For each persisted terminal, create with `attachPersistentProcess`\n3. Backend provides replay buffer for visible content\n4. Restore serialized state via `SerializeAddon`\n\nSources: [src/vs/workbench/contrib/terminal/browser/terminalService.ts:474-533](), [src/vs/platform/terminal/node/ptyService.ts:294-386]()\n\n### Environment Variable Collections\n\nExtensions can modify terminal environments via `EnvironmentVariableCollection`:\n\n```mermaid\ngraph LR\n    Extension[\"Extension\"]\n    EnvCollection[\"EnvironmentVariableCollection\"]\n    MergedCollection[\"MergedEnvironmentVariableCollection\"]\n    TerminalEnv[\"Terminal Environment\"]\n    \n    Extension --\u003e|\"getEnvironmentVariableCollection()\"| EnvCollection\n    EnvCollection --\u003e|\"set/append/prepend/delete\"| MergedCollection\n    MergedCollection --\u003e|\"applied to\"| TerminalEnv\n```\n\n**Purpose**: Shows how extensions modify terminal environment variables.\n\nMutator types:\n- `Replace`: Replace variable value\n- `Append`: Append to variable value\n- `Prepend`: Prepend to variable value\n\nThe merged collection is serialized and sent to the backend, where it's applied during process creation.\n\nSources: [src/vs/platform/terminal/common/environmentVariableCollection.ts:1-200](), [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts:227-268]()\n\n---\n\nSources: [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts:1-2400](), [src/vs/workbench/contrib/terminal/browser/terminalService.ts:1-1000](), [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts:1-800](), [src/vs/workbench/contrib/terminal/browser/xterm/xtermTerminal.ts:1-900](), [src/vs/workbench/api/common/extHostTerminalService.ts:1-700](), [src/vs/platform/terminal/node/ptyService.ts:1-1000](), [src/vs/platform/terminal/node/terminalProcess.ts:1-600]()"])</script><script>self.__next_f.push([1,"32:T8d10,"])</script><script>self.__next_f.push([1,"# Terminal Architecture Overview\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [src/vs/platform/terminal/common/terminal.ts](src/vs/platform/terminal/common/terminal.ts)\n- [src/vs/platform/terminal/common/terminalEnvironment.ts](src/vs/platform/terminal/common/terminalEnvironment.ts)\n- [src/vs/platform/terminal/common/terminalRecorder.ts](src/vs/platform/terminal/common/terminalRecorder.ts)\n- [src/vs/platform/terminal/node/ptyHostMain.ts](src/vs/platform/terminal/node/ptyHostMain.ts)\n- [src/vs/platform/terminal/node/ptyHostService.ts](src/vs/platform/terminal/node/ptyHostService.ts)\n- [src/vs/platform/terminal/node/ptyService.ts](src/vs/platform/terminal/node/ptyService.ts)\n- [src/vs/platform/terminal/node/terminalProcess.ts](src/vs/platform/terminal/node/terminalProcess.ts)\n- [src/vs/platform/terminal/test/common/terminalEnvironment.test.ts](src/vs/platform/terminal/test/common/terminalEnvironment.test.ts)\n- [src/vs/platform/terminal/test/common/terminalProfiles.test.ts](src/vs/platform/terminal/test/common/terminalProfiles.test.ts)\n- [src/vs/platform/terminal/test/common/terminalRecorder.test.ts](src/vs/platform/terminal/test/common/terminalRecorder.test.ts)\n- [src/vs/workbench/api/browser/mainThreadTerminalService.ts](src/vs/workbench/api/browser/mainThreadTerminalService.ts)\n- [src/vs/workbench/api/common/extHostTerminalService.ts](src/vs/workbench/api/common/extHostTerminalService.ts)\n- [src/vs/workbench/api/node/extHostTerminalService.ts](src/vs/workbench/api/node/extHostTerminalService.ts)\n- [src/vs/workbench/contrib/terminal/browser/media/terminal.css](src/vs/workbench/contrib/terminal/browser/media/terminal.css)\n- [src/vs/workbench/contrib/terminal/browser/media/xterm.css](src/vs/workbench/contrib/terminal/browser/media/xterm.css)\n- [src/vs/workbench/contrib/terminal/browser/remotePty.ts](src/vs/workbench/contrib/terminal/browser/remotePty.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminal.contribution.ts](src/vs/workbench/contrib/terminal/browser/terminal.contribution.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminal.ts](src/vs/workbench/contrib/terminal/browser/terminal.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalActions.ts](src/vs/workbench/contrib/terminal/browser/terminalActions.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalEditor.ts](src/vs/workbench/contrib/terminal/browser/terminalEditor.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalEditorInput.ts](src/vs/workbench/contrib/terminal/browser/terminalEditorInput.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalEditorService.ts](src/vs/workbench/contrib/terminal/browser/terminalEditorService.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalGroup.ts](src/vs/workbench/contrib/terminal/browser/terminalGroup.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalGroupService.ts](src/vs/workbench/contrib/terminal/browser/terminalGroupService.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts](src/vs/workbench/contrib/terminal/browser/terminalInstance.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalInstanceService.ts](src/vs/workbench/contrib/terminal/browser/terminalInstanceService.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalMenus.ts](src/vs/workbench/contrib/terminal/browser/terminalMenus.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalProcessExtHostProxy.ts](src/vs/workbench/contrib/terminal/browser/terminalProcessExtHostProxy.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts](src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalService.ts](src/vs/workbench/contrib/terminal/browser/terminalService.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalStatusList.ts](src/vs/workbench/contrib/terminal/browser/terminalStatusList.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalTabbedView.ts](src/vs/workbench/contrib/terminal/browser/terminalTabbedView.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalTabsList.ts](src/vs/workbench/contrib/terminal/browser/terminalTabsList.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalView.ts](src/vs/workbench/contrib/terminal/browser/terminalView.ts)\n- [src/vs/workbench/contrib/terminal/browser/xterm/xtermTerminal.ts](src/vs/workbench/contrib/terminal/browser/xterm/xtermTerminal.ts)\n- [src/vs/workbench/contrib/terminal/common/terminal.ts](src/vs/workbench/contrib/terminal/common/terminal.ts)\n- [src/vs/workbench/contrib/terminal/common/terminalColorRegistry.ts](src/vs/workbench/contrib/terminal/common/terminalColorRegistry.ts)\n- [src/vs/workbench/contrib/terminal/common/terminalConfiguration.ts](src/vs/workbench/contrib/terminal/common/terminalConfiguration.ts)\n- [src/vs/workbench/contrib/terminal/common/terminalEnvironment.ts](src/vs/workbench/contrib/terminal/common/terminalEnvironment.ts)\n- [src/vs/workbench/contrib/terminal/common/terminalStrings.ts](src/vs/workbench/contrib/terminal/common/terminalStrings.ts)\n- [src/vs/workbench/contrib/terminal/test/browser/terminalStatusList.test.ts](src/vs/workbench/contrib/terminal/test/browser/terminalStatusList.test.ts)\n- [src/vs/workbench/contrib/terminal/test/common/terminalEnvironment.test.ts](src/vs/workbench/contrib/terminal/test/common/terminalEnvironment.test.ts)\n- [src/vs/workbench/contrib/terminalContrib/voice/browser/terminal.voice.contribution.ts](src/vs/workbench/contrib/terminalContrib/voice/browser/terminal.voice.contribution.ts)\n- [src/vs/workbench/contrib/terminalContrib/voice/browser/terminalVoice.ts](src/vs/workbench/contrib/terminalContrib/voice/browser/terminalVoice.ts)\n- [src/vs/workbench/contrib/terminalContrib/voice/browser/terminalVoiceActions.ts](src/vs/workbench/contrib/terminalContrib/voice/browser/terminalVoiceActions.ts)\n\n\u003c/details\u003e\n\n\n\n## Overview\n\nVS Code's terminal system is built on a **multi-process architecture** that isolates shell processes from the renderer to ensure workbench stability. The architecture has four main layers:\n\n**1. Renderer Layer (Workbench)**\n- `TerminalService` ([terminalService.ts:66]()): Main orchestrator coordinating all terminal operations\n- `TerminalInstance` ([terminalInstance.ts:130]()): Individual terminal session with xterm.js UI\n- `TerminalProcessManager` ([terminalProcessManager.ts:74]()): IPC proxy to PTY Host\n\n**2. IPC Layer**\n- Channels: `TerminalIpcChannels.LocalPty`, `TerminalIpcChannels.PtyHost` ([terminal.ts:221-242]())\n- Protocol: electron-ipc for renderer  PTY Host communication\n\n**3. PTY Host Layer (Node.js Process)**\n- `PtyService` ([ptyService.ts:77]()): Manages persistent terminal processes\n- `TerminalProcess` ([terminalProcess.ts:1-500]()): Wraps node-pty for shell spawning\n\n**4. Shell Layer**\n- Native shell processes (bash, zsh, pwsh, cmd.exe, etc.)\n\n**Key architectural benefits:**\n- Shell crashes don't affect workbench\n- Terminals persist across window reloads\n- Backend abstraction supports local/remote/WSL terminals\n- Service-based design enables clean separation of concerns\n\n**Related pages:**\n- 8.2: Terminal Instance and Process Management\n- 8.3: Multi-Server Terminal Support  \n- 8.4: XTerm.js Integration and Rendering\n- 8.5: Terminal UI and Layout\n- 8.6: Shell Integration and Capabilities\n- 8.7: Terminal Persistence and Reconnection\n- 8.8: Terminal Extension API\n\n---\n\n## Multi-Process Architecture\n\n**Diagram: Process Architecture and IPC Communication**\n\n```mermaid\ngraph TB\n    subgraph Renderer[\"Renderer Process (Workbench)\"]\n        TS[\"TerminalService\u003cbr/\u003eterminalService.ts\"]\n        TI[\"TerminalInstance\u003cbr/\u003eterminalInstance.ts\"]\n        TPM[\"TerminalProcessManager\u003cbr/\u003e_processManager\"]\n        XT[\"XtermTerminal\u003cbr/\u003exterm: XtermTerminal\"]\n        \n        TS --\u003e|\"createTerminal()\u003cbr/\u003e_instantiationService\"| TI\n        TI --\u003e|\"_processManager\"| TPM\n        TI --\u003e|\"xterm\"| XT\n    end\n    \n    subgraph IPC[\"IPC Channels\"]\n        LocalPty[\"TerminalIpcChannels.LocalPty\u003cbr/\u003e(renderer  shared process)\"]\n        PtyHostCh[\"TerminalIpcChannels.PtyHost\u003cbr/\u003e(shared process  pty host)\"]\n    end\n    \n    subgraph PtyHost[\"PTY Host Process (separate Node.js)\"]\n        PHS[\"PtyHostService\u003cbr/\u003eptyHostService.ts\u003cbr/\u003eimplements IPtyHostService\"]\n        PS[\"PtyService\u003cbr/\u003eptyService.ts\u003cbr/\u003eimplements IPtyService\"]\n        PTP[\"PersistentTerminalProcess\u003cbr/\u003e_ptys: Map\u003cnumber, PersistentTerminalProcess\u003e\"]\n        TP[\"TerminalProcess\u003cbr/\u003eterminalProcess.ts\"]\n        NPty[\"node-pty\u003cbr/\u003eIPty interface\"]\n        \n        PHS --\u003e|\"_delegate\"| PS\n        PS --\u003e|\"_ptys.get(id)\"| PTP\n        PTP --\u003e|\"_terminalProcess\"| TP\n        TP --\u003e|\"_pty\"| NPty\n    end\n    \n    subgraph Shell[\"Shell Processes\"]\n        ShellProc[\"bash / zsh / pwsh /\u003cbr/\u003ecmd.exe / fish\"]\n    end\n    \n    subgraph ExtHost[\"Extension Host Process\"]\n        EHTS[\"ExtHostTerminalService\u003cbr/\u003eextHostTerminalService.ts\"]\n        TPProxy[\"TerminalProcessExtHostProxy\u003cbr/\u003eimplements ITerminalChildProcess\"]\n    end\n    \n    TPM --\u003e|\"$createProcess(config)\"| LocalPty\n    LocalPty --\u003e|\"ProxyChannel\"| PtyHostCh\n    PtyHostCh --\u003e|\"createProcess()\"| PHS\n    \n    NPty --\u003e|\"spawn(exe, args, env)\"| ShellProc\n    ShellProc -.-\u003e|\"stdout/stderr\"| NPty\n    TP -.-\u003e|\"_onProcessData.fire()\"| PS\n    PS -.-\u003e|\"onProcessData\"| PtyHostCh\n    PtyHostCh -.-\u003e|event| LocalPty\n    LocalPty -.-\u003e|\"onProcessData\"| TPM\n    TPM -.-\u003e|\"xterm.write(data)\"| XT\n    \n    EHTS --\u003e|\"Pseudoterminal API\"| TPProxy\n    TPProxy -.-\u003e|\"ExtHost RPC\"| TPM\n```\n\n**Process Isolation Strategy:**\n\n| Aspect | Code Entity | Purpose |\n|--------|-------------|---------|\n| **Shell Process Isolation** | PTY host process spawned by `PtyHostService` | Prevents shell crashes from affecting workbench; enables CPU-intensive operations without blocking UI |\n| **IPC Channels** | `TerminalIpcChannels` enum ([terminal.ts:221-242]()): `LocalPty`, `PtyHost`, `PtyHostWindow` | Type-safe bidirectional communication between renderer and PTY host |\n| **Backend Abstraction** | `ITerminalBackend` interface with `getBackend(remoteAuthority?)` | Unified API for local, remote (SSH), and WSL terminals |\n| **Process Registry** | `PtyService._ptys: Map\u003cnumber, PersistentTerminalProcess\u003e` ([ptyService.ts:80]()) | Persists terminal processes across window reloads; enables reconnection |\n| **State Machine** | `ProcessState` enum ([terminal.ts:316-333]()): `Uninitialized`  `Launching`  `Running`  `Killed*` | Tracks process lifecycle; distinguishes launch failures from normal exits |\n\n**IPC Message Flow:**\n\n```\nUser types in terminal  XtermTerminal.onData  TerminalInstance._handleOnData()\n   TerminalProcessManager.write()  IPC.$sendProcessData(id, data)\n   PtyService.processSendData()  TerminalProcess.input()\n   node-pty IPty.write()  shell stdin\n\nShell stdout  node-pty onData  TerminalProcess._onProcessData\n   PtyService._onProcessData  IPC.onProcessData event\n   TerminalProcessManager.onProcessData  TerminalInstance writes to XtermTerminal\n```\n\n**Sources:**\n- [src/vs/workbench/contrib/terminal/browser/terminalService.ts:66-239]()\n- [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts:130-651]()\n- [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts:74-167]()\n- [src/vs/platform/terminal/node/ptyService.ts:77-350]()\n- [src/vs/platform/terminal/node/terminalProcess.ts:1-500]()\n- [src/vs/platform/terminal/common/terminal.ts:221-333]()\n\n---\n\n## Core Service Architecture\n\n**Diagram: Service Layer and Dependencies**\n\n```mermaid\ngraph TB\n    subgraph CoreServices[\"Core Services (Singletons)\"]\n        TerminalService[\"TerminalService\u003cbr/\u003eimplements ITerminalService\"]\n        TerminalGroupService[\"TerminalGroupService\u003cbr/\u003eimplements ITerminalGroupService\"]\n        TerminalEditorService[\"TerminalEditorService\u003cbr/\u003eimplements ITerminalEditorService\"]\n        TerminalInstanceService[\"TerminalInstanceService\u003cbr/\u003eimplements ITerminalInstanceService\"]\n    end\n    \n    subgraph ConfigServices[\"Configuration Services\"]\n        TerminalConfigurationService[\"TerminalConfigurationService\"]\n        TerminalProfileService[\"TerminalProfileService\"]\n        TerminalProfileResolverService[\"TerminalProfileResolverService\"]\n    end\n    \n    subgraph InstanceLayer[\"Instance Layer\"]\n        TerminalInstance[\"TerminalInstance\"]\n        TerminalGroup[\"TerminalGroup\"]\n        TerminalProcessManager[\"TerminalProcessManager\"]\n    end\n    \n    subgraph BackendLayer[\"Backend Layer\"]\n        BackendRegistry[\"Backend Registry\u003cbr/\u003eMap\u003cremoteAuthority, ITerminalBackend\u003e\"]\n        LocalBackend[\"LocalTerminalBackend\"]\n        RemoteTerminalBackend[\"RemoteTerminalBackend\"]\n    end\n    \n    TerminalService --\u003e|\"_terminalGroupService\"| TerminalGroupService\n    TerminalService --\u003e|\"_terminalEditorService\"| TerminalEditorService\n    TerminalService --\u003e|\"_terminalInstanceService\"| TerminalInstanceService\n    TerminalService --\u003e|\"getPrimaryBackend()\"| BackendRegistry\n    \n    TerminalInstanceService --\u003e|\"createInstance()\"| TerminalInstance\n    TerminalGroupService --\u003e|\"groups: ITerminalGroup[]\"| TerminalGroup\n    TerminalEditorService --\u003e|\"_terminalEditorInstances\"| TerminalInstance\n    \n    TerminalGroup --\u003e|\"terminalInstances\"| TerminalInstance\n    TerminalInstance --\u003e|\"_processManager\"| TerminalProcessManager\n    \n    TerminalProcessManager --\u003e|\"backend\"| BackendRegistry\n    BackendRegistry --\u003e|undefined| LocalBackend\n    BackendRegistry --\u003e|remoteAuthority| RemoteTerminalBackend\n    \n    TerminalConfigurationService --\u003e|config| TerminalService\n    TerminalProfileService --\u003e|profiles| TerminalService\n    TerminalProfileResolverService --\u003e|resolution| TerminalService\n```\n\n**Service Responsibilities:**\n\n| Service Interface | Implementation | Key Members | Responsibility |\n|-------------------|----------------|-------------|----------------|\n| `ITerminalService` ([terminal.ts:39]()) | `TerminalService` ([terminalService.ts:66]()) | `instances`, `activeInstance`, `connectionState`, `createTerminal()`, `getPrimaryBackend()` | Main coordinator for all terminal operations; manages lifecycle, backends, and cross-cutting concerns |\n| `ITerminalGroupService` ([terminal.ts:43]()) | `TerminalGroupService` | `groups: ITerminalGroup[]`, `activeGroup`, `showPanel()`, `hidePanel()` | Manages terminal panel groups, tabs, and split panes in the panel view |\n| `ITerminalEditorService` ([terminal.ts:41]()) | `TerminalEditorService` | `instances`, `activeInstance`, `openEditor()`, `detachInstance()` | Manages terminals in editor area; bridges terminal and editor systems |\n| `ITerminalInstanceService` ([terminal.ts:44]()) | `TerminalInstanceService` | `createInstance()`, `getBackend(remoteAuthority)`, `onDidCreateInstance` | Factory for `TerminalInstance`; manages backend registry; low-level service |\n| `ITerminalConfigurationService` ([terminal.ts:40]()) | `TerminalConfigurationService` | `config: ITerminalConfiguration`, cached derived values | Provides configuration access with caching and computed properties |\n| `ITerminalProfileService` (common/[terminal.ts:73]()) | `TerminalProfileService` | `availableProfiles`, `contributedProfiles`, `getDefaultProfile()` | Detects shell profiles; manages extension-contributed profiles |\n| `ITerminalProfileResolverService` (common/[terminal.ts:45]()) | Platform-specific | `resolveShellLaunchConfig()`, `getDefaultProfile()`, `getDefaultShell()` | Resolves shell paths and profiles per platform (Windows/macOS/Linux) |\n\n**Service Registration:**\n\nServices are registered as singletons in [terminal.contribution.ts]() using `registerSingleton()`:\n\n```typescript\n// Eager initialization (needed early in startup)\nregisterSingleton(ITerminalInstanceService, TerminalInstanceService, InstantiationType.Eager);\n\n// Delayed initialization (lazy-loaded on first use)\nregisterSingleton(ITerminalService, TerminalService, InstantiationType.Delayed);\nregisterSingleton(ITerminalGroupService, TerminalGroupService, InstantiationType.Delayed);\nregisterSingleton(ITerminalEditorService, TerminalEditorService, InstantiationType.Delayed);\nregisterSingleton(ITerminalConfigurationService, TerminalConfigurationService, InstantiationType.Delayed);\n```\n\n**Dependency Graph**: `ITerminalService` depends on most other terminal services via constructor injection. Services request dependencies using `@IServiceName` decorators, creating a graph with `TerminalService` as the main orchestrator.\n\n**Sources:**\n- [src/vs/workbench/contrib/terminal/browser/terminalService.ts:66-239]()\n- [src/vs/workbench/contrib/terminal/browser/terminal.ts:39-788]()\n- [src/vs/workbench/contrib/terminal/browser/terminalGroupService.ts:1-100]()\n- [src/vs/workbench/contrib/terminal/browser/terminalEditorService.ts:1-100]()\n- [src/vs/workbench/contrib/terminal/browser/terminalInstanceService.ts:1-100]()\n- [src/vs/workbench/contrib/terminal/browser/terminal.contribution.ts:1-100]()\n\n---\n\n## Terminal Instance Structure\n\n**Diagram: TerminalInstance Class Structure**\n\n```mermaid\ngraph TB\n    subgraph TerminalInstance[\"TerminalInstance (Disposable)\"]\n        InstanceCore[\"Core Properties\u003cbr/\u003e_instanceId: number\u003cbr/\u003e_resource: URI\u003cbr/\u003e_shellLaunchConfig: IShellLaunchConfig\u003cbr/\u003e_wrapperElement: HTMLElement\"]\n        \n        subgraph Components[\"Owned Components\"]\n            ProcessManager[\"_processManager\u003cbr/\u003eTerminalProcessManager\"]\n            XtermWrapper[\"xterm?: XtermTerminal\"]\n            WidgetMgr[\"_widgetManager\u003cbr/\u003eTerminalWidgetManager\"]\n            StatusList[\"statusList\u003cbr/\u003eTerminalStatusList\"]\n            Capabilities[\"capabilities\u003cbr/\u003eTerminalCapabilityStoreMultiplexer\"]\n        end\n        \n        subgraph State[\"State Tracking\"]\n            DimensionState[\"_cols: number\u003cbr/\u003e_rows: number\u003cbr/\u003e_fixedCols?: number\u003cbr/\u003e_fixedRows?: number\"]\n            ProcessState[\"_exitCode?: number\u003cbr/\u003e_exitReason?: TerminalExitReason\u003cbr/\u003e_isVisible: boolean\"]\n            TitleState[\"_title: string\u003cbr/\u003e_titleSource: TitleEventSource\u003cbr/\u003e_cwd?: string\u003cbr/\u003e_initialCwd?: string\"]\n        end\n    end\n    \n    subgraph ContextKeys[\"Context Keys\"]\n        FocusKey[\"_terminalFocusContextKey\u003cbr/\u003eTerminalContextKeys.focus\"]\n        HasTextKey[\"_terminalHasTextContextKey\u003cbr/\u003eTerminalContextKeys.textSelected\"]\n        AltBufferKey[\"_terminalAltBufferActiveContextKey\"]\n        ShellIntKey[\"_terminalShellIntegrationEnabledContextKey\"]\n    end\n    \n    subgraph ExternalDeps[\"External Dependencies\"]\n        ConfigSvc[\"ITerminalConfigurationService\"]\n        InstSvc[\"IInstantiationService\"]\n        ContextKeySvc[\"IContextKeyService\"]\n        ThemeSvc[\"IThemeService\"]\n    end\n    \n    InstanceCore --\u003e|owns| ProcessManager\n    InstanceCore --\u003e|owns| XtermWrapper\n    InstanceCore --\u003e|owns| WidgetMgr\n    InstanceCore --\u003e|owns| StatusList\n    InstanceCore --\u003e|owns| Capabilities\n    \n    ProcessManager --\u003e|\"capabilities\"| Capabilities\n    XtermWrapper --\u003e|\"shellIntegration\"| Capabilities\n    \n    InstanceCore --\u003e|manages| DimensionState\n    InstanceCore --\u003e|manages| ProcessState\n    InstanceCore --\u003e|manages| TitleState\n    \n    InstanceCore --\u003e|binds| FocusKey\n    InstanceCore --\u003e|binds| HasTextKey\n    InstanceCore --\u003e|binds| AltBufferKey\n    InstanceCore --\u003e|binds| ShellIntKey\n    \n    InstanceCore --\u003e|injected| ConfigSvc\n    InstanceCore --\u003e|injected| InstSvc\n    InstanceCore --\u003e|injected| ContextKeySvc\n    InstanceCore --\u003e|injected| ThemeSvc\n```\n\n**Key Instance Properties:**\n\n| Category | Property | Type | Description |\n|----------|----------|------|-------------|\n| **Identity** | `instanceId` | `number` | Unique ID from `static _instanceIdCounter` ([terminalInstance.ts:132]()) |\n| | `sessionId` | `string` | Generated UUID for session tracking ([terminalInstance.ts:363]()) |\n| | `resource` | `URI` | Terminal URI via `getTerminalUri(workspaceId, instanceId, title)` ([terminalInstance.ts:414]()) |\n| **Process** | `_processManager` | `TerminalProcessManager` | Manages shell process lifecycle and IPC ([terminalInstance.ts:136]()) |\n| | `processId` | `number \\| undefined` | Shell process PID from `_processManager.shellProcessId` ([terminalInstance.ts:263]()) |\n| | `processReady` | `Promise\u003cvoid\u003e` | Resolves when PTY spawns (`_processManager.ptyProcessReady`) ([terminalInstance.ts:266]()) |\n| **UI** | `xterm` | `XtermTerminal \\| undefined` | xterm.js wrapper (undefined until `_createXterm()` completes) ([terminalInstance.ts:214]()) |\n| | `_wrapperElement` | `HTMLElement` | DOM container with class `terminal-wrapper` ([terminalInstance.ts:161-162]()) |\n| | `domElement` | `HTMLElement` (getter) | Returns `_wrapperElement` ([terminalInstance.ts:162]()) |\n| **Capabilities** | `capabilities` | `TerminalCapabilityStoreMultiplexer` | Aggregates capabilities from process and xterm ([terminalInstance.ts:205]()) |\n| | `statusList` | `ITerminalStatusList` | Status indicators (e.g., disconnected, readonly) ([terminalInstance.ts:206]()) |\n| **State** | `cols`/`rows` | `number` | Current dimensions; respects `_fixedCols`/`_fixedRows` if set ([terminalInstance.ts:233-256]()) |\n| | `title` | `string` | Computed from process/API/config via `_setTitle()` ([terminalInstance.ts:281]()) |\n| | `exitCode` | `number \\| undefined` | Process exit code ([terminalInstance.ts:271]()) |\n| | `target` | `TerminalLocation \\| undefined` | Current location (Panel/Editor) ([terminalInstance.ts:225]()) |\n\n**Key Instance Methods:**\n\n**Key Methods:**\n\n```typescript\n// From TerminalInstance class (terminalInstance.ts:129-1800)\nclass TerminalInstance extends Disposable implements ITerminalInstance {\n  // Lifecycle initialization\n  constructor(_terminalShellTypeContextKey, _shellLaunchConfig, /* 20+ injected services */);\n  private async _createXterm(): Promise\u003cXtermTerminal | undefined\u003e;  // Creates xterm.js wrapper\n  private async _createProcess(): Promise\u003cvoid\u003e;  // Spawns shell via TerminalProcessManager\n  \n  // User interaction\n  async sendText(text: string, addNewLine?: boolean, bracketedPasteMode?: boolean): Promise\u003cvoid\u003e;\n  async sendPath(uri: URI, addNewLine: boolean): Promise\u003cvoid\u003e;  // Sends file path to terminal\n  async runCommand(commandLine: string, shouldExecute: boolean): Promise\u003cvoid\u003e;  // Shell integration command\n  \n  // Focus and layout\n  async focusWhenReady(force?: boolean): Promise\u003cvoid\u003e;  // Waits for xterm before focusing\n  layout(dimension: dom.IDimension): void;  // Resizes terminal to fit container\n  setVisible(visible: boolean): void;  // Shows/hides terminal\n  \n  // Disposal\n  dispose(reason?: TerminalExitReason): void;  // Kills process and cleans up\n  async detachProcessAndDispose(reason: TerminalExitReason): Promise\u003cvoid\u003e;  // Preserves process for reconnection\n}\n```\n\n**Sources:**\n- [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts:129-1800]()\n- [src/vs/workbench/contrib/terminal/browser/terminal.ts:390-600]()\n- [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts:74-500]()\n\n---\n\n## Terminal Locations and Layout\n\nTerminals can exist in multiple locations within VS Code, each managed by different services.\n\n```mermaid\ngraph TB\n    subgraph \"Terminal Locations\"\n        Panel[\"TerminalLocation.Panel\u003cbr/\u003e(ITerminalGroupService)\"]\n        Editor[\"TerminalLocation.Editor\u003cbr/\u003e(ITerminalEditorService)\"]\n    end\n    \n    subgraph \"Panel Layout\"\n        ViewPane[\"TerminalViewPane\"]\n        TabbedView[\"TerminalTabbedView\"]\n        SplitView[\"SplitView\"]\n        TabList[\"TerminalTabList\"]\n        Groups[\"TerminalGroup[]\"]\n        \n        ViewPane --\u003e|contains| TabbedView\n        TabbedView --\u003e|uses| SplitView\n        TabbedView --\u003e|shows| TabList\n        SplitView --\u003e|manages| Groups\n    end\n    \n    subgraph \"Editor Layout\"\n        TermEditor[\"TerminalEditor\"]\n        EditorInput[\"TerminalEditorInput\"]\n        EditorGroups[\"IEditorGroupsService\"]\n        \n        TermEditor --\u003e|backed by| EditorInput\n        EditorGroups --\u003e|hosts| TermEditor\n    end\n    \n    Panel --\u003e|rendered in| ViewPane\n    Editor --\u003e|rendered in| TermEditor\n    \n    Groups --\u003e|contains| TI1[\"TerminalInstance\"]\n    Groups --\u003e|contains| TI2[\"TerminalInstance\"]\n    EditorInput --\u003e|wraps| TI3[\"TerminalInstance\"]\n```\n\n**Location Types:**\n\n| Location | Managed By | UI Container | Use Case |\n|----------|------------|--------------|----------|\n| `TerminalLocation.Panel` | `ITerminalGroupService` | `TerminalViewPane` | Default location, supports tabs and groups |\n| `TerminalLocation.Editor` | `ITerminalEditorService` | `TerminalEditor` | Integrated with editor area, full layout support |\n\n**Sources:**\n- [src/vs/workbench/contrib/terminal/browser/terminalView.ts:57-400]()\n- [src/vs/workbench/contrib/terminal/browser/terminalTabbedView.ts:43-500]()\n- [src/vs/workbench/contrib/terminal/browser/terminalEditor.ts:1-200]()\n- [src/vs/platform/terminal/common/terminal.ts:1-100]()\n\n---\n\n## Process Management Flow\n\nThe process management architecture handles the complete lifecycle from creation to exit.\n\n```mermaid\nsequenceDiagram\n    participant UI as TerminalInstance\n    participant PM as TerminalProcessManager\n    participant IPC as IPC Channel\n    participant PTY as PtyService\n    participant Proc as TerminalProcess\n    participant Shell as Shell Process\n    \n    UI-\u003e\u003ePM: createProcess(shellLaunchConfig, cols, rows)\n    PM-\u003e\u003eIPC: $createProcess(config, dims)\n    IPC-\u003e\u003ePTY: createProcess(...)\n    PTY-\u003e\u003eProc: new TerminalProcess(config)\n    Proc-\u003e\u003eShell: spawn(executable, args, env)\n    \n    Shell--\u003e\u003eProc: process started (pid)\n    Proc--\u003e\u003ePTY: onProcessReady(pid, cwd)\n    PTY--\u003e\u003eIPC: emit processReady\n    IPC--\u003e\u003ePM: onProcessReady event\n    PM--\u003e\u003eUI: emit onProcessReady\n    \n    Shell--\u003e\u003eProc: stdout data\n    Proc--\u003e\u003ePTY: onProcessData(data)\n    PTY--\u003e\u003eIPC: emit processData\n    IPC--\u003e\u003ePM: onProcessData event\n    PM--\u003e\u003eUI: emit onProcessData\n    UI-\u003e\u003eUI: xterm.write(data)\n    \n    UI-\u003e\u003ePM: write(text)\n    PM-\u003e\u003eIPC: $sendProcessData(id, text)\n    IPC-\u003e\u003ePTY: processSendData(id, text)\n    PTY-\u003e\u003eProc: input(text)\n    Proc-\u003e\u003eShell: stdin.write(text)\n    \n    Shell--\u003e\u003eProc: exit(code)\n    Proc--\u003e\u003ePTY: onProcessExit(code)\n    PTY--\u003e\u003eIPC: emit processExit\n    IPC--\u003e\u003ePM: onProcessExit event\n    PM--\u003e\u003eUI: emit onProcessExit\n    UI-\u003e\u003eUI: dispose()\n```\n\n**Process States:**\n\n```typescript\n// From ProcessState enum\nenum ProcessState {\n  Uninitialized = 1,    // Not yet started\n  Launching = 2,        // Being created\n  Running = 3,          // Active\n  KilledDuringLaunch = 4,\n  KilledByUser = 5,\n  KilledByProcess = 6\n}\n```\n\n**Sources:**\n- [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts:74-600]()\n- [src/vs/platform/terminal/node/ptyService.ts:77-600]()\n- [src/vs/platform/terminal/node/terminalProcess.ts:1-500]()\n- [src/vs/platform/terminal/common/terminal.ts:244-333]()\n\n---\n\n## Extension Integration Architecture\n\nExtensions integrate with the terminal system through the Extension Host RPC layer.\n\n```mermaid\ngraph TB\n    subgraph \"Extension API\"\n        ExtAPI[\"vscode.window API\"]\n        ExtTerm[\"vscode.Terminal\"]\n        PseudoAPI[\"vscode.Pseudoterminal\"]\n    end\n    \n    subgraph \"Extension Host\"\n        EHTS[\"ExtHostTerminalService\"]\n        ExtHostTerm[\"ExtHostTerminal\"]\n        PtyProxy[\"TerminalProcessExtHostProxy\"]\n    end\n    \n    subgraph \"Main Thread\"\n        MTTS[\"MainThreadTerminalService\"]\n        TS[\"ITerminalService\"]\n        TI[\"TerminalInstance\"]\n        TPM[\"TerminalProcessManager\"]\n    end\n    \n    ExtAPI --\u003e|creates| ExtTerm\n    ExtTerm --\u003e|backed by| ExtHostTerm\n    ExtHostTerm --\u003e|managed by| EHTS\n    \n    PseudoAPI --\u003e|implements| PtyProxy\n    \n    EHTS \u003c--\u003e|RPC Protocol| MTTS\n    PtyProxy \u003c--\u003e|IPC| TPM\n    \n    MTTS --\u003e|calls| TS\n    TS --\u003e|manages| TI\n    TI --\u003e|contains| TPM\n```\n\n**Extension Terminal Types:**\n\n| Type | Creation | Process | Use Case |\n|------|----------|---------|----------|\n| Normal Terminal | `createTerminal(options)` | Real PTY | Standard shell terminals |\n| Extension Terminal | `createTerminal({ pty })` | `Pseudoterminal` | Custom implementations |\n| Task Terminal | Task system | Real PTY | Task execution |\n\n**RPC Protocol Methods:**\n\n```typescript\n// Main thread API (ExtHost  Main)\ninterface MainThreadTerminalServiceShape {\n  $createTerminal(extHostTerminalId: ExtHostTerminalIdentifier, launchConfig: TerminalLaunchConfig): Promise\u003cvoid\u003e;\n  $sendText(terminalId: number, text: string, shouldExecute: boolean): void;\n  $show(terminalId: number, preserveFocus: boolean): void;\n  $hide(terminalId: number): void;\n  $dispose(terminalId: number): void;\n}\n\n// Extension host callbacks (Main  ExtHost)\ninterface ExtHostTerminalServiceShape {\n  $acceptProcessId(terminalId: number, processId: number): void;\n  $acceptProcessData(terminalId: number, data: string): void;\n  $acceptProcessExit(terminalId: number, exitCode: number | undefined): void;\n  $acceptProcessReady(terminalId: number, pid: number, cwd: string): void;\n}\n```\n\n**Sources:**\n- [src/vs/workbench/api/common/extHostTerminalService.ts:33-800]()\n- [src/vs/workbench/api/browser/mainThreadTerminalService.ts:1-600]()\n- [src/vs/workbench/contrib/terminal/browser/terminalProcessExtHostProxy.ts:1-200]()\n- [src/vs/workbench/api/common/extHost.protocol.ts:1-100]()\n\n---\n\n## XTerm.js Integration\n\nThe `XtermTerminal` class wraps xterm.js and manages addons, themes, and terminal rendering.\n\n```mermaid\ngraph TB\n    subgraph \"XtermTerminal Wrapper\"\n        XTW[\"XtermTerminal\u003cbr/\u003e(IXtermTerminal)\"]\n        Raw[\"raw: RawXtermTerminal\u003cbr/\u003e(xterm.js Terminal)\"]\n    end\n    \n    subgraph \"Core Addons\"\n        Search[\"SearchAddon\"]\n        Unicode[\"Unicode11Addon\"]\n        WebGL[\"WebglAddon\u003cbr/\u003e(GPU acceleration)\"]\n        Serialize[\"SerializeAddon\"]\n        Image[\"ImageAddon\"]\n        Clipboard[\"ClipboardAddon\"]\n    end\n    \n    subgraph \"VS Code Addons\"\n        ShellInt[\"ShellIntegrationAddon\"]\n        Decoration[\"DecorationAddon\"]\n        MarkNav[\"MarkNavigationAddon\"]\n    end\n    \n    subgraph \"Capabilities\"\n        CapStore[\"ITerminalCapabilityStore\"]\n        CwdDetect[\"CwdDetectionCapability\"]\n        CmdDetect[\"CommandDetectionCapability\"]\n    end\n    \n    XTW --\u003e|wraps| Raw\n    XTW --\u003e|loads| Search\n    XTW --\u003e|loads| Unicode\n    XTW --\u003e|loads| WebGL\n    XTW --\u003e|loads| Serialize\n    XTW --\u003e|loads| Image\n    XTW --\u003e|loads| Clipboard\n    \n    XTW --\u003e|loads| ShellInt\n    XTW --\u003e|loads| Decoration\n    XTW --\u003e|loads| MarkNav\n    \n    ShellInt --\u003e|provides| CapStore\n    CapStore --\u003e|contains| CwdDetect\n    CapStore --\u003e|contains| CmdDetect\n```\n\n**Key XtermTerminal Members:**\n\n```typescript\n// From XtermTerminal class (xtermTerminal.ts:200-1500)\nclass XtermTerminal extends Disposable implements IXtermTerminal {\n  readonly raw: RawXtermTerminal;  // Underlying xterm.js Terminal instance\n  readonly shellIntegration: IShellIntegration;  // Shell integration state\n  \n  // Addon management\n  async loadAddon(addon: ITerminalAddon): Promise\u003cvoid\u003e;  // Dynamically loads addons\n  \n  // Appearance\n  updateTheme(theme: IColorTheme): void;  // Updates colors from theme\n  updateConfig(): void;  // Applies configuration changes\n  \n  // I/O operations\n  write(data: string | Uint8Array): Promise\u003cvoid\u003e;  // Writes to terminal\n  resize(cols: number, rows: number): void;  // Changes dimensions\n  clearBuffer(): void;  // Clears scrollback\n  \n  // Search\n  findNext(term: string, options?: ISearchOptions): Promise\u003cboolean\u003e;\n  findPrevious(term: string, options?: ISearchOptions): Promise\u003cboolean\u003e;\n  \n  // Shell integration\n  markTracker: IMarkTracker;  // Command decoration tracking\n}\n```\n\n**Sources:**\n- [src/vs/workbench/contrib/terminal/browser/xterm/xtermTerminal.ts:1-1500]()\n- [src/vs/platform/terminal/common/xterm/shellIntegrationAddon.ts:1-500]()\n- [src/vs/workbench/contrib/terminal/browser/xterm/decorationAddon.ts:1-300]()\n- [src/vs/workbench/contrib/terminal/browser/xterm/markNavigationAddon.ts:1-200]()\n\n---\n\n## Configuration and Profiles\n\nTerminal configuration is hierarchical and supports multiple shell profiles per platform.\n\n```mermaid\ngraph TB\n    subgraph \"Configuration Services\"\n        ICS[\"IConfigurationService\u003cbr/\u003e(workspace settings)\"]\n        ITCS[\"ITerminalConfigurationService\u003cbr/\u003e(terminal-specific)\"]\n        ITPS[\"ITerminalProfileService\u003cbr/\u003e(profile detection)\"]\n        ITPRS[\"ITerminalProfileResolverService\u003cbr/\u003e(profile resolution)\"]\n    end\n    \n    subgraph \"Configuration Sources\"\n        UserSettings[\"User Settings\u003cbr/\u003e(settings.json)\"]\n        WorkspaceSettings[\"Workspace Settings\u003cbr/\u003e(.vscode/settings.json)\"]\n        DefaultProfiles[\"Default Profiles\u003cbr/\u003e(per-platform)\"]\n        ContribProfiles[\"Contributed Profiles\u003cbr/\u003e(extensions)\"]\n    end\n    \n    subgraph \"Profile Resolution\"\n        Profile[\"ITerminalProfile\"]\n        SLC[\"IShellLaunchConfig\"]\n        ResolvedConfig[\"Resolved Config\u003cbr/\u003e(executable, args, env)\"]\n    end\n    \n    ICS --\u003e|reads| UserSettings\n    ICS --\u003e|reads| WorkspaceSettings\n    \n    ITCS --\u003e|wraps| ICS\n    ITPS --\u003e|detects| DefaultProfiles\n    ITPS --\u003e|reads| ContribProfiles\n    \n    ITPRS --\u003e|uses| ITPS\n    ITPRS --\u003e|uses| ITCS\n    \n    Profile --\u003e|resolves to| SLC\n    SLC --\u003e|resolves to| ResolvedConfig\n    ITPRS --\u003e|performs| ResolvedConfig\n```\n\n**Key Configuration Settings:**\n\n| Setting ID (TerminalSettingId) | Type | Description |\n|--------------------------------|------|-------------|\n| `ProfilesWindows`, `ProfilesMacOs`, `ProfilesLinux` | `ITerminalProfiles` | Shell profiles per platform ([terminal.ts:33-38]()) |\n| `DefaultProfileWindows`, `DefaultProfileMacOs`, `DefaultProfileLinux` | `string \\| null` | Default profile name per platform ([terminal.ts:36-38]()) |\n| `Cwd` | `string` | Default working directory ([terminal.ts:79]()) |\n| `EnvWindows`, `EnvMacOs`, `EnvLinux` | `ITerminalEnvironment` | Per-platform environment variables ([terminal.ts:88-90]()) |\n| `ShellIntegrationEnabled` | `boolean` | Enable shell integration ([terminal.ts:110]()) |\n| `FontFamily`, `FontSize`, `LineHeight` | `string`, `number`, `number` | Font configuration ([terminal.ts:55-58]()) |\n\n**Sources:**\n- [src/vs/workbench/contrib/terminal/common/terminalConfiguration.ts:1-600]()\n- [src/vs/workbench/contrib/terminal/browser/terminalProfileService.ts:1-300]()\n- [src/vs/platform/terminal/common/terminal.ts:22-132]()\n- [src/vs/workbench/contrib/terminal/common/terminal.ts:102-217]()\n\n---\n\n## Terminal Lifecycle Summary\n\nThe complete lifecycle of a terminal from creation to disposal:\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e Creating: createTerminal()\n    Creating --\u003e WaitingForContainer: TerminalInstance constructed\n    WaitingForContainer --\u003e ResolvingProfile: Container ready\n    ResolvingProfile --\u003e CreatingProcess: Profile resolved\n    CreatingProcess --\u003e Launching: IPC create request sent\n    Launching --\u003e ProcessReady: PTY spawned\n    ProcessReady --\u003e Running: Process ID received\n    \n    Running --\u003e DataFlow: Normal operation\n    DataFlow --\u003e Running: User input / Process output\n    \n    Running --\u003e Exited: Process exits\n    Running --\u003e Disposed: User closes terminal\n    \n    Exited --\u003e WaitingForExit: waitOnExit enabled\n    WaitingForExit --\u003e Disposed: User dismisses\n    \n    Exited --\u003e Disposed: Auto-dispose\n    Disposed --\u003e [*]\n```\n\n**Key Lifecycle Events:**\n\n| Event | Source | When Fired | Line Reference |\n|-------|--------|------------|----------------|\n| `onDidCreateInstance` | `ITerminalService` | After `TerminalInstance` constructed | [terminalService.ts:129]() |\n| `onProcessReady` | `TerminalInstance` | After PTY spawns with PID | [terminalInstance.ts:313]() |\n| `onProcessData` | `TerminalProcessManager` | On stdout/stderr data | [terminalProcessManager.ts:117]() |\n| `onProcessExit` | `TerminalProcessManager` | When shell exits | [terminalProcessManager.ts:125]() |\n| `onDisposed` | `TerminalInstance` | After cleanup complete | [terminalInstance.ts:311]() |\n\n**Sources:**\n- [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts:366-650]()\n- [src/vs/workbench/contrib/terminal/browser/terminalService.ts:129-240]()\n- [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts:106-167]()"])</script><script>self.__next_f.push([1,"33:T76c2,"])</script><script>self.__next_f.push([1,"# Terminal Instance and Process Management\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [src/vs/platform/terminal/common/terminal.ts](src/vs/platform/terminal/common/terminal.ts)\n- [src/vs/platform/terminal/common/terminalEnvironment.ts](src/vs/platform/terminal/common/terminalEnvironment.ts)\n- [src/vs/platform/terminal/common/terminalRecorder.ts](src/vs/platform/terminal/common/terminalRecorder.ts)\n- [src/vs/platform/terminal/node/ptyHostMain.ts](src/vs/platform/terminal/node/ptyHostMain.ts)\n- [src/vs/platform/terminal/node/ptyHostService.ts](src/vs/platform/terminal/node/ptyHostService.ts)\n- [src/vs/platform/terminal/node/ptyService.ts](src/vs/platform/terminal/node/ptyService.ts)\n- [src/vs/platform/terminal/node/terminalProcess.ts](src/vs/platform/terminal/node/terminalProcess.ts)\n- [src/vs/platform/terminal/test/common/terminalEnvironment.test.ts](src/vs/platform/terminal/test/common/terminalEnvironment.test.ts)\n- [src/vs/platform/terminal/test/common/terminalProfiles.test.ts](src/vs/platform/terminal/test/common/terminalProfiles.test.ts)\n- [src/vs/platform/terminal/test/common/terminalRecorder.test.ts](src/vs/platform/terminal/test/common/terminalRecorder.test.ts)\n- [src/vs/workbench/api/browser/mainThreadTerminalService.ts](src/vs/workbench/api/browser/mainThreadTerminalService.ts)\n- [src/vs/workbench/api/common/extHostTerminalService.ts](src/vs/workbench/api/common/extHostTerminalService.ts)\n- [src/vs/workbench/api/node/extHostTerminalService.ts](src/vs/workbench/api/node/extHostTerminalService.ts)\n- [src/vs/workbench/contrib/terminal/browser/media/terminal.css](src/vs/workbench/contrib/terminal/browser/media/terminal.css)\n- [src/vs/workbench/contrib/terminal/browser/media/xterm.css](src/vs/workbench/contrib/terminal/browser/media/xterm.css)\n- [src/vs/workbench/contrib/terminal/browser/remotePty.ts](src/vs/workbench/contrib/terminal/browser/remotePty.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminal.contribution.ts](src/vs/workbench/contrib/terminal/browser/terminal.contribution.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminal.ts](src/vs/workbench/contrib/terminal/browser/terminal.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalActions.ts](src/vs/workbench/contrib/terminal/browser/terminalActions.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalEditor.ts](src/vs/workbench/contrib/terminal/browser/terminalEditor.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalEditorInput.ts](src/vs/workbench/contrib/terminal/browser/terminalEditorInput.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalEditorService.ts](src/vs/workbench/contrib/terminal/browser/terminalEditorService.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalGroup.ts](src/vs/workbench/contrib/terminal/browser/terminalGroup.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalGroupService.ts](src/vs/workbench/contrib/terminal/browser/terminalGroupService.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts](src/vs/workbench/contrib/terminal/browser/terminalInstance.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalInstanceService.ts](src/vs/workbench/contrib/terminal/browser/terminalInstanceService.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalMenus.ts](src/vs/workbench/contrib/terminal/browser/terminalMenus.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalProcessExtHostProxy.ts](src/vs/workbench/contrib/terminal/browser/terminalProcessExtHostProxy.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts](src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalService.ts](src/vs/workbench/contrib/terminal/browser/terminalService.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalStatusList.ts](src/vs/workbench/contrib/terminal/browser/terminalStatusList.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalTabbedView.ts](src/vs/workbench/contrib/terminal/browser/terminalTabbedView.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalTabsList.ts](src/vs/workbench/contrib/terminal/browser/terminalTabsList.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalView.ts](src/vs/workbench/contrib/terminal/browser/terminalView.ts)\n- [src/vs/workbench/contrib/terminal/browser/xterm/xtermTerminal.ts](src/vs/workbench/contrib/terminal/browser/xterm/xtermTerminal.ts)\n- [src/vs/workbench/contrib/terminal/common/terminal.ts](src/vs/workbench/contrib/terminal/common/terminal.ts)\n- [src/vs/workbench/contrib/terminal/common/terminalColorRegistry.ts](src/vs/workbench/contrib/terminal/common/terminalColorRegistry.ts)\n- [src/vs/workbench/contrib/terminal/common/terminalConfiguration.ts](src/vs/workbench/contrib/terminal/common/terminalConfiguration.ts)\n- [src/vs/workbench/contrib/terminal/common/terminalEnvironment.ts](src/vs/workbench/contrib/terminal/common/terminalEnvironment.ts)\n- [src/vs/workbench/contrib/terminal/common/terminalStrings.ts](src/vs/workbench/contrib/terminal/common/terminalStrings.ts)\n- [src/vs/workbench/contrib/terminal/test/browser/terminalStatusList.test.ts](src/vs/workbench/contrib/terminal/test/browser/terminalStatusList.test.ts)\n- [src/vs/workbench/contrib/terminal/test/common/terminalEnvironment.test.ts](src/vs/workbench/contrib/terminal/test/common/terminalEnvironment.test.ts)\n- [src/vs/workbench/contrib/terminalContrib/voice/browser/terminal.voice.contribution.ts](src/vs/workbench/contrib/terminalContrib/voice/browser/terminal.voice.contribution.ts)\n- [src/vs/workbench/contrib/terminalContrib/voice/browser/terminalVoice.ts](src/vs/workbench/contrib/terminalContrib/voice/browser/terminalVoice.ts)\n- [src/vs/workbench/contrib/terminalContrib/voice/browser/terminalVoiceActions.ts](src/vs/workbench/contrib/terminalContrib/voice/browser/terminalVoiceActions.ts)\n\n\u003c/details\u003e\n\n\n\nThis document covers the architecture and lifecycle of terminal instances and their associated processes in VS Code. It explains how `TerminalInstance` coordinates the terminal UI with `TerminalProcessManager` to spawn, manage, and communicate with shell processes via the PTY host.\n\nFor information about the overall terminal system architecture and service layer, see [Terminal Architecture Overview](#8.1). For terminal UI and rendering with xterm.js, see [XTerm.js Integration and Rendering](#8.4). For multi-server and remote terminal support, see [Multi-Server Terminal Support](#8.3).\n\n## Architecture Overview\n\nThe terminal instance and process management system follows a layered architecture where each component has distinct responsibilities.\n\n```mermaid\ngraph TB\n    subgraph \"UI Layer\"\n        TerminalInstance[\"TerminalInstance\u003cbr/\u003e(terminalInstance.ts)\u003cbr/\u003eUI coordinator, xterm wrapper\"]\n        XtermTerminal[\"XtermTerminal\u003cbr/\u003e(xtermTerminal.ts)\u003cbr/\u003exterm.js wrapper\"]\n    end\n    \n    subgraph \"Process Management Layer\"\n        TerminalProcessManager[\"TerminalProcessManager\u003cbr/\u003e(terminalProcessManager.ts)\u003cbr/\u003eProcess lifecycle, state management\"]\n        TerminalProcess[\"ITerminalChildProcess\u003cbr/\u003eProcess abstraction\"]\n    end\n    \n    subgraph \"PTY Host Layer\"\n        PtyService[\"PtyService\u003cbr/\u003e(ptyService.ts)\u003cbr/\u003eNode process, PTY management\"]\n        TerminalProcess_Concrete[\"TerminalProcess\u003cbr/\u003e(terminalProcess.ts)\u003cbr/\u003enode-pty wrapper\"]\n    end\n    \n    subgraph \"Native Layer\"\n        NodePty[\"node-pty\u003cbr/\u003eNative PTY bindings\"]\n        Shell[\"Shell Process\u003cbr/\u003e(bash, pwsh, etc)\"]\n    end\n    \n    TerminalInstance --\u003e|\"owns, delegates\"| TerminalProcessManager\n    TerminalInstance --\u003e|\"owns, renders\"| XtermTerminal\n    TerminalProcessManager --\u003e|\"communicates via\"| TerminalProcess\n    TerminalProcess --\u003e|\"IPC to\"| PtyService\n    PtyService --\u003e|\"manages\"| TerminalProcess_Concrete\n    TerminalProcess_Concrete --\u003e|\"wraps\"| NodePty\n    NodePty --\u003e|\"spawns\"| Shell\n    \n    TerminalProcessManager -.-\u003e|\"data events\"| TerminalInstance\n    PtyService -.-\u003e|\"process data\"| TerminalProcessManager\n```\n\n**Sources:** [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts:129-210](), [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts:74-137](), [src/vs/platform/terminal/node/ptyService.ts:77-120]()\n\n## TerminalInstance: The UI Coordinator\n\n`TerminalInstance` is the primary class that represents a terminal in the workbench. It manages the UI, coordinates with the process manager, and handles user interactions.\n\n### Key Responsibilities\n\n| Responsibility | Description |\n|---|---|\n| **Xterm Management** | Creates and manages the `XtermTerminal` instance for rendering |\n| **Process Coordination** | Delegates to `TerminalProcessManager` for process lifecycle |\n| **Input Handling** | Captures user input and sends to the process |\n| **Title \u0026 Icon Management** | Manages terminal title, icon, and metadata |\n| **Event Aggregation** | Aggregates events from process and UI layers |\n| **State Management** | Tracks terminal visibility, focus, dimensions |\n\n### Instance Creation and Initialization\n\n```mermaid\nsequenceDiagram\n    participant Service as TerminalService\n    participant Instance as TerminalInstance\n    participant ProcessMgr as TerminalProcessManager\n    participant Xterm as XtermTerminal\n    \n    Service-\u003e\u003eInstance: new TerminalInstance(shellLaunchConfig)\n    Instance-\u003e\u003eInstance: _initDimensions()\n    Instance-\u003e\u003eProcessMgr: _createProcessManager()\n    Instance-\u003e\u003eInstance: _createXterm()\n    \n    Note over Instance: Wait for container ready\n    Instance-\u003e\u003eInstance: _containerReadyBarrier.wait()\n    \n    Instance-\u003e\u003eProcessMgr: createProcess(shellLaunchConfig, cols, rows)\n    ProcessMgr--\u003e\u003eInstance: Process created\n    \n    Instance-\u003e\u003eXterm: attachToElement(container)\n    Xterm--\u003e\u003eInstance: Ready for rendering\n```\n\n**Sources:** [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts:365-650](), [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts:523-571]()\n\n### Core Properties and State\n\nThe `TerminalInstance` class maintains extensive state about the terminal:\n\n```mermaid\ngraph LR\n    subgraph \"Identity \u0026 Configuration\"\n        instanceId[\"_instanceId: number\"]\n        shellLaunchConfig[\"_shellLaunchConfig: IShellLaunchConfig\"]\n        resource[\"_resource: URI\"]\n    end\n    \n    subgraph \"UI State\"\n        container[\"_container: HTMLElement\"]\n        wrapperElement[\"_wrapperElement: HTMLElement\"]\n        isVisible[\"_isVisible: boolean\"]\n        hasFocus[\"hasFocus (computed)\"]\n    end\n    \n    subgraph \"Dimensions\"\n        cols[\"_cols: number\"]\n        rows[\"_rows: number\"]\n        fixedCols[\"_fixedCols?: number\"]\n        fixedRows[\"_fixedRows?: number\"]\n    end\n    \n    subgraph \"Process State\"\n        exitCode[\"_exitCode?: number\"]\n        exitReason[\"_exitReason?: TerminalExitReason\"]\n        isExiting[\"_isExiting: boolean\"]\n    end\n    \n    subgraph \"Content \u0026 Title\"\n        title[\"_title: string\"]\n        titleSource[\"_titleSource: TitleEventSource\"]\n        icon[\"_icon?: TerminalIcon\"]\n        cwd[\"_cwd?: string\"]\n    end\n```\n\n**Sources:** [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts:148-206](), [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts:231-305]()\n\n### Data Flow: User Input to Process\n\nWhen a user types in the terminal, the data flows through multiple layers:\n\n```mermaid\nsequenceDiagram\n    participant User\n    participant Xterm as XtermTerminal (raw)\n    participant Instance as TerminalInstance\n    participant ProcessMgr as TerminalProcessManager\n    participant Process as ITerminalChildProcess\n    participant PtyService\n    \n    User-\u003e\u003eXterm: Key press\n    Xterm-\u003e\u003eInstance: onData event\n    Instance-\u003e\u003eInstance: _handleOnData(data)\n    Instance-\u003e\u003eProcessMgr: write(data)\n    ProcessMgr-\u003e\u003eProcess: write(data)\n    Process-\u003e\u003ePtyService: $sendProcessData(data)\n    PtyService-\u003e\u003ePtyService: Write to PTY\n    \n    Note over Instance: Also fires onDidInputData\n    Instance-\u003e\u003eInstance: _onDidInputData.fire(data)\n```\n\n**Sources:** [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts:656-659](), [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts:621-625]()\n\n## TerminalProcessManager: Process Lifecycle Management\n\n`TerminalProcessManager` encapsulates all state and logic related to terminal process creation, management, and communication. It sits between `TerminalInstance` and the actual process implementation.\n\n### Process Manager Responsibilities\n\n```mermaid\ngraph TB\n    subgraph \"Process Lifecycle\"\n        Create[\"createProcess()\u003cbr/\u003eSpawn new process\"]\n        Relaunch[\"relaunch()\u003cbr/\u003eRestart process\"]\n        Dispose[\"dispose()\u003cbr/\u003eClean up resources\"]\n    end\n    \n    subgraph \"State Management\"\n        ProcessState[\"processState: ProcessState\u003cbr/\u003eUninitialized  Launching  Running\"]\n        ShellPid[\"shellProcessId?: number\"]\n        PtyReady[\"ptyProcessReady: Promise\u003cvoid\u003e\"]\n    end\n    \n    subgraph \"Communication\"\n        Write[\"write(data)\u003cbr/\u003eSend to process\"]\n        SetDimensions[\"setDimensions(cols, rows)\u003cbr/\u003eResize PTY\"]\n        SendSignal[\"sendSignal(signal)\u003cbr/\u003eSend SIGTERM, etc\"]\n    end\n    \n    subgraph \"Event Handling\"\n        OnProcessData[\"onProcessData\u003cbr/\u003eData from process\"]\n        OnProcessExit[\"onProcessExit\u003cbr/\u003eProcess terminated\"]\n        OnDidChangeProperty[\"onDidChangeProperty\u003cbr/\u003eCWD, title changes\"]\n    end\n    \n    Create --\u003e ProcessState\n    Relaunch --\u003e ProcessState\n    ProcessState --\u003e PtyReady\n    Write --\u003e OnProcessData\n    SetDimensions --\u003e OnProcessData\n```\n\n**Sources:** [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts:74-314]()\n\n### Process State Machine\n\nThe process manager tracks the lifecycle through the `ProcessState` enum:\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e Uninitialized: new TerminalProcessManager()\n    Uninitialized --\u003e Launching: createProcess() called\n    Launching --\u003e Running: Process ready event received\n    Launching --\u003e KilledDuringLaunch: Process dies \u003c 500ms\n    Running --\u003e KilledByUser: dispose() or user action\n    Running --\u003e KilledByProcess: Shell exits or crashes\n    KilledDuringLaunch --\u003e [*]\n    KilledByUser --\u003e [*]\n    KilledByProcess --\u003e [*]\n    \n    note right of Launching\n        ErrorLaunchThresholdDuration = 500ms\n    end note\n```\n\n**Sources:** [src/vs/workbench/contrib/terminal/common/terminal.ts:316-333](), [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts:347-397]()\n\n### Process Manager Core Properties\n\n| Property | Type | Description |\n|---|---|---|\n| `processState` | `ProcessState` | Current state in lifecycle |\n| `shellProcessId` | `number \\| undefined` | PID of the shell process |\n| `ptyProcessReady` | `Promise\u003cvoid\u003e` | Resolves when PTY is ready |\n| `backend` | `ITerminalBackend \\| undefined` | Backend providing the process |\n| `capabilities` | `TerminalCapabilityStore` | Shell integration capabilities |\n| `os` | `OperatingSystem \\| undefined` | Operating system of the backend |\n| `userHome` | `string \\| undefined` | User's home directory |\n| `initialCwd` | `string` | Initial working directory |\n\n**Sources:** [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts:75-137]()\n\n## Process Creation and Spawning\n\nProcess creation involves resolving the shell launch configuration, setting up the environment, and spawning the actual process through the PTY host.\n\n### Process Creation Flow\n\n```mermaid\nsequenceDiagram\n    participant Instance as TerminalInstance\n    participant ProcessMgr as TerminalProcessManager\n    participant Backend as ITerminalBackend\n    participant PtyService\n    participant Shell\n    \n    Instance-\u003e\u003eProcessMgr: createProcess(shellLaunchConfig, cols, rows)\n    ProcessMgr-\u003e\u003eProcessMgr: _setupProcessListeners()\n    ProcessMgr-\u003e\u003eProcessMgr: resolveShellLaunchConfig()\n    \n    Note over ProcessMgr: Resolve env variables, CWD, etc.\n    ProcessMgr-\u003e\u003eProcessMgr: _createProcessEnvironmentVariableCollection()\n    \n    ProcessMgr-\u003e\u003eBackend: createProcess(options)\n    Backend-\u003e\u003ePtyService: $createProcess(shellLaunchConfig, cwd, cols, rows, env)\n    \n    Note over PtyService: In PTY host process\n    PtyService-\u003e\u003ePtyService: new TerminalProcess(...)\n    PtyService-\u003e\u003eShell: spawn via node-pty\n    Shell--\u003e\u003ePtyService: Process created\n    \n    PtyService--\u003e\u003eBackend: Process ID\n    Backend--\u003e\u003eProcessMgr: ITerminalChildProcess\n    ProcessMgr--\u003e\u003eInstance: Process ready\n    \n    Note over ProcessMgr: Update state\n    ProcessMgr-\u003e\u003eProcessMgr: processState = ProcessState.Launching\n```\n\n**Sources:** [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts:339-528](), [src/vs/platform/terminal/node/ptyService.ts:251-345]()\n\n### Shell Launch Config Resolution\n\nBefore spawning a process, the shell launch config must be resolved:\n\n```mermaid\ngraph TB\n    SLC[\"IShellLaunchConfig\u003cbr/\u003e(input)\"]\n    \n    subgraph \"Resolution Steps\"\n        ResolveCwd[\"Resolve CWD\u003cbr/\u003e- Variable substitution\u003cbr/\u003e- Workspace folder\u003cbr/\u003e- User home fallback\"]\n        ResolveEnv[\"Resolve Environment\u003cbr/\u003e- Merge base env\u003cbr/\u003e- Apply ext collections\u003cbr/\u003e- Add shell integration\"]\n        ResolveExec[\"Resolve Executable\u003cbr/\u003e- Get default profile\u003cbr/\u003e- Apply shell args\u003cbr/\u003e- Resolve icon/color\"]\n        ResolveOpts[\"Resolve Options\u003cbr/\u003e- Dimensions\u003cbr/\u003e- Custom PTY\u003cbr/\u003e- Persistence\"]\n    end\n    \n    Resolved[\"Resolved IShellLaunchConfig\"]\n    \n    SLC --\u003e ResolveCwd\n    ResolveCwd --\u003e ResolveEnv\n    ResolveEnv --\u003e ResolveExec\n    ResolveExec --\u003e ResolveOpts\n    ResolveOpts --\u003e Resolved\n```\n\n**Sources:** [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts:410-487](), [src/vs/workbench/contrib/terminal/common/terminalEnvironment.ts:92-199]()\n\n### Environment Variable Collection\n\nExtensions can contribute environment variables through `IEnvironmentVariableCollection`:\n\n```mermaid\ngraph LR\n    subgraph \"Extension Contributions\"\n        Ext1[\"Extension A\u003cbr/\u003evscode.env.collection\"]\n        Ext2[\"Extension B\u003cbr/\u003evscode.env.collection\"]\n        Ext3[\"Extension C\u003cbr/\u003evscode.env.collection\"]\n    end\n    \n    subgraph \"Merge Process\"\n        Service[\"EnvironmentVariableService\"]\n        Merged[\"MergedEnvironmentVariableCollection\"]\n    end\n    \n    subgraph \"Application\"\n        BaseEnv[\"Base Environment\"]\n        Apply[\"applyToProcessEnvironment()\"]\n        FinalEnv[\"Final Process Environment\"]\n    end\n    \n    Ext1 --\u003e Service\n    Ext2 --\u003e Service\n    Ext3 --\u003e Service\n    Service --\u003e Merged\n    \n    BaseEnv --\u003e Apply\n    Merged --\u003e Apply\n    Apply --\u003e FinalEnv\n```\n\n**Sources:** [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts:489-542](), [src/vs/platform/terminal/common/environmentVariableCollection.ts]()\n\n## Data Flow and Communication\n\nThe terminal system uses an event-driven architecture for bidirectional communication between the UI and the shell process.\n\n### Data Flow: Process to UI\n\n```mermaid\nsequenceDiagram\n    participant Shell\n    participant PTY as node-pty\n    participant PtyService\n    participant Process as ITerminalChildProcess\n    participant ProcessMgr as TerminalProcessManager\n    participant Instance as TerminalInstance\n    participant Xterm\n    participant User\n    \n    Shell-\u003e\u003ePTY: Write output\n    PTY-\u003e\u003ePtyService: onData event\n    PtyService-\u003e\u003eProcess: onProcessData.fire()\n    Process-\u003e\u003eProcessMgr: onProcessData.fire()\n    \n    Note over ProcessMgr: Data buffering \u0026 flow control\n    ProcessMgr-\u003e\u003eProcessMgr: _ackDataBufferer.push()\n    \n    ProcessMgr-\u003e\u003eInstance: onProcessData.fire()\n    Instance-\u003e\u003eXterm: xterm.write(data)\n    Xterm-\u003e\u003eUser: Render to screen\n    \n    Note over ProcessMgr: Acknowledge data processed\n    ProcessMgr-\u003e\u003eProcess: acknowledgeDataEvent(charCount)\n```\n\n**Sources:** [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts:668-694](), [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts:1158-1190]()\n\n### Flow Control and Buffering\n\nTo prevent overwhelming the renderer, the terminal uses flow control:\n\n```mermaid\ngraph TB\n    subgraph \"PTY Host\"\n        PtyData[\"Process Data Events\"]\n    end\n    \n    subgraph \"Renderer Process\"\n        DataBufferer[\"AckDataBufferer\u003cbr/\u003eQueues data events\"]\n        FlowControl[\"Flow Control\u003cbr/\u003ePauses on high latency\"]\n        XtermWrite[\"xterm.write()\"]\n        Ack[\"acknowledgeDataEvent()\"]\n    end\n    \n    PtyData --\u003e|\"IProcessDataEvent\"| DataBufferer\n    DataBufferer --\u003e FlowControl\n    FlowControl --\u003e|\"When ready\"| XtermWrite\n    XtermWrite --\u003e|\"After render\"| Ack\n    Ack --\u003e|\"Resume\"| PtyData\n    \n    FlowControl -.-\u003e|\"Check latency\"| FlowControl\n```\n\n**Constants:**\n- `FlowControlConstants.CharCountDifferenceThreshold = 50000`\n- `FlowControlConstants.CharCountDifferenceHighThreshold = 100000`\n- Flow control pauses when unacknowledged chars exceed threshold\n\n**Sources:** [src/vs/platform/terminal/common/terminal.ts:939-964](), [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts:166]()\n\n## Process Property Updates\n\nThe process can dynamically update properties like CWD, title, or shell type:\n\n```mermaid\nsequenceDiagram\n    participant Shell\n    participant Detection as Capability Detection\n    participant Process as ITerminalChildProcess\n    participant ProcessMgr as TerminalProcessManager\n    participant Instance as TerminalInstance\n    \n    Note over Shell: Shell changes directory\n    Detection-\u003e\u003eDetection: CwdDetectionCapability\u003cbr/\u003edetects change\n    Detection-\u003e\u003eProcessMgr: onDidChangeProperty.fire({\u003cbr/\u003e  type: ProcessPropertyType.Cwd,\u003cbr/\u003e  value: '/new/path'\u003cbr/\u003e})\n    ProcessMgr-\u003e\u003eInstance: onDidChangeProperty event\n    Instance-\u003e\u003eInstance: Update _cwd, refresh title\n    \n    Note over Shell: Process spawns child\n    Shell-\u003e\u003eProcess: Child process detected\n    Process-\u003e\u003eProcessMgr: onDidChangeProperty.fire({\u003cbr/\u003e  type: ProcessPropertyType.HasChildProcesses,\u003cbr/\u003e  value: true\u003cbr/\u003e})\n    ProcessMgr-\u003e\u003eInstance: hasChildProcesses = true\n    Instance-\u003e\u003eInstance: Update exit confirmation\n```\n\n**Process Property Types:**\n- `Cwd` - Current working directory\n- `InitialCwd` - Initial working directory\n- `Title` - Process-set title\n- `ShellType` - Detected shell type (bash, zsh, pwsh, etc.)\n- `HasChildProcesses` - Whether shell has child processes\n- `FixedDimensions` - Fixed terminal dimensions\n- `OverrideDimensions` - Temporary dimension override\n\n**Sources:** [src/vs/platform/terminal/common/terminal.ts:244-275](), [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts:705-747]()\n\n## Process Lifecycle: Exit and Disposal\n\n### Exit Flow\n\n```mermaid\nsequenceDiagram\n    participant Shell\n    participant Process as ITerminalChildProcess\n    participant ProcessMgr as TerminalProcessManager\n    participant Instance as TerminalInstance\n    participant Service as TerminalService\n    \n    Shell-\u003e\u003eShell: exit command or crash\n    Process-\u003e\u003eProcessMgr: onProcessExit.fire(exitCode)\n    ProcessMgr-\u003e\u003eProcessMgr: processState = KilledByProcess\n    ProcessMgr-\u003e\u003eInstance: onProcessExit.fire(exitCode)\n    \n    Instance-\u003e\u003eInstance: _exitCode = exitCode\n    Instance-\u003e\u003eInstance: _isExiting = true\n    \n    alt waitOnExit is set\n        Instance-\u003e\u003eInstance: Display \"Press any key to close\"\n        Instance-\u003e\u003eInstance: _pressAnyKeyToCloseListener\n    else auto close\n        Instance-\u003e\u003eService: Dispose instance\n        Service-\u003e\u003eInstance: dispose()\n        Instance-\u003e\u003eProcessMgr: dispose()\n    end\n```\n\n**Sources:** [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts:1395-1484](), [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts:617-620]()\n\n### Disposal and Cleanup\n\nWhen a terminal is disposed, resources must be cleaned up carefully:\n\n```mermaid\ngraph TB\n    InstanceDispose[\"TerminalInstance.dispose()\"]\n    \n    subgraph \"Cleanup Steps\"\n        StopProcess[\"Stop accepting input\"]\n        FireWillDispose[\"_onWillDispose.fire()\"]\n        DetachProcess[\"detachProcessAndDispose()\"]\n        DisposeXterm[\"Dispose xterm instance\"]\n        DisposeListeners[\"Dispose all listeners\"]\n        FireDisposed[\"_onDisposed.fire()\"]\n    end\n    \n    subgraph \"Process Manager Disposal\"\n        DetachFromProcess[\"detachFromProcess()\"]\n        DisposeProcess[\"_process?.dispose()\"]\n        ClearCapabilities[\"capabilities.dispose()\"]\n    end\n    \n    InstanceDispose --\u003e StopProcess\n    StopProcess --\u003e FireWillDispose\n    FireWillDispose --\u003e DetachProcess\n    DetachProcess --\u003e DetachFromProcess\n    DetachFromProcess --\u003e DisposeProcess\n    DisposeProcess --\u003e ClearCapabilities\n    ClearCapabilities --\u003e DisposeXterm\n    DisposeXterm --\u003e DisposeListeners\n    DisposeListeners --\u003e FireDisposed\n```\n\n**Sources:** [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts:1352-1394](), [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts:301-337]()\n\n## Persistent Sessions and Reconnection\n\nVS Code supports persisting terminal sessions across window reloads and remote reconnections.\n\n### Persistence Architecture\n\n```mermaid\ngraph TB\n    subgraph \"Before Shutdown\"\n        Instance1[\"Active TerminalInstance\"]\n        ProcessMgr1[\"TerminalProcessManager\"]\n        Backend[\"ITerminalBackend\"]\n        \n        Instance1 --\u003e ProcessMgr1\n        ProcessMgr1 --\u003e|\"persistentProcessId\"| Backend\n        Backend --\u003e|\"Save layout info\"| LayoutInfo[\"ITerminalsLayoutInfo\"]\n    end\n    \n    subgraph \"After Restart\"\n        Service[\"TerminalService\"]\n        LayoutInfo2[\"Restored Layout Info\"]\n        Backend2[\"ITerminalBackend\"]\n        ProcessMgr2[\"TerminalProcessManager\u003cbr/\u003e(reconnect mode)\"]\n        Instance2[\"TerminalInstance\u003cbr/\u003e(restored)\"]\n        \n        Service --\u003e|\"getTerminalLayoutInfo()\"| Backend2\n        Backend2 --\u003e LayoutInfo2\n        LayoutInfo2 --\u003e|\"attachPersistentProcess\"| ProcessMgr2\n        ProcessMgr2 --\u003e Instance2\n    end\n    \n    LayoutInfo -.-\u003e|\"Persisted to storage\"| LayoutInfo2\n```\n\n**Sources:** [src/vs/workbench/contrib/terminal/browser/terminalService.ts:455-537](), [src/vs/platform/terminal/node/ptyService.ts:551-647]()\n\n### Reconnection Process\n\nWhen reconnecting to a persisted terminal:\n\n```mermaid\nsequenceDiagram\n    participant Service as TerminalService\n    participant Backend as ITerminalBackend\n    participant PtyService\n    participant ProcessMgr as TerminalProcessManager\n    participant Instance as TerminalInstance\n    \n    Service-\u003e\u003eBackend: getTerminalLayoutInfo()\n    Backend-\u003e\u003ePtyService: $getTerminalLayoutInfo()\n    PtyService--\u003e\u003eBackend: Layout with orphan processes\n    Backend--\u003e\u003eService: ITerminalsLayoutInfo\n    \n    loop For each persisted terminal\n        Service-\u003e\u003eService: createTerminal({\u003cbr/\u003e  attachPersistentProcess: {...}\u003cbr/\u003e})\n        Service-\u003e\u003eInstance: new TerminalInstance(config)\n        Instance-\u003e\u003eProcessMgr: createProcess()\n        ProcessMgr-\u003e\u003eBackend: attachToProcess(persistentProcessId)\n        Backend-\u003e\u003ePtyService: $attachToProcess(id)\n        \n        Note over PtyService: Reattach to existing PTY\n        PtyService-\u003e\u003eProcessMgr: Replay buffered output\n        ProcessMgr-\u003e\u003eInstance: onProcessReplayComplete\n    end\n```\n\n**Sources:** [src/vs/workbench/contrib/terminal/browser/terminalService.ts:500-559](), [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts:555-617]()\n\n### Replay Buffer\n\nWhen reconnecting, the PTY host replays buffered output:\n\n| Property | Description |\n|---|---|\n| **Scrollback Buffer** | Terminal maintains scrollback (default 1000 lines) |\n| **Replay Events** | `onProcessReplay` fires with chunks of buffered data |\n| **State Restoration** | CWD, title, icon restored from layout info |\n| **Capability Restoration** | Command detection capabilities restored if available |\n\n**Sources:** [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts:668-693](), [src/vs/platform/terminal/node/ptyService.ts:476-547]()\n\n## Dimensions and Resizing\n\nTerminal dimensions must be coordinated between the UI (xterm) and the process (PTY).\n\n### Dimension Calculation\n\n```mermaid\ngraph TB\n    Container[\"Container Element\u003cbr/\u003eWidth \u0026 Height in pixels\"]\n    Font[\"Terminal Font\u003cbr/\u003eFamily, Size, Line Height\"]\n    \n    Calculate[\"Calculate Dimensions\u003cbr/\u003ecols = Math.floor(width / charWidth)\u003cbr/\u003erows = Math.floor(height / charHeight)\"]\n    \n    Constrain[\"Apply Constraints\u003cbr/\u003e- fixedCols/fixedRows\u003cbr/\u003e- dimensionsOverride\u003cbr/\u003e- minimum 2x2\"]\n    \n    Container --\u003e Calculate\n    Font --\u003e Calculate\n    Calculate --\u003e Constrain\n    \n    Constrain --\u003e XtermResize[\"xterm.resize(cols, rows)\"]\n    Constrain --\u003e PtyResize[\"pty.setDimensions(cols, rows)\"]\n    \n    XtermResize --\u003e Render[\"Xterm re-renders\"]\n    PtyResize --\u003e PTY[\"PTY updates SIGWINCH\"]\n```\n\n**Sources:** [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts:684-745](), [src/vs/workbench/contrib/terminal/browser/xterm/xtermTerminal.ts:538-565]()\n\n### Resize Flow\n\n```mermaid\nsequenceDiagram\n    participant Layout as LayoutService\n    participant Instance as TerminalInstance\n    participant Xterm as XtermTerminal\n    participant ProcessMgr as TerminalProcessManager\n    participant PTY\n    \n    Layout-\u003e\u003eInstance: layout(width, height)\n    Instance-\u003e\u003eInstance: _evaluateColsAndRows()\n    Instance-\u003e\u003eInstance: _resize()\n    \n    alt Dimensions changed\n        Instance-\u003e\u003eXterm: resize(cols, rows)\n        Xterm-\u003e\u003eXterm: raw.resize(cols, rows)\n        \n        Instance-\u003e\u003eProcessMgr: setDimensions(cols, rows)\n        ProcessMgr-\u003e\u003ePTY: resize(cols, rows)\n        PTY-\u003e\u003ePTY: Send SIGWINCH to shell\n        \n        Instance-\u003e\u003eInstance: _onDimensionsChanged.fire()\n    end\n```\n\n**Sources:** [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts:1067-1134](), [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts:626-648]()\n\n## Summary\n\nThe terminal instance and process management system provides a robust, multi-layered architecture:\n\n- **TerminalInstance** coordinates UI, user input, and process lifecycle\n- **TerminalProcessManager** handles process spawning, state management, and communication\n- **Flow control** prevents renderer overload with data buffering and acknowledgment\n- **Process properties** dynamically update to reflect shell state changes\n- **Persistence** enables session reconnection across restarts\n- **Dimension synchronization** keeps UI and PTY in sync\n\nThe separation of concerns allows each layer to focus on its responsibilities while maintaining clean interfaces and event-driven communication."])</script><script>self.__next_f.push([1,"34:T7b9a,"])</script><script>self.__next_f.push([1,"# XTerm.js Integration and Rendering\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [src/vs/platform/terminal/common/terminal.ts](src/vs/platform/terminal/common/terminal.ts)\n- [src/vs/platform/terminal/common/terminalEnvironment.ts](src/vs/platform/terminal/common/terminalEnvironment.ts)\n- [src/vs/platform/terminal/common/terminalRecorder.ts](src/vs/platform/terminal/common/terminalRecorder.ts)\n- [src/vs/platform/terminal/node/ptyHostMain.ts](src/vs/platform/terminal/node/ptyHostMain.ts)\n- [src/vs/platform/terminal/node/ptyHostService.ts](src/vs/platform/terminal/node/ptyHostService.ts)\n- [src/vs/platform/terminal/node/ptyService.ts](src/vs/platform/terminal/node/ptyService.ts)\n- [src/vs/platform/terminal/node/terminalProcess.ts](src/vs/platform/terminal/node/terminalProcess.ts)\n- [src/vs/platform/terminal/test/common/terminalEnvironment.test.ts](src/vs/platform/terminal/test/common/terminalEnvironment.test.ts)\n- [src/vs/platform/terminal/test/common/terminalProfiles.test.ts](src/vs/platform/terminal/test/common/terminalProfiles.test.ts)\n- [src/vs/platform/terminal/test/common/terminalRecorder.test.ts](src/vs/platform/terminal/test/common/terminalRecorder.test.ts)\n- [src/vs/workbench/api/browser/mainThreadTerminalService.ts](src/vs/workbench/api/browser/mainThreadTerminalService.ts)\n- [src/vs/workbench/api/common/extHostTerminalService.ts](src/vs/workbench/api/common/extHostTerminalService.ts)\n- [src/vs/workbench/api/node/extHostTerminalService.ts](src/vs/workbench/api/node/extHostTerminalService.ts)\n- [src/vs/workbench/contrib/terminal/browser/media/terminal.css](src/vs/workbench/contrib/terminal/browser/media/terminal.css)\n- [src/vs/workbench/contrib/terminal/browser/media/xterm.css](src/vs/workbench/contrib/terminal/browser/media/xterm.css)\n- [src/vs/workbench/contrib/terminal/browser/remotePty.ts](src/vs/workbench/contrib/terminal/browser/remotePty.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminal.contribution.ts](src/vs/workbench/contrib/terminal/browser/terminal.contribution.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminal.ts](src/vs/workbench/contrib/terminal/browser/terminal.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalActions.ts](src/vs/workbench/contrib/terminal/browser/terminalActions.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalEditor.ts](src/vs/workbench/contrib/terminal/browser/terminalEditor.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalEditorInput.ts](src/vs/workbench/contrib/terminal/browser/terminalEditorInput.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalEditorService.ts](src/vs/workbench/contrib/terminal/browser/terminalEditorService.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalGroup.ts](src/vs/workbench/contrib/terminal/browser/terminalGroup.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalGroupService.ts](src/vs/workbench/contrib/terminal/browser/terminalGroupService.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts](src/vs/workbench/contrib/terminal/browser/terminalInstance.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalInstanceService.ts](src/vs/workbench/contrib/terminal/browser/terminalInstanceService.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalMenus.ts](src/vs/workbench/contrib/terminal/browser/terminalMenus.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalProcessExtHostProxy.ts](src/vs/workbench/contrib/terminal/browser/terminalProcessExtHostProxy.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts](src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalService.ts](src/vs/workbench/contrib/terminal/browser/terminalService.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalStatusList.ts](src/vs/workbench/contrib/terminal/browser/terminalStatusList.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalTabbedView.ts](src/vs/workbench/contrib/terminal/browser/terminalTabbedView.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalTabsList.ts](src/vs/workbench/contrib/terminal/browser/terminalTabsList.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalView.ts](src/vs/workbench/contrib/terminal/browser/terminalView.ts)\n- [src/vs/workbench/contrib/terminal/browser/xterm/xtermTerminal.ts](src/vs/workbench/contrib/terminal/browser/xterm/xtermTerminal.ts)\n- [src/vs/workbench/contrib/terminal/common/terminal.ts](src/vs/workbench/contrib/terminal/common/terminal.ts)\n- [src/vs/workbench/contrib/terminal/common/terminalColorRegistry.ts](src/vs/workbench/contrib/terminal/common/terminalColorRegistry.ts)\n- [src/vs/workbench/contrib/terminal/common/terminalConfiguration.ts](src/vs/workbench/contrib/terminal/common/terminalConfiguration.ts)\n- [src/vs/workbench/contrib/terminal/common/terminalEnvironment.ts](src/vs/workbench/contrib/terminal/common/terminalEnvironment.ts)\n- [src/vs/workbench/contrib/terminal/common/terminalStrings.ts](src/vs/workbench/contrib/terminal/common/terminalStrings.ts)\n- [src/vs/workbench/contrib/terminal/test/browser/terminalStatusList.test.ts](src/vs/workbench/contrib/terminal/test/browser/terminalStatusList.test.ts)\n- [src/vs/workbench/contrib/terminal/test/common/terminalEnvironment.test.ts](src/vs/workbench/contrib/terminal/test/common/terminalEnvironment.test.ts)\n- [src/vs/workbench/contrib/terminalContrib/voice/browser/terminal.voice.contribution.ts](src/vs/workbench/contrib/terminalContrib/voice/browser/terminal.voice.contribution.ts)\n- [src/vs/workbench/contrib/terminalContrib/voice/browser/terminalVoice.ts](src/vs/workbench/contrib/terminalContrib/voice/browser/terminalVoice.ts)\n- [src/vs/workbench/contrib/terminalContrib/voice/browser/terminalVoiceActions.ts](src/vs/workbench/contrib/terminalContrib/voice/browser/terminalVoiceActions.ts)\n\n\u003c/details\u003e\n\n\n\nThis document describes how VS Code integrates the xterm.js library to provide terminal rendering capabilities. It covers the `XtermTerminal` wrapper class, the addon loading system, rendering modes, theme management, and the data flow between the terminal process and the xterm.js renderer.\n\nFor information about terminal process management and PTY communication, see [Terminal Instance and Process Management](#8.2). For shell integration features built on top of xterm.js, see [Shell Integration and Capabilities](#8.6).\n\n## Architecture Overview\n\nVS Code wraps xterm.js in the `XtermTerminal` class, which acts as an adapter between xterm.js's API and VS Code's terminal infrastructure. This wrapper handles addon management, theme synchronization, configuration mapping, and lifecycle coordination.\n\n```mermaid\ngraph TB\n    TerminalInstance[\"TerminalInstance\"]\n    XtermTerminal[\"XtermTerminal\"]\n    RawXterm[\"Terminal (xterm.js)\"]\n    \n    subgraph \"Addons\"\n        SearchAddon[\"SearchAddon\"]\n        WebglAddon[\"WebglAddon\"]\n        Unicode11Addon[\"Unicode11Addon\"]\n        ShellIntegrationAddon[\"ShellIntegrationAddon\"]\n        DecorationAddon[\"DecorationAddon\"]\n        SerializeAddon[\"SerializeAddon\"]\n        ImageAddon[\"ImageAddon\"]\n        ClipboardAddon[\"ClipboardAddon\"]\n        LigaturesAddon[\"LigaturesAddon\"]\n    end\n    \n    subgraph \"Supporting Classes\"\n        MarkNavigationAddon[\"MarkNavigationAddon\"]\n        TerminalCapabilityStore[\"capabilities\"]\n        ColorProvider[\"IXtermColorProvider\"]\n    end\n    \n    TerminalInstance --\u003e|\"creates and manages\"| XtermTerminal\n    XtermTerminal --\u003e|\"wraps\"| RawXterm\n    XtermTerminal --\u003e|\"loads\"| SearchAddon\n    XtermTerminal --\u003e|\"loads\"| WebglAddon\n    XtermTerminal --\u003e|\"loads\"| Unicode11Addon\n    XtermTerminal --\u003e|\"loads\"| ShellIntegrationAddon\n    XtermTerminal --\u003e|\"loads\"| DecorationAddon\n    XtermTerminal --\u003e|\"loads\"| SerializeAddon\n    XtermTerminal --\u003e|\"loads\"| ImageAddon\n    XtermTerminal --\u003e|\"loads\"| ClipboardAddon\n    XtermTerminal --\u003e|\"loads\"| LigaturesAddon\n    XtermTerminal --\u003e|\"uses\"| MarkNavigationAddon\n    XtermTerminal --\u003e|\"receives colors from\"| ColorProvider\n    ShellIntegrationAddon --\u003e|\"updates\"| TerminalCapabilityStore\n```\n\n**Sources:** [src/vs/workbench/contrib/terminal/browser/xterm/xtermTerminal.ts:1-1200](), [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts:1-600]()\n\n## XTerm.js Dependencies\n\nVS Code uses xterm.js 6.1.0-beta.77 along with multiple official addons. These packages are declared in the project's package manifests.\n\n| Package | Purpose |\n|---------|---------|\n| `@xterm/xterm` | Core terminal emulator |\n| `@xterm/addon-search` | Find functionality |\n| `@xterm/addon-unicode11` | Unicode 11 support |\n| `@xterm/addon-webgl` | GPU-accelerated rendering |\n| `@xterm/addon-serialize` | Serialize terminal state |\n| `@xterm/addon-image` | Inline image support |\n| `@xterm/addon-clipboard` | Enhanced clipboard operations |\n| `@xterm/addon-ligatures` | Font ligature rendering |\n| `@xterm/addon-progress` | Progress indicator support |\n| `@xterm/headless` | Headless terminal for backend use |\n\n**Sources:** [package.json:92-101](), [remote/package.json:18-27](), [remote/web/package.json:11-19]()\n\n## XtermTerminal Wrapper Class\n\nThe `XtermTerminal` class in `xtermTerminal.ts` is the primary integration point between VS Code and xterm.js. It implements the `IXtermTerminal` interface and manages a `RawXtermTerminal` instance.\n\n### Class Structure\n\n```mermaid\ngraph TB\n    IXtermTerminal[\"IXtermTerminal interface\"]\n    XtermTerminal[\"XtermTerminal class\"]\n    Disposable[\"Disposable\"]\n    \n    XtermTerminal -.implements.-\u003e IXtermTerminal\n    XtermTerminal -.extends.-\u003e Disposable\n    \n    subgraph \"Key Properties\"\n        raw[\"raw: RawXtermTerminal\"]\n        shellIntegration[\"shellIntegration: ShellIntegrationAddon\"]\n        markTracker[\"markTracker: MarkNavigationAddon\"]\n        decorationAddon[\"decorationAddon: DecorationAddon\"]\n    end\n    \n    subgraph \"Key Methods\"\n        attachToElement[\"attachToElement()\"]\n        write[\"write()\"]\n        resize[\"resize()\"]\n        updateConfig[\"updateConfig()\"]\n        forceRedraw[\"forceRedraw()\"]\n    end\n    \n    XtermTerminal --\u003e raw\n    XtermTerminal --\u003e shellIntegration\n    XtermTerminal --\u003e markTracker\n    XtermTerminal --\u003e decorationAddon\n    XtermTerminal --\u003e attachToElement\n    XtermTerminal --\u003e write\n    XtermTerminal --\u003e resize\n    XtermTerminal --\u003e updateConfig\n    XtermTerminal --\u003e forceRedraw\n```\n\n### Initialization Flow\n\nThe `XtermTerminal` constructor creates the raw xterm.js `Terminal` instance with options derived from VS Code configuration:\n\n1. **Create Terminal Instance**: Instantiates `RawXtermTerminal` with converted options\n2. **Register Core Addons**: Loads `MarkNavigationAddon`, `ShellIntegrationAddon`, `DecorationAddon`\n3. **Setup Event Handlers**: Connects xterm.js events to VS Code's event system\n4. **Apply Theme**: Initializes colors from the current VS Code theme\n\nThe terminal is not yet attached to the DOM at this point - that happens later via `attachToElement()`.\n\n**Sources:** [src/vs/workbench/contrib/terminal/browser/xterm/xtermTerminal.ts:150-350]()\n\n### Key Methods\n\n| Method | Purpose |\n|--------|---------|\n| `attachToElement()` | Opens the terminal in a DOM element, loads optional addons |\n| `write()` | Writes data to the terminal buffer |\n| `resize()` | Changes terminal dimensions (cols/rows) |\n| `refresh()` | Forces a screen redraw |\n| `clearBuffer()` | Clears scrollback and screen |\n| `updateConfig()` | Applies configuration changes from VS Code settings |\n| `getXtermTheme()` | Converts VS Code theme to xterm.js theme object |\n\n**Sources:** [src/vs/workbench/contrib/terminal/browser/xterm/xtermTerminal.ts:400-1000]()\n\n## Addon Loading System\n\nAddons extend xterm.js functionality. The `XtermTerminal` class manages two categories of addons:\n\n### Always-Loaded Addons\n\nThese addons are loaded immediately during construction:\n\n- **MarkNavigationAddon**: Provides mark-based navigation for shell integration [src/vs/workbench/contrib/terminal/browser/xterm/markNavigationAddon.ts]()\n- **ShellIntegrationAddon**: Implements shell integration protocol [src/vs/platform/terminal/common/xterm/shellIntegrationAddon.ts]()\n- **DecorationAddon**: Renders command decorations in the gutter [src/vs/workbench/contrib/terminal/browser/xterm/decorationAddon.ts]()\n\n### Lazily-Loaded Addons\n\nThese addons are loaded on-demand when the terminal is attached to the DOM or when needed:\n\n```mermaid\ngraph LR\n    attachToElement[\"attachToElement()\"]\n    \n    subgraph \"Conditional Loading\"\n        gpuAccel{\"GPU acceleration\u003cbr/\u003eenabled?\"}\n        webglAddon[\"Load WebglAddon\"]\n        \n        unicode11{\"Unicode 11\u003cbr/\u003esetting?\"}\n        unicode11Addon[\"Load Unicode11Addon\"]\n        \n        images{\"Images\u003cbr/\u003eenabled?\"}\n        imageAddon[\"Load ImageAddon\"]\n        \n        ligatures{\"Ligatures\u003cbr/\u003eenabled?\"}\n        ligaturesAddon[\"Load LigaturesAddon\"]\n    end\n    \n    subgraph \"Always Loaded\"\n        searchAddon[\"Load SearchAddon\"]\n        serializeAddon[\"Load SerializeAddon\"]\n        clipboardAddon[\"Load ClipboardAddon\"]\n    end\n    \n    attachToElement --\u003e gpuAccel\n    gpuAccel --\u003e|\"yes\"| webglAddon\n    attachToElement --\u003e unicode11\n    unicode11 --\u003e|\"'11'\"| unicode11Addon\n    attachToElement --\u003e images\n    images --\u003e|\"yes\"| imageAddon\n    attachToElement --\u003e ligatures\n    ligatures --\u003e|\"yes\"| ligaturesAddon\n    attachToElement --\u003e searchAddon\n    attachToElement --\u003e serializeAddon\n    attachToElement --\u003e clipboardAddon\n```\n\nAddon loading uses dynamic imports via `importAMDNodeModule()` to avoid bundling all addons upfront:\n\n```typescript\n// Example from xtermTerminal.ts\nconst { SearchAddon } = await importAMDNodeModule\u003ctypeof import('@xterm/addon-search')\u003e('@xterm/addon-search', 'lib/addon-search.js');\n```\n\n**Sources:** [src/vs/workbench/contrib/terminal/browser/xterm/xtermTerminal.ts:400-600]()\n\n## Rendering Modes and GPU Acceleration\n\nXTerm.js supports three rendering modes controlled by the `terminal.integrated.gpuAcceleration` setting:\n\n| Setting Value | Renderer | Description |\n|--------------|----------|-------------|\n| `'off'` | Canvas | 2D canvas rendering (fallback) |\n| `'on'` | WebGL | GPU-accelerated rendering via `WebglAddon` |\n| `'auto'` | Automatic | Tries WebGL, falls back to canvas on failure |\n\n### GPU Acceleration Flow\n\n```mermaid\ngraph TB\n    updateConfig[\"updateConfig()\"]\n    gpuSetting{\"gpuAcceleration\u003cbr/\u003esetting\"}\n    \n    loadWebgl[\"Load WebglAddon\"]\n    activateWebgl[\"Activate WebGL renderer\"]\n    webglError{\"WebGL\u003cbr/\u003eactivation\u003cbr/\u003eerror?\"}\n    \n    fallbackCanvas[\"Use canvas renderer\"]\n    notifyUser[\"Show error notification\"]\n    \n    updateConfig --\u003e gpuSetting\n    gpuSetting --\u003e|\"'on' or 'auto'\"| loadWebgl\n    gpuSetting --\u003e|\"'off'\"| fallbackCanvas\n    \n    loadWebgl --\u003e activateWebgl\n    activateWebgl --\u003e webglError\n    webglError --\u003e|\"yes\"| fallbackCanvas\n    webglError --\u003e|\"yes\"| notifyUser\n    webglError --\u003e|\"no\"| webglSuccess[\"WebGL active\"]\n```\n\nThe WebGL renderer provides better performance for large terminals but may fail on systems with incompatible GPU drivers. When WebGL activation fails, xterm.js automatically falls back to the canvas renderer.\n\n**Sources:** [src/vs/workbench/contrib/terminal/browser/xterm/xtermTerminal.ts:700-900]()\n\n## Theme and Color Management\n\n`XtermTerminal` synchronizes VS Code's theme with xterm.js through the `IXtermColorProvider` interface. The `getXtermTheme()` method constructs an xterm.js theme object from VS Code's color registry.\n\n### Theme Conversion Process\n\n```mermaid\ngraph LR\n    VSCodeTheme[\"VS Code IColorTheme\"]\n    ColorProvider[\"IXtermColorProvider\"]\n    XtermTheme[\"ITheme (xterm.js)\"]\n    \n    themeService[\"IThemeService\"]\n    colorRegistry[\"Color Registry\"]\n    \n    themeService --\u003e|\"provides\"| VSCodeTheme\n    colorRegistry --\u003e|\"defines\"| terminalColors[\"Terminal color IDs\"]\n    \n    VSCodeTheme --\u003e ColorProvider\n    ColorProvider --\u003e getXtermTheme[\"getXtermTheme()\"]\n    terminalColors --\u003e getXtermTheme\n    getXtermTheme --\u003e XtermTheme\n    \n    XtermTheme --\u003e|\"applied to\"| rawTerminal[\"raw.options.theme\"]\n```\n\n### Color Categories\n\nThe theme includes several color categories mapped from VS Code's terminal color registry:\n\n| Category | VS Code Color ID | XTerm Property |\n|----------|------------------|----------------|\n| Foreground | `TERMINAL_FOREGROUND_COLOR` | `foreground` |\n| Background | `TERMINAL_BACKGROUND_COLOR` | `background` |\n| Cursor | `TERMINAL_CURSOR_FOREGROUND_COLOR` | `cursor` |\n| Cursor Accent | `TERMINAL_CURSOR_BACKGROUND_COLOR` | `cursorAccent` |\n| Selection | `TERMINAL_SELECTION_BACKGROUND_COLOR` | `selectionBackground` |\n| Selection Foreground | `TERMINAL_SELECTION_FOREGROUND_COLOR` | `selectionForeground` |\n| ANSI Colors | `ansiColorIdentifiers[0-15]` | `black`, `red`, `green`, etc. |\n\n**Sources:** [src/vs/workbench/contrib/terminal/browser/xterm/xtermTerminal.ts:1000-1200](), [src/vs/workbench/contrib/terminal/common/terminalColorRegistry.ts:1-100]()\n\n## Terminal Lifecycle and DOM Attachment\n\nThe lifecycle of an xterm.js terminal in VS Code follows a specific sequence coordinated between `TerminalInstance` and `XtermTerminal`.\n\n### Creation and Attachment Flow\n\n```mermaid\nsequenceDiagram\n    participant TI as TerminalInstance\n    participant XT as XtermTerminal\n    participant Raw as Terminal (xterm.js)\n    participant DOM as DOM Element\n    \n    TI-\u003e\u003eXT: new XtermTerminal()\n    XT-\u003e\u003eRaw: new Terminal(options)\n    XT-\u003e\u003eXT: Load core addons\n    XT--\u003e\u003eTI: Returns XtermTerminal\n    \n    Note over TI: Wait for container ready\n    \n    TI-\u003e\u003eXT: attachToElement(container, options)\n    XT-\u003e\u003eRaw: open(container)\n    XT-\u003e\u003eXT: Load lazy addons\n    XT-\u003e\u003eRaw: Attach addons\n    XT-\u003e\u003eTI: Trigger xtermOpen event\n    \n    Note over Raw,DOM: Terminal now rendering\n    \n    TI-\u003e\u003eXT: write(data)\n    XT-\u003e\u003eRaw: write(data)\n    Raw-\u003e\u003eDOM: Render to canvas/webgl\n```\n\n### Key Lifecycle Events\n\nThe `XtermTerminal` class exposes events that `TerminalInstance` listens to:\n\n| Event | Purpose | Fired When |\n|-------|---------|------------|\n| `onDidChangeFindResults` | Find results changed | Search addon finds/updates matches |\n| `onDidChangeSelection` | Selection changed | User selects text |\n| `onDidRequestRunCommand` | Command execution requested | User triggers command from menu |\n| `onDidRequestFocus` | Focus requested | Terminal requests focus programmatically |\n\n**Sources:** [src/vs/workbench/contrib/terminal/browser/xterm/xtermTerminal.ts:150-400](), [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts:520-580]()\n\n## Configuration Mapping\n\nThe `XtermTerminal` class maps VS Code terminal settings to xterm.js options through the `_configHelper` utility.\n\n### Option Conversion\n\n```mermaid\ngraph TB\n    VSCodeConfig[\"VS Code Configuration\"]\n    configService[\"IConfigurationService\"]\n    \n    subgraph \"Configuration Helper\"\n        getConfig[\"getConfig()\"]\n        fontConfig[\"Font settings\"]\n        cursorConfig[\"Cursor settings\"]\n        scrollbackConfig[\"Scrollback settings\"]\n        behaviorConfig[\"Behavior settings\"]\n    end\n    \n    XtermOptions[\"ITerminalOptions\"]\n    \n    VSCodeConfig --\u003e configService\n    configService --\u003e getConfig\n    \n    getConfig --\u003e fontConfig\n    getConfig --\u003e cursorConfig\n    getConfig --\u003e scrollbackConfig\n    getConfig --\u003e behaviorConfig\n    \n    fontConfig --\u003e XtermOptions\n    cursorConfig --\u003e XtermOptions\n    scrollbackConfig --\u003e XtermOptions\n    behaviorConfig --\u003e XtermOptions\n    \n    XtermOptions --\u003e rawTerminal[\"raw.options\"]\n```\n\n### Key Settings Mapped\n\n| VS Code Setting | XTerm Option | Notes |\n|-----------------|--------------|-------|\n| `terminal.integrated.fontSize` | `fontSize` | Default: 14 (Windows/Linux), 12 (macOS) |\n| `terminal.integrated.fontFamily` | `fontFamily` | Falls back to editor font family |\n| `terminal.integrated.lineHeight` | `lineHeight` | Default: 1 (1.1 on Linux) |\n| `terminal.integrated.letterSpacing` | `letterSpacing` | Default: 0 |\n| `terminal.integrated.fontWeight` | `fontWeight` | Normal or numeric 1-1000 |\n| `terminal.integrated.cursorStyle` | `cursorStyle` | block, underline, line |\n| `terminal.integrated.cursorBlinking` | `cursorBlink` | Boolean |\n| `terminal.integrated.scrollback` | `scrollback` | Default: 1000 lines |\n| `terminal.integrated.fastScrollSensitivity` | `fastScrollSensitivity` | Scroll multiplier |\n| `terminal.integrated.tabStopWidth` | `tabStopWidth` | Default: 8 |\n\nThe `updateConfig()` method is called whenever relevant configuration changes are detected, applying updates to the live xterm.js instance.\n\n**Sources:** [src/vs/workbench/contrib/terminal/browser/xterm/xtermTerminal.ts:900-1100](), [src/vs/workbench/contrib/terminal/common/terminalConfiguration.ts:40-220]()\n\n## Data Flow Between Process and XTerm\n\nTerminal data flows bidirectionally between the PTY process and xterm.js, with `TerminalInstance` coordinating the flow through `XtermTerminal`. The system implements flow control mechanisms to prevent overwhelming the renderer with data.\n\n### Bidirectional Data Flow\n\n```mermaid\ngraph TB\n    subgraph ProcessLayer[\"Process Layer\"]\n        PTY[\"PTY Process\u003cbr/\u003e(shell)\"]\n        ProcessManager[\"TerminalProcessManager\"]\n    end\n    \n    subgraph InstanceLayer[\"Instance Layer\"]\n        Instance[\"TerminalInstance\"]\n        DataBufferer[\"TerminalDataBufferer\"]\n        AckBufferer[\"AckDataBufferer\"]\n    end\n    \n    subgraph XTermLayer[\"XTerm Layer\"]\n        XtermWrapper[\"XtermTerminal\"]\n        RawXterm[\"Terminal\u003cbr/\u003e(xterm.js)\"]\n    end\n    \n    subgraph UILayer[\"UI Layer\"]\n        Canvas[\"Canvas/WebGL\u003cbr/\u003eRenderer\"]\n        User[\"User Input\"]\n    end\n    \n    PTY --\u003e|\"stdout data\"| ProcessManager\n    ProcessManager --\u003e|\"onProcessData event\"| Instance\n    Instance --\u003e|\"buffer \u0026 throttle\"| DataBufferer\n    DataBufferer --\u003e|\"write(data)\"| XtermWrapper\n    XtermWrapper --\u003e|\"write(data)\"| RawXterm\n    RawXterm --\u003e|\"render\"| Canvas\n    \n    RawXterm -.-\u003e|\"onWriteParsed event\u003cbr/\u003e(char count)\"| XtermWrapper\n    XtermWrapper -.-\u003e|\"batch acks\"| AckBufferer\n    AckBufferer -.-\u003e|\"acknowledgeDataEvent()\"| ProcessManager\n    \n    User --\u003e|\"keyboard/mouse\"| RawXterm\n    RawXterm --\u003e|\"onData event\"| XtermWrapper\n    XtermWrapper --\u003e|\"onData event\"| Instance\n    Instance --\u003e|\"sendText()\"| ProcessManager\n    ProcessManager --\u003e|\"stdin\"| PTY\n```\n\n### Output Flow (Process  XTerm)\n\nThe output path from shell to renderer involves several stages:\n\n1. **Process Data Event**: `TerminalProcessManager.onProcessData` emits when PTY sends output\n2. **Initial Buffering**: Data passes through `_initialDataEventsListener` if terminal not ready\n3. **Data Buffering**: `TerminalDataBufferer` accumulates writes to reduce xterm.js calls\n4. **XTerm Write**: `TerminalInstance._handleOnData()` calls `xterm.write(data)`\n5. **XTerm Processing**: xterm.js parses ANSI escape sequences, updates buffer\n6. **Rendering**: Canvas or WebGL renderer draws updated cells to screen\n7. **Acknowledgment**: `onWriteParsed` event triggers flow control acknowledgment\n\nThe `TerminalDataBufferer` uses a timer-based approach to batch writes:\n- Buffers data for up to `WRITE_INTERVAL_MS` (5ms)\n- Flushes immediately if buffer exceeds `WRITE_MAX_BATCH_SIZE` (50 items)\n- Prevents excessive write calls to xterm.js\n\n### Input Flow (User  Process)\n\nUser input follows a simpler path:\n\n1. **User Input**: User types or pastes in terminal\n2. **XTerm onData**: xterm.js `onData` event fires with input string\n3. **Pre-Processing**: `_onWillData` event allows filtering (e.g., shell integration)\n4. **Instance Handling**: `TerminalInstance._handleOnData()` receives input\n5. **Process Write**: `TerminalProcessManager.write(data)` called\n6. **PTY Input**: Data written to PTY stdin via `_process.input()`\n\n**Sources:** [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts:654-657](), [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts:1135-1160](), [src/vs/platform/terminal/common/terminalDataBuffering.ts:10-80](), [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts:166-167]()\n\n## Flow Control and Backpressure\n\nVS Code implements flow control to prevent the PTY process from overwhelming xterm.js with data faster than it can render. This is critical for handling high-throughput scenarios like `cat`-ing large files.\n\n### Flow Control Architecture\n\n```mermaid\ngraph TB\n    PTY[\"PTY Process\"]\n    ProcessManager[\"TerminalProcessManager\"]\n    AckBufferer[\"AckDataBufferer\"]\n    XTerm[\"xterm.js Terminal\"]\n    \n    PTY --\u003e|\"1. Send data\"| ProcessManager\n    ProcessManager --\u003e|\"2. Forward data\"| TerminalInstance[\"TerminalInstance\"]\n    TerminalInstance --\u003e|\"3. write(data)\"| XTerm\n    \n    XTerm -.-\u003e|\"4. onWriteParsed\u003cbr/\u003e(charCount)\"| TerminalInstance\n    TerminalInstance -.-\u003e|\"5. acknowledgeDataEvent\u003cbr/\u003e(charCount)\"| AckBufferer\n    \n    AckBufferer -.-\u003e|\"6. Batched ack\"| ProcessManager\n    ProcessManager -.-\u003e|\"7. processBinary\u003cbr/\u003e(ack message)\"| BackendProcess[\"Backend PTY\"]\n    \n    BackendProcess -.-\u003e|\"8. Resume if paused\"| PTY\n```\n\n### AckDataBufferer Implementation\n\nThe `AckDataBufferer` class batches acknowledgment messages to reduce IPC overhead:\n\n```typescript\n// From terminalProcessManager.ts\nthis._ackDataBufferer = new AckDataBufferer(e =\u003e this._process?.acknowledgeDataEvent(e));\n```\n\nKey characteristics:\n- **Batching Window**: Accumulates acks for `BATCH_WINDOW_MS` (40ms)\n- **Batch Threshold**: Flushes immediately if batch reaches `MAX_BATCH_SIZE` (100 acks)\n- **Character Counting**: Tracks total characters acknowledged, not individual events\n\n### Flow Control Constants\n\nFlow control behavior is governed by constants in `FlowControlConstants`:\n\n| Constant | Value | Purpose |\n|----------|-------|---------|\n| `RESUMPTION_THRESHOLD` | 5 | Resume writes when unacked bytes drop below this threshold |\n| `HIGH_WATERMARK` | 10 | Pause writes when unacked bytes exceed this threshold |\n| `INTERVAL` | 40ms | How often to check flow control state |\n\nThese constants create a hysteresis mechanism that prevents rapid pause/resume cycling.\n\n### Backpressure Propagation\n\nWhen the renderer falls behind:\n\n1. **Detection**: xterm.js reports parsed character counts via `onWriteParsed`\n2. **Throttling**: If unacked data exceeds `HIGH_WATERMARK`, backend pauses PTY reads\n3. **Resumption**: When unacked data drops below `RESUMPTION_THRESHOLD`, reads resume\n4. **IPC Efficiency**: Acknowledgments are batched to minimize IPC message overhead\n\nThis prevents the PTY from buffering excessive data and ensures smooth terminal responsiveness even under heavy output load.\n\n**Sources:** [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts:93-167](), [src/vs/platform/terminal/common/terminal.ts:700-720](), [src/vs/platform/terminal/common/terminalDataBuffering.ts:80-150]()\n\n## XTerm Terminal Dimensions and Resizing\n\nTerminal dimensions are managed through a coordinate system between the terminal instance and xterm.js.\n\n### Dimension Calculation Flow\n\n```mermaid\ngraph TB\n    LayoutChange[\"Container Layout Change\"]\n    \n    getFont[\"getXtermScaledDimensions()\"]\n    fontMetrics[\"Font Metrics\u003cbr/\u003e(char width/height)\"]\n    containerSize[\"Container Size\u003cbr/\u003e(pixels)\"]\n    \n    calcDims[\"Calculate cols/rows\"]\n    cols[\"cols = floor(width / charWidth)\"]\n    rows[\"rows = floor(height / charHeight)\"]\n    \n    resize[\"xterm.resize(cols, rows)\"]\n    ptyResize[\"pty.resize(cols, rows)\"]\n    \n    LayoutChange --\u003e getFont\n    getFont --\u003e fontMetrics\n    getFont --\u003e containerSize\n    \n    fontMetrics --\u003e calcDims\n    containerSize --\u003e calcDims\n    \n    calcDims --\u003e cols\n    calcDims --\u003e rows\n    \n    cols --\u003e resize\n    rows --\u003e resize\n    \n    resize --\u003e ptyResize\n```\n\nThe `getXtermScaledDimensions()` function calculates how many character cells fit in the available pixel dimensions based on font metrics. The result includes:\n\n- `cols`: Number of character columns\n- `rows`: Number of character rows  \n- `cellWidth`: Width of each character cell in pixels\n- `cellHeight`: Height of each character cell in pixels\n\nWhen dimensions change, both xterm.js and the PTY process are notified to maintain synchronization.\n\n**Sources:** [src/vs/workbench/contrib/terminal/browser/xterm/xtermTerminal.ts:1200-1400](), [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts:1400-1600]()\n\n## Performance Considerations\n\nThe xterm.js integration includes several performance optimizations that ensure responsive terminal operation even with heavy data throughput.\n\n### Performance Optimization Techniques\n\n| Optimization | Implementation | Benefit | Configuration |\n|--------------|----------------|---------|---------------|\n| **Data Buffering** | `TerminalDataBufferer` batches writes | Reduces xterm.js write() calls | `WRITE_INTERVAL_MS: 5ms` |\n| **Ack Buffering** | `AckDataBufferer` batches flow control | Reduces IPC overhead | `BATCH_WINDOW_MS: 40ms` |\n| **Lazy Addon Loading** | Dynamic imports via `importAMDNodeModule()` | Faster terminal creation | Automatic |\n| **WebGL Rendering** | GPU acceleration via `WebglAddon` | Faster rendering for large terminals | `terminal.integrated.gpuAcceleration` |\n| **Flow Control** | High/low watermark throttling | Prevents UI blocking | `FlowControlConstants` |\n| **Reflow on Idle** | `runWhenWindowIdle()` delays reflow | Smooth resizing | Automatic |\n| **Scrollback Limits** | Configurable line buffer | Controls memory usage | `terminal.integrated.scrollback` |\n| **Write Parsing** | xterm.js `onWriteParsed` event | Accurate flow control | Built-in |\n\n### Critical Performance Paths\n\nThe most performance-sensitive operations are:\n\n1. **High-Throughput Output**: Handled by flow control preventing buffer overflow\n2. **Terminal Creation**: Optimized by lazy addon loading and dimension calculation\n3. **Resizing**: Debounced via `TerminalResizeDebouncer` to batch layout changes\n4. **Theme Changes**: Efficient color updates via `getXtermTheme()` mapping\n5. **Scrolling**: Smooth scroll enabled via `terminal.integrated.smoothScrolling`\n\n### Memory Management\n\nMemory usage is controlled through:\n- **Scrollback Limit**: Default 1000 lines, configurable per terminal\n- **Addon Lifecycle**: Addons disposed when terminal destroyed\n- **Buffer Clearing**: `clearBuffer()` method for explicit cleanup\n- **Detached Terminal Reuse**: Headless terminals reused for replay scenarios\n\n**Sources:** [src/vs/platform/terminal/common/terminalDataBuffering.ts:10-150](), [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts:93-167](), [src/vs/workbench/contrib/terminal/browser/xterm/xtermTerminal.ts:400-600](), [src/vs/platform/terminal/common/terminal.ts:700-720]()\n\n## Detached Terminal Support\n\nVS Code supports \"detached\" xterm terminals that render outside of a full `TerminalInstance` context. These are used for UI components like chat tool outputs.\n\n### Detached Terminal Creation\n\nThe `createDetachedXterm()` method creates a standalone xterm instance with minimal capabilities:\n\n```typescript\ninterface IDetachedXTermOptions {\n    cols: number;\n    rows: number;\n    colorProvider: IXtermColorProvider;\n    capabilities?: ITerminalCapabilityStore;\n    readonly?: boolean;\n    processInfo: ITerminalProcessInfo;\n    disableOverviewRuler?: boolean;\n}\n```\n\nDetached terminals:\n- Have no `TerminalInstance` wrapper\n- Support read-only mode for displaying command output\n- Can replay existing terminal state\n- Share the same theme and rendering system\n\n**Sources:** [src/vs/workbench/contrib/terminal/browser/terminalService.ts:900-1100](), [src/vs/workbench/contrib/terminal/browser/terminal.ts:340-420]()"])</script><script>self.__next_f.push([1,"35:T93ce,"])</script><script>self.__next_f.push([1,"# Multi-Server Terminal Support\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [src/vs/platform/terminal/common/terminal.ts](src/vs/platform/terminal/common/terminal.ts)\n- [src/vs/platform/terminal/common/terminalEnvironment.ts](src/vs/platform/terminal/common/terminalEnvironment.ts)\n- [src/vs/platform/terminal/common/terminalRecorder.ts](src/vs/platform/terminal/common/terminalRecorder.ts)\n- [src/vs/platform/terminal/node/ptyHostMain.ts](src/vs/platform/terminal/node/ptyHostMain.ts)\n- [src/vs/platform/terminal/node/ptyHostService.ts](src/vs/platform/terminal/node/ptyHostService.ts)\n- [src/vs/platform/terminal/node/ptyService.ts](src/vs/platform/terminal/node/ptyService.ts)\n- [src/vs/platform/terminal/node/terminalProcess.ts](src/vs/platform/terminal/node/terminalProcess.ts)\n- [src/vs/platform/terminal/test/common/terminalEnvironment.test.ts](src/vs/platform/terminal/test/common/terminalEnvironment.test.ts)\n- [src/vs/platform/terminal/test/common/terminalProfiles.test.ts](src/vs/platform/terminal/test/common/terminalProfiles.test.ts)\n- [src/vs/platform/terminal/test/common/terminalRecorder.test.ts](src/vs/platform/terminal/test/common/terminalRecorder.test.ts)\n- [src/vs/workbench/api/browser/mainThreadTerminalService.ts](src/vs/workbench/api/browser/mainThreadTerminalService.ts)\n- [src/vs/workbench/api/common/extHostTerminalService.ts](src/vs/workbench/api/common/extHostTerminalService.ts)\n- [src/vs/workbench/api/node/extHostTerminalService.ts](src/vs/workbench/api/node/extHostTerminalService.ts)\n- [src/vs/workbench/contrib/terminal/browser/media/terminal.css](src/vs/workbench/contrib/terminal/browser/media/terminal.css)\n- [src/vs/workbench/contrib/terminal/browser/media/xterm.css](src/vs/workbench/contrib/terminal/browser/media/xterm.css)\n- [src/vs/workbench/contrib/terminal/browser/remotePty.ts](src/vs/workbench/contrib/terminal/browser/remotePty.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminal.contribution.ts](src/vs/workbench/contrib/terminal/browser/terminal.contribution.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminal.ts](src/vs/workbench/contrib/terminal/browser/terminal.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalActions.ts](src/vs/workbench/contrib/terminal/browser/terminalActions.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalEditor.ts](src/vs/workbench/contrib/terminal/browser/terminalEditor.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalEditorInput.ts](src/vs/workbench/contrib/terminal/browser/terminalEditorInput.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalEditorService.ts](src/vs/workbench/contrib/terminal/browser/terminalEditorService.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalGroup.ts](src/vs/workbench/contrib/terminal/browser/terminalGroup.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalGroupService.ts](src/vs/workbench/contrib/terminal/browser/terminalGroupService.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts](src/vs/workbench/contrib/terminal/browser/terminalInstance.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalInstanceService.ts](src/vs/workbench/contrib/terminal/browser/terminalInstanceService.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalMenus.ts](src/vs/workbench/contrib/terminal/browser/terminalMenus.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalProcessExtHostProxy.ts](src/vs/workbench/contrib/terminal/browser/terminalProcessExtHostProxy.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts](src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalService.ts](src/vs/workbench/contrib/terminal/browser/terminalService.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalStatusList.ts](src/vs/workbench/contrib/terminal/browser/terminalStatusList.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalTabbedView.ts](src/vs/workbench/contrib/terminal/browser/terminalTabbedView.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalTabsList.ts](src/vs/workbench/contrib/terminal/browser/terminalTabsList.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalView.ts](src/vs/workbench/contrib/terminal/browser/terminalView.ts)\n- [src/vs/workbench/contrib/terminal/browser/xterm/xtermTerminal.ts](src/vs/workbench/contrib/terminal/browser/xterm/xtermTerminal.ts)\n- [src/vs/workbench/contrib/terminal/common/terminal.ts](src/vs/workbench/contrib/terminal/common/terminal.ts)\n- [src/vs/workbench/contrib/terminal/common/terminalColorRegistry.ts](src/vs/workbench/contrib/terminal/common/terminalColorRegistry.ts)\n- [src/vs/workbench/contrib/terminal/common/terminalConfiguration.ts](src/vs/workbench/contrib/terminal/common/terminalConfiguration.ts)\n- [src/vs/workbench/contrib/terminal/common/terminalEnvironment.ts](src/vs/workbench/contrib/terminal/common/terminalEnvironment.ts)\n- [src/vs/workbench/contrib/terminal/common/terminalStrings.ts](src/vs/workbench/contrib/terminal/common/terminalStrings.ts)\n- [src/vs/workbench/contrib/terminal/test/browser/terminalStatusList.test.ts](src/vs/workbench/contrib/terminal/test/browser/terminalStatusList.test.ts)\n- [src/vs/workbench/contrib/terminal/test/common/terminalEnvironment.test.ts](src/vs/workbench/contrib/terminal/test/common/terminalEnvironment.test.ts)\n- [src/vs/workbench/contrib/terminalContrib/voice/browser/terminal.voice.contribution.ts](src/vs/workbench/contrib/terminalContrib/voice/browser/terminal.voice.contribution.ts)\n- [src/vs/workbench/contrib/terminalContrib/voice/browser/terminalVoice.ts](src/vs/workbench/contrib/terminalContrib/voice/browser/terminalVoice.ts)\n- [src/vs/workbench/contrib/terminalContrib/voice/browser/terminalVoiceActions.ts](src/vs/workbench/contrib/terminalContrib/voice/browser/terminalVoiceActions.ts)\n\n\u003c/details\u003e\n\n\n\nThis document describes VS Code's multi-server terminal architecture, which enables terminals to be hosted across different execution environments. This system allows terminals to run locally (on the same machine as the editor), remotely (on SSH hosts or in containers), or in web contexts (browser-based terminals).\n\nFor information about the terminal instance lifecycle and UI components, see [Terminal Instance and Process Management](#8.2). For extension API details, see [Terminal Extension API](#8.7).\n\n## Purpose and Scope\n\nMulti-server terminal support refers to the ability to create and manage terminal processes across different \"backends\" or \"servers\" within a single VS Code session. Each backend represents a different execution environment where terminal processes can be spawned. This architecture enables:\n\n- **Local terminals**: Running on the user's local machine\n- **Remote terminals**: Running on remote machines accessed via SSH, containers, or remote workspaces\n- **Web terminals**: Running in browser contexts via web workers or remote connections\n- **Concurrent multi-backend operation**: Multiple backends active simultaneously in a remote workspace scenario\n\n## Architecture Overview\n\nThe multi-server terminal system is built around the `ITerminalBackend` interface, where each backend represents a different execution environment. The `TerminalInstanceService` maintains a registry of backends indexed by `remoteAuthority` string.\n\n### Backend Registration and Discovery\n\n**Backend Registry in TerminalInstanceService**\n\n```mermaid\ngraph TB\n    subgraph \"Service Layer\"\n        TS[TerminalService]\n        TIS[TerminalInstanceService\u003cbr/\u003e_backends: Map]\n    end\n    \n    subgraph \"Backend Registration\"\n        LB[LocalTerminalBackendContribution\u003cbr/\u003eremoteAuthority: undefined]\n        RB[RemoteTerminalBackendContribution\u003cbr/\u003eremoteAuthority: string]\n    end\n    \n    subgraph \"PTY Communication\"\n        LPS[LocalPtyService\u003cbr/\u003esrc/platform/terminal/node/ptyService.ts]\n        RPS[Remote IPtyService\u003cbr/\u003evia IRemoteAgentService]\n    end\n    \n    TS --\u003e|\"getBackend(authority)\"| TIS\n    LB --\u003e|\"didRegisterBackend()\"| TIS\n    RB --\u003e|\"didRegisterBackend()\"| TIS\n    \n    TIS --\u003e|\"onDidRegisterBackend.fire()\"| TS\n    \n    LB --\u003e|\"ptyService\"| LPS\n    RB --\u003e|\"ptyService\"| RPS\n```\n\nThe `ITerminalInstanceService` interface defines the backend registry:\n\n```typescript\ninterface ITerminalInstanceService {\n    readonly onDidRegisterBackend: Event\u003cITerminalBackend\u003e;\n    getBackend(remoteAuthority?: string): Promise\u003cITerminalBackend | undefined\u003e;\n    getRegisteredBackends(): IterableIterator\u003cITerminalBackend\u003e;\n    didRegisterBackend(backend: ITerminalBackend): void;\n}\n```\n\n**Sources**: [src/vs/workbench/contrib/terminal/browser/terminal.ts:66-103](), [src/vs/workbench/contrib/terminal/browser/terminalService.ts:280-337](), [src/vs/workbench/contrib/terminal/browser/terminalInstanceService.ts:1-100]()\n\n### Terminal Creation Flow Across Backends\n\nWhen a terminal is created via `TerminalService.createTerminal()`, the system resolves the appropriate backend based on `IWorkbenchEnvironmentService.remoteAuthority`:\n\n**Terminal Creation Sequence**\n\n```mermaid\nsequenceDiagram\n    participant User\n    participant TS as TerminalService\n    participant TIS as TerminalInstanceService\n    participant TPM as TerminalProcessManager\n    participant Backend as ITerminalBackend\n    participant PS as IPtyService\n    \n    User-\u003e\u003eTS: createTerminal(options)\n    TS-\u003e\u003eTS: _resolveLocation(options)\n    TS-\u003e\u003eTIS: getBackend(remoteAuthority)\n    TIS--\u003e\u003eTS: ITerminalBackend\n    TS-\u003e\u003eTIS: createInstance(launchConfig, target)\n    TIS-\u003e\u003eTPM: new TerminalProcessManager(...)\n    Note over TPM: remoteAuthority field set\n    TPM-\u003e\u003eBackend: getBackend(this.remoteAuthority)\n    TPM-\u003e\u003ePS: createProcess(shellLaunchConfig, cols, rows)\n    PS--\u003e\u003eTPM: onProcessReady event\n    TPM--\u003e\u003eTIS: TerminalInstance\n    TIS--\u003e\u003eTS: ITerminalInstance\n```\n\nThe `remoteAuthority` value comes from `IWorkbenchEnvironmentService.remoteAuthority` and determines backend selection:\n- `undefined`  Local backend\n- `'ssh-remote+hostname'`  Remote backend for that host\n- `'wsl+distro'`  WSL backend\n\n**Sources**: [src/vs/workbench/contrib/terminal/browser/terminalService.ts:240-336](), [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts:139-161](), [src/vs/workbench/contrib/terminal/browser/terminalInstanceService.ts:1-100]()\n\n## Backend System\n\n### ITerminalBackend Interface\n\nThe `ITerminalBackend` interface in [src/vs/platform/terminal/common/terminal.ts] defines the contract for all terminal backends. Each backend wraps an `IPtyService` instance:\n\n| Method/Property | Description | Implementation Location |\n|----------------|-------------|------------------------|\n| `remoteAuthority: string \\| undefined` | Backend identifier (undefined = local) | Set during registration |\n| `createProcess()` | Spawns new terminal process | Delegates to `IPtyService.createProcess()` |\n| `attachToProcess()` | Reattaches to persistent process | For reconnection scenarios |\n| `listProcesses()` | Lists active processes | Used for process discovery |\n| `onDidRequestDetach: Event\u003c...\u003e` | Terminal detachment request | Fired when terminal should persist |\n| `setReady()` | Marks backend ready | Called after initialization |\n| `getTerminalLayoutInfo()` | Retrieves layout for reconnection | Returns `ITerminalsLayoutInfo` |\n| `setTerminalLayoutInfo()` | Persists layout | Stores tabs and background terminals |\n| `getPerformanceMarks()` | Performance timing data | For diagnostics |\n| `reduceConnectionGraceTime()` | Reduces reconnection timeout | Remote-specific optimization |\n\n**Backend Implementation Pattern**\n\nBackends implement the interface by wrapping an `IPtyService`:\n\n```typescript\nclass TerminalBackend implements ITerminalBackend {\n    constructor(\n        private readonly _ptyService: IPtyService,\n        public readonly remoteAuthority: string | undefined\n    ) {}\n    \n    createProcess(shellLaunchConfig, cols, rows, env) {\n        return this._ptyService.createProcess(...);\n    }\n}\n```\n\n**Sources**: [src/vs/platform/terminal/common/terminal.ts:789-875](), [src/vs/workbench/contrib/terminal/browser/terminalService.ts:280-283]()\n\n### Backend Registration\n\nBackends register themselves with the `ITerminalInstanceService`:\n\n```typescript\n// Backend registration pattern\ninterface ITerminalInstanceService {\n    readonly onDidRegisterBackend: Event\u003cITerminalBackend\u003e;\n    getBackend(remoteAuthority?: string): Promise\u003cITerminalBackend | undefined\u003e;\n    getRegisteredBackends(): IterableIterator\u003cITerminalBackend\u003e;\n    didRegisterBackend(backend: ITerminalBackend): void;\n}\n```\n\nThe service maintains a registry of backends indexed by their `remoteAuthority` string. When `undefined` is passed as the authority, it returns the local backend.\n\n**Sources**: [src/vs/workbench/contrib/terminal/browser/terminal.ts:66-103]()\n\n## Backend Types\n\n### Local Backend\n\nThe local backend (`LocalTerminalBackendContribution`) manages terminals on the local machine. It is registered with `remoteAuthority = undefined`.\n\n**Local Backend Architecture**\n\n```mermaid\ngraph TB\n    subgraph \"Renderer Process (workbench)\"\n        LTBC[LocalTerminalBackendContribution\u003cbr/\u003esrc/workbench/contrib/terminal/electron-sandbox]\n        TPM[TerminalProcessManager\u003cbr/\u003eremoteAuthority: undefined]\n    end\n    \n    subgraph \"Shared Process\"\n        LPC[LocalPtyChannel\u003cbr/\u003eTerminalIpcChannels.LocalPty]\n    end\n    \n    subgraph \"PTY Host Process (separate node process)\"\n        PHC[PtyHostChannel\u003cbr/\u003eTerminalIpcChannels.PtyHost]\n        PS[PtyService\u003cbr/\u003esrc/platform/terminal/node/ptyService.ts]\n        TP[TerminalProcess\u003cbr/\u003esrc/platform/terminal/node/terminalProcess.ts]\n        NPT[node-pty IPty]\n    end\n    \n    LTBC --\u003e|\"ProxyChannel\"| LPC\n    LPC --\u003e|\"IPC\"| PHC\n    PHC --\u003e PS\n    PS --\u003e|\"createProcess()\"| TP\n    TP --\u003e|\"spawn()\"| NPT\n    TPM --\u003e|\"backend.createProcess()\"| LTBC\n```\n\n**Key Implementation Details**:\n\n- **Backend Class**: `LocalTerminalBackendContribution` in electron-sandbox/terminal.contribution.ts\n- **PTY Service**: `PtyService` in [src/vs/platform/terminal/node/ptyService.ts:77-900]()\n- **Process Creation**: `TerminalProcess` wraps `node-pty` IPty in [src/vs/platform/terminal/node/terminalProcess.ts:25-600]()\n- **IPC Channels**: Uses `TerminalIpcChannels.LocalPty` and `TerminalIpcChannels.PtyHost`\n- **Process Spawn**: Native `node-pty.spawn()` creates actual PTY with shell process\n\nThe local backend is initialized early in workbench startup and registers itself via `ITerminalInstanceService.didRegisterBackend()`.\n\n**Sources**: [src/vs/platform/terminal/common/terminal.ts:221-242](), [src/vs/platform/terminal/node/ptyService.ts:77-121](), [src/vs/platform/terminal/node/terminalProcess.ts:25-80]()\n\n### Remote Backend\n\nThe remote backend (`RemoteTerminalBackendContribution`) manages terminals on remote machines via the remote agent connection. It is registered with a `remoteAuthority` string (e.g., `'ssh-remote+hostname'`).\n\n**Remote Backend Architecture**\n\n```mermaid\ngraph TB\n    subgraph \"Local Workbench (Renderer)\"\n        RTBC[RemoteTerminalBackendContribution\u003cbr/\u003esrc/workbench/contrib/terminal/browser/remoteTerminalBackend.ts]\n        TPM[TerminalProcessManager\u003cbr/\u003eremoteAuthority: 'ssh-remote+host']\n        RP[RemotePty\u003cbr/\u003esrc/workbench/contrib/terminal/browser/remotePty.ts]\n    end\n    \n    subgraph \"Remote Agent Connection\"\n        RAS[IRemoteAgentService]\n        RPC[Remote RPC Channel]\n    end\n    \n    subgraph \"Remote Machine (Server)\"\n        PHS[PtyHostService\u003cbr/\u003esrc/platform/terminal/node/ptyHostService.ts]\n        PS[PtyService\u003cbr/\u003esrc/platform/terminal/node/ptyService.ts]\n        TP[TerminalProcess]\n        NPT[node-pty IPty]\n    end\n    \n    RTBC --\u003e|\"getConnection()\"| RAS\n    RAS --\u003e RPC\n    TPM --\u003e|\"createProcess()\"| RTBC\n    RTBC --\u003e|\"creates\"| RP\n    RP --\u003e|\"Remote RPC\"| RPC\n    RPC --\u003e|\"ProxyChannel\"| PHS\n    PHS --\u003e PS\n    PS --\u003e TP\n    TP --\u003e NPT\n```\n\n**Key Implementation Details**:\n\n- **Backend Class**: `RemoteTerminalBackendContribution` in [src/vs/workbench/contrib/terminal/browser/remoteTerminalBackend.ts:24-100]()\n- **Remote PTY**: `RemotePty` implements `ITerminalChildProcess` in [src/vs/workbench/contrib/terminal/browser/remotePty.ts:20-100]()\n- **PTY Host Service**: `PtyHostService` in [src/vs/platform/terminal/node/ptyHostService.ts:30-200]() wraps `PtyService`\n- **Connection**: Uses `IRemoteAgentService.getConnection()` to get RPC channel\n- **Reconnection**: Supports persistent sessions via `attachToProcess()` with process IDs\n\n**Remote Process Lifecycle**:\n\n1. `RemotePty.start()` calls remote `IPtyService.createProcess()` via RPC\n2. Remote `PtyService` spawns `TerminalProcess` with `node-pty`\n3. Data flows: Remote PTY  RPC channel  `RemotePty`  `TerminalProcessManager`  `TerminalInstance`\n4. Process persists on remote machine, can be reattached after connection loss\n\n**Sources**: [src/vs/workbench/contrib/terminal/browser/remoteTerminalBackend.ts:24-100](), [src/vs/workbench/contrib/terminal/browser/remotePty.ts:20-100](), [src/vs/platform/terminal/node/ptyHostService.ts:30-200]()\n\n### Web Backend\n\nIn web contexts, terminals use alternative backends:\n\n- **Authority**: Varies based on remote connection or local web worker\n- **Pty Service**: Either remote pty service or web worker-based pseudoterminal\n- **Process Type**: Browser-based or remote native processes\n- **Limitations**: No direct native process spawning capability\n\n**Sources**: [src/vs/workbench/contrib/terminal/browser/terminalService.ts:222]()\n\n## Process Management Across Backends\n\n### TerminalProcessManager\n\nThe `TerminalProcessManager` class abstracts terminal process operations, allowing the same interface to work across different backends:\n\n```mermaid\ngraph TB\n    subgraph \"TerminalInstance\"\n        Instance[\"TerminalInstance\u003cbr/\u003eUI and xterm.js\"]\n    end\n    \n    subgraph \"TerminalProcessManager\"\n        ProcessManager[\"Process Manager\u003cbr/\u003eremoteAuthority field\"]\n        ProcessState[\"processState\u003cbr/\u003eptyProcessReady\"]\n        Backend[\"backend: ITerminalBackend\"]\n    end\n    \n    subgraph \"Backend Resolution\"\n        GetBackend[\"getBackend(remoteAuthority)\"]\n        LocalOrRemote{\"Local or\u003cbr/\u003eRemote?\"}\n    end\n    \n    subgraph \"Process Interface\"\n        ITerminalChildProcess[\"ITerminalChildProcess\"]\n        LocalProcess[\"LocalPty\"]\n        RemotePty[\"RemotePty\"]\n    end\n    \n    Instance --\u003e|\"_processManager\"| ProcessManager\n    ProcessManager --\u003e|\"createProcess()\"| GetBackend\n    GetBackend --\u003e LocalOrRemote\n    LocalOrRemote --\u003e|\"undefined\"| LocalProcess\n    LocalOrRemote --\u003e|\"string\"| RemotePty\n    LocalProcess -.-\u003e|\"implements\"| ITerminalChildProcess\n    RemotePty -.-\u003e|\"implements\"| ITerminalChildProcess\n    ProcessManager --\u003e|\"backend field\"| Backend\n```\n\n**Sources**: [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts:74-161]()\n\n### Process Creation with Backend Selection\n\nThe `TerminalProcessManager.createProcess()` method in [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts:295-395]() determines the appropriate backend:\n\n**Backend Resolution Logic**\n\n```typescript\n// TerminalProcessManager.createProcess()\nasync createProcess(\n    shellLaunchConfig: IShellLaunchConfig,\n    cols: number,\n    rows: number\n): Promise\u003cITerminalLaunchError | ITerminalLaunchResult | undefined\u003e {\n    \n    // 1. Resolve backend based on remoteAuthority field\n    this.backend = await this._terminalInstanceService.getBackend(this.remoteAuthority);\n    if (!this.backend) {\n        throw new Error(`No backend registered for remote authority: ${this.remoteAuthority}`);\n    }\n    \n    // 2. Get OS from backend\n    const backend = this.backend;\n    this.os = await backend.getBackendOS();\n    \n    // 3. Resolve shell launch config (paths, env, etc.)\n    await this._terminalProfileResolverService.resolveShellLaunchConfig(\n        shellLaunchConfig, \n        { remoteAuthority: this.remoteAuthority, os: this.os }\n    );\n    \n    // 4. Create process via backend's IPtyService\n    const result = await backend.createProcess(\n        shellLaunchConfig,\n        cwd,\n        cols,\n        rows,\n        unicodeVersion,\n        env,\n        shouldPersist\n    );\n    \n    // 5. Store process and setup listeners\n    this._process = result;\n    this._setupProcessListeners(this._process);\n}\n```\n\n**Backend Selection Table**\n\n| Scenario | `remoteAuthority` Value | Backend Used | PTY Location |\n|----------|------------------------|--------------|--------------|\n| Local terminal | `undefined` | `LocalTerminalBackendContribution` | Local pty-host process |\n| SSH remote | `'ssh-remote+hostname'` | `RemoteTerminalBackendContribution` | Remote machine |\n| WSL | `'wsl+distro'` | `RemoteTerminalBackendContribution` | WSL distro |\n| Dev Container | `'dev-container+...'` | `RemoteTerminalBackendContribution` | Container |\n| Web (no remote) | `undefined` | Web backend (limited) | Browser/web worker |\n\nMultiple instances can use different backends simultaneously in a multi-folder workspace with mixed local/remote folders.\n\n**Sources**: [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts:295-450](), [src/vs/workbench/contrib/terminal/browser/terminalService.ts:280-283]()\n\n## Backend Communication\n\n### IPC Channel Architecture\n\nTerminal backends communicate with PTY services through different IPC mechanisms depending on whether they're local or remote.\n\n**Local Backend IPC Architecture**\n\n```mermaid\ngraph TB\n    subgraph \"Renderer Process (Electron window)\"\n        LB[Local Backend]\n        PC1[ProxyChannel]\n    end\n    \n    subgraph \"Shared Process (long-lived)\"\n        LPC[LocalPtyChannel\u003cbr/\u003eTerminalIpcChannels.LocalPty]\n        PC2[ProxyChannel]\n    end\n    \n    subgraph \"PTY Host Process (separate node)\"\n        PHC[PtyHostChannel\u003cbr/\u003eTerminalIpcChannels.PtyHost]\n        PS[PtyService]\n        PP[PersistentTerminalProcess]\n    end\n    \n    LB --\u003e|\"Electron IPC\"| PC1\n    PC1 --\u003e LPC\n    LPC --\u003e|\"Node IPC\u003cbr/\u003e(child_process)\"| PC2\n    PC2 --\u003e PHC\n    PHC --\u003e PS\n    PS --\u003e|\"manages\"| PP\n```\n\n**Remote Backend RPC Architecture**\n\n```mermaid\ngraph TB\n    subgraph \"Local Workbench\"\n        RB[Remote Backend]\n        RPTY[RemotePty]\n    end\n    \n    subgraph \"Remote Agent Connection\"\n        RAS[RemoteAgentService]\n        RPCC[Remote ProxyChannel]\n    end\n    \n    subgraph \"Remote Server\"\n        PHS[PtyHostService]\n        RPS[PtyService]\n        PP[PersistentTerminalProcess]\n    end\n    \n    RB --\u003e RPTY\n    RPTY --\u003e|\"RPC via socket/WebSocket\"| RAS\n    RAS --\u003e RPCC\n    RPCC --\u003e PHS\n    PHS --\u003e RPS\n    RPS --\u003e|\"manages\"| PP\n```\n\n**IPC Channel Definitions**\n\nThe `TerminalIpcChannels` enum in [src/vs/platform/terminal/common/terminal.ts:221-242]() defines channel identifiers:\n\n| Channel | Source  Target | Purpose |\n|---------|----------------|---------|\n| `LocalPty` | Renderer  Shared process | Initial IPC hop for local terminals |\n| `PtyHost` | Shared process  PTY host | Second IPC hop to isolated PTY host |\n| `PtyHostWindow` | Renderer  PTY host | Direct channel (alternative path) |\n| `Logger` | PTY host  Main | Logging data from PTY host |\n| `Heartbeat` | PTY host  Main | Connection health checks |\n\n**Channel Creation Example**\n\n```typescript\n// Local backend gets channel\nconst localPtyChannel = mainProcessService.getChannel(TerminalIpcChannels.LocalPty);\nconst ptyService = ProxyChannel.toService\u003cIPtyService\u003e(localPtyChannel);\n\n// Remote backend gets channel\nconst connection = remoteAgentService.getConnection();\nconst channel = connection?.getChannel(REMOTE_TERMINAL_CHANNEL_NAME);\nconst ptyService = ProxyChannel.toService\u003cIPtyService\u003e(channel);\n```\n\n**Sources**: [src/vs/platform/terminal/common/terminal.ts:221-242](), [src/vs/platform/terminal/node/ptyService.ts:77-120](), [src/vs/workbench/contrib/terminal/browser/remotePty.ts:20-50]()\n\n### IPtyService Interface\n\nThe `IPtyService` interface in [src/vs/platform/terminal/common/terminal.ts:296-502]() defines the contract for all PTY services. Both `PtyService` (local/remote) and custom implementations must conform to this interface.\n\n**IPtyService Core Methods**\n\n| Method | Parameters | Returns | Purpose |\n|--------|-----------|---------|---------|\n| `createProcess()` | `IShellLaunchConfig, cwd, cols, rows, env, ...` | `Promise\u003cITerminalLaunchResult\u003e` | Spawns new PTY with shell |\n| `attachToProcess()` | `id: number` | `Promise\u003cvoid\u003e` | Reattaches to persistent process |\n| `detachFromProcess()` | `id: number, forcePersist?: boolean` | `Promise\u003cvoid\u003e` | Detaches for later reattachment |\n| `listProcesses()` | - | `Promise\u003cIProcessDetails[]\u003e` | Lists active processes |\n| `getDefaultSystemShell()` | `osOverride?: OS` | `Promise\u003cstring\u003e` | Gets default shell path |\n| `getProfiles()` | `workspaceId, profiles, defaultProfile` | `Promise\u003cITerminalProfile[]\u003e` | Resolves available profiles |\n| `getEnvironment()` | - | `Promise\u003cIProcessEnvironment\u003e` | Gets process environment |\n| `setTerminalLayoutInfo()` | `ISetTerminalLayoutInfoArgs` | `Promise\u003cvoid\u003e` | Persists layout for reconnection |\n| `getTerminalLayoutInfo()` | `IGetTerminalLayoutInfoArgs` | `Promise\u003cITerminalsLayoutInfo\u003e` | Retrieves persisted layout |\n| `reduceConnectionGraceTime()` | - | `Promise\u003cvoid\u003e` | Optimizes reconnection timeout |\n| `getPerformanceMarks()` | - | `Promise\u003cPerformanceMark[]\u003e` | Returns timing diagnostics |\n| `processBinary()` | `id: number, data: string` | `Promise\u003cvoid\u003e` | Sends binary data to process |\n| `acceptDetachInstanceReply()` | `requestId, persistentProcessId` | `Promise\u003cvoid\u003e` | Confirms detachment |\n\n**IPtyService Event Streams**\n\n| Event | Payload | Description |\n|-------|---------|-------------|\n| `onProcessData` | `{ id: number, event: IProcessDataEvent \\| string }` | Terminal output data |\n| `onProcessReady` | `{ id: number, event: IProcessReadyEvent }` | Process initialized with PID |\n| `onProcessReplay` | `{ id: number, event: IPtyHostProcessReplayEvent }` | Buffered data replay on reconnect |\n| `onProcessExit` | `{ id: number, event: number \\| undefined }` | Process exited with code |\n| `onProcessOrphanQuestion` | `{ id: number }` | Process orphaned, ask to keep |\n| `onDidChangeProperty` | `{ id: number, property: IProcessProperty }` | Property changed (cwd, title, etc.) |\n| `onDidRequestDetach` | `{ requestId, workspaceId, instanceId }` | Backend requests detachment |\n\n**Implementation: PtyService**\n\nThe main implementation is `PtyService` in [src/vs/platform/terminal/node/ptyService.ts:77-900]():\n\n```typescript\nexport class PtyService extends Disposable implements IPtyService {\n    private readonly _ptys: Map\u003cnumber, PersistentTerminalProcess\u003e = new Map();\n    private _lastPtyId: number = 0;\n    \n    async createProcess(\n        shellLaunchConfig: IShellLaunchConfig,\n        cwd: string,\n        cols: number,\n        rows: number,\n        // ... more params\n    ): Promise\u003cITerminalLaunchResult\u003e {\n        const id = ++this._lastPtyId;\n        const persistentTerminalProcess = new PersistentTerminalProcess(\n            id, \n            shellLaunchConfig, \n            cwd, \n            cols, \n            rows,\n            // ...\n        );\n        this._ptys.set(id, persistentTerminalProcess);\n        return { persistentTerminalId: id, resolvedShellLaunchConfig };\n    }\n}\n```\n\n**Sources**: [src/vs/platform/terminal/common/terminal.ts:296-502](), [src/vs/platform/terminal/node/ptyService.ts:77-200]()\n\n## Connection State Management\n\n### TerminalConnectionState\n\nThe terminal service tracks the overall connection state to backends:\n\n```typescript\nenum TerminalConnectionState {\n    Connecting,\n    Connected\n}\n```\n\nThe connection state affects:\n- Whether new terminals can be created\n- UI indicators showing backend availability\n- Reconnection logic for remote terminals\n\n**Sources**: [src/vs/workbench/contrib/terminal/browser/terminal.ts:323-326]()\n\n### Connection State Flow\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e Connecting: Service Initialize\n    Connecting --\u003e Connected: Backend Ready\n    Connected --\u003e Connecting: Connection Lost\n    Connecting --\u003e Connected: Reconnected\n    \n    note right of Connecting\n        - Cannot create terminals\n        - Show connecting UI\n        - Attempt reconnection\n    end note\n    \n    note right of Connected\n        - Normal operation\n        - Terminals can be created\n        - Process data flows\n    end note\n```\n\nThe state transition happens in `TerminalService`:\n\n```typescript\nprivate _setConnected() {\n    this._connectionState = TerminalConnectionState.Connected;\n    this._onDidChangeConnectionState.fire();\n    this._logService.trace('Pty host ready');\n}\n```\n\n**Sources**: [src/vs/workbench/contrib/terminal/browser/terminalService.ts:445-449]()\n\n## Reconnection and Persistence\n\n### Terminal Layout Persistence\n\nTerminal layout persistence enables reconnection to terminal processes after window reload or connection loss. This is especially important for remote backends where processes persist on the server.\n\n**Layout Persistence Flow**\n\n```mermaid\ngraph TB\n    subgraph \"Window Shutdown\"\n        TS1[TerminalService]\n        Layout1[Collect Layout]\n        Backend1[ITerminalBackend]\n    end\n    \n    subgraph \"Backend Storage\"\n        Store[setTerminalLayoutInfo]\n        LayoutData[ITerminalsLayoutInfo\u003cbr/\u003etabs + background terminals]\n        PID[Persistent Process IDs]\n    end\n    \n    subgraph \"Window Startup\"\n        TS2[TerminalService]\n        Retrieve[getTerminalLayoutInfo]\n        Backend2[ITerminalBackend]\n        Recreate[Recreate Terminal Groups]\n        Attach[attachToProcess per terminal]\n    end\n    \n    TS1 --\u003e Layout1\n    Layout1 --\u003e Backend1\n    Backend1 --\u003e Store\n    Store --\u003e LayoutData\n    LayoutData --\u003e PID\n    \n    Backend2 --\u003e Retrieve\n    Retrieve --\u003e LayoutData\n    TS2 --\u003e Recreate\n    Recreate --\u003e Attach\n    Attach --\u003e PID\n```\n\n**Layout Data Structures**\n\nThe layout information is defined in [src/vs/platform/terminal/common/terminal.ts:158-219]():\n\n```typescript\ninterface ITerminalsLayoutInfo {\n    tabs: IRawTerminalTabLayoutInfo\u003cIPtyHostAttachTarget | null\u003e[];\n    background: (IPtyHostAttachTarget | null)[] | null;\n}\n\ninterface IRawTerminalTabLayoutInfo\u003cT\u003e {\n    isActive: boolean;\n    activePersistentProcessId: number | undefined;\n    terminals: IRawTerminalInstanceLayoutInfo\u003cT\u003e[];\n}\n\ninterface IRawTerminalInstanceLayoutInfo\u003cT\u003e {\n    relativeSize: number;\n    terminal: T;  // IPtyHostAttachTarget with persistent data\n}\n\ninterface IPtyHostAttachTarget {\n    id: number;                              // Persistent process ID for reattachment\n    pid: number;                             // OS process ID\n    title: string;\n    cwd: string;\n    workspaceId: string;\n    isOrphan: boolean;                       // Process lost parent connection\n    hasChildProcesses: boolean;\n    icon: TerminalIcon | undefined;\n    fixedDimensions: IFixedTerminalDimensions | undefined;\n    reconnectionProperties?: IReconnectionProperties;  // Custom reconnection data\n    shellIntegrationNonce: string;\n    // ... more properties\n}\n```\n\n**Storage Implementation**\n\nLayout persistence is backed by workspace storage:\n\n```typescript\n// Save layout during shutdown (TerminalService._saveState())\nprivate _saveState(): void {\n    const tabs = this._terminalGroupService.groups.map(group =\u003e ({\n        isActive: group === this._terminalGroupService.activeGroup,\n        activePersistentProcessId: group.activeInstance?.persistentProcessId,\n        terminals: group.terminalInstances.map(instance =\u003e ({\n            relativeSize: instance.relativeSize,\n            terminal: instance.persistentProcessId\n        }))\n    }));\n    \n    const layoutInfo: ITerminalsLayoutInfoById = { tabs, background: [] };\n    this._primaryBackend?.setTerminalLayoutInfo(layoutInfo);\n}\n\n// Restore layout during startup (TerminalService._reconnectToRemoteTerminals())\nconst layoutInfo = await backend.getTerminalLayoutInfo();\nawait this._recreateTerminalGroups(layoutInfo);\n```\n\n**Sources**: [src/vs/platform/terminal/common/terminal.ts:158-219](), [src/vs/workbench/contrib/terminal/browser/terminalService.ts:451-523](), [src/vs/platform/terminal/node/ptyService.ts:400-500]()\n\n### Remote Reconnection Flow\n\nRemote reconnection restores terminal sessions after connection loss. The `PtyService` on the remote machine keeps processes alive while the local workbench reconnects.\n\n**Remote Reconnection Sequence**\n\n```mermaid\nsequenceDiagram\n    participant WB as Workbench\u003cbr/\u003e(Renderer)\n    participant RB as RemoteBackend\n    participant RA as RemoteAgent\n    participant PHS as PtyHostService\u003cbr/\u003e(Remote)\n    participant Proc as Persistent Processes\n    \n    Note over WB: Connection restored\n    \n    WB-\u003e\u003eRB: Initialize backend\n    RB-\u003e\u003eWB: onDidRegisterBackend\n    \n    WB-\u003e\u003eRB: getTerminalLayoutInfo()\n    RB-\u003e\u003ePHS: RPC: getTerminalLayoutInfo()\n    PHS-\u003e\u003ePHS: Read stored layout\n    PHS--\u003e\u003eRB: ITerminalsLayoutInfo\n    RB--\u003e\u003eWB: Layout data\n    \n    loop For each terminal in layout\n        WB-\u003e\u003eWB: createTerminal({ attachPersistentProcess })\n        WB-\u003e\u003eRB: attachToProcess(id)\n        RB-\u003e\u003ePHS: RPC: attachToProcess(id)\n        PHS-\u003e\u003eProc: Find process by ID\n        Proc--\u003e\u003ePHS: Process found\n        PHS-\u003e\u003eProc: Start replay\n        Proc--\u003e\u003ePHS: Buffered data (replay)\n        PHS--\u003e\u003eRB: onProcessReplay events\n        RB--\u003e\u003eWB: Replay data\n        WB-\u003e\u003eWB: Restore xterm buffer\n    end\n    \n    Note over WB: Terminals fully restored\n```\n\n**Reconnection Steps in Code**\n\nFrom [src/vs/workbench/contrib/terminal/browser/terminalService.ts:455-476]():\n\n```typescript\nprivate async _reconnectToRemoteTerminals(): Promise\u003cvoid\u003e {\n    const remoteAuthority = this._environmentService.remoteAuthority;\n    if (!remoteAuthority) {\n        return;\n    }\n    \n    // 1. Get backend for remote authority\n    const backend = await this._terminalInstanceService.getBackend(remoteAuthority);\n    if (!backend) {\n        return;\n    }\n    \n    // 2. Retrieve layout info from remote\n    const layoutInfo = await backend.getTerminalLayoutInfo();\n    \n    // 3. Reduce connection grace time (optimization)\n    backend.reduceConnectionGraceTime();\n    \n    // 4. Recreate terminal groups from layout\n    await this._recreateTerminalGroups(layoutInfo);\n    \n    // 5. Attach process listeners for future changes\n    this._attachProcessLayoutListeners();\n}\n```\n\n**Process Reattachment**\n\nFrom [src/vs/workbench/contrib/terminal/browser/terminalService.ts:526-558]():\n\n```typescript\nprivate async _recreateTerminalGroup(\n    tabLayout: IRawTerminalTabLayoutInfo,\n    terminalLayouts: IRawTerminalInstanceLayoutInfo[]\n): Promise\u003cITerminalGroup | undefined\u003e {\n    \n    for (const terminalLayout of terminalLayouts) {\n        const attachPersistentProcess = terminalLayout.terminal!;\n        \n        // Create terminal with attachPersistentProcess in shellLaunchConfig\n        const instance = await this.createTerminal({\n            config: { attachPersistentProcess },\n            location: lastInstance ? { parentTerminal: lastInstance } : TerminalLocation.Panel\n        });\n        \n        // TerminalProcessManager.createProcess() will call:\n        // backend.attachToProcess(attachPersistentProcess.id)\n        // which triggers replay of buffered data\n    }\n}\n```\n\n**Replay Mechanism**\n\nThe `PersistentTerminalProcess` in [src/vs/platform/terminal/node/ptyService.ts:700-850]() buffers data while disconnected:\n\n```typescript\nclass PersistentTerminalProcess {\n    private _bufferer: TerminalDataBufferer;\n    \n    async replay(): Promise\u003cIPtyHostProcessReplayEvent\u003e {\n        // Return buffered data from disconnected period\n        const events = this._bufferer.getEvents();\n        return {\n            events: events.map(e =\u003e ({ cols, rows, data: e.data }))\n        };\n    }\n}\n```\n\nThe replay data flows: `PtyService`  `RemotePty`  `TerminalProcessManager`  `TerminalInstance`  XTerm buffer restoration.\n\n**Sources**: [src/vs/workbench/contrib/terminal/browser/terminalService.ts:455-558](), [src/vs/platform/terminal/node/ptyService.ts:700-850](), [src/vs/workbench/contrib/terminal/browser/remotePty.ts:50-100]()\n\n## Backend Resolution Examples\n\n### Local Terminal Creation\n\n```typescript\n// User creates a terminal without specifying remote\nconst instance = await terminalService.createTerminal({\n    name: 'My Terminal'\n});\n// Results in: remoteAuthority = undefined  Local backend\n```\n\n### Remote Terminal Creation\n\n```typescript\n// In a remote workspace context\nconst remoteAuthority = environmentService.remoteAuthority; // e.g., 'ssh-remote+host'\nconst instance = await terminalService.createTerminal({\n    name: 'Remote Terminal'\n});\n// Results in: remoteAuthority = 'ssh-remote+host'  Remote backend\n```\n\n### Explicit Backend Selection\n\n```typescript\n// Get specific backend\nconst backend = await terminalInstanceService.getBackend('ssh-remote+myhost');\nif (backend) {\n    // Create terminal explicitly on this backend\n    const instance = terminalInstanceService.createInstance(\n        launchConfig,\n        TerminalLocation.Panel\n    );\n}\n```\n\n**Sources**: [src/vs/workbench/contrib/terminal/browser/terminalService.ts:240-278]()\n\n## Backend Performance Monitoring\n\nEach backend tracks performance metrics:\n\n```typescript\ninterface IPtyHostLatencyMeasurement {\n    label: string;\n    latency: number;  // milliseconds\n}\n\n// Backend provides performance marks\nasync getPerformanceMarks(): Promise\u003cperformance.PerformanceMark[]\u003e\n```\n\nThese metrics are used to diagnose issues with specific backends and measure:\n- Process creation latency\n- Data transmission delays\n- Connection establishment time\n\n**Sources**: [src/vs/platform/terminal/common/terminal.ts:752-756](), [src/vs/workbench/contrib/terminal/browser/terminalService.ts:329-335]()"])</script><script>self.__next_f.push([1,"36:T8be0,"])</script><script>self.__next_f.push([1,"# Shell Integration and Capabilities\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [src/vs/platform/terminal/common/terminal.ts](src/vs/platform/terminal/common/terminal.ts)\n- [src/vs/platform/terminal/common/terminalEnvironment.ts](src/vs/platform/terminal/common/terminalEnvironment.ts)\n- [src/vs/platform/terminal/common/terminalRecorder.ts](src/vs/platform/terminal/common/terminalRecorder.ts)\n- [src/vs/platform/terminal/node/ptyHostMain.ts](src/vs/platform/terminal/node/ptyHostMain.ts)\n- [src/vs/platform/terminal/node/ptyHostService.ts](src/vs/platform/terminal/node/ptyHostService.ts)\n- [src/vs/platform/terminal/node/ptyService.ts](src/vs/platform/terminal/node/ptyService.ts)\n- [src/vs/platform/terminal/node/terminalProcess.ts](src/vs/platform/terminal/node/terminalProcess.ts)\n- [src/vs/platform/terminal/test/common/terminalEnvironment.test.ts](src/vs/platform/terminal/test/common/terminalEnvironment.test.ts)\n- [src/vs/platform/terminal/test/common/terminalProfiles.test.ts](src/vs/platform/terminal/test/common/terminalProfiles.test.ts)\n- [src/vs/platform/terminal/test/common/terminalRecorder.test.ts](src/vs/platform/terminal/test/common/terminalRecorder.test.ts)\n- [src/vs/workbench/api/browser/mainThreadTerminalService.ts](src/vs/workbench/api/browser/mainThreadTerminalService.ts)\n- [src/vs/workbench/api/common/extHostTerminalService.ts](src/vs/workbench/api/common/extHostTerminalService.ts)\n- [src/vs/workbench/api/node/extHostTerminalService.ts](src/vs/workbench/api/node/extHostTerminalService.ts)\n- [src/vs/workbench/contrib/terminal/browser/media/terminal.css](src/vs/workbench/contrib/terminal/browser/media/terminal.css)\n- [src/vs/workbench/contrib/terminal/browser/media/xterm.css](src/vs/workbench/contrib/terminal/browser/media/xterm.css)\n- [src/vs/workbench/contrib/terminal/browser/remotePty.ts](src/vs/workbench/contrib/terminal/browser/remotePty.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminal.contribution.ts](src/vs/workbench/contrib/terminal/browser/terminal.contribution.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminal.ts](src/vs/workbench/contrib/terminal/browser/terminal.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalActions.ts](src/vs/workbench/contrib/terminal/browser/terminalActions.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalEditor.ts](src/vs/workbench/contrib/terminal/browser/terminalEditor.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalEditorInput.ts](src/vs/workbench/contrib/terminal/browser/terminalEditorInput.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalEditorService.ts](src/vs/workbench/contrib/terminal/browser/terminalEditorService.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalGroup.ts](src/vs/workbench/contrib/terminal/browser/terminalGroup.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalGroupService.ts](src/vs/workbench/contrib/terminal/browser/terminalGroupService.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts](src/vs/workbench/contrib/terminal/browser/terminalInstance.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalInstanceService.ts](src/vs/workbench/contrib/terminal/browser/terminalInstanceService.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalMenus.ts](src/vs/workbench/contrib/terminal/browser/terminalMenus.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalProcessExtHostProxy.ts](src/vs/workbench/contrib/terminal/browser/terminalProcessExtHostProxy.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts](src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalService.ts](src/vs/workbench/contrib/terminal/browser/terminalService.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalStatusList.ts](src/vs/workbench/contrib/terminal/browser/terminalStatusList.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalTabbedView.ts](src/vs/workbench/contrib/terminal/browser/terminalTabbedView.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalTabsList.ts](src/vs/workbench/contrib/terminal/browser/terminalTabsList.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalView.ts](src/vs/workbench/contrib/terminal/browser/terminalView.ts)\n- [src/vs/workbench/contrib/terminal/browser/xterm/xtermTerminal.ts](src/vs/workbench/contrib/terminal/browser/xterm/xtermTerminal.ts)\n- [src/vs/workbench/contrib/terminal/common/terminal.ts](src/vs/workbench/contrib/terminal/common/terminal.ts)\n- [src/vs/workbench/contrib/terminal/common/terminalColorRegistry.ts](src/vs/workbench/contrib/terminal/common/terminalColorRegistry.ts)\n- [src/vs/workbench/contrib/terminal/common/terminalConfiguration.ts](src/vs/workbench/contrib/terminal/common/terminalConfiguration.ts)\n- [src/vs/workbench/contrib/terminal/common/terminalEnvironment.ts](src/vs/workbench/contrib/terminal/common/terminalEnvironment.ts)\n- [src/vs/workbench/contrib/terminal/common/terminalStrings.ts](src/vs/workbench/contrib/terminal/common/terminalStrings.ts)\n- [src/vs/workbench/contrib/terminal/test/browser/terminalStatusList.test.ts](src/vs/workbench/contrib/terminal/test/browser/terminalStatusList.test.ts)\n- [src/vs/workbench/contrib/terminal/test/common/terminalEnvironment.test.ts](src/vs/workbench/contrib/terminal/test/common/terminalEnvironment.test.ts)\n- [src/vs/workbench/contrib/terminalContrib/voice/browser/terminal.voice.contribution.ts](src/vs/workbench/contrib/terminalContrib/voice/browser/terminal.voice.contribution.ts)\n- [src/vs/workbench/contrib/terminalContrib/voice/browser/terminalVoice.ts](src/vs/workbench/contrib/terminalContrib/voice/browser/terminalVoice.ts)\n- [src/vs/workbench/contrib/terminalContrib/voice/browser/terminalVoiceActions.ts](src/vs/workbench/contrib/terminalContrib/voice/browser/terminalVoiceActions.ts)\n\n\u003c/details\u003e\n\n\n\nShell integration is a system that enables VS Code to understand and interact with terminal shell sessions at a deeper level. When enabled, VS Code injects small scripts into supported shells (Bash, Zsh, PowerShell, Python) that emit special OSC (Operating System Command) sequences. These sequences allow VS Code to detect commands, track the current working directory, identify prompts, and provide enhanced terminal features like command decorations, quick fixes, and command navigation.\n\nFor information about the broader terminal architecture, see [Integrated Terminal](#8). For terminal process management, see [Terminal Instance and Process Management](#8.2). For the terminal extension API that exposes shell integration capabilities, see [Terminal Extension API](#8.8).\n\n## Architecture Overview\n\nShell integration consists of three main layers: injection, communication, and capability detection. The system injects shell-specific scripts that emit OSC 633 sequences, which are parsed by `ShellIntegrationAddon` to populate the `TerminalCapabilityStore` with capabilities like `CommandDetection`, `CwdDetection`, and `PromptTypeDetection`.\n\n**Shell Integration Data Flow Diagram**\n\n```mermaid\ngraph TB\n    subgraph \"Terminal Instance Layer\"\n        TI[\"TerminalInstance\"]\n        TPM[\"TerminalProcessManager\u003cbr/\u003e_setupShellIntegrationEnv()\"]\n        XTERM[\"XtermTerminal\"]\n    end\n    \n    subgraph \"Shell Integration Injection\"\n        INJECTION[\"getShellIntegrationInjection()\u003cbr/\u003eterminalEnvironment.ts\"]\n        SCRIPTS[\"shellIntegration-bash.sh\u003cbr/\u003eshellIntegration-rc.zsh\u003cbr/\u003eshellIntegration.ps1\"]\n        NONCE[\"shellIntegrationNonce\u003cbr/\u003egenerateUuid()\"]\n        ENV[\"VSCODE_SHELL_INTEGRATION\u003cbr/\u003eVSCODE_NONCE\"]\n    end\n    \n    subgraph \"Communication Layer\"\n        ADDON[\"ShellIntegrationAddon\u003cbr/\u003eOSC 633 parser\"]\n        HANDLERS[\"_handleA()\u003cbr/\u003e_handleB()\u003cbr/\u003e_handleC()\u003cbr/\u003e_handleD()\u003cbr/\u003e_handleE()\u003cbr/\u003e_handleP()\"]\n    end\n    \n    subgraph \"Capability System\"\n        STORE[\"TerminalCapabilityStore\u003cbr/\u003e_capabilities Map\"]\n        MULTIPLEXER[\"TerminalCapabilityStoreMultiplexer\"]\n        CMD_DET[\"CommandDetectionCapability\"]\n        CWD_DET[\"CwdDetectionCapability\"]\n        PROMPT_DET[\"PromptTypeDetectionCapability\"]\n    end\n    \n    subgraph \"Feature Consumers\"\n        DECORATIONS[\"DecorationAddon\"]\n        NAVIGATION[\"MarkNavigationAddon\"]\n        CONTEXTKEYS[\"TerminalContextKeys\"]\n    end\n    \n    TI --\u003e|\"createProcess()\"| TPM\n    TI --\u003e|\"_createXterm()\"| XTERM\n    TPM --\u003e|\"calls\"| INJECTION\n    INJECTION --\u003e|\"returns IShellIntegrationConfigInjection\"| SCRIPTS\n    INJECTION --\u003e|\"includes\"| NONCE\n    TPM --\u003e|\"sets\"| ENV\n    \n    XTERM --\u003e|\"raw.loadAddon()\"| ADDON\n    ADDON --\u003e|\"parses OSC 633\"| HANDLERS\n    \n    HANDLERS --\u003e|\"calls store.add()\"| STORE\n    STORE --\u003e|\"wrapped by\"| MULTIPLEXER\n    STORE --\u003e|\"registers\"| CMD_DET\n    STORE --\u003e|\"registers\"| CWD_DET\n    STORE --\u003e|\"registers\"| PROMPT_DET\n    \n    CMD_DET --\u003e|\"enables\"| DECORATIONS\n    CMD_DET --\u003e|\"enables\"| NAVIGATION\n    CMD_DET --\u003e|\"updates\"| CONTEXTKEYS\n```\n\n**Sources:** [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts:521-527](), [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts:74-85, 200-300](), [src/vs/platform/terminal/common/xterm/shellIntegrationAddon.ts](), [src/vs/platform/terminal/node/terminalEnvironment.ts]()\n\n## Shell Integration Injection\n\nVS Code injects shell integration scripts by modifying the shell launch configuration. The injection process determines the appropriate script for the shell type and prepends arguments to source the integration code.\n\n### Supported Shell Types\n\nShell integration is supported for specific shell types, defined in `shellIntegrationSupportedShellTypes`:\n\n| Shell Type | Enum Value | Integration Script |\n|------------|-----------|-------------------|\n| Bash | `PosixShellType.Bash` | `shellIntegration-bash.sh` |\n| Zsh | `PosixShellType.Zsh` | `shellIntegration-rc.zsh` |\n| PowerShell | `GeneralShellType.PowerShell` | `shellIntegration.ps1` |\n| Python | `GeneralShellType.Python` | Python-specific integration |\n\n**Sources:** [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts:122-127]()\n\n### Injection Process Flow\n\nThe injection process modifies the `IShellLaunchConfig` to prepend shell-specific arguments that source the integration scripts before the shell's normal initialization.\n\n**Shell Integration Injection Sequence**\n\n```mermaid\nsequenceDiagram\n    participant TI as TerminalInstance\n    participant TPM as TerminalProcessManager\n    participant SI as getShellIntegrationInjection\n    participant ENV as Environment Setup\n    participant PROCESS as TerminalProcess spawn()\n    \n    TI-\u003e\u003eTPM: createProcess(shellLaunchConfig, cols, rows)\n    TPM-\u003e\u003eTPM: _setupShellIntegrationEnv()\n    TPM-\u003e\u003eENV: Set VSCODE_SHELL_INTEGRATION=1\n    TPM-\u003e\u003eENV: Set VSCODE_NONCE=\u003cuuid\u003e\n    TPM-\u003e\u003eENV: Set VSCODE_SHELL_LOGIN=1 (if needed)\n    TPM-\u003e\u003eSI: getShellIntegrationInjection(shellLaunchConfig)\n    SI-\u003e\u003eSI: Check shellType in supportedShells\n    SI-\u003e\u003eSI: Generate injectedArgs array\n    alt Bash\n        SI-\u003e\u003eSI: Return [\"--init-file\", scriptPath]\n    else Zsh\n        SI-\u003e\u003eSI: Return [\"--login\", \"-c\", \"source script \u0026\u0026 exec\"]\n    else PowerShell\n        SI-\u003e\u003eSI: Return [\"-NoExit\", \"-Command\", \". script\"]\n    end\n    SI--\u003e\u003eTPM: Return IShellIntegrationConfigInjection\n    TPM-\u003e\u003eTPM: Prepend injectedArgs to args\n    TPM-\u003e\u003eTPM: Store usedShellIntegrationInjection=true\n    TPM-\u003e\u003ePROCESS: spawn(executable, modifiedArgs, env)\n    PROCESS-\u003e\u003ePROCESS: Shell sources integration script\n    PROCESS-\u003e\u003ePROCESS: Script emits OSC 633 sequences\n```\n\n**Sources:** [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts:200-350](), [src/vs/platform/terminal/node/terminalEnvironment.ts:200-450](), [src/vs/platform/terminal/node/terminalProcess.ts:250-350]()\n\n### Shell Integration Nonce\n\nEach terminal instance generates a unique `shellIntegrationNonce` for security. This nonce is included in the shell integration scripts via the `VSCODE_NONCE` environment variable and validated when processing OSC sequences to ensure data originates from the trusted shell integration.\n\n**Nonce Flow**\n\n```mermaid\ngraph LR\n    GENERATE[\"generateUuid()\"] --\u003e STORE[\"shellIntegrationNonce\u003cbr/\u003eTerminalProcessManager\"]\n    STORE --\u003e ENV[\"VSCODE_NONCE env var\"]\n    ENV --\u003e SCRIPT[\"Shell integration script\u003cbr/\u003eincludes in OSC sequences\"]\n    SCRIPT --\u003e OSC[\"OSC 633 sequences\u003cbr/\u003ewith nonce\"]\n    OSC --\u003e ADDON[\"ShellIntegrationAddon\"]\n    ADDON --\u003e VERIFY[\"Verify nonce matches\"]\n    VERIFY --\u003e|Match| ACCEPT[\"Process sequence\"]\n    VERIFY --\u003e|Mismatch| REJECT[\"Ignore sequence\"]\n```\n\nThe nonce is generated once per terminal and stored in `TerminalProcessManager.shellIntegrationNonce`. It is passed to the shell via environment variables and must be included in all OSC 633 sequences for them to be processed.\n\n**Sources:** [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts:84, 165](), [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts:303](), [src/vs/platform/terminal/common/xterm/shellIntegrationAddon.ts]()\n\n### Injection Failure Handling\n\nVS Code tracks shell integration injection status through process properties. The `_usedShellIntegrationInjection` flag indicates whether injection was attempted, and `_shellIntegrationInjectionInfo` stores failure reasons.\n\n**Injection Status Tracking**\n\n```mermaid\ngraph TB\n    INJECT[\"getShellIntegrationInjection()\"] --\u003e CHECK{Shell in supportedShells?}\n    CHECK --\u003e|No| FAIL1[\"No injection\u003cbr/\u003eusedShellIntegrationInjection=false\"]\n    CHECK --\u003e|Yes| ARGS[\"Modify shellLaunchConfig.args\"]\n    ARGS --\u003e SPAWN[\"spawn() terminal process\"]\n    SPAWN --\u003e TIMEOUT{Script timeout?}\n    TIMEOUT --\u003e|Yes| FAIL2[\"ProcessPropertyType.FailedShellIntegrationActivation=true\"]\n    TIMEOUT --\u003e|No| SUCCESS[\"Capabilities registered\u003cbr/\u003eusedShellIntegrationInjection=true\"]\n    \n    FAIL1 --\u003e PROP[\"IProcessProperty event\u003cbr/\u003eShellIntegrationInjectionFailureReason\"]\n    FAIL2 --\u003e PROP\n    SUCCESS --\u003e CAPS[\"TerminalCapabilityStore populated\"]\n```\n\nThe timeout for shell integration is configurable via `terminal.integrated.shellIntegration.timeout` and uses `getShellIntegrationTimeout()` to get platform-specific defaults.\n\n**Sources:** [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts:196-200](), [src/vs/platform/terminal/common/terminal.ts:257-259, 276-279](), [src/vs/workbench/contrib/terminal/common/terminalEnvironment.ts:400-450]()\n\n## Capability System\n\nThe capability system dynamically detects and registers terminal capabilities as shell integration becomes active. Capabilities represent features that the terminal supports based on shell integration.\n\n### Capability Store Architecture\n\n```mermaid\ngraph TB\n    subgraph \"Capability Storage\"\n        STORE[\"TerminalCapabilityStore\"]\n        ITEMS[\"Map\u003cTerminalCapability, ITerminalCapabilityImpl\u003e\"]\n    end\n    \n    subgraph \"Multiplexer\"\n        MULTI[\"TerminalCapabilityStoreMultiplexer\"]\n        ACTIVE[\"activeStore: TerminalCapabilityStore\"]\n    end\n    \n    subgraph \"Capability Types\"\n        CMD[\"TerminalCapability.CommandDetection\"]\n        CWD[\"TerminalCapability.CwdDetection\"]\n        PROMPT[\"TerminalCapability.PromptTypeDetection\"]\n        BUFFER[\"TerminalCapability.BufferMarkDetection\"]\n        NAIVE[\"TerminalCapability.NaiveCwdDetection\"]\n    end\n    \n    subgraph \"Events\"\n        ADD[\"onDidAddCapability\"]\n        REMOVE[\"onDidRemoveCapability\"]\n        CHANGE[\"onDidChangeCapability\"]\n    end\n    \n    STORE --\u003e|contains| ITEMS\n    MULTI --\u003e|manages| STORE\n    STORE --\u003e|stores| CMD\n    STORE --\u003e|stores| CWD\n    STORE --\u003e|stores| PROMPT\n    STORE --\u003e|stores| BUFFER\n    STORE --\u003e|stores| NAIVE\n    \n    STORE --\u003e|fires| ADD\n    STORE --\u003e|fires| REMOVE\n    STORE --\u003e|fires| CHANGE\n```\n\n**Sources:** [src/vs/platform/terminal/common/capabilities/terminalCapabilityStore.ts](), [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts:205]()\n\n### Capability Registration and Lifecycle\n\nCapabilities are registered dynamically as the terminal process emits shell integration sequences. `TerminalInstance` sets up listeners for capability additions in its constructor using a `DisposableMap` to track per-capability subscriptions.\n\n**Capability Registration and Event Handling**\n\n```mermaid\nsequenceDiagram\n    participant SHELL as Shell Integration Script\n    participant SI as ShellIntegrationAddon\n    participant STORE as TerminalCapabilityStore\n    participant TI as TerminalInstance\n    participant CAP as Capability Instance\n    participant UI as UI Updates\n    \n    SHELL-\u003e\u003eSI: Emit OSC 633;A (first prompt)\n    SI-\u003e\u003eSI: Detect shell integration active\n    SI-\u003e\u003eSTORE: add(TerminalCapability.CommandDetection)\n    STORE-\u003e\u003eSTORE: _capabilities.set(id, capability)\n    STORE-\u003e\u003eTI: onDidAddCapability.fire({id, capability})\n    TI-\u003e\u003eTI: capabilityListeners.set(id, disposable)\n    \n    alt CommandDetection\n        TI-\u003e\u003eCAP: capability.promptInputModel.onDidStartInput\n        TI-\u003e\u003eCAP: capability.promptInputModel.onDidChangeInput\n        TI-\u003e\u003eCAP: capability.promptInputModel.onDidFinishInput\n        TI-\u003e\u003eTI: refreshLabel() on input changes\n    else CwdDetection\n        TI-\u003e\u003eCAP: capability.onDidChangeCwd\n        TI-\u003e\u003eTI: _setTitle() with new cwd\n        CAP-\u003e\u003eUI: Update terminal title\n    else PromptTypeDetection\n        TI-\u003e\u003eCAP: capability.onPromptTypeChanged\n        TI-\u003e\u003eTI: refreshLabel()\n    end\n```\n\n**Sources:** [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts:460-503](), [src/vs/platform/terminal/common/capabilities/terminalCapabilityStore.ts:80-150]()\n\n### Capability Types and Their Functions\n\n| Capability | Enum Value | Purpose | Provided By |\n|-----------|-----------|---------|-------------|\n| Command Detection | `TerminalCapability.CommandDetection` | Detects when commands are executed, tracks command boundaries | ShellIntegrationAddon |\n| CWD Detection | `TerminalCapability.CwdDetection` | Tracks current working directory changes | ShellIntegrationAddon |\n| Naive CWD Detection | `TerminalCapability.NaiveCwdDetection` | Fallback CWD detection without shell integration | NaiveCwdDetectionCapability |\n| Prompt Type Detection | `TerminalCapability.PromptTypeDetection` | Identifies different prompt states (input, continuation, right prompt) | ShellIntegrationAddon |\n| Buffer Mark Detection | `TerminalCapability.BufferMarkDetection` | Marks buffer positions for navigation | ShellIntegrationAddon |\n| Partial Command Detection | `TerminalCapability.PartialCommandDetection` | Tracks partial/incomplete commands | ShellIntegrationAddon |\n\n**Sources:** [src/vs/platform/terminal/common/capabilities/capabilities.ts](), [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts:469-500]()\n\n### Capability-Dependent Features\n\nFeatures that depend on capabilities are enabled progressively:\n\n```mermaid\ngraph LR\n    subgraph Capabilities\n        CMD_CAP[\"CommandDetection\"]\n        CWD_CAP[\"CwdDetection\"]\n        PROMPT_CAP[\"PromptTypeDetection\"]\n    end\n    \n    subgraph Features\n        DECO[\"Command Decorations\"]\n        NAV[\"Command Navigation\"]\n        TITLE[\"CWD in Title\"]\n        INPUT[\"Prompt Input Model\"]\n        QUICKFIX[\"Quick Fixes\"]\n    end\n    \n    CMD_CAP --\u003e DECO\n    CMD_CAP --\u003e NAV\n    CMD_CAP --\u003e QUICKFIX\n    CWD_CAP --\u003e TITLE\n    PROMPT_CAP --\u003e INPUT\n    CMD_CAP --\u003e INPUT\n```\n\n**Sources:** [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts:462-500]()\n\n## OSC Sequences and Communication Protocol\n\nShell integration uses OSC (Operating System Command) sequences, specifically the 633 series, to communicate between the shell and VS Code.\n\n### OSC 633 Sequence Format\n\nOSC sequences follow the pattern: `ESC ] 633 ; \u003ctype\u003e ; \u003cdata\u003e ST`\n\nWhere:\n- `ESC ]` is the OSC start sequence (`\\x1b]` or `\\033]`)\n- `633` is the VS Code shell integration identifier\n- `\u003ctype\u003e` identifies the sequence type (A, B, C, D, E, P, etc.)\n- `\u003cdata\u003e` contains sequence-specific information (optional)\n- `ST` is the string terminator (`\\x07` or `\\x1b\\\\`)\n\n### Common OSC 633 Sequences\n\n| Sequence | Handler Method | Purpose | Data Format | Example |\n|----------|---------------|---------|-------------|---------|\n| `633;A` | `_handleA()` | Mark prompt start | None | `\\x1b]633;A\\x07` |\n| `633;B` | `_handleB()` | Mark prompt end | None | `\\x1b]633;B\\x07` |\n| `633;C` | `_handleC()` | Mark command start | None | `\\x1b]633;C\\x07` |\n| `633;D;exitCode` | `_handleD()` | Mark command end | Exit code (number) | `\\x1b]633;D;0\\x07` |\n| `633;E;commandLine[;nonce]` | `_handleE()` | Set command line | Command text with optional nonce | `\\x1b]633;E;ls -la;abc123\\x07` |\n| `633;P;property=value` | `_handleP()` | Set property | Key=value pairs | `\\x1b]633;P;Cwd=/home/user\\x07` |\n\nAdditional sequences include `633;L`, `633;M`, `633;N` for right prompts, continuations, and command line markers.\n\n**Sources:** [src/vs/platform/terminal/common/xterm/shellIntegrationAddon.ts:200-800]()\n\n### Sequence Processing Pipeline\n\nThe `ShellIntegrationAddon` registers itself as an xterm.js addon and attaches to the terminal's OSC parser. When OSC 633 sequences are received, they are dispatched to handler methods that update the capability store.\n\n**OSC 633 Processing Flow**\n\n```mermaid\ngraph TB\n    subgraph \"XTerm Layer\"\n        XTERM[\"Terminal.raw\u003cbr/\u003e(xterm instance)\"]\n        PARSER[\"registerOscHandler(633)\"]\n    end\n    \n    subgraph \"ShellIntegrationAddon\"\n        ADDON[\"ShellIntegrationAddon.activate()\"]\n        DISPATCH[\"_doHandleVSCodeSequence()\"]\n    end\n    \n    subgraph \"Sequence Handlers\"\n        A_HANDLER[\"_handleA()\u003cbr/\u003ehandlePromptStart\"]\n        B_HANDLER[\"_handleB()\u003cbr/\u003ehandlePromptEnd\"]\n        C_HANDLER[\"_handleC()\u003cbr/\u003ehandleCommandStart\"]\n        D_HANDLER[\"_handleD()\u003cbr/\u003ehandleCommandExecuted\"]\n        E_HANDLER[\"_handleE()\u003cbr/\u003esetCommandLine\"]\n        P_HANDLER[\"_handleP()\u003cbr/\u003ehandleProperty\"]\n    end\n    \n    subgraph \"Capability Instances\"\n        CMD_DET[\"CommandDetectionCapability\u003cbr/\u003e_commands array\u003cbr/\u003epromptInputModel\"]\n        CWD_DET[\"CwdDetectionCapability\u003cbr/\u003e_cwd string\"]\n        PROMPT_DET[\"PromptTypeDetectionCapability\u003cbr/\u003e_promptType\"]\n    end\n    \n    XTERM --\u003e|\"loadAddon(addon)\"| ADDON\n    ADDON --\u003e|\"registerOscHandler(633, handler)\"| PARSER\n    PARSER --\u003e|\"OSC 633;X received\"| DISPATCH\n    \n    DISPATCH --\u003e|\"type=A\"| A_HANDLER\n    DISPATCH --\u003e|\"type=B\"| B_HANDLER\n    DISPATCH --\u003e|\"type=C\"| C_HANDLER\n    DISPATCH --\u003e|\"type=D\"| D_HANDLER\n    DISPATCH --\u003e|\"type=E\"| E_HANDLER\n    DISPATCH --\u003e|\"type=P\"| P_HANDLER\n    \n    A_HANDLER --\u003e|\"handlePromptStart()\"| CMD_DET\n    B_HANDLER --\u003e|\"handlePromptEnd()\"| CMD_DET\n    C_HANDLER --\u003e|\"handleCommandStart()\"| CMD_DET\n    D_HANDLER --\u003e|\"handleCommandExecuted(exitCode)\"| CMD_DET\n    E_HANDLER --\u003e|\"setCommandLine(commandLine)\"| CMD_DET\n    P_HANDLER --\u003e|\"Cwd property\"| CWD_DET\n    P_HANDLER --\u003e|\"PromptType property\"| PROMPT_DET\n```\n\n**Sources:** [src/vs/platform/terminal/common/xterm/shellIntegrationAddon.ts:100-800](), [src/vs/workbench/contrib/terminal/browser/xterm/xtermTerminal.ts:300-400]()\n\n### Nonce Verification\n\nShell integration sequences include the shell integration nonce for security:\n\n```mermaid\nsequenceDiagram\n    participant SHELL as Shell Script\n    participant XTERM as xterm.raw\n    participant ADDON as ShellIntegrationAddon\n    participant VERIFY as Nonce Verification\n    participant CAP as Capabilities\n    \n    SHELL-\u003e\u003eXTERM: OSC 633;...\\x07 (includes nonce)\n    XTERM-\u003e\u003eADDON: Parse OSC sequence\n    ADDON-\u003e\u003eVERIFY: Check nonce in sequence\n    alt Nonce Valid\n        VERIFY-\u003e\u003eCAP: Process sequence\n        CAP-\u003e\u003eCAP: Update capabilities\n    else Nonce Invalid\n        VERIFY-\u003e\u003eVERIFY: Ignore sequence\n    end\n```\n\n**Sources:** [src/vs/platform/terminal/common/xterm/shellIntegrationAddon.ts](), [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts:84]()\n\n## Command Detection Capability\n\nThe `CommandDetectionCapability` tracks the full lifecycle of shell commands by processing OSC 633 sequences. It maintains a `_commands` array of `ITerminalCommand` objects and provides a `promptInputModel` for tracking user input.\n\n### Command Model and Data Structures\n\n**Command Detection Class Structure**\n\n```mermaid\nclassDiagram\n    class ITerminalCommand {\n        +marker: IXtermMarker\n        +endMarker: IXtermMarker\n        +executedMarker: IXtermMarker\n        +command: string\n        +isTrusted: boolean\n        +cwd: string\n        +exitCode: number\n        +commandStartLineContent: string\n        +timestamp: number\n        +id: string\n        +getOutput(): string\n        +getOutputMatch(outputMatcher): ITerminalOutputMatch\n        +hasOutput(): boolean\n    }\n    \n    class CommandDetectionCapability {\n        -_commands: ITerminalCommand[]\n        -_cwd: string\n        -_currentCommand: ITerminalCommand\n        -_isWindowsPty: boolean\n        +promptInputModel: IPromptInputModel\n        +executingCommand: string\n        +onCommandStarted: Event\n        +onCommandFinished: Event\n        +onCommandExecuted: Event\n        +handlePromptStart(marker): void\n        +handlePromptEnd(): void\n        +handleCommandStart(): void\n        +handleCommandExecuted(exitCode): void\n        +handleCommandLine(commandLine, isTrusted): void\n        +setCwd(cwd): void\n        +setIsWindowsPty(isWindows): void\n    }\n    \n    class PromptInputModel {\n        -_state: PromptInputState\n        -_value: string\n        -_prefix: string\n        -_suffix: string\n        -_cursorIndex: number\n        -_shellType: TerminalShellType\n        +onDidStartInput: Event\n        +onDidChangeInput: Event\n        +onDidFinishInput: Event\n        +getCombinedString(): string\n        +setShellType(shellType): void\n    }\n    \n    CommandDetectionCapability \"1\" --\u003e \"*\" ITerminalCommand\n    CommandDetectionCapability \"1\" --\u003e \"1\" PromptInputModel\n```\n\nThe `_commands` array stores all executed commands with their markers, exit codes, and output. Each command tracks its position in the xterm.js buffer via `IXtermMarker` objects.\n\n**Sources:** [src/vs/platform/terminal/common/capabilities/capabilities.ts:300-450](), [src/vs/platform/terminal/common/capabilities/commandDetectionCapability.ts:50-800](), [src/vs/platform/terminal/common/capabilities/commandDetection/promptInputModel.ts:30-250]()\n\n### Command Lifecycle with OSC Sequences\n\n```mermaid\nsequenceDiagram\n    participant USER as User\n    participant SHELL as Shell\n    participant OSC as OSC Sequences\n    participant CMD as CommandDetectionCapability\n    participant UI as Terminal UI\n    \n    USER-\u003e\u003eSHELL: Press Enter to start input\n    SHELL-\u003e\u003eOSC: 633;A (Prompt Start)\n    OSC-\u003e\u003eCMD: handlePromptStart()\n    CMD-\u003e\u003eCMD: Create marker at buffer position\n    \n    SHELL-\u003e\u003eOSC: 633;B (Prompt End)\n    OSC-\u003e\u003eCMD: handlePromptEnd()\n    \n    USER-\u003e\u003eSHELL: Type command \"ls -la\"\n    SHELL-\u003e\u003eOSC: 633;E;ls -la (Command Line)\n    OSC-\u003e\u003eCMD: setCommandLine(\"ls -la\")\n    \n    USER-\u003e\u003eSHELL: Press Enter to execute\n    SHELL-\u003e\u003eOSC: 633;C (Command Start)\n    OSC-\u003e\u003eCMD: handleCommandStart()\n    CMD-\u003e\u003eCMD: Mark command execution start\n    CMD-\u003e\u003eUI: onCommandStarted.fire()\n    \n    Note over SHELL: Command executes...\n    \n    SHELL-\u003e\u003eOSC: 633;D;0 (Command Finished, exitCode=0)\n    OSC-\u003e\u003eCMD: handleCommandExecuted(exitCode=0)\n    CMD-\u003e\u003eCMD: Mark command end\n    CMD-\u003e\u003eCMD: Store command in history\n    CMD-\u003e\u003eUI: onCommandFinished.fire()\n    CMD-\u003e\u003eUI: onCommandExecuted.fire()\n```\n\n**Sources:** [src/vs/platform/terminal/common/xterm/shellIntegrationAddon.ts](), [src/vs/platform/terminal/common/capabilities/commandDetectionCapability.ts]()\n\n### Command Storage and Navigation\n\nCommands are stored in a linear array that can be navigated:\n\n```typescript\nclass CommandDetectionCapability {\n    private _commands: ITerminalCommand[] = [];\n    \n    // Access commands by index\n    get commands(): readonly ITerminalCommand[];\n    \n    // Navigate to specific command markers\n    scrollToPreviousCommand(marker?: IXtermMarker): void;\n    scrollToNextCommand(marker?: IXtermMarker): void;\n    \n    // Get command at specific marker\n    getCommandForMarker(marker: IXtermMarker): ITerminalCommand | undefined;\n}\n```\n\n**Sources:** [src/vs/platform/terminal/common/capabilities/commandDetectionCapability.ts]()\n\n## CWD Detection Capability\n\nThe `CwdDetectionCapability` tracks the current working directory using OSC 633;P sequences. When shell integration is unavailable, `NaiveCwdDetectionCapability` provides fallback detection.\n\n### CWD Update Flow with Shell Integration\n\n**CWD Detection via OSC Sequences**\n\n```mermaid\nsequenceDiagram\n    participant USER as User\n    participant SHELL as Shell (cd command)\n    participant SCRIPT as Shell Integration Script\n    participant OSC as OSC 633;P;Cwd\n    participant ADDON as ShellIntegrationAddon\n    participant CAP as CwdDetectionCapability\n    participant TI as TerminalInstance\n    participant UI as Terminal UI\n    \n    USER-\u003e\u003eSHELL: cd /home/user/project\n    SHELL-\u003e\u003eSCRIPT: After cd execution\n    SCRIPT-\u003e\u003eSCRIPT: Get current directory (pwd)\n    SCRIPT-\u003e\u003eOSC: Emit OSC 633;P;Cwd=/home/user/project\n    OSC-\u003e\u003eADDON: _handleP(data)\n    ADDON-\u003e\u003eADDON: Parse \"Cwd=/home/user/project\"\n    ADDON-\u003e\u003eCAP: updateCwd(\"/home/user/project\")\n    CAP-\u003e\u003eCAP: _cwd = \"/home/user/project\"\n    CAP-\u003e\u003eTI: onDidChangeCwd.fire(\"/home/user/project\")\n    TI-\u003e\u003eTI: _setTitle() with new cwd\n    TI-\u003e\u003eUI: Update terminal title/label\n```\n\n**Sources:** [src/vs/platform/terminal/common/capabilities/cwdDetectionCapability.ts:30-100](), [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts:469-473](), [src/vs/platform/terminal/common/xterm/shellIntegrationAddon.ts:600-700]()\n\n### Fallback: Naive CWD Detection\n\nWhen shell integration is not available or has failed, `NaiveCwdDetectionCapability` is registered as a fallback. It attempts to parse CWD from terminal output by looking for common directory patterns.\n\n**Naive CWD Detection**\n\n```mermaid\ngraph TB\n    CHECK{\"Shell Integration\u003cbr/\u003eAvailable?\"}\n    CHECK --\u003e|No| NAIVE[\"NaiveCwdDetectionCapability\u003cbr/\u003eregistered in TerminalProcessManager\"]\n    CHECK --\u003e|Yes| FULL[\"CwdDetectionCapability\u003cbr/\u003evia ShellIntegrationAddon\"]\n    \n    NAIVE --\u003e|\"Monitor terminal output\"| PARSE[\"_parseCwd(line)\"]\n    PARSE --\u003e|\"Match directory patterns\"| UPDATE[\"updateCwd()\"]\n    UPDATE --\u003e|\"Fire event\"| EVENT[\"onDidChangeCwd\"]\n    \n    FULL --\u003e|\"OSC 633;P;Cwd\"| UPDATE\n```\n\nThe `NaiveCwdDetectionCapability` is instantiated in `TerminalProcessManager` constructor and scans each line of terminal output for patterns that might indicate a directory change.\n\n**Sources:** [src/vs/platform/terminal/common/capabilities/naiveCwdDetectionCapability.ts:30-150](), [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts:163-180, 400-450]()\n\n## Configuration and Context Keys\n\nShell integration status is exposed through context keys defined in `TerminalContextKeys` and configuration settings in `TerminalSettingId`.\n\n### Context Keys\n\nContext keys are bound in `TerminalInstance` constructor and updated based on capability events.\n\n**Shell Integration Context Key Updates**\n\n```mermaid\ngraph TB\n    subgraph \"Context Key Bindings\"\n        ENABLED[\"TerminalContextKeys.terminalShellIntegrationEnabled\u003cbr/\u003e_terminalShellIntegrationEnabledContextKey\"]\n        ALT_BUFFER[\"TerminalContextKeys.altBufferActive\u003cbr/\u003e_terminalAltBufferActiveContextKey\"]\n        TEXT[\"TerminalContextKeys.textSelected\u003cbr/\u003e_terminalHasTextContextKey\"]\n    end\n    \n    subgraph \"Update Sources\"\n        CAP_ADD[\"capabilities.onDidAddCapability\"]\n        CAP_REMOVE[\"capabilities.onDidRemoveCapability\"]\n        XTERM_EVENT[\"xterm.raw events\"]\n        SI_STATUS[\"shellIntegrationStatus\"]\n    end\n    \n    subgraph \"Consumers\"\n        MENU[\"MenuId.TerminalInlineTabContext\"]\n        CMD[\"TerminalCommandId enablement\"]\n        DECO[\"DecorationAddon rendering\"]\n        QUICKFIX[\"Quick fix visibility\"]\n    end\n    \n    CAP_ADD --\u003e|\"TerminalCapability.CommandDetection\"| ENABLED\n    CAP_REMOVE --\u003e|\"Clear capability\"| ENABLED\n    XTERM_EVENT --\u003e|\"selection change\"| TEXT\n    XTERM_EVENT --\u003e|\"buffer change\"| ALT_BUFFER\n    \n    ENABLED --\u003e MENU\n    ENABLED --\u003e CMD\n    ENABLED --\u003e DECO\n    ENABLED --\u003e QUICKFIX\n```\n\n**Sources:** [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts:450-456](), [src/vs/workbench/contrib/terminal/common/terminalContextKey.ts:30-80]()\n\n### Configuration Settings\n\n| Setting | ID | Purpose | Default |\n|---------|-----|---------|---------|\n| Shell Integration Enabled | `terminal.integrated.shellIntegration.enabled` | Enable/disable shell integration | `true` |\n| Decorations Enabled | `terminal.integrated.shellIntegration.decorationsEnabled` | Show command decorations | `'both'` |\n| Show Welcome | `terminal.integrated.shellIntegration.showWelcome` | Show shell integration welcome message | `true` |\n| Timeout | `terminal.integrated.shellIntegration.timeout` | Time to wait for shell integration | Platform-specific |\n| Quick Fix Enabled | `terminal.integrated.shellIntegration.quickFixEnabled` | Enable quick fixes based on command output | `true` |\n| Environment Reporting | `terminal.integrated.shellIntegration.environmentReporting` | Report environment changes via shell integration | `'on'` |\n\n**Sources:** [src/vs/platform/terminal/common/terminal.ts:110-115](), [src/vs/workbench/contrib/terminal/common/terminalConfiguration.ts]()\n\n### Shell Integration Status Enum\n\n```typescript\nenum ShellIntegrationStatus {\n    /** No shell integration sequences have been encountered. */\n    Off = 0,\n    \n    /** The final PS2 before we expect commands to be run is encountered. */\n    VSCode = 1,\n    \n    /** Final PS1 encountered. */\n    FinalTerm = 2\n}\n```\n\n**Sources:** [src/vs/platform/terminal/common/terminal.ts]()\n\n## Integration with Terminal Features\n\nShell integration capabilities enable numerous terminal features:\n\n### Feature Dependencies\n\n```mermaid\ngraph TB\n    subgraph \"Shell Integration Capabilities\"\n        SI[\"Shell Integration Active\"]\n        CMD_CAP[\"CommandDetection\"]\n        CWD_CAP[\"CwdDetection\"]\n        PROMPT_CAP[\"PromptTypeDetection\"]\n    end\n    \n    subgraph \"Decorations\"\n        GUTTER[\"Gutter Decorations\"]\n        OVERVIEW[\"Overview Ruler\"]\n    end\n    \n    subgraph \"Navigation\"\n        NAV_PREV[\"Navigate to Previous Command\"]\n        NAV_NEXT[\"Navigate to Next Command\"]\n        SELECT[\"Select Command Output\"]\n    end\n    \n    subgraph \"Context\"\n        CWD_TITLE[\"CWD in Title\"]\n        CONTEXT_KEYS[\"Context Key Updates\"]\n        TOOLTIP[\"Command Tooltips\"]\n    end\n    \n    subgraph \"Advanced Features\"\n        QUICKFIX[\"Quick Fixes\"]\n        COMPLETION[\"Terminal Suggestions\"]\n        RERUN[\"Re-run Commands\"]\n    end\n    \n    SI --\u003e CMD_CAP\n    SI --\u003e CWD_CAP\n    SI --\u003e PROMPT_CAP\n    \n    CMD_CAP --\u003e GUTTER\n    CMD_CAP --\u003e OVERVIEW\n    CMD_CAP --\u003e NAV_PREV\n    CMD_CAP --\u003e NAV_NEXT\n    CMD_CAP --\u003e SELECT\n    CMD_CAP --\u003e QUICKFIX\n    CMD_CAP --\u003e COMPLETION\n    CMD_CAP --\u003e RERUN\n    CMD_CAP --\u003e TOOLTIP\n    \n    CWD_CAP --\u003e CWD_TITLE\n    CWD_CAP --\u003e CONTEXT_KEYS\n    \n    PROMPT_CAP --\u003e COMPLETION\n```\n\n**Sources:** [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts:462-504](), [src/vs/workbench/contrib/terminal/browser/xterm/decorationAddon.ts]()\n\n### Shell Integration Information Status\n\nA status indicator shows shell integration state in the terminal status bar:\n\n```typescript\n// Terminal instance refreshes shell integration info status\nprivate _refreshShellIntegrationInfoStatus(instance: ITerminalInstance): void {\n    // Check if shell integration is enabled but not working\n    // Show status with failure reason if available\n    // Update status list with appropriate icon and message\n}\n```\n\n**Sources:** [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts:466-468]()"])</script><script>self.__next_f.push([1,"37:T6547,"])</script><script>self.__next_f.push([1,"# Terminal UI and Layout\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [src/vs/platform/terminal/common/terminal.ts](src/vs/platform/terminal/common/terminal.ts)\n- [src/vs/platform/terminal/common/terminalEnvironment.ts](src/vs/platform/terminal/common/terminalEnvironment.ts)\n- [src/vs/platform/terminal/common/terminalRecorder.ts](src/vs/platform/terminal/common/terminalRecorder.ts)\n- [src/vs/platform/terminal/node/ptyHostMain.ts](src/vs/platform/terminal/node/ptyHostMain.ts)\n- [src/vs/platform/terminal/node/ptyHostService.ts](src/vs/platform/terminal/node/ptyHostService.ts)\n- [src/vs/platform/terminal/node/ptyService.ts](src/vs/platform/terminal/node/ptyService.ts)\n- [src/vs/platform/terminal/node/terminalProcess.ts](src/vs/platform/terminal/node/terminalProcess.ts)\n- [src/vs/platform/terminal/test/common/terminalEnvironment.test.ts](src/vs/platform/terminal/test/common/terminalEnvironment.test.ts)\n- [src/vs/platform/terminal/test/common/terminalProfiles.test.ts](src/vs/platform/terminal/test/common/terminalProfiles.test.ts)\n- [src/vs/platform/terminal/test/common/terminalRecorder.test.ts](src/vs/platform/terminal/test/common/terminalRecorder.test.ts)\n- [src/vs/workbench/api/browser/mainThreadTerminalService.ts](src/vs/workbench/api/browser/mainThreadTerminalService.ts)\n- [src/vs/workbench/api/common/extHostTerminalService.ts](src/vs/workbench/api/common/extHostTerminalService.ts)\n- [src/vs/workbench/api/node/extHostTerminalService.ts](src/vs/workbench/api/node/extHostTerminalService.ts)\n- [src/vs/workbench/contrib/terminal/browser/media/terminal.css](src/vs/workbench/contrib/terminal/browser/media/terminal.css)\n- [src/vs/workbench/contrib/terminal/browser/media/xterm.css](src/vs/workbench/contrib/terminal/browser/media/xterm.css)\n- [src/vs/workbench/contrib/terminal/browser/remotePty.ts](src/vs/workbench/contrib/terminal/browser/remotePty.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminal.contribution.ts](src/vs/workbench/contrib/terminal/browser/terminal.contribution.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminal.ts](src/vs/workbench/contrib/terminal/browser/terminal.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalActions.ts](src/vs/workbench/contrib/terminal/browser/terminalActions.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalEditor.ts](src/vs/workbench/contrib/terminal/browser/terminalEditor.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalEditorInput.ts](src/vs/workbench/contrib/terminal/browser/terminalEditorInput.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalEditorService.ts](src/vs/workbench/contrib/terminal/browser/terminalEditorService.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalGroup.ts](src/vs/workbench/contrib/terminal/browser/terminalGroup.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalGroupService.ts](src/vs/workbench/contrib/terminal/browser/terminalGroupService.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts](src/vs/workbench/contrib/terminal/browser/terminalInstance.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalInstanceService.ts](src/vs/workbench/contrib/terminal/browser/terminalInstanceService.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalMenus.ts](src/vs/workbench/contrib/terminal/browser/terminalMenus.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalProcessExtHostProxy.ts](src/vs/workbench/contrib/terminal/browser/terminalProcessExtHostProxy.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts](src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalService.ts](src/vs/workbench/contrib/terminal/browser/terminalService.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalStatusList.ts](src/vs/workbench/contrib/terminal/browser/terminalStatusList.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalTabbedView.ts](src/vs/workbench/contrib/terminal/browser/terminalTabbedView.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalTabsList.ts](src/vs/workbench/contrib/terminal/browser/terminalTabsList.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalView.ts](src/vs/workbench/contrib/terminal/browser/terminalView.ts)\n- [src/vs/workbench/contrib/terminal/browser/xterm/xtermTerminal.ts](src/vs/workbench/contrib/terminal/browser/xterm/xtermTerminal.ts)\n- [src/vs/workbench/contrib/terminal/common/terminal.ts](src/vs/workbench/contrib/terminal/common/terminal.ts)\n- [src/vs/workbench/contrib/terminal/common/terminalColorRegistry.ts](src/vs/workbench/contrib/terminal/common/terminalColorRegistry.ts)\n- [src/vs/workbench/contrib/terminal/common/terminalConfiguration.ts](src/vs/workbench/contrib/terminal/common/terminalConfiguration.ts)\n- [src/vs/workbench/contrib/terminal/common/terminalEnvironment.ts](src/vs/workbench/contrib/terminal/common/terminalEnvironment.ts)\n- [src/vs/workbench/contrib/terminal/common/terminalStrings.ts](src/vs/workbench/contrib/terminal/common/terminalStrings.ts)\n- [src/vs/workbench/contrib/terminal/test/browser/terminalStatusList.test.ts](src/vs/workbench/contrib/terminal/test/browser/terminalStatusList.test.ts)\n- [src/vs/workbench/contrib/terminal/test/common/terminalEnvironment.test.ts](src/vs/workbench/contrib/terminal/test/common/terminalEnvironment.test.ts)\n- [src/vs/workbench/contrib/terminalContrib/voice/browser/terminal.voice.contribution.ts](src/vs/workbench/contrib/terminalContrib/voice/browser/terminal.voice.contribution.ts)\n- [src/vs/workbench/contrib/terminalContrib/voice/browser/terminalVoice.ts](src/vs/workbench/contrib/terminalContrib/voice/browser/terminalVoice.ts)\n- [src/vs/workbench/contrib/terminalContrib/voice/browser/terminalVoiceActions.ts](src/vs/workbench/contrib/terminalContrib/voice/browser/terminalVoiceActions.ts)\n\n\u003c/details\u003e\n\n\n\nThis document describes how terminal instances are displayed and organized in the VS Code UI, including terminal groups, split panes, tabs, and the integration with both the terminal panel and editor areas. \n\nFor information about terminal instance lifecycle and process management, see [Terminal Instance and Process Management](#6.2). For details on the xterm.js integration and rendering, see [XTerm.js Integration and Rendering](#6.3).\n\n## Overview\n\nThe terminal UI in VS Code supports multiple organizational paradigms:\n- **Terminal Panel**: Terminals displayed in the bottom panel with a tabs list sidebar\n- **Terminal Editors**: Terminals opened as editors in the editor area\n- **Auxiliary Windows**: Terminals in separate OS windows\n- **Split Panes**: Multiple terminals side-by-side within a single group\n- **Groups**: Collections of split terminals treated as a single tab\n\nThe architecture separates layout concerns into several key components that work together to provide a flexible terminal experience.\n\nSources: [src/vs/workbench/contrib/terminal/browser/terminal.ts:39-46](), [src/vs/workbench/contrib/terminal/common/terminal.ts:24]()\n\n## Terminal Location Types\n\nTerminals can exist in three primary locations, each with different UI characteristics:\n\n```mermaid\ngraph TB\n    subgraph \"TerminalLocation Enum\"\n        Panel[\"TerminalLocation.Panel\u003cbr/\u003e(Terminal View)\"]\n        Editor[\"TerminalLocation.Editor\u003cbr/\u003e(Editor Area)\"]\n        AuxWindow[\"Auxiliary Window\u003cbr/\u003e(Separate OS Window)\"]\n    end\n    \n    subgraph \"UI Components\"\n        TerminalView[\"TerminalViewPane\u003cbr/\u003eterminalView.ts\"]\n        TerminalEditor[\"TerminalEditor\u003cbr/\u003eterminalEditor.ts\"]\n        AuxEditor[\"Editor in Aux Window\"]\n    end\n    \n    subgraph \"Management Services\"\n        TerminalGroupService[\"ITerminalGroupService\u003cbr/\u003eManages panel instances\"]\n        TerminalEditorService[\"ITerminalEditorService\u003cbr/\u003eManages editor instances\"]\n    end\n    \n    Panel --\u003e TerminalView\n    Editor --\u003e TerminalEditor\n    AuxWindow --\u003e AuxEditor\n    \n    TerminalView --\u003e TerminalGroupService\n    TerminalEditor --\u003e TerminalEditorService\n    AuxEditor --\u003e TerminalEditorService\n```\n\nThe `TerminalLocation` enum defines where a terminal instance lives:\n- **Panel**: Managed by `ITerminalGroupService`, displayed in `TerminalViewPane`\n- **Editor**: Managed by `ITerminalEditorService`, displayed as `TerminalEditor` input\n- Terminals can be moved between locations via commands like \"Move to Editor\" or \"Move to Terminal Panel\"\n\nSources: [src/vs/platform/terminal/common/terminal.ts:1-800](), [src/vs/workbench/contrib/terminal/browser/terminalView.ts:57-134](), [src/vs/workbench/contrib/terminal/browser/terminalEditor.ts:1-300]()\n\n## Terminal Groups and Split Panes\n\nA `TerminalGroup` represents a collection of terminal instances displayed as split panes. Each group appears as a single tab in the tabs list, but can contain multiple terminals side-by-side.\n\n```mermaid\ngraph LR\n    subgraph \"TerminalGroup Class\"\n        TG[\"TerminalGroup\u003cbr/\u003eterminalGroup.ts\"]\n        SplitView[\"SplitView\u003cbr/\u003e(from base/ui/splitview)\"]\n        Instances[\"terminalInstances: ITerminalInstance[]\"]\n        ActiveInstance[\"activeInstance: ITerminalInstance\"]\n    end\n    \n    subgraph \"Layout Management\"\n        SplitPane1[\"TerminalInstance 1\u003cbr/\u003eSplitView Pane 0\"]\n        SplitPane2[\"TerminalInstance 2\u003cbr/\u003eSplitView Pane 1\"]\n        SplitPane3[\"TerminalInstance 3\u003cbr/\u003eSplitView Pane 2\"]\n    end\n    \n    TG --\u003e SplitView\n    TG --\u003e Instances\n    TG --\u003e ActiveInstance\n    \n    SplitView --\u003e SplitPane1\n    SplitView --\u003e SplitPane2\n    SplitView --\u003e SplitPane3\n    \n    Instances --\u003e SplitPane1\n    Instances --\u003e SplitPane2\n    Instances --\u003e SplitPane3\n```\n\n### Key Responsibilities\n\nThe `TerminalGroup` class [src/vs/workbench/contrib/terminal/browser/terminalGroup.ts:1-800]() provides:\n\n- **Split Management**: Uses `SplitView` with `Orientation.HORIZONTAL` or `Orientation.VERTICAL` to arrange terminals\n- **Pane Navigation**: `focusPreviousPane()` and `focusNextPane()` to switch between splits\n- **Resizing**: `resizePane(direction: Direction)` and `resizePanes(relativeSizes: number[])`\n- **Instance Management**: `addInstance()`, `removeInstance()`, `moveInstance()`\n\n### Splitting Behavior\n\nWhen splitting a terminal:\n1. User triggers split command (e.g., `TerminalCommandId.Split`)\n2. `TerminalGroup.split(shellLaunchConfig)` is called [src/vs/workbench/contrib/terminal/browser/terminalGroup.ts:300-400]()\n3. A new `TerminalInstance` is created with the same or new shell config\n4. Instance is added to the group's `SplitView` with equal sizing\n5. The new pane is focused automatically\n\nSources: [src/vs/workbench/contrib/terminal/browser/terminalGroup.ts:1-800](), [src/vs/workbench/contrib/terminal/browser/terminalActions.ts:431-445]()\n\n## Tabbed View Architecture\n\nThe `TerminalTabbedView` is the primary UI component for terminals in the panel, combining a tabs list sidebar with the terminal display area.\n\n```mermaid\ngraph TB\n    subgraph \"TerminalTabbedView Structure\"\n        TTV[\"TerminalTabbedView\u003cbr/\u003eterminalTabbedView.ts\"]\n        SplitViewMain[\"SplitView\u003cbr/\u003e(main container)\"]\n        TabsPane[\"Tabs List Pane\u003cbr/\u003e(TerminalTabList)\"]\n        TerminalPane[\"Terminal Container Pane\"]\n    end\n    \n    subgraph \"Tabs List Component\"\n        TerminalTabList[\"TerminalTabList\u003cbr/\u003eWorkbenchList\"]\n        TabsListDataSource[\"_terminalGroupService.groups\"]\n        TabsListRenderer[\"TerminalTabsListRenderer\"]\n    end\n    \n    subgraph \"Terminal Container\"\n        GroupContainer[\"HTMLElement\u003cbr/\u003e.terminal-groups-container\"]\n        ActiveGroup[\"Active TerminalGroup\"]\n        GroupDOM[\"Group DOM Elements\"]\n    end\n    \n    TTV --\u003e SplitViewMain\n    SplitViewMain --\u003e TabsPane\n    SplitViewMain --\u003e TerminalPane\n    \n    TabsPane --\u003e TerminalTabList\n    TerminalTabList --\u003e TabsListDataSource\n    TerminalTabList --\u003e TabsListRenderer\n    \n    TerminalPane --\u003e GroupContainer\n    GroupContainer --\u003e ActiveGroup\n    ActiveGroup --\u003e GroupDOM\n```\n\n### Layout Configuration\n\nThe tabbed view supports configurable layouts controlled by settings:\n\n| Setting | Values | Description |\n|---------|--------|-------------|\n| `terminal.integrated.tabs.location` | `'left'`, `'right'` | Position of tabs list |\n| `terminal.integrated.tabs.enabled` | `boolean` | Show tabs as list vs dropdown |\n| `terminal.integrated.tabs.hideCondition` | `'never'`, `'singleTerminal'`, `'singleGroup'` | When to hide tabs |\n\nThe `SplitView` orientation is determined by:\n- **Panel horizontal**: Tabs on left/right, terminal on right/left\n- **Panel vertical**: Tabs on top, terminal below\n\nSources: [src/vs/workbench/contrib/terminal/browser/terminalTabbedView.ts:1-700](), [src/vs/workbench/contrib/terminal/common/terminalConfiguration.ts:107-116]()\n\n## Tabs List Implementation\n\nThe tabs list displays all terminal groups and provides navigation, context menus, and drag-and-drop reordering.\n\n```mermaid\ngraph TB\n    subgraph \"TerminalTabList - Data Flow\"\n        TabList[\"TerminalTabList\u003cbr/\u003eextends WorkbenchList\"]\n        Groups[\"groups: ITerminalGroup[]\"]\n        Elements[\"List Elements\u003cbr/\u003e(one per group)\"]\n    end\n    \n    subgraph \"List Entry Rendering\"\n        Entry[\"TerminalTabsListEntry\"]\n        Label[\"ResourceLabel\u003cbr/\u003e(title/description)\"]\n        StatusIcon[\"Primary Status Icon\"]\n        ActionBar[\"ActionBar\u003cbr/\u003e(kill/split buttons)\"]\n    end\n    \n    subgraph \"Interaction Handlers\"\n        Click[\"onClick  setActiveInstance()\"]\n        ContextMenu[\"onContextMenu  show menu\"]\n        DragDrop[\"onDragStart/onDrop  reorder\"]\n    end\n    \n    TabList --\u003e Groups\n    Groups --\u003e Elements\n    Elements --\u003e Entry\n    \n    Entry --\u003e Label\n    Entry --\u003e StatusIcon\n    Entry --\u003e ActionBar\n    \n    Entry --\u003e Click\n    Entry --\u003e ContextMenu\n    Entry --\u003e DragDrop\n```\n\n### Tab Entry Composition\n\nEach tab entry [src/vs/workbench/contrib/terminal/browser/terminalTabsList.ts:200-500]() displays:\n\n1. **Icon**: Terminal icon (customizable via `changeIcon` command)\n2. **Color indicator**: Optional color bar (customizable via `changeColor` command)\n3. **Label**: Title computed from `terminal.integrated.tabs.title` template\n4. **Description**: Secondary text from `terminal.integrated.tabs.description` template\n5. **Status icon**: Primary status (e.g., bell, disconnected) from `ITerminalStatusList`\n6. **Action buttons**: Kill and split buttons (when enabled)\n\n### Tab Focus Modes\n\nThe setting `terminal.integrated.tabs.focusMode` controls focus behavior:\n- **`'singleClick'`**: Focus terminal on single click\n- **`'doubleClick'`**: Focus terminal only on double click (default)\n\nThis is implemented in the tab list's click handler [src/vs/workbench/contrib/terminal/browser/terminalTabsList.ts:600-700]().\n\nSources: [src/vs/workbench/contrib/terminal/browser/terminalTabsList.ts:1-1000](), [src/vs/workbench/contrib/terminal/common/terminalConfiguration.ts:127-136]()\n\n## Split Pane Layout System\n\nTerminal groups use a `SplitView` to manage split panes. The split view handles sizing, resizing, and layout of individual terminal instances.\n\n### SplitView Integration\n\n```mermaid\ngraph TB\n    subgraph \"SplitView Configuration\"\n        Orientation[\"Orientation\u003cbr/\u003eHORIZONTAL or VERTICAL\"]\n        Sizing[\"Sizing Strategy\u003cbr/\u003eDistribute or Split\"]\n        Constraints[\"Size Constraints\u003cbr/\u003eminimumSize: 120px\"]\n    end\n    \n    subgraph \"Terminal Panes as IView\"\n        View1[\"IView Implementation\"]\n        Element1[\"element: HTMLElement\"]\n        Layout1[\"layout(width, height)\"]\n        MinSize1[\"minimumSize: number\"]\n    end\n    \n    subgraph \"Pane Operations\"\n        AddPane[\"addInstance() \u003cbr/\u003esplitView.addView()\"]\n        RemovePane[\"removeInstance() \u003cbr/\u003esplitView.removeView()\"]\n        ResizePane[\"resizePane(direction) \u003cbr/\u003esplitView.resizeView()\"]\n        ResizePanes[\"resizePanes(sizes[]) \u003cbr/\u003emultiple resizeView()\"]\n    end\n    \n    Orientation --\u003e View1\n    Sizing --\u003e View1\n    Constraints --\u003e View1\n    \n    View1 --\u003e Element1\n    View1 --\u003e Layout1\n    View1 --\u003e MinSize1\n    \n    AddPane --\u003e View1\n    RemovePane --\u003e View1\n    ResizePane --\u003e View1\n    ResizePanes --\u003e View1\n```\n\n### Pane Sizing\n\nWhen adding a new pane to a split group [src/vs/workbench/contrib/terminal/browser/terminalGroup.ts:400-500]():\n\n1. Calculate available space in the split view\n2. Determine sizing strategy:\n   - **Split existing**: If splitting from an active terminal, use `Sizing.Split` to divide the active pane\n   - **Distribute**: Otherwise use `Sizing.Distribute` to equally size all panes\n3. Add the new view to the split view with constraints (minimum 120px width/height)\n4. Layout is automatically recalculated by the split view\n\n### Resize Operations\n\nThe group provides several resize methods:\n\n- **`resizePane(direction: Direction)`**: Grows/shrinks current pane by 20px in the specified direction\n- **`resizePanes(relativeSizes: number[])`**: Sets specific relative sizes for all panes (used during layout restoration)\n- Keyboard shortcuts (e.g., `Ctrl+Cmd+Left/Right/Up/Down` on Mac) trigger these operations\n\nSources: [src/vs/workbench/contrib/terminal/browser/terminalGroup.ts:300-700](), [src/vs/workbench/contrib/terminal/browser/terminalActions.ts:447-495]()\n\n## Panel vs Editor Layout Differences\n\nTerminals behave differently depending on their location:\n\n### Panel Terminal Layout\n\n```mermaid\ngraph TB\n    subgraph \"Panel Container\"\n        ViewPane[\"TerminalViewPane\u003cbr/\u003e(ViewPane)\"]\n        TabbedView[\"TerminalTabbedView\"]\n        SplitContainer[\"SplitView\u003cbr/\u003e(tabs + terminals)\"]\n    end\n    \n    subgraph \"Layout Calculation\"\n        ParentDims[\"Parent offsetHeight/offsetWidth\"]\n        TabsWidth[\"Tabs list width\u003cbr/\u003e(based on config)\"]\n        TerminalArea[\"Remaining space for terminals\"]\n    end\n    \n    subgraph \"Group Management\"\n        GroupService[\"TerminalGroupService\"]\n        Groups[\"groups: ITerminalGroup[]\"]\n        ActiveGroup[\"activeGroup\"]\n    end\n    \n    ViewPane --\u003e TabbedView\n    TabbedView --\u003e SplitContainer\n    \n    ParentDims --\u003e TabsWidth\n    ParentDims --\u003e TerminalArea\n    TabsWidth --\u003e SplitContainer\n    TerminalArea --\u003e SplitContainer\n    \n    GroupService --\u003e Groups\n    Groups --\u003e ActiveGroup\n    ActiveGroup --\u003e TabbedView\n```\n\nPanel terminals [src/vs/workbench/contrib/terminal/browser/terminalView.ts:100-300]():\n- Managed by `TerminalGroupService`\n- Display in `TerminalViewPane` with tabs list\n- Support panel-specific settings (e.g., `hideOnLastClosed`)\n- Can be hidden via `hidePanel()` command\n\n### Editor Terminal Layout\n\n```mermaid\ngraph TB\n    subgraph \"Editor Area\"\n        EditorInput[\"TerminalEditorInput\u003cbr/\u003e(EditorInput)\"]\n        TerminalEditor[\"TerminalEditor\u003cbr/\u003e(EditorPane)\"]\n        Container[\"HTMLElement\u003cbr/\u003e.terminal-outer-container\"]\n    end\n    \n    subgraph \"Instance Attachment\"\n        DetachedInstance[\"Terminal instance\u003cbr/\u003e(initially detached)\"]\n        AttachToElement[\"instance.attachToElement()\"]\n        XtermAttach[\"xterm.attachToElement()\"]\n    end\n    \n    subgraph \"Editor Integration\"\n        EditorService[\"TerminalEditorService\"]\n        EditorGroupsService[\"IEditorGroupsService\u003cbr/\u003e(workbench editor groups)\"]\n    end\n    \n    EditorInput --\u003e TerminalEditor\n    TerminalEditor --\u003e Container\n    \n    DetachedInstance --\u003e AttachToElement\n    AttachToElement --\u003e XtermAttach\n    Container --\u003e AttachToElement\n    \n    EditorService --\u003e EditorInput\n    EditorGroupsService --\u003e TerminalEditor\n```\n\nEditor terminals [src/vs/workbench/contrib/terminal/browser/terminalEditor.ts:1-300]():\n- Managed by `TerminalEditorService`\n- Display as `TerminalEditor` panes in editor groups\n- No tabs list (use standard editor tabs)\n- Support editor group features (split, move to side, move to new window)\n- Can be reopened after closing (unlike panel terminals)\n\nSources: [src/vs/workbench/contrib/terminal/browser/terminalView.ts:144-300](), [src/vs/workbench/contrib/terminal/browser/terminalEditor.ts:100-250](), [src/vs/workbench/contrib/terminal/browser/terminalEditorService.ts:1-400]()\n\n## Layout and Rendering Flow\n\nThe terminal layout process involves multiple levels of coordination:\n\n```mermaid\nsequenceDiagram\n    participant ViewPane as TerminalViewPane\n    participant TabbedView as TerminalTabbedView\n    participant Group as TerminalGroup\n    participant Instance as TerminalInstance\n    participant Xterm as XtermTerminal\n    \n    ViewPane-\u003e\u003eViewPane: layoutBody(height, width)\n    ViewPane-\u003e\u003eTabbedView: layout(width, height)\n    \n    TabbedView-\u003e\u003eTabbedView: Calculate tabs width\n    TabbedView-\u003e\u003eTabbedView: Calculate terminal area size\n    TabbedView-\u003e\u003eGroup: layout(width, height)\n    \n    Group-\u003e\u003eGroup: Update _splitView size\n    Group-\u003e\u003eInstance: layout(dimension)\n    \n    Instance-\u003e\u003eInstance: Check visibility\n    Instance-\u003e\u003eInstance: _resize()\n    Instance-\u003e\u003eXterm: resize(cols, rows)\n    \n    Xterm--\u003e\u003eInstance: onDidChangeViewportVisibility\n    Instance--\u003e\u003eGroup: Instance ready\n    Group--\u003e\u003eTabbedView: Layout complete\n```\n\n### Layout Trigger Points\n\nLayout is triggered by [src/vs/workbench/contrib/terminal/browser/terminalView.ts:300-400]():\n\n1. **Panel resize**: User drags panel sash\n2. **Window resize**: Entire workbench layout changes\n3. **Tab changes**: Switching between terminal groups\n4. **Split operations**: Adding/removing panes\n5. **Settings changes**: Font size, line height, etc.\n\n### Dimension Calculation\n\nTerminal dimensions are calculated in `TerminalInstance._getDimension()` [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts:700-850]():\n\n1. Get available pixel dimensions from container\n2. Get xterm rendering dimensions from `getXtermScaledDimensions()` using current font metrics\n3. Calculate cols = floor(width / charWidth)\n4. Calculate rows = floor(height / charHeight)\n5. Apply any fixed dimensions or overrides\n6. Cache last known dimensions for restoration\n\nSources: [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts:700-900](), [src/vs/workbench/contrib/terminal/browser/terminalView.ts:100-400](), [src/vs/workbench/contrib/terminal/browser/terminalTabbedView.ts:500-700]()\n\n## CSS Layout Structure\n\nThe terminal UI uses a flex-based layout with specific CSS classes:\n\n### Panel Structure\n\n```\n.pane-body.integrated-terminal              (flex column container)\n .terminal-outer-container                (background, full height)\n    .terminal-groups-container           (groups wrapper)\n        .terminal-group                  (individual group)\n            .split-view-container        (SplitView root)\n                .split-view-view         (pane 1)\n                   .terminal-wrapper    (terminal container)\n                       .xterm           (xterm.js element)\n                .split-view-view         (pane 2)\n                    .terminal-wrapper\n                        .xterm\n```\n\n### Editor Structure\n\n```\n.terminal-editor\n .terminal-outer-container\n     .terminal-wrapper\n         .xterm\n```\n\n### Key CSS Classes\n\n- **`.terminal-wrapper`**: Direct container for xterm, handles sizing and scrollbar\n- **`.terminal-wrapper.fixed-dims`**: Applied when terminal has fixed dimensions (uses static positioning)\n- **`.xterm`**: 20px left padding for gutter, absolutely positioned at bottom\n- **`.terminal-side-view .xterm`**: Top-aligned when panel is vertical\n- **`.split-view-view`**: Each split pane, has border styling\n\nSources: [src/vs/workbench/contrib/terminal/browser/media/terminal.css:1-300]()\n\n## Responsive Behavior\n\nThe terminal UI adapts to narrow layouts:\n\n### Narrow Detection\n\nThe `TerminalContextKeys.isTabsNarrow` context key is set when:\n- Tabs width \u003c 120px (configured minimum)\n- Controlled by `_terminalIsTabsNarrowContextKey` in `TerminalTabbedView`\n\n### Narrow Mode Adaptations\n\nWhen in narrow mode [src/vs/workbench/contrib/terminal/browser/terminalTabbedView.ts:200-300]():\n- Tab labels may be hidden, showing only icons\n- `showActiveTerminal` setting controls if active terminal info is shown\n- `showActions` setting controls if split/kill buttons are visible\n- Dropdown selector can be used instead of full tabs list\n\n### Settings Impact\n\n| Setting | Effect in Narrow Mode |\n|---------|----------------------|\n| `tabs.showActiveTerminal: 'singleTerminalOrNarrow'` | Shows active terminal info |\n| `tabs.showActions: 'singleTerminalOrNarrow'` | Shows action buttons |\n| `tabs.hideCondition: 'singleTerminal'` | Hides tabs list entirely |\n\nSources: [src/vs/workbench/contrib/terminal/browser/terminalTabbedView.ts:150-350](), [src/vs/workbench/contrib/terminal/common/terminalConfiguration.ts:83-106]()\n\n## Drag and Drop Support\n\nTerminals support comprehensive drag-and-drop operations for reorganization:\n\n### Supported Operations\n\n1. **Tab reordering**: Drag tab within tabs list to reorder groups\n2. **Tab to editor**: Drag tab to editor area to open as terminal editor\n3. **Editor to panel**: Drag terminal editor to panel to move back\n4. **Cross-window**: Drag terminal to another VS Code window\n5. **Split drop zones**: Drop on split target overlays to create new split\n\n### Drop Zone Overlays\n\nWhen dragging a terminal, drop overlays appear [src/vs/workbench/contrib/terminal/browser/terminalGroup.ts:200-400]():\n- **Center**: Merge into existing group\n- **Top/Bottom/Left/Right**: Create new split in that direction\n- Overlays use `.terminal-drop-overlay` CSS class with semi-transparent background\n\n### Data Transfer Format\n\nTerminals use `TerminalDataTransfers.Terminals` as the data transfer type, containing:\n- Terminal URI (parseable via `parseTerminalUri()`)\n- Instance ID\n- Group information\n\nSources: [src/vs/workbench/contrib/terminal/browser/terminalGroup.ts:600-900](), [src/vs/workbench/contrib/terminal/browser/terminalTabbedView.ts:400-600](), [src/vs/workbench/contrib/terminal/browser/terminal.ts:1-100]()"])</script><script>self.__next_f.push([1,"38:Te680,"])</script><script>self.__next_f.push([1,"# Terminal Extension API\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [extensions/vscode-api-tests/package.json](extensions/vscode-api-tests/package.json)\n- [extensions/vscode-api-tests/src/singlefolder-tests/chat.test.ts](extensions/vscode-api-tests/src/singlefolder-tests/chat.test.ts)\n- [src/vs/editor/browser/config/charWidthReader.ts](src/vs/editor/browser/config/charWidthReader.ts)\n- [src/vs/editor/browser/editorBrowser.ts](src/vs/editor/browser/editorBrowser.ts)\n- [src/vs/editor/browser/viewParts/minimap/minimap.ts](src/vs/editor/browser/viewParts/minimap/minimap.ts)\n- [src/vs/editor/browser/viewParts/minimap/minimapCharRenderer.ts](src/vs/editor/browser/viewParts/minimap/minimapCharRenderer.ts)\n- [src/vs/editor/browser/viewParts/minimap/minimapCharRendererFactory.ts](src/vs/editor/browser/viewParts/minimap/minimapCharRendererFactory.ts)\n- [src/vs/editor/browser/viewParts/minimap/minimapCharSheet.ts](src/vs/editor/browser/viewParts/minimap/minimapCharSheet.ts)\n- [src/vs/editor/browser/viewParts/minimap/minimapPreBaked.ts](src/vs/editor/browser/viewParts/minimap/minimapPreBaked.ts)\n- [src/vs/editor/browser/widget/codeEditor/codeEditorWidget.ts](src/vs/editor/browser/widget/codeEditor/codeEditorWidget.ts)\n- [src/vs/editor/common/config/editorOptions.ts](src/vs/editor/common/config/editorOptions.ts)\n- [src/vs/editor/common/config/fontInfo.ts](src/vs/editor/common/config/fontInfo.ts)\n- [src/vs/editor/common/editorCommon.ts](src/vs/editor/common/editorCommon.ts)\n- [src/vs/editor/common/languages.ts](src/vs/editor/common/languages.ts)\n- [src/vs/editor/common/standalone/standaloneEnums.ts](src/vs/editor/common/standalone/standaloneEnums.ts)\n- [src/vs/editor/common/textModelEvents.ts](src/vs/editor/common/textModelEvents.ts)\n- [src/vs/editor/common/viewModel/minimapTokensColorTracker.ts](src/vs/editor/common/viewModel/minimapTokensColorTracker.ts)\n- [src/vs/editor/test/browser/view/minimapCharRenderer.test.ts](src/vs/editor/test/browser/view/minimapCharRenderer.test.ts)\n- [src/vs/monaco.d.ts](src/vs/monaco.d.ts)\n- [src/vs/platform/extensions/common/extensionsApiProposals.ts](src/vs/platform/extensions/common/extensionsApiProposals.ts)\n- [src/vs/platform/terminal/common/terminal.ts](src/vs/platform/terminal/common/terminal.ts)\n- [src/vs/platform/terminal/common/terminalEnvironment.ts](src/vs/platform/terminal/common/terminalEnvironment.ts)\n- [src/vs/platform/terminal/common/terminalRecorder.ts](src/vs/platform/terminal/common/terminalRecorder.ts)\n- [src/vs/platform/terminal/node/ptyHostMain.ts](src/vs/platform/terminal/node/ptyHostMain.ts)\n- [src/vs/platform/terminal/node/ptyHostService.ts](src/vs/platform/terminal/node/ptyHostService.ts)\n- [src/vs/platform/terminal/node/ptyService.ts](src/vs/platform/terminal/node/ptyService.ts)\n- [src/vs/platform/terminal/node/terminalProcess.ts](src/vs/platform/terminal/node/terminalProcess.ts)\n- [src/vs/platform/terminal/test/common/terminalEnvironment.test.ts](src/vs/platform/terminal/test/common/terminalEnvironment.test.ts)\n- [src/vs/platform/terminal/test/common/terminalProfiles.test.ts](src/vs/platform/terminal/test/common/terminalProfiles.test.ts)\n- [src/vs/platform/terminal/test/common/terminalRecorder.test.ts](src/vs/platform/terminal/test/common/terminalRecorder.test.ts)\n- [src/vs/workbench/api/browser/extensionHost.contribution.ts](src/vs/workbench/api/browser/extensionHost.contribution.ts)\n- [src/vs/workbench/api/browser/mainThreadLanguageFeatures.ts](src/vs/workbench/api/browser/mainThreadLanguageFeatures.ts)\n- [src/vs/workbench/api/browser/mainThreadTerminalService.ts](src/vs/workbench/api/browser/mainThreadTerminalService.ts)\n- [src/vs/workbench/api/common/extHost.api.impl.ts](src/vs/workbench/api/common/extHost.api.impl.ts)\n- [src/vs/workbench/api/common/extHost.protocol.ts](src/vs/workbench/api/common/extHost.protocol.ts)\n- [src/vs/workbench/api/common/extHostLanguageFeatures.ts](src/vs/workbench/api/common/extHostLanguageFeatures.ts)\n- [src/vs/workbench/api/common/extHostTerminalService.ts](src/vs/workbench/api/common/extHostTerminalService.ts)\n- [src/vs/workbench/api/common/extHostTypeConverters.ts](src/vs/workbench/api/common/extHostTypeConverters.ts)\n- [src/vs/workbench/api/common/extHostTypes.ts](src/vs/workbench/api/common/extHostTypes.ts)\n- [src/vs/workbench/api/node/extHostTerminalService.ts](src/vs/workbench/api/node/extHostTerminalService.ts)\n- [src/vs/workbench/contrib/terminal/browser/media/terminal.css](src/vs/workbench/contrib/terminal/browser/media/terminal.css)\n- [src/vs/workbench/contrib/terminal/browser/media/xterm.css](src/vs/workbench/contrib/terminal/browser/media/xterm.css)\n- [src/vs/workbench/contrib/terminal/browser/remotePty.ts](src/vs/workbench/contrib/terminal/browser/remotePty.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminal.contribution.ts](src/vs/workbench/contrib/terminal/browser/terminal.contribution.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminal.ts](src/vs/workbench/contrib/terminal/browser/terminal.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalActions.ts](src/vs/workbench/contrib/terminal/browser/terminalActions.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalEditor.ts](src/vs/workbench/contrib/terminal/browser/terminalEditor.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalEditorInput.ts](src/vs/workbench/contrib/terminal/browser/terminalEditorInput.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalEditorService.ts](src/vs/workbench/contrib/terminal/browser/terminalEditorService.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalGroup.ts](src/vs/workbench/contrib/terminal/browser/terminalGroup.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalGroupService.ts](src/vs/workbench/contrib/terminal/browser/terminalGroupService.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts](src/vs/workbench/contrib/terminal/browser/terminalInstance.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalInstanceService.ts](src/vs/workbench/contrib/terminal/browser/terminalInstanceService.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalMenus.ts](src/vs/workbench/contrib/terminal/browser/terminalMenus.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalProcessExtHostProxy.ts](src/vs/workbench/contrib/terminal/browser/terminalProcessExtHostProxy.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts](src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalService.ts](src/vs/workbench/contrib/terminal/browser/terminalService.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalStatusList.ts](src/vs/workbench/contrib/terminal/browser/terminalStatusList.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalTabbedView.ts](src/vs/workbench/contrib/terminal/browser/terminalTabbedView.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalTabsList.ts](src/vs/workbench/contrib/terminal/browser/terminalTabsList.ts)\n- [src/vs/workbench/contrib/terminal/browser/terminalView.ts](src/vs/workbench/contrib/terminal/browser/terminalView.ts)\n- [src/vs/workbench/contrib/terminal/browser/xterm/xtermTerminal.ts](src/vs/workbench/contrib/terminal/browser/xterm/xtermTerminal.ts)\n- [src/vs/workbench/contrib/terminal/common/terminal.ts](src/vs/workbench/contrib/terminal/common/terminal.ts)\n- [src/vs/workbench/contrib/terminal/common/terminalColorRegistry.ts](src/vs/workbench/contrib/terminal/common/terminalColorRegistry.ts)\n- [src/vs/workbench/contrib/terminal/common/terminalConfiguration.ts](src/vs/workbench/contrib/terminal/common/terminalConfiguration.ts)\n- [src/vs/workbench/contrib/terminal/common/terminalEnvironment.ts](src/vs/workbench/contrib/terminal/common/terminalEnvironment.ts)\n- [src/vs/workbench/contrib/terminal/common/terminalStrings.ts](src/vs/workbench/contrib/terminal/common/terminalStrings.ts)\n- [src/vs/workbench/contrib/terminal/test/browser/terminalStatusList.test.ts](src/vs/workbench/contrib/terminal/test/browser/terminalStatusList.test.ts)\n- [src/vs/workbench/contrib/terminal/test/common/terminalEnvironment.test.ts](src/vs/workbench/contrib/terminal/test/common/terminalEnvironment.test.ts)\n- [src/vs/workbench/contrib/terminalContrib/voice/browser/terminal.voice.contribution.ts](src/vs/workbench/contrib/terminalContrib/voice/browser/terminal.voice.contribution.ts)\n- [src/vs/workbench/contrib/terminalContrib/voice/browser/terminalVoice.ts](src/vs/workbench/contrib/terminalContrib/voice/browser/terminalVoice.ts)\n- [src/vs/workbench/contrib/terminalContrib/voice/browser/terminalVoiceActions.ts](src/vs/workbench/contrib/terminalContrib/voice/browser/terminalVoiceActions.ts)\n- [src/vscode-dts/vscode.d.ts](src/vscode-dts/vscode.d.ts)\n- [src/vscode-dts/vscode.proposed.inlineCompletionsAdditions.d.ts](src/vscode-dts/vscode.proposed.inlineCompletionsAdditions.d.ts)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis page documents the Terminal Extension API, which enables extensions to create and manage terminals, contribute terminal profiles, implement custom pseudoterminals (PTYs), and observe terminal lifecycle events. The API is exposed through the `vscode` namespace, primarily under `vscode.window`.\n\n**Core Components:**\n\n| Component | File | Role |\n|-----------|------|------|\n| `ExtHostTerminalService` | [src/vs/workbench/api/common/extHostTerminalService.ts:155-1115]() | Extension host service managing terminal instances and PTY attachments |\n| `MainThreadTerminalService` | [src/vs/workbench/api/browser/mainThreadTerminalService.ts:45-573]() | Main thread service handling terminal creation and RPC |\n| `TerminalProcessExtHostProxy` | [src/vs/workbench/contrib/terminal/browser/terminalProcessExtHostProxy.ts:18-191]() | Implements `ITerminalChildProcess` to bridge extension PTYs to `TerminalProcessManager` |\n| `ExtHostTerminal` | [src/vs/workbench/api/common/extHostTerminalService.ts:1117-1366]() | Represents a terminal instance in the extension host |\n\nFor terminal process management, see page 8.2. For shell integration, see page 8.6.\n\nSources: [src/vs/workbench/api/common/extHostTerminalService.ts:1-1366](), [src/vs/workbench/api/browser/mainThreadTerminalService.ts:1-573](), [src/vs/workbench/contrib/terminal/browser/terminalProcessExtHostProxy.ts:1-191]()\n\n## API Surface Overview\n\nThe Terminal Extension API exposes terminal functionality through the `vscode.window` namespace. Extensions interact with terminals via the `Terminal` interface and can provide custom terminal implementations using the `Pseudoterminal` interface.\n\n**Core API Classes and Interfaces:**\n\n| Entity | Type | File Location | Purpose |\n|--------|------|---------------|---------|\n| `ExtHostTerminalService` | Class | [src/vs/workbench/api/common/extHostTerminalService.ts:155-1115]() | Extension host service managing terminals and PTY attachments |\n| `ExtHostTerminal` | Class | [src/vs/workbench/api/common/extHostTerminalService.ts:1117-1366]() | Implements `vscode.Terminal` interface for extensions |\n| `MainThreadTerminalService` | Class | [src/vs/workbench/api/browser/mainThreadTerminalService.ts:45-573]() | Main thread bridge handling RPC and workbench integration |\n| `TerminalProcessExtHostProxy` | Class | [src/vs/workbench/contrib/terminal/browser/terminalProcessExtHostProxy.ts:18-191]() | Implements `ITerminalChildProcess` for extension PTYs |\n| `Pseudoterminal` | Interface | [src/vscode-dts/vscode.d.ts:11848-11998]() | Extension-implemented terminal backend |\n| `Terminal` | Interface | [src/vscode-dts/vscode.d.ts:12077-12212]() | Terminal instance handle for extensions |\n\n**API Methods:**\n\n| Method | Location | Description |\n|--------|----------|-------------|\n| `window.createTerminal()` | [src/vs/workbench/api/common/extHost.api.impl.ts:632-707]() | Creates terminal from `TerminalOptions` or `ExtensionTerminalOptions` |\n| `window.registerTerminalProfileProvider()` | [src/vs/workbench/api/common/extHost.api.impl.ts:709-719]() | Registers a contributed terminal profile |\n| `window.registerTerminalLinkProvider()` | [src/vs/workbench/api/common/extHost.api.impl.ts:720-730]() | Registers custom link detection and handling |\n| `window.registerTerminalQuickFixProvider()` | [src/vs/workbench/api/common/extHost.api.impl.ts:731-741]() | Registers quick fix suggestions for terminal output |\n\nThe implementation uses a two-process architecture:\n- **Extension Host Process**: Runs extension code, manages `ExtHostTerminal` instances, stores `Pseudoterminal` implementations in `_extHostTerminals` map\n- **Main Process**: Manages `TerminalInstance` objects, coordinates with `TerminalProcessManager`, renders via xterm.js\n\u003c/old_str\u003e\n\u003cnew_str\u003e\n## API Surface Overview\n\nThe Terminal Extension API exposes terminal functionality through the `vscode.window` namespace. Extensions interact with terminals via the `Terminal` interface and can provide custom terminal implementations using the `Pseudoterminal` interface.\n\n**Core API Classes and Interfaces:**\n\n| Entity | Type | File Location | Purpose |\n|--------|------|---------------|---------|\n| `ExtHostTerminalService` | Class | [src/vs/workbench/api/common/extHostTerminalService.ts:155-1115]() | Extension host service managing terminals and PTY attachments |\n| `ExtHostTerminal` | Class | [src/vs/workbench/api/common/extHostTerminalService.ts:1117-1366]() | Implements `vscode.Terminal` interface for extensions |\n| `MainThreadTerminalService` | Class | [src/vs/workbench/api/browser/mainThreadTerminalService.ts:45-573]() | Main thread bridge handling RPC and workbench integration |\n| `TerminalProcessExtHostProxy` | Class | [src/vs/workbench/contrib/terminal/browser/terminalProcessExtHostProxy.ts:18-191]() | Implements `ITerminalChildProcess` for extension PTYs |\n| `Pseudoterminal` | Interface | [src/vscode-dts/vscode.d.ts:11848-11998]() | Extension-implemented terminal backend |\n| `Terminal` | Interface | [src/vscode-dts/vscode.d.ts:12077-12212]() | Terminal instance handle for extensions |\n| `EnvironmentVariableCollection` | Interface | [src/vscode-dts/vscode.d.ts:11813-11845]() | Modifies terminal environment variables |\n\n**API Methods:**\n\n| Method | Location | Description |\n|--------|----------|-------------|\n| `window.createTerminal()` | [src/vs/workbench/api/common/extHost.api.impl.ts:632-707]() | Creates terminal from `TerminalOptions` or `ExtensionTerminalOptions` |\n| `window.registerTerminalProfileProvider()` | [src/vs/workbench/api/common/extHost.api.impl.ts:709-719]() | Registers a contributed terminal profile |\n| `window.registerTerminalLinkProvider()` | [src/vs/workbench/api/common/extHost.api.impl.ts:720-730]() | Registers custom link detection and handling |\n| `window.registerTerminalQuickFixProvider()` | [src/vs/workbench/api/common/extHost.api.impl.ts:731-741]() | Registers quick fix suggestions for terminal output |\n| `ExtensionContext.environmentVariableCollection` | [src/vs/workbench/api/common/extHost.api.impl.ts:1147-1161]() | Returns `EnvironmentVariableCollection` for the extension |\n\nThe implementation uses a two-process architecture:\n- **Extension Host Process**: Runs extension code, manages `ExtHostTerminal` instances, stores `Pseudoterminal` implementations in `_extHostTerminals` map\n- **Main Process**: Manages `TerminalInstance` objects, coordinates with `TerminalProcessManager`, renders via xterm.js\n\n**Diagram: Terminal Extension API Component Architecture**\n\n```mermaid\ngraph TB\n    subgraph ExtensionProcess[\"Extension Host Process\"]\n        ExtensionCode[\"Extension Code\u003cbr/\u003e(TypeScript/JavaScript)\"]\n        vscodeAPI[\"vscode.window API\"]\n        ExtHostTerminalService[\"ExtHostTerminalService\u003cbr/\u003eclass implements ExtHostTerminalServiceShape\u003cbr/\u003e_terminals: ExtHostTerminal[]\u003cbr/\u003e_extHostTerminals: Map\u0026lt;number, Pseudoterminal\u0026gt;\u003cbr/\u003e_terminalProcessProxies: Map\u0026lt;number, ITerminalProcessExtHostProxy\u0026gt;\"]\n        ExtHostTerminal[\"ExtHostTerminal\u003cbr/\u003eclass implements vscode.Terminal\u003cbr/\u003e_id: string\u003cbr/\u003e_name: string\u003cbr/\u003e_state: TerminalState\"]\n        PseudoterminalImpl[\"Pseudoterminal implementation\u003cbr/\u003einterface vscode.Pseudoterminal\u003cbr/\u003eonDidWrite: Event\u0026lt;string\u0026gt;\u003cbr/\u003eopen(dimensions?)\u003cbr/\u003eclose()\u003cbr/\u003ehandleInput(data)\"]\n    end\n    \n    subgraph RPCLayer[\"RPC Protocol Layer\"]\n        ExtHostShape[\"ExtHostTerminalServiceShape\u003cbr/\u003e$acceptTerminalOpened()\u003cbr/\u003e$acceptTerminalClosed()\u003cbr/\u003e$acceptProcessInput()\u003cbr/\u003e$startExtensionTerminal()\"]\n        MainThreadShape[\"MainThreadTerminalServiceShape\u003cbr/\u003e$createTerminal()\u003cbr/\u003e$sendProcessData()\u003cbr/\u003e$dispose()\u003cbr/\u003e$show()\"]\n    end\n    \n    subgraph MainProcess[\"Main Thread / Renderer Process\"]\n        MainThreadTerminalService[\"MainThreadTerminalService\u003cbr/\u003eclass implements MainThreadTerminalServiceShape\u003cbr/\u003e_proxy: ExtHostTerminalServiceShape\u003cbr/\u003e_terminalService: ITerminalService\"]\n        TerminalService[\"TerminalService\u003cbr/\u003eimplements ITerminalService\u003cbr/\u003ecreateTerminal()\u003cbr/\u003einstances: ITerminalInstance[]\"]\n        TerminalInstance[\"TerminalInstance\u003cbr/\u003eclass implements ITerminalInstance\u003cbr/\u003e_processManager: TerminalProcessManager\u003cbr/\u003exterm?: XtermTerminal\"]\n        TerminalProcessManager[\"TerminalProcessManager\u003cbr/\u003eclass implements ITerminalProcessManager\u003cbr/\u003e_process: ITerminalChildProcess\u003cbr/\u003ewrite(data)\"]\n        TerminalProcessExtHostProxy[\"TerminalProcessExtHostProxy\u003cbr/\u003eclass implements ITerminalChildProcess\u003cbr/\u003eonProcessData: Event\u0026lt;string\u0026gt;\u003cbr/\u003einput(data)\u003cbr/\u003eemitData(data)\"]\n    end\n    \n    ExtensionCode --\u003e|\"createTerminal(options)\"| vscodeAPI\n    vscodeAPI --\u003e ExtHostTerminalService\n    ExtHostTerminalService --\u003e|\"new ExtHostTerminal()\"| ExtHostTerminal\n    ExtHostTerminalService --\u003e|\"attachPtyToTerminal()\"| PseudoterminalImpl\n    \n    ExtHostTerminalService \u003c--\u003e|\"RPC calls\"| ExtHostShape\n    ExtHostShape \u003c--\u003e|\"IPC channel\"| MainThreadShape\n    MainThreadShape \u003c--\u003e MainThreadTerminalService\n    \n    MainThreadTerminalService --\u003e|\"createTerminal()\"| TerminalService\n    TerminalService --\u003e|\"createInstance()\"| TerminalInstance\n    TerminalInstance --\u003e|\"new TerminalProcessManager()\"| TerminalProcessManager\n    TerminalProcessManager --\u003e|\"_process =\"| TerminalProcessExtHostProxy\n    \n    TerminalProcessExtHostProxy -.-\u003e|\"events via MainThreadTerminalService\"| MainThreadShape\n    MainThreadShape -.-\u003e|\"$acceptProcessInput()\"| ExtHostShape\n    ExtHostShape -.-\u003e|\"pty.handleInput()\"| PseudoterminalImpl\n    \n    PseudoterminalImpl -.-\u003e|\"onDidWrite.fire()\"| ExtHostTerminalService\n    ExtHostTerminalService -.-\u003e|\"$sendProcessData()\"| ExtHostShape\n    ExtHostShape -.-\u003e|\"RPC\"| MainThreadShape\n    MainThreadShape -.-\u003e|\"emitData()\"| TerminalProcessExtHostProxy\n```\n\nSources: [src/vs/workbench/api/common/extHostTerminalService.ts:155-1366](), [src/vs/workbench/api/browser/mainThreadTerminalService.ts:45-573](), [src/vs/workbench/contrib/terminal/browser/terminalProcessExtHostProxy.ts:18-191](), [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts:1-900](), [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts:129-648]()\n\n## Terminal Creation\n\nExtensions can create terminals in three ways:\n\n### Standard Terminal Creation\n\nStandard terminals spawn a shell process using the system's default shell or a configured shell. Extensions create them via `window.createTerminal()` which delegates to `ExtHostTerminalService.createTerminalFromOptions()`.\n\n**Creation Flow:**\n\n1. Extension calls `vscode.window.createTerminal(options)` ([src/vs/workbench/api/common/extHost.api.impl.ts:632-707]())\n2. `ExtHostTerminalService.createTerminalFromOptions()` ([src/vs/workbench/api/common/extHostTerminalService.ts:239-287]()) creates an `ExtHostTerminal` instance\n3. The method constructs an `IShellLaunchConfigDto` from the `TerminalOptions`\n4. Calls `_proxy.$createTerminal()` to send RPC request to main thread\n5. Main thread's `MainThreadTerminalService.$createTerminal()` ([src/vs/workbench/api/browser/mainThreadTerminalService.ts:139-191]()) receives the request\n6. Delegates to `ITerminalService.createTerminal()` to create a `TerminalInstance`\n7. The `TerminalInstance` creates a `TerminalProcessManager` which spawns the shell process\n\n**TerminalOptions Interface:**\n\n| Property | Type | Description |\n|----------|------|-------------|\n| `name` | `string` | Terminal display name |\n| `shellPath` | `string` | Path to shell executable |\n| `shellArgs` | `string[] \\| string` | Arguments to pass to shell |\n| `cwd` | `string \\| Uri` | Working directory |\n| `env` | `{[key: string]: string \\| null}` | Environment variables to set/unset |\n| `strictEnv` | `boolean` | If true, only use `env`, don't inherit |\n| `hideFromUser` | `boolean` | If true, don't show in terminal list |\n| `message` | `string` | Message to show on terminal startup |\n| `iconPath` | `Uri \\| ThemeIcon` | Icon for terminal tab |\n| `color` | `ThemeColor` | Color for terminal icon |\n| `location` | `TerminalLocation \\| TerminalEditorLocationOptions \\| TerminalSplitLocationOptions` | Where to create terminal |\n| `isTransient` | `boolean` | If true, terminal won't persist across reloads |\n\nThe `IShellLaunchConfig` object constructed from these options is sent to the main thread and used by `TerminalProcessManager` to spawn the process via node-pty ([src/vs/platform/terminal/node/terminalProcess.ts:1-900]()).\n\n### Extension Terminal Creation\n\nExtension terminals provide custom terminal implementations using the `Pseudoterminal` interface. Instead of spawning a shell process, the extension controls all terminal I/O through event emitters.\n\n**ExtensionTerminalOptions Structure:**\n\n```typescript\ninterface ExtensionTerminalOptions {\n    name: string;\n    pty: Pseudoterminal;\n    iconPath?: Uri | ThemeIcon;\n    color?: ThemeColor;\n    location?: TerminalLocation | TerminalEditorLocationOptions | TerminalSplitLocationOptions;\n    isTransient?: boolean;\n}\n```\n\n**Creation Flow:**\n\n1. Extension provides a `Pseudoterminal` implementation with `onDidWrite` and `onDidClose` events\n2. Calls `window.createTerminal({ name, pty })` ([src/vs/workbench/api/common/extHost.api.impl.ts:632-707]())\n3. `ExtHostTerminalService.createExtensionTerminal()` ([src/vs/workbench/api/common/extHostTerminalService.ts:289-354]()) is invoked\n4. Creates an `ExtHostTerminal` with `customPtyImplementation: true` in the launch config\n5. Calls `attachPtyToTerminal()` ([src/vs/workbench/api/common/extHostTerminalService.ts:356-429]()) to wire up the PTY\n6. Sends `$createTerminal()` RPC with `customPtyImplementation` flag\n7. Main thread creates a `TerminalInstance` with `TerminalProcessExtHostProxy` instead of a real shell process\n8. Main thread fires `onDidRequestStartExtensionTerminal` event\n9. `MainThreadTerminalService` calls back to extension host via `$startExtensionTerminal()` ([src/vs/workbench/api/common/extHostTerminalService.ts:639-718]())\n10. Extension host calls `pty.open(initialDimensions)` to start the terminal\n\n**Key Difference from Standard Terminals:**\n\nStandard terminals use `TerminalProcess` (node-pty) as the `ITerminalChildProcess`, while extension terminals use `TerminalProcessExtHostProxy` which bridges to the extension's `Pseudoterminal` via RPC.\n\n**Diagram: Standard Terminal Creation Sequence**\n\n```mermaid\nsequenceDiagram\n    participant Extension as Extension Code\n    participant windowAPI as window.createTerminal()\n    participant ExtHostTerminalService as ExtHostTerminalService\n    participant ExtHostTerminal as ExtHostTerminal\n    participant MainThreadTerminalService as MainThreadTerminalService\n    participant TerminalService as TerminalService\u003cbr/\u003eITerminalService\n    participant TerminalInstanceService as TerminalInstanceService\n    participant TerminalInstance as TerminalInstance\n    participant TerminalProcessManager as TerminalProcessManager\n    participant TerminalProcess as TerminalProcess\u003cbr/\u003enode-pty\n    \n    Extension-\u003e\u003ewindowAPI: createTerminal({name, shellPath, cwd, env})\n    windowAPI-\u003e\u003eExtHostTerminalService: createTerminalFromOptions(options)\n    ExtHostTerminalService-\u003e\u003eExtHostTerminalService: generateUuid()  terminalId\n    ExtHostTerminalService-\u003e\u003eExtHostTerminal: new ExtHostTerminal(id, options)\n    ExtHostTerminal--\u003e\u003eExtHostTerminalService: extHostTerminal\n    ExtHostTerminalService-\u003e\u003eExtHostTerminalService: _terminals.push(extHostTerminal)\n    ExtHostTerminalService-\u003e\u003eExtHostTerminalService: convertTerminalOptionsToDto()\n    ExtHostTerminalService-\u003e\u003eMainThreadTerminalService: $createTerminal(id, launchConfigDto)\n    \n    MainThreadTerminalService-\u003e\u003eMainThreadTerminalService: reviveIShellLaunchConfig()\n    MainThreadTerminalService-\u003e\u003eTerminalService: createTerminal(shellLaunchConfig)\n    TerminalService-\u003e\u003eTerminalInstanceService: createInstance(shellLaunchConfig, target)\n    TerminalInstanceService-\u003e\u003eTerminalInstance: new TerminalInstance(shellLaunchConfig)\n    TerminalInstance-\u003e\u003eTerminalProcessManager: new TerminalProcessManager()\n    TerminalInstance--\u003e\u003eTerminalInstanceService: instance\n    TerminalInstanceService-\u003e\u003eTerminalInstanceService: _onDidCreateInstance.fire(instance)\n    TerminalInstanceService--\u003e\u003eTerminalService: instance\n    TerminalService--\u003e\u003eMainThreadTerminalService: void\n    \n    Note over TerminalInstance,TerminalProcess: Process creation happens asynchronously\n    TerminalProcessManager-\u003e\u003eTerminalProcess: spawn shell via node-pty\n    TerminalProcess--\u003e\u003eTerminalProcessManager: pty handle\n    TerminalProcessManager-\u003e\u003eTerminalInstance: onProcessReady event\n    \n    MainThreadTerminalService--\u003e\u003eExtHostTerminalService: Promise resolves\n    ExtHostTerminalService--\u003e\u003eExtension: return extHostTerminal\n```\n\nSources: [src/vs/workbench/api/common/extHostTerminalService.ts:239-287](), [src/vs/workbench/api/browser/mainThreadTerminalService.ts:139-191](), [src/vs/workbench/contrib/terminal/browser/terminalService.ts:298-400](), [src/vs/workbench/contrib/terminal/browser/terminalInstance.ts:364-648](), [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts:1-900]()\n\n## Pseudoterminal Interface\n\nThe `Pseudoterminal` interface ([src/vscode-dts/vscode.d.ts:11848-11998]()) allows extensions to implement custom terminal backends without spawning a shell process. Use cases include SSH connections, Docker exec sessions, language REPL environments, and custom shells.\n\n### Interface Members\n\n| Member | Type | Required | Purpose |\n|--------|------|----------|---------|\n| `onDidWrite` | `Event\u003cstring\u003e` | Yes | Fires when data should be written to terminal display |\n| `onDidClose` | `Event\u003cnumber \\| void\u003e` | Yes | Fires when terminal should close, optional exit code |\n| `onDidChangeName` | `Event\u003cstring\u003e` | No | Fires when terminal name changes dynamically |\n| `onDidOverrideDimensions` | `Event\u003cTerminalDimensions\u003e` | No | Fires to override terminal dimensions |\n| `open(initialDimensions?)` | `void` | Yes | Called when terminal is created in UI |\n| `close()` | `void` | Yes | Called when terminal is disposed |\n| `handleInput(data)` | `void` | No | Receives user keyboard input from terminal |\n| `setDimensions(dimensions)` | `void` | No | Called when terminal is resized |\n\n### Data Flow Details\n\n**Output Path (Extension  Terminal Display):**\n\n1. Extension code calls `onDidWriteEmitter.fire(data)` with string data\n2. `ExtHostTerminalService` event listener ([src/vs/workbench/api/common/extHostTerminalService.ts:374-391]()) receives the event\n3. Calls `_proxy.$sendProcessData(terminalId, data)` to send via RPC\n4. `MainThreadTerminalService.$sendProcessData()` ([src/vs/workbench/api/browser/mainThreadTerminalService.ts:377-389]()) receives the data\n5. Finds the `TerminalProcessExtHostProxy` instance via terminal ID\n6. Calls `proxy.emitData(data)` which fires the `onProcessData` event\n7. `TerminalProcessManager` ([src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts:200-300]()) handles the event\n8. Writes data to `XtermTerminal.raw.write(data)` for display\n\n**Input Path (Terminal Display  Extension):**\n\n1. User types in xterm.js, fires `raw.onData` event\n2. `XtermTerminal` ([src/vs/workbench/contrib/terminal/browser/xterm/xtermTerminal.ts:1-900]()) handles the event\n3. `TerminalProcessManager` receives input, calls `_process.input(data)`\n4. `TerminalProcessExtHostProxy.input()` ([src/vs/workbench/contrib/terminal/browser/terminalProcessExtHostProxy.ts:78-82]()) fires `_onInputEvent`\n5. Event listener in `MainThreadTerminalService` ([src/vs/workbench/api/browser/mainThreadTerminalService.ts:127-137]()) calls `_proxy.$acceptProcessInput(terminalId, data)`\n6. `ExtHostTerminalService.$acceptProcessInput()` ([src/vs/workbench/api/common/extHostTerminalService.ts:856-863]()) receives the RPC call\n7. Retrieves the `Pseudoterminal` from `_extHostTerminals.get(terminalId)`\n8. Calls `pty.handleInput?.(data)` to deliver input to extension\n\n### Implementation Patterns\n\n**Basic Echo Terminal:**\n\n```typescript\nclass EchoPseudoterminal implements vscode.Pseudoterminal {\n    private writeEmitter = new vscode.EventEmitter\u003cstring\u003e();\n    onDidWrite = this.writeEmitter.event;\n    \n    private closeEmitter = new vscode.EventEmitter\u003cnumber\u003e();\n    onDidClose = this.closeEmitter.event;\n    \n    open(initialDimensions?: vscode.TerminalDimensions): void {\n        this.writeEmitter.fire('Echo terminal ready\\r\\n$ ');\n    }\n    \n    close(): void {\n        // Cleanup if needed\n    }\n    \n    handleInput(data: string): void {\n        if (data === '\\r') {\n            this.writeEmitter.fire('\\r\\n$ ');\n        } else if (data === '\\x03') { // Ctrl+C\n            this.closeEmitter.fire(0);\n        } else {\n            this.writeEmitter.fire(data);\n        }\n    }\n}\n```\n\n**ANSI Color Support:**\n\n```typescript\nhandleInput(data: string): void {\n    if (data === '\\r') {\n        this.writeEmitter.fire('\\r\\n\\x1b[32mSuccess\\x1b[0m\\r\\n$ ');\n    } else {\n        this.writeEmitter.fire(data);\n    }\n}\n```\n\n**Dimension Handling:**\n\n```typescript\nprivate dimensionsEmitter = new vscode.EventEmitter\u003cvscode.TerminalDimensions\u003e();\nonDidOverrideDimensions = this.dimensionsEmitter.event;\n\nsetDimensions(dimensions: vscode.TerminalDimensions): void {\n    // Extension received resize notification\n    this.sendToRemoteProcess({ type: 'resize', cols: dimensions.columns, rows: dimensions.rows });\n}\n```\n\nThe `onDidWrite` event must fire strings containing terminal escape sequences for cursor control, colors, etc. VS Code writes these directly to xterm.js without interpretation.\n\n### Attachment and Lifecycle\n\nWhen an extension terminal is created, `ExtHostTerminalService.attachPtyToTerminal()` ([src/vs/workbench/api/common/extHostTerminalService.ts:356-429]()) attaches the `Pseudoterminal`:\n\n1. Stores the PTY in `_extHostTerminals` map\n2. Sets up event listeners for `onDidWrite`, `onDidClose`, `onDidOverrideDimensions`, `onDidChangeName`\n3. Configures bidirectional data flow:\n   - Output: `Pseudoterminal.onDidWrite`  `$sendProcessData()`  Main thread  xterm.js\n   - Input: xterm.js  Main thread  `$acceptProcessInput()`  `Pseudoterminal.handleInput()`\n\n**Diagram: Pseudoterminal Bidirectional Data Flow**\n\n```mermaid\nsequenceDiagram\n    participant Pty as Pseudoterminal\u003cbr/\u003e(Extension)\n    participant ExtHostTerminalService as ExtHostTerminalService\n    participant RPC as RPC Layer\n    participant MainThreadTerminalService as MainThreadTerminalService\n    participant Proxy as TerminalProcessExtHostProxy\n    participant Manager as TerminalProcessManager\n    participant Xterm as XtermTerminal.raw\n    participant User as User\n    \n    Note over Pty,Xterm: Output Flow\n    Pty-\u003e\u003ePty: onDidWriteEmitter.fire(\"data\")\n    Pty-\u003e\u003eExtHostTerminalService: onDidWrite event\n    ExtHostTerminalService-\u003e\u003eRPC: $sendProcessData(id, \"data\")\n    RPC-\u003e\u003eMainThreadTerminalService: $sendProcessData()\n    MainThreadTerminalService-\u003e\u003eProxy: emitData(\"data\")\n    Proxy-\u003e\u003eProxy: _onProcessDataEvent.fire({data})\n    Proxy-\u003e\u003eManager: onProcessData event\n    Manager-\u003e\u003eManager: _bufferer.handleData()\n    Manager-\u003e\u003eXterm: write(\"data\")\n    Xterm-\u003e\u003eUser: Display\n    \n    Note over User,Pty: Input Flow\n    User-\u003e\u003eXterm: Type \"ls\"\n    Xterm-\u003e\u003eXterm: raw.onData.fire(\"ls\")\n    Xterm-\u003e\u003eManager: onData event\n    Manager-\u003e\u003eProxy: _process.input(\"ls\")\n    Proxy-\u003e\u003eProxy: _onInputEvent.fire(\"ls\")\n    Proxy-\u003e\u003eMainThreadTerminalService: onInput event listener\n    MainThreadTerminalService-\u003e\u003eRPC: $acceptProcessInput(id, \"ls\")\n    RPC-\u003e\u003eExtHostTerminalService: $acceptProcessInput()\n    ExtHostTerminalService-\u003e\u003eExtHostTerminalService: _extHostTerminals.get(id)\n    ExtHostTerminalService-\u003e\u003ePty: handleInput(\"ls\")\n```\n\nSources: [src/vs/workbench/api/common/extHostTerminalService.ts:356-429](), [src/vs/workbench/api/browser/mainThreadTerminalService.ts:377-486](), [src/vs/workbench/contrib/terminal/browser/terminalProcessExtHostProxy.ts:18-191](), [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts:200-400]()\n\n## Terminal Profile Providers\n\nExtensions can contribute terminal profiles that appear in the terminal profile dropdown by registering a `TerminalProfileProvider` ([src/vscode-dts/vscode.d.ts:11738-11792]()).\n\n### Profile Provider Registration\n\n```typescript\nconst provider: vscode.TerminalProfileProvider = {\n    provideTerminalProfile(token: vscode.CancellationToken): vscode.ProviderResult\u003cvscode.TerminalProfile\u003e {\n        return {\n            options: {\n                name: 'My Custom Shell',\n                pty: createMyPseudoterminal()\n            }\n        };\n    }\n};\n\nvscode.window.registerTerminalProfileProvider('my-extension.custom-profile', provider);\n```\n\nThe registration is handled in `ExtHostTerminalService.registerTerminalProfileProvider()` ([src/vs/workbench/api/common/extHostTerminalService.ts:530-559]()):\n\n1. Stores provider in `_profileProviders` map\n2. Calls `$registerProfileProvider()` to notify main thread\n3. When user selects the profile, main thread calls `$createContributedTerminalProfile()`\n4. Extension host invokes the provider and creates the terminal\n\n### Contributed Profile Lifecycle\n\nThe main thread service coordinates profile contribution through `MainThreadTerminalService.$createContributedTerminalProfile()` ([src/vs/workbench/api/browser/mainThreadTerminalService.ts:270-288]()):\n\n```typescript\npublic async $createContributedTerminalProfile(id: string, options: ICreateContributedTerminalProfileOptions): Promise\u003cvoid\u003e {\n    // Request profile from extension host\n    const profile = await this._terminalProfileService.getContributedProfileProvider(extensionId, id);\n    // Create terminal with profile\n    await this._terminalService.createContributedTerminalProfile(extensionId, id, options);\n}\n```\n\nSources: [src/vs/workbench/api/common/extHostTerminalService.ts:530-559](), [src/vs/workbench/api/browser/mainThreadTerminalService.ts:270-288](), [src/vscode-dts/vscode.d.ts:11738-11792]()\n\n## Terminal State and Events\n\nThe Terminal Extension API provides rich event streams for observing terminal lifecycle and state changes.\n\n### Core Events\n\n| Event | Trigger | Interface |\n|-------|---------|-----------|\n| `onDidOpenTerminal` | Terminal created | `Event\u003cTerminal\u003e` |\n| `onDidCloseTerminal` | Terminal closed | `Event\u003cTerminal\u003e` |\n| `onDidChangeActiveTerminal` | Active terminal changed | `Event\u003cTerminal \\| undefined\u003e` |\n| `onDidChangeTerminalDimensions` | Terminal resized | `Event\u003cTerminalDimensionsChangeEvent\u003e` |\n| `onDidChangeTerminalState` | Terminal state changed | `Event\u003cTerminal\u003e` |\n| `onDidWriteTerminalData` | Data written to terminal | `Event\u003cTerminalDataWriteEvent\u003e` |\n| `onDidExecuteTerminalCommand` | Command executed (shell integration) | `Event\u003cTerminalExecutedCommand\u003e` |\n\n### Event Implementation\n\nEvents are implemented in `ExtHostTerminalService` ([src/vs/workbench/api/common/extHostTerminalService.ts:96-149]()) using `Emitter`:\n\n```typescript\nprivate readonly _onDidOpenTerminal = new Emitter\u003cvscode.Terminal\u003e();\npublic get onDidOpenTerminal(): Event\u003cvscode.Terminal\u003e {\n    return this._onDidOpenTerminal.event;\n}\n\n// Main thread notifies extension host when terminal opens\npublic $acceptTerminalOpened(id: number, extHostTerminalId: string | undefined, name: string, shellLaunchConfigDto: IShellLaunchConfigDto): void {\n    const terminal = this._getTerminalByIdOrCreate(id, extHostTerminalId, name);\n    this._onDidOpenTerminal.fire(terminal);\n}\n```\n\n### Terminal State Object\n\nThe `ExtHostTerminal` class ([src/vs/workbench/api/common/extHostTerminalService.ts:1117-1366]()) represents a terminal instance in the extension host:\n\n```typescript\nexport class ExtHostTerminal implements vscode.Terminal {\n    readonly name: string;\n    readonly processId: Promise\u003cnumber | undefined\u003e;\n    readonly creationOptions: Readonly\u003cvscode.TerminalOptions | vscode.ExtensionTerminalOptions\u003e;\n    readonly exitStatus: vscode.TerminalExitStatus | undefined;\n    readonly state: vscode.TerminalState;\n    \n    sendText(text: string, shouldExecute?: boolean): void;\n    show(preserveFocus?: boolean): void;\n    hide(): void;\n    dispose(): void;\n}\n```\n\nKey state management:\n- `_state`: Tracks `interactedWith` flag for user interaction detection\n- `_exitStatus`: Records exit code and reason when terminal closes\n- `_id`: Unique identifier for RPC communication\n\n**Diagram: Terminal Event Flow**\n\n```mermaid\nsequenceDiagram\n    participant TI as TerminalInstance\n    participant MT as MainThreadTerminalService\n    participant EH as ExtHostTerminalService\n    participant Ext as Extension\n    \n    TI-\u003e\u003eTI: terminal created\n    TI-\u003e\u003eMT: terminal opened event\n    MT-\u003e\u003eEH: $acceptTerminalOpened()\n    EH-\u003e\u003eEH: create/get ExtHostTerminal\n    EH-\u003e\u003eExt: fire onDidOpenTerminal\n    \n    TI-\u003e\u003eTI: user types data\n    TI-\u003e\u003eMT: data input event\n    MT-\u003e\u003eEH: $acceptTerminalInteraction()\n    EH-\u003e\u003eEH: update terminal._state\n    EH-\u003e\u003eExt: fire onDidChangeTerminalState\n    \n    TI-\u003e\u003eTI: process exits\n    TI-\u003e\u003eMT: terminal closed event\n    MT-\u003e\u003eEH: $acceptTerminalClosed()\n    EH-\u003e\u003eEH: set terminal._exitStatus\n    EH-\u003e\u003eExt: fire onDidCloseTerminal\n```\n\nSources: [src/vs/workbench/api/common/extHostTerminalService.ts:96-149](), [src/vs/workbench/api/common/extHostTerminalService.ts:1117-1366](), [src/vs/workbench/api/browser/mainThreadTerminalService.ts:322-376]()\n\n## Shell Integration API\n\nExtensions can access shell integration data when the terminal has shell integration enabled (see [Shell Integration and Capabilities](#8.6)).\n\n### Executed Command Events\n\nThe `onDidExecuteTerminalCommand` event ([src/vscode-dts/vscode.d.ts:12053-12075]()) provides rich command execution information:\n\n```typescript\ninterface TerminalExecutedCommand {\n    terminal: Terminal;\n    commandLine: string | undefined;  // Full command line\n    cwd: Uri | undefined;             // Working directory\n    exitCode: number | undefined;     // Exit code\n    output: string | undefined;       // Command output\n    executedAt: Date;                 // Execution timestamp\n}\n```\n\nThe event is fired by `ExtHostTerminalService.$acceptTerminalCommand()` ([src/vs/workbench/api/common/extHostTerminalService.ts:1044-1070]()):\n\n```typescript\npublic $acceptTerminalCommand(terminalId: number, data: ITerminalCommandDto): void {\n    const terminal = this._getTerminalById(terminalId);\n    if (!terminal) return;\n    \n    const commandEvent: vscode.TerminalExecutedCommand = {\n        terminal,\n        commandLine: data.commandLine,\n        cwd: data.cwd ? URI.revive(data.cwd) : undefined,\n        exitCode: data.exitCode,\n        output: data.output,\n        executedAt: new Date(data.timestamp)\n    };\n    \n    this._onDidExecuteTerminalCommand.fire(commandEvent);\n}\n```\n\n### Terminal Shell Integration Object\n\nWhen shell integration is active, the `Terminal.shellIntegration` property ([src/vscode-dts/vscode.d.ts:12134-12142]()) provides access to execution history and capabilities:\n\n```typescript\ninterface TerminalShellIntegration {\n    cwd: Uri | undefined;\n    executeCommand(commandLine: string): TerminalShellExecutionCommand;\n}\n```\n\nSources: [src/vs/workbench/api/common/extHostTerminalService.ts:1044-1070](), [src/vscode-dts/vscode.d.ts:12053-12142]()\n\n### Attachment and Lifecycle\n\nWhen an extension terminal is created, `ExtHostTerminalService.attachPtyToTerminal()` ([src/vs/workbench/api/common/extHostTerminalService.ts:356-429]()) attaches the `Pseudoterminal`:\n\n1. **Storage**: Stores PTY in `_extHostTerminals: Map\u003cnumber, Pseudoterminal\u003e` keyed by terminal ID\n2. **Event Wiring**: Sets up listeners for `onDidWrite`, `onDidClose`, `onDidOverrideDimensions`, `onDidChangeName`\n3. **Bidirectional Flow**: Configures data flow through `TerminalProcessExtHostProxy` which implements `ITerminalChildProcess`\n\nThe key bridge is `TerminalProcessExtHostProxy` ([src/vs/workbench/contrib/terminal/browser/terminalProcessExtHostProxy.ts:18-191]()), which:\n- Implements `ITerminalChildProcess` interface expected by `TerminalProcessManager`\n- Exposes `onProcessData` event that fires when `emitData()` is called from main thread\n- Calls back to extension host via RPC when `input()` or `resize()` is called\n\n**Diagram: Pseudoterminal Data Flow**\n\n```mermaid\ngraph LR\n    subgraph ExtensionProcess[\"Extension Process\"]\n        Pseudoterminal[\"Pseudoterminal\u003cbr/\u003eonDidWrite: Event\u003cstring\u003e\u003cbr/\u003ehandleInput(data: string)\"]\n        ExtHostTerminalService[\"ExtHostTerminalService\u003cbr/\u003e_extHostTerminals.get(id)\"]\n    end\n    \n    subgraph RPCCalls[\"RPC Method Calls\"]\n        sendProcessData[\"$sendProcessData(id, data)\"]\n        acceptProcessInput[\"$acceptProcessInput(id, data)\"]\n        startExtensionTerminal[\"$startExtensionTerminal(request)\"]\n    end\n    \n    subgraph MainProcess[\"Main Process\"]\n        MainThreadTerminalService[\"MainThreadTerminalService\u003cbr/\u003e_onDidRequestStartExtensionTerminal\"]\n        TerminalProcessExtHostProxy[\"TerminalProcessExtHostProxy\u003cbr/\u003eimplements ITerminalChildProcess\u003cbr/\u003eemitData(data)\u003cbr/\u003einput(data)\"]\n        TerminalProcessManager[\"TerminalProcessManager\u003cbr/\u003e_process.onProcessData\u003cbr/\u003e_process.input()\"]\n        XtermTerminal[\"XtermTerminal\u003cbr/\u003eraw.onData\u003cbr/\u003eraw.write()\"]\n    end\n    \n    Pseudoterminal --\u003e|\"onDidWrite.fire(data)\"| ExtHostTerminalService\n    ExtHostTerminalService --\u003e|\"RPC\"| sendProcessData\n    sendProcessData --\u003e MainThreadTerminalService\n    MainThreadTerminalService --\u003e|\"emitData(data)\"| TerminalProcessExtHostProxy\n    TerminalProcessExtHostProxy --\u003e|\"onProcessData.fire()\"| TerminalProcessManager\n    TerminalProcessManager --\u003e|\"write(data)\"| XtermTerminal\n    \n    XtermTerminal --\u003e|\"raw.onData(data)\"| TerminalProcessManager\n    TerminalProcessManager --\u003e|\"_process.input(data)\"| TerminalProcessExtHostProxy\n    TerminalProcessExtHostProxy --\u003e|\"calls via _terminalService\"| MainThreadTerminalService\n    MainThreadTerminalService --\u003e|\"RPC\"| acceptProcessInput\n    acceptProcessInput --\u003e ExtHostTerminalService\n    ExtHostTerminalService --\u003e|\"handleInput(data)\"| Pseudoterminal\n```\n\nSources: [src/vs/workbench/api/common/extHostTerminalService.ts:356-429](), [src/vs/workbench/contrib/terminal/browser/terminalProcessExtHostProxy.ts:18-191](), [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts:200-400](), [src/vs/workbench/api/browser/mainThreadTerminalService.ts:377-486]()\n\n## Extension Host Architecture\n\nThe Terminal Extension API uses a proxy pattern with RPC communication between the extension host process and the main workbench process.\n\n### ExtHostTerminalService\n\n`ExtHostTerminalService` ([src/vs/workbench/api/common/extHostTerminalService.ts:155-1115]()) is the core extension host implementation.\n\n**Key Data Structures:**\n- `_terminals: ExtHostTerminal[]`: Array of terminal instances visible to extensions\n- `_extHostTerminals: Map\u003cnumber, Pseudoterminal\u003e`: Maps terminal ID to extension-provided PTY\n- `_profileProviders: Map\u003cstring, vscode.TerminalProfileProvider\u003e`: Profile providers by ID\n- `_linkProviders: Map\u003cstring, vscode.TerminalLinkProvider\u003e`: Link providers by ID\n- `_quickFixProviders: Map\u003cstring, vscode.TerminalQuickFixProvider\u003e`: Quick fix providers by ID\n\n**Key Methods:**\n\n| Method | Purpose |\n|--------|---------|\n| `createTerminalFromOptions()` | Create standard terminal |\n| `createExtensionTerminal()` | Create extension terminal with PTY |\n| `attachPtyToTerminal(id, pty)` | Attach `Pseudoterminal` to terminal instance |\n| `registerTerminalProfileProvider()` | Register profile provider |\n| `$acceptTerminalOpened(id, extHostId, name, config)` | Handle terminal opened from main thread |\n| `$acceptTerminalClosed(id, exitCode, exitReason)` | Handle terminal closed from main thread |\n| `$acceptProcessData(id, data)` | Forward process output data to extension |\n| `$acceptProcessInput(id, data)` | Forward user input to extension PTY |\n\n### MainThreadTerminalService\n\n`MainThreadTerminalService` ([src/vs/workbench/api/browser/mainThreadTerminalService.ts:45-573]()) handles the workbench side.\n\n**Key Dependencies:**\n- `ITerminalService`: Core terminal service\n- `ITerminalInstanceService`: Terminal instance creation\n- `ITerminalProfileService`: Profile management\n- `ITerminalGroupService`: Terminal group/panel management\n\n**Key RPC Methods:**\n\n| Method | Purpose |\n|--------|---------|\n| `$createTerminal(id, config)` | Create new terminal instance |\n| `$sendText(id, text, shouldExecute)` | Send text to terminal |\n| `$show(id, preserveFocus)` | Show terminal in UI |\n| `$hide(id)` | Hide terminal from UI |\n| `$dispose(id)` | Dispose terminal |\n| `$sendProcessData(id, data)` | Send data from extension PTY to terminal |\n| `$acceptProcessInput(id, data)` | Forward input to extension PTY |\n\n### TerminalProcessExtHostProxy\n\n`TerminalProcessExtHostProxy` ([src/vs/workbench/contrib/terminal/browser/terminalProcessExtHostProxy.ts:18-191]()) implements `ITerminalChildProcess` to bridge extension-provided PTYs to `TerminalProcessManager`.\n\n**Interface Implementation:**\n\nThe class implements `ITerminalChildProcess` ([src/vs/platform/terminal/common/terminal.ts:700-850]()), which requires:\n\n| Member | Type | Implementation |\n|--------|------|----------------|\n| `id` | `number` | Stored as `readonly id` |\n| `shouldPersist` | `boolean` | Always `false` (extension terminals don't persist) |\n| `onProcessData` | `Event\u003cIProcessDataEvent \\| string\u003e` | Emitter that fires when `emitData()` is called |\n| `onProcessReady` | `Event\u003cIProcessReadyEvent\u003e` | Emitter that fires when `emitReady()` is called |\n| `onProcessExit` | `Event\u003cnumber \\| undefined\u003e` | Emitter that fires when `emitExit()` is called |\n| `start()` | `Promise\u003cITerminalLaunchError \\| undefined\u003e` | Calls `$startExtensionTerminal()` via RPC |\n| `input(data: string)` | `void` | Calls `onInput.fire(data)` which triggers RPC |\n| `resize(cols, rows)` | `void` | Calls `onResize.fire({cols, rows})` which triggers RPC |\n\n**Data Flow Methods:**\n\nCalled by `MainThreadTerminalService` when RPC methods are invoked:\n\n| Method | Called By | Effect |\n|--------|-----------|--------|\n| `emitData(data)` | `$sendProcessData()` | Fires `onProcessData` event  `TerminalProcessManager` |\n| `emitReady(pid, cwd, windowsPty)` | `$sendProcessReady()` | Fires `onProcessReady` event  `TerminalProcessManager` |\n| `emitExit(exitCode)` | `$sendProcessExit()` | Fires `onProcessExit` event  `TerminalProcessManager` |\n| `emitLatency(latency)` | `$sendProcessLatency()` | Updates latency stats |\n\n**Constructor Pattern:**\n\n```typescript\nconstructor(\n    public readonly id: number,\n    cols: number,\n    rows: number,\n    private readonly _terminalService: ITerminalService\n) {\n    this.onInput = this._onInputEvent.event;\n    this.onResize = this._onResizeEvent.event;\n    // ...registers event listeners that call _terminalService methods\n}\n```\n\nThe `_terminalService` dependency is used to fire events back to the main thread service when `input()` or `resize()` is called.\n\nSources: [src/vs/workbench/contrib/terminal/browser/terminalProcessExtHostProxy.ts:18-191](), [src/vs/platform/terminal/common/terminal.ts:700-850](), [src/vs/workbench/api/browser/mainThreadTerminalService.ts:377-486]()\n\u003c/old_str\u003e\n\n\u003cold_str\u003e\n**Diagram: Extension Host Service Architecture**\n\n```mermaid\ngraph TB\n    subgraph \"Extension Process\"\n        ExtAPI[\"vscode.window namespace\"]\n        EHTS[\"ExtHostTerminalService\"]\n        EHT1[\"ExtHostTerminal #1\"]\n        EHT2[\"ExtHostTerminal #2\"]\n        PTY[\"Pseudoterminal impl\"]\n        ProfileProv[\"ProfileProvider impl\"]\n    end\n    \n    subgraph \"RPC Layer\"\n        Proxy[\"MainThreadTerminalServiceShape Proxy\"]\n        RPCChannel[\"RPC Channel\"]\n    end\n    \n    subgraph \"Main Process\"\n        MTTS[\"MainThreadTerminalService\"]\n        ITS[\"ITerminalService\"]\n        ITGS[\"ITerminalGroupService\"]\n        ITPS[\"ITerminalProfileService\"]\n        TI1[\"TerminalInstance #1\"]\n        TI2[\"TerminalInstance #2\"]\n    end\n    \n    ExtAPI --\u003e EHTS\n    EHTS --\u003e EHT1\n    EHTS --\u003e EHT2\n    EHTS --\u003e PTY\n    EHTS --\u003e ProfileProv\n    \n    EHTS \u003c--\u003e Proxy\n    Proxy \u003c--\u003e RPCChannel\n    RPCChannel \u003c--\u003e MTTS\n    \n    MTTS --\u003e ITS\n    MTTS --\u003e ITGS\n    MTTS --\u003e ITPS\n    ITS --\u003e TI1\n    ITS --\u003e TI2\n```\n\nSources: [src/vs/workbench/api/common/extHostTerminalService.ts:155-1115](), [src/vs/workbench/api/browser/mainThreadTerminalService.ts:45-573]()\n\u003c/old_str\u003e\n\u003cnew_str\u003e\n**Diagram: Extension Terminal Complete Lifecycle**\n\n```mermaid\nsequenceDiagram\n    participant Ext as Extension\n    participant ExtHostTerminalService as ExtHostTerminalService\n    participant RPCProxy as RPC\n    participant MainThreadTerminalService as MainThreadTerminalService\n    participant TerminalProcessExtHostProxy as TerminalProcessExtHostProxy\n    participant TerminalProcessManager as TerminalProcessManager\n    \n    Ext-\u003e\u003eExtHostTerminalService: createTerminal({pty})\n    ExtHostTerminalService-\u003e\u003eExtHostTerminalService: new ExtHostTerminal(id)\n    ExtHostTerminalService-\u003e\u003eExtHostTerminalService: attachPtyToTerminal(id, pty)\n    ExtHostTerminalService-\u003e\u003eRPCProxy: $createTerminal(id, {customPtyImplementation: true})\n    RPCProxy-\u003e\u003eMainThreadTerminalService: $createTerminal()\n    MainThreadTerminalService-\u003e\u003eMainThreadTerminalService: createTerminal(shellLaunchConfig)\n    \n    Note over MainThreadTerminalService: Terminal creation triggers start request\n    MainThreadTerminalService-\u003e\u003eMainThreadTerminalService: onDidRequestStartExtensionTerminal.fire()\n    MainThreadTerminalService-\u003e\u003eRPCProxy: $startExtensionTerminal(request)\n    RPCProxy-\u003e\u003eExtHostTerminalService: $startExtensionTerminal()\n    ExtHostTerminalService-\u003e\u003eExt: pty.open(initialDimensions)\n    ExtHostTerminalService-\u003e\u003eRPCProxy: $sendProcessReady(id, pid, cwd)\n    RPCProxy-\u003e\u003eMainThreadTerminalService: $sendProcessReady()\n    MainThreadTerminalService-\u003e\u003eTerminalProcessExtHostProxy: emitReady(pid, cwd)\n    TerminalProcessExtHostProxy-\u003e\u003eTerminalProcessManager: onProcessReady.fire()\n    \n    Note over Ext,TerminalProcessManager: Data flow established\n    \n    Ext-\u003e\u003eExt: pty.onDidWrite.fire(data)\n    Ext-\u003e\u003eExtHostTerminalService: (event handler)\n    ExtHostTerminalService-\u003e\u003eRPCProxy: $sendProcessData(id, data)\n    RPCProxy-\u003e\u003eMainThreadTerminalService: $sendProcessData()\n    MainThreadTerminalService-\u003e\u003eTerminalProcessExtHostProxy: emitData(data)\n    TerminalProcessExtHostProxy-\u003e\u003eTerminalProcessManager: onProcessData.fire()\n```\n\nSources: [src/vs/workbench/api/common/extHostTerminalService.ts:289-429](), [src/vs/workbench/api/browser/mainThreadTerminalService.ts:139-191](), [src/vs/workbench/api/browser/mainThreadTerminalService.ts:377-486](), [src/vs/workbench/contrib/terminal/browser/terminalProcessExtHostProxy.ts:18-191]()\n\n## RPC Protocol\n\nCommunication between extension host and main thread uses the RPC protocol defined in `extHost.protocol.ts`.\n\n### Protocol Interfaces\n\n**ExtHostTerminalServiceShape** ([src/vs/workbench/api/common/extHost.protocol.ts:802-848]()) - Extension host methods callable from main thread:\n\n```typescript\nexport interface ExtHostTerminalServiceShape {\n    $acceptTerminalOpened(id: number, extHostTerminalId: string, name: string, config: IShellLaunchConfigDto): void;\n    $acceptTerminalClosed(id: number, exitCode: number, exitReason: TerminalExitReason): void;\n    $acceptTerminalProcessId(id: number, processId: number): void;\n    $acceptTerminalProcessData(id: number, data: string): void;\n    $acceptTerminalDimensions(id: number, cols: number, rows: number): void;\n    $acceptActiveTerminalChanged(id: number | null): void;\n    $acceptTerminalInteraction(id: number): void;\n    $acceptTerminalCommand(terminalId: number, command: ITerminalCommandDto): void;\n    $createContributedTerminalProfile(id: string, options: ICreateContributedTerminalProfileOptions): Promise\u003cvoid\u003e;\n    $acceptProcessInput(id: number, data: string): void;\n    // ... more methods\n}\n```\n\n**MainThreadTerminalServiceShape** ([src/vs/workbench/api/common/extHost.protocol.ts:590-652]()) - Main thread methods callable from extension host:\n\n```typescript\nexport interface MainThreadTerminalServiceShape extends IDisposable {\n    $createTerminal(id: ExtHostTerminalIdentifier, config: TerminalLaunchConfig): Promise\u003cvoid\u003e;\n    $dispose(id: ExtHostTerminalIdentifier): void;\n    $hide(id: ExtHostTerminalIdentifier): void;\n    $sendText(id: ExtHostTerminalIdentifier, text: string, shouldExecute: boolean): void;\n    $show(id: ExtHostTerminalIdentifier, preserveFocus: boolean): void;\n    $startSendingDataEvents(): void;\n    $stopSendingDataEvents(): void;\n    $registerProcessSupport(isSupported: boolean): void;\n    $registerProfileProvider(id: string, extensionIdentifier: string): void;\n    $unregisterProfileProvider(id: string): void;\n    $registerQuickFixProvider(id: string, extensionId: string): void;\n    $unregisterQuickFixProvider(id: string): void;\n    // ... more methods\n}\n```\n\n### Data Transfer Objects\n\n**IShellLaunchConfigDto** ([src/vs/workbench/api/common/extHost.protocol.ts:774-800]()): Serializable terminal launch configuration\n\n**TerminalLaunchConfig**: Discriminated union for different terminal types:\n- `{ id: ExtHostTerminalIdentifier; shellLaunchConfig: IShellLaunchConfigDto }` - Standard terminal\n- `{ id: string; name: string; pty: vscode.Pseudoterminal }` - Extension terminal\n\n**ITerminalDimensionsDto** ([src/vs/workbench/api/common/extHost.protocol.ts:850-853]()): Terminal dimensions\n\n**ITerminalCommandDto**: Command execution data for shell integration events\n\n### Communication Patterns\n\n**Pattern 1: Extension PTY Output to Terminal Display**\n\n```mermaid\nsequenceDiagram\n    participant Pseudoterminal as Pseudoterminal (ext)\n    participant ExtHostTerminalService as ExtHostTerminalService\n    participant MainThreadTerminalService as MainThreadTerminalService\n    participant TerminalProcessExtHostProxy as TerminalProcessExtHostProxy\n    participant TerminalProcessManager as TerminalProcessManager\n    participant XtermTerminal as XtermTerminal.raw\n    \n    Pseudoterminal-\u003e\u003ePseudoterminal: onDidWrite.fire(\"output\\r\\n\")\n    Note over Pseudoterminal,ExtHostTerminalService: Event listener attached in attachPtyToTerminal()\n    Pseudoterminal-\u003e\u003eExtHostTerminalService: (via event listener)\n    ExtHostTerminalService-\u003e\u003eMainThreadTerminalService: $sendProcessData(id, \"output\\r\\n\")\n    MainThreadTerminalService-\u003e\u003eTerminalProcessExtHostProxy: emitData(\"output\\r\\n\")\n    TerminalProcessExtHostProxy-\u003e\u003eTerminalProcessExtHostProxy: _onProcessDataEvent.fire({data: \"output\\r\\n\"})\n    TerminalProcessExtHostProxy-\u003e\u003eTerminalProcessManager: onProcessData event\n    TerminalProcessManager-\u003e\u003eTerminalProcessManager: handleProcessData()\n    TerminalProcessManager-\u003e\u003eXtermTerminal: write(\"output\\r\\n\")\n```\n\n**Pattern 2: User Input to Extension PTY**\n\n```mermaid\nsequenceDiagram\n    participant User as User\n    participant XtermTerminal as XtermTerminal.raw\n    participant TerminalProcessManager as TerminalProcessManager\n    participant TerminalProcessExtHostProxy as TerminalProcessExtHostProxy\n    participant MainThreadTerminalService as MainThreadTerminalService\n    participant ExtHostTerminalService as ExtHostTerminalService\n    participant Pseudoterminal as Pseudoterminal (ext)\n    \n    User-\u003e\u003eXtermTerminal: types \"ls\"\n    XtermTerminal-\u003e\u003eXtermTerminal: raw.onData.fire(\"ls\")\n    XtermTerminal-\u003e\u003eTerminalProcessManager: (via event listener)\n    TerminalProcessManager-\u003e\u003eTerminalProcessExtHostProxy: _process.input(\"ls\")\n    TerminalProcessExtHostProxy-\u003e\u003eTerminalProcessExtHostProxy: _onInputEvent.fire(\"ls\")\n    Note over TerminalProcessExtHostProxy,MainThreadTerminalService: Event listener registered in constructor\n    TerminalProcessExtHostProxy-\u003e\u003eMainThreadTerminalService: onInput event\n    MainThreadTerminalService-\u003e\u003eExtHostTerminalService: $acceptProcessInput(id, \"ls\")\n    ExtHostTerminalService-\u003e\u003eExtHostTerminalService: _extHostTerminals.get(id)\n    ExtHostTerminalService-\u003e\u003ePseudoterminal: pty.handleInput?.(\"ls\")\n```\n\nSources: [src/vs/workbench/api/common/extHostTerminalService.ts:356-429](), [src/vs/workbench/api/browser/mainThreadTerminalService.ts:377-486](), [src/vs/workbench/contrib/terminal/browser/terminalProcessExtHostProxy.ts:18-191](), [src/vs/workbench/contrib/terminal/browser/terminalProcessManager.ts:200-400]()\n\n## Advanced Features\n\n### Terminal Links\n\nExtensions can register link providers to detect and handle custom links in terminal output using `registerTerminalLinkProvider()` ([src/vscode-dts/vscode.d.ts:11877-12023]()):\n\n```typescript\ninterface TerminalLinkProvider\u003cT extends TerminalLink\u003e {\n    provideTerminalLinks(context: TerminalLinkContext, token: CancellationToken): \n        ProviderResult\u003cT[]\u003e;\n    handleTerminalLink(link: T): ProviderResult\u003cvoid\u003e;\n}\n```\n\nImplementation in `ExtHostTerminalService.registerTerminalLinkProvider()` ([src/vs/workbench/api/common/extHostTerminalService.ts:571-590]()).\n\n### Terminal Quick Fixes\n\nExtensions can provide quick fix suggestions for terminal output using `registerTerminalQuickFixProvider()` ([src/vs/workbench/api/common/extHostTerminalService.ts:592-637]()):\n\n```typescript\ninterface TerminalQuickFixProvider {\n    provideTerminalQuickFixes(\n        context: TerminalQuickFixContext,\n        token: CancellationToken\n    ): ProviderResult\u003cTerminalQuickFix[]\u003e;\n}\n```\n\nQuick fixes can execute commands, open URLs, or run terminal commands in response to specific terminal output patterns.\n\n### Environment Variable Mutations\n\nExtensions can modify environment variables for all terminals through `EnvironmentVariableCollection` ([src/vscode-dts/vscode.d.ts:11813-11845]()):\n\n```typescript\nconst collection = context.environmentVariableCollection;\ncollection.replace('PATH', '/custom/path:${env:PATH}');\ncollection.prepend('MY_VAR', 'prefix_');\ncollection.append('MY_VAR', '_suffix');\n```\n\nThe collection is serialized and sent to the main thread via `$setEnvironmentVariableCollection()` ([src/vs/workbench/api/common/extHostTerminalService.ts:1095-1103]()).\n\nSources: [src/vs/workbench/api/common/extHostTerminalService.ts:571-637](), [src/vscode-dts/vscode.d.ts:11813-12023]()"])</script><script>self.__next_f.push([1,"39:T66ed,"])</script><script>self.__next_f.push([1,"# Chat and AI Integration\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [src/vs/workbench/api/browser/mainThreadChatAgents2.ts](src/vs/workbench/api/browser/mainThreadChatAgents2.ts)\n- [src/vs/workbench/api/common/extHostChatAgents2.ts](src/vs/workbench/api/common/extHostChatAgents2.ts)\n- [src/vs/workbench/contrib/chat/browser/actions/chatActions.ts](src/vs/workbench/contrib/chat/browser/actions/chatActions.ts)\n- [src/vs/workbench/contrib/chat/browser/actions/chatExecuteActions.ts](src/vs/workbench/contrib/chat/browser/actions/chatExecuteActions.ts)\n- [src/vs/workbench/contrib/chat/browser/agentSessions/localAgentSessionsProvider.ts](src/vs/workbench/contrib/chat/browser/agentSessions/localAgentSessionsProvider.ts)\n- [src/vs/workbench/contrib/chat/browser/chat.contribution.ts](src/vs/workbench/contrib/chat/browser/chat.contribution.ts)\n- [src/vs/workbench/contrib/chat/browser/chat.ts](src/vs/workbench/contrib/chat/browser/chat.ts)\n- [src/vs/workbench/contrib/chat/common/constants.ts](src/vs/workbench/contrib/chat/common/constants.ts)\n- [src/vs/workbench/contrib/chat/test/common/voiceChatService.test.ts](src/vs/workbench/contrib/chat/test/common/voiceChatService.test.ts)\n- [src/vs/workbench/services/chat/common/chatEntitlementService.ts](src/vs/workbench/services/chat/common/chatEntitlementService.ts)\n- [src/vscode-dts/vscode.proposed.chatParticipantAdditions.d.ts](src/vscode-dts/vscode.proposed.chatParticipantAdditions.d.ts)\n- [src/vscode-dts/vscode.proposed.defaultChatParticipant.d.ts](src/vscode-dts/vscode.proposed.defaultChatParticipant.d.ts)\n\n\u003c/details\u003e\n\n\n\nThis document describes the chat and AI integration system in VS Code, which provides a conversational interface for AI-powered assistance. The system enables both built-in and extension-contributed chat participants (agents) to respond to user queries with streaming responses, tool invocations, and rich UI elements.\n\nFor information about the Extension System architecture that enables chat participants, see [Extension System](#5). For details about language models and tools, see the Language Model and Tools documentation.\n\n## Overview and Architecture\n\nThe chat system is organized into several layers: core services for session management, widget components for UI rendering, an agent system for handling requests, and an RPC-based extension API for third-party participants.\n\n```mermaid\ngraph TB\n    subgraph \"UI Layer\"\n        ChatWidget[\"ChatWidget\"]\n        ChatInputPart[\"ChatInputPart\"]\n        QuickChat[\"QuickChatService\"]\n        ChatEditor[\"ChatEditor\"]\n    end\n    \n    subgraph \"Service Layer\"\n        ChatService[\"IChatService\u003cbr/\u003e(ChatService)\"]\n        ChatWidgetService[\"IChatWidgetService\u003cbr/\u003e(ChatWidgetService)\"]\n        ChatAgentService[\"IChatAgentService\u003cbr/\u003e(ChatAgentService)\"]\n        ChatModeService[\"IChatModeService\u003cbr/\u003e(ChatModeService)\"]\n        ChatSessionsService[\"IChatSessionsService\"]\n    end\n    \n    subgraph \"Extension Integration\"\n        ExtHostChatAgents[\"ExtHostChatAgents2\"]\n        MainThreadChatAgents[\"MainThreadChatAgents2\"]\n        ExtensionAPI[\"vscode.chat API\"]\n    end\n    \n    subgraph \"Supporting Services\"\n        ChatEntitlementService[\"IChatEntitlementService\u003cbr/\u003e(ChatEntitlementService)\"]\n        LanguageModelsService[\"ILanguageModelsService\"]\n        LanguageModelToolsService[\"ILanguageModelToolsService\"]\n        VoiceChatService[\"IVoiceChatService\u003cbr/\u003e(VoiceChatService)\"]\n    end\n    \n    ChatWidget --\u003e ChatWidgetService\n    ChatWidget --\u003e ChatInputPart\n    ChatInputPart --\u003e ChatAgentService\n    \n    ChatWidgetService --\u003e ChatService\n    ChatService --\u003e ChatAgentService\n    ChatService --\u003e ChatSessionsService\n    \n    ChatAgentService --\u003e MainThreadChatAgents\n    MainThreadChatAgents \u003c--\u003e|\"RPC Protocol\"| ExtHostChatAgents\n    ExtHostChatAgents --\u003e ExtensionAPI\n    \n    ChatService --\u003e LanguageModelsService\n    ChatAgentService --\u003e LanguageModelToolsService\n    ChatWidget --\u003e VoiceChatService\n    \n    ChatService --\u003e ChatEntitlementService\n    ChatModeService --\u003e ChatAgentService\n```\n\n**Sources:**\n- [src/vs/workbench/contrib/chat/browser/chat.contribution.ts:34-138]()\n- [src/vs/workbench/contrib/chat/browser/chat.ts:52-98]()\n- [src/vs/workbench/contrib/chat/common/constants.ts:1-143]()\n\n## Core Services\n\n### IChatService and Session Management\n\n`IChatService` is the central service responsible for managing chat sessions, requests, and responses. It maintains the lifecycle of chat conversations and coordinates between agents and the UI.\n\n```mermaid\ngraph LR\n    IChatService[\"IChatService\u003cbr/\u003e(ChatService)\"]\n    IChatModel[\"IChatModel\"]\n    IChatRequestModel[\"IChatRequestModel\"]\n    IChatResponseModel[\"IChatResponseModel\"]\n    ChatSessionsService[\"IChatSessionsService\"]\n    \n    IChatService --\u003e|\"creates/manages\"| IChatModel\n    IChatModel --\u003e|\"contains\"| IChatRequestModel\n    IChatModel --\u003e|\"contains\"| IChatResponseModel\n    IChatService --\u003e ChatSessionsService\n    \n    IChatService --\u003e|\"startSession()\"| IChatModel\n    IChatService --\u003e|\"sendRequest()\"| IChatResponseModel\n    IChatService --\u003e|\"getSession()\"| IChatModel\n```\n\nKey responsibilities:\n- **Session lifecycle**: Creating, retrieving, and disposing chat sessions via `startSession()`, `getSession()`, and `onDidDisposeSession`\n- **Request handling**: Sending requests through `sendRequest()` and managing request state\n- **History management**: Maintaining conversation history through `IChatModel` which contains request/response pairs\n- **Transfer operations**: Moving sessions between workspaces via `transferChatSession()`\n\n**Sources:**\n- [src/vs/workbench/contrib/chat/browser/chat.contribution.ts:42]()\n- [src/vs/workbench/contrib/chat/browser/actions/chatActions.ts:179-190]()\n\n### IChatAgentService and Participant Management\n\n`IChatAgentService` manages the registry of chat participants (agents), handles agent invocation, and coordinates agent lifecycle. Agents can be statically registered via package.json or dynamically registered at runtime.\n\n```mermaid\ngraph TB\n    IChatAgentService[\"IChatAgentService\"]\n    IChatAgent[\"IChatAgent\"]\n    IChatAgentImplementation[\"IChatAgentImplementation\"]\n    IChatAgentData[\"IChatAgentData\"]\n    ExtHostChatAgents[\"ExtHostChatAgents2\"]\n    \n    IChatAgentService --\u003e|\"getAgent(id)\"| IChatAgentData\n    IChatAgentService --\u003e|\"getAgents()\"| IChatAgent\n    IChatAgentService --\u003e|\"invokeAgent()\"| IChatAgentImplementation\n    IChatAgentService --\u003e|\"registerAgentImplementation()\"| IChatAgentImplementation\n    \n    ExtHostChatAgents --\u003e|\"$registerAgent()\"| IChatAgentService\n    \n    IChatAgentData --\u003e|\"metadata\"| IChatAgent\n    IChatAgent --\u003e|\"implementation\"| IChatAgentImplementation\n    IChatAgentImplementation --\u003e|\"invoke()\u003cbr/\u003eprovideFollowups()\u003cbr/\u003eprovideChatTitle()\"| Response[\"Promise\u003cIChatAgentResult\u003e\"]\n```\n\n**Sources:**\n- [src/vs/workbench/contrib/chat/browser/chat.contribution.ts:34]()\n- [src/vs/workbench/api/browser/mainThreadChatAgents2.ts:168-249]()\n\n### IChatWidgetService\n\n`IChatWidgetService` manages chat widget instances across different locations (panel, editor, quick chat) and provides methods for revealing and accessing widgets.\n\nKey methods:\n- `lastFocusedWidget`: Returns the most recently focused widget\n- `revealWidget()`: Reveals and optionally focuses the last active widget\n- `openSession(sessionResource, target)`: Opens a chat session in a specific target location\n- `getWidgetBySessionResource(uri)`: Retrieves widget displaying a specific session\n\n**Sources:**\n- [src/vs/workbench/contrib/chat/browser/chat.ts:52-98]()\n- [src/vs/workbench/contrib/chat/browser/actions/chatActions.ts:180-196]()\n\n## Chat Widget Architecture\n\n### ChatWidget Component\n\n`ChatWidget` is the primary UI component that renders chat conversations, manages input, and coordinates user interactions. It can be hosted in various locations: sidebar panel, editor, or quick chat overlay.\n\n```mermaid\ngraph TB\n    ChatWidget[\"ChatWidget\"]\n    ChatInputPart[\"ChatInputPart\"]\n    ChatListRenderer[\"Chat List Renderer\"]\n    ChatAttachmentModel[\"ChatAttachmentModel\"]\n    ChatViewModel[\"IChatViewModel\"]\n    \n    ChatWidget --\u003e|\"input\"| ChatInputPart\n    ChatWidget --\u003e|\"attachmentModel\"| ChatAttachmentModel\n    ChatWidget --\u003e|\"viewModel\"| ChatViewModel\n    ChatWidget --\u003e|\"renders list\"| ChatListRenderer\n    \n    ChatInputPart --\u003e|\"currentModeObs\"| ChatMode[\"IChatMode\"]\n    ChatInputPart --\u003e|\"openModePicker()\"| ModePicker[\"Mode Picker\"]\n    ChatInputPart --\u003e|\"openModelPicker()\"| ModelPicker[\"Model Picker\"]\n    \n    ChatWidget --\u003e|\"acceptInput()\"| IChatService\n    ChatWidget --\u003e|\"setInput()\u003cbr/\u003egetInput()\"| InputManagement[\"Input Management\"]\n```\n\nKey properties and methods:\n- `input`: Instance of `ChatInputPart` managing user input and attachments\n- `viewModel`: `IChatViewModel` containing the session data and UI state\n- `acceptInput(query?, options?)`: Submits the current input as a chat request\n- `setInput(query?)` / `getInput()`: Manages the input field content\n- `focusInput()` / `focusResponseItem()`: Controls focus within the widget\n- `parsedInput`: `IParsedChatRequest` containing the parsed agent, command, and text\n- `attachmentModel`: Manages file attachments and context items\n\n**Sources:**\n- [src/vs/workbench/contrib/chat/browser/chat.ts:250-311]()\n- [src/vs/workbench/contrib/chat/browser/actions/chatExecuteActions.ts:46-147]()\n\n### Chat Locations and Context\n\nChat widgets can appear in different locations, each with specific behavior:\n\n| Location | Value | Description |\n|----------|-------|-------------|\n| `ChatAgentLocation.Chat` | `'panel'` | Main chat view (sidebar, editor, quick chat) |\n| `ChatAgentLocation.Terminal` | `'terminal'` | Terminal-specific chat |\n| `ChatAgentLocation.Notebook` | `'notebook'` | Notebook cell chat |\n| `ChatAgentLocation.EditorInline` | `'editor'` | Inline chat in text editors |\n\n**Sources:**\n- [src/vs/workbench/contrib/chat/common/constants.ts:77-103]()\n- [src/vs/workbench/contrib/chat/browser/chat.ts:260]()\n\n### Quick Chat Service\n\n`IQuickChatService` provides a lightweight overlay chat interface that can be toggled without opening the full chat view.\n\n```mermaid\ngraph LR\n    IQuickChatService[\"IQuickChatService\"]\n    \n    IQuickChatService --\u003e|\"toggle(options)\"| QuickChatUI[\"Quick Chat Overlay\"]\n    IQuickChatService --\u003e|\"open(options)\"| QuickChatUI\n    IQuickChatService --\u003e|\"openInChatView()\"| ChatView[\"Main Chat View\"]\n    \n    IQuickChatService --\u003e|\"focused: boolean\"| FocusState\n    IQuickChatService --\u003e|\"sessionResource?: URI\"| SessionResource\n    IQuickChatService --\u003e|\"onDidClose\"| CloseEvent\n```\n\n**Sources:**\n- [src/vs/workbench/contrib/chat/browser/chat.ts:102-115]()\n- [src/vs/workbench/contrib/chat/browser/actions/chatActions.ts:461-495]()\n\n## Chat Agents (Participants)\n\n### Agent Registration and Implementation\n\nChat agents (also called participants) can be registered through the extension API. The registration flows from the extension host through the RPC protocol to the main thread.\n\n```mermaid\nsequenceDiagram\n    participant Ext as Extension\n    participant ExtHost as ExtHostChatAgents2\n    participant Proxy as RPC Protocol\n    participant MainThread as MainThreadChatAgents2\n    participant AgentService as IChatAgentService\n    \n    Ext-\u003e\u003eExtHost: createChatAgent(id, handler)\n    ExtHost-\u003e\u003eExtHost: Create ExtHostChatAgent\n    ExtHost-\u003e\u003eProxy: $registerAgent(handle, id, metadata)\n    Proxy-\u003e\u003eMainThread: $registerAgent(handle, id, metadata)\n    MainThread-\u003e\u003eAgentService: registerAgentImplementation(id, impl)\n    AgentService--\u003e\u003eMainThread: IDisposable\n    MainThread--\u003e\u003eProxy: Success\n    Proxy--\u003e\u003eExtHost: Success\n    ExtHost--\u003e\u003eExt: ChatParticipant API object\n```\n\n**Agent Implementation Interface** (`IChatAgentImplementation`):\n- `invoke(request, progress, history, token)`: Handles the agent request and reports progress\n- `setRequestTools(requestId, tools)`: Updates which tools are enabled for a request\n- `provideFollowups(request, result, history, token)`: Provides suggested follow-up questions\n- `provideChatTitle(history, token)`: Generates a title for the conversation\n- `provideChatSummary(history, token)`: Provides a summary of the conversation\n\n**Sources:**\n- [src/vs/workbench/api/common/extHostChatAgents2.ts:462-478]()\n- [src/vs/workbench/api/browser/mainThreadChatAgents2.ts:182-211]()\n\n### Agent Request Flow\n\nWhen a user submits a chat request, it flows through several layers before reaching the agent implementation:\n\n```mermaid\nsequenceDiagram\n    participant User\n    participant ChatWidget\n    participant ChatService as IChatService\n    participant AgentService as IChatAgentService\n    participant MainThread as MainThreadChatAgents2\n    participant ExtHost as ExtHostChatAgents2\n    participant Extension\n    \n    User-\u003e\u003eChatWidget: acceptInput()\n    ChatWidget-\u003e\u003eChatService: sendRequest(sessionResource, request)\n    ChatService-\u003e\u003eAgentService: invokeAgent(id, request, progress, history)\n    AgentService-\u003e\u003eMainThread: invoke(request, progress, history, token)\n    MainThread-\u003e\u003eExtHost: $invokeAgent(handle, request, context, token)\n    ExtHost-\u003e\u003eExtension: handler(request, context, response, token)\n    Extension--\u003e\u003eExtHost: streaming progress\n    ExtHost--\u003e\u003eMainThread: $handleProgressChunk(requestId, chunks)\n    MainThread--\u003e\u003eAgentService: progress(parts)\n    AgentService--\u003e\u003eChatService: IChatAgentResult\n    ChatService--\u003e\u003eChatWidget: IChatResponseModel\n    ChatWidget--\u003e\u003eUser: Render response\n```\n\n**Sources:**\n- [src/vs/workbench/contrib/chat/browser/actions/chatExecuteActions.ts:46-147]()\n- [src/vs/workbench/api/browser/mainThreadChatAgents2.ts:182-194]()\n- [src/vs/workbench/api/common/extHostChatAgents2.ts:623-756]()\n\n### Response Streaming\n\nAgents stream responses through the `ChatResponseStream` API, which supports various content types:\n\n```mermaid\ngraph TB\n    ChatResponseStream[\"ChatResponseStream API\"]\n    \n    ChatResponseStream --\u003e|\"markdown(value)\"| MarkdownPart[\"ChatResponseMarkdownPart\"]\n    ChatResponseStream --\u003e|\"anchor(value, title)\"| AnchorPart[\"ChatResponseAnchorPart\"]\n    ChatResponseStream --\u003e|\"button(command)\"| ButtonPart[\"ChatResponseCommandButtonPart\"]\n    ChatResponseStream --\u003e|\"progress(value, task)\"| ProgressPart[\"ChatResponseProgressPart\"]\n    ChatResponseStream --\u003e|\"reference(uri)\"| ReferencePart[\"ChatResponseReferencePart\"]\n    ChatResponseStream --\u003e|\"textEdit(uri, edits)\"| TextEditPart[\"ChatResponseTextEditPart\"]\n    ChatResponseStream --\u003e|\"confirmation(title, msg)\"| ConfirmationPart[\"ChatResponseConfirmationPart\"]\n    ChatResponseStream --\u003e|\"beginToolInvocation()\"| ToolPart[\"ChatToolInvocationPart\"]\n    \n    MarkdownPart --\u003e ExtHost[\"ExtHostChatAgents2\"]\n    AnchorPart --\u003e ExtHost\n    ButtonPart --\u003e ExtHost\n    ProgressPart --\u003e ExtHost\n    ReferencePart --\u003e ExtHost\n    TextEditPart --\u003e ExtHost\n    ConfirmationPart --\u003e ExtHost\n    ToolPart --\u003e ExtHost\n    \n    ExtHost --\u003e|\"$handleProgressChunk()\"| MainThread[\"MainThreadChatAgents2\"]\n    MainThread --\u003e|\"progress()\"| ChatWidget[\"ChatWidget rendering\"]\n```\n\n**Sources:**\n- [src/vs/workbench/api/common/extHostChatAgents2.ts:43-397]()\n- [src/vs/workbench/api/browser/mainThreadChatAgents2.ts:262-474]()\n- [src/vscode-dts/vscode.proposed.chatParticipantAdditions.d.ts:182-374]()\n\n## Extension API\n\n### ChatParticipant Registration\n\nExtensions register chat participants using the `vscode.chat` namespace:\n\n**API Structure:**\n- `vscode.chat.createChatParticipant(id, handler)`: Creates a new chat participant\n- `ChatParticipant`: API object with properties like `iconPath`, `followupProvider`, `titleProvider`\n- `ChatRequest`: Represents an incoming request with `prompt`, `command`, `variables`, and `tools`\n- `ChatResponseStream`: API for streaming response parts back to the UI\n\n**Participant Handler:**\n```\n(request: ChatRequest, context: ChatContext, response: ChatResponseStream, token: CancellationToken) \n    =\u003e ProviderResult\u003cChatResult\u003e\n```\n\n**Sources:**\n- [src/vs/workbench/api/common/extHostChatAgents2.ts:462-478]()\n- [src/vscode-dts/vscode.proposed.chatParticipantAdditions.d.ts:6-42]()\n\n### Tools and Context\n\nChat participants can reference language model tools and receive context:\n\n```mermaid\ngraph TB\n    ChatRequest[\"ChatRequest\"]\n    \n    ChatRequest --\u003e|\"tools: Map\u003cstring, boolean\u003e\"| ToolsMap[\"Tool Enable/Disable Map\"]\n    ChatRequest --\u003e|\"variables\"| Variables[\"ChatRequestVariables\"]\n    ChatRequest --\u003e|\"toolInvocationToken\"| TokenMgmt[\"Tool Invocation Token\"]\n    \n    Variables --\u003e|\"variables: Array\"| VarArray[\"Variable Entries\"]\n    \n    OnDidChangeChatRequestTools[\"lm.onDidChangeChatRequestTools\"] --\u003e|\"fires when tools change\"| ToolUpdate[\"Tool Update Event\"]\n    \n    LanguageModelToolsService[\"ILanguageModelToolsService\"] --\u003e|\"getTool(id)\"| ToolInfo[\"Tool Information\"]\n    LanguageModelToolsService --\u003e|\"invokeTool()\"| ToolExecution[\"Tool Execution\"]\n```\n\n**Sources:**\n- [src/vscode-dts/vscode.proposed.chatParticipantAdditions.d.ts:419-432]()\n- [src/vs/workbench/api/common/extHostChatAgents2.ts:427-431]()\n\n## Chat Modes\n\nChat operates in different modes that determine the available functionality and agent behavior:\n\n### Mode Types\n\n```mermaid\ngraph LR\n    ChatModeKind[\"ChatModeKind enum\"]\n    \n    ChatModeKind --\u003e|\"Ask\"| AskMode[\"Ask Mode\u003cbr/\u003eGeneral Q\u0026A\"]\n    ChatModeKind --\u003e|\"Edit\"| EditMode[\"Edit Mode\u003cbr/\u003eCode editing\"]\n    ChatModeKind --\u003e|\"Agent\"| AgentMode[\"Agent Mode\u003cbr/\u003eAgentic actions\"]\n    \n    AskMode --\u003e|\"ChatSubmitAction\"| SubmitButton[\"Send Button\"]\n    EditMode --\u003e|\"ChatEditingSessionSubmitAction\"| EditSubmit[\"Edit Submit\"]\n    AgentMode --\u003e|\"Agent-specific UI\"| AgentUI[\"Agent Controls\"]\n```\n\n**Mode Definitions:**\n- **Ask Mode** (`ChatModeKind.Ask`): Standard question-answering mode with focused responses\n- **Edit Mode** (`ChatModeKind.Edit`): Code editing mode with file modification capabilities\n- **Agent Mode** (`ChatModeKind.Agent`): Autonomous mode where agents can use tools and perform actions\n\n**Sources:**\n- [src/vs/workbench/contrib/chat/common/constants.ts:43-62]()\n- [src/vs/workbench/contrib/chat/browser/actions/chatExecuteActions.ts:151-210]()\n\n### Mode Switching\n\nMode switching is handled through `ToggleChatModeAction` and the mode picker UI:\n\n```mermaid\nsequenceDiagram\n    participant User\n    participant ChatWidget\n    participant ChatInputPart\n    participant ModeService as IChatModeService\n    participant Command as ToggleChatModeAction\n    \n    User-\u003e\u003eChatWidget: Opens mode picker\n    ChatWidget-\u003e\u003eChatInputPart: openModePicker()\n    ChatInputPart-\u003e\u003eModeService: getModes()\n    ModeService--\u003e\u003eChatInputPart: Available modes\n    User-\u003e\u003eCommand: Select new mode\n    Command-\u003e\u003eCommand: handleModeSwitch()\n    Command-\u003e\u003eChatInputPart: setChatMode(modeId)\n    ChatInputPart-\u003e\u003eModeService: findModeById(modeId)\n    ModeService--\u003e\u003eChatInputPart: IChatMode\n    ChatInputPart--\u003e\u003eUser: Mode switched\n```\n\n**Sources:**\n- [src/vs/workbench/contrib/chat/browser/actions/chatExecuteActions.ts:242-328]()\n- [src/vs/workbench/contrib/chat/browser/actions/chatExecuteActions.ts:391-431]()\n\n## Voice Chat Integration\n\n`VoiceChatService` integrates speech-to-text capabilities with chat, enabling voice input with automatic agent and command detection.\n\n```mermaid\ngraph TB\n    VoiceChatService[\"VoiceChatService\u003cbr/\u003e(IVoiceChatService)\"]\n    SpeechService[\"ISpeechService\"]\n    ChatAgentService[\"IChatAgentService\"]\n    \n    VoiceChatService --\u003e|\"createVoiceChatSession()\"| VoiceChatSession[\"Voice Chat Session\"]\n    VoiceChatService --\u003e|\"uses\"| SpeechService\n    VoiceChatService --\u003e|\"agent detection\"| ChatAgentService\n    \n    SpeechService --\u003e|\"createSpeechToTextSession()\"| SpeechSession[\"Speech-to-Text Session\"]\n    SpeechSession --\u003e|\"onDidChange\"| SpeechEvents[\"Speech Events\"]\n    \n    VoiceChatSession --\u003e|\"transforms speech\"| TransformedText[\"Agent/Command Detection\"]\n    TransformedText --\u003e|\"e.g., 'At workspace'  '@workspace'\"| DetectedAgent\n    TransformedText --\u003e|\"e.g., 'slash fix'  '/fix'\"| DetectedCommand\n```\n\n**Voice Detection Rules:**\n- Converts spoken phrases like \"At workspace\" to agent references: `@workspace`\n- Converts \"slash fix\" to slash commands: `/fix`\n- Strips punctuation and handles variations in capitalization\n- Sets `waitingForInput` flag when an agent or command is detected without additional text\n\n**Sources:**\n- [src/vs/workbench/contrib/chat/test/common/voiceChatService.test.ts:19]()\n- [src/vs/workbench/contrib/chat/test/common/voiceChatService.test.ts:141-342]()\n\n## Chat Entitlements and Quotas\n\n### ChatEntitlementService\n\n`IChatEntitlementService` manages user access levels, quotas, and feature availability for chat:\n\n```mermaid\ngraph TB\n    ChatEntitlementService[\"IChatEntitlementService\u003cbr/\u003e(ChatEntitlementService)\"]\n    \n    ChatEntitlementService --\u003e|\"entitlement\"| Entitlement[\"ChatEntitlement enum\"]\n    ChatEntitlementService --\u003e|\"quotas\"| Quotas[\"IQuotas\u003cbr/\u003e(chat, completions)\"]\n    ChatEntitlementService --\u003e|\"sentiment\"| Sentiment[\"IChatSentiment\u003cbr/\u003e(installed, hidden, disabled)\"]\n    ChatEntitlementService --\u003e|\"anonymous\"| Anonymous[\"Anonymous Access\"]\n    \n    Entitlement --\u003e|\"Unknown\"| SignedOut[\"User signed out\"]\n    Entitlement --\u003e|\"Free\"| FreePlan[\"Free tier\"]\n    Entitlement --\u003e|\"Pro\"| ProPlan[\"Pro tier\"]\n    Entitlement --\u003e|\"ProPlus\"| ProPlusPlan[\"Pro Plus tier\"]\n    Entitlement --\u003e|\"Business\"| BusinessPlan[\"Business tier\"]\n    Entitlement --\u003e|\"Enterprise\"| EnterprisePlan[\"Enterprise tier\"]\n    \n    Quotas --\u003e|\"percentRemaining\"| QuotaCheck[\"Quota Exceeded?\"]\n    QuotaCheck --\u003e|\"== 0\"| QuotaExceeded[\"Show upgrade prompt\"]\n```\n\n**Context Keys:**\n- `ChatEntitlementContextKeys.Entitlement.planFree`: True when user has Free plan\n- `ChatEntitlementContextKeys.chatQuotaExceeded`: True when chat quota exhausted\n- `ChatEntitlementContextKeys.completionsQuotaExceeded`: True when completions quota exhausted\n- `ChatEntitlementContextKeys.chatAnonymous`: True for anonymous access\n\n**Sources:**\n- [src/vs/workbench/services/chat/common/chatEntitlementService.ts:67-164]()\n- [src/vs/workbench/services/chat/common/chatEntitlementService.ts:35-65]()\n\n## Actions and Commands\n\n### Primary Chat Actions\n\nKey actions for chat interaction:\n\n| Action ID | Class | Purpose |\n|-----------|-------|---------|\n| `workbench.action.chat.open` | `PrimaryOpenChatGlobalAction` | Opens main chat view |\n| `workbench.action.chat.newChat` | `NewChatEditorAction` | Creates new chat in editor |\n| `workbench.action.chat.submit` | `ChatSubmitAction` | Submits current input |\n| `workbench.action.chat.cancel` | `CancelAction` | Cancels in-progress request |\n| `workbench.action.chat.toggleAgentMode` | `ToggleChatModeAction` | Switches between modes |\n| `workbench.action.chat.openModelPicker` | `OpenModelPickerAction` | Opens model selection |\n| `workbench.action.chat.openModePicker` | `OpenModePickerAction` | Opens agent/mode selection |\n\n**Sources:**\n- [src/vs/workbench/contrib/chat/browser/actions/chatActions.ts:72-80]()\n- [src/vs/workbench/contrib/chat/browser/actions/chatActions.ts:396-495]()\n- [src/vs/workbench/contrib/chat/browser/actions/chatExecuteActions.ts:151-209]()\n\n### Chat View Opening Options\n\nThe `OpenChatGlobalAction` and related actions support rich options for opening chat:\n\n```\ninterface IChatViewOpenOptions {\n    query: string;                    // Initial query text\n    isPartialQuery?: boolean;         // Whether input is partial\n    toolIds?: string[];               // Tool IDs to attach\n    previousRequests?: IChatViewOpenRequestEntry[];  // History to prepopulate\n    attachScreenshot?: boolean;       // Attach window screenshot\n    attachFiles?: (URI | { uri: URI; range: IRange })[];  // Files to attach\n    mode?: ChatModeKind | string;     // Mode to open in\n    modelSelector?: ILanguageModelChatSelector;  // Model to use\n    blockOnResponse?: boolean;        // Wait for response completion\n}\n```\n\n**Sources:**\n- [src/vs/workbench/contrib/chat/browser/actions/chatActions.ts:82-156]()\n- [src/vs/workbench/contrib/chat/browser/actions/chatActions.ts:176-361]()\n\n## Session Management\n\n### Chat Session Providers\n\nChat sessions can be provided by different providers, enabling various backend implementations:\n\n```mermaid\ngraph TB\n    IChatSessionsService[\"IChatSessionsService\"]\n    IChatSessionItemProvider[\"IChatSessionItemProvider\"]\n    \n    IChatSessionsService --\u003e|\"registerChatSessionItemProvider()\"| IChatSessionItemProvider\n    \n    LocalProvider[\"LocalAgentsSessionsProvider\u003cbr/\u003e(localChatSessionType)\"]\n    RemoteProvider[\"Remote Session Providers\"]\n    \n    LocalProvider --\u003e|\"implements\"| IChatSessionItemProvider\n    RemoteProvider --\u003e|\"implements\"| IChatSessionItemProvider\n    \n    LocalProvider --\u003e|\"provideChatSessionItems()\"| SessionItems[\"IChatSessionItem[]\"]\n    SessionItems --\u003e|\"contains\"| SessionDetails[\"resource, label, status, timing, changes\"]\n    \n    IChatSessionsService --\u003e|\"onDidChangeSessionItems\"| SessionUpdates[\"Session List Updates\"]\n```\n\n**Session Item Properties:**\n- `resource`: URI identifying the session\n- `label`: Display title\n- `status`: `ChatSessionStatus` (InProgress, Completed, Failed, NeedsInput)\n- `timing`: Request/response timing information\n- `changes`: File modification statistics (insertions, deletions, file count)\n\n**Sources:**\n- [src/vs/workbench/contrib/chat/browser/agentSessions/localAgentSessionsProvider.ts:23-163]()\n- [src/vs/workbench/contrib/chat/browser/agentSessions/localAgentSessionsProvider.ts:99-125]()\n\n### Session Transfer\n\nChat sessions can be transferred between workspaces:\n\n```mermaid\nsequenceDiagram\n    participant Extension\n    participant ExtHost as ExtHostChatAgents2\n    participant MainThread as MainThreadChatAgents2\n    participant ChatService as IChatService\n    \n    Extension-\u003e\u003eExtHost: transferActiveChat(newWorkspace)\n    ExtHost-\u003e\u003eMainThread: $transferActiveChatSession(workspace)\n    MainThread-\u003e\u003eMainThread: Get lastFocusedWidget\n    MainThread-\u003e\u003eMainThread: Get active session\n    MainThread-\u003e\u003eChatService: transferChatSession(session, workspace)\n    ChatService--\u003e\u003eMainThread: Success\n    MainThread--\u003e\u003eExtHost: Success\n    ExtHost--\u003e\u003eExtension: Success\n```\n\n**Sources:**\n- [src/vs/workbench/api/common/extHostChatAgents2.ts:458-460]()\n- [src/vs/workbench/api/browser/mainThreadChatAgents2.ts:157-166]()"])</script><script>self.__next_f.push([1,"3a:T8523,"])</script><script>self.__next_f.push([1,"# Chat System Architecture\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [src/vs/workbench/api/browser/mainThreadChatAgents2.ts](src/vs/workbench/api/browser/mainThreadChatAgents2.ts)\n- [src/vs/workbench/api/common/extHostChatAgents2.ts](src/vs/workbench/api/common/extHostChatAgents2.ts)\n- [src/vs/workbench/contrib/chat/browser/actions/chatActions.ts](src/vs/workbench/contrib/chat/browser/actions/chatActions.ts)\n- [src/vs/workbench/contrib/chat/browser/actions/chatExecuteActions.ts](src/vs/workbench/contrib/chat/browser/actions/chatExecuteActions.ts)\n- [src/vs/workbench/contrib/chat/browser/agentSessions/localAgentSessionsProvider.ts](src/vs/workbench/contrib/chat/browser/agentSessions/localAgentSessionsProvider.ts)\n- [src/vs/workbench/contrib/chat/browser/chat.contribution.ts](src/vs/workbench/contrib/chat/browser/chat.contribution.ts)\n- [src/vs/workbench/contrib/chat/browser/chat.ts](src/vs/workbench/contrib/chat/browser/chat.ts)\n- [src/vs/workbench/contrib/chat/common/constants.ts](src/vs/workbench/contrib/chat/common/constants.ts)\n- [src/vs/workbench/contrib/chat/test/common/voiceChatService.test.ts](src/vs/workbench/contrib/chat/test/common/voiceChatService.test.ts)\n- [src/vs/workbench/services/chat/common/chatEntitlementService.ts](src/vs/workbench/services/chat/common/chatEntitlementService.ts)\n- [src/vscode-dts/vscode.proposed.chatParticipantAdditions.d.ts](src/vscode-dts/vscode.proposed.chatParticipantAdditions.d.ts)\n- [src/vscode-dts/vscode.proposed.defaultChatParticipant.d.ts](src/vscode-dts/vscode.proposed.defaultChatParticipant.d.ts)\n\n\u003c/details\u003e\n\n\n\nThis document describes the architecture of VS Code's chat system, which provides AI-powered conversational assistance through the workbench UI. The system enables both built-in and extension-provided chat participants (agents) to interact with users through various modalities including text, voice, and inline editing.\n\nFor information about the terminal system's chat integration, see [Integrated Terminal](#6). For notebook integration, see [Notebooks](#8). For the extension API for language models and tools, see [Extension System](#5).\n\n## Purpose and Scope\n\nThe chat system architecture encompasses:\n- Core chat services and their responsibilities\n- Widget infrastructure for rendering chat UI\n- The agent/participant system for extensibility\n- Extension host communication protocol\n- Session and history management\n- Request/response pipeline and streaming\n- Chat modes (Ask, Edit, Agent) and mode switching\n- Entitlement and quota management\n\nThis document focuses on the architectural components and their interactions. Specific UI components like the chat widget's list renderer and input system are covered at a high level.\n\nSources: [src/vs/workbench/contrib/chat/browser/chat.contribution.ts:1-142](), [src/vs/workbench/contrib/chat/common/constants.ts:1-143]()\n\n## Architecture Overview\n\n```mermaid\ngraph TB\n    subgraph \"Workbench Layer\"\n        IChatWidgetService[\"IChatWidgetService\"]\n        IChatService[\"IChatService\"]\n        IChatAgentService[\"IChatAgentService\"]\n        IChatSessionsService[\"IChatSessionsService\"]\n        IChatModeService[\"IChatModeService\"]\n    end\n    \n    subgraph \"Widget Layer\"\n        ChatWidget[\"ChatWidget\"]\n        ChatInputPart[\"ChatInputPart\"]\n        ChatAttachmentModel[\"ChatAttachmentModel\"]\n        IChatWidget[\"IChatWidget interface\"]\n    end\n    \n    subgraph \"Extension Host\"\n        ExtHostChatAgents2[\"ExtHostChatAgents2\"]\n        ChatAgentResponseStream[\"ChatAgentResponseStream\"]\n        ExtHostChatAgent[\"ExtHostChatAgent\"]\n    end\n    \n    subgraph \"Main Thread Bridge\"\n        MainThreadChatAgents2[\"MainThreadChatAgents2\"]\n        RPC[\"RPC Protocol\u003cbr/\u003eextHost.protocol.ts\"]\n    end\n    \n    subgraph \"Agent Implementation\"\n        IChatAgentImplementation[\"IChatAgentImplementation\"]\n        AgentData[\"AgentData\"]\n        ChatAgentLocation[\"ChatAgentLocation\u003cbr/\u003e(Chat, Terminal, Notebook, EditorInline)\"]\n    end\n    \n    subgraph \"Session \u0026 History\"\n        IChatModel[\"IChatModel\"]\n        IChatViewModel[\"IChatViewModel\"]\n        LocalAgentsSessionsProvider[\"LocalAgentsSessionsProvider\"]\n    end\n    \n    IChatWidgetService --\u003e ChatWidget\n    ChatWidget --\u003e IChatWidget\n    ChatWidget --\u003e ChatInputPart\n    ChatWidget --\u003e ChatAttachmentModel\n    ChatWidget --\u003e IChatViewModel\n    \n    IChatService --\u003e IChatModel\n    IChatAgentService --\u003e AgentData\n    IChatAgentService --\u003e IChatAgentImplementation\n    \n    MainThreadChatAgents2 --\u003e RPC\n    RPC --\u003e ExtHostChatAgents2\n    ExtHostChatAgents2 --\u003e ExtHostChatAgent\n    ExtHostChatAgents2 --\u003e ChatAgentResponseStream\n    \n    MainThreadChatAgents2 --\u003e IChatAgentService\n    MainThreadChatAgents2 --\u003e IChatService\n    \n    IChatAgentImplementation --\u003e MainThreadChatAgents2\n    \n    IChatSessionsService --\u003e LocalAgentsSessionsProvider\n    LocalAgentsSessionsProvider --\u003e IChatModel\n    \n    IChatModeService --\u003e ChatWidget\n```\n\nThe chat system is organized into several layers:\n\n1. **Service Layer**: Core services (`IChatService`, `IChatAgentService`, `IChatWidgetService`) manage state and orchestrate operations\n2. **Widget Layer**: UI components (`ChatWidget`, `ChatInputPart`) render the chat interface\n3. **Extension Bridge**: RPC communication between main thread (`MainThreadChatAgents2`) and extension host (`ExtHostChatAgents2`)\n4. **Session Management**: Models (`IChatModel`, `IChatViewModel`) and providers manage chat history\n\nSources: [src/vs/workbench/contrib/chat/browser/chat.ts:1-327](), [src/vs/workbench/api/common/extHostChatAgents2.ts:1-100](), [src/vs/workbench/api/browser/mainThreadChatAgents2.ts:1-150]()\n\n## Core Services\n\n### IChatService\n\n`IChatService` is the central orchestrator for chat functionality, managing sessions, requests, and responses.\n\nKey responsibilities:\n- Session lifecycle management (`getSession`, `startSession`, `addRequest`)\n- Request submission and cancellation\n- Response streaming and progress updates\n- Session transfer between workspaces\n- History persistence\n\nLocated in [src/vs/workbench/contrib/chat/common/chatService/chatService.ts](), implemented by `ChatService` in [src/vs/workbench/contrib/chat/common/chatService/chatServiceImpl.ts]().\n\n### IChatWidgetService\n\n`IChatWidgetService` manages chat widget instances across the workbench.\n\nKey responsibilities:\n- Widget registration and lifecycle\n- Widget retrieval by session, input URI, or location\n- Focus management (tracks `lastFocusedWidget`)\n- Widget reveal and navigation\n\n```mermaid\ngraph LR\n    IChatWidgetService[\"IChatWidgetService\"]\n    ChatWidget1[\"ChatWidget\u003cbr/\u003e(Panel)\"]\n    ChatWidget2[\"ChatWidget\u003cbr/\u003e(Editor)\"]\n    ChatWidget3[\"ChatWidget\u003cbr/\u003e(Quick Chat)\"]\n    \n    IChatWidgetService --\u003e|\"register()\"| ChatWidget1\n    IChatWidgetService --\u003e|\"register()\"| ChatWidget2\n    IChatWidgetService --\u003e|\"register()\"| ChatWidget3\n    \n    IChatWidgetService --\u003e|\"getWidgetBySessionResource()\"| ChatWidget1\n    IChatWidgetService --\u003e|\"getWidgetsByLocations()\"| ChatWidget1\n    IChatWidgetService --\u003e|\"lastFocusedWidget\"| ChatWidget2\n```\n\nSources: [src/vs/workbench/contrib/chat/browser/chat.ts:52-98](), [src/vs/workbench/contrib/chat/browser/widget/chatWidgetService.ts]()\n\n### IChatAgentService\n\n`IChatAgentService` manages chat agents (participants) and their implementations.\n\nKey responsibilities:\n- Agent registration (static and dynamic)\n- Agent discovery and lookup (by ID or name)\n- Command/slash command management\n- Agent invocation and tool routing\n- Followup and title/summary generation\n\nInterface defined at [src/vs/workbench/contrib/chat/common/participants/chatAgents.ts]().\n\n### IChatModeService\n\n`IChatModeService` manages chat modes (Ask, Edit, Agent) and custom agents.\n\n```typescript\n// From constants.ts\nenum ChatModeKind {\n    Ask = 'ask',\n    Edit = 'edit',\n    Agent = 'agent'\n}\n```\n\nSources: [src/vs/workbench/contrib/chat/common/constants.ts:43-47](), [src/vs/workbench/contrib/chat/common/chatModes.ts]()\n\n### IChatSessionsService\n\n`IChatSessionsService` manages session metadata and persistence across different session types (local, remote).\n\nKey responsibilities:\n- Session item provider registration\n- Content provider scheme management\n- Session lifecycle events\n- Session metadata queries\n\nSources: [src/vs/workbench/contrib/chat/common/chatSessionsService.ts]()\n\n## Chat Widget System\n\n### IChatWidget Interface\n\nThe `IChatWidget` interface defines the contract for all chat widget implementations.\n\n```mermaid\ngraph TB\n    IChatWidget[\"IChatWidget\"]\n    \n    subgraph \"Core Components\"\n        domNode[\"domNode: HTMLElement\"]\n        viewModel[\"viewModel: IChatViewModel\"]\n        inputEditor[\"inputEditor: ICodeEditor\"]\n        input[\"input: ChatInputPart\"]\n        attachmentModel[\"attachmentModel: ChatAttachmentModel\"]\n    end\n    \n    subgraph \"State \u0026 Context\"\n        location[\"location: ChatAgentLocation\"]\n        viewContext[\"viewContext: IChatWidgetViewContext\"]\n        parsedInput[\"parsedInput: IParsedChatRequest\"]\n        lockedAgentId[\"lockedAgentId: string\"]\n    end\n    \n    subgraph \"Methods\"\n        acceptInput[\"acceptInput(query?, options?)\"]\n        setInput[\"setInput(query?)\"]\n        focusInput[\"focusInput()\"]\n        clear[\"clear()\"]\n        reveal[\"reveal(item)\"]\n    end\n    \n    IChatWidget --\u003e domNode\n    IChatWidget --\u003e viewModel\n    IChatWidget --\u003e inputEditor\n    IChatWidget --\u003e input\n    IChatWidget --\u003e attachmentModel\n    IChatWidget --\u003e location\n    IChatWidget --\u003e viewContext\n    IChatWidget --\u003e parsedInput\n    IChatWidget --\u003e lockedAgentId\n    IChatWidget --\u003e acceptInput\n    IChatWidget --\u003e setInput\n    IChatWidget --\u003e focusInput\n    IChatWidget --\u003e clear\n    IChatWidget --\u003e reveal\n```\n\nKey properties:\n- `location`: One of `ChatAgentLocation.Chat`, `.Terminal`, `.Notebook`, or `.EditorInline`\n- `viewModel`: Contains the session model and request/response history\n- `input`: The `ChatInputPart` managing text input and attachments\n- `attachmentModel`: Manages file, context, and tool attachments\n\nSources: [src/vs/workbench/contrib/chat/browser/chat.ts:250-311]()\n\n### ChatWidget Implementation\n\nThe `ChatWidget` class (in [src/vs/workbench/contrib/chat/browser/widget/chatWidget.ts]()) is the primary implementation of `IChatWidget`.\n\nKey components:\n- **Tree/List**: Renders request/response pairs using `ChatListItemRenderer`\n- **Input Part**: `ChatInputPart` manages Monaco editor with completion, attachments\n- **Attachment Model**: `ChatAttachmentModel` tracks files, context variables, tools\n- **Layout**: Manages scrolling, focus, and responsive layout\n\n### Widget Lifecycle\n\n```mermaid\nsequenceDiagram\n    participant User\n    participant ChatWidget\n    participant IChatWidgetService\n    participant IChatService\n    participant IChatViewModel\n    \n    User-\u003e\u003eChatWidget: Create widget instance\n    ChatWidget-\u003e\u003eIChatWidgetService: register(widget)\n    ChatWidget-\u003e\u003eIChatService: getOrStartSession()\n    IChatService--\u003e\u003eChatWidget: IChatModel\n    ChatWidget-\u003e\u003eIChatViewModel: Create view model\n    ChatWidget-\u003e\u003eUser: Widget ready\n    \n    User-\u003e\u003eChatWidget: acceptInput(\"query\")\n    ChatWidget-\u003e\u003eIChatService: sendRequest()\n    IChatService-\u003e\u003eChatWidget: Stream response\n    ChatWidget-\u003e\u003eIChatViewModel: Update model\n    IChatViewModel-\u003e\u003eChatWidget: Fire onDidChange\n    ChatWidget-\u003e\u003eUser: Render update\n```\n\nSources: [src/vs/workbench/contrib/chat/browser/widget/chatWidget.ts]()\n\n## Agent/Participant System\n\n### Agent Architecture\n\nAgents (also called \"participants\") are the fundamental unit of extensibility in the chat system. Each agent has an ID, metadata, and an implementation that handles requests.\n\n```mermaid\ngraph TB\n    subgraph \"Extension Process\"\n        ExtAPI[\"vscode.chat.createChatParticipant()\"]\n        ExtHostChatAgent[\"ExtHostChatAgent\"]\n        handler[\"ChatExtendedRequestHandler\"]\n    end\n    \n    subgraph \"Main Process\"\n        IChatAgentService[\"IChatAgentService\"]\n        IChatAgentData[\"IChatAgentData\u003cbr/\u003e(metadata)\"]\n        IChatAgentImplementation[\"IChatAgentImplementation\u003cbr/\u003e(invoke, provideFollowups)\"]\n        MainThreadChatAgents2[\"MainThreadChatAgents2\"]\n    end\n    \n    subgraph \"Registration Flow\"\n        pkgJSON[\"package.json\u003cbr/\u003echatParticipants contribution\"]\n        staticReg[\"Static registration\"]\n        dynamicReg[\"Dynamic registration\"]\n    end\n    \n    ExtAPI --\u003e ExtHostChatAgent\n    ExtHostChatAgent --\u003e handler\n    ExtHostChatAgent --\u003e|\"$registerAgent()\"| MainThreadChatAgents2\n    \n    pkgJSON --\u003e staticReg\n    staticReg --\u003e IChatAgentData\n    dynamicReg --\u003e IChatAgentData\n    \n    MainThreadChatAgents2 --\u003e|\"registerAgentImplementation()\"| IChatAgentService\n    MainThreadChatAgents2 --\u003e IChatAgentImplementation\n    \n    IChatAgentService --\u003e IChatAgentData\n    IChatAgentService --\u003e IChatAgentImplementation\n```\n\nSources: [src/vs/workbench/contrib/chat/common/participants/chatAgents.ts](), [src/vs/workbench/api/common/extHostChatAgents2.ts:462-478]()\n\n### Agent Registration\n\nAgents can be registered in two ways:\n\n1. **Static Registration** (via `package.json`):\n```json\n{\n  \"contributes\": {\n    \"chatParticipants\": [{\n      \"id\": \"workspace\",\n      \"name\": \"workspace\",\n      \"description\": \"Ask about workspace\"\n    }]\n  }\n}\n```\n\n2. **Dynamic Registration** (via extension API):\n- Extensions call `vscode.chat.createChatParticipant(id, handler)`\n- `ExtHostChatAgents2.createChatAgent()` or `createDynamicChatAgent()`\n- Main thread creates agent data via `registerDynamicAgent()`\n\nSources: [src/vs/workbench/api/common/extHostChatAgents2.ts:462-478](), [src/vs/workbench/api/browser/mainThreadChatAgents2.ts:168-249]()\n\n### Agent Invocation Flow\n\n```mermaid\nsequenceDiagram\n    participant ChatWidget\n    participant IChatService\n    participant IChatAgentService\n    participant MainThreadChatAgents2\n    participant RPC as RPC Protocol\n    participant ExtHostChatAgents2\n    participant AgentHandler as Extension Handler\n    \n    ChatWidget-\u003e\u003eIChatService: sendRequest(request)\n    IChatService-\u003e\u003eIChatAgentService: invokeAgent(id, request)\n    IChatAgentService-\u003e\u003eMainThreadChatAgents2: impl.invoke(request, progress)\n    MainThreadChatAgents2-\u003e\u003eRPC: $invokeAgent(handle, request)\n    RPC-\u003e\u003eExtHostChatAgents2: $invokeAgent(handle, request)\n    ExtHostChatAgents2-\u003e\u003eAgentHandler: handler(request, context, response, token)\n    \n    loop Streaming Response\n        AgentHandler-\u003e\u003eExtHostChatAgents2: response.markdown(text)\n        ExtHostChatAgents2-\u003e\u003eRPC: $handleProgressChunk(requestId, chunks)\n        RPC-\u003e\u003eMainThreadChatAgents2: $handleProgressChunk(requestId, chunks)\n        MainThreadChatAgents2-\u003e\u003eIChatService: progress(parts)\n        IChatService-\u003e\u003eChatWidget: Update UI\n    end\n    \n    AgentHandler--\u003e\u003eExtHostChatAgents2: result\n    ExtHostChatAgents2--\u003e\u003eMainThreadChatAgents2: IChatAgentResult\n    MainThreadChatAgents2--\u003e\u003eIChatAgentService: result\n    IChatAgentService--\u003e\u003eIChatService: result\n```\n\nSources: [src/vs/workbench/api/browser/mainThreadChatAgents2.ts:182-194](), [src/vs/workbench/api/common/extHostChatAgents2.ts:506-650]()\n\n### ChatAgentResponseStream\n\nThe `ChatAgentResponseStream` class provides the streaming API exposed to extensions.\n\nKey methods (from [vscode.proposed.chatParticipantAdditions.d.ts]()):\n- `markdown(value)`: Send markdown content\n- `progress(value, task?)`: Send progress message with optional async task\n- `reference(value, iconPath?)`: Add a reference (file, URI, location)\n- `button(command)`: Add a command button\n- `push(part)`: Generic method for any response part\n- `textEdit(uri, edits)`: Stream text edits (Edit mode)\n\nSources: [src/vs/workbench/api/common/extHostChatAgents2.ts:43-398](), [src/vscode-dts/vscode.proposed.chatParticipantAdditions.d.ts:294-374]()\n\n### Agent Metadata and Capabilities\n\nAgent metadata includes:\n- `locations`: Where the agent can be invoked (`ChatAgentLocation` enum)\n- `modes`: Which chat modes support this agent (`ChatModeKind` enum)\n- `slashCommands`: Available slash commands\n- `isSticky`: Whether agent stays selected between requests\n- `disambiguation`: Examples for agent selection\n\nSources: [src/vs/workbench/contrib/chat/common/participants/chatAgents.ts](), [src/vs/workbench/api/browser/mainThreadChatAgents2.ts:168-249]()\n\n## Extension Host Integration\n\n### RPC Protocol\n\nCommunication between the main thread and extension host uses a typed RPC protocol defined in [src/vs/workbench/api/common/extHost.protocol.ts]().\n\nKey interfaces:\n- `ExtHostChatAgentsShape2`: Methods called on extension host\n- `MainThreadChatAgentsShape2`: Methods called on main thread\n- DTOs: `IChatProgressDto`, `IChatAgentRequest`, `IChatAgentHistoryEntryDto`\n\n### MainThreadChatAgents2\n\n`MainThreadChatAgents2` is the main thread side of the agent bridge.\n\n```mermaid\ngraph TB\n    MainThreadChatAgents2[\"MainThreadChatAgents2\"]\n    \n    subgraph \"Managed Resources\"\n        agents[\"_agents: Map\u0026lt;handle, AgentData\u0026gt;\"]\n        pendingProgress[\"_pendingProgress: Map\u0026lt;requestId, progress\u0026gt;\"]\n        activeTasks[\"_activeTasks: Map\u0026lt;requestId, IChatTask\u0026gt;\"]\n        unresolvedAnchors[\"_unresolvedAnchors: Map\"]\n    end\n    \n    subgraph \"RPC Methods\"\n        registerAgent[\"$registerAgent(handle, id, metadata)\"]\n        invokeAgent[\"$invokeAgent(handle, request)\"]\n        handleProgressChunk[\"$handleProgressChunk(requestId, chunks)\"]\n        releaseSession[\"$releaseSession(resource)\"]\n    end\n    \n    subgraph \"Integration\"\n        chatAgentService[\"IChatAgentService\"]\n        chatService[\"IChatService\"]\n        chatSessionsService[\"IChatSessionsService\"]\n    end\n    \n    MainThreadChatAgents2 --\u003e agents\n    MainThreadChatAgents2 --\u003e pendingProgress\n    MainThreadChatAgents2 --\u003e activeTasks\n    MainThreadChatAgents2 --\u003e unresolvedAnchors\n    \n    MainThreadChatAgents2 --\u003e registerAgent\n    MainThreadChatAgents2 --\u003e invokeAgent\n    MainThreadChatAgents2 --\u003e handleProgressChunk\n    MainThreadChatAgents2 --\u003e releaseSession\n    \n    MainThreadChatAgents2 --\u003e chatAgentService\n    MainThreadChatAgents2 --\u003e chatService\n    MainThreadChatAgents2 --\u003e chatSessionsService\n```\n\nThe main thread bridge:\n1. Registers agents with `IChatAgentService`\n2. Creates `IChatAgentImplementation` that delegates to extension host\n3. Buffers and forwards progress chunks to `IChatService`\n4. Manages agent lifecycle and session cleanup\n\nSources: [src/vs/workbench/api/browser/mainThreadChatAgents2.ts:91-262]()\n\n### ExtHostChatAgents2\n\n`ExtHostChatAgents2` manages agents on the extension host side.\n\nKey responsibilities:\n- Agent creation via `createChatAgent()` and `createDynamicChatAgent()`\n- Handler invocation with request/response streaming\n- Type conversion between VS Code API types and internal DTOs\n- Session lifecycle management\n\n```typescript\n// Agent creation flow\ncreateChatAgent(extension, id, handler) {\n    const handle = ExtHostChatAgents2._idPool++;\n    const agent = new ExtHostChatAgent(extension, id, this._proxy, handle, handler);\n    this._agents.set(handle, agent);\n    this._proxy.$registerAgent(handle, extension.identifier, id, {}, undefined);\n    return agent.apiAgent;\n}\n```\n\nSources: [src/vs/workbench/api/common/extHostChatAgents2.ts:406-478]()\n\n## Session Management\n\n### Session Lifecycle\n\nSessions are identified by URIs with custom schemes:\n- `vscode-local-chat-session://`: Local chat sessions\n- `vscode-chat-editor://`: Editor-based chat sessions\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e Created: getOrStartSession()\n    Created --\u003e Active: First request\n    Active --\u003e InProgress: sendRequest()\n    InProgress --\u003e Active: Response complete\n    Active --\u003e InProgress: Another request\n    Active --\u003e Disposed: dispose()\n    Disposed --\u003e [*]\n    \n    Active --\u003e Background: Widget closed\n    Background --\u003e Active: Widget opened\n    Background --\u003e Disposed: Session cleared\n```\n\nSession states:\n- **Created**: Session exists but no requests yet\n- **Active**: Session has requests, widget is visible\n- **InProgress**: Currently processing a request\n- **Background**: Session exists but no widget displaying it\n- **Disposed**: Session permanently removed\n\nSources: [src/vs/workbench/contrib/chat/common/model/chatModel.ts](), [src/vs/workbench/contrib/chat/common/chatSessionsService.ts]()\n\n### IChatModel\n\n`IChatModel` represents a chat session's data model.\n\nKey properties:\n- `sessionResource`: URI identifying the session\n- Requests/responses: Managed as request-response pairs\n- `editingSession`: Link to editing session if in Edit mode\n- `checkpoint`: Saved state for undo/redo operations\n\nKey methods:\n- `addRequest()`, `removeRequest()`: Modify request history\n- `waitForInitialization()`: Async initialization\n- `toJSON()`, `toExport()`: Serialization\n\nSources: [src/vs/workbench/contrib/chat/common/model/chatModel.ts]()\n\n### LocalAgentsSessionsProvider\n\n`LocalAgentsSessionsProvider` implements `IChatSessionItemProvider` for local sessions.\n\n```typescript\nprovideChatSessionItems(token: CancellationToken): Promise\u003cIChatSessionItem[]\u003e {\n    // Returns sessions with:\n    // - Live sessions from IChatService\n    // - History sessions from storage\n    // - Status: InProgress, NeedsInput, Failed, Completed\n}\n```\n\nSession items include:\n- `label`: Session title\n- `status`: `ChatSessionStatus` enum value\n- `timing`: Duration and timestamp information\n- `changes`: File modification statistics (for Edit mode)\n\nSources: [src/vs/workbench/contrib/chat/browser/agentSessions/localAgentSessionsProvider.ts:1-164]()\n\n## Request/Response Flow\n\n### Request Submission\n\n```mermaid\nsequenceDiagram\n    participant User\n    participant ChatWidget\n    participant ChatInputPart\n    participant IChatService\n    participant IChatAgentService\n    participant AgentImpl as Agent Implementation\n    participant IChatModel\n    \n    User-\u003e\u003eChatInputPart: Type query and press Enter\n    ChatInputPart-\u003e\u003eChatWidget: acceptInput(query, options)\n    ChatWidget-\u003e\u003eChatWidget: Parse input (agent, slash command)\n    ChatWidget-\u003e\u003eIChatService: sendRequest(model, message, options)\n    IChatService-\u003e\u003eIChatModel: addRequest(message)\n    IChatService-\u003e\u003eIChatAgentService: invokeAgent(agentId, request, progress)\n    IChatAgentService-\u003e\u003eAgentImpl: invoke(request, progress, history, token)\n    \n    loop Response Streaming\n        AgentImpl-\u003e\u003eIChatService: progress([markdown chunk])\n        IChatService-\u003e\u003eIChatModel: acceptResponseProgress(part)\n        IChatModel-\u003e\u003eChatWidget: onDidChange event\n        ChatWidget-\u003e\u003eUser: Render update\n    end\n    \n    AgentImpl--\u003e\u003eIChatService: IChatAgentResult\n    IChatService-\u003e\u003eIChatModel: completeResponse(result)\n```\n\nKey steps:\n1. **Input parsing**: Extract agent reference (e.g., `@workspace`), slash command, attachments\n2. **Request creation**: Build `IChatAgentRequest` with parsed data\n3. **Agent invocation**: Route to appropriate agent via `IChatAgentService`\n4. **Progress streaming**: Agent sends chunks via progress callback\n5. **Completion**: Final result with metadata (error details, followups)\n\nSources: [src/vs/workbench/contrib/chat/browser/actions/chatExecuteActions.ts:46-147](), [src/vs/workbench/contrib/chat/common/chatService/chatService.ts]()\n\n### Request Data Structure\n\n```typescript\ninterface IChatAgentRequest {\n    sessionResource: URI;           // Session identifier\n    requestId: string;              // Unique request ID\n    agentId: string;                // Target agent\n    message: string;                // User's message\n    command?: string;               // Slash command if any\n    variables: IChatRequestVariables; // Attached context\n    location: ChatAgentLocation;    // Where request originated\n    // ... more fields\n}\n```\n\nSources: [src/vs/workbench/contrib/chat/common/participants/chatAgents.ts]()\n\n### Progress Types\n\nThe system supports various progress part types (from `IChatProgress`):\n\n| Type | Description | Example Use |\n|------|-------------|-------------|\n| `markdownContent` | Text response | Main response content |\n| `markdownVuln` | Security warnings | Vulnerability notices |\n| `reference` | File/URI references | Code references |\n| `codeblockUri` | Code block with URI | Editable code blocks |\n| `textEdit` | Text edits | Edit mode changes |\n| `progressTask` | Async task with progress | Long-running operations |\n| `command` | Action button | \"Apply changes\" button |\n| `confirmation` | User confirmation request | Approve/reject dialog |\n| `thinking` | Reasoning steps | Agent thinking process |\n\nSources: [src/vs/workbench/contrib/chat/common/chatService/chatService.ts](), [src/vscode-dts/vscode.proposed.chatParticipantAdditions.d.ts:182-210]()\n\n### Response Streaming Implementation\n\nThe streaming system uses a micro-task queue for efficient batching:\n\n```typescript\n// From ChatAgentResponseStream\nconst sendQueue: (IChatProgressDto | [IChatProgressDto, number])[] = [];\nfunction send(chunk: IChatProgressDto) {\n    const newLen = sendQueue.push(chunk);\n    if (newLen === 1) {\n        queueMicrotask(() =\u003e {\n            that._proxy.$handleProgressChunk(that._request.requestId, sendQueue);\n            sendQueue.length = 0;\n        });\n    }\n}\n```\n\nThis approach:\n- Batches multiple chunks into single RPC call\n- Maintains order of progress updates\n- Reduces overhead of cross-process communication\n\nSources: [src/vs/workbench/api/common/extHostChatAgents2.ts:88-112]()\n\n## Chat Modes System\n\n### Mode Architecture\n\nVS Code supports three core chat modes defined by the `ChatModeKind` enum:\n\n```typescript\nenum ChatModeKind {\n    Ask = 'ask',      // Q\u0026A mode\n    Edit = 'edit',    // File editing mode\n    Agent = 'agent'   // Autonomous agent mode\n}\n```\n\nEach mode has distinct behavior:\n\n| Mode | Purpose | Tool Usage | Side Effects |\n|------|---------|------------|--------------|\n| Ask | Q\u0026A and code generation | Read-only tools | No file modifications |\n| Edit | Direct file editing | Read/write tools | Creates working set of files |\n| Agent | Autonomous task execution | All tools including side-effect tools | Full system interaction |\n\nSources: [src/vs/workbench/contrib/chat/common/constants.ts:43-47](), [src/vs/workbench/contrib/chat/common/chatModes.ts]()\n\n### Mode Switching Flow\n\n```mermaid\nsequenceDiagram\n    participant User\n    participant ChatWidget\n    participant ChatInputPart\n    participant IChatModeService\n    participant ConfirmDialog as Dialog Service\n    participant CommandService\n    \n    User-\u003e\u003eChatInputPart: Click mode picker\n    ChatInputPart-\u003e\u003eChatInputPart: openModePicker()\n    ChatInputPart-\u003e\u003eUser: Show mode options\n    User-\u003e\u003eChatInputPart: Select \"Agent\"\n    ChatInputPart-\u003e\u003eChatWidget: Switch requested\n    ChatWidget-\u003e\u003eChatWidget: handleModeSwitch()\n    \n    alt Has Pending Changes\n        ChatWidget-\u003e\u003eConfirmDialog: Show confirmation\n        ConfirmDialog-\u003e\u003eUser: Clear session?\n        User-\u003e\u003eConfirmDialog: Confirm\n        ConfirmDialog--\u003e\u003eChatWidget: { needToClearSession: true }\n        ChatWidget-\u003e\u003eCommandService: executeCommand(ACTION_ID_NEW_CHAT)\n    else No Changes\n        ChatWidget-\u003e\u003eChatInputPart: setChatMode(modeId)\n        ChatInputPart-\u003e\u003eIChatModeService: Update current mode\n    end\n```\n\nMode switching considerations:\n- Switching from Edit/Agent to Ask may require clearing the session if there are pending edits\n- Confirmation dialog shown based on `chat.editing.confirmEditRequestRemoval` setting\n- Mode state is preserved in session metadata\n\nSources: [src/vs/workbench/contrib/chat/browser/actions/chatActions.ts:363-378](), [src/vs/workbench/contrib/chat/browser/actions/chatExecuteActions.ts:242-328]()\n\n### Custom Agents (User-Defined Modes)\n\nExtensions and users can define custom agents with specific tools and behaviors:\n\n```typescript\ninterface IChatMode {\n    id: string;                           // Unique identifier\n    name: IObservable\u003cstring\u003e;            // Display name\n    kind: ChatModeKind;                   // Base mode type\n    label: IObservable\u003cstring\u003e;           // UI label\n    customTools?: IObservable\u003cstring[]\u003e;  // Tool allowlist\n    source?: { storage: 'builtin' | 'extension' | 'local' | 'user' };\n}\n```\n\nCustom agents are registered through:\n- Package.json contributions (extensions)\n- Prompt files in workspace (`.github/agents/*.agent`)\n- Dynamic registration via API\n\nSources: [src/vs/workbench/contrib/chat/common/chatModes.ts](), [src/vs/workbench/contrib/chat/common/promptSyntax/promptTypes.ts]()\n\n## Configuration and Context Keys\n\n### Chat Configuration\n\nKey settings (from `ChatConfiguration` enum):\n\n```typescript\nenum ChatConfiguration {\n    AgentEnabled = 'chat.agent.enabled',                    // Enable Agent mode\n    Edits2Enabled = 'chat.edits2.enabled',                  // New Edit mode implementation\n    ExtensionToolsEnabled = 'chat.extensionTools.enabled',  // Allow extension tools\n    GlobalAutoApprove = 'chat.tools.global.autoApprove',    // YOLO mode (dangerous)\n    AutoApproveEdits = 'chat.tools.edits.autoApprove',      // Auto-approve edit patterns\n    CheckpointsEnabled = 'chat.checkpoints.enabled',        // Enable undo/redo\n    // ... more settings\n}\n```\n\nSources: [src/vs/workbench/contrib/chat/common/constants.ts:11-38]()\n\n### Context Keys\n\nThe system uses extensive context keys for UI state and feature toggling:\n\n```mermaid\ngraph TB\n    subgraph \"Setup Context Keys\"\n        setupHidden[\"chatSetupHidden\"]\n        setupInstalled[\"chatSetupInstalled\"]\n        setupDisabled[\"chatSetupDisabled\"]\n    end\n    \n    subgraph \"Entitlement Context Keys\"\n        entitlementSignedOut[\"chatEntitlementSignedOut\"]\n        planFree[\"chatPlanFree\"]\n        planPro[\"chatPlanPro\"]\n        chatQuotaExceeded[\"chatQuotaExceeded\"]\n    end\n    \n    subgraph \"Interaction Context Keys\"\n        inChatInput[\"inChatInput\"]\n        inputHasText[\"inputHasText\"]\n        requestInProgress[\"requestInProgress\"]\n        chatModeKind[\"chatModeKind\"]\n    end\n    \n    subgraph \"Agent Context Keys\"\n        lockedToCodingAgent[\"lockedToCodingAgent\"]\n        hasCanDelegateProviders[\"hasCanDelegateProviders\"]\n    end\n```\n\nKey context keys and their purposes:\n\n| Context Key | Purpose |\n|-------------|---------|\n| `chatSetupHidden` | User has hidden chat setup UI |\n| `chatSetupInstalled` | Chat extension is installed and enabled |\n| `chatEntitlementSignedOut` | User is not signed in |\n| `chatPlanFree/Pro/Business` | User's subscription tier |\n| `chatQuotaExceeded` | User has hit usage limits |\n| `inChatInput` | Focus is in chat input field |\n| `inputHasText` | Chat input has content |\n| `requestInProgress` | Chat is processing a request |\n| `chatModeKind` | Current mode (ask/edit/agent) |\n| `lockedToCodingAgent` | Widget locked to specific agent |\n\nSources: [src/vs/workbench/contrib/chat/common/actions/chatContextKeys.ts](), [src/vs/workbench/services/chat/common/chatEntitlementService.ts:35-65]()\n\n### Entitlement and Quota Management\n\nThe `IChatEntitlementService` manages user subscriptions and usage limits:\n\n```typescript\nenum ChatEntitlement {\n    Unknown = 1,        // Signed out\n    Unresolved = 2,     // Signed in, resolving\n    Available = 3,      // Entitled to Free\n    Unavailable = 4,    // Not entitled\n    Free = 5,           // Free tier\n    Pro = 6,            // Pro tier\n    ProPlus = 7,        // Pro Plus tier\n    Business = 8,       // Business tier\n    Enterprise = 9      // Enterprise tier\n}\n\ninterface IQuotas {\n    chat?: { percentRemaining: number };\n    completions?: { percentRemaining: number };\n    resetDate?: string;\n}\n```\n\nThe service:\n- Polls entitlement endpoint for user status\n- Updates context keys for UI feature gating\n- Fires events on entitlement/quota changes\n- Manages anonymous access (experimental)\n\nSources: [src/vs/workbench/services/chat/common/chatEntitlementService.ts:1-300]()\n\n## Integration Points\n\n### Voice Chat Integration\n\nThe `VoiceChatService` integrates speech-to-text with the chat system:\n\n```typescript\ninterface IVoiceChatSessionOptions {\n    usesAgents: boolean;\n    model: IChatModel;\n}\n\n// Converts speech to text with agent/command detection\n// Example: \"At workspace slash fix bug\" -\u003e \"@workspace /fix bug\"\n```\n\nThe service:\n- Detects agent references (e.g., \"at workspace\"  `@workspace`)\n- Detects slash commands (e.g., \"slash fix\"  `/fix`)\n- Handles punctuation and natural speech patterns\n- Provides `waitingForInput` signal when agent/command is incomplete\n\nSources: [src/vs/workbench/contrib/chat/common/voiceChatService.ts](), [src/vs/workbench/contrib/chat/test/common/voiceChatService.test.ts:1-370]()\n\n### Action System\n\nKey actions for chat operations:\n\n| Action ID | Description |\n|-----------|-------------|\n| `workbench.action.chat.open` | Open chat view |\n| `workbench.action.chat.newChat` | Start new session |\n| `workbench.action.chat.submit` | Submit message (Ask mode) |\n| `workbench.action.edits.submit` | Submit message (Edit/Agent mode) |\n| `workbench.action.chat.cancel` | Cancel in-progress request |\n| `workbench.action.chat.openModelPicker` | Select language model |\n| `workbench.action.chat.openModePicker` | Switch chat mode |\n| `workbench.action.chat.toggleAgentMode` | Cycle through modes |\n\nActions are defined in:\n- [src/vs/workbench/contrib/chat/browser/actions/chatActions.ts]() - Primary actions\n- [src/vs/workbench/contrib/chat/browser/actions/chatExecuteActions.ts]() - Submit/execute actions\n\nSources: [src/vs/workbench/contrib/chat/browser/actions/chatActions.ts:72-81](), [src/vs/workbench/contrib/chat/browser/actions/chatExecuteActions.ts:151-210]()\n\n### View Contribution\n\nChat registers as a view container:\n\n```typescript\n// View ID and container\nexport const ChatViewId = `workbench.panel.chat.view.${CHAT_PROVIDER_ID}`;\nexport const ChatViewContainerId = 'workbench.panel.chat';\n```\n\nThe view can appear in:\n- **Panel** (bottom panel, most common)\n- **Sidebar** (primary or auxiliary sidebar)\n- **Editor area** (via `ChatEditorInput`)\n- **Quick Chat** (dropdown overlay)\n\nSources: [src/vs/workbench/contrib/chat/browser/chat.ts:325-327](), [src/vs/workbench/contrib/chat/browser/chat.contribution.ts]()"])</script><script>self.__next_f.push([1,"3b:T8789,"])</script><script>self.__next_f.push([1,"# Chat Agents and Participants\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [src/vs/workbench/api/browser/mainThreadChatAgents2.ts](src/vs/workbench/api/browser/mainThreadChatAgents2.ts)\n- [src/vs/workbench/api/common/extHostChatAgents2.ts](src/vs/workbench/api/common/extHostChatAgents2.ts)\n- [src/vs/workbench/contrib/chat/browser/actions/chatActions.ts](src/vs/workbench/contrib/chat/browser/actions/chatActions.ts)\n- [src/vs/workbench/contrib/chat/browser/actions/chatExecuteActions.ts](src/vs/workbench/contrib/chat/browser/actions/chatExecuteActions.ts)\n- [src/vs/workbench/contrib/chat/browser/agentSessions/localAgentSessionsProvider.ts](src/vs/workbench/contrib/chat/browser/agentSessions/localAgentSessionsProvider.ts)\n- [src/vs/workbench/contrib/chat/browser/chat.contribution.ts](src/vs/workbench/contrib/chat/browser/chat.contribution.ts)\n- [src/vs/workbench/contrib/chat/browser/chat.ts](src/vs/workbench/contrib/chat/browser/chat.ts)\n- [src/vs/workbench/contrib/chat/common/constants.ts](src/vs/workbench/contrib/chat/common/constants.ts)\n- [src/vs/workbench/contrib/chat/test/common/voiceChatService.test.ts](src/vs/workbench/contrib/chat/test/common/voiceChatService.test.ts)\n- [src/vs/workbench/services/chat/common/chatEntitlementService.ts](src/vs/workbench/services/chat/common/chatEntitlementService.ts)\n- [src/vscode-dts/vscode.proposed.chatParticipantAdditions.d.ts](src/vscode-dts/vscode.proposed.chatParticipantAdditions.d.ts)\n- [src/vscode-dts/vscode.proposed.defaultChatParticipant.d.ts](src/vscode-dts/vscode.proposed.defaultChatParticipant.d.ts)\n\n\u003c/details\u003e\n\n\n\nThis document describes the **Chat Agents and Participants** system in VS Code. Chat agents (also called chat participants) are extension-contributed entities that handle chat requests from users. Extensions register agents that can respond to queries, execute commands, and interact with the language model.\n\nFor information about the chat UI and widget system, see [Chat System Architecture](#10.1). For details on language models and tool integration, see [Language Models and Tool Integration](#10.7). For the extension API for contributing agents, see [Chat Extension API](#10.8).\n\n## Architecture Overview\n\nThe chat agent system follows VS Code's standard extension architecture with a clear separation between the extension host process (where agent implementations run) and the main thread (where agent orchestration occurs).\n\n#### Architecture Diagram\n\n```mermaid\ngraph TB\n    subgraph ExtensionHost[\"Extension Host Process\"]\n        ExtHostAgents[\"ExtHostChatAgents2\u003cbr/\u003e_agents: Map\u003chandle, ExtHostChatAgent\u003e\"]\n        ExtHostChatAgent[\"ExtHostChatAgent\u003cbr/\u003einvoke(), provideFollowups()\"]\n        ChatAgentResponseStream[\"ChatAgentResponseStream\u003cbr/\u003emarkdown(), progress(), reference()\"]\n    end\n    \n    subgraph MainThread[\"Main Thread Process\"]\n        MainThreadAgents[\"MainThreadChatAgents2\u003cbr/\u003e$registerAgent(), $invokeAgent()\"]\n        ChatAgentService[\"ChatAgentService\u003cbr/\u003eIChatAgentService\"]\n        ChatAgentNameService[\"ChatAgentNameService\u003cbr/\u003eIChatAgentNameService\"]\n        ChatService[\"ChatService\u003cbr/\u003esendRequest(), invokeAgent()\"]\n    end\n    \n    subgraph AgentData[\"Agent Data Structures\"]\n        IChatAgentData[\"IChatAgentData\u003cbr/\u003eid, name, extensionId\u003cbr/\u003elocations, modes, slashCommands\"]\n        IChatAgentImpl[\"IChatAgentImplementation\u003cbr/\u003einvoke(), provideFollowups()\u003cbr/\u003esetRequestTools()\"]\n    end\n    \n    subgraph ExtensionAPI[\"Extension API (vscode.d.ts)\"]\n        createChatParticipant[\"createChatParticipant(id, handler)\"]\n        ChatParticipant[\"ChatParticipant\u003cbr/\u003erequestHandler, followupProvider\"]\n    end\n    \n    createChatParticipant --\u003e|creates| ExtHostChatAgent\n    ExtHostChatAgent --\u003e|managed by| ExtHostAgents\n    ExtHostAgents \u003c--\u003e|\"RPC: $registerAgent()\u003cbr/\u003e$invokeAgent()\"| MainThreadAgents\n    MainThreadAgents --\u003e|\"registerAgentImplementation()\"| ChatAgentService\n    \n    ChatAgentService --\u003e|stores| IChatAgentData\n    ChatAgentService --\u003e|stores| IChatAgentImpl\n    \n    ChatService --\u003e|\"invokeAgent()\"| ChatAgentService\n    ChatAgentService --\u003e|delegates| MainThreadAgents\n    MainThreadAgents --\u003e|\"$invokeAgent()\"| ExtHostAgents\n    ExtHostAgents --\u003e|calls| ExtHostChatAgent\n    ExtHostChatAgent --\u003e|streams via| ChatAgentResponseStream\n    \n    ChatAgentNameService --\u003e|\"manages names\"| ChatAgentService\n```\n\n**Sources:** [src/vs/workbench/api/common/extHostChatAgents2.ts:406-478](), [src/vs/workbench/api/browser/mainThreadChatAgents2.ts:91-249](), [src/vs/workbench/contrib/chat/browser/chat.contribution.ts:34-44]()\n\n## Agent Registration and Lifecycle\n\n### Agent Registration Flow\n\nWhen an extension creates a chat participant, the following registration sequence occurs:\n\n#### Agent Registration Sequence\n\n```mermaid\nsequenceDiagram\n    participant Ext as Extension\n    participant ExtHost as ExtHostChatAgents2\n    participant Proxy as RPC Proxy\n    participant MainThread as MainThreadChatAgents2\n    participant AgentSvc as ChatAgentService\n    \n    Ext-\u003e\u003eExtHost: createChatAgent(id, handler)\n    ExtHost-\u003e\u003eExtHost: handle = _idPool++\n    ExtHost-\u003e\u003eExtHost: agent = new ExtHostChatAgent()\n    ExtHost-\u003e\u003eExtHost: _agents.set(handle, agent)\n    ExtHost-\u003e\u003eProxy: $registerAgent(handle, extensionId, id, metadata)\n    Proxy-\u003e\u003eMainThread: $registerAgent(handle, extensionId, id, metadata)\n    MainThread-\u003e\u003eMainThread: Create IChatAgentImplementation\u003cbr/\u003e{invoke, provideFollowups, setRequestTools}\n    MainThread-\u003e\u003eAgentSvc: registerAgentImplementation(id, impl)\n    AgentSvc-\u003e\u003eAgentSvc: Store in _agentImpls Map\n    MainThread--\u003e\u003eExtHost: Registration complete\n    ExtHost--\u003e\u003eExt: Return agent.apiAgent (ChatParticipant)\n```\n\n**Sources:** [src/vs/workbench/api/common/extHostChatAgents2.ts:462-469](), [src/vs/workbench/api/browser/mainThreadChatAgents2.ts:168-249]()\n\n### Agent Data Structure\n\nEach agent is represented by two key interfaces defined in the `chatAgents.ts` module:\n\n**IChatAgentData** - Static metadata about the agent:\n- `id`: Unique identifier (e.g., \"github.copilot.workspace\")\n- `name`: Display name (e.g., \"workspace\") \n- `extensionId`: Contributing extension (`ExtensionIdentifier`)\n- `extensionVersion`: Extension version string\n- `extensionDisplayName`: Display name of the contributing extension\n- `extensionPublisherId`: Publisher identifier\n- `publisherDisplayName`: Publisher display name\n- `locations`: Array of `ChatAgentLocation` values (Chat, Terminal, Notebook, EditorInline)\n- `modes`: Array of `ChatModeKind` values (Ask, Edit, Agent)\n- `slashCommands`: Array of `IChatAgentCommand` objects\n- `disambiguation`: Array of disambiguation entries with category, description, examples\n- `metadata`: `IChatAgentMetadata` with properties like `isSticky`, `isDefault`, `requiresCopilotPlan`\n\n**IChatAgentImplementation** - Runtime behavior interface:\n- `invoke(request, progress, history, token)`: Handles chat requests, returns `Promise\u003cIChatAgentResult\u003e`\n- `provideFollowups(request, result, history, token)`: Returns `Promise\u003cIChatFollowup[]\u003e`\n- `provideChatTitle(history, token)`: Returns `Promise\u003cstring | undefined\u003e`\n- `provideChatSummary(history, token)`: Returns `Promise\u003cstring | undefined\u003e` \n- `setRequestTools(requestId, tools)`: Updates available tools for a specific request\n\n**Sources:** [src/vs/workbench/contrib/chat/common/participants/chatAgents.ts:70-160](), [src/vs/workbench/api/browser/mainThreadChatAgents2.ts:182-211]()\n\n### Static vs Dynamic Agents\n\n**Static Agents** are declared in `package.json` via the `chatParticipants` contribution point. The `ChatAgentService` reads these contributions on startup and calls `registerAgent()` to register their metadata.\n\n```json\n{\n  \"contributes\": {\n    \"chatParticipants\": [{\n      \"id\": \"myextension.myagent\",\n      \"name\": \"myagent\",\n      \"description\": \"My custom agent\",\n      \"isDefault\": true,\n      \"locations\": [\"panel\", \"terminal\"]\n    }]\n  }\n}\n```\n\n**Dynamic Agents** are registered at runtime using `createDynamicChatAgent()`. The implementation:\n1. Creates an `ExtHostChatAgent` with a new handle\n2. Calls `$registerAgent()` with `dynamicProps` parameter\n3. Main thread calls `registerDynamicAgent()` instead of `registerAgentImplementation()`\n4. The dynamic agent is fully registered with both data and implementation\n\n```typescript\n// Extension code using proposed API\nconst agent = vscode.chat.createDynamicChatParticipant(\n  \"myextension.dynamic\",\n  {\n    name: \"custom\",\n    description: \"Runtime agent\", \n    publisherName: \"MyPublisher\",\n    fullName: \"My Custom Agent\"\n  },\n  handler\n);\n```\n\n**Sources:** [src/vs/workbench/api/common/extHostChatAgents2.ts:471-478](), [src/vs/workbench/api/browser/mainThreadChatAgents2.ts:219-238]()\n\n## Agent Implementation (Extension Host Side)\n\n### ExtHostChatAgents2\n\nThe `ExtHostChatAgents2` class manages all agent-related functionality on the extension host side:\n\n#### ExtHostChatAgents2 Class Structure\n\n```mermaid\ngraph TB\n    subgraph ExtHostChatAgents2Class[\"ExtHostChatAgents2\"]\n        StaticIDPool[\"static _idPool = 0\"]\n        AgentsMap[\"_agents: Map\u003cnumber, ExtHostChatAgent\u003e\"]\n        \n        DetectionProviders[\"_participantDetectionProviders\u003cbr/\u003eMap\u003cnumber, ExtHostParticipantDetector\u003e\"]\n        RelatedFilesProviders[\"_relatedFilesProviders\u003cbr/\u003eMap\u003cnumber, ExtHostRelatedFilesProvider\u003e\"]\n        PromptFileProviders[\"_promptFileProviders\u003cbr/\u003eMap\u003cnumber, provider\u003e\"]\n        \n        InFlightRequests[\"_inFlightRequests\u003cbr/\u003eSet\u003cInFlightChatRequest\u003e\"]\n        SessionDisposables[\"_sessionDisposables\u003cbr/\u003eDisposableResourceMap\"]\n        \n        Emitters[\"onDidChangeChatRequestTools\u003cbr/\u003eonDidDisposeChatSession\"]\n    end\n    \n    subgraph PublicMethods[\"Public API Methods\"]\n        CreateAgent[\"createChatAgent(extension, id, handler)\"]\n        CreateDynamic[\"createDynamicChatAgent(extension, id, props, handler)\"]\n        RegisterDetection[\"registerChatParticipantDetectionProvider()\"]\n        RegisterRelatedFiles[\"registerRelatedFilesProvider()\"]\n        RegisterPromptFile[\"registerPromptFileProvider()\"]\n    end\n    \n    subgraph RPCMethods[\"RPC Methods Called from Main Thread\"]\n        InvokeAgent[\"$invokeAgent(handle, request, context, token)\"]\n        ProvideFollowups[\"$provideFollowups(request, handle, result, context, token)\"]\n        ProvideChatTitle[\"$provideChatTitle(handle, history, token)\"]\n        ReleaseSession[\"$releaseSession(sessionResource)\"]\n    end\n    \n    CreateAgent --\u003e|\"handle = _idPool++\"| AgentsMap\n    CreateDynamic --\u003e|\"handle = _idPool++\"| AgentsMap\n    \n    InvokeAgent --\u003e|\"get from\"| AgentsMap\n    ProvideFollowups --\u003e|\"get from\"| AgentsMap\n    \n    InvokeAgent --\u003e|\"track in\"| InFlightRequests\n    InvokeAgent --\u003e|\"create for session\"| SessionDisposables\n```\n\n**Key responsibilities:**\n1. **Agent Registration**: Maintains `_agents` map with handle as key, `ExtHostChatAgent` as value\n2. **Request Routing**: `$invokeAgent()` routes requests to appropriate agent's `invoke()` method\n3. **Session Management**: `_sessionDisposables` tracks disposables per session URI\n4. **Provider Coordination**: Manages participant detection, related files, and prompt file providers\n5. **Progress Streaming**: Coordinates streaming via `ChatAgentResponseStream.apiObject`\n\n**Sources:** [src/vs/workbench/api/common/extHostChatAgents2.ts:406-457](), [src/vs/workbench/api/common/extHostChatAgents2.ts:504-617]()\n\n### ChatAgentResponseStream\n\nThe `ChatAgentResponseStream` class provides a fluent interface for agents to send incremental responses. It batches progress items in a microtask queue and sends them to the main thread.\n\n#### Response Stream Architecture\n\n```mermaid\ngraph TB\n    subgraph ResponseStreamAPI[\"ChatAgentResponseStream API\"]\n        markdown[\"markdown(value)\"]\n        progress[\"progress(value, task?)\"]\n        thinkingProgress[\"thinkingProgress(delta)\"]\n        reference[\"reference(uri, iconPath)\"]\n        button[\"button(command)\"]\n        textEdit[\"textEdit(uri, edits)\"]\n        confirmation[\"confirmation(title, msg, data)\"]\n        push[\"push(part)\"]\n    end\n    \n    subgraph Internal[\"Internal Implementation\"]\n        sendQueue[\"sendQueue: IChatProgressDto[]\"]\n        notifyQueue[\"notify: Function[]\"]\n        send[\"send(chunk, handle?)\"]\n        queueMicrotask[\"queueMicrotask(() =\u003e ...)\"]\n    end\n    \n    subgraph MainThread[\"Main Thread\"]\n        handleProgressChunk[\"$handleProgressChunk(requestId, chunks)\"]\n    end\n    \n    markdown --\u003e|\"_report()\"| send\n    progress --\u003e|\"_report()\"| send\n    thinkingProgress --\u003e|\"_report()\"| send\n    reference --\u003e|\"_report()\"| send\n    button --\u003e|\"_report()\"| send\n    textEdit --\u003e|\"_report()\"| send\n    confirmation --\u003e|\"_report()\"| send\n    push --\u003e|\"_report()\"| send\n    \n    send --\u003e|\"push to\"| sendQueue\n    send --\u003e|\"schedule\"| queueMicrotask\n    queueMicrotask --\u003e|\"calls\"| handleProgressChunk\n    queueMicrotask --\u003e|\"resolve\"| notifyQueue\n```\n\n**Key implementation details:**\n- **Batching**: Progress items pushed to `sendQueue`, sent in microtask\n- **Task Tracking**: `taskHandlePool` increments for each task with callbacks\n- **Error Handling**: `throwIfDone()` prevents writes after stream closure\n- **Type Conversion**: Uses `typeConvert.*Part.from()` to convert API types to DTOs\n\n**Sources:** [src/vs/workbench/api/common/extHostChatAgents2.ts:43-398]()\n\n### Agent Request Handling\n\nWhen an agent request arrives:\n\n```mermaid\nsequenceDiagram\n    participant Main as MainThread\n    participant ExtHost as ExtHostChatAgents2\n    participant Agent as ExtHostChatAgent\n    participant Handler as Extension Handler\n    participant Stream as ResponseStream\n    \n    Main-\u003e\u003eExtHost: $invokeAgent(handle, request)\n    ExtHost-\u003e\u003eExtHost: Get agent from _agents map\n    ExtHost-\u003e\u003eAgent: invoke(request)\n    Agent-\u003e\u003eAgent: Create ChatAgentResponseStream\n    Agent-\u003e\u003eHandler: requestHandler(request, context, stream, token)\n    \n    loop Streaming Response\n        Handler-\u003e\u003eStream: stream.markdown(\"content\")\n        Stream-\u003e\u003eStream: Queue progress chunk\n        Stream--\u003e\u003eExtHost: Batched progress\n        ExtHost-\u003e\u003eMain: $handleProgressChunk()\n    end\n    \n    Handler--\u003e\u003eAgent: Return result\n    Agent--\u003e\u003eExtHost: Return result\n    ExtHost--\u003e\u003eMain: Return IChatAgentResult\n```\n\n**Sources:** [src/vs/workbench/api/common/extHostChatAgents2.ts:504-617]()\n\n## Agent Service (Main Thread)\n\n### ChatAgentService\n\nThe `ChatAgentService` (`IChatAgentService`) is the central registry for all chat agents in the main thread. It is registered as a singleton in `chat.contribution.ts`.\n\n#### ChatAgentService Architecture\n\n```mermaid\ngraph TB\n    subgraph ChatAgentService[\"ChatAgentService (IChatAgentService)\"]\n        AgentData[\"_agentData\u003cbr/\u003eMap\u003cstring, IChatAgentData\u003e\"]\n        AgentImpls[\"_agentImpls\u003cbr/\u003eMap\u003cstring, IChatAgentImplementation\u003e\"]\n        DefaultAgent[\"_defaultAgentData\"]\n        OnDidChangeAgents[\"onDidChangeAgents: Event\u003cvoid\u003e\"]\n    end\n    \n    subgraph RegistrationMethods[\"Registration Methods\"]\n        registerAgent[\"registerAgent(id, data)\u003cbr/\u003e IDisposable\"]\n        registerAgentImpl[\"registerAgentImplementation(id, impl)\u003cbr/\u003e IDisposable\"]\n        registerDynamic[\"registerDynamicAgent(data, impl)\u003cbr/\u003e IDisposable\"]\n        updateAgent[\"updateAgent(id, metadata)\"]\n    end\n    \n    subgraph RetrievalMethods[\"Retrieval Methods\"]\n        getAgent[\"getAgent(id)\u003cbr/\u003e IChatAgentData | undefined\"]\n        getAgentsByName[\"getAgentsByName(name)\u003cbr/\u003e IChatAgentData[]\"]\n        getDefaultAgent[\"getDefaultAgent(location, mode)\u003cbr/\u003e IChatAgent | undefined\"]\n        getActivatedAgents[\"getActivatedAgents()\u003cbr/\u003e IChatAgent[]\"]\n        agentHasDupeName[\"agentHasDupeName(id)\u003cbr/\u003e boolean\"]\n    end\n    \n    subgraph InvocationMethods[\"Invocation Methods\"]\n        invokeAgent[\"invokeAgent(id, request, progress, history, token)\u003cbr/\u003e Promise\u003cIChatAgentResult\u003e\"]\n        setRequestTools[\"setRequestTools(agent, requestId, tools)\"]\n        getFollowups[\"getFollowups(id, request, result, history, token)\u003cbr/\u003e Promise\u003cIChatFollowup[]\u003e\"]\n        getChatTitle[\"getChatTitle(id, history, token)\u003cbr/\u003e Promise\u003cstring?\u003e\"]\n        getChatSummary[\"getChatSummary(id, history, token)\u003cbr/\u003e Promise\u003cstring?\u003e\"]\n    end\n    \n    registerAgent --\u003e|stores in| AgentData\n    registerAgentImpl --\u003e|stores in| AgentImpls\n    registerDynamic --\u003e|stores in both| AgentData\n    registerDynamic --\u003e|stores in both| AgentImpls\n    \n    getAgent --\u003e|reads from| AgentData\n    invokeAgent --\u003e|reads from| AgentImpls\n```\n\n**Key responsibilities:**\n- **Agent Registry**: Maintains separate maps for agent data (`_agentData`) and implementations (`_agentImpls`)\n- **Default Agent Resolution**: `getDefaultAgent()` finds appropriate agent for location/mode combination\n- **Name Management**: Works with `IChatAgentNameService` to handle duplicate names\n- **Invocation**: `invokeAgent()` delegates to stored `IChatAgentImplementation.invoke()`\n\n**Sources:** [src/vs/workbench/contrib/chat/common/participants/chatAgents.ts:203-279](), [src/vs/workbench/contrib/chat/browser/chat.contribution.ts:34]()\n\n### MainThreadChatAgents2\n\nThe `MainThreadChatAgents2` class acts as the RPC proxy between the main thread and extension host:\n\n**Key state:**\n- `_agents: Map\u003chandle, AgentData\u003e`: Maps RPC handles to agent metadata\n- `_pendingProgress: Map\u003crequestId, { progress, chatSession }\u003e`: Tracks in-flight requests\n- `_activeTasks: Map\u003crequestId, IChatTask\u003e`: Manages long-running tasks\n- `_unresolvedAnchors: Map\u003crequestId, Map\u003canchorId, ref\u003e\u003e`: Tracks async anchor resolution\n\n**Key methods:**\n- `$registerAgent()`: Handles agent registration from extension host\n- `$updateAgent()`: Updates agent metadata\n- `$handleProgressChunk()`: Receives progress from extension host\n- `$invokeAgent()`: Invokes agent in extension host\n\n**Sources:** [src/vs/workbench/api/browser/mainThreadChatAgents2.ts:88-500]()\n\n## Agent Invocation Flow\n\n### Complete Request Flow\n\n```mermaid\nsequenceDiagram\n    participant User\n    participant ChatWidget\n    participant ChatService\n    participant AgentService\n    participant MainThread as MainThreadAgents\n    participant ExtHost as ExtHostAgents\n    participant Extension\n    \n    User-\u003e\u003eChatWidget: Submit chat request\n    ChatWidget-\u003e\u003eChatService: sendRequest(sessionId, message)\n    ChatService-\u003e\u003eChatService: Parse request (agent + command)\n    ChatService-\u003e\u003eAgentService: invokeAgent(id, request, progress)\n    AgentService-\u003e\u003eAgentService: Get implementation\n    AgentService-\u003e\u003eMainThread: invoke(request, progress)\n    MainThread-\u003e\u003eMainThread: Store pending progress\n    MainThread-\u003e\u003eExtHost: $invokeAgent(handle, request, context)\n    ExtHost-\u003e\u003eExtHost: Get agent from map\n    ExtHost-\u003e\u003eExtension: requestHandler(request, context, stream)\n    \n    loop Streaming\n        Extension-\u003e\u003eExtension: Generate response\n        Extension-\u003e\u003eExtHost: stream.markdown(\"text\")\n        ExtHost-\u003e\u003eMainThread: $handleProgressChunk(requestId, chunks)\n        MainThread-\u003e\u003eAgentService: progress(parts)\n        AgentService-\u003e\u003eChatService: Update model\n        ChatService-\u003e\u003eChatWidget: Render update\n    end\n    \n    Extension--\u003e\u003eExtHost: Return result\n    ExtHost--\u003e\u003eMainThread: Return result\n    MainThread--\u003e\u003eAgentService: Return result\n    AgentService--\u003e\u003eChatService: Return result\n    ChatService-\u003e\u003eChatService: Mark request complete\n```\n\n**Sources:** [src/vs/workbench/api/browser/mainThreadChatAgents2.ts:176-191](), [src/vs/workbench/api/common/extHostChatAgents2.ts:504-617]()\n\n### Request Context\n\nAgents receive rich context with each request:\n\n| Context Field | Type | Description |\n|--------------|------|-------------|\n| `prompt` | `string` | User's input text |\n| `command` | `string \\| undefined` | Slash command invoked |\n| `variables` | `ChatVariableMap` | Attached variables (e.g., #file references) |\n| `attempt` | `number` | Retry attempt number |\n| `enableCommandDetection` | `boolean` | Whether to detect commands |\n| `location` | `ChatAgentLocation` | Where request originated |\n| `acceptedConfirmationData` | `any[]` | Confirmed actions |\n| `rejectedConfirmationData` | `any[]` | Rejected actions |\n\n**Sources:** [src/vs/workbench/contrib/chat/common/participants/chatAgents.ts]() (IChatAgentRequest interface)\n\n### Progress Handling\n\nThe main thread buffers and processes progress chunks:\n\n```mermaid\ngraph TB\n    subgraph \"Extension Host\"\n        Stream[\"ResponseStream\"]\n        Queue[\"sendQueue\"]\n    end\n    \n    subgraph \"Progress Types\"\n        Markdown[\"markdownContent\"]\n        Progress[\"progressMessage\"]\n        Reference[\"reference\"]\n        Task[\"progressTask\"]\n        Button[\"commandButton\"]\n        TextEdit[\"textEdit\"]\n        Confirmation[\"confirmation\"]\n    end\n    \n    subgraph \"Main Thread\"\n        Handler[\"$handleProgressChunk()\"]\n        PendingProgress[\"_pendingProgress\"]\n        ActiveTasks[\"_activeTasks\"]\n        ProcessTask[\"Process task handle\"]\n    end\n    \n    Stream --\u003e Queue\n    Queue --\u003e Handler\n    \n    Markdown --\u003e Handler\n    Progress --\u003e Handler\n    Reference --\u003e Handler\n    Task --\u003e Handler\n    Button --\u003e Handler\n    TextEdit --\u003e Handler\n    Confirmation --\u003e Handler\n    \n    Handler --\u003e PendingProgress\n    Handler --\u003e ActiveTasks\n    Handler --\u003e ProcessTask\n```\n\n**Task handling:** When an agent sends a progress task with a callback, the main thread:\n1. Creates a `MainThreadChatTask` to track it\n2. Stores it in `_activeTasks` by task handle\n3. Allows the extension to report incremental progress\n4. Resolves the task when complete\n\n**Sources:** [src/vs/workbench/api/browser/mainThreadChatAgents2.ts:50-86](), [src/vs/workbench/api/browser/mainThreadChatAgents2.ts:256-334]()\n\n## Agent Features\n\n### Slash Commands\n\nAgents can define slash commands that users can invoke:\n\n```typescript\n// Extension API\nconst agent = vscode.chat.createChatParticipant(\"myagent\", handler);\nagent.slashCommands = [\n  {\n    name: \"explain\",\n    description: \"Explain the code\"\n  },\n  {\n    name: \"fix\",\n    description: \"Fix issues in the code\"\n  }\n];\n```\n\nSlash commands are:\n- Registered via `IChatAgentData.slashCommands`\n- Parsed from user input by `ChatRequestParser`\n- Passed to agent in `IChatAgentRequest.command`\n\n**Sources:** [src/vs/workbench/contrib/chat/common/requestParser/chatRequestParser.ts]()\n\n### Follow-up Suggestions\n\nAgents can suggest follow-up questions after completing a response:\n\n```mermaid\nsequenceDiagram\n    participant ChatService\n    participant AgentService\n    participant MainThread\n    participant ExtHost\n    participant Extension\n    \n    ChatService-\u003e\u003eAgentService: Request complete\n    ChatService-\u003e\u003eAgentService: getFollowups(id, request, result)\n    AgentService-\u003e\u003eMainThread: provideFollowups(request, result)\n    MainThread-\u003e\u003eExtHost: $provideFollowups(handle, request, result)\n    ExtHost-\u003e\u003eExtension: followupProvider.provideFollowups(result, context)\n    Extension--\u003e\u003eExtHost: Return followups[]\n    ExtHost--\u003e\u003eMainThread: Return followups\n    MainThread--\u003e\u003eAgentService: Return followups\n    AgentService--\u003e\u003eChatService: Return followups\n    ChatService-\u003e\u003eChatService: Display in UI\n```\n\nFollow-ups can be:\n- Simple text prompts\n- Commands to execute\n- Links to open\n\n**Sources:** [src/vs/workbench/api/browser/mainThreadChatAgents2.ts:192-198]()\n\n### Title and Summary Generation\n\nAgents can generate titles and summaries for chat sessions:\n\n**provideChatTitle()**: Generates a concise title for the session based on history\n**provideChatSummary()**: Generates a longer summary of the conversation\n\nBoth are optional and invoked by the `ChatService` to improve session management.\n\n**Sources:** [src/vs/workbench/api/browser/mainThreadChatAgents2.ts:199-205]()\n\n### Confirmations\n\nAgents can request user confirmation for actions:\n\n```typescript\n// In agent handler\nstream.confirmation(\n  \"Delete Files\",\n  \"This will delete 3 files. Continue?\",\n  { files: [\"a.txt\", \"b.txt\", \"c.txt\"] },\n  [\"Yes\", \"No\"]\n);\n```\n\nThe confirmation data is returned in the next request if accepted:\n\n```typescript\nif (request.acceptedConfirmationData) {\n  // User confirmed - proceed with action\n  const data = request.acceptedConfirmationData[0];\n  // Delete files: data.files\n}\n```\n\n**Sources:** [src/vscode-dts/vscode.proposed.chatParticipantAdditions.d.ts:68-74](), [src/vscode-dts/vscode.proposed.chatParticipantAdditions.d.ts:390-400]()\n\n## Agent Locations and Modes\n\n### Locations\n\nThe `ChatAgentLocation` enum defines where agents can be used throughout VS Code:\n\n| Location | Enum Value | Raw Value | Description |\n|----------|------------|-----------|-------------|\n| Chat Panel/Editor/Quick Chat | `ChatAgentLocation.Chat` | `'panel'` | Main chat view in sidebar, editor, or quick chat |\n| Terminal | `ChatAgentLocation.Terminal` | `'terminal'` | Integrated terminal chat |\n| Notebook | `ChatAgentLocation.Notebook` | `'notebook'` | Notebook cell chat |\n| Inline Editor | `ChatAgentLocation.EditorInline` | `'editor'` | Inline chat in text editor |\n\nThe `ChatAgentLocation.fromRaw()` method converts raw string values (from package.json) to enum values:\n\n```typescript\n// Agent metadata in IChatAgentData\n{\n  id: \"myagent\",\n  locations: [ChatAgentLocation.Chat, ChatAgentLocation.Terminal]\n}\n```\n\n**Sources:** [src/vs/workbench/contrib/chat/common/constants.ts:79-103]()\n\n### Modes\n\nThe `ChatModeKind` enum defines interaction styles. Agents declare supported modes in their `modes` array:\n\n| Mode | Enum Value | Description |\n|------|-----------|-------------|\n| Ask | `ChatModeKind.Ask` (`'ask'`) | Question-answer mode, read-only responses |\n| Edit | `ChatModeKind.Edit` (`'edit'`) | Multi-file editing mode with working set |\n| Agent | `ChatModeKind.Agent` (`'agent'`) | Autonomous agent with tool execution |\n\n**Mode affects:**\n- **Tool availability**: Agent mode enables tools with side effects\n- **UI rendering**: Different execute buttons (`ChatSubmitAction` vs `ChatEditingSessionSubmitAction`)\n- **Auto-approval**: Configuration in `ChatConfiguration.AutoApproveEdits` applies differently per mode\n- **Request handling**: `handleModeSwitch()` checks if session clear is needed when switching modes\n\n```typescript\n// Agent metadata\n{\n  id: \"myagent\",\n  modes: [ChatModeKind.Ask, ChatModeKind.Agent]\n}\n```\n\nThe `validateChatMode()` and `isChatMode()` utility functions validate mode values.\n\n**Sources:** [src/vs/workbench/contrib/chat/common/constants.ts:43-62](), [src/vs/workbench/contrib/chat/browser/actions/chatExecuteActions.ts:242-328]()\n\n## Dynamic Agents and Custom Agents\n\n### Dynamic Agent Registration\n\nDynamic agents are registered at runtime without package.json contributions:\n\n```typescript\n// Extension creates dynamic agent\nconst agent = createDynamicChatAgent(\n  \"myextension.dynamic\",\n  {\n    name: \"dynamic\",\n    description: \"Runtime registered agent\",\n    publisherName: \"My Publisher\",\n    fullName: \"My Dynamic Agent\"\n  },\n  handler\n);\n```\n\nThis allows:\n- Runtime discovery of agents\n- User-defined custom agents\n- Conditional agent registration\n\n**Sources:** [src/vs/workbench/api/common/extHostChatAgents2.ts:453-460](), [src/vs/workbench/api/browser/mainThreadChatAgents2.ts:213-232]()\n\n### Custom Agents Provider\n\nExtensions can provide custom agents dynamically:\n\n```mermaid\ngraph TB\n    subgraph \"Extension\"\n        Provider[\"CustomAgentsProvider\"]\n        ListAgents[\"provideCustomAgents()\"]\n        QueryAgent[\"queryCustomAgent()\"]\n    end\n    \n    subgraph \"Extension Host\"\n        ExtHost[\"ExtHostChatAgents2\"]\n        ProvidersMap[\"_customAgentsProviders\"]\n    end\n    \n    subgraph \"Main Thread\"\n        MainThread[\"MainThreadChatAgents2\"]\n        PromptsService[\"PromptsService\"]\n    end\n    \n    Provider --\u003e ListAgents\n    Provider --\u003e QueryAgent\n    \n    ExtHost --\u003e ProvidersMap\n    ProvidersMap --\u003e Provider\n    \n    MainThread --\u003e ExtHost\n    PromptsService --\u003e MainThread\n```\n\nCustom agent providers enable:\n- User-defined agents from settings/config\n- Repository-specific agents\n- Team-shared agent configurations\n\n**Sources:** [src/vs/workbench/api/common/extHostChatAgents2.ts:482-502](), [src/vs/workbench/api/common/extHostChatAgents2.ts:622-678]()\n\n## Agent Detection and Disambiguation\n\n### Participant Detection\n\nThe system can automatically detect which agent should handle a request via the `IChatParticipantDetectionProvider` interface:\n\n#### Participant Detection Flow\n\n```mermaid\nsequenceDiagram\n    participant User\n    participant ChatService\n    participant AgentService as ChatAgentService\n    participant DetectionProvider as ExtHostParticipantDetector\n    participant Extension\n    \n    User-\u003e\u003eChatService: Submit request without @agent\n    ChatService-\u003e\u003eChatService: Check ChatConfiguration.detectParticipant.enabled\n    ChatService-\u003e\u003eAgentService: detectAgentOrCommand(request, history, location, token)\n    AgentService-\u003e\u003eAgentService: hasChatParticipantDetectionProviders() == true?\n    AgentService-\u003e\u003eDetectionProvider: provideParticipant(request, context, token)\n    DetectionProvider-\u003e\u003eExtension: provider.provideParticipant(...)\n    Extension-\u003e\u003eExtension: Analyze request.prompt intent\n    Extension--\u003e\u003eDetectionProvider: Return {participant: \"workspace\"}\n    DetectionProvider--\u003e\u003eAgentService: Return {agent, command}\n    AgentService--\u003e\u003eChatService: Return detected agent\n    ChatService-\u003e\u003eAgentService: invokeAgent(detectedAgentId, ...)\n```\n\nExtensions register detection providers via `registerChatParticipantDetectionProvider()`:\n\n```typescript\n// Extension code\nconst provider: vscode.ChatParticipantDetectionProvider = {\n  provideParticipant(request, context, token) {\n    // Analyze request and return appropriate agent\n    if (request.prompt.toLowerCase().includes(\"workspace\")) {\n      return { participant: \"workspace\" };\n    }\n    return undefined;\n  }\n};\n\nconst disposable = vscode.chat.registerChatParticipantDetectionProvider(provider);\n```\n\nThe `ExtHostChatAgents2` class maintains `_participantDetectionProviders` map and routes requests to registered providers via `$detectAgentOrCommand()`.\n\n**Sources:** [src/vs/workbench/api/common/extHostChatAgents2.ts:480-488](), [src/vs/workbench/api/common/extHostChatAgents2.ts:714-733](), [src/vs/workbench/contrib/chat/common/participants/chatAgents.ts:281-283]()\n\n### Agent Name Service\n\nThe `ChatAgentNameService` manages agent naming and disambiguation:\n\n**Key responsibilities:**\n- Maintains registry of agent names\n- Detects name collisions\n- Generates unique display names\n- Handles agent disambiguation entries\n\nWhen multiple agents have similar names, the service ensures they have unique display names.\n\n**Sources:** [src/vs/workbench/contrib/chat/browser/chat.contribution.ts:34]()\n\n### Disambiguation\n\nAgents can provide disambiguation metadata to help users choose:\n\n```typescript\n{\n  id: \"myagent\",\n  disambiguation: [\n    {\n      category: \"code\",\n      description: \"Helps with code questions\",\n      examples: [\"explain function\", \"find bugs\"]\n    }\n  ]\n}\n```\n\nThis metadata is used in agent selection UI and detection.\n\n**Sources:** [src/vs/workbench/contrib/chat/common/participants/chatAgents.ts]() (IChatAgentData interface)\n\n## Related Files Provider\n\nExtensions can provide related files that might be useful context for chat requests:\n\n```mermaid\ngraph LR\n    subgraph \"Extension\"\n        Provider[\"ChatRelatedFilesProvider\"]\n        ProvideFiles[\"provideRelatedFiles(request)\"]\n    end\n    \n    subgraph \"Extension Host\"\n        ExtHost[\"ExtHostChatAgents2\"]\n        ProvidersMap[\"_relatedFilesProviders\"]\n    end\n    \n    subgraph \"Main Thread\"\n        MainThread[\"MainThreadChatAgents2\"]\n        ChatEditing[\"ChatEditingService\"]\n    end\n    \n    Provider --\u003e ProvideFiles\n    ExtHost --\u003e ProvidersMap\n    ProvidersMap --\u003e Provider\n    MainThread --\u003e ExtHost\n    ChatEditing --\u003e MainThread\n```\n\nRelated files providers allow extensions to:\n- Suggest relevant files based on request content\n- Provide workspace context\n- Include dependencies automatically\n\n**Sources:** [src/vs/workbench/api/common/extHostChatAgents2.ts:472-480](), [src/vs/workbench/api/common/extHostChatAgents2.ts:504-556]()\n\n## Agent Sessions and History\n\n### Session Management\n\nChat sessions maintain history that is passed to agents:\n\n```typescript\ninterface IChatAgentHistoryEntry {\n  request: IChatAgentRequest;\n  response: IChatContentResponse;\n  result: IChatAgentResult;\n}\n```\n\nAgents receive the full conversation history, allowing them to:\n- Maintain context across turns\n- Reference previous responses\n- Adapt behavior based on conversation flow\n\n**Sources:** [src/vs/workbench/contrib/chat/common/participants/chatAgents.ts]() (IChatAgentHistoryEntry interface)\n\n### Session Disposal\n\nWhen a chat session is disposed:\n\n```mermaid\nsequenceDiagram\n    participant ChatService\n    participant MainThread\n    participant ExtHost\n    participant SessionDisposables\n    \n    ChatService-\u003e\u003eChatService: disposeSession(sessionResource)\n    ChatService-\u003e\u003eMainThread: Emit onDidDisposeSession\n    MainThread-\u003e\u003eExtHost: $releaseSession(sessionResource)\n    ExtHost-\u003e\u003eSessionDisposables: Dispose session-specific resources\n    ExtHost-\u003e\u003eExtHost: Clean up _sessionDisposables\n```\n\nThis ensures proper cleanup of:\n- Progress handlers\n- Active tasks\n- Session-specific state\n\n**Sources:** [src/vs/workbench/api/browser/mainThreadChatAgents2.ts:126-131](), [src/vs/workbench/api/common/extHostChatAgents2.ts:404]()\n\n## Agent Metadata and Configuration\n\n### Agent Metadata\n\nAgents can specify various metadata properties:\n\n| Property | Type | Description |\n|----------|------|-------------|\n| `isSticky` | `boolean` | Agent persists as default in session |\n| `isDefault` | `boolean` | Default agent for location/mode |\n| `requiresCopilotPlan` | `boolean` | Requires paid plan |\n| `supportIssueReporting` | `boolean` | Supports issue reporting |\n| `supportsSlowVariables` | `boolean` | Can handle slow variable resolution |\n\n**Sources:** [src/vs/workbench/contrib/chat/common/participants/chatAgents.ts]() (IChatAgentMetadata interface)\n\n### User Actions and Feedback\n\nAgents receive feedback when users interact with responses:\n\n```typescript\n// Agent receives feedback\nagent.onDidPerformAction((e: ChatUserActionEvent) =\u003e {\n  if (e.action.kind === 'vote') {\n    // User voted on response\n    const direction = e.action.direction; // up or down\n  } else if (e.action.kind === 'command') {\n    // User executed a command\n  }\n});\n```\n\nThis enables agents to:\n- Learn from user feedback\n- Track which responses are helpful\n- Improve over time\n\n**Sources:** [src/vs/workbench/api/browser/mainThreadChatAgents2.ts:132-144](), [src/vscode-dts/vscode.proposed.chatParticipantAdditions.d.ts:8-10]()"])</script><script>self.__next_f.push([1,"3c:T6f3b,"])</script><script>self.__next_f.push([1,"# Chat Request and Response Flow\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [src/vs/workbench/api/browser/mainThreadChatAgents2.ts](src/vs/workbench/api/browser/mainThreadChatAgents2.ts)\n- [src/vs/workbench/api/common/extHostChatAgents2.ts](src/vs/workbench/api/common/extHostChatAgents2.ts)\n- [src/vs/workbench/contrib/chat/browser/actions/chatActions.ts](src/vs/workbench/contrib/chat/browser/actions/chatActions.ts)\n- [src/vs/workbench/contrib/chat/browser/actions/chatExecuteActions.ts](src/vs/workbench/contrib/chat/browser/actions/chatExecuteActions.ts)\n- [src/vs/workbench/contrib/chat/browser/agentSessions/localAgentSessionsProvider.ts](src/vs/workbench/contrib/chat/browser/agentSessions/localAgentSessionsProvider.ts)\n- [src/vs/workbench/contrib/chat/browser/chat.contribution.ts](src/vs/workbench/contrib/chat/browser/chat.contribution.ts)\n- [src/vs/workbench/contrib/chat/browser/chat.ts](src/vs/workbench/contrib/chat/browser/chat.ts)\n- [src/vs/workbench/contrib/chat/common/constants.ts](src/vs/workbench/contrib/chat/common/constants.ts)\n- [src/vs/workbench/contrib/chat/test/common/voiceChatService.test.ts](src/vs/workbench/contrib/chat/test/common/voiceChatService.test.ts)\n- [src/vs/workbench/services/chat/common/chatEntitlementService.ts](src/vs/workbench/services/chat/common/chatEntitlementService.ts)\n- [src/vscode-dts/vscode.proposed.chatParticipantAdditions.d.ts](src/vscode-dts/vscode.proposed.chatParticipantAdditions.d.ts)\n- [src/vscode-dts/vscode.proposed.defaultChatParticipant.d.ts](src/vscode-dts/vscode.proposed.defaultChatParticipant.d.ts)\n\n\u003c/details\u003e\n\n\n\nThis document describes how chat requests are submitted, processed, and how responses stream back to the user. It covers the flow from user input through request processing to response rendering, including progress updates and streaming content.\n\nFor information about the overall chat system architecture, see [Chat System Architecture](#10.1). For details about chat agents and how they're implemented, see [Chat Agents and Participants](#10.2). For information about the UI components that render chat content, see [Chat UI Components](#10.4).\n\n## Overview\n\nThe chat request and response flow encompasses:\n- Request submission from the input field\n- Request parsing and validation\n- Routing to appropriate agents or language models\n- Response streaming with progress updates\n- Rendering of streamed content\n- Cancellation and error handling\n\nThe system uses an asynchronous streaming model where responses are delivered incrementally as chunks (`IChatProgress`) rather than waiting for completion.\n\n## Request Submission Flow\n\n### Input Collection and Validation\n\nChat submission is triggered by user actions (Enter key or submit button click). The primary action classes are `ChatSubmitAction` (for Ask mode) and `ChatEditingSessionSubmitAction` (for Edit/Agent modes).\n\n```mermaid\ngraph TB\n    User[\"User Action\"]\n    SubmitAction[\"ChatSubmitAction.run()\"]\n    Widget[\"IChatWidget\"]\n    GetInput[\"widget.getInput()\"]\n    AttachmentModel[\"widget.attachmentModel\"]\n    AcceptInput[\"widget.acceptInput(query, options)\"]\n    Service[\"IChatService.sendRequest()\"]\n    Model[\"IChatModel.addRequest()\"]\n    RequestModel[\"ChatRequestModel\"]\n    \n    User --\u003e|\"Enter or Click Send\"| SubmitAction\n    SubmitAction --\u003e|\"context?.widget ?? widgetService.lastFocusedWidget\"| Widget\n    Widget --\u003e GetInput\n    Widget --\u003e AttachmentModel\n    SubmitAction --\u003e|\"calls\"| AcceptInput\n    AcceptInput --\u003e|\"IChatSendRequestOptions\"| Service\n    Service --\u003e|\"creates and adds\"| Model\n    Model --\u003e RequestModel\n```\n\n**Request Submission Flow: Action to Model**\n\nThe submission process:\n\n1. **Action Invocation**: `ChatSubmitAction.run()` or `ChatEditingSessionSubmitAction.run()` is triggered\n2. **Widget Resolution**: Action resolves the active `IChatWidget` from context or `IChatWidgetService.lastFocusedWidget`\n3. **Input Gathering**: `widget.getInput()` retrieves the input text; `widget.attachmentModel` provides attached files, variables, and tools\n4. **Accept Input**: `widget.acceptInput(query, options)` processes the input with options like `noCommandDetection`, `isVoiceInput`, `enableImplicitContext`\n5. **Service Call**: Widget calls `IChatService.sendRequest()` with parsed request data\n6. **Model Creation**: Service creates a `ChatRequestModel` and adds it to the session's `IChatModel` via `addRequest()`\n\nSources: [src/vs/workbench/contrib/chat/browser/actions/chatExecuteActions.ts:46-147](), [src/vs/workbench/contrib/chat/browser/chat.ts:286-287]()\n\n### Request Data Structure\n\nA `ChatRequestModel` contains:\n\n| Component | Type | Description |\n|-----------|------|-------------|\n| `message` | `IParsedChatRequest` | Parsed request with text parts, agent references, slash commands |\n| `variableData` | `IChatRequestVariableData` | Attached context (files via `attachedContext`, tools via `toolReferences`) |\n| `attempt` | `number` | Retry counter for failed requests (default 0) |\n| `modeInfo` | `IChatRequestModeInfo` | Mode kind (Ask/Edit/Agent) with instructions and custom agent data |\n| `locationData` | `IChatLocationData` | Location-specific context for Chat, Terminal, Notebook, or EditorInline |\n| `confirmation` | `string \\| undefined` | Optional confirmation text from user action |\n\nThe `IChatSendRequestOptions` interface used when calling `sendRequest()` includes:\n\n| Option | Type | Description |\n|--------|------|-------------|\n| `agentId` | `string` | Override the default agent for this request |\n| `slashCommand` | `string` | Specific slash command to execute |\n| `attempt` | `number` | Retry attempt number |\n| `location` | `ChatAgentLocation` | Location context (Chat/Terminal/Notebook/EditorInline) |\n| `acceptedConfirmationData` | `any[]` | Data from accepted confirmations |\n| `rejectedConfirmationData` | `any[]` | Data from rejected confirmations |\n\nSources: [src/vs/workbench/contrib/chat/browser/actions/chatExecuteActions.ts:40-44](), [src/vs/workbench/contrib/chat/common/chatService/chatService.ts:412-438]()\n\n## Request Processing and Agent Routing\n\n### Service-Level Processing\n\nThe `ChatService.sendRequest()` method in `ChatServiceImpl` orchestrates the entire request lifecycle:\n\n```mermaid\ngraph TB\n    SendRequest[\"ChatServiceImpl.sendRequest()\"]\n    AddRequest[\"model.addRequest()\"]\n    CreateRequest[\"new CancellableRequest()\"]\n    ResolveAgent[\"chatAgentService.invokeAgent()\"]\n    AgentImpl[\"IChatAgentImplementation.invoke()\"]\n    ProgressLoop[\"for await (progress of request)\"]\n    HandleProgress[\"handleProgress()\"]\n    UpdateContent[\"response.updateContent()\"]\n    Complete[\"response.completeResponse()\"]\n    \n    SendRequest --\u003e AddRequest\n    AddRequest --\u003e|\"creates ChatRequestModel, ChatResponseModel\"| SendRequest\n    SendRequest --\u003e CreateRequest\n    CreateRequest --\u003e|\"CancellationToken\"| ResolveAgent\n    ResolveAgent --\u003e AgentImpl\n    AgentImpl --\u003e|\"async generator\"| ProgressLoop\n    ProgressLoop --\u003e|\"each chunk\"| HandleProgress\n    HandleProgress --\u003e UpdateContent\n    ProgressLoop --\u003e|\"stream ends\"| Complete\n```\n\n**ChatService Request Processing Flow**\n\nThe routing and processing logic:\n\n1. **Model Updates**: `model.addRequest()` creates both `ChatRequestModel` and `ChatResponseModel` entries\n2. **Cancellation Setup**: `CancellableRequest` wraps a `CancellationTokenSource` for request cancellation\n3. **Agent Resolution**: `chatAgentService.invokeAgent()` determines agent based on `agentId` from options or parsed request\n4. **Implementation Invocation**: Calls `IChatAgentImplementation.invoke()` which returns an async generator of progress chunks\n5. **Progress Iteration**: `for await (const progress of request)` consumes the stream asynchronously\n6. **Content Updates**: Each chunk triggers `response.updateContent()` which fires change events for UI rendering\n7. **Completion**: When stream ends, `response.completeResponse(result)` marks response as complete\n\nSources: [src/vs/workbench/contrib/chat/common/chatService/chatService.ts:412-438](), [src/vs/workbench/contrib/chat/browser/actions/chatExecuteActions.ts:46-147]()\n\n### Extension Host Communication\n\nExtension-contributed agents execute in the extension host process. The request and response flow crosses the IPC boundary:\n\n```mermaid\ngraph TB\n    MainThreadImpl[\"IChatAgentImplementation.invoke()\"]\n    ProxyInvoke[\"proxy.$invokeAgent(handle, request)\"]\n    ExtHostInvoke[\"ExtHostChatAgents2.$invokeAgent()\"]\n    AgentHandler[\"Extension's ChatExtendedRequestHandler\"]\n    ResponseStream[\"ChatAgentResponseStream\"]\n    StreamAPI[\"stream.markdown()/progress()/etc\"]\n    SendQueue[\"sendQueue array\"]\n    ProxyProgress[\"proxy.$handleProgressChunk()\"]\n    MainThreadProgress[\"MainThreadChatAgents2.$handleProgressChunk()\"]\n    PendingProgress[\"_pendingProgress.get(requestId)\"]\n    \n    MainThreadImpl --\u003e|\"RPC call\"| ProxyInvoke\n    ProxyInvoke --\u003e ExtHostInvoke\n    ExtHostInvoke --\u003e|\"calls handler(request, context, stream, token)\"| AgentHandler\n    AgentHandler --\u003e StreamAPI\n    StreamAPI --\u003e ResponseStream\n    ResponseStream --\u003e|\"batches in microtask\"| SendQueue\n    SendQueue --\u003e|\"RPC call\"| ProxyProgress\n    ProxyProgress --\u003e MainThreadProgress\n    MainThreadProgress --\u003e PendingProgress\n    PendingProgress --\u003e|\"progress(parts)\"| MainThreadImpl\n```\n\n**Extension Host Agent RPC Communication**\n\nKey implementation details:\n\n1. **Registration**: Extensions call `vscode.chat.createChatParticipant()` which registers via `ExtHostChatAgents2.createChatAgent()`\n2. **Agent Storage**: `_agents` Map stores agents by handle; `MainThreadChatAgents2` registers via `$registerAgent(handle, id, metadata)`\n3. **Invocation**: Main thread calls `proxy.$invokeAgent(handle, request, context, token)` across IPC boundary\n4. **Handler Execution**: Extension's `ChatExtendedRequestHandler` receives request and `ChatResponseStream` object\n5. **Stream API**: Extension calls methods like `stream.markdown()`, `stream.progress()`, `stream.reference()` to send chunks\n6. **Batch Queueing**: `ChatAgentResponseStream` queues chunks in `sendQueue` array, sends batch in microtask via `queueMicrotask()`\n7. **Progress Delivery**: `proxy.$handleProgressChunk(requestId, chunks)` delivers batched chunks back to main thread\n8. **Progress Resolution**: `MainThreadChatAgents2.$handleProgressChunk()` resolves request from `_pendingProgress` and calls `progress()`\n\nSources: [src/vs/workbench/api/browser/mainThreadChatAgents2.ts:182-194](), [src/vs/workbench/api/common/extHostChatAgents2.ts:462-478](), [src/vs/workbench/api/common/extHostChatAgents2.ts:86-112]()\n\n## Response Streaming\n\n### Progress Chunk Types\n\nResponses consist of `IChatProgress` union type chunks. The `kind` discriminator determines the chunk type:\n\n| Kind | Type/Interface | Extension API | Description |\n|------|----------------|---------------|-------------|\n| `markdownContent` | `IChatMarkdownContent` | `stream.markdown()` | Markdown text content |\n| `markdownVuln` | `IChatMarkdownContent` | `stream.markdownWithVulnerabilities()` | Markdown with vulnerability annotations |\n| `toolInvocation` | `IChatToolInvocation` | `stream.push(new ChatToolInvocationPart())` | Tool call display with invocation details |\n| `beginToolInvocation` | - | `stream.beginToolInvocation()` | Start streaming tool invocation |\n| `updateToolInvocation` | - | `stream.updateToolInvocation()` | Update streaming tool args |\n| `reference` | `IChatContentReference` | `stream.reference()` | File/URI/variable reference |\n| `progressMessage` | `IChatProgressMessage` | `stream.progress()` | Status message (e.g., \"Analyzing...\") |\n| `progressTask` | `IChatTask` | `stream.progress(msg, task)` | Long-running task with sub-progress |\n| `warning` | `IChatWarningMessage` | `stream.warning()` | Warning to display |\n| `command` | `IChatCommandButton` | `stream.button()` | Executable command button |\n| `textEdit` | `IChatTextEdit` | `stream.textEdit()` | File edits with TextEdit[] |\n| `confirmation` | `IChatConfirmation` | `stream.confirmation()` | User confirmation prompt |\n| `agentDetection` | `IChatAgentDetection` | - | Detected agent/command suggestion |\n\nThe `IChatProgressDto` type used in RPC has additional internal kinds like `clearToPreviousToolInvocation` for stream control.\n\nSources: [src/vs/workbench/api/common/extHost.protocol.ts:30-43](), [src/vscode-dts/vscode.proposed.chatParticipantAdditions.d.ts:294-374]()\n\n### Response Model Updates\n\nThe `ChatResponseModel` accumulates progress chunks as they arrive:\n\n```mermaid\ngraph TB\n    AgentYield[\"Agent yields IChatProgress\"]\n    ServiceLoop[\"for await (progress of request)\"]\n    HandleProgress[\"handleProgress(progress)\"]\n    UpdateContent[\"response.updateContent(progress)\"]\n    ResponseRepr[\"_responseRepr array\"]\n    FireChange[\"_onDidChange.fire(reason)\"]\n    ChatList[\"ChatListItemRenderer\"]\n    DiffParts[\"_diffContentParts()\"]\n    RenderPart[\"renderPart(element, part)\"]\n    \n    AgentYield --\u003e ServiceLoop\n    ServiceLoop --\u003e HandleProgress\n    HandleProgress --\u003e UpdateContent\n    UpdateContent --\u003e ResponseRepr\n    ResponseRepr --\u003e|\"appends chunk\"| UpdateContent\n    UpdateContent --\u003e FireChange\n    FireChange --\u003e|\"ChatResponseChangeEvent\"| ChatList\n    ChatList --\u003e DiffParts\n    DiffParts --\u003e|\"new or modified parts\"| RenderPart\n```\n\n**Response Model Update Mechanism**\n\nThe update flow:\n\n1. **Progress Reception**: `for await (const progress of request)` loop in `ChatServiceImpl.sendRequest()` receives chunks\n2. **Handle Progress**: `handleProgress()` processes special chunk types (e.g., tool invocations, confirmations)\n3. **Update Content**: `response.updateContent(progress)` appends chunk to `_responseRepr` array\n4. **Fire Change**: Emits `_onDidChange.fire(event)` with `ChatResponseModelChangeReason` (Content/ResponseComplete/Progressive)\n5. **Renderer Notification**: `ChatListItemRenderer` observes `response.onDidChange` event\n6. **Part Diffing**: `_diffContentParts()` compares current `_responseRepr` to previously rendered parts\n7. **Incremental Render**: Only new or changed parts trigger `renderPart()` to update DOM\n\nThe `ChatResponseModelChangeReason` enum values:\n- `Content`: New content added\n- `ResponseComplete`: Response finished\n- `Progressive`: Progressive update (multiple chunks batched)\n- `ToolInvocation`: Tool call updated\n\nSources: [src/vs/workbench/contrib/chat/browser/actions/chatExecuteActions.ts:46-147](), [src/vscode-dts/vscode.proposed.chatParticipantAdditions.d.ts:294-374]()\n\n### Streaming Implementation Details\n\nThe streaming mechanism uses async generators and microtask batching for efficiency:\n\n```mermaid\ngraph TB\n    ExtensionStream[\"Extension: stream.markdown(text)\"]\n    ThrowIfDone[\"throwIfDone() check\"]\n    ReportCall[\"_report(dto)\"]\n    SendFunc[\"send(chunk) or send(chunk, handle)\"]\n    SendQueue[\"sendQueue.push()\"]\n    Microtask[\"queueMicrotask()\"]\n    ProxyCall[\"proxy.$handleProgressChunk(requestId, sendQueue)\"]\n    MainThread[\"MainThreadChatAgents2.$handleProgressChunk()\"]\n    PendingProgress[\"_pendingProgress.get(requestId).progress(parts)\"]\n    \n    ExtensionStream --\u003e ThrowIfDone\n    ThrowIfDone --\u003e ReportCall\n    ReportCall --\u003e|\"converts to IChatProgressDto\"| SendFunc\n    SendFunc --\u003e SendQueue\n    SendQueue --\u003e|\"first item schedules\"| Microtask\n    Microtask --\u003e|\"batches all queued items\"| ProxyCall\n    ProxyCall --\u003e|\"RPC call\"| MainThread\n    MainThread --\u003e PendingProgress\n```\n\n**Extension Host Streaming with Batching**\n\nKey implementation details:\n\n1. **Stream Closure Check**: Every stream method calls `throwIfDone()` to ensure stream isn't closed\n2. **DTO Conversion**: `_report()` converts extension API types to `IChatProgressDto` using `typeConvert.*` converters\n3. **Send Queue**: Chunks are pushed to `sendQueue` array; first push schedules a microtask\n4. **Microtask Batching**: `queueMicrotask()` batches all queued chunks into single RPC call\n5. **Promise Resolution**: For tasks, `send(chunk, handle)` returns `Promise\u003cvoid\u003e` that resolves when chunk is sent\n6. **RPC Delivery**: Batched array sent via `proxy.$handleProgressChunk(requestId, sendQueue)`\n7. **Main Thread Processing**: `MainThreadChatAgents2` looks up pending request and calls `progress(parts)` callback\n8. **Completion**: When extension's handler returns, `finally` block in `ExtHostChatAgents2` calls `stream.close()`\n\nThe `sendQueue` can contain either plain `IChatProgressDto` or tuples `[IChatProgressDto, number]` for task handles.\n\nSources: [src/vs/workbench/api/common/extHostChatAgents2.ts:89-112](), [src/vs/workbench/api/browser/mainThreadChatAgents2.ts:262-295]()\n\n## Progress Update Rendering\n\n### Content Part System\n\nEach progress chunk type is rendered by a corresponding content part:\n\n| Progress Type | Content Part Class | Rendered As |\n|---------------|-------------------|-------------|\n| `markdownContent` | `ChatMarkdownContentPart` | Formatted markdown text |\n| `toolInvocation` | `ChatToolInvocationPart` | Expandable tool call details |\n| `reference` | `ChatCollapsibleListContentPart` | List of file/URI references |\n| `progressMessage` | `ChatProgressContentPart` | Inline status message |\n| `textEdit` | `ChatTextEditContentPart` | File diff preview |\n| `confirmation` | `ChatConfirmationContentPart` | Confirmation dialog buttons |\n| `thinking` | `ChatThinkingContentPart` | Thinking/reasoning display |\n\nSources: [src/vs/workbench/contrib/chat/browser/chatListRenderer.ts:715-990]()\n\n### Progressive Rendering\n\nThe renderer implements progressive rendering to avoid blocking:\n\n```mermaid\ngraph TB\n    Renderer[\"ChatListRenderer\"]\n    RenderElement[\"renderElement()\"]\n    DiffParts[\"_diffContentParts()\"]\n    RenderPart[\"renderPart()\"]\n    UpdateHeight[\"_onDidChangeItemHeight.fire()\"]\n    \n    Renderer --\u003e|\"on model change\"| RenderElement\n    RenderElement --\u003e DiffParts\n    DiffParts --\u003e|\"reuses existing parts\"| DiffParts\n    DiffParts --\u003e|\"creates new parts\"| RenderPart\n    RenderPart --\u003e|\"DOM update\"| RenderPart\n    RenderPart --\u003e UpdateHeight\n```\n\n**Progressive Rendering with Part Reuse**\n\nOptimization strategies:\n\n- **Part Diffing**: `_diffContentParts()` compares old and new content to minimize DOM updates\n- **Part Reuse**: Existing content parts are reused when content matches\n- **Incremental Layout**: Only changed parts trigger layout recalculation\n- **Rate Control**: Progressive rendering rate is computed based on implied word load rate\n\nSources: [src/vs/workbench/contrib/chat/browser/chatListRenderer.ts:715-990](), [src/vs/workbench/contrib/chat/browser/chatListRenderer.ts:261-283]()\n\n## Request Cancellation\n\n### Cancellation Flow\n\nRequest cancellation is managed through the `CancellableRequest` class:\n\n```mermaid\ngraph TB\n    UserAction[\"User clicks Stop or ESC\"]\n    CancelAction[\"CancelAction.run()\"]\n    ChatService[\"chatService.cancelRequest()\"]\n    LookupRequest[\"_pendingRequests.get(sessionId)\"]\n    RequestCancel[\"request.cancel()\"]\n    TokenCancel[\"_tokenSource.cancel()\"]\n    AgentCheck[\"Agent checks token.isCancellationRequested\"]\n    ToolCancel[\"languageModelToolsService.cancelToolCallsForRequest()\"]\n    ResponseUpdate[\"response.cancel()\"]\n    SetState[\"_state = ResponseModelState.Cancelled\"]\n    \n    UserAction --\u003e CancelAction\n    CancelAction --\u003e ChatService\n    ChatService --\u003e LookupRequest\n    LookupRequest --\u003e RequestCancel\n    RequestCancel --\u003e TokenCancel\n    RequestCancel --\u003e ToolCancel\n    TokenCancel --\u003e|\"signal propagates\"| AgentCheck\n    AgentCheck --\u003e|\"stops yielding progress\"| ResponseUpdate\n    ResponseUpdate --\u003e SetState\n```\n\n**Cancellation Request Flow**\n\nCancellation implementation:\n\n1. **User Trigger**: User clicks stop button (triggers `CancelAction`) or presses Escape in chat input\n2. **Service Lookup**: `ChatServiceImpl.cancelRequest()` retrieves `CancellableRequest` from `_pendingRequests` Map by session ID\n3. **Request Cancel**: Calls `request.cancel()` which cancels both the `CancellationTokenSource` and any active tools\n4. **Token Signal**: `_tokenSource.cancel()` sets `isCancellationRequested` flag on token\n5. **Tool Cancellation**: `ILanguageModelToolsService.cancelToolCallsForRequest(requestId)` cancels pending tool invocations\n6. **Agent Termination**: Agent's async generator checks `token.isCancellationRequested` and stops yielding chunks\n7. **Response State**: `response.cancel()` sets `_state = ResponseModelState.Cancelled` and `isCanceled = true`\n8. **UI Update**: Response footer shows \"Cancelled\" status; partial content remains visible\n\nThe `CancellableRequest` class wraps:\n- `_tokenSource: CancellationTokenSource` - cancellation token\n- `token: CancellationToken` - readonly token reference\n- `cancel()` - cancels token and tools\n\nSources: [src/vs/workbench/contrib/chat/browser/actions/chatExecuteActions.ts:694-728](), [src/vs/workbench/contrib/chat/browser/actions/chatActions.ts:176-360]()\n\n### Partial Response Handling\n\nWhen cancelled, the response preserves any content received before cancellation:\n\n- Response state becomes `ResponseModelState.Cancelled`\n- Existing progress chunks remain in the response\n- `result.errorDetails` may include cancellation reason\n- UI shows \"Cancelled\" indicator in response footer\n\nSources: [src/vs/workbench/contrib/chat/common/chatModel.ts:1361-1389]()\n\n## Error Handling\n\n### Error Response Flow\n\nErrors during agent invocation are captured and stored in the response result:\n\n```mermaid\ngraph TB\n    AgentInvoke[\"agent.invoke()\"]\n    TryCatch[\"try/catch in sendRequest()\"]\n    ErrorThrown[\"Error thrown\"]\n    ToErrorMessage[\"toErrorMessage(err)\"]\n    ErrorDetails[\"IChatResponseErrorDetails\"]\n    AgentResult[\"IChatAgentResult\"]\n    CompleteResponse[\"response.completeResponse(result)\"]\n    SetErrorDetails[\"response.setErrorDetails()\"]\n    FireChange[\"_onDidChange.fire()\"]\n    ErrorPart[\"ChatErrorContentPart\"]\n    \n    AgentInvoke --\u003e TryCatch\n    TryCatch --\u003e|\"catch\"| ErrorThrown\n    ErrorThrown --\u003e ToErrorMessage\n    ToErrorMessage --\u003e ErrorDetails\n    ErrorDetails --\u003e AgentResult\n    AgentResult --\u003e CompleteResponse\n    CompleteResponse --\u003e SetErrorDetails\n    SetErrorDetails --\u003e FireChange\n    FireChange --\u003e|\"renders\"| ErrorPart\n```\n\n**Error Capture and Display Flow**\n\nError handling structure:\n\n1. **Exception Capture**: `try/catch` around `for await (progress of request)` loop catches agent errors\n2. **Error Conversion**: `toErrorMessage(err)` extracts error message from Error object\n3. **Error Details**: Creates `IChatResponseErrorDetails` with error information\n4. **Result Creation**: Wraps error details in `IChatAgentResult` object\n5. **Response Completion**: `response.completeResponse(result)` stores result with error\n6. **State Update**: Error responses still reach `Complete` state (not `Failed`) if agent returned partial content\n7. **UI Rendering**: `ChatErrorContentPart` displays error with optional action buttons\n\nThe `IChatResponseErrorDetails` interface:\n\n| Field | Type | Description |\n|-------|------|-------------|\n| `message` | `string` | Human-readable error description |\n| `responseIsIncomplete` | `boolean` | True if partial response was received before error |\n| `responseIsFiltered` | `boolean` | True if content filtered by safety systems |\n| `isQuotaExceeded` | `boolean` | True if user exceeded usage quota |\n| `level` | `'Info' \\| 'Warning' \\| 'Error'` | Error severity level |\n| `confirmationButtons` | `string[]` | Optional action buttons for recovery |\n\nSources: [src/vs/workbench/contrib/chat/browser/actions/chatExecuteActions.ts:46-147](), [src/vscode-dts/vscode.proposed.chatParticipantAdditions.d.ts:1-43]()\n\n### Error Recovery\n\nThe system supports several error recovery mechanisms:\n\n- **Retry**: User can retry the same request (increments `attempt` counter)\n- **Edit and Retry**: User can modify request before retrying\n- **Alternative Model**: Error UI may offer model selection if quota exceeded\n- **Confirmation Actions**: Custom actions defined in error details\n\nSources: [src/vs/workbench/contrib/chat/browser/chatWidget.ts:2026-2096]()\n\n## Response Completion\n\n### Completion States\n\nThe `ChatResponseModel._state` field tracks response lifecycle:\n\n| State | Enum Value | Description |\n|-------|------------|-------------|\n| Incomplete | `ResponseModelState.Incomplete` | Still receiving progress chunks (initial state) |\n| Pending | `ResponseModelState.Pending` | Agent finished, awaiting follow-up action |\n| Complete | `ResponseModelState.Complete` | Successfully completed |\n| Cancelled | `ResponseModelState.Cancelled` | User cancelled via stop button or ESC |\n| Failed | `ResponseModelState.Failed` | Agent failed with error |\n| NeedsInput | `ResponseModelState.NeedsInput` | Waiting for user confirmation/input |\n\nAdditionally, `isPendingConfirmation` observable tracks when confirmations need user action (separate from state).\n\nSources: [src/vs/workbench/contrib/chat/common/chatService/chatService.ts:90-97]()\n\n### Completion Process\n\nResponse completion occurs when the agent's async generator finishes:\n\n```mermaid\ngraph TB\n    StreamEnd[\"Agent generator completes\"]\n    FinallyBlock[\"finally { } block\"]\n    CompleteResponse[\"response.completeResponse(result)\"]\n    SetResult[\"_result = result\"]\n    SetTimings[\"_result.timings\"]\n    UpdateState[\"_state = Complete\"]\n    AddFollowups[\"_followups = result.followups\"]\n    FireChange[\"_onDidChange.fire(ResponseComplete)\"]\n    Telemetry[\"Record telemetry\"]\n    \n    StreamEnd --\u003e FinallyBlock\n    FinallyBlock --\u003e CompleteResponse\n    CompleteResponse --\u003e SetResult\n    SetResult --\u003e SetTimings\n    SetTimings --\u003e UpdateState\n    UpdateState --\u003e AddFollowups\n    AddFollowups --\u003e FireChange\n    FireChange --\u003e Telemetry\n```\n\n**Response Completion Sequence**\n\nThe completion flow:\n\n1. **Stream Completion**: Agent's async generator completes or throws; `finally` block ensures cleanup\n2. **Store Result**: `response.completeResponse(result)` stores `IChatAgentResult` in `_result` field\n3. **Set Timings**: Stores `result.timings` with `firstProgress` and `totalElapsed` from `ChatAgentResponseStream`\n4. **Update State**: Sets `_state = ResponseModelState.Complete` (or `Cancelled`/`Failed` if error)\n5. **Attach Followups**: Stores `result.followups` in `_followups` array for rendering\n6. **Fire Event**: Emits `_onDidChange.fire()` with `ChatResponseModelChangeReason.ResponseComplete`\n7. **UI Update**: Response footer toolbar becomes visible; followup buttons rendered\n8. **Telemetry**: `ChatServiceImpl` records timing, token usage, and metadata\n\nThe `IChatAgentResult` interface includes:\n\n| Field | Type | Description |\n|-------|------|-------------|\n| `errorDetails` | `IChatResponseErrorDetails` | Error info if request failed |\n| `timings` | `IChatAgentResultTimings` | `firstProgress` and `totalElapsed` milliseconds |\n| `metadata` | `{ [key: string]: any }` | Agent-specific result metadata |\n| `followups` | `IChatFollowup[]` | Suggested follow-up actions |\n\nSources: [src/vs/workbench/api/common/extHostChatAgents2.ts:42-67](), [src/vs/workbench/contrib/chat/browser/actions/chatActions.ts:176-360]()\n\n## Request and Response Lifecycle Summary\n\n```mermaid\ngraph TB\n    Input[\"User Input\"]\n    Parse[\"Parse Request\"]\n    Create[\"Create Request Model\"]\n    Invoke[\"Invoke Agent\"]\n    Stream[\"Stream Progress\"]\n    Render[\"Render Content Parts\"]\n    Complete[\"Complete Response\"]\n    \n    Input --\u003e Parse\n    Parse --\u003e Create\n    Create --\u003e Invoke\n    Invoke --\u003e Stream\n    Stream --\u003e Render\n    Stream --\u003e|\"stream ends\"| Complete\n    \n    subgraph \"Request Phase\"\n        Input\n        Parse\n        Create\n    end\n    \n    subgraph \"Processing Phase\"\n        Invoke\n        Stream\n    end\n    \n    subgraph \"Response Phase\"\n        Render\n        Complete\n    end\n```\n\n**Complete Request-Response Lifecycle**\n\nThe complete flow:\n1. **Input**: User submits request via `ChatInputPart`\n2. **Parse**: Request text parsed into structured parts\n3. **Create**: `ChatRequestModel` added to `ChatModel`\n4. **Invoke**: Agent handler invoked with request context\n5. **Stream**: Progress chunks streamed back incrementally\n6. **Render**: Content parts created/updated for each chunk type\n7. **Complete**: Response finalized with result metadata\n\nSources: [src/vs/workbench/contrib/chat/browser/chatWidget.ts:1419-1507](), [src/vs/workbench/contrib/chat/common/chatServiceImpl.ts:454-760](), [src/vs/workbench/contrib/chat/browser/chatListRenderer.ts:715-990]()"])</script><script>self.__next_f.push([1,"3d:T7c3a,"])</script><script>self.__next_f.push([1,"# Chat UI Components\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [src/vs/workbench/api/browser/mainThreadChatAgents2.ts](src/vs/workbench/api/browser/mainThreadChatAgents2.ts)\n- [src/vs/workbench/api/common/extHostChatAgents2.ts](src/vs/workbench/api/common/extHostChatAgents2.ts)\n- [src/vs/workbench/contrib/chat/browser/actions/chatActions.ts](src/vs/workbench/contrib/chat/browser/actions/chatActions.ts)\n- [src/vs/workbench/contrib/chat/browser/actions/chatExecuteActions.ts](src/vs/workbench/contrib/chat/browser/actions/chatExecuteActions.ts)\n- [src/vs/workbench/contrib/chat/browser/agentSessions/localAgentSessionsProvider.ts](src/vs/workbench/contrib/chat/browser/agentSessions/localAgentSessionsProvider.ts)\n- [src/vs/workbench/contrib/chat/browser/chat.contribution.ts](src/vs/workbench/contrib/chat/browser/chat.contribution.ts)\n- [src/vs/workbench/contrib/chat/browser/chat.ts](src/vs/workbench/contrib/chat/browser/chat.ts)\n- [src/vs/workbench/contrib/chat/common/constants.ts](src/vs/workbench/contrib/chat/common/constants.ts)\n- [src/vs/workbench/contrib/chat/test/common/voiceChatService.test.ts](src/vs/workbench/contrib/chat/test/common/voiceChatService.test.ts)\n- [src/vs/workbench/services/chat/common/chatEntitlementService.ts](src/vs/workbench/services/chat/common/chatEntitlementService.ts)\n- [src/vscode-dts/vscode.proposed.chatParticipantAdditions.d.ts](src/vscode-dts/vscode.proposed.chatParticipantAdditions.d.ts)\n- [src/vscode-dts/vscode.proposed.defaultChatParticipant.d.ts](src/vscode-dts/vscode.proposed.defaultChatParticipant.d.ts)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis document covers the user interface components and rendering infrastructure of the Chat system in VS Code. It explains the widget architecture, input components, response rendering, and service management that powers the chat experience across different locations (panel, editor, quick chat, inline). \n\nFor information about chat agents and request handling, see [Chat Agents and Participants](#10.2). For chat data models and session management, see [Chat Data Model and Storage](#10.5). For chat request parsing and execution, see [Chat Request and Response Flow](#10.3).\n\n---\n\n## Widget Architecture Overview\n\nThe chat UI is built around a hierarchical widget system with the `IChatWidget` interface at its core. Widgets can appear in multiple locations throughout VS Code, including the chat panel view, chat editors, quick chat overlay, and inline within text editors.\n\n### Core Widget Interface\n\nThe `IChatWidget` interface [src/vs/workbench/contrib/chat/browser/chat.ts:250-311]() defines the contract for all chat UI implementations:\n\n| Property/Method | Type | Description |\n|----------------|------|-------------|\n| `domNode` | `HTMLElement` | Root DOM element of the widget |\n| `viewModel` | `IChatViewModel \\| undefined` | Current chat session view model |\n| `inputEditor` | `ICodeEditor` | Monaco editor for input |\n| `input` | `ChatInputPart` | Input component controller |\n| `attachmentModel` | `ChatAttachmentModel` | Model for file/context attachments |\n| `location` | `ChatAgentLocation` | Where the widget is displayed |\n| `viewContext` | `IChatWidgetViewContext` | Context identifying widget type |\n| `supportsFileReferences` | `boolean` | Whether file attachments are supported |\n| `supportsChangingModes` | `boolean` | Whether mode switching is enabled |\n| `acceptInput()` | `Promise\u003cIChatResponseModel \\| undefined\u003e` | Submit user input |\n| `setInput(query?: string)` | `void` | Set input text without submitting |\n| `getInput()` | `string` | Get current input text |\n| `focusInput()` | `void` | Focus the input editor |\n| `focusResponseItem(lastFocused?: boolean)` | `void` | Focus a response in the list |\n| `clear()` | `Promise\u003cvoid\u003e` | Clear the chat session |\n| `startEditing(requestId: string)` | `void` | Begin editing a request |\n| `rerunLastRequest()` | `Promise\u003cvoid\u003e` | Re-execute the last request |\n\n**Sources:** [src/vs/workbench/contrib/chat/browser/chat.ts:250-311]()\n\u003c/thinking\u003e\n\n\u003cold_str\u003e\nThe `IChatWidgetService` [src/vs/workbench/contrib/chat/browser/chat.ts:52-98]() manages the lifecycle and coordination of chat widgets across the application. It tracks all active widgets, handles widget focus, and provides methods to open chat in different contexts. The implementation is `ChatWidgetService` registered as a singleton.\n\n### Service Interface\n\n```mermaid\ngraph LR\n    IChatWidgetService[\"IChatWidgetService\"]\n    \n    IChatWidgetService --\u003e lastFocusedWidget[\"lastFocusedWidget: IChatWidget\"]\n    IChatWidgetService --\u003e getAllWidgets[\"getAllWidgets()\"]\n    IChatWidgetService --\u003e revealWidget[\"revealWidget(preserveFocus?)\"]\n    IChatWidgetService --\u003e openSession[\"openSession(sessionResource, target?)\"]\n    IChatWidgetService --\u003e register[\"register(widget): IDisposable\"]\n    IChatWidgetService --\u003e getWidgetByInputUri[\"getWidgetByInputUri(uri)\"]\n    IChatWidgetService --\u003e getWidgetBySessionResource[\"getWidgetBySessionResource(uri)\"]\n    \n    lastFocusedWidget --\u003e Widget1[\"ChatViewPane widget\"]\n    lastFocusedWidget --\u003e Widget2[\"ChatEditor widget\"]\n    lastFocusedWidget --\u003e Widget3[\"QuickChatService widget\"]\n```\n\n**Key Methods:**\n\n- **`register(widget: IChatWidget): IDisposable`** - Widgets register themselves when created\n- **`revealWidget(preserveFocus?: boolean): Promise\u003cIChatWidget | undefined\u003e`** - Shows the last active widget or creates new one\n- **`openSession(sessionResource: URI, target?: PreferredGroup | typeof ChatViewPaneTarget, options?: IChatEditorOptions): Promise\u003cIChatWidget | undefined\u003e`** - Opens a specific chat session\n- **`getWidgetBySessionResource(sessionResource: URI): IChatWidget | undefined`** - Finds widget for a session\n- **`getWidgetByInputUri(uri: URI): IChatWidget | undefined`** - Finds widget by its input URI\n- **`getWidgetsByLocations(location: ChatAgentLocation): ReadonlyArray\u003cIChatWidget\u003e`** - Gets all widgets in a location\n\n**Widget Lifecycle Events:**\n\n| Event | Description |\n|-------|-------------|\n| `onDidAddWidget` | Fired when a new widget is registered |\n| `onDidBackgroundSession` | Fired when a session is no longer visible in any widget |\n\n**Sources:** [src/vs/workbench/contrib/chat/browser/chat.ts:52-98]()\n\u003c/old_str\u003e\n\u003cnew_str\u003e\n**Widget Implementation**\n\nThe primary implementation is the `ChatWidget` class, which orchestrates:\n- Tree-based list view using `WorkbenchAsyncDataTree` for request/response rendering\n- Input management through `ChatInputPart` \n- View model binding via `ChatViewModel`\n- Location-specific behavior customization through `IChatWidgetViewOptions`\n\n**Sources:** [src/vs/workbench/contrib/chat/browser/chat.ts:250-311](), [src/vs/workbench/contrib/chat/browser/widget/chatWidget.ts]()\n\n### Widget Hierarchy\n\n```mermaid\ngraph TB\n    IChatWidget[\"IChatWidget Interface\"]\n    ChatWidget[\"ChatWidget Implementation\"]\n    ChatInputPart[\"ChatInputPart\"]\n    AttachmentModel[\"ChatAttachmentModel\"]\n    ViewModel[\"IChatViewModel\"]\n    TreeView[\"Chat Tree View\"]\n    \n    IChatWidget --\u003e ChatWidget\n    ChatWidget --\u003e ChatInputPart\n    ChatWidget --\u003e AttachmentModel\n    ChatWidget --\u003e ViewModel\n    ChatWidget --\u003e TreeView\n    \n    ChatInputPart --\u003e Editor[\"Monaco ICodeEditor\"]\n    ChatInputPart --\u003e Toolbar[\"Input Toolbar\"]\n    ChatInputPart --\u003e ModeSelector[\"Mode/Agent Selector\"]\n    \n    TreeView --\u003e RequestItem[\"IChatRequestViewModel\"]\n    TreeView --\u003e ResponseItem[\"IChatResponseViewModel\"]\n    \n    ResponseItem --\u003e ContentParts[\"Content Parts\"]\n    ContentParts --\u003e Markdown[\"Markdown Parts\"]\n    ContentParts --\u003e CodeBlocks[\"Code Block Parts\"]\n    ContentParts --\u003e FileTrees[\"File Tree Parts\"]\n```\n\n**Widget Implementation Structure**\n\nSources: [src/vs/workbench/contrib/chat/browser/chat.ts:222-283](), [src/vs/workbench/contrib/chat/browser/widget/chatWidget.ts:1-50]()\n\n---\n\n## Chat Widget Service\n\n### Response Stream API\n\nExtensions use the `ChatResponseStream` API to push content parts to the UI. The stream is implemented by `ChatAgentResponseStream` class [src/vs/workbench/api/common/extHostChatAgents2.ts:43-398]():\n\n```typescript\n// From ChatAgentResponseStream.apiObject\nstream.markdown(\"Some **bold** text\");\nstream.reference(fileUri);\nstream.codeblockUri(editedFileUri, isEdit: true);\nstream.progress(\"Processing...\", async (progress) =\u003e {\n    // Long-running task\n    progress.report(new ChatResponseWarningPart(\"Warning message\"));\n});\nstream.button({ command: { title: \"Run Command\", command: \"extension.command\" }});\n```\n\n**Stream Methods:**\n\n- **`markdown(value: string | MarkdownString): this`** [line 149]() - Add markdown content\n- **`reference(value: Uri | Location, iconPath?): this`** [line 216]() - Add file/symbol reference\n- **`reference2(value, iconPath?, options?): this`** [line 219]() - Extended reference with variable support\n- **`codeblockUri(uri: Uri, isEdit?: boolean): this`** [line 167]() - Add code block with URI tracking\n- **`progress(value: string, task?: Task): void`** [line 193]() - Add progress indicator\n- **`thinkingProgress(thinkingDelta: ThinkingDelta): void`** [line 200]() - Add thinking/reasoning steps\n- **`button(value: ChatCommandButton): this`** [line 186]() - Add clickable button\n- **`push(part: ChatResponsePart): this`** [line 335]() - Generic part addition\n- **`textEdit(target: Uri, edits: TextEdit[]): void`** [line 264]() - Stream file edits\n- **`externalEdit(target: Uri | Uri[], callback): Thenable\u003cstring\u003e`** [line 283]() - Track external edits\n- **`confirmation(title, message, data, buttons?): this`** [line 296]() - Request user confirmation\n- **`beginToolInvocation(toolCallId, toolName, streamData?): this`** [line 305]() - Start tool invocation\n- **`updateToolInvocation(toolCallId, streamData): this`** [line 321]() - Update streaming tool data\n- **`clearToPreviousToolInvocation(reason): this`** [line 144]() - Clear content to previous tool\n\n**Implementation Details:**\n\nThe stream uses a microtask-based queue [lines 89-112]() to batch progress chunks and send them efficiently to the main thread via `$handleProgressChunk`. Each stream tracks timing information including `firstProgress` and `totalElapsed` [lines 63-67]().\n\n**Sources:** [src/vs/workbench/api/common/extHostChatAgents2.ts:43-398](), [vscode-dts/vscode.proposed.chatParticipantAdditions.d.ts:294-374]()\n\n---\n\n## Chat Input Components\n\nThe input system consists of the `ChatInputPart` class, which orchestrates the Monaco editor, toolbar, mode selector, and attachment management.\n\n### ChatInputPart Architecture\n\n```mermaid\ngraph TB\n    ChatInputPart[\"ChatInputPart\"]\n    \n    ChatInputPart --\u003e InputEditor[\"Monaco ICodeEditor\"]\n    ChatInputPart --\u003e ModeObservable[\"currentModeObs\"]\n    ChatInputPart --\u003e AttachmentUI[\"Attachment UI\"]\n    ChatInputPart --\u003e Toolbar[\"Execute Toolbar\"]\n    \n    InputEditor --\u003e Completions[\"Input Completions\"]\n    InputEditor --\u003e Hover[\"Input Hover\"]\n    InputEditor --\u003e EditorContrib[\"Chat Editor Contrib\"]\n    \n    ModeObservable --\u003e AskMode[\"Ask Mode\"]\n    ModeObservable --\u003e EditMode[\"Edit Mode\"]\n    ModeObservable --\u003e AgentMode[\"Agent Mode\"]\n    \n    AttachmentUI --\u003e FileAttachments[\"File Attachments\"]\n    AttachmentUI --\u003e ToolAttachments[\"Tool Attachments\"]\n    AttachmentUI --\u003e ContextAttachments[\"Context Attachments\"]\n    \n    Toolbar --\u003e SubmitButton[\"Submit Action\"]\n    Toolbar --\u003e ModelPicker[\"Model Picker\"]\n    Toolbar --\u003e ModePicker[\"Mode Picker\"]\n```\n\n### Input Features\n\n**Mode Management:**\n- **`setChatMode(modeId: string)`** - Switch between Ask, Edit, and Agent modes\n- **`openModePicker()`** - Show UI to select chat mode\n- **`currentModeKind`** - Current mode kind (Ask/Edit/Agent)\n\n**Model Selection:**\n- **`setCurrentLanguageModel(metadata, identifier)`** - Set language model\n- **`openModelPicker()`** - Show model selection UI\n- **`switchToNextModel()`** - Cycle through available models\n\n**Attachment Management:**\n- Integrated with `ChatAttachmentModel` for managing file and context attachments\n- Support for drag-and-drop file attachment\n- Tool reference attachment (e.g., `@codebase`, `@workspace`)\n\nSources: [src/vs/workbench/contrib/chat/browser/widget/input/chatInputPart.ts:1-100](), [src/vs/workbench/contrib/chat/browser/actions/chatExecuteActions.ts:410-492]()\n\n---\n\n## Response Rendering System\n\nChat responses are rendered as a stream of content parts. Each part type has a specific renderer and can represent different types of content.\n\n### Response Part Types\n\nThe system supports numerous response part types defined in the extension API:\n\n| Part Type | Class | Description |\n|-----------|-------|-------------|\n| Markdown | `ChatResponseMarkdownPart` | Standard markdown content |\n| Code Block | `ChatResponseCodeblockUriPart` | Code block with optional edit tracking |\n| File Tree | `ChatResponseFileTreePart` | Hierarchical file listing |\n| Reference | `ChatResponseReferencePart` | Link to file/location/variable |\n| Progress | `ChatResponseProgressPart` | Progress indicator with optional task |\n| Button | `ChatResponseCommandButtonPart` | Clickable command button |\n| Text Edit | `ChatResponseTextEditPart` | File edit operations |\n| Confirmation | `ChatResponseConfirmationPart` | User confirmation prompt |\n| Warning | `ChatResponseWarningPart` | Warning message |\n| Anchor | `ChatResponseAnchorPart` | Navigable anchor to symbol/location |\n| Thinking | `ChatResponseThinkingProgressPart` | Reasoning/thinking steps |\n\n**Extended Response Part Hierarchy:**\n\n```mermaid\ngraph TB\n    ChatResponsePart[\"Base: ChatResponsePart\"]\n    \n    ChatResponsePart --\u003e Markdown[\"ChatResponseMarkdownPart\"]\n    ChatResponsePart --\u003e Codeblock[\"ChatResponseCodeblockUriPart\"]\n    ChatResponsePart --\u003e FileTree[\"ChatResponseFileTreePart\"]\n    ChatResponsePart --\u003e Reference[\"ChatResponseReferencePart\"]\n    ChatResponsePart --\u003e Progress[\"ChatResponseProgressPart\"]\n    ChatResponsePart --\u003e Button[\"ChatResponseCommandButtonPart\"]\n    \n    ExtendedPart[\"Extended Parts\"]\n    ExtendedPart --\u003e TextEdit[\"ChatResponseTextEditPart\"]\n    ExtendedPart --\u003e NotebookEdit[\"ChatResponseNotebookEditPart\"]\n    ExtendedPart --\u003e Confirmation[\"ChatResponseConfirmationPart\"]\n    ExtendedPart --\u003e Warning[\"ChatResponseWarningPart\"]\n    ExtendedPart --\u003e Anchor[\"ChatResponseAnchorPart\"]\n    ExtendedPart --\u003e Thinking[\"ChatResponseThinkingProgressPart\"]\n    ExtendedPart --\u003e MultiDiff[\"ChatResponseMultiDiffPart\"]\n```\n\nSources: [vscode-dts/vscode.proposed.chatParticipantAdditions.d.ts:26-290]()\n\n### Response Stream API\n\nExtensions use the `ChatResponseStream` API to push content parts to the UI:\n\n```typescript\n// From ChatAgentResponseStream\nstream.markdown(\"Some **bold** text\");\nstream.reference(fileUri);\nstream.codeblockUri(editedFileUri, isEdit: true);\nstream.progress(\"Processing...\", async (progress) =\u003e {\n    // Long-running task\n    progress.report(new ChatResponseWarningPart(\"Warning message\"));\n});\nstream.button({ command: { title: \"Run Command\", command: \"extension.command\" }});\n```\n\n**Stream Methods:**\n\n- **`markdown(value: string | MarkdownString)`** - Add markdown content\n- **`reference(value: Uri | Location)`** - Add file/symbol reference\n- **`codeblockUri(uri: Uri, isEdit?: boolean)`** - Add code block with URI tracking\n- **`progress(value: string, task?: Task)`** - Add progress indicator\n- **`button(value: ChatCommandButton)`** - Add clickable button\n- **`push(part: ChatResponsePart)`** - Generic part addition\n- **`textEdit(target: Uri, edits: TextEdit[])`** - Stream file edits\n- **`confirmation(title, message, data)`** - Request user confirmation\n\nSources: [src/vs/workbench/api/common/extHostChatAgents2.ts:41-380](), [vscode-dts/vscode.proposed.chatParticipantAdditions.d.ts:291-357]()\n\n---\n\n## Widget View Options\n\nChat widgets are highly configurable through the `IChatWidgetViewOptions` interface, allowing different presentations for different contexts.\n\n### View Configuration\n\n```mermaid\ngraph LR\n    ViewOptions[\"IChatWidgetViewOptions\"]\n    \n    ViewOptions --\u003e Layout[\"Layout Options\"]\n    ViewOptions --\u003e Rendering[\"Rendering Options\"]\n    ViewOptions --\u003e Features[\"Feature Toggles\"]\n    ViewOptions --\u003e Menus[\"Menu Configuration\"]\n    \n    Layout --\u003e renderInputOnTop[\"renderInputOnTop\"]\n    Layout --\u003e autoScroll[\"autoScroll\"]\n    \n    Rendering --\u003e renderStyle[\"renderStyle: compact/minimal\"]\n    Rendering --\u003e renderFollowups[\"renderFollowups\"]\n    Rendering --\u003e rendererOptions[\"rendererOptions\"]\n    \n    Features --\u003e supportsFileReferences[\"supportsFileReferences\"]\n    Features --\u003e enableImplicitContext[\"enableImplicitContext\"]\n    Features --\u003e supportsChangingModes[\"supportsChangingModes\"]\n    \n    Menus --\u003e executeToolbar[\"executeToolbar: MenuId\"]\n    Menus --\u003e inputSideToolbar[\"inputSideToolbar: MenuId\"]\n```\n\n**Key Options:**\n\n| Option | Type | Description |\n|--------|------|-------------|\n| `renderInputOnTop` | `boolean` | Place input at top instead of bottom |\n| `renderStyle` | `'compact' \\| 'minimal'` | Visual density of rendering |\n| `renderFollowups` | `boolean` | Show suggested follow-up questions |\n| `supportsFileReferences` | `boolean` | Enable file attachment UI |\n| `enableImplicitContext` | `boolean` | Auto-include active editor as context |\n| `supportsChangingModes` | `boolean` | Allow switching between Ask/Edit/Agent |\n| `menus.executeToolbar` | `MenuId` | Menu for submit/send button area |\n| `menus.inputSideToolbar` | `MenuId` | Menu for input side controls |\n\n**Renderer Options:**\n\n| Option | Type | Description |\n|--------|------|-------------|\n| `renderStyle` | `'compact' \\| 'minimal'` | List item visual style |\n| `noHeader` | `boolean` | Hide request/response headers |\n| `noFooter` | `boolean` | Hide footer with actions |\n| `editableCodeBlock` | `boolean` | Allow in-place code block editing |\n| `renderTextEditsAsSummary` | `(uri: URI) =\u003e boolean` | Show edits as summary vs. full diff |\n\nSources: [src/vs/workbench/contrib/chat/browser/chat.ts:154-186]()\n\n---\n\n## Quick Chat Service\n\nThe `IQuickChatService` manages a lightweight chat overlay that appears on demand without requiring a dedicated panel or editor.\n\n### Quick Chat Interface\n\n```mermaid\ngraph TB\n    IQuickChatService[\"IQuickChatService\"]\n    \n    IQuickChatService --\u003e State[\"State\"]\n    IQuickChatService --\u003e Actions[\"Actions\"]\n    IQuickChatService --\u003e Events[\"Events\"]\n    \n    State --\u003e enabled[\"enabled: boolean\"]\n    State --\u003e focused[\"focused: boolean\"]\n    State --\u003e sessionResource[\"sessionResource?: URI\"]\n    \n    Actions --\u003e toggle[\"toggle(options)\"]\n    Actions --\u003e open[\"open(options)\"]\n    Actions --\u003e close[\"close()\"]\n    Actions --\u003e focus[\"focus()\"]\n    Actions --\u003e openInChatView[\"openInChatView()\"]\n    \n    Events --\u003e onDidClose[\"onDidClose: Event\u003cvoid\u003e\"]\n```\n\n**Quick Chat Options:**\n\nThe `IQuickChatOpenOptions` interface configures how quick chat opens:\n\n- **`query: string`** - Pre-fill the input with this text\n- **`isPartialQuery?: boolean`** - Whether query is complete or expects more input\n- **`selection?: Selection`** - Text selection range to apply to query\n\n**Usage Pattern:**\n\nQuick chat is typically opened via keyboard shortcut (`Ctrl+Alt+I`) and provides a focused, modal-like chat experience that can be easily dismissed or converted to a full chat view.\n\nSources: [src/vs/workbench/contrib/chat/browser/chat.ts:81-109](), [src/vs/workbench/contrib/chat/browser/widgetHosts/chatQuick.ts:1-50]()\n\n---\n\n## Chat Locations\n\nChat widgets can appear in multiple locations, each with different characteristics and capabilities.\n\n### Location Types\n\n```mermaid\ngraph TB\n    Locations[\"ChatAgentLocation Enum\"]\n    \n    Locations --\u003e Panel[\"Chat = 'panel'\"]\n    Locations --\u003e Terminal[\"Terminal = 'terminal'\"]\n    Locations --\u003e Notebook[\"Notebook = 'notebook'\"]\n    Locations --\u003e EditorInline[\"EditorInline = 'editor'\"]\n    \n    Panel --\u003e ChatView[\"Chat Panel View\"]\n    Panel --\u003e ChatEditor[\"Chat Editor\"]\n    Panel --\u003e QuickChat[\"Quick Chat Overlay\"]\n    \n    EditorInline --\u003e InlineChat[\"Inline Chat Widget\"]\n    EditorInline --\u003e DiffEditor[\"Diff Editor Chat\"]\n```\n\n**Location Characteristics:**\n\n| Location | Description | Features |\n|----------|-------------|----------|\n| `Chat ('panel')` | Primary chat in panel/sidebar/editor | Full features, persistent sessions |\n| `Terminal` | Chat within terminal pane | Terminal command context, shell integration |\n| `Notebook` | Chat in notebook documents | Cell-aware context, output integration |\n| `EditorInline ('editor')` | Inline chat in text editor | Editor selection context, inline edits |\n\n**Location-Specific Behaviors:**\n\n- **Chat Panel**: Supports all modes (Ask, Edit, Agent), full history, multi-turn conversations\n- **Terminal**: Optimized for command generation, can execute commands directly\n- **Notebook**: Cell-aware, can generate and execute notebook cells\n- **Editor Inline**: Focused on selected code, generates inline edits\n\nSources: [src/vs/workbench/contrib/chat/common/constants.ts:74-100]()\n\n---\n\n## Widget View Contexts\n\nChat widgets track their view context to determine behavior and available features.\n\n### Context Types\n\n**View Context Interface:**\n\n```typescript\ntype IChatWidgetViewContext = \n    | IChatViewViewContext      // Panel/View chat\n    | IChatResourceViewContext  // Editor/Quick chat\n    | {}                        // Generic\n```\n\n**View-Specific Context:**\n\n- **`IChatViewViewContext`** - Contains `viewId: string` for panel-based chat views\n- **`IChatResourceViewContext`** - Flags like `isQuickChat?: boolean` and `isInlineChat?: boolean`\n\n**Context Usage:**\n\nThe view context determines:\n- Which menus and actions are available\n- How input and output are rendered\n- Whether features like file references are enabled\n- Default mode and model selection\n\nSources: [src/vs/workbench/contrib/chat/browser/chat.ts:188-206]()\n\n---\n\n## Accessibility Services\n\nThe `IChatAccessibilityService` provides accessibility support for screen readers and keyboard navigation.\n\n### Accessibility Features\n\n```mermaid\ngraph LR\n    IChatAccessibilityService[\"IChatAccessibilityService\"]\n    \n    IChatAccessibilityService --\u003e acceptRequest[\"acceptRequest(uri)\"]\n    IChatAccessibilityService --\u003e acceptResponse[\"acceptResponse(...)\"]\n    IChatAccessibilityService --\u003e acceptElicitation[\"acceptElicitation(message)\"]\n    IChatAccessibilityService --\u003e disposeRequest[\"disposeRequest(requestId)\"]\n    \n    acceptResponse --\u003e AccessibleView[\"Accessible View\"]\n    acceptResponse --\u003e ScreenReader[\"Screen Reader Announcement\"]\n```\n\n**Service Methods:**\n\n- **`acceptRequest(uri: URI)`** - Announce request to screen reader\n- **`acceptResponse(widget, container, response, requestId, isVoiceInput?)`** - Announce response\n- **`acceptElicitation(message)`** - Announce elicitation/suggestion\n- **`disposeRequest(requestId)`** - Clean up request accessibility resources\n\n**Accessible View Integration:**\n\nThe service integrates with VS Code's accessible view system to provide alternative representations of chat content optimized for screen readers:\n\n- `PanelChatAccessibilityHelp` - Help for panel chat\n- `EditsChatAccessibilityHelp` - Help for edit mode\n- `QuickChatAccessibilityHelp` - Help for quick chat\n- `AgentChatAccessibilityHelp` - Help for agent mode\n- `ChatResponseAccessibleView` - Accessible view for responses\n- `ChatTerminalOutputAccessibleView` - Accessible view for terminal output\n\nSources: [src/vs/workbench/contrib/chat/browser/chat.ts:111-118](), [src/vs/workbench/contrib/chat/browser/actions/chatAccessibilityHelp.ts:1-50]()\n\n---\n\n## Code Block Integration\n\nCode blocks in chat responses receive special treatment with edit tracking, context menus, and integration with VS Code's editor features.\n\n### Code Block Context System\n\n```mermaid\ngraph TB\n    IChatCodeBlockInfo[\"IChatCodeBlockInfo\"]\n    \n    IChatCodeBlockInfo --\u003e Identification[\"Identification\"]\n    IChatCodeBlockInfo --\u003e Resources[\"Resources\"]\n    IChatCodeBlockInfo --\u003e Actions[\"Actions\"]\n    \n    Identification --\u003e ownerMarkdownPartId[\"ownerMarkdownPartId\"]\n    Identification --\u003e codeBlockIndex[\"codeBlockIndex\"]\n    Identification --\u003e elementId[\"elementId\"]\n    \n    Resources --\u003e uri[\"uri?: URI\"]\n    Resources --\u003e codemapperUri[\"codemapperUri?: URI\"]\n    Resources --\u003e chatSessionResource[\"chatSessionResource?: URI\"]\n    \n    Actions --\u003e focus[\"focus()\"]\n    \n    IChatCodeBlockInfo --\u003e EditInfo[\"Edit Tracking\"]\n    EditInfo --\u003e languageId[\"languageId\"]\n    EditInfo --\u003e editDeltaInfo[\"editDeltaInfo\"]\n```\n\n**IChatCodeBlockContextProviderService:**\n\nThis service manages providers that can supply code block context for actions and commands:\n\n- **`registerProvider(provider, id): IDisposable`** - Register a context provider\n- **`providers: ICodeBlockActionContextProvider[]`** - All registered providers\n- Providers implement **`getCodeBlockContext(editor?: ICodeEditor): ICodeBlockActionContext`**\n\n**Context Usage:**\n\nCode block context is used by:\n- Copy/insert/apply actions on code blocks\n- Smart apply that detects matching files\n- Edit tracking for agent-generated changes\n- Language-specific actions (run, debug, etc.)\n\nSources: [src/vs/workbench/contrib/chat/browser/chat.ts:120-137](), [src/vs/workbench/contrib/chat/browser/codeBlockContextProviderService.ts:1-50]()\n\n---\n\n## Chat Actions and Commands\n\nThe chat system exposes numerous actions for interacting with widgets and managing sessions.\n\n### Core Action Categories\n\n```mermaid\ngraph TB\n    Actions[\"Chat Actions\"]\n    \n    Actions --\u003e Open[\"Opening Chat\"]\n    Actions --\u003e Execute[\"Executing Requests\"]\n    Actions --\u003e Navigation[\"Navigation\"]\n    Actions --\u003e Management[\"Session Management\"]\n    \n    Open --\u003e PrimaryOpen[\"CHAT_OPEN_ACTION_ID\"]\n    Open --\u003e ModeOpen[\"ModeOpenChatGlobalAction\"]\n    Open --\u003e NewEditor[\"ACTION_ID_OPEN_CHAT\"]\n    \n    Execute --\u003e Submit[\"ChatSubmitAction\"]\n    Execute --\u003e EditSubmit[\"ChatEditingSessionSubmitAction\"]\n    Execute --\u003e Cancel[\"CancelAction\"]\n    \n    Navigation --\u003e FocusChat[\"FocusChatAction\"]\n    Navigation --\u003e FocusInput[\"FocusChatInputAction\"]\n    \n    Management --\u003e NewChat[\"ACTION_ID_NEW_CHAT\"]\n    Management --\u003e Clear[\"ClearChatAction\"]\n    Management --\u003e ToggleMode[\"ToggleChatModeAction\"]\n```\n\n**Primary Actions:**\n\n| Action ID | Command | Description |\n|-----------|---------|-------------|\n| `workbench.action.chat.open` | `Ctrl+Alt+I` (Mac: `Cmd+Ctrl+I`) | Open primary chat |\n| `workbench.action.openChat` | N/A | Open new chat editor |\n| `workbench.action.chat.newChat` | `Ctrl+N` (in chat) | Start new session |\n| `workbench.action.chat.submit` | `Enter` | Submit request |\n| `workbench.action.chat.cancel` | `Escape` | Cancel request |\n| `chat.action.focus` | `Ctrl+Up` | Focus chat list |\n| `workbench.action.chat.focusInput` | `Ctrl+Down` | Focus input |\n\n**Mode Actions:**\n\n- **`ToggleChatModeAction`** - Cycle through Ask  Edit  Agent modes\n- **`OpenModePickerAction`** (`Ctrl+.`) - Show agent picker\n- Mode-specific open actions created dynamically for each mode\n\n**Model Actions:**\n\n- **`SwitchToNextModelAction`** - Cycle through available models\n- **`OpenModelPickerAction`** (`Ctrl+Alt+.`) - Show model picker UI\n- **`ChangeChatModelAction`** - Programmatically change model\n\nSources: [src/vs/workbench/contrib/chat/browser/actions/chatActions.ts:162-495](), [src/vs/workbench/contrib/chat/browser/actions/chatExecuteActions.ts:46-717]()\n\n---\n\n## Opening Chat Programmatically\n\nThe chat system provides APIs for extensions and internal code to open chat with specific options.\n\n### IChatViewOpenOptions\n\nThe `IChatViewOpenOptions` interface [src/vs/workbench/contrib/chat/browser/actions/chatActions.ts:82-151]() configures programmatic chat opening:\n\n```typescript\ninterface IChatViewOpenOptions {\n    query: string;                          // Query text\n    isPartialQuery?: boolean;               // Await more input\n    toolIds?: string[];                     // Attach tools by ID\n    previousRequests?: IChatViewOpenRequestEntry[];  // Pre-fill history\n    attachScreenshot?: boolean;             // Screenshot attachment\n    attachFiles?: (URI | { uri: URI; range: IRange })[];  // File attachments\n    attachHistoryItemChanges?: {            // SCM history context\n        uri: URI; \n        historyItemId: string;\n    }[];\n    attachHistoryItemChangeRanges?: {       // SCM history range context\n        start: { uri: URI; historyItemId: string };\n        end: { uri: URI; historyItemId: string };\n    }[];\n    mode?: ChatModeKind | string;           // Mode to use\n    modelSelector?: ILanguageModelChatSelector;  // Model selection\n    blockOnResponse?: boolean;              // Wait for completion\n}\n```\n\n**Usage Example:**\n\n```typescript\n// Open chat with pre-filled query and file attachment\ncommandService.executeCommand('workbench.action.chat.open', {\n    query: 'Explain this code',\n    attachFiles: [{ uri: fileUri, range: selection }],\n    mode: ChatModeKind.Ask\n} as IChatViewOpenOptions);\n```\n\n**Implementation in OpenChatGlobalAction:**\n\nThe `OpenChatGlobalAction.run()` method [lines 176-361]() handles these options:\n- Resolves mode and model selections [lines 202-220]()\n- Populates history with `previousRequests` [lines 222-226]()\n- Captures screenshot via `IHostService.getScreenshot()` [lines 227-232]()\n- Adds file attachments using `widget.attachmentModel.addFile()` [lines 233-242]()\n- Converts SCM history to `ISCMHistoryItemChangeVariableEntry` [lines 243-264]()\n- Optionally blocks until response completes [lines 344-358]()\n\n**Sources:** [src/vs/workbench/contrib/chat/browser/actions/chatActions.ts:82-361]()\n\n---\n\n## Widget Contributions\n\nChat widgets can register contributions that extend their functionality.\n\n### IChatWidgetContrib Interface\n\n```mermaid\ngraph LR\n    IChatWidget[\"IChatWidget\"]\n    IChatWidget --\u003e contribs[\"contribs: IChatWidgetContrib[]\"]\n    IChatWidget --\u003e getContrib[\"getContrib\u003cT\u003e(id): T\"]\n    \n    contribs --\u003e Contrib1[\"Code Block Actions\"]\n    contribs --\u003e Contrib2[\"Paste Providers\"]\n    contribs --\u003e Contrib3[\"Dynamic Variables\"]\n    contribs --\u003e Contrib4[\"Related Files\"]\n```\n\n**Contribution Pattern:**\n\nContributions follow a common pattern:\n- Implement a unique ID\n- Register with the widget during initialization\n- Provide domain-specific functionality\n- Can access widget state and services\n\n**Example Contributions:**\n\n- **`ChatPasteProvidersFeature`** - Handles paste operations in input\n- **`ChatDynamicVariableModel`** - Manages dynamic context variables\n- **`ChatRelatedFilesContribution`** - Suggests related files for context\n- **`SimpleBrowserOverlay`** - Integrates with simple browser for element selection\n\nSources: [src/vs/workbench/contrib/chat/browser/chat.ts:245](), [src/vs/workbench/contrib/chat/browser/widget/chatPasteProviders.ts:1-50]()\n\n---\n\n## Summary\n\nThe Chat UI Components system provides a flexible, extensible architecture for embedding conversational AI throughout VS Code:\n\n1. **Widget Architecture** - `IChatWidget` interface with implementations for different locations\n2. **Service Management** - `IChatWidgetService` orchestrates widget lifecycle\n3. **Input System** - `ChatInputPart` manages editor, modes, and attachments\n4. **Response Rendering** - Extensible streaming system with 15+ content part types\n5. **Quick Chat** - Lightweight overlay for focused interactions\n6. **Accessibility** - Comprehensive screen reader and keyboard support\n7. **Actions** - Rich command set for opening, navigating, and controlling chat\n8. **Code Integration** - Special handling for code blocks with edit tracking\n\nThe architecture supports multiple chat locations (panel, editor, quick chat, inline) while maintaining a consistent API surface. Extensions interact primarily through the `ChatResponseStream` API to render rich, interactive content."])</script><script>self.__next_f.push([1,"3e:T4a1c,"])</script><script>self.__next_f.push([1,"# Chat Modes and Sessions\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [src/vs/workbench/api/browser/mainThreadChatAgents2.ts](src/vs/workbench/api/browser/mainThreadChatAgents2.ts)\n- [src/vs/workbench/api/common/extHostChatAgents2.ts](src/vs/workbench/api/common/extHostChatAgents2.ts)\n- [src/vs/workbench/contrib/chat/browser/actions/chatActions.ts](src/vs/workbench/contrib/chat/browser/actions/chatActions.ts)\n- [src/vs/workbench/contrib/chat/browser/actions/chatExecuteActions.ts](src/vs/workbench/contrib/chat/browser/actions/chatExecuteActions.ts)\n- [src/vs/workbench/contrib/chat/browser/agentSessions/localAgentSessionsProvider.ts](src/vs/workbench/contrib/chat/browser/agentSessions/localAgentSessionsProvider.ts)\n- [src/vs/workbench/contrib/chat/browser/chat.contribution.ts](src/vs/workbench/contrib/chat/browser/chat.contribution.ts)\n- [src/vs/workbench/contrib/chat/browser/chat.ts](src/vs/workbench/contrib/chat/browser/chat.ts)\n- [src/vs/workbench/contrib/chat/common/constants.ts](src/vs/workbench/contrib/chat/common/constants.ts)\n- [src/vs/workbench/contrib/chat/test/common/voiceChatService.test.ts](src/vs/workbench/contrib/chat/test/common/voiceChatService.test.ts)\n- [src/vs/workbench/services/chat/common/chatEntitlementService.ts](src/vs/workbench/services/chat/common/chatEntitlementService.ts)\n- [src/vscode-dts/vscode.proposed.chatParticipantAdditions.d.ts](src/vscode-dts/vscode.proposed.chatParticipantAdditions.d.ts)\n- [src/vscode-dts/vscode.proposed.defaultChatParticipant.d.ts](src/vscode-dts/vscode.proposed.defaultChatParticipant.d.ts)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis document explains the chat mode system and session management in VS Code's chat infrastructure. Chat modes determine how user input is processed (Ask, Edit, or Agent mode), while sessions represent individual chat conversations with their associated state and history. For information about the chat widget UI components, see [Chat UI Components](#7.4). For details on chat agents and participants, see [Chat Agents and Participants](#7.2).\n\n---\n\n## Chat Mode Kinds\n\nVS Code's chat system supports three distinct mode kinds, each serving different user interaction patterns.\n\n```mermaid\ngraph LR\n    User[\"User Input\"] --\u003e ModeSelector[\"Mode Selection\"]\n    ModeSelector --\u003e Ask[\"Ask Mode\u003cbr/\u003e(ChatModeKind.Ask)\"]\n    ModeSelector --\u003e Edit[\"Edit Mode\u003cbr/\u003e(ChatModeKind.Edit)\"]\n    ModeSelector --\u003e Agent[\"Agent Mode\u003cbr/\u003e(ChatModeKind.Agent)\"]\n    \n    Ask --\u003e AskBehavior[\"Question/Answer\u003cbr/\u003eNo file editing\"]\n    Edit --\u003e EditBehavior[\"File modifications\u003cbr/\u003eTool-based editing\"]\n    Agent --\u003e AgentBehavior[\"Autonomous actions\u003cbr/\u003eSide-effect tools\"]\n```\n\n**Sources:** [src/vs/workbench/contrib/chat/common/constants.ts:43-47]()\n\n### Mode Definitions\n\nThe `ChatModeKind` enum defines the three core modes:\n\n| Mode Kind | String Value | Primary Use Case |\n|-----------|--------------|------------------|\n| `Ask` | `'ask'` | Question-answering without side effects |\n| `Edit` | `'edit'` | File modification and code editing workflows |\n| `Agent` | `'agent'` | Autonomous agent with tools that can have side effects |\n\n**Sources:** [src/vs/workbench/contrib/chat/common/constants.ts:43-47]()\n\n### Mode-Specific Behavior\n\n**Ask Mode** (`ChatModeKind.Ask`):\n- Default mode for conversational interactions\n- No file modifications or side effects\n- Used for questions, explanations, and code suggestions\n- Submit action uses `ChatSubmitAction` \n- Menu condition: `ChatContextKeys.chatModeKind.isEqualTo(ChatModeKind.Ask)`\n\n**Edit Mode** (`ChatModeKind.Edit`):\n- Designed for code editing workflows\n- Uses tool-calling for file modifications\n- Requires models that support tool-calling when `chat.edits2.enabled` is true\n- Submit action uses `ChatEditingSessionSubmitAction`\n- Can be disabled via `ChatConfiguration.Edits2Enabled` setting\n\n**Agent Mode** (`ChatModeKind.Agent`):\n- Enables autonomous actions with side-effect tools\n- Controlled by `ChatConfiguration.AgentEnabled` setting\n- Tools in agentic contexts can modify system state\n- Keybinding: `Ctrl+Shift+I` (Cmd+Shift+I on Mac, Ctrl+Alt+Shift+I on Linux)\n\n**Sources:** [src/vs/workbench/contrib/chat/browser/actions/chatExecuteActions.ts:151-210](), [src/vs/workbench/contrib/chat/browser/actions/chatExecuteActions.ts:529-563](), [src/vs/workbench/contrib/chat/browser/actions/chatActions.ts:433-450]()\n\n---\n\n## Chat Mode Interface and Service\n\n### IChatMode Interface\n\nCustom modes are represented by the `IChatMode` interface, which allows extensions and the system to define specialized chat behaviors:\n\n```mermaid\ngraph TB\n    subgraph \"Mode Properties\"\n        Mode[\"IChatMode\"]\n        Mode --\u003e id[\"id: string\"]\n        Mode --\u003e kind[\"kind: ChatModeKind\"]\n        Mode --\u003e name[\"name: IObservable\u0026lt;string\u0026gt;\"]\n        Mode --\u003e label[\"label: IObservable\u0026lt;string\u0026gt;\"]\n        Mode --\u003e source[\"source?: ModeSource\"]\n        Mode --\u003e customTools[\"customTools?: IObservable\u0026lt;string[]\u0026gt;\"]\n        Mode --\u003e handOffs[\"handOffs?: IObservable\u0026lt;string[]\u0026gt;\"]\n    end\n    \n    subgraph \"Built-in Modes\"\n        ChatMode[\"ChatMode namespace\"]\n        ChatMode --\u003e AskMode[\"Ask: IChatMode\"]\n        ChatMode --\u003e EditMode[\"Edit: IChatMode\"]\n        ChatMode --\u003e AgentMode[\"Agent: IChatMode\"]\n    end\n    \n    subgraph \"Mode Service\"\n        ModeService[\"IChatModeService\"]\n        ModeService --\u003e getModes[\"getModes()\"]\n        ModeService --\u003e findModeById[\"findModeById(id)\"]\n        ModeService --\u003e findModeByName[\"findModeByName(name)\"]\n    end\n    \n    Mode --\u003e ModeService\n    ChatMode --\u003e ModeService\n```\n\n**Sources:** [src/vs/workbench/contrib/chat/browser/actions/chatExecuteActions.ts:24]()\n\n### Built-in Mode Objects\n\nThe system provides three built-in `ChatMode` objects accessed via:\n- `ChatMode.Ask`\n- `ChatMode.Edit`\n- `ChatMode.Agent`\n\nThese are used throughout the codebase to reference standard modes.\n\n**Sources:** [src/vs/workbench/contrib/chat/browser/actions/chatActions.ts:434](), [src/vs/workbench/contrib/chat/browser/actions/chatActions.ts:449]()\n\n### IChatModeService\n\nThe `IChatModeService` provides mode management functionality:\n\n```typescript\ninterface IChatModeService {\n    getModes(): { builtin: IChatMode[]; custom?: IChatMode[] };\n    findModeById(id: ChatModeKind | string): IChatMode | undefined;\n    findModeByName(name: ChatModeKind | string): IChatMode | undefined;\n}\n```\n\n**Sources:** [src/vs/workbench/contrib/chat/browser/actions/chatExecuteActions.ts:262]()\n\n---\n\n## Mode Switching and Session Management\n\n### Mode Switching Flow\n\n```mermaid\nsequenceDiagram\n    participant User\n    participant Action as \"ToggleChatModeAction\"\n    participant ModeService as \"IChatModeService\"\n    participant Handler as \"handleModeSwitch\"\n    participant Widget as \"IChatWidget\"\n    participant Command as \"CommandService\"\n    \n    User-\u003e\u003eAction: Trigger mode switch\n    Action-\u003e\u003eWidget: Get current mode\n    Action-\u003e\u003eModeService: Get next mode\n    Action-\u003e\u003eHandler: handleModeSwitch(currentMode, targetMode, requestCount)\n    Handler--\u003e\u003eAction: { needToClearSession: boolean }\n    \n    alt Session needs clearing\n        Action-\u003e\u003eCommand: executeCommand(ACTION_ID_NEW_CHAT)\n    end\n    \n    Action-\u003e\u003eWidget: input.setChatMode(newMode)\n    Action-\u003e\u003eUser: Mode switched\n```\n\n**Sources:** [src/vs/workbench/contrib/chat/browser/actions/chatExecuteActions.ts:258-313]()\n\n### Mode Switch Actions\n\n**ToggleChatModeAction** (`workbench.action.chat.toggleAgentMode`):\n- Cycles through available modes\n- Calls `handleModeSwitch` to determine if session should be cleared\n- Sends telemetry with mode change details\n- Mode order: Built-in modes (filtered by config) + custom modes\n\n**ModeOpenChatGlobalAction**:\n- Opens chat in a specific mode\n- Each built-in mode has a dedicated action:\n  - `workbench.action.chat.openAsk` (Ask mode)\n  - `workbench.action.chat.openAgent` (Agent mode, with keybinding)\n  - `workbench.action.chat.openEdit` (Edit mode)\n\n**Sources:** [src/vs/workbench/contrib/chat/browser/actions/chatExecuteActions.ts:242-328](), [src/vs/workbench/contrib/chat/browser/actions/chatActions.ts:421-450]()\n\n### Session Clearing Logic\n\nWhen switching modes, the system determines whether the current session must be cleared:\n\n```mermaid\nflowchart TD\n    Start[\"Mode Switch Requested\"] --\u003e GetModel[\"Get current model\"]\n    GetModel --\u003e CheckModel{\"Model exists?\"}\n    CheckModel --\u003e|No| AllowSwitch[\"Allow switch\u003cbr/\u003eneedToClearSession=false\"]\n    CheckModel --\u003e|Yes| CallHandler[\"Call handleModeSwitch()\"]\n    CallHandler --\u003e CheckRequests{\"Has requests?\"}\n    CheckRequests --\u003e|Yes| PromptUser[\"Show confirmation dialog\u003cbr/\u003eif editing session active\"]\n    CheckRequests --\u003e|No| AllowSwitch\n    PromptUser --\u003e UserConfirms{\"User confirms?\"}\n    UserConfirms --\u003e|No| Cancel[\"Cancel switch\"]\n    UserConfirms --\u003e|Yes| NeedsClear[\"needToClearSession=true\"]\n    NeedsClear --\u003e ClearSession[\"Execute ACTION_ID_NEW_CHAT\"]\n    AllowSwitch --\u003e SetMode[\"widget.input.setChatMode()\"]\n    ClearSession --\u003e SetMode\n```\n\n**Sources:** [src/vs/workbench/contrib/chat/browser/actions/chatActions.ts:363-378](), [src/vs/workbench/contrib/chat/browser/actions/chatExecuteActions.ts:287-312]()\n\n### Mode Switching Telemetry\n\nMode switches emit telemetry events with the following data:\n\n| Property | Description |\n|----------|-------------|\n| `fromMode` | Previous mode name |\n| `mode` | New mode name |\n| `requestCount` | Number of requests in current session |\n| `storage` | Mode source storage type (builtin, local, user, extension) |\n| `extensionId` | Extension ID if mode is from extension |\n| `toolsCount` | Number of custom tools in mode |\n| `handoffsCount` | Number of handoffs in mode |\n\n**Sources:** [src/vs/workbench/contrib/chat/browser/actions/chatExecuteActions.ts:220-240](), [src/vs/workbench/contrib/chat/browser/actions/chatExecuteActions.ts:293-306]()\n\n---\n\n## Chat Sessions\n\n### Session Lifecycle\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e Created: New session\n    Created --\u003e Active: First request\n    Active --\u003e InProgress: Request processing\n    InProgress --\u003e NeedsInput: Awaiting confirmation\n    InProgress --\u003e Completed: Success\n    InProgress --\u003e Failed: Error\n    InProgress --\u003e Cancelled: User cancels\n    NeedsInput --\u003e InProgress: User responds\n    Completed --\u003e InProgress: New request\n    Failed --\u003e InProgress: Retry\n    Cancelled --\u003e InProgress: New request\n    Completed --\u003e [*]: Session closed\n    Failed --\u003e [*]: Session closed\n    Cancelled --\u003e [*]: Session closed\n```\n\n**Sources:** [src/vs/workbench/contrib/chat/browser/agentSessions/localAgentSessionsProvider.ts:126-148]()\n\n### Session Resources and URIs\n\nSessions are identified by URIs with specific schemes:\n\n| Scheme | Purpose |\n|--------|---------|\n| `vscode-local-chat-session` | Local chat sessions |\n| `vscode-chat-editor` | Chat editor sessions |\n\nSessions are accessed through:\n- `IChatService.getSession(sessionResource: URI)`\n- `IChatWidgetService.getWidgetBySessionResource(sessionResource: URI)`\n\n**Sources:** [src/vs/workbench/contrib/chat/browser/agentSessions/localAgentSessionsProvider.ts:49]()\n\n### IChatSessionItem Interface\n\nSessions are represented externally as `IChatSessionItem` objects:\n\n```typescript\ninterface IChatSessionItem {\n    resource: URI;              // Session identifier\n    provider: IChatSessionItemProvider;\n    label: string;             // Display title\n    description?: string;      // Status description\n    status?: ChatSessionStatus;\n    iconPath?: ThemeIcon | URI;\n    timing?: { started: number; finished?: number };\n    changes?: {\n        insertions: number;\n        deletions: number;\n        files: number;\n    };\n}\n```\n\n**Sources:** [src/vs/workbench/contrib/chat/browser/agentSessions/localAgentSessionsProvider.ts:99-124]()\n\n---\n\n## Session Providers\n\n### IChatSessionItemProvider Interface\n\nSession providers implement the `IChatSessionItemProvider` interface to supply session listings for different session types:\n\n```mermaid\ngraph TB\n    subgraph \"Provider Interface\"\n        Provider[\"IChatSessionItemProvider\"]\n        Provider --\u003e Type[\"chatSessionType: string\"]\n        Provider --\u003e Provide[\"provideChatSessionItems(token)\"]\n        Provider --\u003e OnChange[\"onDidChangeChatSessionItems: Event\"]\n    end\n    \n    subgraph \"Built-in Providers\"\n        LocalProvider[\"LocalAgentsSessionsProvider\"]\n        LocalProvider --\u003e LocalType[\"chatSessionType = 'local'\"]\n    end\n    \n    subgraph \"Service\"\n        SessionService[\"IChatSessionsService\"]\n        SessionService --\u003e Register[\"registerChatSessionItemProvider()\"]\n        SessionService --\u003e GetItems[\"getSessionItems()\"]\n        SessionService --\u003e OnChangeSession[\"onDidChangeSessionItems\"]\n    end\n    \n    Provider --\u003e SessionService\n    LocalProvider --\u003e SessionService\n```\n\n**Sources:** [src/vs/workbench/contrib/chat/browser/agentSessions/localAgentSessionsProvider.ts:23-44]()\n\n### LocalAgentsSessionsProvider\n\nThe `LocalAgentsSessionsProvider` provides session listings for local chat sessions:\n\n**Key responsibilities:**\n- Provides sessions with `chatSessionType = 'local'`\n- Aggregates live sessions from `IChatService.getLiveSessionItems()`\n- Aggregates history sessions from `IChatService.getHistorySessionItems()`\n- Filters out sessions without requests\n- Computes status from model state or saved response state\n- Tracks session changes via model change listeners\n\n**Event handling:**\n- Listens to `IChatSessionsService.onDidChangeSessionItems`\n- Listens to `IChatService.onDidDisposeSession`\n- Registers model change listeners via `registerChatModelChangeListeners`\n\n**Sources:** [src/vs/workbench/contrib/chat/browser/agentSessions/localAgentSessionsProvider.ts:23-163]()\n\n### Session Item Conversion\n\nThe provider converts `IChatDetail` objects to `IChatSessionItem`:\n\n```mermaid\nflowchart LR\n    Detail[\"IChatDetail\"] --\u003e GetModel[\"Get IChatModel\"]\n    GetModel --\u003e HasModel{\"Model exists?\"}\n    \n    HasModel --\u003e|Yes| CheckRequests{\"Has requests?\"}\n    CheckRequests --\u003e|No| Skip[\"Skip (return undefined)\"]\n    CheckRequests --\u003e|Yes| BuildItem[\"Build IChatSessionItem\"]\n    \n    HasModel --\u003e|No| BuildItem\n    \n    BuildItem --\u003e Status[\"Compute status\"]\n    Status --\u003e Result[\"IChatSessionItem\"]\n```\n\n**Sources:** [src/vs/workbench/contrib/chat/browser/agentSessions/localAgentSessionsProvider.ts:99-125]()\n\n---\n\n## Session State and Status\n\n### ChatSessionStatus Enum\n\nSessions have one of the following statuses:\n\n| Status | Meaning |\n|--------|---------|\n| `InProgress` | Request is being processed |\n| `Completed` | Request completed successfully |\n| `Failed` | Request failed with error |\n| `NeedsInput` | Awaiting user confirmation or input |\n\n**Sources:** [src/vs/workbench/contrib/chat/browser/agentSessions/localAgentSessionsProvider.ts:127-145]()\n\n### Status Computation from Model\n\nThe status is derived from the model's current state:\n\n```mermaid\nflowchart TD\n    Start[\"Compute Status\"] --\u003e CheckProgress{\"requestInProgress?\"}\n    CheckProgress --\u003e|Yes| InProgress[\"InProgress\"]\n    CheckProgress --\u003e|No| GetLastRequest[\"Get last request\"]\n    \n    GetLastRequest --\u003e HasResponse{\"Has response?\"}\n    HasResponse --\u003e|No| NoStatus[\"undefined\"]\n    \n    HasResponse --\u003e|Yes| CheckState{\"Response state?\"}\n    CheckState --\u003e|NeedsInput| NeedsInput[\"NeedsInput\"]\n    CheckState --\u003e|Cancelled| Completed[\"Completed\"]\n    CheckState --\u003e|Error| Failed[\"Failed\"]\n    CheckState --\u003e|Complete| Completed\n    CheckState --\u003e|Other| InProgress\n```\n\n**Sources:** [src/vs/workbench/contrib/chat/browser/agentSessions/localAgentSessionsProvider.ts:127-148]()\n\n### Response Model States\n\nThe underlying `ResponseModelState` enum (used in saved sessions) maps to `ChatSessionStatus`:\n\n| ResponseModelState | ChatSessionStatus |\n|-------------------|-------------------|\n| `Pending` | `InProgress` |\n| `Complete` | `Completed` |\n| `Cancelled` | `Completed` |\n| `Failed` | `Failed` |\n| `NeedsInput` | `NeedsInput` |\n\n**Sources:** [src/vs/workbench/contrib/chat/browser/agentSessions/localAgentSessionsProvider.ts:150-162]()\n\n---\n\n## Mode Context in Extensions\n\n### Extension API Integration\n\nExtensions interact with modes through the Extension Host:\n\n```mermaid\ngraph LR\n    subgraph \"Extension Host\"\n        ExtAPI[\"vscode.chat API\"]\n        ExtAgent[\"ChatParticipant\"]\n        ExtRequest[\"ChatRequest\"]\n    end\n    \n    subgraph \"Main Thread\"\n        MainThread[\"MainThreadChatAgents2\"]\n        AgentService[\"IChatAgentService\"]\n        Widget[\"IChatWidget\"]\n    end\n    \n    ExtAgent --\u003e|\"invoke()\"| ExtAPI\n    ExtAPI --\u003e|\"$invokeAgent\"| MainThread\n    MainThread --\u003e AgentService\n    AgentService --\u003e|\"Get mode from\"| Widget\n    Widget --\u003e|\"input.currentModeKind\"| AgentService\n```\n\nWhen an agent is invoked, the current mode context is available through the request's session model.\n\n**Sources:** [src/vs/workbench/api/browser/mainThreadChatAgents2.ts:183-194](), [src/vs/workbench/api/common/extHostChatAgents2.ts:462-478]()\n\n### Mode-Specific Agent Behavior\n\nAgents can specify which modes they support:\n\n```typescript\n// Agent registration specifies supported modes\nchatAgentService.registerAgent({\n    // ...\n    locations: [ChatAgentLocation.Chat],\n    modes: [ChatModeKind.Ask, ChatModeKind.Agent, ChatModeKind.Edit]\n});\n```\n\nThe default agent for a mode is determined by `IChatAgentService.getDefaultAgent(location, mode)`.\n\n**Sources:** [src/vs/workbench/api/browser/mainThreadChatAgents2.ts:236](), [src/vs/workbench/contrib/chat/browser/actions/chatActions.ts:381-394]()\n\n---\n\n## Session Persistence and History\n\n### Session Timing\n\nSessions track timing information for telemetry and display:\n\n```typescript\ninterface SessionTiming {\n    started: number;      // Timestamp when session started\n    finished?: number;    // Timestamp when session finished (if complete)\n}\n```\n\n**Sources:** [src/vs/workbench/contrib/chat/browser/agentSessions/localAgentSessionsProvider.ts:118]()\n\n### Session Statistics\n\nSessions track code changes for display in session lists:\n\n```typescript\ninterface SessionChanges {\n    insertions: number;   // Lines added\n    deletions: number;    // Lines removed\n    files: number;        // Files modified\n}\n```\n\n**Sources:** [src/vs/workbench/contrib/chat/browser/agentSessions/localAgentSessionsProvider.ts:119-123]()\n\n### History Retrieval\n\nThe session provider aggregates both live and historical sessions:\n\n1. **Live sessions**: Retrieved via `IChatService.getLiveSessionItems()`\n   - Currently open sessions in widgets or editors\n   - Up-to-date model state\n\n2. **History sessions**: Retrieved via `IChatService.getHistorySessionItems()`\n   - Persisted sessions from previous interactions\n   - Stored status and statistics\n\nSessions are deduplicated by resource URI to prevent duplicates when a session appears in both lists.\n\n**Sources:** [src/vs/workbench/contrib/chat/browser/agentSessions/localAgentSessionsProvider.ts:67-97]()"])</script><script>self.__next_f.push([1,"3f:T5990,"])</script><script>self.__next_f.push([1,"# Chat Extension API\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [extensions/vscode-api-tests/package.json](extensions/vscode-api-tests/package.json)\n- [extensions/vscode-api-tests/src/singlefolder-tests/chat.test.ts](extensions/vscode-api-tests/src/singlefolder-tests/chat.test.ts)\n- [src/vs/editor/browser/config/charWidthReader.ts](src/vs/editor/browser/config/charWidthReader.ts)\n- [src/vs/editor/browser/editorBrowser.ts](src/vs/editor/browser/editorBrowser.ts)\n- [src/vs/editor/browser/viewParts/minimap/minimap.ts](src/vs/editor/browser/viewParts/minimap/minimap.ts)\n- [src/vs/editor/browser/viewParts/minimap/minimapCharRenderer.ts](src/vs/editor/browser/viewParts/minimap/minimapCharRenderer.ts)\n- [src/vs/editor/browser/viewParts/minimap/minimapCharRendererFactory.ts](src/vs/editor/browser/viewParts/minimap/minimapCharRendererFactory.ts)\n- [src/vs/editor/browser/viewParts/minimap/minimapCharSheet.ts](src/vs/editor/browser/viewParts/minimap/minimapCharSheet.ts)\n- [src/vs/editor/browser/viewParts/minimap/minimapPreBaked.ts](src/vs/editor/browser/viewParts/minimap/minimapPreBaked.ts)\n- [src/vs/editor/browser/widget/codeEditor/codeEditorWidget.ts](src/vs/editor/browser/widget/codeEditor/codeEditorWidget.ts)\n- [src/vs/editor/common/config/editorOptions.ts](src/vs/editor/common/config/editorOptions.ts)\n- [src/vs/editor/common/config/fontInfo.ts](src/vs/editor/common/config/fontInfo.ts)\n- [src/vs/editor/common/editorCommon.ts](src/vs/editor/common/editorCommon.ts)\n- [src/vs/editor/common/languages.ts](src/vs/editor/common/languages.ts)\n- [src/vs/editor/common/standalone/standaloneEnums.ts](src/vs/editor/common/standalone/standaloneEnums.ts)\n- [src/vs/editor/common/textModelEvents.ts](src/vs/editor/common/textModelEvents.ts)\n- [src/vs/editor/common/viewModel/minimapTokensColorTracker.ts](src/vs/editor/common/viewModel/minimapTokensColorTracker.ts)\n- [src/vs/editor/test/browser/view/minimapCharRenderer.test.ts](src/vs/editor/test/browser/view/minimapCharRenderer.test.ts)\n- [src/vs/monaco.d.ts](src/vs/monaco.d.ts)\n- [src/vs/platform/extensions/common/extensionsApiProposals.ts](src/vs/platform/extensions/common/extensionsApiProposals.ts)\n- [src/vs/workbench/api/browser/extensionHost.contribution.ts](src/vs/workbench/api/browser/extensionHost.contribution.ts)\n- [src/vs/workbench/api/browser/mainThreadChatAgents2.ts](src/vs/workbench/api/browser/mainThreadChatAgents2.ts)\n- [src/vs/workbench/api/browser/mainThreadLanguageFeatures.ts](src/vs/workbench/api/browser/mainThreadLanguageFeatures.ts)\n- [src/vs/workbench/api/common/extHost.api.impl.ts](src/vs/workbench/api/common/extHost.api.impl.ts)\n- [src/vs/workbench/api/common/extHost.protocol.ts](src/vs/workbench/api/common/extHost.protocol.ts)\n- [src/vs/workbench/api/common/extHostChatAgents2.ts](src/vs/workbench/api/common/extHostChatAgents2.ts)\n- [src/vs/workbench/api/common/extHostLanguageFeatures.ts](src/vs/workbench/api/common/extHostLanguageFeatures.ts)\n- [src/vs/workbench/api/common/extHostTypeConverters.ts](src/vs/workbench/api/common/extHostTypeConverters.ts)\n- [src/vs/workbench/api/common/extHostTypes.ts](src/vs/workbench/api/common/extHostTypes.ts)\n- [src/vs/workbench/contrib/chat/browser/actions/chatActions.ts](src/vs/workbench/contrib/chat/browser/actions/chatActions.ts)\n- [src/vs/workbench/contrib/chat/browser/actions/chatExecuteActions.ts](src/vs/workbench/contrib/chat/browser/actions/chatExecuteActions.ts)\n- [src/vs/workbench/contrib/chat/browser/agentSessions/localAgentSessionsProvider.ts](src/vs/workbench/contrib/chat/browser/agentSessions/localAgentSessionsProvider.ts)\n- [src/vs/workbench/contrib/chat/browser/chat.contribution.ts](src/vs/workbench/contrib/chat/browser/chat.contribution.ts)\n- [src/vs/workbench/contrib/chat/browser/chat.ts](src/vs/workbench/contrib/chat/browser/chat.ts)\n- [src/vs/workbench/contrib/chat/common/constants.ts](src/vs/workbench/contrib/chat/common/constants.ts)\n- [src/vs/workbench/contrib/chat/test/common/voiceChatService.test.ts](src/vs/workbench/contrib/chat/test/common/voiceChatService.test.ts)\n- [src/vs/workbench/services/chat/common/chatEntitlementService.ts](src/vs/workbench/services/chat/common/chatEntitlementService.ts)\n- [src/vscode-dts/vscode.d.ts](src/vscode-dts/vscode.d.ts)\n- [src/vscode-dts/vscode.proposed.chatParticipantAdditions.d.ts](src/vscode-dts/vscode.proposed.chatParticipantAdditions.d.ts)\n- [src/vscode-dts/vscode.proposed.defaultChatParticipant.d.ts](src/vscode-dts/vscode.proposed.defaultChatParticipant.d.ts)\n- [src/vscode-dts/vscode.proposed.inlineCompletionsAdditions.d.ts](src/vscode-dts/vscode.proposed.inlineCompletionsAdditions.d.ts)\n\n\u003c/details\u003e\n\n\n\nThis page documents the Extension API for contributing chat participants (agents), handling chat requests, and integrating with VS Code's chat system. This API allows extensions to create conversational interfaces that can interact with users through the chat view.\n\nFor information about the internal chat service architecture, see [Chat System Architecture](#10.1). For details about language models integration, see [Language Models and Tool Integration](#10.7).\n\n## Purpose and Scope\n\nThe Chat Extension API enables extensions to:\n- Register chat participants that respond to user queries\n- Define custom slash commands for chat interactions\n- Return structured responses with text, code blocks, file references, and more\n- Integrate with language model tools for enhanced capabilities\n- Access chat context including conversation history and user selections\n\nThis document covers the extension-facing API surface defined in the `vscode` namespace, the RPC protocol between the extension host and main thread, and the type conversion layer.\n\n## API Architecture Overview\n\nThe chat extension API follows VS Code's standard extension host pattern with bidirectional RPC communication:\n\n```mermaid\ngraph TB\n    subgraph \"Extension Process (ExtHost)\"\n        EXT[\"Extension Code\u003cbr/\u003e(vscode.chat namespace)\"]\n        EXTHOSTAGENTS[\"ExtHostChatAgents2\u003cbr/\u003eextHostChatAgents2.ts\"]\n        EXTHOSTCONVERTERS[\"Type Converters\u003cbr/\u003eextHostTypeConverters.ts\"]\n    end\n    \n    subgraph \"RPC Boundary\"\n        PROTOCOL[\"ExtHost Protocol\u003cbr/\u003eextHost.protocol.ts\u003cbr/\u003eIChatAgentRequest/Result\"]\n    end\n    \n    subgraph \"Main Thread (Renderer)\"\n        MAINTHREADAGENTS[\"MainThreadChatAgents2\u003cbr/\u003emainThreadChatAgents2.ts\"]\n        CHATAGENTSERVICE[\"ChatAgentService\u003cbr/\u003eIChatAgentService\"]\n        CHATSERVICE[\"ChatService\u003cbr/\u003eIChatService\"]\n    end\n    \n    EXT --\u003e|\"chat.createChatParticipant()\"| EXTHOSTAGENTS\n    EXTHOSTAGENTS --\u003e|\"Convert to DTO\"| EXTHOSTCONVERTERS\n    EXTHOSTCONVERTERS --\u003e|\"Serialize\"| PROTOCOL\n    PROTOCOL --\u003e|\"$registerAgent()\"| MAINTHREADAGENTS\n    MAINTHREADAGENTS --\u003e|\"Register provider\"| CHATAGENTSERVICE\n    CHATAGENTSERVICE \u003c--\u003e|\"Invoke agent\"| CHATSERVICE\n    CHATSERVICE --\u003e|\"Request via RPC\"| PROTOCOL\n    PROTOCOL --\u003e|\"$invokeAgent()\"| EXTHOSTAGENTS\n    EXTHOSTAGENTS --\u003e|\"Call handler\"| EXT\n```\n\n**Sources:** [src/vs/workbench/api/common/extHostChatAgents2.ts:1-600](), [src/vs/workbench/api/browser/mainThreadChatAgents2.ts:1-400](), [src/vs/workbench/api/common/extHost.protocol.ts:1-1000]()\n\n## Chat Participant Registration\n\nExtensions register chat participants using the `vscode.chat.createChatParticipant()` API. The registration includes metadata and a request handler.\n\n### Key Components\n\n| Component | Class/Interface | Purpose |\n|-----------|----------------|---------|\n| Chat Participant | `ChatParticipant` | The main extension-facing object for a registered agent |\n| Request Handler | `ChatRequestHandler` | Callback function that processes chat requests |\n| Metadata | `IExtensionChatAgentMetadata` | Agent ID, name, description, commands, locations |\n| Response Stream | `ChatResponseStream` | API for returning structured responses |\n\n### Registration Flow\n\n```mermaid\nsequenceDiagram\n    participant Ext as Extension\n    participant EH as ExtHostChatAgents2\n    participant RPC as RPC Protocol\n    participant MT as MainThreadChatAgents2\n    participant AS as ChatAgentService\n    \n    Ext-\u003e\u003eEH: chat.createChatParticipant(id, handler)\n    EH-\u003e\u003eEH: Create ChatAgentResponseStream\n    EH-\u003e\u003eEH: Generate internal handle\n    EH-\u003e\u003eRPC: $registerAgent(handle, metadata)\n    RPC-\u003e\u003eMT: Forward registration\n    MT-\u003e\u003eAS: registerAgent(id, data)\n    AS-\u003e\u003eAS: Store agent provider\n    MT--\u003e\u003eExt: Return ChatParticipant object\n    \n    Note over Ext: Extension can now update participant\n    Ext-\u003e\u003eEH: participant.iconPath = icon\n    EH-\u003e\u003eRPC: $updateAgent(handle, metadata)\n    RPC-\u003e\u003eMT: Update registration\n```\n\n### Registration Code Path\n\nThe registration begins in `ExtHostChatAgents2.createChatParticipant()`:\n\n[src/vs/workbench/api/common/extHostChatAgents2.ts:443-526]()\n\n```typescript\ncreateChatParticipant(\n    extension: IExtensionDescription,\n    id: string,\n    handler: vscode.ChatRequestHandler\n): vscode.ChatParticipant\n```\n\nThis method:\n1. Validates the participant ID\n2. Creates a response stream wrapper\n3. Generates an internal handle\n4. Calls `$registerAgent()` via RPC\n5. Returns a `ChatParticipant` object with updatable properties\n\n**Sources:** [src/vs/workbench/api/common/extHostChatAgents2.ts:443-600](), [src/vs/workbench/api/browser/mainThreadChatAgents2.ts:50-150]()\n\n## Chat Request Processing\n\nWhen a user sends a message to a chat participant, the request flows through multiple layers with type conversions.\n\n### Request Data Structures\n\n| Type | Location | Purpose |\n|------|----------|---------|\n| `ChatRequest` | vscode.d.ts | Extension-facing request object |\n| `IChatAgentRequest` | Protocol | Internal request DTO with session info |\n| `ChatAgentVoteDirection` | Protocol | Feedback direction (up/down) |\n| `ChatAgentLocation` | Constants | Where the chat is hosted (panel, editor, etc.) |\n\n### Request Flow Diagram\n\n```mermaid\ngraph LR\n    subgraph \"Main Thread\"\n        USER[\"User Input\u003cbr/\u003eChatWidget\"]\n        CHATSERVICE[\"ChatService\u003cbr/\u003esendRequest()\"]\n        AGENTSERVICE[\"ChatAgentService\u003cbr/\u003einvokeAgent()\"]\n        MAINTHREADAGENT[\"MainThreadChatAgents2\u003cbr/\u003e$invokeAgent()\"]\n    end\n    \n    subgraph \"RPC\"\n        PROTOCOL[\"Serialize Request\u003cbr/\u003eIChatAgentRequest\"]\n    end\n    \n    subgraph \"Extension Host\"\n        EXTHOSTAGENT[\"ExtHostChatAgents2\u003cbr/\u003e$invokeAgent()\"]\n        CONVERTER[\"Type Converters\u003cbr/\u003eChatRequest.to()\"]\n        HANDLER[\"Extension Handler\u003cbr/\u003eChatRequestHandler\"]\n        STREAM[\"ChatResponseStream\u003cbr/\u003eResponse Building\"]\n    end\n    \n    USER --\u003e|\"Submit message\"| CHATSERVICE\n    CHATSERVICE --\u003e|\"Route to agent\"| AGENTSERVICE\n    AGENTSERVICE --\u003e|\"Invoke via RPC\"| MAINTHREADAGENT\n    MAINTHREADAGENT --\u003e|\"Serialize\"| PROTOCOL\n    PROTOCOL --\u003e|\"$invokeAgent()\"| EXTHOSTAGENT\n    EXTHOSTAGENT --\u003e|\"Convert types\"| CONVERTER\n    CONVERTER --\u003e|\"Create ChatRequest\"| HANDLER\n    HANDLER --\u003e|\"Use stream API\"| STREAM\n    STREAM --\u003e|\"Progress chunks\"| PROTOCOL\n```\n\n### Request Conversion\n\nThe `IChatAgentRequest` from main thread is converted to extension API types in `ExtHostChatAgents2.$invokeAgent()`:\n\n[src/vs/workbench/api/common/extHostChatAgents2.ts:615-750]()\n\nKey conversions include:\n- **Variables/Context**: Converted via `typeConvert.ChatResolvedVariable.to()`\n- **Location**: Mapped from `ChatAgentLocation` enum\n- **Model**: Language model metadata if available\n- **User-selected tools**: Converted to extension tool references\n\n**Sources:** [src/vs/workbench/api/common/extHostChatAgents2.ts:615-800](), [src/vs/workbench/api/common/extHostTypeConverters.ts:4600-4800]()\n\n## Chat Response API\n\nExtensions return responses through the `ChatResponseStream` object passed to the request handler. The stream supports multiple content types.\n\n### Response Part Types\n\n```mermaid\ngraph TB\n    STREAM[\"ChatResponseStream\"]\n    \n    STREAM --\u003e|\"markdown()\"| MD[\"MarkdownPart\u003cbr/\u003eText content\"]\n    STREAM --\u003e|\"anchor()\"| ANCHOR[\"AnchorPart\u003cbr/\u003eURI references\"]\n    STREAM --\u003e|\"button()\"| BUTTON[\"CommandButtonPart\u003cbr/\u003eExecutable commands\"]\n    STREAM --\u003e|\"filetree()\"| TREE[\"FileTreePart\u003cbr/\u003eDirectory structures\"]\n    STREAM --\u003e|\"progress()\"| PROGRESS[\"ProgressPart\u003cbr/\u003eStatus updates\"]\n    STREAM --\u003e|\"reference()\"| REF[\"ReferencePart\u003cbr/\u003eFile/URI references\"]\n    STREAM --\u003e|\"push()\"| CUSTOM[\"Custom ChatResponsePart\u003cbr/\u003eExtended types\"]\n    \n    style STREAM fill:#f9f9f9\n```\n\n### Response Stream Implementation\n\nThe `ChatAgentResponseStream` class wraps the RPC protocol and provides the extension-facing API:\n\n[src/vs/workbench/api/common/extHostChatAgents2.ts:41-350]()\n\nKey methods:\n- `markdown(value)` - Add markdown content\n- `reference(value)` - Add file or URI reference\n- `progress(value)` - Add progress message\n- `button(command)` - Add command button\n- `push(part)` - Add custom response part\n\nAll parts are queued and sent in batches via microtask to minimize RPC calls:\n\n[src/vs/workbench/api/common/extHostChatAgents2.ts:86-110]()\n\n### Type Conversions for Response Parts\n\nThe converter functions transform extension API types to internal DTOs:\n\n| Extension Type | Converter Function | Internal DTO |\n|----------------|-------------------|--------------|\n| `ChatResponseMarkdownPart` | `ChatResponsePart.from()` | `IChatMarkdownContent` |\n| `ChatResponseAnchorPart` | `ChatResponsePart.from()` | `IChatContentInlineReference` |\n| `ChatResponseCommandButtonPart` | `ChatResponsePart.from()` | `IChatCommandButton` |\n| `ChatResponseReferencePart` | `ChatResponsePart.from()` | `IChatContentReference` |\n\n[src/vs/workbench/api/common/extHostTypeConverters.ts:4200-4600]()\n\n**Sources:** [src/vs/workbench/api/common/extHostChatAgents2.ts:41-350](), [src/vs/workbench/api/common/extHostTypeConverters.ts:4200-4700]()\n\n## Language Model Tools Integration\n\nChat participants can use language model tools registered by other extensions or define their own tools.\n\n### Tool Request Flow\n\n```mermaid\nsequenceDiagram\n    participant Agent as Chat Participant\n    participant Stream as ChatResponseStream\n    participant Tools as ExtHostLanguageModelTools\n    participant LM as Language Model\n    participant ToolExt as Tool Extension\n    \n    Agent-\u003e\u003eStream: request.userSelectedTools\n    Note over Agent: Check available tools\n    Agent-\u003e\u003eLM: Send request with tool refs\n    LM-\u003e\u003eTools: Invoke tool\n    Tools-\u003e\u003eToolExt: Execute tool handler\n    ToolExt--\u003e\u003eTools: Return result\n    Tools--\u003e\u003eLM: Tool result\n    LM--\u003e\u003eAgent: Response with tool data\n    Agent-\u003e\u003eStream: markdown(result)\n```\n\n### Tool References in Requests\n\nWhen users explicitly reference tools, they're included in the request:\n\n[src/vs/workbench/api/common/extHostChatAgents2.ts:685-695]()\n\n```typescript\n// Convert tool references from request\nconst toolReferences = request.userSelectedTools?.map(tool =\u003e ({\n    id: tool.id,\n    name: tool.name,\n    icon: tool.icon\n}));\n```\n\nExtensions can check `request.userSelectedTools` to see which tools were explicitly requested and potentially adjust their behavior.\n\n**Sources:** [src/vs/workbench/api/common/extHostChatAgents2.ts:685-700](), [src/vs/workbench/api/common/extHostLanguageModelTools.ts:1-300]()\n\n## Chat Context and Variables\n\nChat requests include context from the conversation and workspace through the `ChatContext` object.\n\n### Context Structure\n\n| Property | Type | Purpose |\n|----------|------|---------|\n| `history` | `ChatRequestTurn[]` | Previous requests and responses in session |\n| `variables` | `ChatResolvedVariable[]` | Resolved variables like `#file`, `#selection` |\n\n### Variable Resolution\n\nVariables are resolved on the main thread before being sent to extensions:\n\n[src/vs/workbench/api/common/extHostTypeConverters.ts:4050-4150]()\n\nThe converter handles different variable kinds:\n- **File variables**: URI with optional line ranges\n- **Image variables**: Binary data as `vscode.DataTransferFile`\n- **Prompt variables**: Prompt text or file references\n- **Tool variables**: Tool references\n- **Context variables**: Generic context items\n\nExample conversion:\n\n```typescript\n// From protocol DTO to extension API\nexport function to(variable: IChatRequestVariableValue): vscode.ChatResolvedVariable {\n    if (variable.kind === 'file') {\n        return {\n            name: variable.name,\n            value: URI.revive(variable.uri),\n            range: variable.range \u0026\u0026 typeConvert.Range.to(variable.range)\n        };\n    }\n    // ... other kinds\n}\n```\n\n**Sources:** [src/vs/workbench/api/common/extHostTypeConverters.ts:4050-4200](), [src/vs/workbench/api/common/extHostChatAgents2.ts:650-700]()\n\n## Progress Reporting\n\nChat participants can report detailed progress during request processing using various progress types.\n\n### Progress Types and Usage\n\n```mermaid\ngraph LR\n    HANDLER[\"Request Handler\"]\n    \n    HANDLER --\u003e|\"stream.progress()\"| TEXT[\"Text Progress\u003cbr/\u003e'Processing files...'\"]\n    HANDLER --\u003e|\"stream.reference()\"| REF[\"Reference Progress\u003cbr/\u003eFile being processed\"]\n    HANDLER --\u003e|\"Task API\"| TASK[\"Task Progress\u003cbr/\u003eConfirmable actions\"]\n    HANDLER --\u003e|\"Tool invocation\"| TOOL[\"Tool Progress\u003cbr/\u003eTool execution status\"]\n    \n    TEXT --\u003e|\"Appears in chat\"| UI[\"Chat UI\"]\n    REF --\u003e|\"Shows in references\"| UI\n    TASK --\u003e|\"Confirmation UI\"| UI\n    TOOL --\u003e|\"Tool status\"| UI\n```\n\n### Progress Implementation\n\nThe progress method queues updates for batched sending:\n\n[src/vs/workbench/api/common/extHostChatAgents2.ts:130-145]()\n\nProgress parts are converted to internal DTOs:\n\n[src/vs/workbench/api/common/extHostTypeConverters.ts:4300-4400]()\n\nTypes include:\n- `IChatProgressMessage` - Status text\n- `IChatTask` - Confirmable tasks\n- `IChatWarningMessage` - Warnings\n- `IChatContentReference` - File/URI references\n\n**Sources:** [src/vs/workbench/api/common/extHostChatAgents2.ts:130-200](), [src/vs/workbench/api/common/extHostTypeConverters.ts:4300-4450]()\n\n## Advanced Features\n\n### Followup Questions\n\nParticipants can suggest followup questions after a response completes:\n\n[src/vs/workbench/api/common/extHostChatAgents2.ts:290-320]()\n\nFollowups are registered via the participant object:\n\n```typescript\nparticipant.followupProvider = {\n    provideFollowups(result, context, token) {\n        return [\n            { prompt: \"Tell me more\", command: \"explain\" },\n            { prompt: \"Show examples\" }\n        ];\n    }\n};\n```\n\n### Sample Requests\n\nParticipants can provide sample prompts to help users get started:\n\n[src/vs/workbench/api/browser/mainThreadChatAgents2.ts:200-250]()\n\nSamples are registered as completion items that appear in the chat input.\n\n### Vote Handling\n\nExtensions can respond to user feedback (thumbs up/down):\n\n[src/vs/workbench/api/common/extHostChatAgents2.ts:755-790]()\n\nThe `onDidReceiveFeedback` event fires when users vote on responses, allowing agents to learn from feedback.\n\n### Location-Specific Behavior\n\nAgents can support different chat locations (panel, editor, terminal, notebook):\n\n[src/vs/workbench/api/common/extHost.protocol.ts:57-67]()\n\nThe `request.location` property indicates where the chat is hosted, allowing agents to customize their behavior.\n\n**Sources:** [src/vs/workbench/api/common/extHostChatAgents2.ts:290-320](), [src/vs/workbench/api/common/extHostChatAgents2.ts:755-790](), [src/vs/workbench/api/browser/mainThreadChatAgents2.ts:200-300]()\n\n## Protocol Layer\n\nThe RPC protocol defines the interface between extension host and main thread.\n\n### Key Protocol Interfaces\n\n| Interface | Purpose | Direction |\n|-----------|---------|-----------|\n| `MainThreadChatAgentsShape2` | Main thread API surface | ExtHost  Main |\n| `ExtHostChatAgentsShape2` | Extension host API surface | Main  ExtHost |\n| `IChatAgentRequest` | Serialized request data | Main  ExtHost |\n| `IChatProgressDto` | Serialized progress updates | ExtHost  Main |\n| `IChatAgentMetadata` | Agent registration metadata | ExtHost  Main |\n\n### Protocol Methods\n\n**Main Thread Shape:**\n- `$registerAgent(handle, metadata)` - Register new participant\n- `$updateAgent(handle, metadata)` - Update participant properties\n- `$unregisterAgent(handle)` - Remove participant\n\n**Extension Host Shape:**\n- `$invokeAgent(handle, request, context)` - Process chat request\n- `$releaseSession(sessionId)` - Clean up session resources\n- `$acceptFeedback(handle, result, vote)` - Handle user votes\n\n[src/vs/workbench/api/common/extHost.protocol.ts:1750-1850]()\n\n**Sources:** [src/vs/workbench/api/common/extHost.protocol.ts:1750-1900](), [src/vs/workbench/api/browser/mainThreadChatAgents2.ts:1-100]()\n\n## API Usage Example\n\nBased on the test files, here's how extensions typically use the chat API:\n\n```typescript\n// From test: extensions/vscode-api-tests/src/singlefolder-tests/chat.test.ts\n\nconst participant = vscode.chat.createChatParticipant(\n    'test-participant',\n    async (request, context, stream, token) =\u003e {\n        // Access request properties\n        const prompt = request.prompt;\n        const command = request.command;\n        const variables = request.variables;\n        \n        // Report progress\n        stream.progress('Processing request...');\n        \n        // Add references\n        stream.reference(vscode.Uri.file('/path/to/file'));\n        \n        // Return markdown content\n        stream.markdown('# Result\\n\\nHere is the answer...');\n        \n        // Return metadata\n        return { metadata: { key: 'value' } };\n    }\n);\n\n// Configure participant\nparticipant.iconPath = vscode.Uri.file('icon.png');\nparticipant.followupProvider = {\n    provideFollowups(result, context, token) {\n        return [{ prompt: 'More details' }];\n    }\n};\n```\n\n**Sources:** [extensions/vscode-api-tests/src/singlefolder-tests/chat.test.ts:1-300]()\n\n## Type Safety and Validation\n\nThe extension API enforces type safety through several mechanisms:\n\n### Extension API Types (vscode.d.ts)\n\nThe public API is defined in TypeScript definition files:\n- [src/vscode-dts/vscode.d.ts:18500-19500]() - Core chat types\n- [src/vscode-dts/vscode.proposed.chatParticipantAdditions.d.ts:1-200]() - Extended chat features\n- [src/vscode-dts/vscode.proposed.chatParticipantPrivate.d.ts:1-400]() - Private/proposed APIs\n\n### Runtime Validation\n\nThe `ExtHostChatAgents2` class validates inputs:\n\n[src/vs/workbench/api/common/extHostChatAgents2.ts:445-470]()\n\nValidation includes:\n- Participant ID format and uniqueness\n- Required handler function\n- Proper extension context\n- Location support\n\n### Type Converters\n\nBidirectional type converters ensure consistency:\n\n[src/vs/workbench/api/common/extHostTypeConverters.ts:4000-4800]()\n\nConverters handle:\n- URI reviving and transformation\n- Enum mapping between API and internal values\n- Complex object graph serialization\n- Buffer/binary data handling\n\n**Sources:** [src/vscode-dts/vscode.d.ts:18500-19500](), [src/vs/workbench/api/common/extHostChatAgents2.ts:445-470](), [src/vs/workbench/api/common/extHostTypeConverters.ts:4000-4900]()"])</script><script>self.__next_f.push([1,"40:Tbc9c,"])</script><script>self.__next_f.push([1,"# Notebooks\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [extensions/markdown-language-features/notebook/index.ts](extensions/markdown-language-features/notebook/index.ts)\n- [src/vs/workbench/api/browser/mainThreadNotebook.ts](src/vs/workbench/api/browser/mainThreadNotebook.ts)\n- [src/vs/workbench/api/common/extHostNotebook.ts](src/vs/workbench/api/common/extHostNotebook.ts)\n- [src/vs/workbench/contrib/notebook/browser/media/notebook.css](src/vs/workbench/contrib/notebook/browser/media/notebook.css)\n- [src/vs/workbench/contrib/notebook/browser/notebook.contribution.ts](src/vs/workbench/contrib/notebook/browser/notebook.contribution.ts)\n- [src/vs/workbench/contrib/notebook/browser/notebookBrowser.ts](src/vs/workbench/contrib/notebook/browser/notebookBrowser.ts)\n- [src/vs/workbench/contrib/notebook/browser/notebookEditor.ts](src/vs/workbench/contrib/notebook/browser/notebookEditor.ts)\n- [src/vs/workbench/contrib/notebook/browser/notebookEditorWidget.ts](src/vs/workbench/contrib/notebook/browser/notebookEditorWidget.ts)\n- [src/vs/workbench/contrib/notebook/browser/view/notebookCellList.ts](src/vs/workbench/contrib/notebook/browser/view/notebookCellList.ts)\n- [src/vs/workbench/contrib/notebook/browser/view/renderers/backLayerWebView.ts](src/vs/workbench/contrib/notebook/browser/view/renderers/backLayerWebView.ts)\n- [src/vs/workbench/contrib/notebook/browser/view/renderers/cellRenderer.ts](src/vs/workbench/contrib/notebook/browser/view/renderers/cellRenderer.ts)\n- [src/vs/workbench/contrib/notebook/browser/view/renderers/webviewMessages.ts](src/vs/workbench/contrib/notebook/browser/view/renderers/webviewMessages.ts)\n- [src/vs/workbench/contrib/notebook/browser/view/renderers/webviewPreloads.ts](src/vs/workbench/contrib/notebook/browser/view/renderers/webviewPreloads.ts)\n- [src/vs/workbench/contrib/notebook/browser/viewModel/baseCellViewModel.ts](src/vs/workbench/contrib/notebook/browser/viewModel/baseCellViewModel.ts)\n- [src/vs/workbench/contrib/notebook/browser/viewModel/codeCellViewModel.ts](src/vs/workbench/contrib/notebook/browser/viewModel/codeCellViewModel.ts)\n- [src/vs/workbench/contrib/notebook/browser/viewModel/markupCellViewModel.ts](src/vs/workbench/contrib/notebook/browser/viewModel/markupCellViewModel.ts)\n- [src/vs/workbench/contrib/notebook/common/model/notebookCellTextModel.ts](src/vs/workbench/contrib/notebook/common/model/notebookCellTextModel.ts)\n- [src/vs/workbench/contrib/notebook/common/model/notebookTextModel.ts](src/vs/workbench/contrib/notebook/common/model/notebookTextModel.ts)\n- [src/vs/workbench/contrib/notebook/common/notebookCommon.ts](src/vs/workbench/contrib/notebook/common/notebookCommon.ts)\n- [src/vs/workbench/contrib/notebook/common/notebookEditorModel.ts](src/vs/workbench/contrib/notebook/common/notebookEditorModel.ts)\n- [src/vs/workbench/contrib/notebook/common/notebookService.ts](src/vs/workbench/contrib/notebook/common/notebookService.ts)\n\n\u003c/details\u003e\n\n\n\nThe notebook editor system provides specialized editing capabilities for interactive computational documents, primarily Jupyter notebooks (.ipynb files). A notebook document consists of a sequence of cells, where each cell is either:\n- **Code Cell**: Executable code that produces outputs (text, images, interactive widgets)\n- **Markup Cell**: Formatted text using Markdown\n\nThe notebook editor manages the complete lifecycle of these cells, including editing, execution, output rendering, and serialization. The system is designed to handle large notebooks efficiently through virtualization, supports rich interactive outputs via webview rendering, and provides an extensible architecture for third-party notebook providers and renderers.\n\n**Key Components:**\n- `NotebookEditor` and `NotebookEditorWidget`: Main editor pane and widget\n- `NotebookTextModel`: Document model managing cells and their content\n- `NotebookViewModel`: View state and UI coordination layer\n- `BackLayerWebView`: Isolated rendering environment for cell outputs\n- `NotebookCellList`: Virtualized list for efficient cell rendering\n\nFor information about the extension system that enables notebook providers, see [Extension System](#5). For details about how language features work within notebook cells, see [Language Features Provider System](#5.3).\n\n---\n\n## Architecture Overview\n\nThe notebook system is organized into four distinct layers, each with specific responsibilities:\n\n**Diagram: Notebook System Layers**\n```mermaid\ngraph TB\n    subgraph \"UI Layer\"\n        NotebookEditorWidget[\"NotebookEditorWidget\u003cbr/\u003e(notebookEditorWidget.ts:142)\"]\n        NotebookCellList[\"NotebookCellList\u003cbr/\u003e(notebookCellList.ts:80)\"]\n        CodeCellRenderer[\"CodeCellRenderer\u003cbr/\u003e(cellRenderer.ts:237)\"]\n        MarkupCellRenderer[\"MarkupCellRenderer\u003cbr/\u003e(cellRenderer.ts:112)\"]\n        BackLayerWebView[\"BackLayerWebView\u0026lt;T\u0026gt;\u003cbr/\u003e(backLayerWebView.ts:129)\"]\n    end\n    \n    subgraph \"View Model Layer\"\n        NotebookViewModel[\"NotebookViewModel\u003cbr/\u003e(notebookViewModelImpl.ts)\"]\n        CodeCellViewModel[\"CodeCellViewModel\u003cbr/\u003e(codeCellViewModel.ts:30)\"]\n        MarkupCellViewModel[\"MarkupCellViewModel\u003cbr/\u003e(markupCellViewModel.ts:22)\"]\n        CellOutputViewModel[\"CellOutputViewModel\u003cbr/\u003e(cellOutputViewModel.ts)\"]\n    end\n    \n    subgraph \"Data Model Layer\"\n        NotebookTextModel[\"NotebookTextModel\u003cbr/\u003eimplements INotebookTextModel\u003cbr/\u003e(notebookTextModel.ts)\"]\n        NotebookCellTextModel[\"NotebookCellTextModel\u003cbr/\u003eimplements ICell\u003cbr/\u003e(notebookCellTextModel.ts:26)\"]\n        NotebookCellOutputTextModel[\"NotebookCellOutputTextModel\u003cbr/\u003eimplements ICellOutput\u003cbr/\u003e(notebookCellOutputTextModel.ts)\"]\n    end\n    \n    subgraph \"Extension API Layer\"\n        ExtHostNotebook[\"ExtHostNotebook\u003cbr/\u003eExtHostNotebookShape\u003cbr/\u003e(extHostNotebook.ts:43)\"]\n        MainThreadNotebook[\"MainThreadNotebook\u003cbr/\u003eMainThreadNotebookShape\u003cbr/\u003e(mainThreadNotebook.ts:30)\"]\n    end\n    \n    NotebookEditorWidget --\u003e NotebookViewModel\n    NotebookCellList --\u003e CodeCellViewModel\n    NotebookCellList --\u003e MarkupCellViewModel\n    CodeCellRenderer --\u003e CodeCellViewModel\n    MarkupCellRenderer --\u003e MarkupCellViewModel\n    BackLayerWebView --\u003e CellOutputViewModel\n    \n    NotebookViewModel --\u003e NotebookTextModel\n    CodeCellViewModel --\u003e NotebookCellTextModel\n    MarkupCellViewModel --\u003e NotebookCellTextModel\n    CellOutputViewModel --\u003e NotebookCellOutputTextModel\n    \n    ExtHostNotebook --\u003e|\"RPC Protocol\u003cbr/\u003e(extHost.protocol.ts)\"| MainThreadNotebook\n    MainThreadNotebook --\u003e NotebookTextModel\n```\n\nSources: [src/vs/workbench/contrib/notebook/browser/notebookEditorWidget.ts:142-476](), [src/vs/workbench/contrib/notebook/browser/view/notebookCellList.ts:80-140](), [src/vs/workbench/contrib/notebook/browser/viewModel/notebookViewModelImpl.ts:1-200](), [src/vs/workbench/contrib/notebook/common/model/notebookTextModel.ts:1-310](), [src/vs/workbench/api/common/extHostNotebook.ts:43-150]()\n\n---\n\n## Notebook Editor Widget\n\nThe `NotebookEditorWidget` is the main UI component that orchestrates the entire notebook editing experience. It is instantiated by the `NotebookEditor` editor pane and manages the layout, rendering, and interaction of all notebook elements.\n\n### Core Components\n\n**Diagram: NotebookEditorWidget Component Structure**\n```mermaid\ngraph TB\n    NotebookEditorWidget[\"NotebookEditorWidget\u003cbr/\u003eclass (notebookEditorWidget.ts:142)\"]\n    \n    subgraph \"Top Level Components\"\n        TopToolbar[\"NotebookEditorWorkbenchToolbar\u003cbr/\u003e_notebookTopToolbar: NotebookEditorWorkbenchToolbar\u003cbr/\u003e(notebookEditorWidget.ts:194)\"]\n        StickyScroll[\"NotebookStickyScroll\u003cbr/\u003e_notebookStickyScroll: NotebookStickyScroll\u003cbr/\u003e(notebookEditorWidget.ts:196)\"]\n        OverviewRuler[\"NotebookOverviewRuler\u003cbr/\u003e_notebookOverviewRuler: NotebookOverviewRuler\u003cbr/\u003e(notebookEditorWidget.ts:198)\"]\n    end\n    \n    subgraph \"Cell List\"\n        CellList[\"NotebookCellList\u003cbr/\u003e_list: INotebookCellList\u003cbr/\u003e(notebookEditorWidget.ts:206)\"]\n        ListDelegate[\"NotebookCellListDelegate\u003cbr/\u003e_listDelegate: NotebookCellListDelegate\u003cbr/\u003e(notebookEditorWidget.ts:205)\"]\n    end\n    \n    subgraph \"Webview\"\n        BackLayerWebView[\"BackLayerWebView\u003cICommonCellInfo\u003e\u003cbr/\u003e_webview: BackLayerWebView | null\u003cbr/\u003e(notebookEditorWidget.ts:202)\"]\n    end\n    \n    subgraph \"Editor Pool\"\n        EditorPool[\"NotebookCellEditorPool\u003cbr/\u003e_editorPool: NotebookCellEditorPool\u003cbr/\u003e(notebookEditorWidget.ts:211)\"]\n        RenderedEditors[\"Map\u003cICellViewModel, ICodeEditor\u003e\u003cbr/\u003e_renderedEditors\u003cbr/\u003e(notebookEditorWidget.ts:210)\"]\n    end\n    \n    NotebookEditorWidget --\u003e TopToolbar\n    NotebookEditorWidget --\u003e StickyScroll\n    NotebookEditorWidget --\u003e OverviewRuler\n    NotebookEditorWidget --\u003e CellList\n    NotebookEditorWidget --\u003e BackLayerWebView\n    NotebookEditorWidget --\u003e EditorPool\n    \n    CellList --\u003e ListDelegate\n    EditorPool --\u003e RenderedEditors\n```\n\nThe widget maintains several key data structures:\n- `_notebookViewModel: NotebookViewModel | undefined`: The active notebook's view model (line 213)\n- `_renderedEditors: Map\u003cICellViewModel, ICodeEditor\u003e`: Map tracking Monaco editor instances for each visible cell (line 210)\n- `_webview: BackLayerWebView\u003cICommonCellInfo\u003e | null`: The webview component for rendering cell outputs and markup previews (line 202)\n- `_list: INotebookCellList`: The virtualized list component managing cell rendering (line 206)\n- `_editorPool: NotebookCellEditorPool`: Pool of reusable Monaco editors for performance (line 211)\n\nSources: [src/vs/workbench/contrib/notebook/browser/notebookEditorWidget.ts:142-233](), [src/vs/workbench/contrib/notebook/browser/notebookEditorWidget.ts:614-641]()\n\n### Initialization Flow\n\nThe widget initialization follows this sequence when a notebook is opened:\n\n**Diagram: Notebook Initialization Sequence**\n```mermaid\nsequenceDiagram\n    participant NE as NotebookEditor\u003cbr/\u003e(notebookEditor.ts)\n    participant NEW as NotebookEditorWidget\u003cbr/\u003e(notebookEditorWidget.ts)\n    participant VM as NotebookViewModel\u003cbr/\u003e(notebookViewModelImpl.ts)\n    participant CL as NotebookCellList\u003cbr/\u003e(notebookCellList.ts)\n    participant BW as BackLayerWebView\u003cbr/\u003e(backLayerWebView.ts)\n    \n    NE-\u003e\u003eNEW: setInput(input, options)\n    NEW-\u003e\u003eNEW: _loadNotebookEditorModel(input)\n    Note over NEW: Loads NotebookTextModel\n    NEW-\u003e\u003eVM: new NotebookViewModel(model, viewContext)\n    NEW-\u003e\u003eNEW: _detachModel() / _attachModel(viewModel)\n    NEW-\u003e\u003eCL: attachViewModel(viewModel)\n    Note over CL: Sets up cell rendering\n    NEW-\u003e\u003eBW: createWebview(targetWindow)\n    Note over BW: Initializes isolated webview\n    NEW-\u003e\u003eNEW: _restoreSelectedKernel()\n    NEW-\u003e\u003eNEW: restoreListViewState(viewState)\n    Note over NEW: Restores scroll, selections, etc.\n```\n\nKey methods in the initialization flow:\n- `NotebookEditor.setInput()`: Entry point for loading a notebook ([notebookEditor.ts:197-300]())\n- `NotebookEditorWidget._loadNotebookEditorModel()`: Resolves the notebook model ([notebookEditorWidget.ts:1700-1800]())\n- `NotebookEditorWidget._attachModel()`: Attaches view model to widget ([notebookEditorWidget.ts:1800-1900]())\n- `NotebookCellList.attachViewModel()`: Binds view model to list ([notebookCellList.ts:200-300]())\n- `BackLayerWebView.createWebview()`: Creates webview for output rendering ([backLayerWebView.ts:550-594]())\n\nSources: [src/vs/workbench/contrib/notebook/browser/notebookEditor.ts:197-300](), [src/vs/workbench/contrib/notebook/browser/notebookEditorWidget.ts:1700-1900](), [src/vs/workbench/contrib/notebook/browser/view/notebookCellList.ts:200-300](), [src/vs/workbench/contrib/notebook/browser/view/renderers/backLayerWebView.ts:550-594]()\n\n---\n\n## Cell Management and Rendering\n\nNotebook cells are managed through a virtualized list architecture that efficiently handles large notebooks by only rendering visible cells.\n\n### Cell List Architecture\n\n**Diagram: NotebookCellList and Renderer Architecture**\n```mermaid\ngraph TB\n    NotebookCellList[\"NotebookCellList\u003cbr/\u003eextends WorkbenchList\u0026lt;CellViewModel\u0026gt;\u003cbr/\u003e(notebookCellList.ts:80)\"]\n    \n    subgraph \"List Implementation\"\n        NotebookCellListView[\"NotebookCellListView\u0026lt;CellViewModel\u0026gt;\u003cbr/\u003eextends ListView\u003cbr/\u003e(notebookCellListView.ts)\"]\n        ListDelegate[\"NotebookCellListDelegate\u003cbr/\u003eimplements IListVirtualDelegate\u003cbr/\u003e(cellRenderer.ts:57)\"]\n    end\n    \n    subgraph \"Cell Renderers\"\n        CodeCellRenderer[\"CodeCellRenderer\u003cbr/\u003eimplements IListRenderer\u003cbr/\u003eTEMPLATE_ID: 'code_cell'\u003cbr/\u003e(cellRenderer.ts:237)\"]\n        MarkupCellRenderer[\"MarkupCellRenderer\u003cbr/\u003eimplements IListRenderer\u003cbr/\u003eTEMPLATE_ID: 'markdown_cell'\u003cbr/\u003e(cellRenderer.ts:112)\"]\n    end\n    \n    subgraph \"Cell Templates\"\n        CodeCellTemplate[\"CodeCellRenderTemplate\u003cbr/\u003e(notebookRenderingCommon.ts)\"]\n        MarkupCellTemplate[\"MarkdownCellRenderTemplate\u003cbr/\u003e(notebookRenderingCommon.ts)\"]\n    end\n    \n    subgraph \"View Zones \u0026 Overlays\"\n        ViewZones[\"NotebookViewZones\u003cbr/\u003eviewZones: NotebookViewZones\u003cbr/\u003e(notebookCellList.ts:82)\"]\n        CellOverlays[\"NotebookCellOverlays\u003cbr/\u003ecellOverlays: NotebookCellOverlays\u003cbr/\u003e(notebookCellList.ts:83)\"]\n    end\n    \n    NotebookCellList --\u003e NotebookCellListView\n    NotebookCellList --\u003e ListDelegate\n    NotebookCellList --\u003e ViewZones\n    NotebookCellList --\u003e CellOverlays\n    \n    CodeCellRenderer --\u003e|\"renderTemplate()\u003cbr/\u003ereturns\"| CodeCellTemplate\n    MarkupCellRenderer --\u003e|\"renderTemplate()\u003cbr/\u003ereturns\"| MarkupCellTemplate\n    \n    NotebookCellListView --\u003e|\"uses via\u003cbr/\u003egetTemplateId()\"| CodeCellRenderer\n    NotebookCellListView --\u003e|\"uses via\u003cbr/\u003egetTemplateId()\"| MarkupCellRenderer\n    \n    ListDelegate --\u003e|\"getTemplateId(element)\"| CodeCellRenderer\n    ListDelegate --\u003e|\"getTemplateId(element)\"| MarkupCellRenderer\n```\n\nThe `NotebookCellListDelegate` determines which renderer to use based on cell type:\n- Returns `'code_cell'` for `CellKind.Code` (line 78-82 in cellRenderer.ts)\n- Returns `'markdown_cell'` for `CellKind.Markup` (line 78-82 in cellRenderer.ts)\n\nThe list uses virtualization to only render visible cells, improving performance for large notebooks. The `getHeight()` and `getDynamicHeight()` methods in the delegate control cell sizing.\n\nSources: [src/vs/workbench/contrib/notebook/browser/view/notebookCellList.ts:80-140](), [src/vs/workbench/contrib/notebook/browser/view/renderers/cellRenderer.ts:57-85](), [src/vs/workbench/contrib/notebook/browser/view/renderers/cellRenderer.ts:112-137](), [src/vs/workbench/contrib/notebook/browser/view/renderers/cellRenderer.ts:237-258]()\n\n### Cell Rendering Templates\n\nEach cell type has a corresponding renderer that creates and manages rendering templates:\n\n**Code Cell Template** includes:\n- `runToolbar`: Toolbar with execution controls\n- `editorPart`: Container for Monaco editor\n- `editorContainer`: DOM element hosting the editor\n- `outputContainer`: Container for cell outputs\n- `focusIndicators`: Visual focus indicators (top, left, right, bottom)\n- `cellParts`: Collection of cell UI parts (toolbar, status bar, decorations, etc.)\n\n**Markup Cell Template** includes:\n- `editorPart`: Editor for editing markdown source\n- `cellContainer`: Container for rendered markdown preview\n- `focusIndicators`: Visual focus indicators\n- `cellParts`: UI parts collection\n\nSources: [src/vs/workbench/contrib/notebook/browser/view/renderers/cellRenderer.ts:237-320](), [src/vs/workbench/contrib/notebook/browser/view/renderers/cellRenderer.ts:112-209]()\n\n### Cell Parts System\n\nCell rendering is modularized through a `CellPartsCollection` that manages individual aspects of cell UI:\n\n```mermaid\ngraph LR\n    CellPartsCollection[\"CellPartsCollection\"]\n    \n    subgraph \"Standard Cell Parts\"\n        CellEditorStatusBar[\"CellEditorStatusBar\"]\n        CellFocusIndicator[\"CellFocusIndicator\"]\n        CellDecorations[\"CellDecorations\"]\n        CellComments[\"CellComments\"]\n        CellProgressBar[\"CellProgressBar\"]\n        CellExecutionPart[\"CellExecutionPart\"]\n    end\n    \n    subgraph \"Toolbar Parts\"\n        CellTitleToolbarPart[\"CellTitleToolbarPart\"]\n        BetweenCellToolbar[\"BetweenCellToolbar\"]\n        RunToolbar[\"RunToolbar (Code Cells)\"]\n    end\n    \n    subgraph \"Specialized Parts\"\n        CollapsedCellInput[\"CollapsedCellInput\"]\n        CollapsedCellOutput[\"CollapsedCellOutput\"]\n        FoldedCellHint[\"FoldedCellHint\"]\n    end\n    \n    CellPartsCollection --\u003e CellEditorStatusBar\n    CellPartsCollection --\u003e CellFocusIndicator\n    CellPartsCollection --\u003e CellDecorations\n    CellPartsCollection --\u003e CellComments\n    CellPartsCollection --\u003e CellProgressBar\n    CellPartsCollection --\u003e CellExecutionPart\n    CellPartsCollection --\u003e CellTitleToolbarPart\n    CellPartsCollection --\u003e BetweenCellToolbar\n    CellPartsCollection --\u003e RunToolbar\n    CellPartsCollection --\u003e CollapsedCellInput\n    CellPartsCollection --\u003e CollapsedCellOutput\n    CellPartsCollection --\u003e FoldedCellHint\n```\n\nSources: [src/vs/workbench/contrib/notebook/browser/view/renderers/cellRenderer.ts:175-189](), [src/vs/workbench/contrib/notebook/browser/view/renderers/cellRenderer.ts:280-320]()\n\n---\n\n## Data Model\n\nThe notebook data model consists of a hierarchy starting with `NotebookTextModel` as the root document model.\n\n### NotebookTextModel\n\n`NotebookTextModel` (defined at [notebookTextModel.ts:95-310]()) represents an entire notebook document and implements the `INotebookTextModel` interface. It manages:\n- A collection of `NotebookCellTextModel` instances via the `cells` property\n- Document-level metadata (`metadata: NotebookDocumentMetadata`)\n- Transient options controlling what data is persisted (`transientOptions: TransientOptions`)\n- Version tracking (`versionId: number`)\n- Undo/redo integration via `IUndoRedoService`\n\n**Diagram: NotebookTextModel Structure and Operations**\n```mermaid\ngraph TB\n    NotebookTextModel[\"NotebookTextModel\u003cbr/\u003eclass implements INotebookTextModel\u003cbr/\u003e(notebookTextModel.ts:95)\"]\n    \n    subgraph \"Cell Collection\"\n        CellArray[\"cells: readonly ICell[]\u003cbr/\u003e(line 302)\"]\n        CellTextModel[\"NotebookCellTextModel[]\u003cbr/\u003eprivate _cells\"]\n    end\n    \n    subgraph \"Model State\"\n        VersionId[\"versionId: number\u003cbr/\u003e(line 301)\"]\n        Metadata[\"metadata: NotebookDocumentMetadata\u003cbr/\u003e(line 298)\"]\n        TransientOptions[\"transientOptions: TransientOptions\u003cbr/\u003e(line 299)\"]\n        Uri[\"uri: URI\u003cbr/\u003e(line 296)\"]\n        ViewType[\"viewType: string\u003cbr/\u003e(line 297)\"]\n    end\n    \n    subgraph \"Operations\"\n        ApplyEdits[\"applyEdits(\u003cbr/\u003e  rawEdits: ICellEditOperation[],\u003cbr/\u003e  synchronous: boolean,\u003cbr/\u003e  ...): boolean\"]\n        CreateSnapshot[\"createSnapshot(\u003cbr/\u003e  options: INotebookSnapshotOptions\u003cbr/\u003e): NotebookData\"]\n        Reset[\"reset(\u003cbr/\u003e  cells: ICellDto2[],\u003cbr/\u003e  metadata: NotebookDocumentMetadata\u003cbr/\u003e): void\"]\n    end\n    \n    subgraph \"Events\"\n        OnDidChangeContent[\"onDidChangeContent:\u003cbr/\u003eEvent\u0026lt;NotebookTextModelChangedEvent\u0026gt;\"]\n        OnWillDispose[\"onWillDispose: Event\u0026lt;void\u0026gt;\"]\n    end\n    \n    NotebookTextModel --\u003e CellArray\n    CellArray --\u003e CellTextModel\n    NotebookTextModel --\u003e VersionId\n    NotebookTextModel --\u003e Metadata\n    NotebookTextModel --\u003e TransientOptions\n    NotebookTextModel --\u003e Uri\n    NotebookTextModel --\u003e ViewType\n    NotebookTextModel --\u003e ApplyEdits\n    NotebookTextModel --\u003e CreateSnapshot\n    NotebookTextModel --\u003e Reset\n    NotebookTextModel --\u003e OnDidChangeContent\n    NotebookTextModel --\u003e OnWillDispose\n```\n\nKey responsibilities:\n- **Cell Management**: Maintains an ordered array of cells, each identified by a unique `handle`\n- **Edit Operations**: Processes edit operations via `applyEdits()` which supports batch operations\n- **Serialization**: `createSnapshot()` serializes the notebook to `NotebookData` for saving\n- **Change Events**: Fires `onDidChangeContent` with detailed change events including `NotebookCellsChangeType`\n\nSources: [src/vs/workbench/contrib/notebook/common/model/notebookTextModel.ts:95-310](), [src/vs/workbench/contrib/notebook/common/notebookCommon.ts:295-310]()\n\n### Cell Edit Operations\n\nThe notebook model supports several edit operation types defined by the `CellEditType` enum ([notebookCommon.ts:462-472]()):\n\n| Edit Type | Enum Value | Purpose | Interface | Key Fields |\n|-----------|------------|---------|-----------|------------|\n| `Replace` | 1 | Insert/delete cells | `ICellReplaceEdit` | `index`, `count`, `cells: ICellDto2[]` |\n| `Output` | 2 | Update cell outputs | `ICellOutputEdit` | `index`, `outputs: IOutputDto[]`, `append?` |\n| `Metadata` | 3 | Update cell metadata | `ICellMetadataEdit` | `index`, `metadata: NotebookCellMetadata` |\n| `CellLanguage` | 4 | Change cell language | `ICellLanguageEdit` | `index`, `language: string` |\n| `DocumentMetadata` | 5 | Update document metadata | `IDocumentMetadataEdit` | `metadata: NotebookDocumentMetadata` |\n| `Move` | 6 | Move cell range | `ICellMoveEdit` | `index`, `length`, `newIdx` |\n| `OutputItems` | 7 | Update specific output items | `ICellOutputItemEdit` | `outputId`, `items: IOutputItemDto[]`, `append?` |\n| `PartialMetadata` | 8 | Partial metadata update | `ICellPartialMetadataEdit` | `index`, `metadata` (partial) |\n| `PartialInternalMetadata` | 9 | Update internal metadata | `ICellPartialInternalMetadataEdit` | `index`, `internalMetadata` (partial) |\n\nAll edit operations are processed through `NotebookTextModel.applyEdits()` which:\n1. Validates the operations\n2. Applies them to the cell collection\n3. Updates the `versionId`\n4. Fires `onDidChangeContent` events\n5. Integrates with undo/redo stack\n\nSources: [src/vs/workbench/contrib/notebook/common/notebookCommon.ts:462-570](), [src/vs/workbench/contrib/notebook/common/model/notebookTextModel.ts:400-600]()\n\n### NotebookCellTextModel\n\nEach cell is represented by a `NotebookCellTextModel`:\n\n```mermaid\ngraph TB\n    NotebookCellTextModel[\"NotebookCellTextModel\u003cbr/\u003e(ICell)\"]\n    \n    subgraph \"Cell Identity\"\n        Handle[\"handle: number\"]\n        Uri[\"uri: URI\"]\n        CellKind[\"cellKind: CellKind\"]\n    end\n    \n    subgraph \"Cell Content\"\n        TextBuffer[\"textBuffer: IReadonlyTextBuffer\"]\n        TextModel[\"textModel?: ITextModel\"]\n        Language[\"language: string\"]\n    end\n    \n    subgraph \"Cell Metadata\"\n        Metadata[\"metadata: NotebookCellMetadata\"]\n        InternalMetadata[\"internalMetadata:\u003cbr/\u003eNotebookCellInternalMetadata\"]\n    end\n    \n    subgraph \"Cell Outputs\"\n        Outputs[\"outputs: ICellOutput[]\"]\n        OnDidChangeOutputs[\"onDidChangeOutputs\"]\n    end\n    \n    NotebookCellTextModel --\u003e Handle\n    NotebookCellTextModel --\u003e Uri\n    NotebookCellTextModel --\u003e CellKind\n    NotebookCellTextModel --\u003e TextBuffer\n    NotebookCellTextModel --\u003e TextModel\n    NotebookCellTextModel --\u003e Language\n    NotebookCellTextModel --\u003e Metadata\n    NotebookCellTextModel --\u003e InternalMetadata\n    NotebookCellTextModel --\u003e Outputs\n    NotebookCellTextModel --\u003e OnDidChangeOutputs\n```\n\nKey features:\n- **Handle-based identity**: Each cell has a unique numeric `handle` used for tracking across model updates\n- **Cell URI**: Uses `vscode-notebook-cell:` scheme with handle embedded\n- **Text content**: Backed by either a text buffer or full Monaco `ITextModel`\n- **Outputs**: Array of `ICellOutput` objects (for code cells)\n- **Metadata**: Both user-facing metadata and internal execution metadata\n\nSources: [src/vs/workbench/contrib/notebook/common/model/notebookCellTextModel.ts:26-100](), [src/vs/workbench/contrib/notebook/common/notebookCommon.ts:269-287]()\n\n### Cell Outputs\n\nCell outputs are modeled as `NotebookCellOutputTextModel`:\n\n```mermaid\ngraph LR\n    ICellOutput[\"ICellOutput\"]\n    \n    subgraph \"Output Properties\"\n        OutputId[\"outputId: string\"]\n        AltOutputId[\"alternativeOutputId: string\"]\n        VersionId[\"versionId: number\"]\n        Outputs[\"outputs: IOutputItemDto[]\"]\n        Metadata[\"metadata?: Record\u003cstring, any\u003e\"]\n    end\n    \n    subgraph \"Output Items\"\n        OutputItem[\"IOutputItemDto\"]\n        Mime[\"mime: string\"]\n        Data[\"data: VSBuffer\"]\n    end\n    \n    subgraph \"Operations\"\n        ReplaceData[\"replaceData(items)\"]\n        AppendData[\"appendData(items)\"]\n        AppendedSinceVersion[\"appendedSinceVersion(versionId, mime)\"]\n    end\n    \n    ICellOutput --\u003e OutputId\n    ICellOutput --\u003e AltOutputId\n    ICellOutput --\u003e VersionId\n    ICellOutput --\u003e Outputs\n    ICellOutput --\u003e Metadata\n    Outputs --\u003e OutputItem\n    OutputItem --\u003e Mime\n    OutputItem --\u003e Data\n    ICellOutput --\u003e ReplaceData\n    ICellOutput --\u003e AppendData\n    ICellOutput --\u003e AppendedSinceVersion\n```\n\nEach output can contain multiple output items with different MIME types (e.g., `text/plain`, `text/html`, `image/png`). The notebook editor selects the appropriate MIME type for rendering based on renderer availability.\n\nSources: [src/vs/workbench/contrib/notebook/common/notebookCommon.ts:218-245](), [src/vs/workbench/contrib/notebook/common/model/notebookCellOutputTextModel.ts:1-150]()\n\n---\n\n## View Model Layer\n\nThe view model layer translates the data model into UI-friendly representations and manages UI state that doesn't belong in the persisted model.\n\n### NotebookViewModel\n\n`NotebookViewModel` (defined at [notebookViewModelImpl.ts]()) wraps a `NotebookTextModel` and provides view-specific state and operations. It implements the `INotebookViewModel` interface and serves as the bridge between the data model and the UI.\n\n**Diagram: NotebookViewModel Structure**\n```mermaid\ngraph TB\n    NotebookViewModel[\"NotebookViewModel\u003cbr/\u003eclass implements INotebookViewModel\u003cbr/\u003e(notebookViewModelImpl.ts)\"]\n    \n    subgraph \"Core References\"\n        NotebookDocument[\"notebookDocument: NotebookTextModel\u003cbr/\u003e(readonly)\"]\n        ViewCells[\"viewCells: ICellViewModel[]\u003cbr/\u003e(readonly, computed)\"]\n        ViewContext[\"viewContext: ViewContext\u003cbr/\u003e(private)\"]\n        ViewType[\"viewType: string\u003cbr/\u003e(from notebook)\"]\n    end\n    \n    subgraph \"Selection State\"\n        SelectionState[\"_selectionState:\u003cbr/\u003eISelectionState\"]\n        GetSelections[\"getSelections():\u003cbr/\u003eICellRange[]\"]\n        UpdateSelections[\"updateSelectionsState(\u003cbr/\u003e  state: ISelectionState\u003cbr/\u003e): void\"]\n    end\n    \n    subgraph \"Folding State\"\n        HiddenRanges[\"_hiddenRanges:\u003cbr/\u003eICellRange[]\"]\n        OnDidFoldingStateChanged[\"onDidFoldingStateChanged:\u003cbr/\u003eEvent\u0026lt;void\u0026gt;\"]\n        GetHiddenRanges[\"getHiddenRanges():\u003cbr/\u003eICellRange[]\"]\n    end\n    \n    subgraph \"Layout\"\n        LayoutInfo[\"layoutInfo:\u003cbr/\u003eNotebookLayoutInfo | null\"]\n        OnDidChangeViewCells[\"onDidChangeViewCells:\u003cbr/\u003eEvent\u0026lt;INotebookViewCellsUpdateEvent\u0026gt;\"]\n    end\n    \n    subgraph \"Tracked Ranges\"\n        TrackedRanges[\"_trackedRanges:\u003cbr/\u003eMap\u0026lt;string, ICellRange\u0026gt;\"]\n        SetTrackedRange[\"setTrackedRange(\u003cbr/\u003e  id: string,\u003cbr/\u003e  range: ICellRange,\u003cbr/\u003e  stickiness: TrackedRangeStickiness\u003cbr/\u003e): string\"]\n        GetTrackedRange[\"getTrackedRange(\u003cbr/\u003e  id: string\u003cbr/\u003e): ICellRange | null\"]\n    end\n    \n    NotebookViewModel --\u003e NotebookDocument\n    NotebookViewModel --\u003e ViewCells\n    NotebookViewModel --\u003e ViewContext\n    NotebookViewModel --\u003e ViewType\n    NotebookViewModel --\u003e SelectionState\n    NotebookViewModel --\u003e GetSelections\n    NotebookViewModel --\u003e UpdateSelections\n    NotebookViewModel --\u003e HiddenRanges\n    NotebookViewModel --\u003e OnDidFoldingStateChanged\n    NotebookViewModel --\u003e GetHiddenRanges\n    NotebookViewModel --\u003e LayoutInfo\n    NotebookViewModel --\u003e OnDidChangeViewCells\n    NotebookViewModel --\u003e TrackedRanges\n    NotebookViewModel --\u003e SetTrackedRange\n    NotebookViewModel --\u003e GetTrackedRange\n```\n\n**Key Responsibilities:**\n- **View Cell Management**: Creates and manages `CodeCellViewModel` and `MarkupCellViewModel` instances for each cell\n- **Selection Tracking**: Maintains selection state as `ICellRange[]` and fires change events\n- **Folding**: Manages hidden cell ranges for folded sections\n- **Decorations**: Supports tracked ranges with stickiness for decorations that follow cell movements\n- **Layout**: Provides layout information to coordinate cell rendering\n\nThe view model listens to `NotebookTextModel.onDidChangeContent` and updates the view cells accordingly.\n\nSources: [src/vs/workbench/contrib/notebook/browser/viewModel/notebookViewModelImpl.ts:1-200](), [src/vs/workbench/contrib/notebook/browser/notebookBrowser.ts:491-511]()\n\n### CellViewModel\n\nCell view models (`CodeCellViewModel` and `MarkupCellViewModel`) extend `BaseCellViewModel`:\n\n```mermaid\ngraph TB\n    BaseCellViewModel[\"BaseCellViewModel\u003cbr/\u003e(Abstract)\"]\n    CodeCellViewModel[\"CodeCellViewModel\"]\n    MarkupCellViewModel[\"MarkupCellViewModel\"]\n    \n    subgraph \"Base State\"\n        Model[\"model: NotebookCellTextModel\"]\n        Handle[\"handle: number\"]\n        Uri[\"uri: URI\"]\n        EditState[\"editState: CellEditState\"]\n        FocusMode[\"focusMode: CellFocusMode\"]\n    end\n    \n    subgraph \"Layout State\"\n        LayoutInfo[\"layoutInfo: CellLayoutInfo\"]\n        OnDidChangeLayout[\"onDidChangeLayout\"]\n    end\n    \n    subgraph \"Editor State\"\n        EditorAttached[\"editorAttached: boolean\"]\n        TextModel[\"textModel?: ITextModel\"]\n        ResolveTextModel[\"resolveTextModel()\"]\n    end\n    \n    subgraph \"Code Cell Specific\"\n        OutputsViewModels[\"outputsViewModels:\u003cbr/\u003eICellOutputViewModel[]\"]\n        OnDidChangeOutputs[\"onDidChangeOutputs\"]\n        OutputsTop[\"_outputsTop: PrefixSumComputer\"]\n    end\n    \n    subgraph \"Markup Cell Specific\"\n        FoldingState[\"foldingState: CellFoldingState\"]\n        PreviewHeight[\"previewHeight: number\"]\n        RenderedHtml[\"renderedHtml?: string\"]\n    end\n    \n    BaseCellViewModel --\u003e Model\n    BaseCellViewModel --\u003e Handle\n    BaseCellViewModel --\u003e Uri\n    BaseCellViewModel --\u003e EditState\n    BaseCellViewModel --\u003e FocusMode\n    BaseCellViewModel --\u003e LayoutInfo\n    BaseCellViewModel --\u003e OnDidChangeLayout\n    BaseCellViewModel --\u003e EditorAttached\n    BaseCellViewModel --\u003e TextModel\n    BaseCellViewModel --\u003e ResolveTextModel\n    \n    CodeCellViewModel --\u003e BaseCellViewModel\n    CodeCellViewModel --\u003e OutputsViewModels\n    CodeCellViewModel --\u003e OnDidChangeOutputs\n    CodeCellViewModel --\u003e OutputsTop\n    \n    MarkupCellViewModel --\u003e BaseCellViewModel\n    MarkupCellViewModel --\u003e FoldingState\n    MarkupCellViewModel --\u003e PreviewHeight\n    MarkupCellViewModel --\u003e RenderedHtml\n```\n\n**Key responsibilities:**\n- Track cell UI state (edit state, focus mode, collapsed state)\n- Manage Monaco editor attachment/detachment\n- Calculate layout dimensions\n- For code cells: manage output view models\n- For markup cells: manage preview/edit mode switching\n\nSources: [src/vs/workbench/contrib/notebook/browser/viewModel/baseCellViewModel.ts:30-100](), [src/vs/workbench/contrib/notebook/browser/viewModel/codeCellViewModel.ts:30-100](), [src/vs/workbench/contrib/notebook/browser/viewModel/markupCellViewModel.ts:22-100]()\n\n### Cell Edit States\n\nCells can be in different edit states:\n\n| State | Description |\n|-------|-------------|\n| `Preview` | Default state, showing rendered output/markdown |\n| `Editing` | Actively editing cell content |\n| `PreviewAndEdit` | Both preview and editor visible (markup cells) |\n\nSources: [src/vs/workbench/contrib/notebook/browser/notebookBrowser.ts:1-50]()\n\n---\n\n## Output Rendering via Webview\n\nNotebook cell outputs are rendered in an isolated webview (`BackLayerWebView`) to support rich, interactive content.\n\n### BackLayerWebView Architecture\n\n```mermaid\ngraph TB\n    BackLayerWebView[\"BackLayerWebView\u003cT\u003e\"]\n    \n    subgraph \"Webview Integration\"\n        IWebviewElement[\"webview: IWebviewElement\"]\n        GenerateContent[\"generateContent(baseUrl)\"]\n        WebviewPreloads[\"webviewPreloads.ts\u003cbr/\u003e(injected script)\"]\n    end\n    \n    subgraph \"Output Management\"\n        InsetMapping[\"insetMapping:\u003cbr/\u003eMap\u003cIDisplayOutputViewModel, ICachedInset\u003e\"]\n        ReversedInsetMapping[\"reversedInsetMapping:\u003cbr/\u003eMap\u003coutputId, IDisplayOutputViewModel\u003e\"]\n        MarkupPreviewMapping[\"markupPreviewMapping:\u003cbr/\u003eMap\u003ccellId, IMarkupCellInitialization\u003e\"]\n    end\n    \n    subgraph \"Message Protocol\"\n        OnMessage[\"onMessage:\u003cbr/\u003eEvent\u003cINotebookWebviewMessage\u003e\"]\n        SendMessageToWebview[\"_sendMessageToWebview(msg)\"]\n        MessageTypes[\"ToWebviewMessage types:\u003cbr/\u003e- clear\u003cbr/\u003e- showOutput\u003cbr/\u003e- hideOutput\u003cbr/\u003e- updateScrollTop\u003cbr/\u003e- initializeMarkup\"]\n    end\n    \n    subgraph \"Renderer Integration\"\n        RendererMessaging[\"rendererMessaging:\u003cbr/\u003eIScopedRendererMessaging\"]\n        GetRendererData[\"getRendererData():\u003cbr/\u003eRendererMetadata[]\"]\n    end\n    \n    BackLayerWebView --\u003e IWebviewElement\n    BackLayerWebView --\u003e GenerateContent\n    GenerateContent --\u003e WebviewPreloads\n    BackLayerWebView --\u003e InsetMapping\n    BackLayerWebView --\u003e ReversedInsetMapping\n    BackLayerWebView --\u003e MarkupPreviewMapping\n    BackLayerWebView --\u003e OnMessage\n    BackLayerWebView --\u003e SendMessageToWebview\n    BackLayerWebView --\u003e MessageTypes\n    BackLayerWebView --\u003e RendererMessaging\n    BackLayerWebView --\u003e GetRendererData\n```\n\nSources: [src/vs/workbench/contrib/notebook/browser/view/renderers/backLayerWebView.ts:129-260]()\n\n### Webview Message Protocol\n\nCommunication between the main editor and the webview follows a bidirectional message protocol:\n\n**To Webview (Main  Webview):**\n- `clear`: Clear all outputs\n- `showOutput`: Display an output\n- `hideOutput`: Hide an output\n- `updateScrollTop`: Sync scroll position\n- `initializeMarkup`: Initialize markdown preview\n- `notebookStyles`: Update CSS styles\n- `customRendererMessage`: Forward message to custom renderer\n\n**From Webview (Webview  Main):**\n- `initialized`: Webview ready\n- `dimension`: Report output/preview height changes\n- `outputFocus`/`outputBlur`: Focus state changes\n- `mouseenter`/`mouseleave`: Hover state changes\n- `clicked-link`: User clicked a link\n- `scroll-to-reveal`: Request scroll to position\n\nSources: [src/vs/workbench/contrib/notebook/browser/view/renderers/webviewMessages.ts:1-350]()\n\n### Output Rendering Flow\n\n```mermaid\nsequenceDiagram\n    participant CM as CellViewModel\n    participant NEW as NotebookEditorWidget\n    participant BW as BackLayerWebView\n    participant WV as IWebviewElement\n    participant Renderer as Output Renderer\n    \n    CM-\u003e\u003eNEW: Output added/changed\n    NEW-\u003e\u003eBW: showOutput(output, cellInfo)\n    BW-\u003e\u003eBW: resolveOutputId(output)\n    BW-\u003e\u003eBW: Create ICreationRequestMessage\n    BW-\u003e\u003eWV: postMessage(creationRequest)\n    WV-\u003e\u003eRenderer: Render output in webview\n    Renderer-\u003e\u003eWV: Measure output height\n    WV-\u003e\u003eBW: postMessage({type: 'dimension'})\n    BW-\u003e\u003eNEW: updateOutputHeight(cellInfo, output, height)\n    NEW-\u003e\u003eCM: updateOutputHeight(index, height)\n```\n\nThe webview uses `resolveOutputId()` ([backLayerWebView.ts:536-544]()) to look up outputs by ID and maintain bidirectional mappings between output view models and their rendered representations.\n\nSources: [src/vs/workbench/contrib/notebook/browser/view/renderers/backLayerWebView.ts:950-1100](), [src/vs/workbench/contrib/notebook/browser/view/renderers/backLayerWebView.ts:536-544]()\n\n### Webview Preloads\n\nThe `webviewPreloads.ts` script is injected into the webview and provides:\n- Output container management\n- Renderer lifecycle management\n- Event handling (clicks, focus, scroll)\n- Communication with the main process\n- Support for custom notebook renderers\n\nKey functions:\n- `webviewPreloads(ctx)`: Main initialization function\n- `insertOutput(id, cellId, output)`: Insert output into DOM\n- `clearOutput(cellId, outputId)`: Remove output\n- `renderOutputs()`: Render pending outputs using appropriate renderers\n\nSources: [src/vs/workbench/contrib/notebook/browser/view/renderers/webviewPreloads.ts:92-500]()\n\n---\n\n## Extension API Integration\n\nThe notebook system exposes an extension API allowing third parties to provide notebook serializers, cell status bar items, and integrate with notebook execution.\n\n### Extension Host Architecture\n\nThe notebook extension API follows the standard VS Code extension host pattern with proxy objects communicating via RPC.\n\n**Diagram: Extension API RPC Architecture**\n```mermaid\ngraph LR\n    subgraph \"Extension Host Process\"\n        ExtHostNotebook[\"ExtHostNotebook\u003cbr/\u003eimplements ExtHostNotebookShape\u003cbr/\u003e(extHostNotebook.ts:43)\"]\n        ExtHostNotebookDocument[\"ExtHostNotebookDocument\u003cbr/\u003e(extHostNotebookDocument.ts)\"]\n        ExtHostNotebookEditor[\"ExtHostNotebookEditor\u003cbr/\u003e(extHostNotebookEditor.ts)\"]\n        ExtHostCell[\"ExtHostCell\u003cbr/\u003e(extHostNotebookDocument.ts)\"]\n    end\n    \n    subgraph \"Main Thread (Workbench)\"\n        MainThreadNotebook[\"MainThreadNotebook\u003cbr/\u003eimplements MainThreadNotebookShape\u003cbr/\u003e(mainThreadNotebook.ts:30)\"]\n        MainThreadNotebookDocuments[\"MainThreadNotebookDocuments\u003cbr/\u003e(mainThreadNotebookDocuments.ts)\"]\n        MainThreadNotebookEditors[\"MainThreadNotebookEditors\u003cbr/\u003e(mainThreadNotebookEditors.ts)\"]\n    end\n    \n    subgraph \"Core Services\"\n        NotebookService[\"INotebookService\u003cbr/\u003e(notebookService.ts)\"]\n        NotebookTextModel[\"NotebookTextModel\u003cbr/\u003e(notebookTextModel.ts)\"]\n        NotebookEditorWidget[\"NotebookEditorWidget\u003cbr/\u003e(notebookEditorWidget.ts)\"]\n    end\n    \n    ExtHostNotebook \u003c--\u003e|\"RPC via\u003cbr/\u003eExtHostContext/\u003cbr/\u003eMainContext\"| MainThreadNotebook\n    ExtHostNotebookDocument \u003c--\u003e|\"$acceptModelChanged\u003cbr/\u003e$acceptDirtyStateChanged\"| MainThreadNotebookDocuments\n    ExtHostNotebookEditor \u003c--\u003e|\"$acceptEditorPropertiesChanged\u003cbr/\u003e$acceptEditorViewState\"| MainThreadNotebookEditors\n    \n    MainThreadNotebook --\u003e|\"registerNotebookSerializer\u003cbr/\u003egetRenderers\"| NotebookService\n    MainThreadNotebookDocuments --\u003e|\"applyEdits\"| NotebookTextModel\n    MainThreadNotebookEditors --\u003e|\"setSelections\u003cbr/\u003erevealRange\"| NotebookEditorWidget\n    \n    ExtHostNotebook --\u003e|\"manages\"| ExtHostNotebookDocument\n    ExtHostNotebook --\u003e|\"manages\"| ExtHostNotebookEditor\n    ExtHostNotebookDocument --\u003e|\"contains\"| ExtHostCell\n```\n\n**Key RPC Methods:**\n\nExtension Host  Main Thread:\n- `$registerNotebookSerializer(handle, viewType, options)`: Register notebook file handler\n- `$registerNotebookCellStatusBarItemProvider(handle, selector)`: Register status bar provider\n- `$dataToNotebook(handle, data)`: Deserialize notebook data\n- `$notebookToData(handle, notebook)`: Serialize notebook data\n\nMain Thread  Extension Host:\n- `$acceptDocumentAndEditorsDelta(delta)`: Sync document/editor changes\n- `$provideNotebookCellStatusBarItems(handle, uri, index)`: Request status bar items\n\nSources: [src/vs/workbench/api/common/extHostNotebook.ts:43-150](), [src/vs/workbench/api/browser/mainThreadNotebook.ts:29-100](), [src/vs/workbench/api/common/extHost.protocol.ts:1-100]()\n\n### Notebook Serializer Registration\n\nExtensions register notebook serializers via `vscode.workspace.registerNotebookSerializer()` to handle reading/writing notebook files. The serializer converts between file content (bytes) and the structured `NotebookData` format.\n\n**Diagram: Notebook Serializer Registration and Usage**\n```mermaid\nsequenceDiagram\n    participant Ext as Extension Code\n    participant EHN as ExtHostNotebook\u003cbr/\u003e(extHostNotebook.ts)\n    participant MTN as MainThreadNotebook\u003cbr/\u003e(mainThreadNotebook.ts)\n    participant NS as INotebookService\u003cbr/\u003e(notebookService.ts)\n    \n    Ext-\u003e\u003eEHN: vscode.workspace.registerNotebookSerializer(\u003cbr/\u003e  viewType, serializer, options)\n    EHN-\u003e\u003eEHN: Assign numeric handle\n    EHN-\u003e\u003eMTN: $registerNotebookSerializer(\u003cbr/\u003e  handle, extension, viewType,\u003cbr/\u003e  options, contributionData)\n    MTN-\u003e\u003eNS: registerNotebookSerializer(\u003cbr/\u003e  viewType, extension, {\u003cbr/\u003e    options,\u003cbr/\u003e    dataToNotebook,\u003cbr/\u003e    notebookToData\u003cbr/\u003e  })\n    \n    Note over NS: When notebook file needs loading...\n    NS-\u003e\u003eMTN: dataToNotebook(data: VSBuffer)\n    MTN-\u003e\u003eEHN: $dataToNotebook(handle, data, token)\n    EHN-\u003e\u003eExt: serializer.deserializeNotebook(content, token)\n    Ext-\u003e\u003eEHN: Return NotebookData\n    EHN-\u003e\u003eMTN: Return NotebookDataDto (serialized)\n    MTN-\u003e\u003eNS: Return NotebookData\n```\n\n**Key Interfaces:**\n\nExtension API (`vscode.d.ts`):\n```typescript\ninterface NotebookSerializer {\n    deserializeNotebook(content: Uint8Array, token: CancellationToken): \n        Promise\u003cNotebookData\u003e;\n    serializeNotebook(data: NotebookData, token: CancellationToken): \n        Promise\u003cUint8Array\u003e;\n}\n```\n\nThe serializer registration includes:\n- `viewType`: Unique identifier for the notebook type (e.g., `'jupyter-notebook'`)\n- `options`: Transient options specifying what metadata/outputs to persist\n- `contributionData`: Display name, file patterns, priority for editor association\n\nSources: [src/vs/workbench/api/common/extHostNotebook.ts:400-500](), [src/vs/workbench/api/browser/mainThreadNotebook.ts:52-82](), [src/vs/workbench/contrib/notebook/common/notebookCommon.ts:593-599]()\n\n### Notebook Document Events\n\nThe extension API exposes document lifecycle events:\n\n| Event | Description | Fires When |\n|-------|-------------|------------|\n| `onDidOpenNotebookDocument` | Notebook opened | Document loaded into memory |\n| `onDidCloseNotebookDocument` | Notebook closed | Document unloaded |\n| `onDidChangeNotebookDocument` | Content changed | Cells added/removed/modified |\n| `onDidSaveNotebookDocument` | Notebook saved | Document saved to disk |\n\nSources: [src/vs/workbench/api/common/extHostNotebook.ts:66-73]()\n\n### Cell Status Bar Items\n\nExtensions can contribute status bar items to cells:\n\n```mermaid\ngraph TB\n    Extension[\"Extension\"]\n    \n    subgraph \"Extension Host\"\n        Provider[\"NotebookCellStatusBarItemProvider\"]\n        ExtHostNotebook[\"ExtHostNotebook\"]\n    end\n    \n    subgraph \"Main Thread\"\n        MainThreadNotebook[\"MainThreadNotebook\"]\n        CellStatusBarService[\"INotebookCellStatusBarService\"]\n    end\n    \n    subgraph \"UI\"\n        CellStatusBar[\"CellEditorStatusBar\"]\n        StatusBarItem[\"Status Bar Item (rendered)\"]\n    end\n    \n    Extension --\u003e|registerNotebookCellStatusBarItemProvider| ExtHostNotebook\n    ExtHostNotebook --\u003e|$registerNotebookCellStatusBarItemProvider| MainThreadNotebook\n    MainThreadNotebook --\u003e CellStatusBarService\n    CellStatusBarService --\u003e|provides items| CellStatusBar\n    CellStatusBar --\u003e StatusBarItem\n    \n    Provider --\u003e|provideCellStatusBarItems| ExtHostNotebook\n```\n\nSources: [src/vs/workbench/api/common/extHostNotebook.ts:530-600](), [src/vs/workbench/api/browser/mainThreadNotebook.ts:120-150]()\n\n---\n\n## Cell Lifecycle and State Management\n\n### Cell State Machine\n\nEach cell progresses through various states during its lifetime:\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e Uninitialized\n    Uninitialized --\u003e Estimated: First Layout\n    Estimated --\u003e Measured: Rendered \u0026 Measured\n    Measured --\u003e Measured: Content Changes\n    \n    Uninitialized --\u003e FromCache: Restored from Cache\n    FromCache --\u003e Measured: Validated\n    \n    state \"Edit States\" as EditStates {\n        Preview --\u003e Editing: Edit Cell\n        Editing --\u003e Preview: Quit Edit\n        Preview --\u003e PreviewAndEdit: Split View\n        PreviewAndEdit --\u003e Editing: Focus Editor\n    }\n    \n    state \"Focus Modes\" as FocusModes {\n        Container --\u003e Editor: Enter Edit\n        Editor --\u003e Output: Focus Output\n        Output --\u003e Container: Focus Container\n    }\n    \n    Measured --\u003e EditStates\n    Measured --\u003e FocusModes\n```\n\nSources: [src/vs/workbench/contrib/notebook/browser/notebookBrowser.ts:172-230]()\n\n### Layout Calculation\n\nCell layout is managed through a multi-stage calculation process:\n\n**Layout State Progression:**\n1. `Uninitialized`: No layout calculated\n2. `Estimated`: Height estimated based on content\n3. `FromCache`: Restored from saved editor state\n4. `Measured`: Actual height measured after render\n\n**Code Cell Layout Components:**\n```typescript\ninterface CodeCellLayoutInfo {\n    editorHeight: number;           // Monaco editor height\n    editorWidth: number;            // Editor width\n    outputContainerOffset: number;  // Offset to outputs\n    outputTotalHeight: number;      // Total output height\n    outputShowMoreContainerHeight: number;\n    codeIndicatorHeight: number;    // Execution indicator\n    outputIndicatorHeight: number;  // Output indicator\n    bottomToolbarOffset: number;    // Bottom toolbar position\n    totalHeight: number;            // Total cell height\n    // ... other layout properties\n}\n```\n\nSources: [src/vs/workbench/contrib/notebook/browser/notebookBrowser.ts:202-210](), [src/vs/workbench/contrib/notebook/browser/viewModel/codeCellViewModel.ts:50-200]()\n\n### Cell Editor Attachment\n\nMonaco editor instances are managed through an editor pool to optimize performance:\n\n```mermaid\nsequenceDiagram\n    participant Pool as NotebookCellEditorPool\n    participant Cell as CellViewModel\n    participant Widget as NotebookEditorWidget\n    participant Renderer as CellRenderer\n    \n    Note over Cell: Cell becomes visible\n    Renderer-\u003e\u003eWidget: renderElement(cell)\n    Widget-\u003e\u003eCell: attachTextEditor()\n    Cell-\u003e\u003ePool: Get editor from pool\n    Pool-\u003e\u003eCell: Return ICodeEditor\n    Cell-\u003e\u003eCell: editor.setModel(textModel)\n    Cell-\u003e\u003eCell: editorAttached = true\n    \n    Note over Cell: Cell scrolls out of view\n    Widget-\u003e\u003eCell: detachTextEditor()\n    Cell-\u003e\u003ePool: Return editor to pool\n    Cell-\u003e\u003eCell: editorAttached = false\n```\n\nThe editor pool maintains a limited number of reusable Monaco editor instances, attaching them to cells as they become visible and detaching when they scroll out of view.\n\nSources: [src/vs/workbench/contrib/notebook/browser/view/notebookCellEditorPool.ts:1-200](), [src/vs/workbench/contrib/notebook/browser/viewModel/baseCellViewModel.ts:200-300]()\n\n---\n\n## Notebook Options and Configuration\n\nThe `NotebookOptions` class manages notebook-specific configuration settings:\n\n**Key Configuration Settings:**\n- `notebook.cellToolbarLocation`: Where to show cell toolbars (left, right, hidden)\n- `notebook.cellToolbarVisibility`: When to show toolbars (hover, click)\n- `notebook.showFoldingControls`: When to show folding controls\n- `notebook.insertToolbarLocation`: Where to show insert cell toolbar\n- `notebook.compactView`: Enable compact cell spacing\n- `notebook.dragAndDropEnabled`: Enable cell drag and drop\n- `notebook.output.scrolling`: Enable scrolling for large outputs\n- `notebook.output.wordWrap`: Enable word wrap in outputs\n- `notebook.outline.showCodeCells`: Show code cells in outline\n\nSources: [src/vs/workbench/contrib/notebook/browser/notebookOptions.ts:1-300]()\n\n---\n\n## Find and Search in Notebooks\n\nNotebooks support both in-document find and cross-file search:\n\n### In-Document Find\n\nThe `NotebookFindWidget` provides find functionality within a notebook:\n- Search across all cell types (code and markup)\n- Match cell content and output text\n- Support for regex and case-sensitive search\n- Navigate between matches with keyboard shortcuts\n\nSources: [src/vs/workbench/contrib/notebook/browser/contrib/find/notebookFind.ts:1-200]()\n\n### Cross-Notebook Search\n\nThe search system integrates with workspace search to find content across notebooks:\n- Indexes cell content and outputs\n- Supports text queries with notebook-specific filters\n- Returns `INotebookFileMatchNoModel` results\n- Displays matches in search view with cell context\n\nSources: [src/vs/workbench/contrib/search/common/cellSearchModel.ts:1-150](), [src/vs/workbench/contrib/search/common/searchNotebookHelpers.ts:1-200]()\n\n---\n\n## Summary\n\nThe notebook system in VS Code provides a comprehensive architecture for editing and executing notebook documents:\n\n1. **UI Layer**: `NotebookEditorWidget` orchestrates rendering through a virtualized `NotebookCellList` with specialized renderers for code and markup cells.\n\n2. **View Model**: `NotebookViewModel` and cell view models bridge the data model and UI, managing selection, layout, and UI-specific state.\n\n3. **Data Model**: `NotebookTextModel` and `NotebookCellTextModel` provide the persistent document structure with support for rich edit operations.\n\n4. **Output Rendering**: `BackLayerWebView` renders cell outputs in an isolated webview using a custom renderer system.\n\n5. **Extension API**: `ExtHostNotebook` and `MainThreadNotebook` enable extensions to provide notebook formats, renderers, and interactive features.\n\nThe architecture emphasizes performance through virtualization, editor pooling, and efficient output rendering, while maintaining extensibility through a well-defined extension API."])</script><script>self.__next_f.push([1,"41:T5d98,"])</script><script>self.__next_f.push([1,"# Notebook Architecture Overview\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [extensions/markdown-language-features/notebook/index.ts](extensions/markdown-language-features/notebook/index.ts)\n- [src/vs/workbench/api/browser/mainThreadNotebook.ts](src/vs/workbench/api/browser/mainThreadNotebook.ts)\n- [src/vs/workbench/api/common/extHostNotebook.ts](src/vs/workbench/api/common/extHostNotebook.ts)\n- [src/vs/workbench/contrib/notebook/browser/media/notebook.css](src/vs/workbench/contrib/notebook/browser/media/notebook.css)\n- [src/vs/workbench/contrib/notebook/browser/notebook.contribution.ts](src/vs/workbench/contrib/notebook/browser/notebook.contribution.ts)\n- [src/vs/workbench/contrib/notebook/browser/notebookBrowser.ts](src/vs/workbench/contrib/notebook/browser/notebookBrowser.ts)\n- [src/vs/workbench/contrib/notebook/browser/notebookEditor.ts](src/vs/workbench/contrib/notebook/browser/notebookEditor.ts)\n- [src/vs/workbench/contrib/notebook/browser/notebookEditorWidget.ts](src/vs/workbench/contrib/notebook/browser/notebookEditorWidget.ts)\n- [src/vs/workbench/contrib/notebook/browser/view/notebookCellList.ts](src/vs/workbench/contrib/notebook/browser/view/notebookCellList.ts)\n- [src/vs/workbench/contrib/notebook/browser/view/renderers/backLayerWebView.ts](src/vs/workbench/contrib/notebook/browser/view/renderers/backLayerWebView.ts)\n- [src/vs/workbench/contrib/notebook/browser/view/renderers/cellRenderer.ts](src/vs/workbench/contrib/notebook/browser/view/renderers/cellRenderer.ts)\n- [src/vs/workbench/contrib/notebook/browser/view/renderers/webviewMessages.ts](src/vs/workbench/contrib/notebook/browser/view/renderers/webviewMessages.ts)\n- [src/vs/workbench/contrib/notebook/browser/view/renderers/webviewPreloads.ts](src/vs/workbench/contrib/notebook/browser/view/renderers/webviewPreloads.ts)\n- [src/vs/workbench/contrib/notebook/browser/viewModel/baseCellViewModel.ts](src/vs/workbench/contrib/notebook/browser/viewModel/baseCellViewModel.ts)\n- [src/vs/workbench/contrib/notebook/browser/viewModel/codeCellViewModel.ts](src/vs/workbench/contrib/notebook/browser/viewModel/codeCellViewModel.ts)\n- [src/vs/workbench/contrib/notebook/browser/viewModel/markupCellViewModel.ts](src/vs/workbench/contrib/notebook/browser/viewModel/markupCellViewModel.ts)\n- [src/vs/workbench/contrib/notebook/common/model/notebookCellTextModel.ts](src/vs/workbench/contrib/notebook/common/model/notebookCellTextModel.ts)\n- [src/vs/workbench/contrib/notebook/common/model/notebookTextModel.ts](src/vs/workbench/contrib/notebook/common/model/notebookTextModel.ts)\n- [src/vs/workbench/contrib/notebook/common/notebookCommon.ts](src/vs/workbench/contrib/notebook/common/notebookCommon.ts)\n- [src/vs/workbench/contrib/notebook/common/notebookEditorModel.ts](src/vs/workbench/contrib/notebook/common/notebookEditorModel.ts)\n- [src/vs/workbench/contrib/notebook/common/notebookService.ts](src/vs/workbench/contrib/notebook/common/notebookService.ts)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis document describes the architecture of VS Code's notebook system, which provides a multi-cell interactive document editor supporting both markup (Markdown) and code cells with rich output rendering. The notebook system consists of a layered architecture spanning from the underlying data model through the UI rendering system to extension integration.\n\nFor information about the notebook extension API surface, see [Notebook Extension API](#8.5). For details on notebook kernel management and execution, see [Notebook System](#8) related pages.\n\n## Architecture Layers\n\nThe notebook system is organized into distinct architectural layers, each with specific responsibilities:\n\n```mermaid\ngraph TB\n    subgraph \"Editor Pane Layer\"\n        NotebookEditor[\"NotebookEditor\u003cbr/\u003e(EditorPane)\"]\n        NotebookEditorWidget[\"NotebookEditorWidget\u003cbr/\u003e(INotebookEditor)\"]\n    end\n    \n    subgraph \"View Model Layer\"\n        NotebookViewModel[\"NotebookViewModel\u003cbr/\u003e(INotebookViewModel)\"]\n        CodeCellVM[\"CodeCellViewModel\"]\n        MarkupCellVM[\"MarkupCellViewModel\"]\n        CellOutputVM[\"CellOutputViewModel\u003cbr/\u003e(ICellOutputViewModel)\"]\n    end\n    \n    subgraph \"Model Layer\"\n        NotebookTextModel[\"NotebookTextModel\u003cbr/\u003e(INotebookTextModel)\"]\n        NotebookCellTextModel[\"NotebookCellTextModel\u003cbr/\u003e(ICell)\"]\n        CellOutput[\"NotebookCellOutputTextModel\u003cbr/\u003e(ICellOutput)\"]\n    end\n    \n    subgraph \"Rendering Layer\"\n        NotebookCellList[\"NotebookCellList\u003cbr/\u003e(WorkbenchList)\"]\n        CodeCellRenderer[\"CodeCellRenderer\"]\n        MarkupCellRenderer[\"MarkupCellRenderer\"]\n        BackLayerWebView[\"BackLayerWebView\"]\n    end\n    \n    NotebookEditor --\u003e NotebookEditorWidget\n    NotebookEditorWidget --\u003e NotebookViewModel\n    NotebookEditorWidget --\u003e NotebookCellList\n    \n    NotebookViewModel --\u003e NotebookTextModel\n    NotebookViewModel --\u003e CodeCellVM\n    NotebookViewModel --\u003e MarkupCellVM\n    \n    CodeCellVM --\u003e NotebookCellTextModel\n    MarkupCellVM --\u003e NotebookCellTextModel\n    CodeCellVM --\u003e CellOutputVM\n    CellOutputVM --\u003e CellOutput\n    \n    NotebookCellTextModel --\u003e CellOutput\n    NotebookTextModel --\u003e NotebookCellTextModel\n    \n    NotebookCellList --\u003e CodeCellRenderer\n    NotebookCellList --\u003e MarkupCellRenderer\n    NotebookEditorWidget --\u003e BackLayerWebView\n    \n    CodeCellRenderer --\u003e CodeCellVM\n    MarkupCellRenderer --\u003e MarkupCellVM\n    BackLayerWebView --\u003e CellOutputVM\n```\n\n**Sources:** \n- [src/vs/workbench/contrib/notebook/browser/notebookEditor.ts:1-600]()\n- [src/vs/workbench/contrib/notebook/browser/notebookEditorWidget.ts:1-300]()\n- [src/vs/workbench/contrib/notebook/browser/notebookBrowser.ts:1-200]()\n\n## Component Hierarchy\n\n### NotebookEditor and NotebookEditorWidget\n\nThe `NotebookEditor` class extends `EditorPane` and serves as the top-level editor integration with the workbench. It manages the lifecycle of the `NotebookEditorWidget`, which is the core UI component.\n\n```mermaid\ngraph LR\n    subgraph \"Workbench Integration\"\n        EditorPane[\"EditorPane\"]\n        NotebookEditor[\"NotebookEditor\u003cbr/\u003e(ID: NOTEBOOK_EDITOR_ID)\"]\n        NotebookEditorInput[\"NotebookEditorInput\"]\n    end\n    \n    subgraph \"Widget Layer\"\n        NotebookEditorWidget[\"NotebookEditorWidget\u003cbr/\u003e(Disposable)\"]\n        NotebookOptions[\"NotebookOptions\"]\n        ViewContext[\"ViewContext\"]\n    end\n    \n    subgraph \"UI Components\"\n        NotebookTopToolbar[\"NotebookEditorWorkbenchToolbar\"]\n        NotebookStickyScroll[\"NotebookStickyScroll\"]\n        NotebookOverviewRuler[\"NotebookOverviewRuler\"]\n        NotebookCellList[\"NotebookCellList\"]\n    end\n    \n    EditorPane --\u003e NotebookEditor\n    NotebookEditor --\u003e NotebookEditorWidget\n    NotebookEditor --\u003e NotebookEditorInput\n    \n    NotebookEditorWidget --\u003e NotebookOptions\n    NotebookEditorWidget --\u003e ViewContext\n    NotebookEditorWidget --\u003e NotebookTopToolbar\n    NotebookEditorWidget --\u003e NotebookStickyScroll\n    NotebookEditorWidget --\u003e NotebookOverviewRuler\n    NotebookEditorWidget --\u003e NotebookCellList\n```\n\nThe `NotebookEditorWidget` is the primary implementation of the `INotebookEditor` interface. It manages:\n- The cell list view (`NotebookCellList`)\n- The webview for rendering outputs (`BackLayerWebView`)\n- Toolbars and UI chrome\n- Focus management and keyboard navigation\n- Cell selection and editing state\n\n**Sources:**\n- [src/vs/workbench/contrib/notebook/browser/notebookEditor.ts:55-200]()\n- [src/vs/workbench/contrib/notebook/browser/notebookEditorWidget.ts:142-476]()\n\n## Data Model Layer\n\n### NotebookTextModel\n\nThe `NotebookTextModel` represents the underlying document structure and manages the array of cells:\n\n```mermaid\ngraph TB\n    subgraph \"NotebookTextModel\"\n        Model[\"NotebookTextModel\u003cbr/\u003eINotebookTextModel\"]\n        Metadata[\"metadata: NotebookDocumentMetadata\"]\n        Cells[\"cells: ICell[]\"]\n        TransientOpts[\"transientOptions: TransientOptions\"]\n    end\n    \n    subgraph \"Cell Model\"\n        CellTextModel[\"NotebookCellTextModel\u003cbr/\u003e(ICell)\"]\n        CellURI[\"uri: vscode-notebook-cell://\"]\n        CellKindEnum[\"cellKind: CellKind.Code | Markup\"]\n        CellMetadata[\"metadata: NotebookCellMetadata\"]\n        CellInternalMetadata[\"internalMetadata:\u003cbr/\u003eNotebookCellInternalMetadata\"]\n        TextBuffer[\"textBuffer: IReadonlyTextBuffer\"]\n        Outputs[\"outputs: ICellOutput[]\"]\n    end\n    \n    subgraph \"Output Model\"\n        OutputModel[\"NotebookCellOutputTextModel\u003cbr/\u003e(ICellOutput)\"]\n        OutputItems[\"outputs: IOutputItemDto[]\"]\n        OutputId[\"outputId: string\"]\n    end\n    \n    Model --\u003e Cells\n    Cells --\u003e CellTextModel\n    CellTextModel --\u003e CellURI\n    CellTextModel --\u003e CellKindEnum\n    CellTextModel --\u003e CellMetadata\n    CellTextModel --\u003e CellInternalMetadata\n    CellTextModel --\u003e TextBuffer\n    CellTextModel --\u003e Outputs\n    Outputs --\u003e OutputModel\n    OutputModel --\u003e OutputItems\n    OutputModel --\u003e OutputId\n```\n\nKey responsibilities of `NotebookTextModel`:\n- Manages cell lifecycle (add, remove, move)\n- Handles undo/redo operations through `IUndoRedoService`\n- Emits change events via `onDidChangeContent`\n- Supports transient metadata that doesn't persist\n- Maintains version information\n\n**Sources:**\n- [src/vs/workbench/contrib/notebook/common/model/notebookTextModel.ts:1-200]()\n- [src/vs/workbench/contrib/notebook/common/model/notebookCellTextModel.ts:26-100]()\n- [src/vs/workbench/contrib/notebook/common/notebookCommon.ts:269-310]()\n\n### Cell Edit Operations\n\nNotebook modifications are represented as `ICellEditOperation` objects:\n\n| Edit Type | Purpose | Key Fields |\n|-----------|---------|------------|\n| `ICellReplaceEdit` | Insert/delete cells | `index`, `count`, `cells` |\n| `ICellOutputEdit` | Modify cell outputs | `index`, `outputs`, `append` |\n| `ICellMetadataEdit` | Update cell metadata | `index`, `metadata` |\n| `ICellPartialMetadataEdit` | Partial metadata update | `index`, `metadata` |\n| `ICellMoveEdit` | Move cells | `index`, `length`, `newIdx` |\n| `IDocumentMetadataEdit` | Update notebook metadata | `metadata` |\n\n**Sources:**\n- [src/vs/workbench/contrib/notebook/common/notebookCommon.ts:462-571]()\n\n## View Model Layer\n\nThe view model layer bridges the data model and UI rendering, adding display state and computed properties:\n\n```mermaid\ngraph TB\n    subgraph \"NotebookViewModel\"\n        NVM[\"NotebookViewModel\"]\n        ViewCells[\"viewCells: ICellViewModel[]\"]\n        SelectionState[\"selections: ICellRange[]\"]\n        FoldingState[\"folding ranges\"]\n    end\n    \n    subgraph \"Cell ViewModels\"\n        BaseCellVM[\"BaseCellViewModel\u003cbr/\u003e(abstract)\"]\n        CodeCellVM[\"CodeCellViewModel\"]\n        MarkupCellVM[\"MarkupCellViewModel\"]\n    end\n    \n    subgraph \"Cell View State\"\n        LayoutInfo[\"layoutInfo: CellLayoutInfo\"]\n        EditState[\"editState: CellEditState\"]\n        FocusMode[\"focusMode: CellFocusMode\"]\n        EditorAttached[\"editorAttached: boolean\"]\n        Collapsed[\"isInputCollapsed\u003cbr/\u003eisOutputCollapsed\"]\n    end\n    \n    subgraph \"Output ViewModels\"\n        OutputVM[\"CellOutputViewModel\u003cbr/\u003e(ICellOutputViewModel)\"]\n        PickedMime[\"pickedMimeType:\u003cbr/\u003eIOrderedMimeType\"]\n        Visible[\"visible: IObservable\"]\n    end\n    \n    NVM --\u003e ViewCells\n    ViewCells --\u003e BaseCellVM\n    BaseCellVM --\u003e CodeCellVM\n    BaseCellVM --\u003e MarkupCellVM\n    \n    CodeCellVM --\u003e LayoutInfo\n    CodeCellVM --\u003e EditState\n    CodeCellVM --\u003e FocusMode\n    CodeCellVM --\u003e EditorAttached\n    CodeCellVM --\u003e Collapsed\n    CodeCellVM --\u003e OutputVM\n    \n    MarkupCellVM --\u003e LayoutInfo\n    MarkupCellVM --\u003e EditState\n    \n    OutputVM --\u003e PickedMime\n    OutputVM --\u003e Visible\n```\n\n### CodeCellViewModel\n\n`CodeCellViewModel` manages display state for code cells including:\n- Layout information (heights, positions)\n- Output view models with MIME type resolution\n- Execution state tracking\n- Editor state (collapsed, focused)\n- Output height computation\n\n**Sources:**\n- [src/vs/workbench/contrib/notebook/browser/viewModel/codeCellViewModel.ts:30-100]()\n- [src/vs/workbench/contrib/notebook/browser/viewModel/baseCellViewModel.ts:30-200]()\n\n### MarkupCellViewModel\n\n`MarkupCellViewModel` handles Markdown cells with special features:\n- Edit/preview mode switching\n- Rendered HTML caching\n- Folding state for markdown headers\n- Preview height computation\n\n**Sources:**\n- [src/vs/workbench/contrib/notebook/browser/viewModel/markupCellViewModel.ts:22-100]()\n\n## Cell Rendering System\n\n### NotebookCellList\n\nThe `NotebookCellList` extends `WorkbenchList` and serves as the scrollable container for cells:\n\n```mermaid\ngraph TB\n    subgraph \"List Infrastructure\"\n        WorkbenchList[\"WorkbenchList\u0026lt;CellViewModel\u0026gt;\"]\n        NotebookCellList[\"NotebookCellList\u003cbr/\u003e(INotebookCellList)\"]\n        NotebookCellListView[\"NotebookCellListView\u003cbr/\u003e(IListView)\"]\n    end\n    \n    subgraph \"Delegate \u0026 Renderers\"\n        ListDelegate[\"NotebookCellListDelegate\u003cbr/\u003e(IListVirtualDelegate)\"]\n        CodeRenderer[\"CodeCellRenderer\u003cbr/\u003e(IListRenderer)\"]\n        MarkupRenderer[\"MarkupCellRenderer\u003cbr/\u003e(IListRenderer)\"]\n    end\n    \n    subgraph \"Templates\"\n        CodeTemplate[\"CodeCellRenderTemplate\"]\n        MarkupTemplate[\"MarkdownCellRenderTemplate\"]\n        CellParts[\"CellPartsCollection\"]\n    end\n    \n    WorkbenchList --\u003e NotebookCellList\n    NotebookCellList --\u003e NotebookCellListView\n    NotebookCellList --\u003e ListDelegate\n    NotebookCellList --\u003e CodeRenderer\n    NotebookCellList --\u003e MarkupRenderer\n    \n    CodeRenderer --\u003e CodeTemplate\n    MarkupRenderer --\u003e MarkupTemplate\n    \n    CodeTemplate --\u003e CellParts\n    MarkupTemplate --\u003e CellParts\n```\n\nThe delegate pattern determines which renderer to use based on cell kind:\n\n```typescript\ngetTemplateId(element: CellViewModel): string {\n    if (element.cellKind === CellKind.Markup) {\n        return MarkupCellRenderer.TEMPLATE_ID;\n    } else {\n        return CodeCellRenderer.TEMPLATE_ID;\n    }\n}\n```\n\n**Sources:**\n- [src/vs/workbench/contrib/notebook/browser/view/notebookCellList.ts:80-132]()\n- [src/vs/workbench/contrib/notebook/browser/view/renderers/cellRenderer.ts:57-84]()\n\n### Cell Renderers\n\nBoth `CodeCellRenderer` and `MarkupCellRenderer` follow a template-based rendering pattern:\n\n**CodeCellRenderer Template Structure:**\n- Focus indicators (top, left, right, bottom)\n- Cell title toolbar\n- Run button container\n- Editor container (Monaco editor)\n- Output container\n- Cell status bar\n- Bottom toolbar for cell insertion\n\n**MarkupCellRenderer Template Structure:**\n- Focus indicators\n- Editor container (for edit mode)\n- Preview container (for rendered markdown)\n- Cell toolbars\n\nEach template includes a `CellPartsCollection` that manages reusable cell parts like toolbars, decorations, and focus indicators.\n\n**Sources:**\n- [src/vs/workbench/contrib/notebook/browser/view/renderers/cellRenderer.ts:112-235]()\n- [src/vs/workbench/contrib/notebook/browser/view/renderers/cellRenderer.ts:237-284]()\n\n## Webview Output Rendering\n\n### BackLayerWebView Architecture\n\nThe `BackLayerWebView` manages an iframe-based webview for rendering cell outputs, enabling rich HTML rendering with isolation:\n\n```mermaid\ngraph TB\n    subgraph \"Main Process\"\n        NotebookEditorWidget[\"NotebookEditorWidget\"]\n        BackLayerWebView[\"BackLayerWebView\"]\n        OutputVMs[\"CellOutputViewModel[]\"]\n    end\n    \n    subgraph \"Webview (iframe)\"\n        WebviewElement[\"IWebviewElement\"]\n        PreloadScript[\"webviewPreloads.ts\"]\n        OutputContainers[\"Output DOM Elements\"]\n        RendererScripts[\"Renderer Extension Scripts\"]\n    end\n    \n    subgraph \"Communication\"\n        PostMessage[\"postMessage API\"]\n        MessageHandlers[\"Message Handlers\"]\n    end\n    \n    subgraph \"Renderer System\"\n        RendererRegistry[\"INotebookRendererInfo[]\"]\n        MimeTypeResolver[\"MIME type resolution\"]\n        BuiltinRenderers[\"Built-in renderers\"]\n        ExtensionRenderers[\"Extension renderers\"]\n    end\n    \n    NotebookEditorWidget --\u003e BackLayerWebView\n    BackLayerWebView --\u003e WebviewElement\n    BackLayerWebView --\u003e OutputVMs\n    \n    WebviewElement --\u003e PreloadScript\n    PreloadScript --\u003e OutputContainers\n    PreloadScript --\u003e RendererScripts\n    \n    BackLayerWebView --\u003e PostMessage\n    PostMessage --\u003e MessageHandlers\n    MessageHandlers --\u003e WebviewElement\n    \n    BackLayerWebView --\u003e RendererRegistry\n    RendererRegistry --\u003e MimeTypeResolver\n    MimeTypeResolver --\u003e BuiltinRenderers\n    MimeTypeResolver --\u003e ExtensionRenderers\n```\n\n### Message Protocol\n\nThe webview communication uses a bidirectional message protocol:\n\n**Main  Webview Messages:**\n- `ICreationRequestMessage`: Create new output\n- `IContentWidgetTopRequest`: Position content widgets\n- `IViewScrollTopRequestMessage`: Scroll commands\n- `ICodeBlockHighlightRequest`: Syntax highlighting\n- `IShowMarkupPreviewMessage`: Render markdown\n- `IClearMessage`: Clear outputs\n\n**Webview  Main Messages:**\n- `IDimensionMessage`: Report output height\n- `IMouseEnterMessage` / `IMouseLeaveMessage`: Hover state\n- `IOutputFocusMessage` / `IOutputBlurMessage`: Focus tracking\n- `IScrollToRevealMessage`: Scroll requests\n- `IClickedLinkMessage`: Handle link clicks\n\n**Sources:**\n- [src/vs/workbench/contrib/notebook/browser/view/renderers/backLayerWebView.ts:129-500]()\n- [src/vs/workbench/contrib/notebook/browser/view/renderers/webviewMessages.ts:1-200]()\n\n### Webview Preloads\n\nThe `webviewPreloads.ts` script is injected into the webview and provides:\n- Output rendering infrastructure\n- Dimension tracking and reporting\n- Event handling (clicks, focus, scroll)\n- Renderer lifecycle management\n- Custom renderer API (`vscode-notebook-renderer`)\n\n**Sources:**\n- [src/vs/workbench/contrib/notebook/browser/view/renderers/webviewPreloads.ts:92-500]()\n\n### Output Height Management\n\nA critical aspect of the webview system is synchronizing output heights between the webview and the cell list:\n\n```mermaid\nsequenceDiagram\n    participant WebView as BackLayerWebView\n    participant ResizeObserver as ResizeObserver (in webview)\n    participant CellVM as CodeCellViewModel\n    participant CellList as NotebookCellList\n    \n    WebView-\u003e\u003eResizeObserver: Create output element\n    ResizeObserver-\u003e\u003eWebView: Report initial height\n    WebView-\u003e\u003eCellVM: updateOutputHeight()\n    CellVM-\u003e\u003eCellList: Cell height changed\n    CellList-\u003e\u003eCellList: Update layout\n    \n    Note over ResizeObserver: User interaction causes resize\n    ResizeObserver-\u003e\u003eWebView: Report new height\n    WebView-\u003e\u003eCellVM: updateOutputHeight()\n    CellVM-\u003e\u003eCellList: Cell height changed\n    CellList-\u003e\u003eCellList: Update layout\n```\n\nThe system uses `ResizeObserver` in the webview to detect output size changes, reports them via the message protocol, and updates the view model which triggers list layout updates.\n\n**Sources:**\n- [src/vs/workbench/contrib/notebook/browser/view/renderers/backLayerWebView.ts:628-676]()\n- [src/vs/workbench/contrib/notebook/browser/viewModel/codeCellViewModel.ts:1-100]()\n\n## Editor Integration\n\n### Cell Editor Management\n\nEach code and markup cell can have an embedded Monaco editor. The `NotebookCellEditorPool` manages editor reuse:\n\n```mermaid\ngraph LR\n    subgraph \"Editor Pool\"\n        Pool[\"NotebookCellEditorPool\"]\n        FreeEditors[\"Free editors queue\"]\n        ActiveEditors[\"Active editors map\"]\n    end\n    \n    subgraph \"Cell Templates\"\n        CodeTemplate[\"CodeCellRenderTemplate\"]\n        MarkupTemplate[\"MarkupCellRenderTemplate\"]\n        EditorContainer[\"Editor DOM container\"]\n    end\n    \n    subgraph \"Cell ViewModels\"\n        CellVM[\"CellViewModel\"]\n        TextModel[\"ITextModel\"]\n    end\n    \n    Pool --\u003e FreeEditors\n    Pool --\u003e ActiveEditors\n    \n    CodeTemplate --\u003e EditorContainer\n    MarkupTemplate --\u003e EditorContainer\n    \n    Pool --\u003e EditorContainer\n    EditorContainer --\u003e CellVM\n    CellVM --\u003e TextModel\n```\n\nEditors are:\n- Created on-demand when cells scroll into view\n- Returned to the pool when cells scroll out\n- Configured with cell-specific options (language, readOnly)\n- Managed by `BaseCellEditorOptions` for consistent configuration\n\n**Sources:**\n- [src/vs/workbench/contrib/notebook/browser/view/notebookCellEditorPool.ts:1-200]()\n- [src/vs/workbench/contrib/notebook/browser/viewModel/baseCellViewModel.ts:1-100]()\n\n## Service Layer\n\nThe notebook system exposes several key services:\n\n| Service | Purpose | Key Methods |\n|---------|---------|-------------|\n| `INotebookService` | Notebook type registration, serialization | `registerNotebookSerializer`, `getRenderers` |\n| `INotebookEditorService` | Editor instance management | `addNotebookEditor`, `getNotebookEditor` |\n| `INotebookExecutionService` | Cell execution coordination | `executeNotebookCells`, `cancelNotebookCells` |\n| `INotebookKernelService` | Kernel selection and management | `selectKernelForNotebook`, `getMatchingKernel` |\n| `INotebookRendererMessagingService` | Renderer communication | `receiveMessage`, `prepare` |\n\n**Sources:**\n- [src/vs/workbench/contrib/notebook/common/notebookService.ts:24-100]()\n- [src/vs/workbench/contrib/notebook/browser/services/notebookEditorService.ts:1-100]()\n\n## Extension API Integration\n\nThe notebook extension API is implemented through the extension host protocol:\n\n```mermaid\ngraph TB\n    subgraph \"Extension Host\"\n        ExtHostNotebook[\"ExtHostNotebook\"]\n        ExtHostNotebookDocument[\"ExtHostNotebookDocument\"]\n        ExtHostNotebookEditor[\"ExtHostNotebookEditor\"]\n        ExtensionAPI[\"vscode.notebook API\"]\n    end\n    \n    subgraph \"Main Thread\"\n        MainThreadNotebook[\"MainThreadNotebook\"]\n        NotebookService[\"INotebookService\"]\n        NotebookEditorService[\"INotebookEditorService\"]\n    end\n    \n    subgraph \"RPC Protocol\"\n        Protocol[\"extHost.protocol.ts\"]\n        SerDes[\"Serialization/Deserialization\"]\n    end\n    \n    ExtensionAPI --\u003e ExtHostNotebook\n    ExtHostNotebook --\u003e ExtHostNotebookDocument\n    ExtHostNotebook --\u003e ExtHostNotebookEditor\n    \n    ExtHostNotebook --\u003e Protocol\n    Protocol --\u003e SerDes\n    SerDes --\u003e MainThreadNotebook\n    \n    MainThreadNotebook --\u003e NotebookService\n    MainThreadNotebook --\u003e NotebookEditorService\n```\n\nExtensions interact with notebooks through:\n- `NotebookDocument` API for accessing cells and metadata\n- `NotebookEditor` API for UI state (selections, visible ranges)\n- `NotebookSerializer` for custom file format support\n- `NotebookController` (kernel provider) for execution\n- `NotebookRenderer` for custom output rendering\n\n**Sources:**\n- [src/vs/workbench/api/common/extHostNotebook.ts:43-150]()\n- [src/vs/workbench/api/browser/mainThreadNotebook.ts:30-100]()\n\n## Data Flow Summary\n\nThe typical data flow for notebook operations:\n\n```mermaid\ngraph LR\n    subgraph \"User Action\"\n        UI[\"User Interaction\"]\n    end\n    \n    subgraph \"Editor Layer\"\n        Widget[\"NotebookEditorWidget\"]\n        Command[\"Command/Action\"]\n    end\n    \n    subgraph \"View Model\"\n        ViewModel[\"NotebookViewModel\"]\n        CellVM[\"CellViewModel\"]\n    end\n    \n    subgraph \"Model Layer\"\n        TextModel[\"NotebookTextModel\"]\n        CellModel[\"NotebookCellTextModel\"]\n    end\n    \n    subgraph \"Persistence\"\n        Serializer[\"INotebookSerializer\"]\n        FileSystem[\"File System\"]\n    end\n    \n    UI --\u003e Command\n    Command --\u003e Widget\n    Widget --\u003e ViewModel\n    ViewModel --\u003e CellVM\n    CellVM --\u003e TextModel\n    TextModel --\u003e CellModel\n    \n    TextModel --\u003e Serializer\n    Serializer --\u003e FileSystem\n    \n    FileSystem -.load.-\u003e Serializer\n    Serializer -.load.-\u003e TextModel\n```\n\n1. User interactions trigger commands or direct widget manipulation\n2. Widget updates view model state\n3. View model updates underlying text model\n4. Text model emits change events\n5. View model reacts to model changes\n6. Widget updates UI to reflect state\n7. Serializer handles persistence\n\n**Sources:**\n- [src/vs/workbench/contrib/notebook/browser/notebookEditorWidget.ts:142-600]()\n- [src/vs/workbench/contrib/notebook/common/model/notebookTextModel.ts:1-300]()"])</script><script>self.__next_f.push([1,"42:T67fb,"])</script><script>self.__next_f.push([1,"# Notebook Editor and Cell Management\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [extensions/markdown-language-features/notebook/index.ts](extensions/markdown-language-features/notebook/index.ts)\n- [src/vs/workbench/api/browser/mainThreadNotebook.ts](src/vs/workbench/api/browser/mainThreadNotebook.ts)\n- [src/vs/workbench/api/common/extHostNotebook.ts](src/vs/workbench/api/common/extHostNotebook.ts)\n- [src/vs/workbench/contrib/notebook/browser/media/notebook.css](src/vs/workbench/contrib/notebook/browser/media/notebook.css)\n- [src/vs/workbench/contrib/notebook/browser/notebook.contribution.ts](src/vs/workbench/contrib/notebook/browser/notebook.contribution.ts)\n- [src/vs/workbench/contrib/notebook/browser/notebookBrowser.ts](src/vs/workbench/contrib/notebook/browser/notebookBrowser.ts)\n- [src/vs/workbench/contrib/notebook/browser/notebookEditor.ts](src/vs/workbench/contrib/notebook/browser/notebookEditor.ts)\n- [src/vs/workbench/contrib/notebook/browser/notebookEditorWidget.ts](src/vs/workbench/contrib/notebook/browser/notebookEditorWidget.ts)\n- [src/vs/workbench/contrib/notebook/browser/view/notebookCellList.ts](src/vs/workbench/contrib/notebook/browser/view/notebookCellList.ts)\n- [src/vs/workbench/contrib/notebook/browser/view/renderers/backLayerWebView.ts](src/vs/workbench/contrib/notebook/browser/view/renderers/backLayerWebView.ts)\n- [src/vs/workbench/contrib/notebook/browser/view/renderers/cellRenderer.ts](src/vs/workbench/contrib/notebook/browser/view/renderers/cellRenderer.ts)\n- [src/vs/workbench/contrib/notebook/browser/view/renderers/webviewMessages.ts](src/vs/workbench/contrib/notebook/browser/view/renderers/webviewMessages.ts)\n- [src/vs/workbench/contrib/notebook/browser/view/renderers/webviewPreloads.ts](src/vs/workbench/contrib/notebook/browser/view/renderers/webviewPreloads.ts)\n- [src/vs/workbench/contrib/notebook/browser/viewModel/baseCellViewModel.ts](src/vs/workbench/contrib/notebook/browser/viewModel/baseCellViewModel.ts)\n- [src/vs/workbench/contrib/notebook/browser/viewModel/codeCellViewModel.ts](src/vs/workbench/contrib/notebook/browser/viewModel/codeCellViewModel.ts)\n- [src/vs/workbench/contrib/notebook/browser/viewModel/markupCellViewModel.ts](src/vs/workbench/contrib/notebook/browser/viewModel/markupCellViewModel.ts)\n- [src/vs/workbench/contrib/notebook/common/model/notebookCellTextModel.ts](src/vs/workbench/contrib/notebook/common/model/notebookCellTextModel.ts)\n- [src/vs/workbench/contrib/notebook/common/model/notebookTextModel.ts](src/vs/workbench/contrib/notebook/common/model/notebookTextModel.ts)\n- [src/vs/workbench/contrib/notebook/common/notebookCommon.ts](src/vs/workbench/contrib/notebook/common/notebookCommon.ts)\n- [src/vs/workbench/contrib/notebook/common/notebookEditorModel.ts](src/vs/workbench/contrib/notebook/common/notebookEditorModel.ts)\n- [src/vs/workbench/contrib/notebook/common/notebookService.ts](src/vs/workbench/contrib/notebook/common/notebookService.ts)\n\n\u003c/details\u003e\n\n\n\nThis document details the `NotebookEditorWidget` component and its cell management infrastructure, including cell rendering, view models, lifecycle, and user interactions. For the overall notebook architecture and services, see [Notebook Architecture Overview](#8.1). For data models, see [Notebook Data Model](#8.3). For output rendering specifics, see [Cell Outputs and WebView Rendering](#8.4).\n\n## NotebookEditorWidget Overview\n\nThe `NotebookEditorWidget` is the primary UI component for notebook editing. It manages the cell list, webview for outputs, toolbars, and coordinates between the view model and rendered UI.\n\n```mermaid\ngraph TD\n    NotebookEditorWidget[\"NotebookEditorWidget\"]\n    NotebookViewModel[\"NotebookViewModel\"]\n    NotebookCellList[\"NotebookCellList\"]\n    BackLayerWebView[\"BackLayerWebView\"]\n    NotebookTopToolbar[\"NotebookEditorWorkbenchToolbar\"]\n    NotebookStickyScroll[\"NotebookStickyScroll\"]\n    NotebookOverviewRuler[\"NotebookOverviewRuler\"]\n    \n    NotebookEditorWidget --\u003e NotebookViewModel\n    NotebookEditorWidget --\u003e NotebookCellList\n    NotebookEditorWidget --\u003e BackLayerWebView\n    NotebookEditorWidget --\u003e NotebookTopToolbar\n    NotebookEditorWidget --\u003e NotebookStickyScroll\n    NotebookEditorWidget --\u003e NotebookOverviewRuler\n    \n    NotebookCellList --\u003e CellRenderers[\"Cell Renderers\"]\n    NotebookCellList --\u003e ViewContext[\"ViewContext\"]\n    BackLayerWebView --\u003e Webview[\"IWebviewElement\"]\n```\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/notebookEditorWidget.ts:142-476]()\n\n### Key Responsibilities\n\nThe `NotebookEditorWidget` class manages:\n\n| Responsibility | Implementation |\n|---------------|----------------|\n| **View Model Attachment** | Holds reference to `NotebookViewModel` and syncs state |\n| **Cell List** | Creates and manages `NotebookCellList` (virtualized list) |\n| **Output Webview** | Creates `BackLayerWebView` for rendering cell outputs |\n| **Toolbars** | Top toolbar, cell toolbars, insert toolbars |\n| **Focus Management** | Tracks focus between cell editors, outputs, and webview |\n| **Layout** | Computes and applies layout for cells and outputs |\n| **Selection** | Manages cell selection and focus state |\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/notebookEditorWidget.ts:142-250]()\n\n### Initialization Flow\n\n```mermaid\nsequenceDiagram\n    participant Constructor\n    participant _createBody\n    participant _createCellList\n    participant attachViewModel\n    participant _restoreSelectedKernel\n    \n    Constructor-\u003e\u003e_createBody: Create DOM structure\n    _createBody-\u003e\u003e_createCellList: Create NotebookCellList\n    _createBody-\u003e\u003e_createBody: Create BackLayerWebView\n    Constructor-\u003e\u003eConstructor: Register event handlers\n    \n    Note over Constructor: Later when model attached\n    \n    Constructor-\u003e\u003eattachViewModel: model set\n    attachViewModel-\u003e\u003e_restoreSelectedKernel: Restore kernel\n    attachViewModel-\u003e\u003eattachViewModel: Sync cell list\n    attachViewModel-\u003e\u003eattachViewModel: Initialize webview state\n```\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/notebookEditorWidget.ts:309-476](), [src/vs/workbench/contrib/notebook/browser/notebookEditorWidget.ts:1145-1360]()\n\n### DOM Structure\n\nThe widget creates a hierarchical DOM structure:\n\n```\n.notebookOverlay (overlayContainer)\n .notebook-toolbar-container (top toolbar)\n .notebook-sticky-scroll-container (sticky scroll)\n .cell-list-container (body)\n    .monaco-list (NotebookCellList)\n        .monaco-list-rows (cells)\n .notebook-overflow-widget-container (overflow widgets)\n```\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/notebookEditorWidget.ts:614-641]()\n\n## Cell List Architecture\n\nThe `NotebookCellList` extends `WorkbenchList` to provide virtualized rendering of notebook cells with custom behaviors for cell-specific interactions.\n\n```mermaid\ngraph TD\n    NotebookCellList[\"NotebookCellList\u003cbr/\u003eextends WorkbenchList\"]\n    NotebookCellListView[\"NotebookCellListView\u003cbr/\u003ecustom IListView\"]\n    NotebookCellListDelegate[\"NotebookCellListDelegate\u003cbr/\u003eIListVirtualDelegate\"]\n    CellRenderers[\"Cell Renderers\"]\n    NotebookViewModel[\"NotebookViewModel\"]\n    ViewZones[\"NotebookViewZones\"]\n    CellOverlays[\"NotebookCellOverlays\"]\n    \n    NotebookCellList --\u003e NotebookCellListView\n    NotebookCellList --\u003e NotebookCellListDelegate\n    NotebookCellList --\u003e CellRenderers\n    NotebookCellList --\u003e NotebookViewModel\n    NotebookCellList --\u003e ViewZones\n    NotebookCellList --\u003e CellOverlays\n```\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/view/notebookCellList.ts:80-131]()\n\n### Virtualization\n\nThe cell list uses a custom `NotebookCellListView` that extends the standard list view to handle:\n\n- **Dynamic Heights**: Cells have variable heights based on content and outputs\n- **View Zones**: Additional UI elements between cells (e.g., toolbars)\n- **Cell Overlays**: UI elements overlaid on cells (e.g., decorations)\n- **Hidden Ranges**: Support for folded sections\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/view/notebookCellList.ts:80-170]()\n\n### Cell Focus and Selection\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e Unfocused\n    Unfocused --\u003e ContainerFocus: Focus cell container\n    ContainerFocus --\u003e EditorFocus: Enter edit mode\n    ContainerFocus --\u003e OutputFocus: Focus output\n    EditorFocus --\u003e ContainerFocus: Quit edit mode\n    OutputFocus --\u003e ContainerFocus: Focus cell\n    ContainerFocus --\u003e Unfocused: Blur\n    EditorFocus --\u003e Unfocused: Blur\n    OutputFocus --\u003e Unfocused: Blur\n```\n\nThe cell list tracks:\n- **Focus**: Which cell is focused (single)\n- **Selection**: Which cells are selected (multiple ranges)\n- **Active Cell**: The currently active cell for editing\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/view/notebookCellList.ts:348-531]()\n\n### Visible Range Management\n\nThe list computes visible ranges considering:\n- Scroll position\n- Hidden/folded ranges\n- Cell heights\n\nThis is used to determine which cells need rendering and which outputs should be visible in the webview.\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/view/notebookCellList.ts:115-131](), [src/vs/workbench/contrib/notebook/browser/view/notebookCellList.ts:891-970]()\n\n## Cell Renderers\n\nNotebook cells are rendered using two specialized renderers based on cell type.\n\n### Renderer Architecture\n\n```mermaid\ngraph TD\n    AbstractCellRenderer[\"AbstractCellRenderer\u003cbr/\u003ebase class\"]\n    MarkupCellRenderer[\"MarkupCellRenderer\u003cbr/\u003eTEMPLATE_ID: markdown_cell\"]\n    CodeCellRenderer[\"CodeCellRenderer\u003cbr/\u003eTEMPLATE_ID: code_cell\"]\n    \n    MarkdownCellRenderTemplate[\"MarkdownCellRenderTemplate\"]\n    CodeCellRenderTemplate[\"CodeCellRenderTemplate\"]\n    \n    CellPartsCollection[\"CellPartsCollection\u003cbr/\u003emanages cell UI parts\"]\n    \n    AbstractCellRenderer --\u003e MarkupCellRenderer\n    AbstractCellRenderer --\u003e CodeCellRenderer\n    \n    MarkupCellRenderer --\u003e MarkdownCellRenderTemplate\n    CodeCellRenderer --\u003e CodeCellRenderTemplate\n    \n    MarkdownCellRenderTemplate --\u003e CellPartsCollection\n    CodeCellRenderTemplate --\u003e CellPartsCollection\n```\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/view/renderers/cellRenderer.ts:87-110](), [src/vs/workbench/contrib/notebook/browser/view/renderers/cellRenderer.ts:112-236](), [src/vs/workbench/contrib/notebook/browser/view/renderers/cellRenderer.ts:237-340]()\n\n### Markup Cell Renderer\n\nThe `MarkupCellRenderer` renders markdown cells:\n\n**Template Structure:**\n```\n.markdown-cell-row\n .cell-inner-container\n     .cell-decoration (decorations)\n     .cell-title-toolbar (toolbar)\n     .cell-focus-indicator-* (focus indicators)\n     .cell.code (for edit mode)\n        .cell-chat-part (inline chat)\n        .input-collapse-container (collapsed input)\n        .cell-editor-container (monaco editor)\n     .cell-comment-container (comments)\n     .cell.markdown (preview container)\n     .cell-bottom-toolbar-container\n```\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/view/renderers/cellRenderer.ts:137-209]()\n\n### Code Cell Renderer\n\nThe `CodeCellRenderer` renders code cells with execution UI:\n\n**Template Structure:**\n```\n.code-cell-row\n .cell-inner-container\n     .cell-focus-indicator-*\n     .cell-title-toolbar\n     .cell-chat-part\n     .cell.code\n        .run-button-container (execute button)\n        .input-collapse-container\n        .execution-count-label\n        .cell-editor-part\n           .cell-editor-container (monaco editor)\n        .cell-output-container\n            .output-collapse-container\n            .output-inner-container\n     .cell-bottom-toolbar-container\n```\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/view/renderers/cellRenderer.ts:260-339]()\n\n### Cell Parts System\n\nBoth renderers use a `CellPartsCollection` to manage modular cell UI components:\n\n| Part | Purpose |\n|------|---------|\n| `CellChatPart` | Inline chat integration |\n| `CellEditorStatusBar` | Status bar below editor |\n| `CellFocusIndicator` | Visual focus indicators |\n| `CellDecorations` | Decorations (errors, breakpoints) |\n| `CellComments` | Comment thread UI |\n| `CollapsedCellInput` | Collapsed input preview |\n| `CellExecutionPart` | Execution state UI (code cells) |\n| `CodeCellOutputPart` | Output rendering (code cells) |\n| `CellToolbars` | Various toolbars |\n| `CellDragAndDropPart` | Drag/drop handling |\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/view/renderers/cellRenderer.ts:175-190](), [src/vs/workbench/contrib/notebook/browser/view/renderers/cellRenderer.ts:310-330]()\n\n### Render Element Flow\n\n```mermaid\nsequenceDiagram\n    participant CellList\n    participant Renderer\n    participant Template\n    participant ViewModel\n    participant CellParts\n    \n    CellList-\u003e\u003eRenderer: renderElement(element, index, templateData)\n    Renderer-\u003e\u003eTemplate: Set currentRenderedCell\n    Renderer-\u003e\u003eViewModel: Get cell state\n    Renderer-\u003e\u003eCellParts: renderCell(element)\n    CellParts-\u003e\u003eCellParts: Initialize each part\n    Note over CellParts: Parts update template DOM\u003cbr/\u003ebased on cell state\n```\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/view/renderers/cellRenderer.ts:211-226](), [src/vs/workbench/contrib/notebook/browser/view/renderers/cellRenderer.ts:341-376]()\n\n## Cell View Models\n\nCell view models provide a presentation layer over the data model, managing UI state and editor instances.\n\n### View Model Hierarchy\n\n```mermaid\ngraph TD\n    BaseCellViewModel[\"BaseCellViewModel\u003cbr/\u003eabstract base\"]\n    CodeCellViewModel[\"CodeCellViewModel\u003cbr/\u003eCellKind.Code\"]\n    MarkupCellViewModel[\"MarkupCellViewModel\u003cbr/\u003eCellKind.Markup\"]\n    \n    NotebookCellTextModel[\"NotebookCellTextModel\u003cbr/\u003edata model\"]\n    ITextModel[\"ITextModel\u003cbr/\u003emonaco editor model\"]\n    ICellOutputViewModel[\"ICellOutputViewModel\u003cbr/\u003eoutput view models\"]\n    \n    BaseCellViewModel --\u003e CodeCellViewModel\n    BaseCellViewModel --\u003e MarkupCellViewModel\n    \n    BaseCellViewModel --\u003e NotebookCellTextModel\n    BaseCellViewModel --\u003e ITextModel\n    CodeCellViewModel --\u003e ICellOutputViewModel\n```\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/viewModel/baseCellViewModel.ts:30-76](), [src/vs/workbench/contrib/notebook/browser/viewModel/codeCellViewModel.ts:30-51](), [src/vs/workbench/contrib/notebook/browser/viewModel/markupCellViewModel.ts:22-36]()\n\n### BaseCellViewModel\n\nThe base class manages common cell functionality:\n\n**Key Properties:**\n- `handle`: Unique cell identifier\n- `uri`: Cell URI (derived from notebook URI)\n- `model`: Reference to `NotebookCellTextModel`\n- `textModel`: Monaco `ITextModel` for editing\n- `editState`: Current edit state (Preview, Editing)\n- `focusMode`: Cell focus mode (Container, Editor, Output)\n- `layoutInfo`: Cell layout dimensions\n\n**Key Events:**\n- `onDidChangeState`: Cell state changes\n- `onDidChangeLayout`: Layout changes\n- `onDidChangeEditorAttachState`: Editor attached/detached\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/viewModel/baseCellViewModel.ts:30-165]()\n\n### CodeCellViewModel\n\nExtends `BaseCellViewModel` for code cells:\n\n**Additional Features:**\n- **Output Management**: Array of `CellOutputViewModel` instances\n- **Execution State**: Tracks running/idle state\n- **Output Height Tracking**: `PrefixSumComputer` for output positions\n- **Show More Button**: For limiting displayed outputs\n\n**Key Methods:**\n- `outputsViewModels`: Array of output view models\n- `getOutputOffset(index)`: Get Y offset of specific output\n- `updateOutputHeight(index, height)`: Update output height\n- `spliceOutputHeights(start, deleteCount, newOutputs)`: Modify outputs\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/viewModel/codeCellViewModel.ts:30-280]()\n\n### MarkupCellViewModel\n\nExtends `BaseCellViewModel` for markdown cells:\n\n**Additional Features:**\n- **Preview/Edit Modes**: Toggle between rendered and editing\n- **Rendered HTML**: Cached rendered output\n- **Folding State**: Support for collapsing sections\n\n**Key Properties:**\n- `renderedHtml`: Cached HTML output\n- `foldingState`: Collapsed/expanded state\n- `layoutInfo`: Includes preview height\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/viewModel/markupCellViewModel.ts:22-300]()\n\n### Layout State Management\n\nCell view models track layout state through a state machine:\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e Uninitialized\n    Uninitialized --\u003e Estimated: Initial render\n    Estimated --\u003e Measured: First measurement\n    Measured --\u003e Measured: Updates\n    Estimated --\u003e FromCache: Restore from cache\n    FromCache --\u003e Measured: Re-measure\n```\n\nThis enables efficient rendering by using estimates until actual measurements are available.\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/notebookBrowser.ts:172-177]()\n\n## Cell Editor Management\n\nMonaco editor instances for cells are managed through an editor pool for efficiency.\n\n### Editor Pool\n\n```mermaid\ngraph LR\n    NotebookCellEditorPool[\"NotebookCellEditorPool\"]\n    FreeEditors[\"Free Editors\u003cbr/\u003eup to 10\"]\n    ActiveEditors[\"Active Editors\u003cbr/\u003ecell-to-editor map\"]\n    \n    NotebookCellEditorPool --\u003e FreeEditors\n    NotebookCellEditorPool --\u003e ActiveEditors\n    \n    CellRenderer[\"Cell Renderer\"]\n    CellViewModel[\"Cell View Model\"]\n    \n    CellRenderer --\u003e|acquire| NotebookCellEditorPool\n    NotebookCellEditorPool --\u003e|returns| ICodeEditor\n    CellViewModel --\u003e|release| NotebookCellEditorPool\n```\n\nThe `NotebookCellEditorPool` manages editor instances:\n\n1. **Acquire**: Renderer requests editor for a cell\n2. **Reuse**: Returns free editor or creates new one\n3. **Release**: When cell unmounted, editor returned to pool\n4. **Dispose**: Excess editors disposed (keeps max 10 free)\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/view/notebookCellEditorPool.ts]()\n\n### Editor Options\n\nCell editors use `BaseCellEditorOptions` which:\n- Extends global editor options\n- Adds notebook-specific overrides\n- Syncs with configuration changes\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/viewModel/cellEditorOptions.ts]()\n\n## Cell Lifecycle\n\n### Cell Creation and Addition\n\n```mermaid\nsequenceDiagram\n    participant User\n    participant NotebookEditor\n    participant ViewModel\n    participant TextModel\n    participant CellList\n    participant Renderer\n    \n    User-\u003e\u003eNotebookEditor: Insert cell command\n    NotebookEditor-\u003e\u003eTextModel: applyEdits([ICellReplaceEdit])\n    TextModel-\u003e\u003eTextModel: Create NotebookCellTextModel\n    TextModel-\u003e\u003eViewModel: Fire onDidChangeContent\n    ViewModel-\u003e\u003eViewModel: Create CellViewModel\n    ViewModel-\u003e\u003eCellList: Fire onDidChangeViewCells\n    CellList-\u003e\u003eCellList: splice(start, delete, insert)\n    CellList-\u003e\u003eRenderer: renderElement() for new cell\n    Renderer-\u003e\u003eRenderer: Create template if needed\n    Renderer-\u003e\u003eRenderer: Attach editor, parts\n```\n\n**Sources:** [src/vs/workbench/contrib/notebook/common/model/notebookTextModel.ts:400-570](), [src/vs/workbench/contrib/notebook/browser/viewModel/notebookViewModelImpl.ts:400-600]()\n\n### Cell Editing States\n\nCells transition through editing states:\n\n| State | Description | UI |\n|-------|-------------|-----|\n| `Preview` | Read-only preview (markdown cells) | Rendered HTML shown |\n| `Editing` | Active editing | Monaco editor visible |\n\nTransitions:\n- **Double-click** on markdown  Editing\n- **Escape** or **blur**  Preview\n- Code cells always in Editing\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/notebookBrowser.ts:42-44]()\n\n### Cell Deletion\n\n```mermaid\nsequenceDiagram\n    participant User\n    participant NotebookEditor\n    participant ViewModel\n    participant TextModel\n    participant CellList\n    participant Renderer\n    \n    User-\u003e\u003eNotebookEditor: Delete cell command\n    NotebookEditor-\u003e\u003eTextModel: applyEdits([ICellReplaceEdit])\n    TextModel-\u003e\u003eTextModel: Remove cell from cells array\n    TextModel-\u003e\u003eViewModel: Fire onDidChangeContent\n    ViewModel-\u003e\u003eViewModel: Dispose CellViewModel\n    ViewModel-\u003e\u003eCellList: Fire onDidChangeViewCells\n    CellList-\u003e\u003eCellList: splice(start, delete, [])\n    CellList-\u003e\u003eRenderer: disposeElement()\n    Renderer-\u003e\u003eRenderer: Release editor to pool\n    Renderer-\u003e\u003eRenderer: Clear template state\n```\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/view/notebookCellList.ts:714-774]()\n\n## Cell Interactions\n\n### Focus Management\n\nThe notebook editor coordinates focus across multiple focusable areas:\n\n```mermaid\ngraph TD\n    NotebookEditorWidget[\"NotebookEditorWidget\u003cbr/\u003eOverall focus coordinator\"]\n    \n    CellContainer[\"Cell Container\u003cbr/\u003eCellFocusMode.Container\"]\n    CellEditor[\"Cell Editor\u003cbr/\u003eCellFocusMode.Editor\"]\n    CellOutput[\"Cell Output\u003cbr/\u003eCellFocusMode.Output\"]\n    NotebookWebview[\"Notebook Webview\u003cbr/\u003eOutput rendering\"]\n    \n    NotebookEditorWidget --\u003e CellContainer\n    NotebookEditorWidget --\u003e CellEditor\n    NotebookEditorWidget --\u003e CellOutput\n    NotebookEditorWidget --\u003e NotebookWebview\n    \n    CellContainer -.up/down arrow.-\u003e CellContainer\n    CellContainer -.enter.-\u003e CellEditor\n    CellEditor -.escape.-\u003e CellContainer\n    CellOutput -.escape.-\u003e CellContainer\n```\n\n**Focus Context Keys:**\n- `NOTEBOOK_EDITOR_FOCUSED`: Editor has focus\n- `NOTEBOOK_CELL_LIST_FOCUSED`: Cell list focused\n- `NOTEBOOK_OUTPUT_FOCUSED`: Output focused\n- `NOTEBOOK_EDITOR_EDITABLE`: Editor is editable\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/notebookEditorWidget.ts:442-450](), [src/vs/workbench/contrib/notebook/common/notebookContextKeys.ts]()\n\n### Selection Model\n\nThe notebook maintains selections as cell ranges:\n\n```typescript\ninterface ICellRange {\n    start: number;  // Inclusive\n    end: number;    // Exclusive\n}\n```\n\nOperations:\n- `getSelections()`: Get current selected ranges\n- `setSelections(ranges)`: Update selections\n- `getFocus()`: Get focused cell range\n- `setFocus(range)`: Update focus\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/notebookEditorWidget.ts:503-535](), [src/vs/workbench/contrib/notebook/common/notebookRange.ts:1-200]()\n\n### Cell Reveal and Scrolling\n\nThe editor provides methods to reveal cells with different behaviors:\n\n| Method | Behavior |\n|--------|----------|\n| `revealCellRangeInView()` | Scroll to make range visible |\n| `revealInView()` | Scroll cell into view |\n| `revealInCenter()` | Scroll cell to center |\n| `revealInCenterIfOutsideViewport()` | Center only if not visible |\n| `revealLineInViewAsync()` | Reveal specific line in cell |\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/notebookEditorWidget.ts:2100-2400]()\n\n### Drag and Drop\n\nCell drag and drop is coordinated by `CellDragAndDropController`:\n\n1. **Drag Start**: User drags cell container\n2. **Drop Target**: Visual indicator shows drop position\n3. **Drop**: Cells moved or copied based on modifier keys\n\n**Supported Operations:**\n- Reorder cells within notebook\n- Copy cells (with Ctrl/Cmd)\n- Move cells between notebooks\n- Drop external files (creates new cells)\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/view/cellParts/cellDnd.ts]()\n\n## Output Rendering via BackLayerWebView\n\nCell outputs are rendered in a webview for security and flexibility. This is covered in detail in [Cell Outputs and WebView Rendering](#8.4), but here's the integration with cell management:\n\n### Webview Integration\n\n```mermaid\ngraph LR\n    NotebookEditorWidget[\"NotebookEditorWidget\"]\n    BackLayerWebView[\"BackLayerWebView\"]\n    IWebviewElement[\"IWebviewElement\u003cbr/\u003eactual webview\"]\n    \n    CellOutputViewModel[\"CellOutputViewModel\"]\n    InsetMapping[\"insetMapping\u003cbr/\u003eoutput  cached inset\"]\n    \n    NotebookEditorWidget --\u003e BackLayerWebView\n    BackLayerWebView --\u003e IWebviewElement\n    BackLayerWebView --\u003e InsetMapping\n    \n    CellOutputViewModel -.mapped to.-\u003e InsetMapping\n```\n\n**Communication Flow:**\n1. Cell output created  `createOutput()` message to webview\n2. Webview renders  sends back dimension message\n3. Editor updates cell height\n4. Scroll changes  `updateOutputScrolls()` to webview\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/view/renderers/backLayerWebView.ts:129-226]()\n\n### Output Height Synchronization\n\n```mermaid\nsequenceDiagram\n    participant CodeCellVM as CodeCellViewModel\n    participant NotebookEditor as NotebookEditorWidget\n    participant Webview as BackLayerWebView\n    participant List as NotebookCellList\n    \n    Webview-\u003e\u003eNotebookEditor: dimension message\n    NotebookEditor-\u003e\u003eCodeCellVM: updateOutputHeight(index, height)\n    CodeCellVM-\u003e\u003eCodeCellVM: Update height in PrefixSumComputer\n    CodeCellVM-\u003e\u003eList: Fire layout change\n    List-\u003e\u003eList: Update cell position\n    List-\u003e\u003eWebview: updateOutputScrolls()\n```\n\nThe webview measures rendered output and reports heights back, allowing the cell list to properly position subsequent cells.\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/notebookEditorWidget.ts:1711-1763](), [src/vs/workbench/contrib/notebook/browser/viewModel/codeCellViewModel.ts:420-502]()\n\n## Cell State Synchronization\n\nThe editor maintains consistency between multiple representations:\n\n```mermaid\ngraph TD\n    NotebookTextModel[\"NotebookTextModel\u003cbr/\u003eData layer\"]\n    NotebookViewModel[\"NotebookViewModel\u003cbr/\u003eView model layer\"]\n    CellViewModel[\"CellViewModel\u003cbr/\u003ePer-cell VM\"]\n    CellTemplate[\"Cell Template\u003cbr/\u003eRendered DOM\"]\n    MonacoEditor[\"Monaco Editor\u003cbr/\u003eText editing\"]\n    \n    NotebookTextModel --\u003e|onDidChangeContent| NotebookViewModel\n    NotebookViewModel --\u003e|creates/disposes| CellViewModel\n    CellViewModel --\u003e|onDidChangeState| CellTemplate\n    CellViewModel --\u003e|manages| MonacoEditor\n    MonacoEditor --\u003e|edits| NotebookTextModel\n```\n\n**Event Flow:**\n1. User edits in Monaco  `ITextModel` changes\n2. `NotebookCellTextModel` syncs from `ITextModel`\n3. `NotebookTextModel` fires `onDidChangeContent`\n4. `NotebookViewModel` updates affected `CellViewModel`s\n5. `CellViewModel` fires `onDidChangeState`\n6. Cell parts update rendered DOM\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/viewModel/notebookViewModelImpl.ts:200-400](), [src/vs/workbench/contrib/notebook/browser/view/cellParts/cellPart.ts]()\n\n---\n\nThis completes the coverage of the notebook editor and cell management infrastructure. The system provides a sophisticated virtualized cell list with efficient editor pooling, flexible rendering through cell parts, and coordinated state management across multiple layers."])</script><script>self.__next_f.push([1,"43:T8f01,"])</script><script>self.__next_f.push([1,"# Notebook Data Model\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [extensions/markdown-language-features/notebook/index.ts](extensions/markdown-language-features/notebook/index.ts)\n- [src/vs/workbench/api/browser/mainThreadNotebook.ts](src/vs/workbench/api/browser/mainThreadNotebook.ts)\n- [src/vs/workbench/api/common/extHostNotebook.ts](src/vs/workbench/api/common/extHostNotebook.ts)\n- [src/vs/workbench/contrib/notebook/browser/media/notebook.css](src/vs/workbench/contrib/notebook/browser/media/notebook.css)\n- [src/vs/workbench/contrib/notebook/browser/notebook.contribution.ts](src/vs/workbench/contrib/notebook/browser/notebook.contribution.ts)\n- [src/vs/workbench/contrib/notebook/browser/notebookBrowser.ts](src/vs/workbench/contrib/notebook/browser/notebookBrowser.ts)\n- [src/vs/workbench/contrib/notebook/browser/notebookEditor.ts](src/vs/workbench/contrib/notebook/browser/notebookEditor.ts)\n- [src/vs/workbench/contrib/notebook/browser/notebookEditorWidget.ts](src/vs/workbench/contrib/notebook/browser/notebookEditorWidget.ts)\n- [src/vs/workbench/contrib/notebook/browser/view/notebookCellList.ts](src/vs/workbench/contrib/notebook/browser/view/notebookCellList.ts)\n- [src/vs/workbench/contrib/notebook/browser/view/renderers/backLayerWebView.ts](src/vs/workbench/contrib/notebook/browser/view/renderers/backLayerWebView.ts)\n- [src/vs/workbench/contrib/notebook/browser/view/renderers/cellRenderer.ts](src/vs/workbench/contrib/notebook/browser/view/renderers/cellRenderer.ts)\n- [src/vs/workbench/contrib/notebook/browser/view/renderers/webviewMessages.ts](src/vs/workbench/contrib/notebook/browser/view/renderers/webviewMessages.ts)\n- [src/vs/workbench/contrib/notebook/browser/view/renderers/webviewPreloads.ts](src/vs/workbench/contrib/notebook/browser/view/renderers/webviewPreloads.ts)\n- [src/vs/workbench/contrib/notebook/browser/viewModel/baseCellViewModel.ts](src/vs/workbench/contrib/notebook/browser/viewModel/baseCellViewModel.ts)\n- [src/vs/workbench/contrib/notebook/browser/viewModel/codeCellViewModel.ts](src/vs/workbench/contrib/notebook/browser/viewModel/codeCellViewModel.ts)\n- [src/vs/workbench/contrib/notebook/browser/viewModel/markupCellViewModel.ts](src/vs/workbench/contrib/notebook/browser/viewModel/markupCellViewModel.ts)\n- [src/vs/workbench/contrib/notebook/common/model/notebookCellTextModel.ts](src/vs/workbench/contrib/notebook/common/model/notebookCellTextModel.ts)\n- [src/vs/workbench/contrib/notebook/common/model/notebookTextModel.ts](src/vs/workbench/contrib/notebook/common/model/notebookTextModel.ts)\n- [src/vs/workbench/contrib/notebook/common/notebookCommon.ts](src/vs/workbench/contrib/notebook/common/notebookCommon.ts)\n- [src/vs/workbench/contrib/notebook/common/notebookEditorModel.ts](src/vs/workbench/contrib/notebook/common/notebookEditorModel.ts)\n- [src/vs/workbench/contrib/notebook/common/notebookService.ts](src/vs/workbench/contrib/notebook/common/notebookService.ts)\n\n\u003c/details\u003e\n\n\n\nThis page documents the core data structures that represent notebook documents and their cells. The notebook data model consists of `NotebookTextModel` (the notebook document), `NotebookCellTextModel` (individual cells), cell outputs, and the undo/redo system that manages modifications to notebook content.\n\nFor information about notebook view models and UI representation, see [Notebook Architecture Overview](#9.1). For cell output rendering in the webview, see [Cell Outputs and WebView Rendering](#9.4).\n\n## Overview\n\nThe notebook data model is hierarchical with three main layers that represent the persistent state of a notebook:\n\n1. **NotebookTextModel** - The root model representing the entire notebook document\n2. **NotebookCellTextModel** - Individual cells containing code or markup content\n3. **NotebookCellOutputTextModel** - Execution outputs attached to code cells\n\nThese models handle:\n- Cell content storage and text buffer management\n- Cell operations (insert, delete, move, metadata updates)\n- Output lifecycle management\n- Undo/redo operation tracking\n- Change event notifications\n- Serialization to/from persistent storage\n\n**Notebook Data Model Structure**\n\n```mermaid\ngraph TB\n    NotebookTextModel[\"NotebookTextModel\"]\n    Cell1[\"NotebookCellTextModel\u003cbr/\u003e(Cell 0)\"]\n    Cell2[\"NotebookCellTextModel\u003cbr/\u003e(Cell 1)\"]\n    CellN[\"NotebookCellTextModel\u003cbr/\u003e(Cell n)\"]\n    \n    TextBuffer1[\"PieceTreeTextBuffer\u003cbr/\u003e(Source Code)\"]\n    TextModel1[\"ITextModel\u003cbr/\u003e(Monaco Editor)\"]\n    \n    Output1[\"NotebookCellOutputTextModel\"]\n    Output2[\"NotebookCellOutputTextModel\"]\n    \n    Metadata[\"metadata:\u003cbr/\u003eNotebookDocumentMetadata\"]\n    CellMeta[\"metadata:\u003cbr/\u003eNotebookCellMetadata\"]\n    InternalMeta[\"internalMetadata:\u003cbr/\u003eNotebookCellInternalMetadata\"]\n    \n    NotebookTextModel --\u003e|\"cells: readonly ICell[]\"| Cell1\n    NotebookTextModel --\u003e|cells| Cell2\n    NotebookTextModel --\u003e|cells| CellN\n    NotebookTextModel --\u003e Metadata\n    \n    Cell1 --\u003e|textBuffer| TextBuffer1\n    Cell1 --\u003e|\"textModel?\"| TextModel1\n    Cell1 --\u003e|\"outputs: ICellOutput[]\"| Output1\n    Cell1 --\u003e|outputs| Output2\n    Cell1 --\u003e CellMeta\n    Cell1 --\u003e InternalMeta\n```\n\nSources: [src/vs/workbench/contrib/notebook/common/model/notebookTextModel.ts](), [src/vs/workbench/contrib/notebook/common/model/notebookCellTextModel.ts](), [src/vs/workbench/contrib/notebook/common/notebookCommon.ts:269-310]()\n\n## NotebookTextModel\n\n`NotebookTextModel` is the root data model class that represents an entire notebook document. It implements the `INotebookTextModel` interface defined in [src/vs/workbench/contrib/notebook/common/notebookCommon.ts:295-310]().\n\n### Core Properties\n\n| Property | Type | Description |\n|----------|------|-------------|\n| `uri` | `URI` | The notebook document URI |\n| `viewType` | `string` | Notebook type identifier (e.g., 'jupyter-notebook') |\n| `versionId` | `number` | Monotonically increasing version counter |\n| `cells` | `readonly ICell[]` | Ordered array of cell models |\n| `metadata` | `NotebookDocumentMetadata` | Document-level metadata (custom fields) |\n| `transientOptions` | `TransientOptions` | Configuration for transient (non-persisted) data |\n| `length` | `number` | Number of cells in the notebook |\n\nSources: [src/vs/workbench/contrib/notebook/common/model/notebookTextModel.ts:152-241]()\n\n### Cell Collection Management\n\n`NotebookTextModel` maintains cells in an internal array and assigns each cell a unique `handle` (a number identifier). Handles are sequential and never reused within a notebook instance:\n\n- New cells receive the next available handle starting from 0\n- Handles persist for the cell's lifetime\n- Cell URIs use the scheme `vscode-notebook-cell://` with the handle encoded\n- The `CellUri.generate(notebookUri, handle)` method creates cell URIs\n\nSources: [src/vs/workbench/contrib/notebook/common/model/notebookTextModel.ts:400-500](), [src/vs/workbench/contrib/notebook/common/notebookCommon.ts:611-620]()\n\n### Edit Operations Architecture\n\n**Cell Edit Types and Processing**\n\n```mermaid\ngraph TD\n    applyEdits[\"applyEdits(rawEdits, synchronous,\u003cbr/\u003ebeginSelectionState,\u003cbr/\u003eendSelectionsComputer,\u003cbr/\u003eundoRedoGroup)\"]\n    \n    CellReplace[\"ICellReplaceEdit\u003cbr/\u003eeditType: CellEditType.Replace\u003cbr/\u003eInsert/delete cells at index\"]\n    CellMove[\"ICellMoveEdit\u003cbr/\u003eeditType: CellEditType.Move\u003cbr/\u003eMove cells to new index\"]\n    CellMetadata[\"ICellMetadataEdit\u003cbr/\u003eeditType: CellEditType.Metadata\u003cbr/\u003eReplace cell metadata\"]\n    CellPartialMeta[\"ICellPartialMetadataEdit\u003cbr/\u003eeditType: CellEditType.PartialMetadata\u003cbr/\u003eUpdate specific metadata fields\"]\n    CellOutput[\"ICellOutputEdit\u003cbr/\u003eeditType: CellEditType.Output\u003cbr/\u003eReplace/append outputs\"]\n    CellLang[\"ICellLanguageEdit\u003cbr/\u003eeditType: CellEditType.CellLanguage\u003cbr/\u003eChange cell language\"]\n    DocMeta[\"IDocumentMetadataEdit\u003cbr/\u003eeditType: CellEditType.DocumentMetadata\u003cbr/\u003eUpdate document metadata\"]\n    \n    StackOp[\"StackOperation\u003cbr/\u003e(Undo/Redo Element)\"]\n    Events[\"NotebookTextModelChangedEvent\u003cbr/\u003erawEvents, versionId,\u003cbr/\u003esynchronous, endSelectionState\"]\n    \n    applyEdits --\u003e CellReplace\n    applyEdits --\u003e CellMove\n    applyEdits --\u003e CellMetadata\n    applyEdits --\u003e CellPartialMeta\n    applyEdits --\u003e CellOutput\n    applyEdits --\u003e CellLang\n    applyEdits --\u003e DocMeta\n    \n    CellReplace --\u003e StackOp\n    CellMove --\u003e StackOp\n    CellMetadata --\u003e StackOp\n    \n    applyEdits --\u003e Events\n```\n\nThe `applyEdits()` method is the central point for all notebook modifications. It processes an array of `ICellEditOperation` and:\n\n1. Creates a `StackOperation` for undo/redo\n2. Applies each edit operation to the cells array\n3. Fires change events with granular details\n4. Updates the version ID\n5. Manages selection state transitions\n\nSources: [src/vs/workbench/contrib/notebook/common/model/notebookTextModel.ts:574-750](), [src/vs/workbench/contrib/notebook/common/notebookCommon.ts:462-571]()\n\n### Change Event System\n\n`NotebookTextModel` uses `NotebookTextModelChangedEvent` to notify listeners of changes. Each event contains:\n\n| Field | Type | Description |\n|-------|------|-------------|\n| `rawEvents` | `NotebookRawContentEvent[]` | Array of granular change events |\n| `versionId` | `number` | New notebook version ID |\n| `synchronous` | `boolean \\| undefined` | Whether change was synchronous |\n| `endSelectionState` | `ISelectionState \\| undefined` | Selection state after edits |\n\n**Raw Event Types:**\n\n| Event Type | Description |\n|------------|-------------|\n| `NotebookCellsChangeType.ModelChange` | Cells added or removed (splice) |\n| `NotebookCellsChangeType.Move` | Cells reordered |\n| `NotebookCellsChangeType.ChangeCellContent` | Cell text content modified |\n| `NotebookCellsChangeType.Output` | Cell outputs changed |\n| `NotebookCellsChangeType.OutputItem` | Output items within an output changed |\n| `NotebookCellsChangeType.ChangeCellMetadata` | Cell metadata updated |\n| `NotebookCellsChangeType.ChangeCellInternalMetadata` | Internal metadata updated |\n| `NotebookCellsChangeType.ChangeDocumentMetadata` | Document metadata updated |\n| `NotebookCellsChangeType.ChangeCellLanguage` | Cell language changed |\n\nSources: [src/vs/workbench/contrib/notebook/common/notebookCommon.ts:337-430](), [src/vs/workbench/contrib/notebook/common/model/notebookTextModel.ts:700-850]()\n\n## NotebookCellTextModel\n\n`NotebookCellTextModel` represents an individual cell within a notebook. It implements the `ICell` interface and manages cell content, outputs, and metadata.\n\n### Cell Type Distinction\n\n```mermaid\ngraph TB\n    ICell[\"ICell Interface\u003cbr/\u003e(Common Properties)\"]\n    \n    CodeCell[\"Code Cell\u003cbr/\u003ecellKind: CellKind.Code\"]\n    MarkupCell[\"Markup Cell\u003cbr/\u003ecellKind: CellKind.Markup\"]\n    \n    ICell --\u003e CodeCell\n    ICell --\u003e MarkupCell\n    \n    CodeCell --\u003e Outputs[\"outputs: ICellOutput[]\u003cbr/\u003eExecution results\"]\n    CodeCell --\u003e Exec[\"internalMetadata.executionOrder\u003cbr/\u003eExecution sequence number\"]\n    CodeCell --\u003e Lang[\"language: string\u003cbr/\u003e(e.g., 'python', 'javascript')\"]\n    \n    MarkupCell --\u003e NoOutputs[\"outputs: []\u003cbr/\u003e(Always empty)\"]\n    MarkupCell --\u003e MarkupLang[\"language: string\u003cbr/\u003e(typically 'markdown')\"]\n```\n\nSources: [src/vs/workbench/contrib/notebook/common/notebookCommon.ts:49-52](), [src/vs/workbench/contrib/notebook/common/model/notebookCellTextModel.ts:26-80]()\n\n### Core Properties and State\n\n| Property | Type | Description |\n|----------|------|-------------|\n| `uri` | `URI` | Cell URI with scheme `vscode-notebook-cell` |\n| `handle` | `number` | Unique stable identifier within notebook |\n| `language` | `string` | Language mode (e.g., 'python', 'markdown') |\n| `cellKind` | `CellKind` | Code (2) or Markup (1) |\n| `textBuffer` | `IReadonlyTextBuffer` | The cell's text content storage |\n| `textModel` | `ITextModel \\| undefined` | Monaco text model when cell is being edited |\n| `outputs` | `ICellOutput[]` | Array of execution outputs (code cells only) |\n| `metadata` | `NotebookCellMetadata` | User-visible metadata |\n| `internalMetadata` | `NotebookCellInternalMetadata` | Execution state and internal tracking |\n\nSources: [src/vs/workbench/contrib/notebook/common/model/notebookCellTextModel.ts:26-150](), [src/vs/workbench/contrib/notebook/common/notebookCommon.ts:269-287]()\n\n### Text Content Management\n\n**Text Model Creation and Synchronization**\n\n```mermaid\nsequenceDiagram\n    participant VM as CellViewModel\n    participant Cell as NotebookCellTextModel\n    participant ModelSvc as IModelService\n    participant TextModel as ITextModel\n    \n    VM-\u003e\u003eCell: resolveTextModel()\n    \n    alt TextModel doesn't exist\n        Cell-\u003e\u003eModelSvc: createModel(uri, language)\n        ModelSvc-\u003e\u003eTextModel: new TextModel(textBuffer)\n        TextModel--\u003e\u003eCell: Store reference\n    end\n    \n    Cell--\u003e\u003eVM: Return ITextModel\n    \n    Note over TextModel: User edits in Monaco\n    \n    TextModel-\u003e\u003eCell: onDidChangeContent(event)\n    Cell-\u003e\u003eCell: textBuffer.applyEdits()\n    Cell-\u003e\u003eCell: _hash = undefined\n    Cell-\u003e\u003eCell: onDidChangeContent.fire()\n```\n\nThe text model is created lazily:\n- Initially, cell content is stored in a `PieceTreeTextBuffer`\n- When editing begins, `IModelService.createModel()` creates a Monaco `ITextModel`\n- The text model and buffer stay synchronized\n- When the text model is disposed, content remains in the buffer\n\nSources: [src/vs/workbench/contrib/notebook/common/model/notebookCellTextModel.ts:150-250]()\n\n### Cell Metadata Structure\n\n**NotebookCellMetadata** (user-visible, persisted to disk):\n- Custom fields specific to notebook formats (e.g., Jupyter metadata)\n- `inputCollapsed?: boolean` - Whether cell input is collapsed\n- `outputCollapsed?: boolean` - Whether cell outputs are collapsed\n- Format-specific metadata like `tags`, `slideshow`, etc.\n\n**NotebookCellInternalMetadata** (internal state, some parts transient):\n\n| Field | Type | Description |\n|-------|------|-------------|\n| `executionOrder` | `number` | Sequential execution number |\n| `executionId` | `string` | Unique ID for current/last execution |\n| `runStartTime` | `number` | Timestamp when execution started |\n| `runEndTime` | `number` | Timestamp when execution ended |\n| `lastRunSuccess` | `boolean` | Whether last execution succeeded |\n| `renderDuration` | `Record\u003cstring, number\u003e` | Time to render each output by renderer ID |\n| `error` | `ICellExecutionError` | Execution error details if failed |\n\nSources: [src/vs/workbench/contrib/notebook/common/notebookCommon.ts:116-138](), [src/vs/workbench/contrib/notebook/common/model/notebookCellTextModel.ts:350-450]()\n\n### Automatic Language Detection\n\n`NotebookCellTextModel` supports automatic language detection for code cells using `ILanguageDetectionService`:\n\n```mermaid\ngraph LR\n    Enable[\"enableAutoLanguageDetection()\u003cbr/\u003e(Called by extension)\"]\n    \n    Delayer[\"ThrottledDelayer\u003cbr/\u003e(500ms delay)\"]\n    \n    Detect[\"ILanguageDetectionService\u003cbr/\u003edetectLanguage(uri)\"]\n    \n    Update[\"Update cell.language\u003cbr/\u003eFire onDidChangeLanguage\"]\n    \n    Enable --\u003e Delayer\n    Delayer --\u003e Detect\n    Detect --\u003e Update\n```\n\nLanguage detection is throttled to avoid excessive computation during rapid text changes. It runs after a 500ms delay.\n\nSources: [src/vs/workbench/contrib/notebook/common/model/notebookCellTextModel.ts:514-580]()\n\n### Hash Computation for Change Detection\n\nCells compute a hash value to detect actual content changes:\n\n```javascript\ngetHashValue(): number {\n    if (this._hash === undefined) {\n        const shaComputer = new StringSHA1();\n        const textBuffer = this.textBuffer;\n        for (let i = 0; i \u003c textBuffer.getLineCount(); i++) {\n            shaComputer.update(textBuffer.getLineContent(i + 1) + '\\n');\n        }\n        this._hash = shaComputer.digest();\n    }\n    return this._hash;\n}\n```\n\nThe hash is cached and invalidated when content changes, enabling efficient dirty state tracking.\n\nSources: [src/vs/workbench/contrib/notebook/common/model/notebookCellTextModel.ts:270-290]()\n\n## Cell Outputs\n\nCell outputs are managed through `NotebookCellOutputTextModel`, which implements the `ICellOutput` interface defined in [src/vs/workbench/contrib/notebook/common/notebookCommon.ts:229-245]().\n\n### Output Structure and MIME Types\n\n```mermaid\ngraph TB\n    ICellOutput[\"ICellOutput\"]\n    \n    OutputID[\"outputId: string\u003cbr/\u003e(Changes on replace)\"]\n    AltID[\"alternativeOutputId: string\u003cbr/\u003e(Stable for streaming)\"]\n    VersionID[\"versionId: number\u003cbr/\u003e(Increments on update)\"]\n    Metadata[\"metadata?: Record\u003cstring, any\u003e\"]\n    \n    Items[\"outputs: IOutputItemDto[]\"]\n    \n    Item1[\"IOutputItemDto\u003cbr/\u003emime: 'text/plain'\u003cbr/\u003edata: VSBuffer\"]\n    Item2[\"IOutputItemDto\u003cbr/\u003emime: 'application/json'\u003cbr/\u003edata: VSBuffer\"]\n    Item3[\"IOutputItemDto\u003cbr/\u003emime: 'image/png'\u003cbr/\u003edata: VSBuffer(base64)\"]\n    Item4[\"IOutputItemDto\u003cbr/\u003emime: 'text/html'\u003cbr/\u003edata: VSBuffer\"]\n    \n    ICellOutput --\u003e OutputID\n    ICellOutput --\u003e AltID\n    ICellOutput --\u003e VersionID\n    ICellOutput --\u003e Metadata\n    ICellOutput --\u003e Items\n    \n    Items --\u003e Item1\n    Items --\u003e Item2\n    Items --\u003e Item3\n    Items --\u003e Item4\n```\n\nEach output contains multiple output items with different MIME types, allowing renderers to choose the most appropriate representation for display.\n\nSources: [src/vs/workbench/contrib/notebook/common/notebookCommon.ts:218-245]()\n\n### Output Operations\n\n| Method | Description |\n|--------|-------------|\n| `replaceData(items: IOutputDto)` | Completely replace all output items |\n| `appendData(items: IOutputItemDto[])` | Append new items (for streaming outputs) |\n| `appendedSinceVersion(versionId, mime)` | Get data appended since a specific version |\n| `bumpVersion()` | Increment the version ID |\n| `asDto()` | Serialize to `IOutputDto` format |\n\n### Output ID Management for Streaming\n\nOutputs have two distinct identifiers to support streaming execution:\n\n- **outputId**: Changes when output is completely replaced (new execution)\n- **alternativeOutputId**: Remains stable across updates to the same output (streaming)\n\nThis dual-ID system allows the UI to:\n- Maintain webview state during streaming updates\n- Track which output corresponds to which execution\n- Update incrementally without recreating the entire output\n\n**Streaming Output Update Flow:**\n\n```mermaid\nsequenceDiagram\n    participant Kernel\n    participant Cell as NotebookCellTextModel\n    participant Output as NotebookCellOutputTextModel\n    participant UI as BackLayerWebView\n    \n    Note over Kernel: Execution starts\n    Kernel-\u003e\u003eCell: spliceNotebookCellOutputs(0, 0, [newOutput])\n    Cell-\u003e\u003eOutput: Create with outputId='abc', alternativeOutputId='alt-1'\n    Output-\u003e\u003eUI: Render initial output\n    \n    Note over Kernel: Streaming data arrives\n    Kernel-\u003e\u003eOutput: appendData([new item])\n    Output-\u003e\u003eOutput: bumpVersion()\n    Output-\u003e\u003eUI: Update existing output (same alternativeOutputId)\n    \n    Note over Kernel: More streaming data\n    Kernel-\u003e\u003eOutput: appendData([more items])\n    Output-\u003e\u003eOutput: bumpVersion()\n    Output-\u003e\u003eUI: Append to existing output\n```\n\nSources: [src/vs/workbench/contrib/notebook/common/model/notebookCellOutputTextModel.ts]()\n\n## Undo/Redo System\n\nThe notebook undo/redo system must handle both notebook-level operations (cell structure changes) and cell-level operations (text edits within cells).\n\n### Undo/Redo Architecture\n\n```mermaid\ngraph TB\n    subgraph \"IUndoRedoService\"\n        UndoStack[\"Undo Stack\"]\n        RedoStack[\"Redo Stack\"]\n    end\n    \n    subgraph \"NotebookTextModel\"\n        NotebookModel[\"NotebookTextModel\"]\n        StackOp[\"StackOperation\u003cbr/\u003e(IWorkspaceUndoRedoElement)\"]\n        \n        Edit1[\"SpliceCellsEdit\"]\n        Edit2[\"MoveCellEdit\"]\n        Edit3[\"CellMetadataEdit\"]\n    end\n    \n    subgraph \"Cell Level\"\n        CellModel[\"NotebookCellTextModel\"]\n        CellTextModel[\"ITextModel\u003cbr/\u003e(Monaco text model)\"]\n    end\n    \n    subgraph \"URI Comparison\"\n        URICompare[\"UriComparisonKeyComputer\u003cbr/\u003e(notebook.undoRedoPerCell setting)\"]\n    end\n    \n    NotebookModel --\u003e|Creates on applyEdits| StackOp\n    StackOp --\u003e|Contains| Edit1\n    StackOp --\u003e|Contains| Edit2\n    StackOp --\u003e|Contains| Edit3\n    \n    StackOp --\u003e|Pushed to| UndoStack\n    \n    CellModel --\u003e|Has| CellTextModel\n    CellTextModel --\u003e|Text edits pushed to| UndoStack\n    \n    URICompare --\u003e|\"false: Cell URI  Notebook URI\"| UndoStack\n    URICompare --\u003e|\"true: Each cell independent\"| UndoStack\n```\n\nSources: [src/vs/workbench/contrib/notebook/common/model/notebookTextModel.ts:33-150](), [src/vs/workbench/contrib/notebook/browser/notebook.contribution.ts:296-358]()\n\n### StackOperation Class\n\n`StackOperation` is the undo/redo unit for notebook operations. It implements `IWorkspaceUndoRedoElement`:\n\n**Key Properties:**\n\n| Property | Type | Description |\n|----------|------|-------------|\n| `type` | `UndoRedoElementType.Workspace` | Element type |\n| `resources` | `readonly URI[]` | Affected resources (notebook URI) |\n| `_operations` | `IUndoRedoElement[]` | Array of individual edit operations |\n| `_beginSelectionState` | `ISelectionState` | Selection before edits |\n| `_resultSelectionState` | `ISelectionState` | Selection after edits |\n\n**Undo/Redo Execution:**\n\n```mermaid\nsequenceDiagram\n    participant User\n    participant UndoSvc as IUndoRedoService\n    participant Stack as StackOperation\n    participant Model as NotebookTextModel\n    \n    Note over User: User performs edits\n    User-\u003e\u003eModel: applyEdits([edits])\n    Model-\u003e\u003eStack: new StackOperation(beginState)\n    \n    loop For each edit\n        Model-\u003e\u003eStack: pushEditOperation(edit)\n    end\n    \n    Model-\u003e\u003eStack: pushEndState(endState)\n    Model-\u003e\u003eUndoSvc: pushElement(StackOperation)\n    \n    Note over User: Later - User presses Ctrl+Z\n    User-\u003e\u003eUndoSvc: undo()\n    UndoSvc-\u003e\u003eStack: undo()\n    \n    Stack-\u003e\u003eStack: pauseEmitter()\n    \n    loop For each edit (reversed)\n        Stack-\u003e\u003eStack: operation.undo()\n    end\n    \n    Stack-\u003e\u003eStack: restoreSelectionState(beginState)\n    Stack-\u003e\u003eStack: resumeEmitter()\n    Stack-\u003e\u003eModel: Fire combined change event\n```\n\nThe `StackOperation` groups multiple edits and restores the notebook to the exact state before the operation, including selection.\n\nSources: [src/vs/workbench/contrib/notebook/common/model/notebookTextModel.ts:33-151]()\n\n### Undo/Redo Granularity Setting\n\nThe `notebook.undoRedoPerCell` setting controls undo/redo scope:\n\n**Setting: false (default)**\n- Undo/redo operates at the notebook level\n- Cell text edits are grouped with notebook structure changes\n- A `UriComparisonKeyComputer` maps cell URIs to the notebook URI\n- Undoing in a cell also undoes notebook-level changes made at the same time\n\n**Setting: true**\n- Each cell has an independent undo/redo stack\n- Cell text edits are isolated from notebook structure changes\n- Undoing in a cell only affects that cell's content\n\nImplementation in `NotebookContribution`:\n\n```typescript\nprivate updateCellUndoRedoComparisonKey(\n    configurationService: IConfigurationService, \n    undoRedoService: IUndoRedoService\n) {\n    const undoRedoPerCell = configurationService.getValue\u003cboolean\u003e(\n        NotebookSetting.undoRedoPerCell\n    );\n\n    if (!undoRedoPerCell) {\n        this._uriComparisonKeyComputer = undoRedoService.registerUriComparisonKeyComputer(\n            CellUri.scheme,\n            {\n                getComparisonKey: (uri: URI): string =\u003e {\n                    const data = CellUri.parse(uri);\n                    if (!data) {\n                        return uri.toString();\n                    }\n                    return data.notebook.toString(); // Map to notebook URI\n                }\n            }\n        );\n    } else {\n        this._uriComparisonKeyComputer?.dispose();\n    }\n}\n```\n\nSources: [src/vs/workbench/contrib/notebook/browser/notebook.contribution.ts:322-357]()\n\n### Cell Edit Types\n\nThe notebook model uses a discriminated union of edit types via `CellEditType` enum:\n\n```mermaid\ngraph TB\n    CellEditType[\"enum CellEditType\"]\n    \n    Replace[\"Replace = 1\u003cbr/\u003eICellReplaceEdit\u003cbr/\u003eInsert/delete cells\"]\n    Output[\"Output = 2\u003cbr/\u003eICellOutputEdit\u003cbr/\u003eReplace/append outputs\"]\n    Metadata[\"Metadata = 3\u003cbr/\u003eICellMetadataEdit\u003cbr/\u003eFull metadata replace\"]\n    Language[\"CellLanguage = 4\u003cbr/\u003eICellLanguageEdit\u003cbr/\u003eChange language\"]\n    DocMeta[\"DocumentMetadata = 5\u003cbr/\u003eIDocumentMetadataEdit\u003cbr/\u003eDoc metadata\"]\n    Move[\"Move = 6\u003cbr/\u003eICellMoveEdit\u003cbr/\u003eReorder cells\"]\n    OutputItems[\"OutputItems = 7\u003cbr/\u003eICellOutputItemEdit\u003cbr/\u003eUpdate output items\"]\n    PartialMeta[\"PartialMetadata = 8\u003cbr/\u003eICellPartialMetadataEdit\u003cbr/\u003ePartial metadata update\"]\n    PartialInternal[\"PartialInternalMetadata = 9\u003cbr/\u003eICellPartialInternalMetadataEdit\u003cbr/\u003ePartial internal metadata\"]\n    \n    CellEditType --\u003e Replace\n    CellEditType --\u003e Output\n    CellEditType --\u003e Metadata\n    CellEditType --\u003e Language\n    CellEditType --\u003e DocMeta\n    CellEditType --\u003e Move\n    CellEditType --\u003e OutputItems\n    CellEditType --\u003e PartialMeta\n    CellEditType --\u003e PartialInternal\n```\n\nEach edit type has specific handling logic in `NotebookTextModel._doApplyEdits()`.\n\nSources: [src/vs/workbench/contrib/notebook/common/notebookCommon.ts:462-571]()\n\n## Transient Options\n\n`TransientOptions` configure which parts of the notebook are transient (not persisted to disk):\n\n### Transient Configuration Structure\n\n```mermaid\ngraph TB\n    TransientOptions[\"TransientOptions\"]\n    \n    TransientOutputs[\"transientOutputs: boolean\u003cbr/\u003eSkip saving cell outputs\"]\n    \n    TransientCellMeta[\"transientCellMetadata:\u003cbr/\u003eTransientCellMetadata\u003cbr/\u003eRecord\u003ckeyof NotebookCellMetadata, boolean\u003e\"]\n    \n    TransientDocMeta[\"transientDocumentMetadata:\u003cbr/\u003eTransientDocumentMetadata\u003cbr/\u003eRecord\u003ckeyof NotebookDocumentMetadata, boolean\u003e\"]\n    \n    CellContentMeta[\"cellContentMetadata:\u003cbr/\u003eCellContentMetadata\u003cbr/\u003eMetadata that affects content hash\"]\n    \n    TransientOptions --\u003e TransientOutputs\n    TransientOptions --\u003e TransientCellMeta\n    TransientOptions --\u003e TransientDocMeta\n    TransientOptions --\u003e CellContentMeta\n```\n\n**Purpose and Usage:**\n\n- **transientOutputs**: When `true`, outputs are not saved to disk (useful for large outputs)\n- **transientCellMetadata**: Specifies which cell metadata keys should not be persisted\n- **transientDocumentMetadata**: Specifies which document metadata keys should not be persisted  \n- **cellContentMetadata**: Metadata keys that affect the content hash (dirty state)\n\nThese options are provided by the notebook serializer (via extensions) and affect:\n- What triggers the dirty state\n- What appears in notebook diffs\n- What gets written during save operations\n\nSources: [src/vs/workbench/contrib/notebook/common/notebookCommon.ts:156-161]()\n\n## Snapshots and Serialization\n\n### Creating Snapshots\n\n`NotebookTextModel.createSnapshot()` creates a `NotebookData` snapshot for serialization:\n\n```mermaid\nsequenceDiagram\n    participant Client\n    participant Model as NotebookTextModel\n    participant Options as INotebookSnapshotOptions\n    participant Cell as NotebookCellTextModel\n    \n    Client-\u003e\u003eModel: createSnapshot(options)\n    Model-\u003e\u003eOptions: Check transientOutputs\n    Model-\u003e\u003eOptions: Check outputSizeLimit\n    \n    loop For each cell\n        Model-\u003e\u003eCell: getValue() (text content)\n        Model-\u003e\u003eCell: Get language, cellKind, metadata\n        \n        alt Cell is code \u0026\u0026 !transientOutputs\n            Model-\u003e\u003eCell: Get outputs array\n            \n            loop For each output\n                Model-\u003e\u003eModel: Check output size vs limit\n                \n                alt Size \u003e limit\n                    Model-\u003e\u003eModel: Skip large output\n                else Size OK\n                    Model-\u003e\u003eModel: Include output in snapshot\n                end\n            end\n        end\n        \n        Model-\u003e\u003eModel: Filter cell metadata (transientCellMetadata)\n        Model-\u003e\u003eModel: Build ICellDto2\n    end\n    \n    Model-\u003e\u003eModel: Filter document metadata (transientDocumentMetadata)\n    Model--\u003e\u003eClient: Return NotebookData\n```\n\nThe snapshot process:\n1. Iterates through all cells\n2. Applies transient options to filter metadata\n3. Checks output sizes against limits\n4. Builds `ICellDto2` objects with cell content and metadata\n5. Constructs `NotebookData` with cells and document metadata\n\nSources: [src/vs/workbench/contrib/notebook/common/model/notebookTextModel.ts:751-900]()\n\n### Restoring from Snapshot\n\n`restoreSnapshot()` replaces the entire notebook content with a snapshot:\n\n1. Disposes existing cells\n2. Creates new `NotebookCellTextModel` instances from snapshot data\n3. Replaces the cells array\n4. Updates document metadata\n5. Resets version ID\n6. Fires change events\n\nThis operation is used when:\n- Reverting unsaved changes\n- Reloading a notebook from disk\n- Restoring from backup\n\nSources: [src/vs/workbench/contrib/notebook/common/model/notebookTextModel.ts:900-1000]()\n\n## Cell Search and Finding\n\n`NotebookTextModel` provides search functionality within cells through the `find()` method:\n\n### Find Implementation\n\n```mermaid\ngraph TB\n    find[\"find(target, options)\"]\n    \n    CreateSearch[\"Create SearchParams\u003cbr/\u003efrom target string/regex\"]\n    \n    FilterOptions[\"Apply INotebookFindOptions\u003cbr/\u003eincludeMarkupInput\u003cbr/\u003eincludeMarkupPreview\u003cbr/\u003eincludeCodeInput\u003cbr/\u003eincludeOutput\"]\n    \n    IterateCells[\"Iterate cells\"]\n    \n    SearchCell[\"cell.find(target)\u003cbr/\u003eSearch in TextModel\"]\n    \n    BuildMatch[\"Build CellFindMatch\u003cbr/\u003ewith cell metadata\"]\n    \n    find --\u003e CreateSearch\n    CreateSearch --\u003e FilterOptions\n    FilterOptions --\u003e IterateCells\n    IterateCells --\u003e SearchCell\n    SearchCell --\u003e BuildMatch\n    BuildMatch --\u003e Results[\"Return CellFindMatch[]\"]\n```\n\nThe search functionality:\n- Supports both string and regex patterns\n- Can filter by cell type (markup/code)\n- Searches in cell text content\n- Returns `CellFindMatch` objects with:\n  - Cell metadata (handle, URI, kind)\n  - Match ranges within the cell\n  - Match index\n\nSources: [src/vs/workbench/contrib/notebook/common/model/notebookTextModel.ts:1334-1450]()\n\n## Working Copy Integration\n\n`NotebookTextModel` integrates with VS Code's working copy system through wrapper classes:\n\n### Working Copy Model Architecture\n\n```mermaid\ngraph TB\n    subgraph \"Working Copy System\"\n        StoredWC[\"IStoredFileWorkingCopy\u003cbr/\u003e(Saved file)\"]\n        UntitledWC[\"IUntitledFileWorkingCopy\u003cbr/\u003e(Unsaved file)\"]\n    end\n    \n    subgraph \"Notebook Model Wrapper\"\n        WorkingCopyModel[\"NotebookFileWorkingCopyModel\u003cbr/\u003eIStoredFileWorkingCopyModel or\u003cbr/\u003eIUntitledFileWorkingCopyModel\"]\n    end\n    \n    subgraph \"Notebook Data Model\"\n        NotebookModel[\"NotebookTextModel\"]\n    end\n    \n    subgraph \"Serialization\"\n        Serializer[\"INotebookSerializer\u003cbr/\u003e(Extension-provided)\"]\n    end\n    \n    StoredWC --\u003e|model property| WorkingCopyModel\n    UntitledWC --\u003e|model property| WorkingCopyModel\n    \n    WorkingCopyModel --\u003e|notebookModel property| NotebookModel\n    \n    WorkingCopyModel --\u003e|save()| Serializer\n    Serializer --\u003e|notebookToData()| VSBuffer[\"VSBuffer\u003cbr/\u003e(Serialized bytes)\"]\n    \n    WorkingCopyModel --\u003e|snapshot()| NotebookModel\n    NotebookModel --\u003e|createSnapshot()| NotebookData[\"NotebookData\"]\n```\n\n**NotebookFileWorkingCopyModel** responsibilities:\n\n- Implements `IStoredFileWorkingCopyModel` or `IUntitledFileWorkingCopyModel`\n- Wraps `NotebookTextModel` as the underlying data model\n- Handles save operations via `INotebookSerializer`\n- Manages backup and restore\n- Tracks dirty state\n- Provides snapshot for comparisons\n\nSources: [src/vs/workbench/contrib/notebook/common/notebookEditorModel.ts:60-500]()\n\n### Model Lifecycle\n\n**Creation Flow:**\n\n```mermaid\nsequenceDiagram\n    participant Resolver as NotebookModelResolverService\n    participant Manager as IFileWorkingCopyManager\n    participant Factory as NotebookFileWorkingCopyModelFactory\n    participant Serializer as INotebookSerializer\n    participant Model as NotebookTextModel\n    \n    Resolver-\u003e\u003eManager: resolve(resource)\n    Manager-\u003e\u003eFactory: createModel()\n    \n    alt File exists\n        Factory-\u003e\u003eSerializer: dataToNotebook(fileContent)\n        Serializer--\u003e\u003eFactory: NotebookData\n    else New file\n        Factory-\u003e\u003eFactory: Use default NotebookData\n    end\n    \n    Factory-\u003e\u003eModel: new NotebookTextModel(viewType, uri)\n    Model-\u003e\u003eModel: reset(cells, metadata, transientOptions)\n    \n    Factory--\u003e\u003eManager: NotebookFileWorkingCopyModel\n    Manager--\u003e\u003eResolver: Working copy reference\n```\n\n**Disposal:**\n\nWhen a notebook model is disposed:\n1. Working copy model is disposed\n2. `NotebookTextModel._dispose()` is called\n3. All cells are disposed (triggers `NotebookCellTextModel.dispose()`)\n4. Cell text models are disposed\n5. Event listeners are cleaned up\n6. The model is marked as disposed\n\nSources: [src/vs/workbench/contrib/notebook/common/notebookEditorModelResolverServiceImpl.ts](), [src/vs/workbench/contrib/notebook/common/model/notebookTextModel.ts:200-300]()\n\n## Event Flow\n\n### Content Change Events\n\n```mermaid\nsequenceDiagram\n    participant Client\n    participant Model as NotebookTextModel\n    participant Cell as NotebookCellTextModel\n    participant Listeners\n    \n    Client-\u003e\u003eModel: applyEdits([edits], synchronous, beginState, endStateComputer)\n    \n    Model-\u003e\u003eModel: Begin edit transaction\n    Model-\u003e\u003eModel: Create StackOperation\n    \n    loop For each edit\n        Model-\u003e\u003eModel: Process edit\n        \n        alt Cell content edit\n            Model-\u003e\u003eCell: Update cell\n            Cell-\u003e\u003eCell: Fire onDidChangeContent\n        end\n        \n        Model-\u003e\u003eModel: Add to raw events\n    end\n    \n    Model-\u003e\u003eModel: Compute end selection state\n    Model-\u003e\u003eModel: Push to undo/redo stack\n    Model-\u003e\u003eModel: Increment versionId\n    \n    Model-\u003e\u003eModel: Create NotebookTextModelChangedEvent\n    Note over Model: Event contains:\u003cbr/\u003e- rawEvents[]\u003cbr/\u003e- versionId\u003cbr/\u003e- synchronous\u003cbr/\u003e- endSelectionState\n    \n    Model-\u003e\u003eListeners: onDidChangeContent.fire(event)\n```\n\nThe change event provides:\n- **rawEvents**: Granular changes (splices, moves, metadata updates)\n- **versionId**: New version number for tracking\n- **synchronous**: Whether change was applied synchronously\n- **endSelectionState**: Final selection state after all edits\n\nSources: [src/vs/workbench/contrib/notebook/common/model/notebookTextModel.ts:574-850]()\n\n### Output Change Events\n\n```mermaid\nsequenceDiagram\n    participant Kernel\n    participant Cell as NotebookCellTextModel\n    participant Output as NotebookCellOutputTextModel\n    participant Model as NotebookTextModel\n    participant UI\n    \n    Kernel-\u003e\u003eCell: spliceNotebookCellOutputs(splice)\n    \n    Cell-\u003e\u003eCell: Apply splice to outputs array\n    \n    alt New outputs created\n        Cell-\u003e\u003eOutput: new NotebookCellOutputTextModel()\n    end\n    \n    Cell-\u003e\u003eCell: Create NotebookCellOutputsSplice event\n    Cell-\u003e\u003eCell: Fire onDidChangeOutputs\n    \n    Cell-\u003e\u003eModel: Notify via cell change\n    \n    Model-\u003e\u003eModel: Create NotebookOutputChangedEvent\n    Model-\u003e\u003eModel: Add to raw events\n    Model-\u003e\u003eModel: Fire onDidChangeContent\n    \n    Model-\u003e\u003eUI: UI receives change notification\n    UI-\u003e\u003eUI: Update output rendering\n```\n\nOutput changes flow through both cell-level and notebook-level events to ensure all listeners are notified.\n\nSources: [src/vs/workbench/contrib/notebook/common/model/notebookCellTextModel.ts:300-450]()\n\n## Summary\n\nThe Notebook Data Model provides a robust, event-driven architecture for managing notebook documents:\n\n| Component | File | Responsibility |\n|-----------|------|---------------|\n| `NotebookTextModel` | [notebookTextModel.ts]() | Root document model, cell collection, coordinated edits |\n| `NotebookCellTextModel` | [notebookCellTextModel.ts]() | Individual cell content, outputs, metadata |\n| `NotebookCellOutputTextModel` | [notebookCellOutputTextModel.ts]() | Cell execution outputs with versioning |\n| `StackOperation` | [notebookTextModel.ts:33-151]() | Groups edits for undo/redo |\n| `TransientOptions` | [notebookCommon.ts:156-161]() | Configuration for transient data |\n| `NotebookFileWorkingCopyModel` | [notebookEditorModel.ts]() | Working copy integration for save/revert |\n\nThe data model layer is independent of UI concerns and provides a clean API for:\n- Programmatic cell and document manipulation\n- Comprehensive undo/redo support\n- Efficient serialization and persistence\n- Granular change notifications\n- Multi-cell batch operations\n- Integration with Monaco text models\n\nSources: [src/vs/workbench/contrib/notebook/common/model/notebookTextModel.ts](), [src/vs/workbench/contrib/notebook/common/model/notebookCellTextModel.ts](), [src/vs/workbench/contrib/notebook/common/notebookCommon.ts]()"])</script><script>self.__next_f.push([1,"44:T6ae3,"])</script><script>self.__next_f.push([1,"# Cell Outputs and WebView Rendering\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [extensions/markdown-language-features/notebook/index.ts](extensions/markdown-language-features/notebook/index.ts)\n- [src/vs/workbench/api/browser/mainThreadNotebook.ts](src/vs/workbench/api/browser/mainThreadNotebook.ts)\n- [src/vs/workbench/api/common/extHostNotebook.ts](src/vs/workbench/api/common/extHostNotebook.ts)\n- [src/vs/workbench/contrib/notebook/browser/media/notebook.css](src/vs/workbench/contrib/notebook/browser/media/notebook.css)\n- [src/vs/workbench/contrib/notebook/browser/notebook.contribution.ts](src/vs/workbench/contrib/notebook/browser/notebook.contribution.ts)\n- [src/vs/workbench/contrib/notebook/browser/notebookBrowser.ts](src/vs/workbench/contrib/notebook/browser/notebookBrowser.ts)\n- [src/vs/workbench/contrib/notebook/browser/notebookEditor.ts](src/vs/workbench/contrib/notebook/browser/notebookEditor.ts)\n- [src/vs/workbench/contrib/notebook/browser/notebookEditorWidget.ts](src/vs/workbench/contrib/notebook/browser/notebookEditorWidget.ts)\n- [src/vs/workbench/contrib/notebook/browser/view/notebookCellList.ts](src/vs/workbench/contrib/notebook/browser/view/notebookCellList.ts)\n- [src/vs/workbench/contrib/notebook/browser/view/renderers/backLayerWebView.ts](src/vs/workbench/contrib/notebook/browser/view/renderers/backLayerWebView.ts)\n- [src/vs/workbench/contrib/notebook/browser/view/renderers/cellRenderer.ts](src/vs/workbench/contrib/notebook/browser/view/renderers/cellRenderer.ts)\n- [src/vs/workbench/contrib/notebook/browser/view/renderers/webviewMessages.ts](src/vs/workbench/contrib/notebook/browser/view/renderers/webviewMessages.ts)\n- [src/vs/workbench/contrib/notebook/browser/view/renderers/webviewPreloads.ts](src/vs/workbench/contrib/notebook/browser/view/renderers/webviewPreloads.ts)\n- [src/vs/workbench/contrib/notebook/browser/viewModel/baseCellViewModel.ts](src/vs/workbench/contrib/notebook/browser/viewModel/baseCellViewModel.ts)\n- [src/vs/workbench/contrib/notebook/browser/viewModel/codeCellViewModel.ts](src/vs/workbench/contrib/notebook/browser/viewModel/codeCellViewModel.ts)\n- [src/vs/workbench/contrib/notebook/browser/viewModel/markupCellViewModel.ts](src/vs/workbench/contrib/notebook/browser/viewModel/markupCellViewModel.ts)\n- [src/vs/workbench/contrib/notebook/common/model/notebookCellTextModel.ts](src/vs/workbench/contrib/notebook/common/model/notebookCellTextModel.ts)\n- [src/vs/workbench/contrib/notebook/common/model/notebookTextModel.ts](src/vs/workbench/contrib/notebook/common/model/notebookTextModel.ts)\n- [src/vs/workbench/contrib/notebook/common/notebookCommon.ts](src/vs/workbench/contrib/notebook/common/notebookCommon.ts)\n- [src/vs/workbench/contrib/notebook/common/notebookEditorModel.ts](src/vs/workbench/contrib/notebook/common/notebookEditorModel.ts)\n- [src/vs/workbench/contrib/notebook/common/notebookService.ts](src/vs/workbench/contrib/notebook/common/notebookService.ts)\n\n\u003c/details\u003e\n\n\n\nThis document describes how notebook cell outputs are rendered in VS Code using the webview-based rendering system. Cell outputs (such as images, HTML, plots, and rich media) are rendered in an isolated webview iframe that sits \"behind\" the cell list, providing a secure and flexible rendering environment.\n\nFor information about the overall notebook architecture, see [Notebook Architecture Overview](#9.1). For details on the notebook data model and cell structures, see [Notebook Data Model](#9.3).\n\n---\n\n## Architecture Overview\n\nThe output rendering system uses a layered architecture where outputs are rendered in a webview positioned behind the cell list. This design provides security isolation and allows for rich, interactive output rendering.\n\n```mermaid\ngraph TB\n    subgraph \"Notebook Editor (Main Process)\"\n        NotebookEditorWidget[\"NotebookEditorWidget\"]\n        NotebookCellList[\"NotebookCellList\"]\n        CodeCellViewModel[\"CodeCellViewModel\"]\n        CellOutputViewModel[\"CellOutputViewModel\"]\n    end\n    \n    subgraph \"WebView Layer\"\n        BackLayerWebView[\"BackLayerWebView\"]\n        IWebviewElement[\"IWebviewElement\u003cbr/\u003e(iframe)\"]\n    end\n    \n    subgraph \"WebView Content (iframe)\"\n        WebviewPreloads[\"webviewPreloads.ts\u003cbr/\u003e(Preload Script)\"]\n        OutputRenderers[\"Output Renderers\u003cbr/\u003e(extension-provided)\"]\n        OutputDOM[\"Output DOM Elements\"]\n    end\n    \n    NotebookEditorWidget --\u003e|creates \u0026 manages| BackLayerWebView\n    NotebookEditorWidget --\u003e|contains| NotebookCellList\n    NotebookCellList --\u003e|displays| CodeCellViewModel\n    CodeCellViewModel --\u003e|contains| CellOutputViewModel\n    \n    BackLayerWebView --\u003e|owns| IWebviewElement\n    BackLayerWebView --\u003e|sends messages| WebviewPreloads\n    BackLayerWebView --\u003e|tracks with insetMapping| CellOutputViewModel\n    \n    IWebviewElement --\u003e|executes| WebviewPreloads\n    WebviewPreloads --\u003e|invokes| OutputRenderers\n    OutputRenderers --\u003e|creates| OutputDOM\n    \n    WebviewPreloads --\u003e|dimension updates\u003cbr/\u003euser events| BackLayerWebView\n```\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/notebookEditorWidget.ts:200-210](), [src/vs/workbench/contrib/notebook/browser/view/renderers/backLayerWebView.ts:129-160]()\n\n---\n\n## BackLayerWebView System\n\nThe `BackLayerWebView` class is the core coordinator for output rendering. It manages the webview lifecycle, output tracking, and communication between the notebook editor and the isolated webview environment.\n\n### Key Components\n\n```mermaid\ngraph LR\n    BackLayerWebView[\"BackLayerWebView\u0026lt;T\u0026gt;\"]\n    \n    subgraph \"Output Tracking\"\n        InsetMapping[\"insetMapping\u003cbr/\u003eMap\u0026lt;IDisplayOutputViewModel, ICachedInset\u0026gt;\"]\n        ReversedMapping[\"reversedInsetMapping\u003cbr/\u003eMap\u0026lt;outputId, IDisplayOutputViewModel\u0026gt;\"]\n        PendingMapping[\"pendingWebviewIdleInsetMapping\u003cbr/\u003e(for lazy creation)\"]\n    end\n    \n    subgraph \"WebView Management\"\n        IWebviewElement2[\"webview: IWebviewElement\"]\n        MarkupPreviewMapping[\"markupPreviewMapping\u003cbr/\u003e(for markdown cells)\"]\n    end\n    \n    subgraph \"Renderer Metadata\"\n        PreloadsCache[\"_preloadsCache\u003cbr/\u003eSet\u0026lt;preload URIs\u0026gt;\"]\n        RendererData[\"getRendererData()\u003cbr/\u003e(available renderers)\"]\n    end\n    \n    BackLayerWebView --\u003e InsetMapping\n    BackLayerWebView --\u003e ReversedMapping\n    BackLayerWebView --\u003e PendingMapping\n    BackLayerWebView --\u003e IWebviewElement2\n    BackLayerWebView --\u003e MarkupPreviewMapping\n    BackLayerWebView --\u003e PreloadsCache\n    BackLayerWebView --\u003e RendererData\n```\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/view/renderers/backLayerWebView.ts:129-160](), [src/vs/workbench/contrib/notebook/browser/view/renderers/backLayerWebView.ts:140-148]()\n\n### ICachedInset Structure\n\nEach rendered output is tracked as an `ICachedInset`:\n\n| Field | Type | Purpose |\n|-------|------|---------|\n| `outputId` | `string` | Unique identifier for the output |\n| `versionId` | `number` | Version tracking for updates |\n| `cellInfo` | `ICommonCellInfo` | Reference to parent cell |\n| `renderer` | `INotebookRendererInfo` | Renderer that handles this output |\n| `cachedCreation` | `ICreationRequestMessage` | Creation parameters for the output |\n| `initialized` | `boolean` | Whether output has reported dimensions |\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/view/renderers/backLayerWebView.ts:66-73]()\n\n### WebView Initialization\n\nThe webview is created and initialized with generated HTML content:\n\n```mermaid\nsequenceDiagram\n    participant NW as NotebookEditorWidget\n    participant BLW as BackLayerWebView\n    participant WS as IWebviewService\n    participant WV as IWebviewElement\n    participant Preloads as webviewPreloads\n\n    NW-\u003e\u003eBLW: createWebview(targetWindow)\n    BLW-\u003e\u003eBLW: generateContent(baseUrl)\n    Note over BLW: Generates HTML with:\u003cbr/\u003e- CSP headers\u003cbr/\u003e- Renderer metadata\u003cbr/\u003e- Preload scripts\u003cbr/\u003e- Tokenization CSS\n    BLW-\u003e\u003eWS: createWebview()\n    WS-\u003e\u003eWV: create iframe\n    BLW-\u003e\u003eWV: setHtml(content)\n    WV-\u003e\u003ePreloads: execute preload script\n    Preloads-\u003e\u003eBLW: postMessage({type: 'initialized'})\n    BLW-\u003e\u003eBLW: initializeWebViewState()\n```\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/view/renderers/backLayerWebView.ts:550-604](), [src/vs/workbench/contrib/notebook/browser/view/renderers/backLayerWebView.ts:290-500]()\n\n---\n\n## WebView Content and Preloads\n\nThe webview iframe runs an isolated JavaScript environment defined by the preload script. This script sets up the rendering infrastructure, manages output lifecycle, and communicates with the main process.\n\n### Preload Context\n\nThe preload receives initialization context:\n\n```mermaid\ngraph TB\n    PreloadContext[\"PreloadContext\"]\n    \n    subgraph \"Style Configuration\"\n        PreloadStyles[\"style: PreloadStyles\u003cbr/\u003e- outputNodePadding\u003cbr/\u003e- outputNodeLeftPadding\u003cbr/\u003e- tokenizationCss\"]\n    end\n    \n    subgraph \"Options\"\n        PreloadOpts[\"options: PreloadOptions\u003cbr/\u003e- dragAndDropEnabled\"]\n        RenderOpts[\"renderOptions: RenderOptions\u003cbr/\u003e- lineLimit\u003cbr/\u003e- outputScrolling\u003cbr/\u003e- outputWordWrap\u003cbr/\u003e- linkifyFilePaths\u003cbr/\u003e- minimalError\"]\n    end\n    \n    subgraph \"Renderer Information\"\n        RendererMetadata[\"rendererData: RendererMetadata[]\u003cbr/\u003e- renderer id, entrypoint\u003cbr/\u003e- mimeTypes\u003cbr/\u003e- messaging capabilities\"]\n        StaticPreloads[\"staticPreloadsData\u003cbr/\u003e(notebook-level preloads)\"]\n    end\n    \n    PreloadContext --\u003e PreloadStyles\n    PreloadContext --\u003e PreloadOpts\n    PreloadContext --\u003e RenderOpts\n    PreloadContext --\u003e RendererMetadata\n    PreloadContext --\u003e StaticPreloads\n```\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/view/renderers/webviewPreloads.ts:77-86](), [src/vs/workbench/contrib/notebook/browser/view/renderers/webviewPreloads.ts:64-76]()\n\n### Output Container Structure\n\nOutputs are rendered into a structured DOM hierarchy:\n\n```\n#container (root)\n .cell_container (per cell)\n     .output_container (per output)\n        .output (actual output content)\n            [renderer-specific DOM]\n     .preview (for markdown cells)\n```\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/view/renderers/backLayerWebView.ts:339-363]()\n\n### Renderer API\n\nThe preload exposes a renderer API to extension-provided renderers:\n\n```typescript\ninterface RendererContext {\n    getState(outputId: string): any;\n    setState(outputId: string, state: any): void;\n    postMessage(message: any): void;\n    onDidReceiveMessage: Event\u003cany\u003e;\n    workspace: { isTrusted: boolean };\n    settings: { lineLimit: number; ... };\n}\n```\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/view/renderers/webviewPreloads.ts:600-800]()\n\n---\n\n## Message Protocol\n\nCommunication between the notebook editor and webview uses a strongly-typed message protocol.\n\n### Messages TO Webview\n\n```mermaid\ngraph TB\n    ToWebview[\"ToWebviewMessage\"]\n    \n    subgraph \"Output Management\"\n        CreateOutput[\"ICreationRequestMessage\u003cbr/\u003e- outputId, cellId\u003cbr/\u003e- mimeType, data\u003cbr/\u003e- renderer info\"]\n        ShowOutput[\"IShowOutputMessage\u003cbr/\u003e- outputId, top position\"]\n        HideOutput[\"IHideOutputMessage\u003cbr/\u003e- outputId\"]\n        ClearOutput[\"IClearOutputMessage\u003cbr/\u003e- rendererId, cellId\"]\n        UpdateOutput[\"IUpdateOutputMessage\u003cbr/\u003e- updated MIME data\"]\n    end\n    \n    subgraph \"Cell Management\"\n        ShowMarkup[\"IMarkupCellInitialization\u003cbr/\u003e- cellId, content\u003cbr/\u003e- metadata\"]\n        HideMarkup[\"IHideMarkupCell\u003cbr/\u003e- cellIds[]\"]\n        DeleteCell[\"IDeleteCellMessage\u003cbr/\u003e- cellIds[]\"]\n    end\n    \n    subgraph \"Configuration\"\n        NotebookStyles[\"INotebookStylesMessage\u003cbr/\u003e- CSS variables\"]\n        NotebookOptions[\"INotebookOptionsMessage\u003cbr/\u003e- drag/drop, scrolling\"]\n        UpdateMetadata[\"IUpdateCellMetadataMessage\u003cbr/\u003e- cellId, metadata\"]\n    end\n    \n    ToWebview --\u003e CreateOutput\n    ToWebview --\u003e ShowOutput\n    ToWebview --\u003e HideOutput\n    ToWebview --\u003e ClearOutput\n    ToWebview --\u003e UpdateOutput\n    ToWebview --\u003e ShowMarkup\n    ToWebview --\u003e HideMarkup\n    ToWebview --\u003e DeleteCell\n    ToWebview --\u003e NotebookStyles\n    ToWebview --\u003e NotebookOptions\n    ToWebview --\u003e UpdateMetadata\n```\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/view/renderers/webviewMessages.ts:130-350]()\n\n### Messages FROM Webview\n\n```mermaid\ngraph TB\n    FromWebview[\"FromWebviewMessage\"]\n    \n    subgraph \"Dimension Reporting\"\n        Dimension[\"IDimensionMessage\u003cbr/\u003e- outputId, height\u003cbr/\u003e- init flag\"]\n    end\n    \n    subgraph \"User Interaction\"\n        OutputFocus[\"IOutputFocusMessage\u003cbr/\u003e- outputId\"]\n        OutputBlur[\"IOutputBlurMessage\u003cbr/\u003e- outputId\"]\n        MouseEnter[\"IMouseEnterMessage\"]\n        MouseLeave[\"IMouseLeaveMessage\"]\n        InputFocus[\"IOutputInputFocusMessage\u003cbr/\u003e- inputFocused flag\"]\n    end\n    \n    subgraph \"Navigation\"\n        ClickLink[\"IClickedLinkMessage\u003cbr/\u003e- href\"]\n        ScrollToReveal[\"IScrollToRevealMessage\u003cbr/\u003e- scrollTop\"]\n        FocusEditor[\"IFocusEditorMessage\u003cbr/\u003e- cellId, focusNext\"]\n    end\n    \n    subgraph \"Renderer Communication\"\n        CustomMessage[\"ICustomRendererMessage\u003cbr/\u003e- rendererId, message\"]\n        CustomKernelMsg[\"ICustomKernelMessage\u003cbr/\u003e- kernel message\"]\n    end\n    \n    FromWebview --\u003e Dimension\n    FromWebview --\u003e OutputFocus\n    FromWebview --\u003e OutputBlur\n    FromWebview --\u003e MouseEnter\n    FromWebview --\u003e MouseLeave\n    FromWebview --\u003e InputFocus\n    FromWebview --\u003e ClickLink\n    FromWebview --\u003e ScrollToReveal\n    FromWebview --\u003e FocusEditor\n    FromWebview --\u003e CustomMessage\n    FromWebview --\u003e CustomKernelMsg\n```\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/view/renderers/webviewMessages.ts:14-128]()\n\n---\n\n## Output Rendering Pipeline\n\nThe complete flow from cell execution to rendered output involves multiple stages and components.\n\n### End-to-End Rendering Flow\n\n```mermaid\nsequenceDiagram\n    participant Kernel as Notebook Kernel\n    participant Cell as CodeCellViewModel\n    participant Output as CellOutputViewModel\n    participant Editor as NotebookEditorWidget\n    participant BLW as BackLayerWebView\n    participant WV as WebView (iframe)\n    participant Renderer as Output Renderer\n\n    Kernel-\u003e\u003eCell: execution complete\u003cbr/\u003ewith outputs\n    Cell-\u003e\u003eCell: model.replaceOutputs()\n    Cell-\u003e\u003eOutput: create CellOutputViewModel\n    Output-\u003e\u003eOutput: resolveMimeTypes()\n    Note over Output: Determines best MIME type\u003cbr/\u003eand renderer to use\n    \n    Editor-\u003e\u003eBLW: createOutput(output)\n    BLW-\u003e\u003eBLW: Add to insetMapping\n    BLW-\u003e\u003eBLW: Check if idle render\n    \n    alt Immediate Render\n        BLW-\u003e\u003eWV: postMessage(ICreationRequestMessage)\n        WV-\u003e\u003eWV: createElement(outputId)\n        WV-\u003e\u003eRenderer: render({ mimeType, data })\n        Renderer-\u003e\u003eWV: creates DOM content\n        WV-\u003e\u003eWV: ResizeObserver detects size\n        WV-\u003e\u003eBLW: postMessage(IDimensionMessage)\n        BLW-\u003e\u003eEditor: updateOutputHeight()\n        Editor-\u003e\u003eEditor: relayout cell list\n    else Idle Render (lazy)\n        BLW-\u003e\u003eBLW: Add to pendingWebviewIdleInsetMapping\n        Note over BLW: Render deferred until\u003cbr/\u003eoutput scrolls into view\n    end\n```\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/view/renderers/backLayerWebView.ts:1000-1100](), [src/vs/workbench/contrib/notebook/browser/view/renderers/webviewPreloads.ts:1200-1400]()\n\n### Output Creation Request\n\nThe `ICreationRequestMessage` contains all data needed to render an output:\n\n```typescript\ninterface ICreationRequestMessage {\n    type: 'html' | 'createOutput';\n    cellId: string;\n    cellTop: number;\n    outputId: string;\n    left?: number;\n    requiredPreloads?: string[];  // Additional scripts to load\n    \n    // For HTML outputs\n    content?: string;\n    \n    // For extension-rendered outputs\n    apiNamespace?: string;         // 'vscode-notebook-renderer'\n    mimeType?: string;             // e.g., 'application/json'\n    valueBytes?: Uint8Array;       // Output data\n    rendererId?: string;           // Renderer extension ID\n    metadata?: { [key: string]: any };\n}\n```\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/view/renderers/webviewMessages.ts:200-250]()\n\n---\n\n## Renderer Integration\n\nVS Code supports custom output renderers provided by extensions. These renderers implement a standardized API to render specific MIME types.\n\n### Renderer Lifecycle\n\n```mermaid\ngraph TB\n    subgraph \"Renderer Discovery\"\n        ExtensionContrib[\"Extension contributes\u003cbr/\u003enotebookRenderer in package.json\"]\n        NotebookService[\"INotebookService\u003cbr/\u003egetRenderers()\"]\n        RendererInfo[\"INotebookRendererInfo\u003cbr/\u003e- id, mimeTypes\u003cbr/\u003e- entrypoint path\u003cbr/\u003e- messaging spec\"]\n    end\n    \n    subgraph \"Renderer Loading\"\n        RendererMetadata[\"RendererMetadata\u003cbr/\u003e(sent to webview)\"]\n        WebViewLoad[\"WebView loads renderer script\"]\n        RendererActivation[\"activationFunction(ctx)\"]\n    end\n    \n    subgraph \"Renderer Usage\"\n        RenderCall[\"render(context)\"]\n        OutputElement[\"Returns HTMLElement\u003cbr/\u003eor updates existing\"]\n        StateManagement[\"Uses setState/getState\u003cbr/\u003efor persistence\"]\n    end\n    \n    ExtensionContrib --\u003e NotebookService\n    NotebookService --\u003e RendererInfo\n    RendererInfo --\u003e RendererMetadata\n    RendererMetadata --\u003e WebViewLoad\n    WebViewLoad --\u003e RendererActivation\n    RendererActivation --\u003e RenderCall\n    RenderCall --\u003e OutputElement\n    RenderCall --\u003e StateManagement\n```\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/view/renderers/backLayerWebView.ts:502-516](), [src/vs/workbench/contrib/notebook/browser/view/renderers/webviewPreloads.ts:1500-1700]()\n\n### Renderer Selection\n\nOutputs can have multiple MIME type representations. The selection process:\n\n1. **MIME Type Resolution**: `CellOutputViewModel.resolveMimeTypes()` ranks available MIME types\n2. **Kernel Consideration**: Prefers MIME types that match kernel-provided types\n3. **User Preference**: Respects user's preferred renderer via `MimeTypeDisplayOrder`\n4. **Renderer Availability**: Checks if renderer extension is installed and active\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/viewModel/cellOutputViewModel.ts:80-150]()\n\n### Built-in vs Extension Renderers\n\n| Renderer Type | Handling | Examples |\n|---------------|----------|----------|\n| **Built-in HTML** | Rendered directly by webview preload | `text/html`, `image/png`, `image/jpeg` |\n| **Built-in Text** | Formatted by preload with syntax highlighting | `text/plain`, `application/json` |\n| **Extension Renderers** | Loaded from extension and invoked | Plotly, Vega, custom visualizations |\n| **Fallback** | Plain text representation | Used when no renderer available |\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/view/renderers/webviewPreloads.ts:1800-2000]()\n\n---\n\n## Output Lifecycle Management\n\nOutputs are created, updated, hidden, and disposed throughout the notebook editing session.\n\n### Output State Transitions\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e Pending: Cell execution starts\n    Pending --\u003e Creating: Output data received\n    Creating --\u003e Rendering: Send to webview\n    Rendering --\u003e Initialized: Dimensions reported\n    Initialized --\u003e Visible: Scrolled into view\n    Visible --\u003e Hidden: Scrolled out of view\n    Hidden --\u003e Visible: Scrolled back\n    Initialized --\u003e Updated: Output data changed\n    Updated --\u003e Rendering: Re-render\n    Visible --\u003e Disposing: Cell/output removed\n    Hidden --\u003e Disposing: Cell/output removed\n    Disposing --\u003e [*]\n```\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/view/renderers/backLayerWebView.ts:140-148]()\n\n### Lazy Output Rendering\n\nTo optimize performance, outputs outside the viewport are rendered lazily:\n\n```mermaid\nsequenceDiagram\n    participant CellList as NotebookCellList\n    participant BLW as BackLayerWebView\n    participant WV as WebView\n    \n    Note over BLW: Output created but\u003cbr/\u003enot in viewport\n    BLW-\u003e\u003eBLW: Add to pendingWebviewIdleInsetMapping\n    \n    Note over CellList: User scrolls\n    CellList-\u003e\u003eCellList: onDidChangeVisibleRanges\n    CellList-\u003e\u003eBLW: Output now in viewport\n    \n    BLW-\u003e\u003eBLW: runWhenIdle(renderOutput)\n    BLW-\u003e\u003eWV: postMessage(ICreationRequestMessage)\n    Note over WV: Render output\n    WV-\u003e\u003eBLW: postMessage(IDimensionMessage)\n    BLW-\u003e\u003eBLW: Move to insetMapping\n    BLW-\u003e\u003eCellList: updateOutputHeight()\n```\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/view/renderers/backLayerWebView.ts:1050-1150](), [src/vs/workbench/contrib/notebook/browser/view/renderers/backLayerWebView.ts:640-660]()\n\n### Output Disposal\n\nWhen outputs are removed:\n\n1. **Editor initiates disposal**: `BackLayerWebView.removeInsets()`\n2. **Clear from mappings**: Remove from `insetMapping` and `reversedInsetMapping`\n3. **Notify webview**: Send `IClearOutputMessage` to remove DOM elements\n4. **Fire event**: Emit `onDidRemoveOutputs` for cleanup\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/view/renderers/backLayerWebView.ts:1300-1350]()\n\n---\n\n## Positioning and Scrolling\n\nThe webview is positioned absolutely behind the cell list and must be synchronized with cell positions.\n\n### Coordinate System\n\nThe webview maintains a virtual coordinate space where each output is positioned relative to its cell:\n\n```\nCell Top (in editor) = cellTopOffset\nOutput Top (in webview) = cellTop + outputOffset\n```\n\n### Synchronization Mechanism\n\n```mermaid\nsequenceDiagram\n    participant CL as NotebookCellList\n    participant NW as NotebookEditorWidget\n    participant BLW as BackLayerWebView\n    participant WV as WebView\n    \n    Note over CL: Cell layout changes\n    CL-\u003e\u003eNW: Cell height updated\n    NW-\u003e\u003eBLW: layoutNotebookCell(cell, height)\n    BLW-\u003e\u003eBLW: Calculate new positions\n    \n    loop For each visible output\n        BLW-\u003e\u003eWV: postMessage(IShowOutputMessage)\u003cbr/\u003e{outputId, top, left}\n    end\n    \n    Note over WV: Update absolute positioning\u003cbr/\u003eof output containers\n    \n    Note over CL: User scrolls\n    CL-\u003e\u003eBLW: updateScrollTop(scrollTop)\n    BLW-\u003e\u003eWV: postMessage(IViewScroll)\u003cbr/\u003e{scrollTop}\n    WV-\u003e\u003eWV: Adjust container position\n```\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/view/renderers/backLayerWebView.ts:1150-1250](), [src/vs/workbench/contrib/notebook/browser/notebookEditorWidget.ts:1500-1600]()\n\n### Webview Boundary\n\nTo prevent infinite scrolling, outputs are constrained within a boundary:\n\n- **Constant**: `NOTEBOOK_WEBVIEW_BOUNDARY = 5000` pixels\n- **Validation**: `validateWebviewBoundary()` checks output is within `[-5000, +10000]` range\n- **Purpose**: Prevents performance issues with extreme scroll positions\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/view/notebookCellList.ts:73-78]()\n\n### Output Position Updates\n\n```typescript\ninterface IShowOutputMessage {\n    type: 'showOutput';\n    outputId: string;\n    cellTop: number;      // Cell's top position in editor\n    outputOffset: number; // Output's offset within cell\n    left: number;         // Horizontal position\n}\n```\n\nThe webview preload calculates final position:\n```javascript\nconst absoluteTop = cellTop + outputOffset;\noutputElement.style.top = `${absoluteTop}px`;\noutputElement.style.left = `${left}px`;\n```\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/view/renderers/webviewMessages.ts:100-110](), [src/vs/workbench/contrib/notebook/browser/view/renderers/webviewPreloads.ts:2500-2600]()\n\n---\n\n## Dimension Reporting and Layout\n\nOutputs must report their dimensions back to the editor for proper layout calculation.\n\n### Dimension Update Flow\n\n```mermaid\nsequenceDiagram\n    participant Renderer as Output Renderer\n    participant RO as ResizeObserver\n    participant Preload as webviewPreloads\n    participant BLW as BackLayerWebView\n    participant Cell as CodeCellViewModel\n    \n    Renderer-\u003e\u003eRenderer: Create output DOM\n    RO-\u003e\u003eRO: Observe output element\n    Note over RO: DOM renders, height calculated\n    RO-\u003e\u003ePreload: onChange([{target, contentRect}])\n    Preload-\u003e\u003ePreload: Collect dimension updates\n    Preload-\u003e\u003eBLW: postMessage(IDimensionMessage)\n    Note over BLW: Process dimension updates\n    BLW-\u003e\u003eCell: updateOutputHeight(height)\n    Cell-\u003e\u003eCell: layoutChange({outputHeight: true})\n    Note over Cell: Triggers cell list relayout\n```\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/view/renderers/webviewPreloads.ts:2000-2100](), [src/vs/workbench/contrib/notebook/browser/view/renderers/backLayerWebView.ts:628-676]()\n\n### Height Acknowledgment\n\nTo prevent layout thrashing, the editor acknowledges dimension updates:\n\n```mermaid\ngraph LR\n    WebView[\"WebView reports\u003cbr/\u003eheight: 250px\"]\n    Editor[\"Editor updates\u003cbr/\u003ecell layout\"]\n    Ack[\"Editor sends\u003cbr/\u003eIAckOutputHeight\"]\n    WebView2[\"WebView confirms\u003cbr/\u003eheight applied\"]\n    \n    WebView --\u003e Editor\n    Editor --\u003e Ack\n    Ack --\u003e WebView2\n```\n\nThis prevents the webview from repeatedly sending the same dimension update.\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/view/renderers/webviewMessages.ts:70-75](), [src/vs/workbench/contrib/notebook/browser/notebookEditorWidget.ts:1800-1850]()\n\n### Output Size Limits\n\nOutputs can be constrained based on configuration:\n\n| Setting | Default | Purpose |\n|---------|---------|---------|\n| `outputLineLimit` | 500 | Maximum lines for text output |\n| `outputScrolling` | false | Enable scrolling within output |\n| `outputWordWrap` | false | Word wrap for text output |\n\nThese settings are passed to the webview via `INotebookOptionsMessage`.\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/view/renderers/webviewPreloads.ts:69-75](), [src/vs/workbench/contrib/notebook/browser/view/renderers/backLayerWebView.ts:245-260]()\n\n---\n\n## Security and Isolation\n\nThe webview provides security boundaries between untrusted output content and the VS Code UI.\n\n### Content Security Policy\n\nThe webview HTML includes CSP headers when enabled:\n\n```html\n\u003cmeta http-equiv=\"Content-Security-Policy\" content=\"\n    default-src 'none';\n    script-src ${webviewGenericCspSource} 'unsafe-inline' 'unsafe-eval';\n    style-src ${webviewGenericCspSource} 'unsafe-inline';\n    img-src ${webviewGenericCspSource} https: http: data:;\n    font-src ${webviewGenericCspSource} https:;\n    connect-src https:;\n    child-src https: data:;\n\"\u003e\n```\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/view/renderers/backLayerWebView.ts:320-330]()\n\n### Resource URI Transformation\n\nResources are transformed to webview-safe URIs:\n\n```typescript\nasWebviewUri(uri: URI, fromExtension?: URI): URI {\n    return asWebviewUri(uri, \n        fromExtension?.scheme === Schemas.vscodeRemote \n            ? { isRemote: true, authority: fromExtension.authority }\n            : undefined\n    );\n}\n```\n\nThis ensures resources are loaded through the webview protocol with appropriate authentication.\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/view/renderers/backLayerWebView.ts:524-526]()\n\n### Workspace Trust\n\nThe webview respects workspace trust settings:\n\n- **Untrusted workspaces**: Renderers receive `workspace.isTrusted = false`\n- **Limited functionality**: Certain renderer features may be disabled\n- **User notification**: Extensions can check trust state and show warnings\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/view/renderers/webviewPreloads.ts:116](), [src/vs/workbench/contrib/notebook/browser/view/renderers/backLayerWebView.ts:309]()"])</script><script>self.__next_f.push([1,"45:T62a8,"])</script><script>self.__next_f.push([1,"# Notebook Extension API\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [extensions/markdown-language-features/notebook/index.ts](extensions/markdown-language-features/notebook/index.ts)\n- [extensions/vscode-api-tests/package.json](extensions/vscode-api-tests/package.json)\n- [extensions/vscode-api-tests/src/singlefolder-tests/chat.test.ts](extensions/vscode-api-tests/src/singlefolder-tests/chat.test.ts)\n- [src/vs/editor/browser/config/charWidthReader.ts](src/vs/editor/browser/config/charWidthReader.ts)\n- [src/vs/editor/browser/editorBrowser.ts](src/vs/editor/browser/editorBrowser.ts)\n- [src/vs/editor/browser/viewParts/minimap/minimap.ts](src/vs/editor/browser/viewParts/minimap/minimap.ts)\n- [src/vs/editor/browser/viewParts/minimap/minimapCharRenderer.ts](src/vs/editor/browser/viewParts/minimap/minimapCharRenderer.ts)\n- [src/vs/editor/browser/viewParts/minimap/minimapCharRendererFactory.ts](src/vs/editor/browser/viewParts/minimap/minimapCharRendererFactory.ts)\n- [src/vs/editor/browser/viewParts/minimap/minimapCharSheet.ts](src/vs/editor/browser/viewParts/minimap/minimapCharSheet.ts)\n- [src/vs/editor/browser/viewParts/minimap/minimapPreBaked.ts](src/vs/editor/browser/viewParts/minimap/minimapPreBaked.ts)\n- [src/vs/editor/browser/widget/codeEditor/codeEditorWidget.ts](src/vs/editor/browser/widget/codeEditor/codeEditorWidget.ts)\n- [src/vs/editor/common/config/editorOptions.ts](src/vs/editor/common/config/editorOptions.ts)\n- [src/vs/editor/common/config/fontInfo.ts](src/vs/editor/common/config/fontInfo.ts)\n- [src/vs/editor/common/editorCommon.ts](src/vs/editor/common/editorCommon.ts)\n- [src/vs/editor/common/languages.ts](src/vs/editor/common/languages.ts)\n- [src/vs/editor/common/standalone/standaloneEnums.ts](src/vs/editor/common/standalone/standaloneEnums.ts)\n- [src/vs/editor/common/textModelEvents.ts](src/vs/editor/common/textModelEvents.ts)\n- [src/vs/editor/common/viewModel/minimapTokensColorTracker.ts](src/vs/editor/common/viewModel/minimapTokensColorTracker.ts)\n- [src/vs/editor/test/browser/view/minimapCharRenderer.test.ts](src/vs/editor/test/browser/view/minimapCharRenderer.test.ts)\n- [src/vs/monaco.d.ts](src/vs/monaco.d.ts)\n- [src/vs/platform/extensions/common/extensionsApiProposals.ts](src/vs/platform/extensions/common/extensionsApiProposals.ts)\n- [src/vs/workbench/api/browser/extensionHost.contribution.ts](src/vs/workbench/api/browser/extensionHost.contribution.ts)\n- [src/vs/workbench/api/browser/mainThreadLanguageFeatures.ts](src/vs/workbench/api/browser/mainThreadLanguageFeatures.ts)\n- [src/vs/workbench/api/browser/mainThreadNotebook.ts](src/vs/workbench/api/browser/mainThreadNotebook.ts)\n- [src/vs/workbench/api/common/extHost.api.impl.ts](src/vs/workbench/api/common/extHost.api.impl.ts)\n- [src/vs/workbench/api/common/extHost.protocol.ts](src/vs/workbench/api/common/extHost.protocol.ts)\n- [src/vs/workbench/api/common/extHostLanguageFeatures.ts](src/vs/workbench/api/common/extHostLanguageFeatures.ts)\n- [src/vs/workbench/api/common/extHostNotebook.ts](src/vs/workbench/api/common/extHostNotebook.ts)\n- [src/vs/workbench/api/common/extHostTypeConverters.ts](src/vs/workbench/api/common/extHostTypeConverters.ts)\n- [src/vs/workbench/api/common/extHostTypes.ts](src/vs/workbench/api/common/extHostTypes.ts)\n- [src/vs/workbench/contrib/notebook/browser/media/notebook.css](src/vs/workbench/contrib/notebook/browser/media/notebook.css)\n- [src/vs/workbench/contrib/notebook/browser/notebook.contribution.ts](src/vs/workbench/contrib/notebook/browser/notebook.contribution.ts)\n- [src/vs/workbench/contrib/notebook/browser/notebookBrowser.ts](src/vs/workbench/contrib/notebook/browser/notebookBrowser.ts)\n- [src/vs/workbench/contrib/notebook/browser/notebookEditor.ts](src/vs/workbench/contrib/notebook/browser/notebookEditor.ts)\n- [src/vs/workbench/contrib/notebook/browser/notebookEditorWidget.ts](src/vs/workbench/contrib/notebook/browser/notebookEditorWidget.ts)\n- [src/vs/workbench/contrib/notebook/browser/view/notebookCellList.ts](src/vs/workbench/contrib/notebook/browser/view/notebookCellList.ts)\n- [src/vs/workbench/contrib/notebook/browser/view/renderers/backLayerWebView.ts](src/vs/workbench/contrib/notebook/browser/view/renderers/backLayerWebView.ts)\n- [src/vs/workbench/contrib/notebook/browser/view/renderers/cellRenderer.ts](src/vs/workbench/contrib/notebook/browser/view/renderers/cellRenderer.ts)\n- [src/vs/workbench/contrib/notebook/browser/view/renderers/webviewMessages.ts](src/vs/workbench/contrib/notebook/browser/view/renderers/webviewMessages.ts)\n- [src/vs/workbench/contrib/notebook/browser/view/renderers/webviewPreloads.ts](src/vs/workbench/contrib/notebook/browser/view/renderers/webviewPreloads.ts)\n- [src/vs/workbench/contrib/notebook/browser/viewModel/baseCellViewModel.ts](src/vs/workbench/contrib/notebook/browser/viewModel/baseCellViewModel.ts)\n- [src/vs/workbench/contrib/notebook/browser/viewModel/codeCellViewModel.ts](src/vs/workbench/contrib/notebook/browser/viewModel/codeCellViewModel.ts)\n- [src/vs/workbench/contrib/notebook/browser/viewModel/markupCellViewModel.ts](src/vs/workbench/contrib/notebook/browser/viewModel/markupCellViewModel.ts)\n- [src/vs/workbench/contrib/notebook/common/model/notebookCellTextModel.ts](src/vs/workbench/contrib/notebook/common/model/notebookCellTextModel.ts)\n- [src/vs/workbench/contrib/notebook/common/model/notebookTextModel.ts](src/vs/workbench/contrib/notebook/common/model/notebookTextModel.ts)\n- [src/vs/workbench/contrib/notebook/common/notebookCommon.ts](src/vs/workbench/contrib/notebook/common/notebookCommon.ts)\n- [src/vs/workbench/contrib/notebook/common/notebookEditorModel.ts](src/vs/workbench/contrib/notebook/common/notebookEditorModel.ts)\n- [src/vs/workbench/contrib/notebook/common/notebookService.ts](src/vs/workbench/contrib/notebook/common/notebookService.ts)\n- [src/vscode-dts/vscode.d.ts](src/vscode-dts/vscode.d.ts)\n- [src/vscode-dts/vscode.proposed.inlineCompletionsAdditions.d.ts](src/vscode-dts/vscode.proposed.inlineCompletionsAdditions.d.ts)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis document explains the extension API surface that allows VS Code extensions to integrate with the notebook system. Extensions can contribute notebook serializers, execution kernels (controllers), output renderers, and programmatically interact with notebook documents and cells.\n\nFor the core notebook architecture and internal implementation details, see [Notebook Architecture Overview](#9.1). For information about notebook data models and cell lifecycle, see [Notebook Data Model](#9.3) and [Cell Lifecycle and State Management](#9.5).\n\n## API Surface Overview\n\nThe notebook extension API consists of four primary contribution points exposed through the `vscode` namespace:\n\n| API Area | Purpose | Key Types |\n|----------|---------|-----------|\n| **NotebookSerializer** | Read/write notebook files in custom formats | `NotebookSerializer`, `NotebookData` |\n| **NotebookController** | Execute notebook cells (kernels) | `NotebookController`, `NotebookCellExecution` |\n| **NotebookRenderer** | Custom rendering of cell outputs | `NotebookRendererMessaging` |\n| **Document Access** | Programmatic access to notebook documents | `NotebookDocument`, `NotebookCell` |\n\nExtensions register these contributions through workspace methods like `workspace.registerNotebookSerializer()` and create controllers via `notebooks.createNotebookController()`.\n\n**Sources:** [src/vscode-dts/vscode.d.ts:12888-13856](), [src/vs/workbench/api/common/extHost.api.impl.ts:977-1164]()\n\n## High-Level Architecture\n\n```mermaid\ngraph TB\n    subgraph \"Extension Host Process\"\n        EXT[\"Extension Code\"]\n        API[\"vscode.notebooks API\u003cbr/\u003evscode.workspace API\"]\n        EXTHOST_NB[\"ExtHostNotebookController\"]\n        EXTHOST_KERNELS[\"ExtHostNotebookKernels\"]\n        EXTHOST_RENDERERS[\"ExtHostNotebookRenderers\"]\n        \n        EXT --\u003e API\n        API --\u003e EXTHOST_NB\n        API --\u003e EXTHOST_KERNELS\n        API --\u003e EXTHOST_RENDERERS\n    end\n    \n    subgraph \"RPC Boundary\"\n        PROTOCOL[\"ExtHost Protocol\u003cbr/\u003eSerializableObjectWithBuffers\"]\n    end\n    \n    subgraph \"Main Thread (Renderer Process)\"\n        MAIN_NB[\"MainThreadNotebookDocuments\u003cbr/\u003eMainThreadNotebookEditors\"]\n        MAIN_KERNELS[\"MainThreadNotebookKernels\"]\n        MAIN_RENDERERS[\"MainThreadNotebookRenderers\"]\n        NB_SERVICE[\"INotebookService\"]\n        KERNEL_SERVICE[\"INotebookKernelService\"]\n        RENDERER_SERVICE[\"INotebookRendererMessagingService\"]\n    end\n    \n    EXTHOST_NB \u003c--\u003e|\"IPC\"| PROTOCOL\n    EXTHOST_KERNELS \u003c--\u003e|\"IPC\"| PROTOCOL\n    EXTHOST_RENDERERS \u003c--\u003e|\"IPC\"| PROTOCOL\n    \n    PROTOCOL \u003c--\u003e|\"IPC\"| MAIN_NB\n    PROTOCOL \u003c--\u003e|\"IPC\"| MAIN_KERNELS\n    PROTOCOL \u003c--\u003e|\"IPC\"| MAIN_RENDERERS\n    \n    MAIN_NB --\u003e NB_SERVICE\n    MAIN_KERNELS --\u003e KERNEL_SERVICE\n    MAIN_RENDERERS --\u003e RENDERER_SERVICE\n```\n\n**Diagram: Notebook Extension API Architecture**\n\nThe notebook extension API follows VS Code's standard ExtHost-MainThread architecture. Extension code runs in a separate process (Extension Host) and communicates with the main UI thread via RPC. This isolation provides stability and security.\n\n**Sources:** [src/vs/workbench/api/common/extHostNotebook.ts:1-1094](), [src/vs/workbench/api/browser/mainThreadNotebook.ts:1-329](), [src/vs/workbench/api/common/extHost.protocol.ts:800-900]()\n\n## NotebookSerializer\n\nNotebookSerializers handle reading and writing notebook files in specific formats. Extensions register serializers for particular notebook view types (e.g., \"jupyter-notebook\", \"interactive\").\n\n### Registration and Interface\n\n```mermaid\ngraph LR\n    EXT[\"Extension\"]\n    API[\"workspace.registerNotebookSerializer()\"]\n    SERIALIZER[\"NotebookSerializer\u003cbr/\u003eserializeNotebook()\u003cbr/\u003edeserializeNotebook()\"]\n    EXTHOST[\"ExtHostNotebookController\"]\n    MAIN[\"MainThreadNotebookDocuments\"]\n    SERVICE[\"NotebookService\"]\n    \n    EXT --\u003e|\"registers\"| API\n    API --\u003e|\"creates\"| SERIALIZER\n    SERIALIZER --\u003e EXTHOST\n    EXTHOST --\u003e|\"RPC: $registerNotebookSerializer\"| MAIN\n    MAIN --\u003e SERVICE\n```\n\n**Diagram: NotebookSerializer Registration Flow**\n\nExtensions implement the `NotebookSerializer` interface with two methods:\n- `deserializeNotebook(data: Uint8Array, token: CancellationToken): NotebookData | Thenable\u003cNotebookData\u003e` - Converts file bytes to notebook structure\n- `serializeNotebook(data: NotebookData, token: CancellationToken): Uint8Array | Thenable\u003cUint8Array\u003e` - Converts notebook structure to file bytes\n\n**Sources:** [src/vscode-dts/vscode.d.ts:13788-13817](), [src/vs/workbench/api/common/extHostNotebook.ts:269-339]()\n\n### NotebookData Structure\n\nThe `NotebookData` type represents a notebook's complete structure:\n\n```typescript\ninterface NotebookData {\n    cells: NotebookCellData[];\n    metadata?: { [key: string]: any };\n}\n\ninterface NotebookCellData {\n    kind: NotebookCellKind;\n    value: string;\n    languageId: string;\n    outputs?: NotebookCellOutput[];\n    metadata?: { [key: string]: any };\n    executionSummary?: NotebookCellExecutionSummary;\n}\n```\n\nThe serializer converts between this structured format and the raw bytes on disk. The `ExtHostNotebookController` class manages serializer registration and invocation.\n\n**Sources:** [src/vscode-dts/vscode.d.ts:13626-13713](), [src/vs/workbench/api/common/extHostTypeConverters.ts:2490-2630]()\n\n## NotebookController (Kernels)\n\nNotebookControllers (also called kernels) execute notebook cells. Extensions create controllers to provide execution environments for different languages and runtimes.\n\n### Controller Creation and Configuration\n\n```mermaid\ngraph TB\n    CREATE[\"notebooks.createNotebookController()\"]\n    CONTROLLER[\"NotebookController\u003cbr/\u003eid, notebookType, label\"]\n    PROPS[\"Configuration\u003cbr/\u003esupportedLanguages\u003cbr/\u003esupportsExecutionOrder\u003cbr/\u003eexecuteHandler\"]\n    EXECUTE[\"executeHandler(cells, notebook, controller)\"]\n    EXEC_OBJ[\"NotebookCellExecution\u003cbr/\u003estart(), end()\u003cbr/\u003eappendOutput()\"]\n    \n    CREATE --\u003e CONTROLLER\n    CONTROLLER --\u003e PROPS\n    PROPS --\u003e EXECUTE\n    EXECUTE --\u003e EXEC_OBJ\n    \n    EXTHOST_KERNELS[\"ExtHostNotebookKernels\"]\n    MAIN_KERNELS[\"NotebookKernelService\"]\n    \n    CONTROLLER --\u003e EXTHOST_KERNELS\n    EXTHOST_KERNELS --\u003e|\"RPC: $addKernel\"| MAIN_KERNELS\n```\n\n**Diagram: NotebookController Creation and Execution**\n\nControllers have the following key properties:\n- `id: string` - Unique identifier\n- `notebookType: string` - Which notebook types this controller supports (e.g., \"jupyter-notebook\")\n- `label: string` - Display name shown in kernel picker\n- `supportedLanguages?: string[]` - Languages this controller can execute\n- `executeHandler: (cells, notebook, controller) =\u003e void | Thenable\u003cvoid\u003e` - The execution function\n\n**Sources:** [src/vscode-dts/vscode.d.ts:13269-13425](), [src/vs/workbench/api/common/extHost.api.impl.ts:1061-1095]()\n\n### Cell Execution Flow\n\nWhen a controller executes cells, it receives a `NotebookCellExecution` object for each cell:\n\n```mermaid\nsequenceDiagram\n    participant User\n    participant UI as NotebookEditorWidget\n    participant KernelSvc as NotebookKernelService\n    participant ExtHost as ExtHostNotebookKernels\n    participant Handler as executeHandler\n    participant Execution as NotebookCellExecution\n    \n    User-\u003e\u003eUI: Execute Cell\n    UI-\u003e\u003eKernelSvc: executeNotebookCellsRequest\n    KernelSvc-\u003e\u003eExtHost: RPC: $executeNotebookKernelFromProvider\n    ExtHost-\u003e\u003eHandler: executeHandler(cells, notebook, controller)\n    Handler-\u003e\u003eExecution: createNotebookCellExecution(cell)\n    Execution-\u003e\u003eHandler: execution object\n    Handler-\u003e\u003eExecution: execution.start()\n    Handler-\u003e\u003eExecution: execution.appendOutput(output)\n    Handler-\u003e\u003eExecution: execution.end(success)\n    Execution-\u003e\u003eExtHost: State updates\n    ExtHost-\u003e\u003eKernelSvc: RPC: Cell state changes\n    KernelSvc-\u003e\u003eUI: Update UI\n```\n\n**Diagram: Cell Execution Sequence**\n\nThe `NotebookCellExecution` object provides methods to:\n- `start(startTime?: number): void` - Mark execution start\n- `end(success: boolean | undefined, endTime?: number): void` - Mark execution completion\n- `appendOutput(output: NotebookCellOutput | readonly NotebookCellOutput[], cell?: NotebookCell): Promise\u003cvoid\u003e` - Add output to cell\n- `replaceOutput(output: NotebookCellOutput | readonly NotebookCellOutput[], cell?: NotebookCell): Promise\u003cvoid\u003e` - Replace cell output\n- `clearOutput(cell?: NotebookCell): Promise\u003cvoid\u003e` - Clear cell output\n\n**Sources:** [src/vscode-dts/vscode.d.ts:13427-13554](), [src/vs/workbench/api/common/extHostNotebookKernels.ts:1-667]()\n\n### Controller Metadata and Features\n\nControllers can expose additional metadata:\n\n| Property | Type | Purpose |\n|----------|------|---------|\n| `supportedLanguages` | `string[]` | Languages the controller can execute |\n| `supportsExecutionOrder` | `boolean` | Whether execution order should be tracked |\n| `description` | `string` | Additional description text |\n| `detail` | `string` | Detail text shown in kernel picker |\n| `kind` | `NotebookControllerKind` | `1` (primary) or `2` (secondary) |\n\nControllers are matched to notebooks based on `notebookType` and optionally filtered by `updateNotebookAffinity()` method.\n\n**Sources:** [src/vscode-dts/vscode.d.ts:13269-13425](), [src/vs/workbench/contrib/notebook/common/notebookKernelService.ts:1-515]()\n\n## NotebookRenderer\n\nNotebookRenderers provide custom visualizations for cell outputs. Renderers are declared in `package.json` rather than registered via API calls.\n\n### Renderer Declaration\n\nRenderers are declared in the extension's `package.json`:\n\n```json\n{\n  \"contributes\": {\n    \"notebookRenderer\": [\n      {\n        \"id\": \"my-renderer\",\n        \"displayName\": \"My Renderer\",\n        \"entrypoint\": \"./out/renderer.js\",\n        \"mimeTypes\": [\"application/x-custom\"],\n        \"requiresMessaging\": \"optional\"\n      }\n    ]\n  }\n}\n```\n\n### Renderer Communication\n\n```mermaid\ngraph LR\n    RENDERER[\"Renderer Script\u003cbr/\u003e(runs in webview)\"]\n    MESSAGING[\"NotebookRendererMessaging\"]\n    EXTHOST_RENDERERS[\"ExtHostNotebookRenderers\"]\n    MAIN_MSG[\"NotebookRendererMessagingService\"]\n    WEBVIEW[\"BackLayerWebView\"]\n    \n    RENDERER \u003c--\u003e|\"postMessage\"| WEBVIEW\n    WEBVIEW \u003c--\u003e|\"IPC\"| MAIN_MSG\n    MAIN_MSG \u003c--\u003e|\"RPC\"| EXTHOST_RENDERERS\n    EXTHOST_RENDERERS --\u003e MESSAGING\n    MESSAGING --\u003e|\"onDidReceiveMessage\u003cbr/\u003epostMessage\"| EXT[\"Extension Code\"]\n```\n\n**Diagram: Renderer Messaging Flow**\n\nRenderers can optionally communicate with their extension using the `NotebookRendererMessaging` API:\n- `onDidReceiveMessage: Event\u003c{ editor: NotebookEditor, message: any }\u003e` - Receive messages from renderer\n- `postMessage(message: any, editor?: NotebookEditor): Thenable\u003cboolean\u003e` - Send messages to renderer\n\nThe renderer script (running in the webview) uses the `acquireNotebookRendererApi()` function to access the messaging API.\n\n**Sources:** [src/vscode-dts/vscode.d.ts:13556-13624](), [src/vs/workbench/api/common/extHostNotebookRenderers.ts:1-187](), [src/vs/workbench/contrib/notebook/browser/view/renderers/webviewPreloads.ts:1800-2000]()\n\n### Renderer API in Webview\n\nThe renderer script running in the notebook webview receives an API object:\n\n```typescript\ninterface RendererContext\u003cT\u003e {\n  setState(state: T): void;\n  getState(): T | undefined;\n  getRenderer(rendererId: string): Promise\u003cRendererApi\u003e;\n  workspace: {\n    isTrusted: boolean;\n  };\n  settings: {\n    lineLimit: number;\n    outputScrolling: boolean;\n    outputWordWrap: boolean;\n  };\n}\n```\n\nRenderers implement the `createOutputItem()` method to generate DOM elements for outputs.\n\n**Sources:** [src/vs/workbench/contrib/notebook/browser/view/renderers/webviewPreloads.ts:1950-2400]()\n\n## Programmatic Document Access\n\nExtensions can access and manipulate notebook documents programmatically through the `workspace.notebookDocuments` API.\n\n### Document and Cell Model\n\n```mermaid\ngraph TB\n    WS[\"workspace.notebookDocuments\"]\n    DOC[\"NotebookDocument\"]\n    CELL[\"NotebookCell\"]\n    OUTPUT[\"NotebookCellOutput\"]\n    ITEM[\"NotebookCellOutputItem\"]\n    \n    WS --\u003e|\"NotebookDocument[]\"| DOC\n    DOC --\u003e|\"cells: NotebookCell[]\"| CELL\n    CELL --\u003e|\"outputs: NotebookCellOutput[]\"| OUTPUT\n    OUTPUT --\u003e|\"items: NotebookCellOutputItem[]\"| ITEM\n    \n    DOC -.-\u003e|\"metadata\"| META[\"Notebook Metadata\"]\n    CELL -.-\u003e|\"metadata\"| CMETA[\"Cell Metadata\"]\n    CELL -.-\u003e|\"executionSummary\"| EXEC[\"Execution Summary\"]\n```\n\n**Diagram: Notebook Document Object Model**\n\nKey interfaces for document access:\n\n| Interface | Key Properties | Purpose |\n|-----------|----------------|---------|\n| `NotebookDocument` | `uri`, `notebookType`, `cells`, `metadata`, `version` | Represents entire notebook |\n| `NotebookCell` | `index`, `kind`, `document`, `outputs`, `metadata`, `executionSummary` | Represents single cell |\n| `NotebookCellOutput` | `items`, `metadata` | Cell execution output |\n| `NotebookCellOutputItem` | `mime`, `data` | Single MIME-typed output |\n\n**Sources:** [src/vscode-dts/vscode.d.ts:12888-13267](), [src/vs/workbench/api/common/extHostNotebookDocument.ts:1-370]()\n\n### Document Editing\n\nExtensions can edit notebooks using `WorkspaceEdit`:\n\n```mermaid\ngraph LR\n    EDIT[\"WorkspaceEdit\"]\n    NB_EDIT[\"NotebookEdit\"]\n    TYPES[\"Edit Types\u003cbr/\u003einsertCells\u003cbr/\u003edeleteCells\u003cbr/\u003ereplaceCells\"]\n    APPLY[\"workspace.applyEdit()\"]\n    \n    EDIT --\u003e|\"set(uri, notebookEdits)\"| NB_EDIT\n    NB_EDIT --\u003e TYPES\n    EDIT --\u003e APPLY\n    APPLY --\u003e|\"updates\"| DOC[\"NotebookDocument\"]\n```\n\n**Diagram: Notebook Document Editing**\n\nAvailable notebook edit operations:\n- `NotebookEdit.insertCells(index, cells)` - Insert new cells\n- `NotebookEdit.deleteCells(range)` - Delete cells\n- `NotebookEdit.replaceCells(range, cells)` - Replace cells\n- `NotebookEdit.updateCellMetadata(index, metadata)` - Update cell metadata\n- `NotebookEdit.updateNotebookMetadata(metadata)` - Update notebook metadata\n\n**Sources:** [src/vscode-dts/vscode.d.ts:4584-4674](), [src/vs/workbench/api/common/extHostTypeConverters.ts:2300-2490]()\n\n## RPC Protocol Layer\n\nThe notebook extension API uses VS Code's ExtHost-MainThread RPC protocol to communicate between processes. This section details the protocol messages specific to notebooks.\n\n### Protocol Message Types\n\n```mermaid\ngraph TB\n    subgraph \"ExtHost  MainThread\"\n        E1[\"$registerNotebookSerializer\u003cbr/\u003eviewType, options, registration\"]\n        E2[\"$addKernel\u003cbr/\u003ehandle, metadata\"]\n        E3[\"$executeNotebookKernelFromProvider\u003cbr/\u003ehandle, cells\"]\n        E4[\"$postMessage\u003cbr/\u003eeditorId, rendererId, message\"]\n    end\n    \n    subgraph \"MainThread  ExtHost\"\n        M1[\"$acceptDocumentAndEditorsDelta\u003cbr/\u003enew documents, removed documents\"]\n        M2[\"$acceptModelChanged\u003cbr/\u003euri, event\"]\n        M3[\"$resolveNotebookData\u003cbr/\u003eviewType, uri\"]\n        M4[\"$createNotebookCellExecution\u003cbr/\u003ecellHandle\"]\n    end\n    \n    PROTOCOL[\"ExtHost Protocol\u003cbr/\u003eMainThreadNotebookShape\u003cbr/\u003eExtHostNotebookShape\"]\n    \n    E1 --\u003e PROTOCOL\n    E2 --\u003e PROTOCOL\n    E3 --\u003e PROTOCOL\n    E4 --\u003e PROTOCOL\n    \n    PROTOCOL --\u003e M1\n    PROTOCOL --\u003e M2\n    PROTOCOL --\u003e M3\n    PROTOCOL --\u003e M4\n```\n\n**Diagram: Notebook RPC Protocol Messages**\n\nKey protocol interfaces:\n- `MainThreadNotebookShape` - Methods called on main thread by extension host\n- `ExtHostNotebookShape` - Methods called on extension host by main thread\n- `MainThreadNotebookDocumentsShape` - Document-specific operations\n- `MainThreadNotebookEditorsShape` - Editor-specific operations\n- `MainThreadNotebookKernelsShape` - Kernel-specific operations\n\n**Sources:** [src/vs/workbench/api/common/extHost.protocol.ts:800-1000](), [src/vs/workbench/api/browser/mainThreadNotebook.ts:1-329]()\n\n### Type Converters\n\nType converters transform between VS Code API types (ExtHost) and internal protocol DTOs (MainThread):\n\n| API Type | DTO Type | Converter Location |\n|----------|----------|-------------------|\n| `vscode.NotebookData` | `NotebookDataDto` | `typeConverters.NotebookData` |\n| `vscode.NotebookCellData` | `IMainCellDto` | `typeConverters.NotebookCellData` |\n| `vscode.NotebookCellOutput` | `IOutputDto` | `typeConverters.NotebookCellOutput` |\n| `vscode.NotebookCellOutputItem` | `IOutputItemDto` | `typeConverters.NotebookCellOutputItem` |\n\nThe converters handle:\n- URI transformations\n- Buffer/Uint8Array conversions\n- Metadata filtering based on `TransientOptions`\n- Output ID generation and tracking\n\n**Sources:** [src/vs/workbench/api/common/extHostTypeConverters.ts:2300-2700](), [src/vs/workbench/api/browser/mainThreadNotebookDto.ts:1-179]()\n\n## Event Notification Flow\n\nExtensions receive notifications about notebook changes through several event emitters:\n\n```mermaid\ngraph TB\n    MODEL[\"NotebookTextModel\u003cbr/\u003e(Main Thread)\"]\n    MAIN_NB[\"MainThreadNotebookDocuments\"]\n    EXTHOST_NB[\"ExtHostNotebookController\"]\n    EXTHOST_DOC[\"ExtHostNotebookDocument\"]\n    \n    EVENT1[\"workspace.onDidOpenNotebookDocument\"]\n    EVENT2[\"workspace.onDidCloseNotebookDocument\"]\n    EVENT3[\"workspace.onDidChangeNotebookDocument\"]\n    EVENT4[\"workspace.onDidSaveNotebookDocument\"]\n    \n    MODEL --\u003e|\"onDidChangeContent\"| MAIN_NB\n    MAIN_NB --\u003e|\"RPC: $acceptModelChanged\"| EXTHOST_NB\n    EXTHOST_NB --\u003e EXTHOST_DOC\n    EXTHOST_DOC --\u003e EVENT3\n    \n    MAIN_NB --\u003e|\"RPC: $acceptDocumentAndEditorsDelta\"| EXTHOST_NB\n    EXTHOST_NB --\u003e EVENT1\n    EXTHOST_NB --\u003e EVENT2\n    \n    MAIN_NB --\u003e|\"RPC: $acceptModelSaved\"| EXTHOST_NB\n    EXTHOST_NB --\u003e EVENT4\n```\n\n**Diagram: Notebook Event Notification Flow**\n\nEvent types:\n- `onDidOpenNotebookDocument` - Fired when a notebook is opened\n- `onDidCloseNotebookDocument` - Fired when a notebook is closed\n- `onDidChangeNotebookDocument` - Fired when notebook content changes (cell edits, output changes, metadata changes)\n- `onDidSaveNotebookDocument` - Fired when a notebook is saved\n\nThe `NotebookDocumentChangeEvent` provides detailed change information including:\n- `cellChanges: NotebookCellContentChangeEvent[]` - Cell text changes\n- `contentChanges: NotebookDocumentContentChange[]` - Structural changes (add/remove/move cells)\n- `metadata: { [key: string]: any }` - Metadata changes\n\n**Sources:** [src/vscode-dts/vscode.d.ts:8860-8991](), [src/vs/workbench/api/common/extHostNotebookDocument.ts:155-370]()\n\n## Integration Points Summary\n\nThe notebook extension API integrates with other VS Code extension APIs:\n\n| Integration | API Surface | Use Case |\n|-------------|-------------|----------|\n| **File System** | `workspace.fs`, `FileSystemProvider` | Custom notebook storage backends |\n| **Text Documents** | `workspace.textDocuments` | Access cell contents as text documents |\n| **Commands** | `commands.registerCommand` | Register notebook-specific commands |\n| **Decorations** | `TextEditorDecorationType` | Decorate cell editor content |\n| **Languages** | `languages.*` | Provide IntelliSense for notebook cells |\n| **Debug** | `debug.*` | Debug notebook cell execution |\n| **Testing** | `tests.*` | Test notebook cells |\n\nNotebook cells are represented as regular `TextDocument` objects, allowing full language feature integration including completions, hovers, diagnostics, and code actions.\n\n**Sources:** [src/vs/workbench/api/common/extHost.api.impl.ts:977-1164](), [src/vs/workbench/api/common/extHostDocuments.ts:1-354]()"])</script><script>self.__next_f.push([1,"46:T635d,"])</script><script>self.__next_f.push([1,"# Source Control Management\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [extensions/git/src/historyProvider.ts](extensions/git/src/historyProvider.ts)\n- [src/vs/workbench/api/browser/mainThreadSCM.ts](src/vs/workbench/api/browser/mainThreadSCM.ts)\n- [src/vs/workbench/api/common/extHostSCM.ts](src/vs/workbench/api/common/extHostSCM.ts)\n- [src/vs/workbench/contrib/scm/browser/activity.ts](src/vs/workbench/contrib/scm/browser/activity.ts)\n- [src/vs/workbench/contrib/scm/browser/media/scm.css](src/vs/workbench/contrib/scm/browser/media/scm.css)\n- [src/vs/workbench/contrib/scm/browser/menus.ts](src/vs/workbench/contrib/scm/browser/menus.ts)\n- [src/vs/workbench/contrib/scm/browser/scm.contribution.ts](src/vs/workbench/contrib/scm/browser/scm.contribution.ts)\n- [src/vs/workbench/contrib/scm/browser/scmHistory.ts](src/vs/workbench/contrib/scm/browser/scmHistory.ts)\n- [src/vs/workbench/contrib/scm/browser/scmHistoryViewPane.ts](src/vs/workbench/contrib/scm/browser/scmHistoryViewPane.ts)\n- [src/vs/workbench/contrib/scm/browser/scmRepositoriesViewPane.ts](src/vs/workbench/contrib/scm/browser/scmRepositoriesViewPane.ts)\n- [src/vs/workbench/contrib/scm/browser/scmRepositoryRenderer.ts](src/vs/workbench/contrib/scm/browser/scmRepositoryRenderer.ts)\n- [src/vs/workbench/contrib/scm/browser/scmViewPane.ts](src/vs/workbench/contrib/scm/browser/scmViewPane.ts)\n- [src/vs/workbench/contrib/scm/browser/scmViewService.ts](src/vs/workbench/contrib/scm/browser/scmViewService.ts)\n- [src/vs/workbench/contrib/scm/browser/util.ts](src/vs/workbench/contrib/scm/browser/util.ts)\n- [src/vs/workbench/contrib/scm/browser/workingSet.ts](src/vs/workbench/contrib/scm/browser/workingSet.ts)\n- [src/vs/workbench/contrib/scm/common/history.ts](src/vs/workbench/contrib/scm/common/history.ts)\n- [src/vs/workbench/contrib/scm/common/scm.ts](src/vs/workbench/contrib/scm/common/scm.ts)\n- [src/vs/workbench/contrib/scm/test/browser/scmHistory.test.ts](src/vs/workbench/contrib/scm/test/browser/scmHistory.test.ts)\n- [src/vscode-dts/vscode.proposed.scmHistoryProvider.d.ts](src/vscode-dts/vscode.proposed.scmHistoryProvider.d.ts)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis document describes the Source Control Management (SCM) framework in VS Code, which provides a provider-based architecture for integrating version control systems. The framework includes the core service layer, UI components (Changes view, Repositories view, Graph view), a history provider system for visualizing commit graphs, and an extension API that allows extensions to implement SCM providers.\n\nFor information about the built-in Git extension that implements this framework, see [Git Extension](#10).\n\n## Architecture Overview\n\nThe SCM system follows a provider pattern where extensions register `ISCMProvider` implementations that expose resources (files with changes) organized into groups. The workbench provides views to display these resources and interact with the version control system.\n\n```mermaid\ngraph TB\n    subgraph \"Core Services\"\n        SCMService[\"ISCMService\u003cbr/\u003e(scmService.ts)\"]\n        SCMViewService[\"ISCMViewService\u003cbr/\u003e(scmViewService.ts)\"]\n        QuickDiffService[\"IQuickDiffService\u003cbr/\u003e(quickDiffService.ts)\"]\n    end\n    \n    subgraph \"Extension API\"\n        ExtHostSCM[\"ExtHostSCM\u003cbr/\u003e(extHostSCM.ts)\"]\n        MainThreadSCM[\"MainThreadSCM\u003cbr/\u003e(mainThreadSCM.ts)\"]\n        VSCodeAPI[\"vscode.scm API\"]\n    end\n    \n    subgraph \"Views\"\n        SCMViewPane[\"SCMViewPane\u003cbr/\u003eChanges View\"]\n        RepositoriesView[\"SCMRepositoriesViewPane\u003cbr/\u003eRepositories View\"]\n        HistoryView[\"SCMHistoryViewPane\u003cbr/\u003eGraph View\"]\n    end\n    \n    subgraph \"Provider Implementation\"\n        GitExtension[\"Git Extension\u003cbr/\u003e(extensions/git)\"]\n        CustomProvider[\"Custom SCM Extension\"]\n    end\n    \n    subgraph \"Data Model\"\n        Repository[\"ISCMRepository\"]\n        Provider[\"ISCMProvider\"]\n        ResourceGroup[\"ISCMResourceGroup\"]\n        Resource[\"ISCMResource\"]\n        HistoryProvider[\"ISCMHistoryProvider\"]\n    end\n    \n    GitExtension --\u003e VSCodeAPI\n    CustomProvider --\u003e VSCodeAPI\n    VSCodeAPI --\u003e ExtHostSCM\n    ExtHostSCM \u003c--\u003e MainThreadSCM\n    MainThreadSCM --\u003e SCMService\n    \n    SCMService --\u003e Repository\n    Repository --\u003e Provider\n    Provider --\u003e ResourceGroup\n    ResourceGroup --\u003e Resource\n    Provider --\u003e HistoryProvider\n    \n    SCMViewService --\u003e SCMViewPane\n    SCMViewService --\u003e RepositoriesView\n    SCMViewService --\u003e HistoryView\n    \n    SCMViewPane --\u003e Provider\n    RepositoriesView --\u003e Repository\n    HistoryView --\u003e HistoryProvider\n    \n    QuickDiffService --\u003e Provider\n```\n\n**Sources:** [src/vs/workbench/contrib/scm/common/scm.ts:1-267](), [src/vs/workbench/contrib/scm/common/scmService.ts](), [src/vs/workbench/contrib/scm/browser/scmViewService.ts:1-400]()\n\n## Core Service Layer\n\n### ISCMService\n\n`ISCMService` is the central registry for SCM providers. Extensions register providers through the extension API, which creates `ISCMRepository` instances that are tracked by the service.\n\n**Key Interfaces:**\n- `ISCMService` - Service interface for registering and retrieving repositories [src/vs/workbench/contrib/scm/common/scm.ts:179-191]()\n- `ISCMRepository` - Represents a registered repository with its provider and input [src/vs/workbench/contrib/scm/common/scm.ts:173-177]()\n- `ISCMProvider` - The main provider interface that extensions implement [src/vs/workbench/contrib/scm/common/scm.ts:72-97]()\n\n### ISCMViewService\n\n`ISCMViewService` manages which repositories are visible in the UI and tracks the active repository. It supports two selection modes:\n- **Multiple**: Multiple repositories can be visible simultaneously\n- **Single**: Only one repository can be selected at a time\n\n```mermaid\ngraph LR\n    subgraph \"Repository Management\"\n        SCMService[\"ISCMService\u003cbr/\u003eAll Repositories\"]\n        ViewService[\"ISCMViewService\u003cbr/\u003eVisible Repositories\"]\n        ActiveRepo[\"activeRepository\u003cbr/\u003eIObservable\"]\n    end\n    \n    subgraph \"Configuration\"\n        SelectionMode[\"selectionModeConfig\u003cbr/\u003e'single' | 'multiple'\"]\n        SortKey[\"Repository Sort Key\u003cbr/\u003e'discoveryTime' | 'name' | 'path'\"]\n    end\n    \n    subgraph \"UI State\"\n        RepositoriesList[\"repositories: ISCMRepository[]\"]\n        VisibleRepos[\"visibleRepositories: ISCMRepository[]\"]\n        FocusedRepo[\"focusedRepository\"]\n    end\n    \n    SCMService --\u003e ViewService\n    SelectionMode --\u003e ViewService\n    SortKey --\u003e ViewService\n    \n    ViewService --\u003e RepositoriesList\n    ViewService --\u003e VisibleRepos\n    ViewService --\u003e ActiveRepo\n    ViewService --\u003e FocusedRepo\n```\n\n**Sources:** [src/vs/workbench/contrib/scm/common/scm.ts:226-266](), [src/vs/workbench/contrib/scm/browser/scmViewService.ts:100-400]()\n\n## Provider System\n\n### Resource Model\n\nThe SCM framework uses a hierarchical model where providers expose resource groups containing individual resources:\n\n| Level | Interface | Description |\n|-------|-----------|-------------|\n| Provider | `ISCMProvider` | Top-level provider (e.g., Git for a repository) |\n| Resource Group | `ISCMResourceGroup` | Logical grouping of resources (e.g., \"Changes\", \"Staged Changes\") |\n| Resource | `ISCMResource` | Individual file with changes |\n\n**Key Properties:**\n\n`ISCMProvider` [src/vs/workbench/contrib/scm/common/scm.ts:72-97]():\n- `id`, `providerId`, `label`, `name` - Identification\n- `groups` - Array of resource groups\n- `rootUri` - Root directory (optional)\n- `count` - Badge count (observable)\n- `commitTemplate` - Default commit message (observable)\n- `historyProvider` - Optional history provider (observable)\n- `inputBoxTextModel` - Text model for commit input\n\n`ISCMResourceGroup` [src/vs/workbench/contrib/scm/common/scm.ts:56-70]():\n- `id`, `label` - Identification\n- `resources` - Array of resources\n- `resourceTree` - Tree representation for tree view mode\n- `hideWhenEmpty` - Whether to hide when no resources\n- `multiDiffEditorEnableViewChanges` - Enable multi-diff editor\n\n`ISCMResource` [src/vs/workbench/contrib/scm/common/scm.ts:45-54]():\n- `sourceUri` - URI of the file\n- `decorations` - Visual decorations (icon, tooltip, strikethrough, faded)\n- `command` - Command to execute when opened\n- `multiDiffEditorOriginalUri`, `multiDiffEditorModifiedUri` - URIs for diff editor\n\n### Resource Decorations\n\nResources can have decorations to indicate their status:\n\n```mermaid\ngraph LR\n    Resource[\"ISCMResource\"]\n    Decorations[\"ISCMResourceDecorations\"]\n    \n    Resource --\u003e Decorations\n    \n    Decorations --\u003e Icon[\"icon/iconDark\u003cbr/\u003eThemeIcon | URI\"]\n    Decorations --\u003e Tooltip[\"tooltip: string\"]\n    Decorations --\u003e StrikeThrough[\"strikeThrough: boolean\"]\n    Decorations --\u003e Faded[\"faded: boolean\"]\n```\n\n**Sources:** [src/vs/workbench/contrib/scm/common/scm.ts:37-54]()\n\n## Views and UI Components\n\n### SCM View Pane (Changes View)\n\n`SCMViewPane` is the main view displaying resource groups and resources in a tree structure. It supports two view modes:\n\n- **List Mode** (`ViewMode.List`): Flat list of all resources\n- **Tree Mode** (`ViewMode.Tree`): Hierarchical folder structure\n\n**Main Components** [src/vs/workbench/contrib/scm/browser/scmViewPane.ts:1-1000]():\n\n| Component | Description |\n|-----------|-------------|\n| `RepositoryRenderer` | Renders repository headers |\n| `InputRenderer` | Renders commit message input box |\n| `ActionButtonRenderer` | Renders action buttons (commit, publish, etc.) |\n| `ResourceGroupRenderer` | Renders resource group headers |\n| `ResourceRenderer` | Renders individual file resources |\n\n```mermaid\ngraph TB\n    SCMViewPane[\"SCMViewPane\u003cbr/\u003e(scmViewPane.ts)\"]\n    \n    Tree[\"WorkbenchCompressibleAsyncDataTree\"]\n    DataSource[\"SCMTreeDataSource\"]\n    \n    Renderers[\"Tree Renderers\"]\n    RepoRenderer[\"RepositoryRenderer\"]\n    InputRenderer[\"InputRenderer\u003cbr/\u003eSCMInputWidget\"]\n    ActionButtonRenderer[\"ActionButtonRenderer\"]\n    GroupRenderer[\"ResourceGroupRenderer\"]\n    ResourceRenderer[\"ResourceRenderer\"]\n    \n    SCMViewPane --\u003e Tree\n    Tree --\u003e DataSource\n    Tree --\u003e Renderers\n    \n    Renderers --\u003e RepoRenderer\n    Renderers --\u003e InputRenderer\n    Renderers --\u003e ActionButtonRenderer\n    Renderers --\u003e GroupRenderer\n    Renderers --\u003e ResourceRenderer\n    \n    InputRenderer --\u003e CodeEditorWidget[\"CodeEditorWidget\u003cbr/\u003eMonaco Editor\"]\n```\n\n**Sources:** [src/vs/workbench/contrib/scm/browser/scmViewPane.ts:116-1500]()\n\n### SCM Input Widget\n\nThe input widget is a Monaco editor instance configured for commit message entry with features like:\n- Placeholder text\n- Validation (error/warning/info)\n- History navigation (previous/next messages)\n- Syntax highlighting for `scminput` language\n\n**Implementation Details:**\n\nThe widget is created in `InputRenderer.renderTemplate` [src/vs/workbench/contrib/scm/browser/scmViewPane.ts:314-324]() and uses:\n- Simple editor configuration [src/vs/workbench/contrib/codeEditor/browser/simpleEditorOptions.ts]()\n- Enabled extensions: MenuPreventer, ContextMenuController, SuggestController, SnippetController2, and more [src/vs/workbench/contrib/scm/browser/scmViewPane.ts:1600-1700]()\n\n**Sources:** [src/vs/workbench/contrib/scm/browser/scmViewPane.ts:296-416](), [src/vs/workbench/contrib/scm/browser/scmViewPane.ts:1545-1750]()\n\n### Repositories View Pane\n\n`SCMRepositoriesViewPane` provides a dedicated view for managing multiple repositories, especially useful when `scm.repositories.selectionMode` is set to `'single'`. When explorer mode is enabled (`scm.repositories.explorer`), it can also display artifact groups and artifacts from the repository's artifact provider.\n\n```mermaid\ngraph TB\n    RepoView[\"SCMRepositoriesViewPane\"]\n    Tree[\"WorkbenchCompressibleAsyncDataTree\"]\n    \n    Elements[\"Tree Elements\"]\n    Repo[\"ISCMRepository\"]\n    ArtifactGroup[\"SCMArtifactGroupTreeElement\"]\n    Artifact[\"SCMArtifactTreeElement\"]\n    \n    Renderers[\"Renderers\"]\n    RepoRenderer[\"RepositoryRenderer\"]\n    ArtifactGroupRenderer[\"ArtifactGroupRenderer\"]\n    ArtifactRenderer[\"ArtifactRenderer\"]\n    \n    RepoView --\u003e Tree\n    Tree --\u003e Elements\n    Tree --\u003e Renderers\n    \n    Elements --\u003e Repo\n    Elements --\u003e ArtifactGroup\n    Elements --\u003e Artifact\n    \n    Renderers --\u003e RepoRenderer\n    Renderers --\u003e ArtifactGroupRenderer\n    Renderers --\u003e ArtifactRenderer\n```\n\n**Sources:** [src/vs/workbench/contrib/scm/browser/scmRepositoriesViewPane.ts:1-400]()\n\n### History View Pane (Graph View)\n\n`SCMHistoryViewPane` displays the commit graph with visualizations of branches, merges, and commit history. It requires an `ISCMHistoryProvider` to be available.\n\n**Key Features:**\n- Swimlane-based graph rendering showing branch relationships\n- History item badges (branches, tags, remotes)\n- Incoming/outgoing changes visualization\n- Filtering by history item refs (branches/tags)\n- Load more pagination\n\n**Tree Elements:**\n- `SCMHistoryItemViewModelTreeElement` - Commit items with graph data\n- `SCMHistoryItemLoadMoreTreeElement` - Pagination element\n- `SCMHistoryItemChangeViewModelTreeElement` - File changes within a commit\n\n**Sources:** [src/vs/workbench/contrib/scm/browser/scmHistoryViewPane.ts:1-1000]()\n\n## History Provider System\n\n### History Provider Interface\n\n`ISCMHistoryProvider` enables extensions to expose commit history and graph data [src/vs/workbench/contrib/scm/common/history.ts:17-31]():\n\n**Observable References:**\n- `historyItemRef` - Current branch/tag (local, e.g., `refs/heads/main`)\n- `historyItemRemoteRef` - Remote tracking branch (e.g., `refs/remotes/origin/main`)\n- `historyItemBaseRef` - Base branch for comparing (e.g., upstream fork)\n- `historyItemRefChanges` - Event for ref additions/modifications/removals\n\n**Provider Methods:**\n\n| Method | Purpose |\n|--------|---------|\n| `provideHistoryItemRefs` | List available branches, tags, remotes |\n| `provideHistoryItems` | Fetch commits for specified refs |\n| `provideHistoryItemChanges` | Get file changes for a commit |\n| `resolveHistoryItem` | Get detailed info for a specific commit |\n| `resolveHistoryItemRefsCommonAncestor` | Find merge base between refs |\n\n### History Items and References\n\n```mermaid\ngraph LR\n    subgraph \"History Item\"\n        HistoryItem[\"ISCMHistoryItem\"]\n        ItemProps[\"id, parentIds\u003cbr/\u003esubject, message\u003cbr/\u003eauthor, timestamp\u003cbr/\u003estatistics\"]\n        References[\"references:\u003cbr/\u003eISCMHistoryItemRef[]\"]\n    end\n    \n    subgraph \"History Item Reference\"\n        ItemRef[\"ISCMHistoryItemRef\"]\n        RefProps[\"id, name\u003cbr/\u003erevision, category\u003cbr/\u003eicon, color\"]\n    end\n    \n    subgraph \"History Item Change\"\n        Change[\"ISCMHistoryItemChange\"]\n        ChangeProps[\"uri, originalUri\u003cbr/\u003emodifiedUri\"]\n    end\n    \n    HistoryItem --\u003e ItemProps\n    HistoryItem --\u003e References\n    References --\u003e ItemRef\n    ItemRef --\u003e RefProps\n    \n    HistoryItem --\u003e Change\n    Change --\u003e ChangeProps\n```\n\n**Special History Item IDs:**\n- `SCMIncomingHistoryItemId` = `'scm-graph-incoming-changes'` - Synthetic item for incoming changes\n- `SCMOutgoingHistoryItemId` = `'scm-graph-outgoing-changes'` - Synthetic item for outgoing changes\n\n**Sources:** [src/vs/workbench/contrib/scm/common/history.ts:1-100]()\n\n### Graph Rendering\n\nThe history graph uses a swimlane algorithm to visualize branch relationships. Each commit has input and output swimlanes that represent parent and child relationships.\n\n**Graph View Model** [src/vs/workbench/contrib/scm/browser/scmHistory.ts:200-800]():\n\nThe `toISCMHistoryItemViewModelArray` function converts history items into view models with:\n- `inputSwimlanes` - Incoming edges (parents)\n- `outputSwimlanes` - Outgoing edges (children)\n- `graphColumns` - SVG path data for rendering\n\n**Rendering Details:**\n- Swimlane width: 11px [src/vs/workbench/contrib/scm/browser/scmHistory.ts:21]()\n- Swimlane height: 22px [src/vs/workbench/contrib/scm/browser/scmHistory.ts:20]()\n- Circle radius: 4px with 2px stroke [src/vs/workbench/contrib/scm/browser/scmHistory.ts:23-24]()\n- Color palette: 8 distinct colors for branches [src/vs/workbench/contrib/scm/browser/scmHistory.ts:60-70]()\n\n```mermaid\ngraph TB\n    HistoryItems[\"ISCMHistoryItem[]\u003cbr/\u003eRaw history items\"]\n    \n    Converter[\"toISCMHistoryItemViewModelArray\"]\n    \n    ViewModels[\"ISCMHistoryItemViewModel[]\"]\n    ViewModel[\"ISCMHistoryItemViewModel\"]\n    \n    GraphData[\"Graph Data\"]\n    InputSwimlanes[\"inputSwimlanes\"]\n    OutputSwimlanes[\"outputSwimlanes\"]\n    GraphColumns[\"graphColumns\"]\n    \n    SVG[\"renderSCMHistoryItemGraph\"]\n    SVGPaths[\"SVG Path Elements\u003cbr/\u003eLines, Curves, Circles\"]\n    \n    HistoryItems --\u003e Converter\n    Converter --\u003e ViewModels\n    ViewModels --\u003e ViewModel\n    \n    ViewModel --\u003e GraphData\n    GraphData --\u003e InputSwimlanes\n    GraphData --\u003e OutputSwimlanes\n    GraphData --\u003e GraphColumns\n    \n    ViewModel --\u003e SVG\n    SVG --\u003e SVGPaths\n```\n\n**Sources:** [src/vs/workbench/contrib/scm/browser/scmHistory.ts:200-800](), [src/vs/workbench/contrib/scm/browser/scmHistory.ts:400-600]()\n\n## Extension API and RPC Bridge\n\n### Extension Host Side (ExtHostSCM)\n\n`ExtHostSCM` provides the implementation of the `vscode.scm` API that extensions use to register SCM providers [src/vs/workbench/api/common/extHostSCM.ts:1-1000]().\n\n**Key Classes:**\n\n| Class | Purpose |\n|-------|---------|\n| `ExtHostSCM` | Main API implementation, manages providers |\n| `ExtHostSourceControl` | Represents a source control instance (wraps provider) |\n| `ExtHostSCMInputBox` | Commit message input box API |\n| `ExtHostSourceControlResourceGroup` | Resource group API |\n\n**API Creation Flow:**\n1. Extension calls `vscode.scm.createSourceControl(id, label, rootUri?)`\n2. `ExtHostSCM.createSourceControl` creates `ExtHostSourceControl` [src/vs/workbench/api/common/extHostSCM.ts:900-950]()\n3. Provider is registered with main thread via `$registerSourceControl` [src/vs/workbench/api/common/extHostSCM.ts:950-960]()\n4. Resource groups are created via `sourceControl.createResourceGroup(id, label)` [src/vs/workbench/api/common/extHostSCM.ts:1100-1150]()\n\n### Main Thread Side (MainThreadSCM)\n\n`MainThreadSCM` receives RPC calls from the extension host and creates corresponding main thread objects [src/vs/workbench/api/browser/mainThreadSCM.ts:1-800]().\n\n**Main Classes:**\n\n| Class | Purpose |\n|-------|---------|\n| `MainThreadSCM` | RPC handler, creates main thread providers |\n| `MainThreadSCMProvider` | Implements `ISCMProvider` interface |\n| `MainThreadSCMResourceGroup` | Implements `ISCMResourceGroup` |\n| `MainThreadSCMResource` | Implements `ISCMResource` |\n| `MainThreadSCMHistoryProvider` | Implements `ISCMHistoryProvider` |\n\n**RPC Protocol Methods** [src/vs/workbench/api/common/extHost.protocol.ts]():\n- `$registerSourceControl(handle, id, label, rootUri)`\n- `$updateSourceControl(handle, features)`\n- `$unregisterSourceControl(handle)`\n- `$registerGroups(sourceControlHandle, groups, splices)`\n- `$updateGroup(sourceControlHandle, groupHandle, features)`\n- `$spliceResourceStates(sourceControlHandle, splices)`\n\n### Data Marshalling\n\nResources are transmitted from extension host to main thread using splices to minimize data transfer:\n\n```mermaid\ngraph LR\n    ExtHost[\"ExtHostSourceControlResourceGroup\"]\n    \n    Snapshot[\"_resourceSnapshot\u003cbr/\u003evscode.SourceControlResourceState[]\"]\n    \n    Diff[\"sortedDiff\u003cbr/\u003eCompare old vs new\"]\n    \n    Splices[\"SCMRawResourceSplices\u003cbr/\u003e[start, deleteCount, resources[]]\"]\n    \n    RPC[\"$spliceResourceStates\"]\n    \n    MainThread[\"MainThreadSCMResourceGroup\"]\n    \n    MainThreadResources[\"resources: ISCMResource[]\"]\n    \n    ExtHost --\u003e Snapshot\n    Snapshot --\u003e Diff\n    Diff --\u003e Splices\n    Splices --\u003e RPC\n    RPC --\u003e MainThread\n    MainThread --\u003e MainThreadResources\n```\n\n**Sources:** [src/vs/workbench/api/common/extHostSCM.ts:500-700](), [src/vs/workbench/api/browser/mainThreadSCM.ts:127-143]()\n\n## Menus and Actions\n\n### Menu System\n\nThe SCM framework uses the menu system to provide context-specific actions. Menu contributions are registered in extensions' `package.json` and populated dynamically based on context.\n\n**SCM-Specific Menus** [src/vs/platform/actions/common/actions.ts]():\n\n| Menu ID | Location | Context |\n|---------|----------|---------|\n| `MenuId.SCMTitle` | SCM view title bar | Global actions |\n| `MenuId.SCMResourceGroupContext` | Resource group context menu | `scmResourceGroupState` context |\n| `MenuId.SCMResourceContext` | Resource context menu | `scmResourceState` context |\n| `MenuId.SCMResourceFolderContext` | Folder context menu (tree mode) | Folder node |\n| `MenuId.SCMHistoryTitle` | History view title bar | History actions |\n| `MenuId.SCMHistoryItemContext` | History item context menu | History item |\n| `MenuId.SCMHistoryItemChangeContext` | Change context menu | File change in history |\n\n### SCM Menus Service\n\n`SCMMenus` manages menus for repositories and creates repository-specific menu instances [src/vs/workbench/contrib/scm/browser/menus.ts:1-300]():\n\n**Key Features:**\n- Creates contextual menus based on `contextValue` properties\n- Caches menu instances for performance\n- Provides `getRepositoryMenus(provider)` to get all menus for a provider\n\n```mermaid\ngraph TB\n    SCMMenus[\"SCMMenus\"]\n    \n    TitleMenu[\"SCMTitleMenu\"]\n    RepoMenus[\"SCMRepositoryMenus\"]\n    \n    ContextualMenus[\"Contextual Menus\"]\n    ResourceGroupMenus[\"Resource Group Menus\u003cbr/\u003eby contextValue\"]\n    ResourceMenus[\"Resource Menus\u003cbr/\u003eby contextValue\"]\n    \n    SCMMenus --\u003e TitleMenu\n    SCMMenus --\u003e RepoMenus\n    \n    RepoMenus --\u003e ContextualMenus\n    ContextualMenus --\u003e ResourceGroupMenus\n    ContextualMenus --\u003e ResourceMenus\n```\n\n**Sources:** [src/vs/workbench/contrib/scm/browser/menus.ts:1-300]()\n\n### Action Buttons\n\nProviders can specify action buttons that appear prominently in the UI [src/vs/workbench/contrib/scm/common/scm.ts:129-133]():\n\n**ISCMActionButtonDescriptor:**\n- `command` - Command to execute (with optional `shortTitle`)\n- `secondaryCommands` - Dropdown actions (grouped in arrays)\n- `enabled` - Whether button is enabled\n\nThe button is rendered by `ActionButtonRenderer` [src/vs/workbench/contrib/scm/browser/scmViewPane.ts:179-233]() and appears below the input box in the SCM view.\n\n**Sources:** [src/vs/workbench/contrib/scm/browser/scmViewPane.ts:179-233](), [src/vs/workbench/contrib/scm/common/scm.ts:129-133]()\n\n## Configuration\n\nThe SCM framework is highly configurable through VS Code settings:\n\n**View Configuration:**\n\n| Setting | Default | Description |\n|---------|---------|-------------|\n| `scm.defaultViewMode` | `'list'` | View mode: `'tree'` or `'list'` |\n| `scm.defaultViewSortKey` | `'path'` | Sort order: `'name'`, `'path'`, or `'status'` |\n| `scm.autoReveal` | `true` | Auto-reveal files in SCM view |\n| `scm.alwaysShowActions` | `false` | Always show inline actions |\n| `scm.alwaysShowRepositories` | `false` | Always show repository headers |\n| `scm.repositories.sortOrder` | `'discovery time'` | Repository sort order |\n| `scm.repositories.selectionMode` | `'multiple'` | `'single'` or `'multiple'` |\n\n**Input Configuration:**\n\n| Setting | Default | Description |\n|---------|---------|-------------|\n| `scm.inputFontFamily` | `'default'` | Font for commit input |\n| `scm.inputFontSize` | `13` | Font size in pixels |\n| `scm.inputMinLineCount` | `1` | Minimum lines for input |\n| `scm.inputMaxLineCount` | `10` | Maximum lines for input |\n\n**Graph Configuration:**\n\n| Setting | Default | Description |\n|---------|---------|-------------|\n| `scm.graph.badges` | `'filter'` | Badge visibility: `'all'` or `'filter'` |\n| `scm.graph.pageSize` | `50` | Number of commits per page |\n| `scm.graph.pageOnScroll` | `true` | Auto-load on scroll |\n| `scm.graph.showIncomingChanges` | `true` | Show incoming changes |\n| `scm.graph.showOutgoingChanges` | `true` | Show outgoing changes |\n\n**Sources:** [src/vs/workbench/contrib/scm/browser/scm.contribution.ts:178-431]()\n\n## Quick Diff System\n\nThe Quick Diff system provides inline diff decorations in editors for files tracked by SCM. It's implemented separately from the main SCM views but integrates with SCM providers.\n\n**Key Components:**\n\n| Component | Purpose |\n|-----------|---------|\n| `IQuickDiffService` | Service for registering quick diff providers |\n| `QuickDiffEditorController` | Editor contribution for rendering decorations |\n| `IBaselineResourceProvider` | Provider interface for getting baseline (HEAD) content |\n\n**Decoration Types:**\n- Gutter decorations showing added/modified/deleted lines\n- Overview ruler decorations\n- Minimap decorations\n\n**Sources:** [src/vs/workbench/contrib/scm/common/quickDiff.ts](), [src/vs/workbench/contrib/scm/browser/quickDiffWidget.ts]()\n\n## Activity Bar and Status Bar Integration\n\n### Activity Bar Badge\n\nThe activity bar badge shows pending changes count based on `scm.countBadge` setting:\n- `'all'` - Sum of all repositories\n- `'focused'` - Only focused repository\n- `'off'` - Disabled\n\nImplementation in `SCMActiveRepositoryController` [src/vs/workbench/contrib/scm/browser/activity.ts:32-185]() uses observables to react to repository resource changes and update the badge.\n\n### Status Bar Commands\n\nProviders can expose status bar commands via the `statusBarCommands` observable [src/vs/workbench/contrib/scm/common/scm.ts:94]().\n\nCommands are rendered in the status bar with:\n- Command title as button text\n- Command tooltip\n- Provider icon (if multiple repositories)\n\n**Sources:** [src/vs/workbench/contrib/scm/browser/activity.ts:1-250]()"])</script><script>self.__next_f.push([1,"47:T5eed,"])</script><script>self.__next_f.push([1,"# SCM Framework Architecture\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [extensions/git/src/historyProvider.ts](extensions/git/src/historyProvider.ts)\n- [src/vs/workbench/api/browser/mainThreadSCM.ts](src/vs/workbench/api/browser/mainThreadSCM.ts)\n- [src/vs/workbench/api/common/extHostSCM.ts](src/vs/workbench/api/common/extHostSCM.ts)\n- [src/vs/workbench/contrib/scm/browser/activity.ts](src/vs/workbench/contrib/scm/browser/activity.ts)\n- [src/vs/workbench/contrib/scm/browser/media/scm.css](src/vs/workbench/contrib/scm/browser/media/scm.css)\n- [src/vs/workbench/contrib/scm/browser/menus.ts](src/vs/workbench/contrib/scm/browser/menus.ts)\n- [src/vs/workbench/contrib/scm/browser/scm.contribution.ts](src/vs/workbench/contrib/scm/browser/scm.contribution.ts)\n- [src/vs/workbench/contrib/scm/browser/scmHistory.ts](src/vs/workbench/contrib/scm/browser/scmHistory.ts)\n- [src/vs/workbench/contrib/scm/browser/scmHistoryViewPane.ts](src/vs/workbench/contrib/scm/browser/scmHistoryViewPane.ts)\n- [src/vs/workbench/contrib/scm/browser/scmRepositoriesViewPane.ts](src/vs/workbench/contrib/scm/browser/scmRepositoriesViewPane.ts)\n- [src/vs/workbench/contrib/scm/browser/scmRepositoryRenderer.ts](src/vs/workbench/contrib/scm/browser/scmRepositoryRenderer.ts)\n- [src/vs/workbench/contrib/scm/browser/scmViewPane.ts](src/vs/workbench/contrib/scm/browser/scmViewPane.ts)\n- [src/vs/workbench/contrib/scm/browser/scmViewService.ts](src/vs/workbench/contrib/scm/browser/scmViewService.ts)\n- [src/vs/workbench/contrib/scm/browser/util.ts](src/vs/workbench/contrib/scm/browser/util.ts)\n- [src/vs/workbench/contrib/scm/browser/workingSet.ts](src/vs/workbench/contrib/scm/browser/workingSet.ts)\n- [src/vs/workbench/contrib/scm/common/history.ts](src/vs/workbench/contrib/scm/common/history.ts)\n- [src/vs/workbench/contrib/scm/common/scm.ts](src/vs/workbench/contrib/scm/common/scm.ts)\n- [src/vs/workbench/contrib/scm/test/browser/scmHistory.test.ts](src/vs/workbench/contrib/scm/test/browser/scmHistory.test.ts)\n- [src/vscode-dts/vscode.proposed.scmHistoryProvider.d.ts](src/vscode-dts/vscode.proposed.scmHistoryProvider.d.ts)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis document explains the SCM (Source Control Management) framework architecture in VS Code, focusing on the service layer, provider system, and repository management. It covers how the framework enables multiple SCM providers to register and manage repositories, how providers expose resources and groups to the UI, and how the system coordinates between the extension host (where providers run) and the main thread (where UI renders). For SCM provider implementation details (ISCMProvider interface), see [9.2](#9.2); for SCM views and UI components, see [9.3](#9.3); for the Git extension's implementation, see [10.1](#10.1).\n\n## SCM Service Layer Architecture\n\nThe SCM framework consists of two primary services that manage providers and repositories:\n\n**Service Layer Diagram:**\n\n```mermaid\ngraph TB\n    ISCMService[\"ISCMService\u003cbr/\u003e(scmService.ts)\u003cbr/\u003eCore service managing all repositories\"]\n    ISCMViewService[\"ISCMViewService\u003cbr/\u003e(scmViewService.ts)\u003cbr/\u003eManages visible repositories and UI state\"]\n    \n    MainThreadSCM[\"MainThreadSCM\u003cbr/\u003e(mainThreadSCM.ts)\u003cbr/\u003eProvider registration from extensions\"]\n    \n    subgraph \"Service Methods\"\n        RegisterProvider[\"registerSCMProvider()\u003cbr/\u003eRegister new provider\"]\n        GetRepository[\"getRepository()\u003cbr/\u003eLookup by id or URI\"]\n        Repositories[\"repositories: Iterable\u003cISCMRepository\u003e\u003cbr/\u003eAll registered repositories\"]\n    end\n    \n    subgraph \"Events\"\n        OnDidAdd[\"onDidAddRepository\u003cbr/\u003eFired when repository added\"]\n        OnDidRemove[\"onDidRemoveRepository\u003cbr/\u003eFired when repository removed\"]\n    end\n    \n    MainThreadSCM --\u003e|\"calls\"| RegisterProvider\n    RegisterProvider --\u003e ISCMService\n    ISCMService --\u003e Repositories\n    ISCMService --\u003e OnDidAdd\n    ISCMService --\u003e OnDidRemove\n    \n    ISCMViewService --\u003e|\"reads from\"| ISCMService\n    ISCMViewService --\u003e|\"filters\"| VisibleRepos[\"visibleRepositories\u003cbr/\u003eRepositories shown in SCM view\"]\n```\n\n**ISCMService:**\n\n[src/vs/workbench/contrib/scm/common/scm.ts:179-191]() defines the core service interface:\n\n```typescript\nexport interface ISCMService {\n    readonly onDidAddRepository: Event\u003cISCMRepository\u003e;\n    readonly onDidRemoveRepository: Event\u003cISCMRepository\u003e;\n    readonly repositories: Iterable\u003cISCMRepository\u003e;\n    readonly repositoryCount: number;\n    \n    registerSCMProvider(provider: ISCMProvider): ISCMRepository;\n    getRepository(id: string): ISCMRepository | undefined;\n    getRepository(resource: URI): ISCMRepository | undefined;\n}\n```\n\nThe service implementation in [src/vs/workbench/contrib/scm/common/scmService.ts]() maintains a collection of repositories and provides methods for:\n- Provider registration and repository creation\n- Repository lookup by ID or workspace resource URI\n- Event notification for repository lifecycle changes\n\n**ISCMViewService:**\n\n[src/vs/workbench/contrib/scm/common/scm.ts:226-266]() defines the view service interface. The implementation in [src/vs/workbench/contrib/scm/browser/scmViewService.ts]() manages:\n- Which repositories are visible in the SCM view\n- Repository selection mode (single vs. multiple)\n- Active repository tracking for status bar and UI\n- Repository sorting and filtering\n\nSources: [src/vs/workbench/contrib/scm/common/scm.ts:179-267](), [src/vs/workbench/contrib/scm/common/scmService.ts](), [src/vs/workbench/contrib/scm/browser/scmViewService.ts:1-400]()\n\n## Core Provider and Repository Interfaces\n\nThe SCM framework defines a hierarchy of interfaces that providers must implement:\n\n**Interface Hierarchy:**\n\n```mermaid\nclassDiagram\n    class ISCMProvider {\n        +string id\n        +string providerId\n        +string label\n        +string name\n        +URI rootUri\n        +ISCMResourceGroup[] groups\n        +IObservable contextValue\n        +IObservable count\n        +IObservable commitTemplate\n        +Event onDidChangeResourceGroups\n        +Event onDidChangeResources\n    }\n    \n    class ISCMRepository {\n        +string id\n        +ISCMProvider provider\n        +ISCMInput input\n    }\n    \n    class ISCMResourceGroup {\n        +string id\n        +string label\n        +ISCMProvider provider\n        +ISCMResource[] resources\n        +ResourceTree resourceTree\n        +boolean hideWhenEmpty\n        +Event onDidChange\n        +Event onDidChangeResources\n    }\n    \n    class ISCMResource {\n        +URI sourceUri\n        +ISCMResourceGroup resourceGroup\n        +ISCMResourceDecorations decorations\n        +Command command\n        +string contextValue\n        +URI multiDiffEditorOriginalUri\n        +URI multiDiffEditorModifiedUri\n    }\n    \n    class ISCMInput {\n        +string value\n        +string placeholder\n        +IInputValidator validateInput\n        +boolean enabled\n        +boolean visible\n        +Event onDidChange\n    }\n    \n    ISCMRepository --\u003e ISCMProvider\n    ISCMRepository --\u003e ISCMInput\n    ISCMProvider --\u003e ISCMResourceGroup\n    ISCMResourceGroup --\u003e ISCMResource\n```\n\n**Interface Summary:**\n\n| Interface | Location | Purpose |\n|-----------|----------|---------|\n| `ISCMProvider` | [src/vs/workbench/contrib/scm/common/scm.ts:72-97]() | Core provider interface exposing resource groups, observables for UI state |\n| `ISCMRepository` | [src/vs/workbench/contrib/scm/common/scm.ts:173-177]() | Container for provider and input box |\n| `ISCMResourceGroup` | [src/vs/workbench/contrib/scm/common/scm.ts:56-70]() | Logical grouping of resources (e.g., \"Changes\", \"Staged\") |\n| `ISCMResource` | [src/vs/workbench/contrib/scm/common/scm.ts:45-54]() | Individual file change with decorations and commands |\n| `ISCMInput` | [src/vs/workbench/contrib/scm/common/scm.ts:141-171]() | Commit message input box with validation |\n\nSources: [src/vs/workbench/contrib/scm/common/scm.ts:1-267]()\n\n## Provider Registration Flow\n\nWhen an extension creates an SCM provider using the `vscode.scm.createSourceControl()` API, the following registration flow occurs:\n\n**Provider Registration Sequence:**\n\n```mermaid\nsequenceDiagram\n    participant Ext as Extension\u003cbr/\u003e(e.g., Git)\n    participant ExtHostSCM as ExtHostSCM\u003cbr/\u003e(extHostSCM.ts)\n    participant Proxy as RPC Protocol\n    participant MainThreadSCM as MainThreadSCM\u003cbr/\u003e(mainThreadSCM.ts)\n    participant SCMService as ISCMService\u003cbr/\u003e(scmService.ts)\n    participant UI as SCM View\n    \n    Ext-\u003e\u003eExtHostSCM: createSourceControl(id, label, rootUri)\n    ExtHostSCM-\u003e\u003eExtHostSCM: Create ExtHostSourceControl\n    ExtHostSCM-\u003e\u003eProxy: $registerSourceControl(handle, id, label, rootUri)\n    Proxy-\u003e\u003eMainThreadSCM: registerSourceControl\n    MainThreadSCM-\u003e\u003eMainThreadSCM: new MainThreadSCMProvider\n    MainThreadSCM-\u003e\u003eSCMService: registerSCMProvider(provider)\n    SCMService-\u003e\u003eSCMService: Create ISCMRepository\n    SCMService-\u003e\u003eUI: Fire onDidAddRepository event\n    UI-\u003e\u003eUI: Render new repository\n```\n\n**MainThreadSCMProvider:**\n\n[src/vs/workbench/api/browser/mainThreadSCM.ts:281-598]() implements `MainThreadSCMProvider` which adapts the extension host provider to the core `ISCMProvider` interface:\n\nKey responsibilities:\n- Maintains resource groups from extension host\n- Exposes observables for UI state (`contextValue`, `count`, `commitTemplate`, `actionButton`, `statusBarCommands`)\n- Bridges extension API to core SCM interfaces\n- Manages history provider and artifact provider if available\n\n**SCMService Repository Management:**\n\n[src/vs/workbench/contrib/scm/common/scmService.ts]() handles provider registration:\n\n```typescript\nregisterSCMProvider(provider: ISCMProvider): ISCMRepository {\n    const disposable = provider.groups.onDidSplice(onDidSplice);\n    const repository = { id, provider, input, dispose };\n    this._repositories.push(repository);\n    this._onDidAddRepository.fire(repository);\n    return repository;\n}\n```\n\nSources: [src/vs/workbench/api/common/extHostSCM.ts:517-618](), [src/vs/workbench/api/browser/mainThreadSCM.ts:281-598](), [src/vs/workbench/contrib/scm/common/scmService.ts]()\n\n## Resource Groups and Resources\n\nProviders organize file changes into resource groups, which are then rendered in the SCM view:\n\n**Resource Group Structure:**\n\n```mermaid\ngraph TB\n    ISCMProvider[\"ISCMProvider\u003cbr/\u003egroups: ISCMResourceGroup[]\"]\n    \n    subgraph \"Resource Groups (provider-defined)\"\n        Group1[\"ISCMResourceGroup\u003cbr/\u003eid: 'merge'\u003cbr/\u003elabel: 'Merge Changes'\"]\n        Group2[\"ISCMResourceGroup\u003cbr/\u003eid: 'index'\u003cbr/\u003elabel: 'Staged Changes'\"]\n        Group3[\"ISCMResourceGroup\u003cbr/\u003eid: 'workingTree'\u003cbr/\u003elabel: 'Changes'\"]\n    end\n    \n    subgraph \"Resources in Group\"\n        Resource1[\"ISCMResource\u003cbr/\u003esourceUri: file:///path/file.ts\u003cbr/\u003edecorations: { icon, tooltip, ... }\"]\n        Resource2[\"ISCMResource\u003cbr/\u003esourceUri: file:///path/other.ts\"]\n    end\n    \n    subgraph \"Resource Tree (Tree View Mode)\"\n        ResourceTree[\"ResourceTree\u003cbr/\u003eFolder hierarchy\"]\n        FolderNode[\"IResourceNode\u003cbr/\u003eFolder: 'src'\"]\n    end\n    \n    ISCMProvider --\u003e Group1\n    ISCMProvider --\u003e Group2\n    ISCMProvider --\u003e Group3\n    \n    Group2 --\u003e Resource1\n    Group2 --\u003e Resource2\n    \n    Group2 --\u003e ResourceTree\n    ResourceTree --\u003e FolderNode\n    FolderNode --\u003e Resource1\n    FolderNode --\u003e Resource2\n```\n\n**Resource Group Management:**\n\n[src/vs/workbench/api/browser/mainThreadSCM.ts:81-143]() implements `MainThreadSCMResourceGroup`:\n\n- Maintains array of `ISCMResource` instances\n- Builds `ResourceTree` for tree view mode on demand\n- Fires `onDidChangeResources` when resources are spliced\n- Supports `hideWhenEmpty` property to auto-hide empty groups\n\n**Resource Updates via Splices:**\n\nExtensions update resources using splice operations for efficiency. [src/vs/workbench/api/browser/mainThreadSCM.ts:302-349]() handles `$spliceResourceStates`:\n\n```typescript\n$spliceResourceStates(sourceControlHandle: number, splices: SCMRawResourceSplices[]): void {\n    for (const [groupHandle, groupSlices] of splices) {\n        const group = this._groups.get(groupHandle);\n        for (const [start, deleteCount, rawResources] of groupSlices) {\n            const resources = rawResources.map(rawResource =\u003e \n                new MainThreadSCMResource(proxy, handle, groupHandle, rawResource)\n            );\n            group.splice(start, deleteCount, resources);\n        }\n    }\n}\n```\n\n**Resource Decorations:**\n\n[src/vs/workbench/contrib/scm/common/scm.ts:37-43]() defines `ISCMResourceDecorations`:\n\n| Property | Type | Purpose |\n|----------|------|---------|\n| `icon` | `URI \\| ThemeIcon` | Status icon (e.g., modified, added, deleted) |\n| `iconDark` | `URI \\| ThemeIcon` | Dark theme variant |\n| `tooltip` | `string` | Hover text (e.g., \"Modified\", \"Untracked\") |\n| `strikeThrough` | `boolean` | Visual treatment for deleted files |\n| `faded` | `boolean` | Opacity for less important resources |\n\nSources: [src/vs/workbench/contrib/scm/common/scm.ts:37-70](), [src/vs/workbench/api/browser/mainThreadSCM.ts:81-143](), [src/vs/workbench/api/browser/mainThreadSCM.ts:302-349]()\n\n## SCM Input Box\n\nEach SCM repository includes an input box for commit messages or similar text input:\n\n**ISCMInput Interface:**\n\n[src/vs/workbench/contrib/scm/common/scm.ts:141-171]() defines the input box interface:\n\n```typescript\nexport interface ISCMInput {\n    readonly value: string;\n    setValue(value: string, fromKeyboard: boolean): void;\n    readonly onDidChange: Event\u003cISCMInputChangeEvent\u003e;\n    \n    placeholder: string;\n    validateInput: IInputValidator;\n    enabled: boolean;\n    visible: boolean;\n    \n    setFocus(): void;\n    showValidationMessage(message: string | IMarkdownString, type: InputValidationType): void;\n    clearValidation(): void;\n}\n```\n\n**Input Validation:**\n\nThe `IInputValidator` function type [src/vs/workbench/contrib/scm/common/scm.ts:115-117]() allows providers to validate input:\n\n```typescript\nexport interface IInputValidator {\n    (value: string, cursorPosition: number): Promise\u003cIInputValidation | undefined\u003e;\n}\n```\n\nValidation results include message and type (Error, Warning, Information).\n\n**Input Box in Extension API:**\n\nExtensions access the input box through the `SourceControlInputBox` API. [src/vs/workbench/api/common/extHostSCM.ts:277-388]() implements `ExtHostSCMInputBox`:\n\n- Syncs `value` between extension and main thread\n- Provides `validateInput` callback for custom validation\n- Manages `enabled` and `visible` states\n- Exposes underlying text document for advanced scenarios\n\nSources: [src/vs/workbench/contrib/scm/common/scm.ts:99-171](), [src/vs/workbench/api/common/extHostSCM.ts:277-388]()\n\n## Provider UI Contributions\n\nProviders can contribute UI elements to enhance the SCM view:\n\n**Action Buttons:**\n\n[src/vs/workbench/contrib/scm/common/scm.ts:129-133]() defines `ISCMActionButtonDescriptor`:\n\n```typescript\nexport interface ISCMActionButtonDescriptor {\n    command: Command \u0026 { shortTitle?: string };\n    secondaryCommands?: Command[][];\n    enabled: boolean;\n}\n```\n\nProviders expose an action button via the `actionButton` observable [src/vs/workbench/contrib/scm/common/scm.ts:93](). The button is rendered prominently in the SCM view header. For example, Git uses this for \"Sync Changes\", \"Publish Branch\", or \"Checkout To\" actions.\n\n**Status Bar Commands:**\n\nProviders expose status bar commands via the `statusBarCommands` observable [src/vs/workbench/contrib/scm/common/scm.ts:94](). These commands appear in the status bar showing branch name, sync status, and other repository information.\n\n**Count Badge:**\n\nThe `count` observable [src/vs/workbench/contrib/scm/common/scm.ts:88]() controls the badge shown on the SCM view icon in the activity bar. Providers can set this to show the number of pending changes.\n\n**Commit Template:**\n\nThe `commitTemplate` observable [src/vs/workbench/contrib/scm/common/scm.ts:89]() provides default text for the input box, useful for commit message templates or conventions.\n\nSources: [src/vs/workbench/contrib/scm/common/scm.ts:72-97](), [src/vs/workbench/api/browser/mainThreadSCM.ts:281-598]()\n\n## Extension Host to Main Thread Communication\n\nThe SCM framework uses VS Code's RPC protocol to bridge the extension host (where providers run) and the main thread (where UI renders):\n\n**RPC Communication Architecture:**\n\n```mermaid\nsequenceDiagram\n    participant ExtAPI as Extension\u003cbr/\u003evscode.scm API\n    participant ExtHostSCM as ExtHostSCM\u003cbr/\u003e(extHostSCM.ts)\n    participant Proxy as RPC Protocol\u003cbr/\u003eExtHostSCMShape\n    participant MainThreadSCM as MainThreadSCM\u003cbr/\u003e(mainThreadSCM.ts)\n    participant SCMService as ISCMService\n    \n    ExtAPI-\u003e\u003eExtHostSCM: createSourceControl(id, label)\n    ExtHostSCM-\u003e\u003eProxy: $registerSourceControl(handle, id, label, rootUri)\n    Proxy-\u003e\u003eMainThreadSCM: $registerSourceControl\n    MainThreadSCM-\u003e\u003eSCMService: registerSCMProvider(provider)\n    \n    ExtAPI-\u003e\u003eExtHostSCM: group.resourceStates = [...]\n    ExtHostSCM-\u003e\u003eExtHostSCM: Compute splices\n    ExtHostSCM-\u003e\u003eProxy: $spliceResourceStates(handle, splices)\n    Proxy-\u003e\u003eMainThreadSCM: $spliceResourceStates\n    MainThreadSCM-\u003e\u003eMainThreadSCM: Apply resource updates\n    \n    ExtAPI-\u003e\u003eExtHostSCM: inputBox.value = \"message\"\n    ExtHostSCM-\u003e\u003eProxy: $setInputBoxValue(handle, value)\n    Proxy-\u003e\u003eMainThreadSCM: $setInputBoxValue\n```\n\n**ExtHostSCM:**\n\n[src/vs/workbench/api/common/extHostSCM.ts]() implements the extension-side SCM API:\n\n- `ExtHostSCM` - Manages all source controls created by extensions\n- `ExtHostSourceControl` [src/vs/workbench/api/common/extHostSCM.ts:515-708]() - Represents a single source control\n- `ExtHostSourceControlResourceGroup` [src/vs/workbench/api/common/extHostSCM.ts:390-514]() - Manages resource groups\n- `ExtHostSCMInputBox` [src/vs/workbench/api/common/extHostSCM.ts:277-388]() - Input box wrapper\n\n**Delta-Based Resource Updates:**\n\nTo minimize RPC traffic, the framework uses splice-based updates. When an extension updates `resourceGroup.resourceStates`, [src/vs/workbench/api/common/extHostSCM.ts:440-494]() computes a splice:\n\n```typescript\nset resourceStates(resources: vscode.SourceControlResourceState[]) {\n    const splices = sortedDiff(\n        this._resourceStates,\n        resources,\n        compareResourceStates\n    );\n    this._resourceStates = resources;\n    // Send only the delta\n    this._proxy.$spliceResourceStates(handle, [[start, deleteCount, rawResources]]);\n}\n```\n\n**MainThreadSCM:**\n\n[src/vs/workbench/api/browser/mainThreadSCM.ts]() handles RPC calls from extensions:\n\nKey classes:\n- `MainThreadSCM` [src/vs/workbench/api/browser/mainThreadSCM.ts:600-795]() - Main RPC handler\n- `MainThreadSCMProvider` [src/vs/workbench/api/browser/mainThreadSCM.ts:281-598]() - Adapts extension provider to `ISCMProvider`\n- `MainThreadSCMResourceGroup` [src/vs/workbench/api/browser/mainThreadSCM.ts:81-143]() - Implements `ISCMResourceGroup`\n- `MainThreadSCMResource` [src/vs/workbench/api/browser/mainThreadSCM.ts:145-173]() - Implements `ISCMResource`\n\nSources: [src/vs/workbench/api/common/extHostSCM.ts:1-767](), [src/vs/workbench/api/browser/mainThreadSCM.ts:1-795](), [src/vs/workbench/api/common/extHost.protocol.ts:12-14]()\n\n## Repository Management and Selection\n\nThe SCM framework supports multiple providers and repositories simultaneously:\n\n**Multi-Repository Architecture:**\n\n```mermaid\ngraph TB\n    ISCMService[\"ISCMService\u003cbr/\u003eCentral repository registry\"]\n    ISCMViewService[\"ISCMViewService\u003cbr/\u003eUI state management\"]\n    \n    subgraph \"All Repositories\"\n        Repo1[\"ISCMRepository\u003cbr/\u003eGit Repo 1\"]\n        Repo2[\"ISCMRepository\u003cbr/\u003eGit Repo 2\"]\n        Repo3[\"ISCMRepository\u003cbr/\u003eSVN Repo\"]\n    end\n    \n    subgraph \"Visible Repositories\"\n        VRepo1[\"Visible: Git Repo 1\"]\n        VRepo2[\"Visible: Git Repo 2\"]\n    end\n    \n    subgraph \"Active Repository\"\n        ActiveRepo[\"Active: Git Repo 1\u003cbr/\u003e(Shown in status bar)\"]\n    end\n    \n    ISCMService --\u003e Repo1\n    ISCMService --\u003e Repo2\n    ISCMService --\u003e Repo3\n    \n    ISCMViewService --\u003e|\"filters\"| VRepo1\n    ISCMViewService --\u003e|\"filters\"| VRepo2\n    \n    ISCMViewService --\u003e|\"tracks\"| ActiveRepo\n    \n    Repo1 -.-\u003e|\"maps to\"| VRepo1\n    Repo2 -.-\u003e|\"maps to\"| VRepo2\n    VRepo1 -.-\u003e|\"can be\"| ActiveRepo\n```\n\n**SCMViewService Repository Management:**\n\n[src/vs/workbench/contrib/scm/browser/scmViewService.ts]() implements `ISCMViewService` with:\n\n- `repositories` - All registered repositories from `ISCMService`\n- `visibleRepositories` - Subset shown in SCM view based on user selection\n- `activeRepository` - Observable tracking the currently active repository (shown in status bar)\n- `selectionModeConfig` - Observable for single vs. multiple selection mode\n- `toggleVisibility(repository, visible?)` - Show/hide repository in SCM view\n\n**Repository Selection Modes:**\n\n[src/vs/workbench/contrib/scm/common/scm.ts:221-224]() defines two selection modes:\n\n```typescript\nexport const enum ISCMRepositorySelectionMode {\n    Single = 'single',\n    Multiple = 'multiple'\n}\n```\n\n- **Single Mode**: Only one repository visible at a time, provides cleaner UI\n- **Multiple Mode**: Multiple repositories visible simultaneously\n\n**Repository Sorting:**\n\n[src/vs/workbench/contrib/scm/common/scm.ts:215-219]() defines sort keys:\n\n```typescript\nexport const enum ISCMRepositorySortKey {\n    DiscoveryTime = 'discoveryTime',\n    Name = 'name',\n    Path = 'path'\n}\n```\n\nThe `SCMViewService` manages repository order based on the configured sort key.\n\n**Active Repository Tracking:**\n\nThe active repository is determined by:\n1. User-pinned repository via `pinActiveRepository()`\n2. Repository associated with the active editor's file\n3. Focused repository in the SCM view\n\n[src/vs/workbench/contrib/scm/browser/scmViewService.ts:134-284]() implements the active repository logic as an observable that updates based on editor changes and user interactions.\n\n**Repository Context Keys:**\n\n[src/vs/workbench/contrib/scm/browser/activity.ts]() sets context keys for the active repository:\n- `scmActiveRepositoryName` - Repository name\n- `scmActiveRepositoryBranchName` - Current branch name (from history provider)\n\nThese context keys enable/disable menu items and commands based on the active repository state.\n\nSources: [src/vs/workbench/contrib/scm/browser/scmViewService.ts:1-623](), [src/vs/workbench/contrib/scm/common/scm.ts:179-267](), [src/vs/workbench/contrib/scm/browser/activity.ts:1-248]()\n\n## Multi-Provider Support\n\nVS Code's SCM framework supports multiple providers simultaneously (e.g., multiple Git repositories, Git + SVN):\n\n```mermaid\ngraph TB\n    SCMService[\"ISCMService\u003cbr/\u003e(scmService.ts)\"]\n    SCMViewService[\"ISCMViewService\u003cbr/\u003e(scmViewService.ts)\"]\n    \n    subgraph \"Repositories\"\n        Repo1[\"Git Repo 1\u003cbr/\u003eISCMRepository\"]\n        Repo2[\"Git Repo 2\u003cbr/\u003eISCMRepository\"]\n        Repo3[\"SVN Repo\u003cbr/\u003eISCMRepository\"]\n    end\n    \n    SCMService --\u003e|\"manages\"| Repo1\n    SCMService --\u003e|\"manages\"| Repo2\n    SCMService --\u003e|\"manages\"| Repo3\n    \n    SCMViewService --\u003e|\"visible repos\"| VisibleRepos[\"Visible Repositories\u003cbr/\u003eShown in SCM view\"]\n    \n    Repo1 --\u003e VisibleRepos\n    Repo2 --\u003e VisibleRepos\n```\n\n### Service Architecture\n\n**SCMService:**\n\n[src/vs/workbench/contrib/scm/common/scmService.ts]() - Manages all registered repositories\n\n- `registerSCMProvider()` - Registers a new provider\n- `repositories` - Array of all repositories\n- `onDidAddRepository` / `onDidRemoveRepository` - Events for repository changes\n\n**SCMViewService:**\n\n[src/vs/workbench/contrib/scm/browser/scmViewService.ts:1-531]()\n\n- Manages which repositories are visible in the SCM view\n- `visibleRepositories` - Currently displayed repositories\n- Provides repository picker for switching between providers\n\n### Repository Selection\n\nThe SCM view allows users to select which repositories to display:\n\n[src/vs/workbench/contrib/scm/browser/scmViewService.ts:312-397]() - `RepositoryPicker` class\n\nUsers can:\n1. View all repositories in a quick pick\n2. Select one or multiple repositories to display\n3. Toggle repository visibility in the SCM view\n\nSources: [src/vs/workbench/contrib/scm/common/scmService.ts](), [src/vs/workbench/contrib/scm/browser/scmViewService.ts:1-531](), [src/vs/workbench/contrib/scm/browser/scmRepositoriesViewPane.ts:1-429]()"])</script><script>self.__next_f.push([1,"48:T50d8,"])</script><script>self.__next_f.push([1,"# SCM Provider System\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [extensions/git/src/historyProvider.ts](extensions/git/src/historyProvider.ts)\n- [src/vs/workbench/api/browser/mainThreadSCM.ts](src/vs/workbench/api/browser/mainThreadSCM.ts)\n- [src/vs/workbench/api/common/extHostSCM.ts](src/vs/workbench/api/common/extHostSCM.ts)\n- [src/vs/workbench/contrib/scm/browser/activity.ts](src/vs/workbench/contrib/scm/browser/activity.ts)\n- [src/vs/workbench/contrib/scm/browser/media/scm.css](src/vs/workbench/contrib/scm/browser/media/scm.css)\n- [src/vs/workbench/contrib/scm/browser/menus.ts](src/vs/workbench/contrib/scm/browser/menus.ts)\n- [src/vs/workbench/contrib/scm/browser/scm.contribution.ts](src/vs/workbench/contrib/scm/browser/scm.contribution.ts)\n- [src/vs/workbench/contrib/scm/browser/scmHistory.ts](src/vs/workbench/contrib/scm/browser/scmHistory.ts)\n- [src/vs/workbench/contrib/scm/browser/scmHistoryViewPane.ts](src/vs/workbench/contrib/scm/browser/scmHistoryViewPane.ts)\n- [src/vs/workbench/contrib/scm/browser/scmRepositoriesViewPane.ts](src/vs/workbench/contrib/scm/browser/scmRepositoriesViewPane.ts)\n- [src/vs/workbench/contrib/scm/browser/scmRepositoryRenderer.ts](src/vs/workbench/contrib/scm/browser/scmRepositoryRenderer.ts)\n- [src/vs/workbench/contrib/scm/browser/scmViewPane.ts](src/vs/workbench/contrib/scm/browser/scmViewPane.ts)\n- [src/vs/workbench/contrib/scm/browser/scmViewService.ts](src/vs/workbench/contrib/scm/browser/scmViewService.ts)\n- [src/vs/workbench/contrib/scm/browser/util.ts](src/vs/workbench/contrib/scm/browser/util.ts)\n- [src/vs/workbench/contrib/scm/browser/workingSet.ts](src/vs/workbench/contrib/scm/browser/workingSet.ts)\n- [src/vs/workbench/contrib/scm/common/history.ts](src/vs/workbench/contrib/scm/common/history.ts)\n- [src/vs/workbench/contrib/scm/common/scm.ts](src/vs/workbench/contrib/scm/common/scm.ts)\n- [src/vs/workbench/contrib/scm/test/browser/scmHistory.test.ts](src/vs/workbench/contrib/scm/test/browser/scmHistory.test.ts)\n- [src/vscode-dts/vscode.proposed.scmHistoryProvider.d.ts](src/vscode-dts/vscode.proposed.scmHistoryProvider.d.ts)\n\n\u003c/details\u003e\n\n\n\nThis page documents the SCM provider system, which defines the interface that source control extensions implement to expose version control data to VS Code. The provider system manages the hierarchy of repositories, resource groups, and resources, along with their decorations, commands, and state.\n\nFor information about the overall SCM framework and service architecture, see [SCM Framework Architecture](#9.1). For details about the UI components that render provider data, see [SCM Views and UI Components](#9.3). For history provider functionality, see [SCM History Provider](#9.4).\n\n## Provider Interface and Repository Structure\n\nThe core of the SCM provider system is the `ISCMProvider` interface, which extensions implement to expose source control data. Each provider is wrapped in an `ISCMRepository` which adds input box functionality and serves as the top-level container.\n\n### Provider Interface\n\n```mermaid\ngraph TD\n    ISCMRepository[\"ISCMRepository\"]\n    ISCMProvider[\"ISCMProvider\u003cbr/\u003eCore Provider Interface\"]\n    ISCMInput[\"ISCMInput\u003cbr/\u003eCommit Message Input\"]\n    \n    ISCMRepository --\u003e|contains| ISCMProvider\n    ISCMRepository --\u003e|contains| ISCMInput\n    \n    ISCMProvider --\u003e|groups| ISCMResourceGroup1[\"ISCMResourceGroup\u003cbr/\u003ee.g., 'Changes'\"]\n    ISCMProvider --\u003e|groups| ISCMResourceGroup2[\"ISCMResourceGroup\u003cbr/\u003ee.g., 'Staged'\"]\n    \n    ISCMResourceGroup1 --\u003e|resources| ISCMResource1[\"ISCMResource\u003cbr/\u003efile1.ts\"]\n    ISCMResourceGroup1 --\u003e|resources| ISCMResource2[\"ISCMResource\u003cbr/\u003efile2.ts\"]\n    \n    ISCMResourceGroup2 --\u003e|resources| ISCMResource3[\"ISCMResource\u003cbr/\u003efile3.ts\"]\n    \n    ISCMProvider --\u003e|observables| ProviderState[\"count: IObservable\u003cbr/\u003econtextValue: IObservable\u003cbr/\u003ecommitTemplate: IObservable\u003cbr/\u003eactionButton: IObservable\u003cbr/\u003estatusBarCommands: IObservable\"]\n```\n\n**Sources:** [src/vs/workbench/contrib/scm/common/scm.ts:72-97](), [src/vs/workbench/contrib/scm/common/scm.ts:173-177]()\n\nThe `ISCMProvider` interface defines the following key properties:\n\n| Property | Type | Description |\n|----------|------|-------------|\n| `id` | `string` | Unique identifier for the provider instance |\n| `providerId` | `string` | Type of provider (e.g., \"git\") |\n| `label` | `string` | Display label (e.g., \"Git\") |\n| `name` | `string` | Repository name |\n| `groups` | `readonly ISCMResourceGroup[]` | Resource groups containing changed files |\n| `rootUri` | `URI` (optional) | Root directory of the repository |\n| `count` | `IObservable\u003cnumber\u003e` | Count badge number |\n| `commitTemplate` | `IObservable\u003cstring\u003e` | Template for commit messages |\n| `actionButton` | `IObservable\u003cISCMActionButtonDescriptor\u003e` | Primary action button |\n| `statusBarCommands` | `IObservable\u003creadonly Command[]\u003e` | Commands shown in status bar |\n| `contextValue` | `IObservable\u003cstring\u003e` | Context key for menu contributions |\n\n**Sources:** [src/vs/workbench/contrib/scm/common/scm.ts:72-97]()\n\n## Resource Groups and Resources\n\nResource groups organize related resources (files) and provide grouping semantics like \"Changes\", \"Staged Changes\", \"Merge Changes\", etc.\n\n### Resource Group Structure\n\n```mermaid\ngraph LR\n    subgraph \"ISCMResourceGroup\"\n        RG_id[\"id: string\u003cbr/\u003e'workingTree'\"]\n        RG_label[\"label: string\u003cbr/\u003e'Changes'\"]\n        RG_resources[\"resources: ISCMResource[]\"]\n        RG_hideWhenEmpty[\"hideWhenEmpty: boolean\"]\n        RG_contextValue[\"contextValue: string\"]\n        RG_resourceTree[\"resourceTree: ResourceTree\"]\n    end\n    \n    subgraph \"ISCMResource\"\n        R_sourceUri[\"sourceUri: URI\u003cbr/\u003efile path\"]\n        R_decorations[\"decorations:\u003cbr/\u003eISCMResourceDecorations\"]\n        R_command[\"command: Command\u003cbr/\u003eopen action\"]\n        R_contextValue[\"contextValue: string\u003cbr/\u003emenu context\"]\n        R_resourceGroup[\"resourceGroup: ISCMResourceGroup\"]\n    end\n    \n    RG_resources --\u003e|contains| R_sourceUri\n    \n    subgraph \"ISCMResourceDecorations\"\n        D_icon[\"icon: URI | ThemeIcon\"]\n        D_tooltip[\"tooltip: string\"]\n        D_strikeThrough[\"strikeThrough: boolean\"]\n        D_faded[\"faded: boolean\"]\n    end\n    \n    R_decorations --\u003e|defines| D_icon\n```\n\n**Sources:** [src/vs/workbench/contrib/scm/common/scm.ts:56-70](), [src/vs/workbench/contrib/scm/common/scm.ts:37-43]()\n\n### Resource Decorations\n\nResources expose decorations that control their visual appearance:\n\n| Decoration | Type | Purpose |\n|------------|------|---------|\n| `icon` / `iconDark` | `URI \\| ThemeIcon` | Icon shown next to the resource |\n| `tooltip` | `string` | Hover text (often shows status like \"Modified\") |\n| `strikeThrough` | `boolean` | Strike through text (e.g., for deleted files) |\n| `faded` | `boolean` | Fade the resource (e.g., for ignored files) |\n\n**Sources:** [src/vs/workbench/contrib/scm/common/scm.ts:37-43]()\n\n### Resource Tree\n\nResource groups maintain both a flat `resources` array and a hierarchical `resourceTree` for tree view rendering:\n\n```mermaid\ngraph TD\n    ResourceGroup[\"ISCMResourceGroup\"]\n    FlatArray[\"resources: ISCMResource[]\u003cbr/\u003eFlat list for list view\"]\n    TreeStructure[\"resourceTree: ResourceTree\u003cbr/\u003eHierarchical for tree view\"]\n    \n    ResourceGroup --\u003e|exposes| FlatArray\n    ResourceGroup --\u003e|exposes| TreeStructure\n    \n    TreeStructure --\u003e|builds from| FlatArray\n    TreeStructure --\u003e|uses| rootUri[\"rootUri: URI\u003cbr/\u003eBase for hierarchy\"]\n    TreeStructure --\u003e|creates| IResourceNode[\"IResourceNode\u003cbr/\u003eFolder nodes\"]\n    \n    IResourceNode --\u003e|children| IResourceNode\n    IResourceNode --\u003e|element| ISCMResource[\"ISCMResource\u003cbr/\u003eFile leaf nodes\"]\n```\n\n**Sources:** [src/vs/workbench/api/browser/mainThreadSCM.ts:81-96](), [src/vs/workbench/contrib/scm/common/scm.ts:61]()\n\nThe `ResourceTree` is built lazily when first accessed and organizes resources by their URI paths relative to the provider's `rootUri`. This enables the tree view mode where files are organized by folder structure.\n\n## Provider Implementation: Extension Host to Main Thread\n\nThe provider system uses VS Code's RPC architecture to bridge the extension host (where extensions run) with the main thread (where UI runs).\n\n### Communication Architecture\n\n```mermaid\ngraph LR\n    subgraph \"Extension Host Process\"\n        ExtensionCode[\"Extension Code\u003cbr/\u003evscode.scm.createSourceControl()\"]\n        ExtHostSCMProvider[\"ExtHostSCMProvider\"]\n        ExtHostResourceGroup[\"ExtHostSourceControlResourceGroup\"]\n        ExtHostProxy[\"proxy: MainThreadSCMShape\u003cbr/\u003eRPC proxy\"]\n    end\n    \n    subgraph \"IPC Boundary\"\n        Protocol[\"extHost.protocol.ts\u003cbr/\u003eSCM RPC Messages\"]\n    end\n    \n    subgraph \"Main Thread (Renderer)\"\n        MainThreadSCM[\"MainThreadSCM\"]\n        MainThreadSCMProvider[\"MainThreadSCMProvider\u003cbr/\u003eimplements ISCMProvider\"]\n        MainThreadResourceGroup[\"MainThreadSCMResourceGroup\u003cbr/\u003eimplements ISCMResourceGroup\"]\n        MainThreadResource[\"MainThreadSCMResource\u003cbr/\u003eimplements ISCMResource\"]\n        ISCMService[\"ISCMService\u003cbr/\u003eProvider Registry\"]\n    end\n    \n    ExtensionCode --\u003e|creates| ExtHostSCMProvider\n    ExtHostSCMProvider --\u003e|creates| ExtHostResourceGroup\n    ExtHostResourceGroup --\u003e|updates| ExtHostProxy\n    \n    ExtHostProxy \u003c--\u003e|$registerSCMProvider\u003cbr/\u003e$updateGroup\u003cbr/\u003e$spliceResourceStates| Protocol\n    Protocol \u003c--\u003e|RPC calls| MainThreadSCM\n    \n    MainThreadSCM --\u003e|manages| MainThreadSCMProvider\n    MainThreadSCMProvider --\u003e|contains| MainThreadResourceGroup\n    MainThreadResourceGroup --\u003e|contains| MainThreadResource\n    MainThreadSCMProvider --\u003e|registers with| ISCMService\n```\n\n**Sources:** [src/vs/workbench/api/common/extHostSCM.ts:440-570](), [src/vs/workbench/api/browser/mainThreadSCM.ts:281-450]()\n\n### Provider Registration Flow\n\nWhen an extension creates a source control provider:\n\n1. **Extension calls** `vscode.scm.createSourceControl(id, label, rootUri)` [src/vs/workbench/api/common/extHostSCM.ts:923-946]()\n2. **ExtHostSCM creates** `ExtHostSCMProvider` instance [src/vs/workbench/api/common/extHostSCM.ts:925-934]()\n3. **Proxy call** `$registerSCMProvider()` to main thread [src/vs/workbench/api/common/extHostSCM.ts:938]()\n4. **MainThreadSCM creates** `MainThreadSCMProvider` implementing `ISCMProvider` [src/vs/workbench/api/browser/mainThreadSCM.ts:534-567]()\n5. **ISCMService registers** the provider, creating an `ISCMRepository` [src/vs/workbench/contrib/scm/common/scmService.ts:67-93]()\n6. **Events fire** `onDidAddRepository` to notify views [src/vs/workbench/contrib/scm/common/scmService.ts:87]()\n\n### Resource Updates via Splicing\n\nResource changes are communicated using a splice-based protocol for efficiency:\n\n```mermaid\nsequenceDiagram\n    participant Ext as Extension\n    participant EHSG as ExtHostResourceGroup\n    participant Proxy as RPC Proxy\n    participant MTSG as MainThreadResourceGroup\n    \n    Ext-\u003e\u003eEHSG: group.resourceStates = [...]\n    EHSG-\u003e\u003eEHSG: compute splices\u003cbr/\u003esortedDiff()\n    EHSG-\u003e\u003eProxy: $spliceResourceStates(handle, splice[])\n    Proxy-\u003e\u003eMTSG: splice(start, deleteCount, toInsert)\n    MTSG-\u003e\u003eMTSG: resources.splice()\n    MTSG-\u003e\u003eMTSG: invalidate resourceTree\n    MTSG-\u003e\u003eMTSG: fire onDidChangeResources\n```\n\n**Sources:** [src/vs/workbench/api/common/extHostSCM.ts:456-533](), [src/vs/workbench/api/browser/mainThreadSCM.ts:127-132]()\n\nThe splice protocol minimizes data transfer by only sending changes (additions, removals, modifications) rather than the entire resource list on every update. The `sortedDiff` algorithm [src/vs/workbench/api/common/extHostSCM.ts:486-502]() compares old and new resource states to compute minimal splice operations.\n\n## Provider State and Observables\n\nProvider state is exposed through observables that the UI can react to:\n\n### Observable Properties\n\n```mermaid\ngraph TD\n    MainThreadSCMProvider[\"MainThreadSCMProvider\"]\n    \n    MainThreadSCMProvider --\u003e|exposes| count_obs[\"count: IObservable\u003cnumber\u003e\u003cbr/\u003eBadge count\"]\n    MainThreadSCMProvider --\u003e|exposes| contextValue_obs[\"contextValue: IObservable\u003cstring\u003e\u003cbr/\u003eMenu context\"]\n    MainThreadSCMProvider --\u003e|exposes| commitTemplate_obs[\"commitTemplate: IObservable\u003cstring\u003e\u003cbr/\u003eInput template\"]\n    MainThreadSCMProvider --\u003e|exposes| actionButton_obs[\"actionButton: IObservable\u003cbr/\u003ePrimary action\"]\n    MainThreadSCMProvider --\u003e|exposes| statusBarCommands_obs[\"statusBarCommands: IObservable\u003cbr/\u003eStatus bar items\"]\n    \n    subgraph \"Updates from Extension\"\n        set_count[\"$setCount()\"]\n        set_contextValue[\"$updateSourceControl()\"]\n        set_commitTemplate[\"$setCommitTemplate()\"]\n        set_actionButton[\"$setActionButton()\"]\n        set_statusBarCommands[\"$setStatusBarCommands()\"]\n    end\n    \n    set_count --\u003e|updates| count_obs\n    set_contextValue --\u003e|updates| contextValue_obs\n    set_commitTemplate --\u003e|updates| commitTemplate_obs\n    set_actionButton --\u003e|updates| actionButton_obs\n    set_statusBarCommands --\u003e|updates| statusBarCommands_obs\n```\n\n**Sources:** [src/vs/workbench/api/browser/mainThreadSCM.ts:320-338](), [src/vs/workbench/api/browser/mainThreadSCM.ts:602-672]()\n\n### Action Button\n\nThe action button provides a primary action in the SCM view (e.g., \"Commit\", \"Publish Branch\"):\n\n```typescript\ninterface ISCMActionButtonDescriptor {\n    command: Command \u0026 { shortTitle?: string };\n    secondaryCommands?: Command[][];\n    enabled: boolean;\n}\n```\n\nThe action button can have:\n- A primary `command` with optional `shortTitle` for compact display\n- Secondary commands organized in groups (`Command[][]`) for dropdown menu\n- An `enabled` flag to disable the button\n\n**Sources:** [src/vs/workbench/contrib/scm/common/scm.ts:129-133](), [src/vs/workbench/api/browser/mainThreadSCM.ts:656-672]()\n\n## Input Box Integration\n\nEach repository has an associated input box for commit messages:\n\n```mermaid\ngraph TD\n    ISCMRepository[\"ISCMRepository\"]\n    ISCMInput[\"ISCMInput\"]\n    ISCMProvider[\"ISCMProvider\"]\n    \n    ISCMRepository --\u003e|contains| ISCMInput\n    ISCMRepository --\u003e|contains| ISCMProvider\n    \n    ISCMInput --\u003e|properties| value[\"value: string\u003cbr/\u003eCurrent message\"]\n    ISCMInput --\u003e|properties| placeholder[\"placeholder: string\u003cbr/\u003eHint text\"]\n    ISCMInput --\u003e|properties| enabled[\"enabled: boolean\"]\n    ISCMInput --\u003e|properties| visible[\"visible: boolean\"]\n    ISCMInput --\u003e|properties| validateInput[\"validateInput: IInputValidator\u003cbr/\u003eValidation function\"]\n    \n    ISCMProvider --\u003e|provides| acceptInputCommand[\"acceptInputCommand: Command\u003cbr/\u003eCommit action\"]\n    ISCMProvider --\u003e|provides| commitTemplate_prop[\"commitTemplate: IObservable\u003cstring\u003e\u003cbr/\u003eTemplate text\"]\n    \n    commitTemplate_prop -.-\u003e|populates| value\n    \n    subgraph \"Extension Host\"\n        ExtHostSCMInputBox[\"ExtHostSCMInputBox\"]\n        TextDocument[\"TextDocument\u003cbr/\u003escminput language\"]\n    end\n    \n    ExtHostSCMInputBox -.-\u003e|synchronizes with| ISCMInput\n    ExtHostSCMInputBox --\u003e|exposes| TextDocument\n```\n\n**Sources:** [src/vs/workbench/contrib/scm/common/scm.ts:141-171](), [src/vs/workbench/api/common/extHostSCM.ts:277-388]()\n\nThe input box is backed by a `TextDocument` with language ID `scminput` [src/vs/workbench/contrib/scm/browser/scm.contribution.ts:54-59](), allowing extensions to provide language features like completions and diagnostics for commit messages.\n\n### Input Validation\n\nExtensions can provide input validation:\n\n```mermaid\nsequenceDiagram\n    participant User as User Types\n    participant Input as SCMInputWidget\n    participant Validator as Extension Validator\n    \n    User-\u003e\u003eInput: Types commit message\n    Input-\u003e\u003eInput: Update value\n    Input-\u003e\u003eValidator: validateInput(value, cursorPosition)\n    Validator--\u003e\u003eInput: IInputValidation | undefined\n    Input-\u003e\u003eInput: Display validation message\n    \n    Note over Input: Validation types:\u003cbr/\u003eError (red)\u003cbr/\u003eWarning (yellow)\u003cbr/\u003eInformation (blue)\n```\n\n**Sources:** [src/vs/workbench/contrib/scm/common/scm.ts:104-117](), [src/vs/workbench/api/common/extHostSCM.ts:311-328]()\n\n## Context Values and Menu Contributions\n\nContext values enable extensions to contribute menus and commands that are contextual to specific resources, groups, or providers.\n\n### Context Value Hierarchy\n\n```mermaid\ngraph TD\n    Provider[\"ISCMProvider\u003cbr/\u003econtextValue: IObservable\u003cstring\u003e\"]\n    ResourceGroup[\"ISCMResourceGroup\u003cbr/\u003econtextValue: string\"]\n    Resource[\"ISCMResource\u003cbr/\u003econtextValue: string\"]\n    \n    Provider --\u003e|used in| ProviderMenus[\"MenuId.SCMTitle\u003cbr/\u003eMenuId.SCMSourceControl\"]\n    ResourceGroup --\u003e|used in| GroupMenus[\"MenuId.SCMResourceGroupContext\"]\n    Resource --\u003e|used in| ResourceMenus[\"MenuId.SCMResourceContext\"]\n    \n    subgraph \"Context Keys\"\n        scmProvider[\"scmProvider == contextValue\"]\n        scmResourceGroup[\"scmResourceGroupState == contextValue\"]\n        scmResourceState[\"scmResourceState == contextValue\"]\n    end\n    \n    Provider -.-\u003e|creates| scmProvider\n    ResourceGroup -.-\u003e|creates| scmResourceGroup\n    Resource -.-\u003e|creates| scmResourceState\n```\n\n**Sources:** [src/vs/workbench/contrib/scm/browser/menus.ts:94-123](), [src/vs/workbench/contrib/scm/browser/menus.ts:125-154]()\n\nExtensions set context values to enable menu contributions. For example:\n- A git resource with `contextValue: \"modified\"` shows different actions than one with `contextValue: \"untracked\"`\n- A resource group with `contextValue: \"workingTree\"` has different menu items than `contextValue: \"index\"`\n\n### Menu System\n\nThe SCM menus system creates contextual menus for each unique context value:\n\n```mermaid\ngraph LR\n    SCMMenusItem[\"SCMMenusItem\"]\n    \n    SCMMenusItem --\u003e|creates on demand| GenericResourceMenu[\"genericResourceMenu\u003cbr/\u003eNo context value\"]\n    SCMMenusItem --\u003e|creates on demand| ContextualMenus[\"contextualResourceMenus\u003cbr/\u003eMap\u003ccontextValue, IMenu\u003e\"]\n    \n    ContextualMenus --\u003e|\"contextValue: 'modified'\"| Menu1[\"IMenu for modified\"]\n    ContextualMenus --\u003e|\"contextValue: 'untracked'\"| Menu2[\"IMenu for untracked\"]\n    ContextualMenus --\u003e|\"contextValue: 'conflicted'\"| Menu3[\"IMenu for conflicted\"]\n    \n    Menu1 --\u003e|creates with| ContextKeyService[\"IContextKeyService\u003cbr/\u003escmResourceState == 'modified'\"]\n```\n\n**Sources:** [src/vs/workbench/contrib/scm/browser/menus.ts:72-154]()\n\nThis lazy menu creation approach ensures that menus are only instantiated for context values that are actually used, and that each menu has the correct context key overlay for its specific context value.\n\n## Quick Diff Integration\n\nProviders can optionally implement quick diff functionality to show inline diff decorations in editors:\n\n```mermaid\ngraph TD\n    ISCMProvider[\"ISCMProvider\"]\n    QuickDiffProvider[\"getOriginalResource()\"]\n    IQuickDiffService[\"IQuickDiffService\"]\n    \n    ISCMProvider --\u003e|implements| QuickDiffProvider\n    QuickDiffProvider --\u003e|returns| OriginalURI[\"Promise\u003cURI | null\u003e\u003cbr/\u003eBase version URI\"]\n    \n    IQuickDiffService --\u003e|queries all providers| QuickDiffProvider\n    QuickDiffProvider --\u003e|for modified file| EditorURI[\"editor.document.uri\"]\n    \n    OriginalURI --\u003e|displayed in| QuickDiffWidget[\"Quick Diff Widget\u003cbr/\u003eInline decorations\"]\n```\n\n**Sources:** [src/vs/workbench/contrib/scm/common/scm.ts:97](), [src/vs/workbench/api/browser/mainThreadSCM.ts:688-735]()\n\nThe `getOriginalResource()` method allows extensions to provide the \"before\" version of a file for diff decorations. The quick diff service queries all registered providers to find one that can provide the original resource for a given URI.\n\n## Provider Features Summary\n\n| Feature | Interface | Extension Host | Main Thread | Purpose |\n|---------|-----------|----------------|-------------|---------|\n| Resource Groups | `ISCMResourceGroup` | `ExtHostSourceControlResourceGroup` | `MainThreadSCMResourceGroup` | Organize resources |\n| Resources | `ISCMResource` | Resource states | `MainThreadSCMResource` | Individual files |\n| Input Box | `ISCMInput` | `ExtHostSCMInputBox` | Input component | Commit messages |\n| Count Badge | `count: IObservable` | `$setCount()` | Activity bar badge | Show changes count |\n| Status Bar | `statusBarCommands` | `$setStatusBarCommands()` | Status bar items | Quick actions |\n| Action Button | `actionButton` | `$setActionButton()` | Primary action | Main operation |\n| Quick Diff | `getOriginalResource()` | Provider method | Diff decorations | Inline diffs |\n| History | `historyProvider` | History provider | History view | Commit history |\n| Artifacts | `artifactProvider` | Artifact provider | Repositories view | Build artifacts |\n\n**Sources:** [src/vs/workbench/contrib/scm/common/scm.ts:72-97](), [src/vs/workbench/api/browser/mainThreadSCM.ts:281-450]()"])</script><script>self.__next_f.push([1,"49:T5160,"])</script><script>self.__next_f.push([1,"# SCM Views and UI Components\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [extensions/git/src/historyProvider.ts](extensions/git/src/historyProvider.ts)\n- [src/vs/workbench/api/browser/mainThreadSCM.ts](src/vs/workbench/api/browser/mainThreadSCM.ts)\n- [src/vs/workbench/api/common/extHostSCM.ts](src/vs/workbench/api/common/extHostSCM.ts)\n- [src/vs/workbench/contrib/scm/browser/activity.ts](src/vs/workbench/contrib/scm/browser/activity.ts)\n- [src/vs/workbench/contrib/scm/browser/media/scm.css](src/vs/workbench/contrib/scm/browser/media/scm.css)\n- [src/vs/workbench/contrib/scm/browser/menus.ts](src/vs/workbench/contrib/scm/browser/menus.ts)\n- [src/vs/workbench/contrib/scm/browser/scm.contribution.ts](src/vs/workbench/contrib/scm/browser/scm.contribution.ts)\n- [src/vs/workbench/contrib/scm/browser/scmHistory.ts](src/vs/workbench/contrib/scm/browser/scmHistory.ts)\n- [src/vs/workbench/contrib/scm/browser/scmHistoryViewPane.ts](src/vs/workbench/contrib/scm/browser/scmHistoryViewPane.ts)\n- [src/vs/workbench/contrib/scm/browser/scmRepositoriesViewPane.ts](src/vs/workbench/contrib/scm/browser/scmRepositoriesViewPane.ts)\n- [src/vs/workbench/contrib/scm/browser/scmRepositoryRenderer.ts](src/vs/workbench/contrib/scm/browser/scmRepositoryRenderer.ts)\n- [src/vs/workbench/contrib/scm/browser/scmViewPane.ts](src/vs/workbench/contrib/scm/browser/scmViewPane.ts)\n- [src/vs/workbench/contrib/scm/browser/scmViewService.ts](src/vs/workbench/contrib/scm/browser/scmViewService.ts)\n- [src/vs/workbench/contrib/scm/browser/util.ts](src/vs/workbench/contrib/scm/browser/util.ts)\n- [src/vs/workbench/contrib/scm/browser/workingSet.ts](src/vs/workbench/contrib/scm/browser/workingSet.ts)\n- [src/vs/workbench/contrib/scm/common/history.ts](src/vs/workbench/contrib/scm/common/history.ts)\n- [src/vs/workbench/contrib/scm/common/scm.ts](src/vs/workbench/contrib/scm/common/scm.ts)\n- [src/vs/workbench/contrib/scm/test/browser/scmHistory.test.ts](src/vs/workbench/contrib/scm/test/browser/scmHistory.test.ts)\n- [src/vscode-dts/vscode.proposed.scmHistoryProvider.d.ts](src/vscode-dts/vscode.proposed.scmHistoryProvider.d.ts)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis document describes the user interface components and views that make up the Source Control Management (SCM) system in VS Code. It covers the visual presentation layer including the main SCM views, tree renderers, input components, and menus. For information about the underlying SCM provider system and data models, see [SCM Framework Architecture](#9.1). For details about the SCM extension API, see [SCM Extension API](#9.5).\n\n**Sources:** [src/vs/workbench/contrib/scm/browser/scmViewPane.ts:1-100]()\n\n## View Architecture Overview\n\nThe SCM UI consists of three primary view panes, all registered in the Source Control view container:\n\n| View Pane | ID | Purpose |\n|-----------|-----|---------|\n| **Changes View** | `workbench.scm` | Displays repository input boxes, action buttons, resource groups, and changed files |\n| **Repositories View** | `workbench.scm.repositories` | Lists all available repositories and allows repository selection |\n| **Graph View** | `workbench.scm.history` | Shows commit history as a graph with branches and commits |\n\n```mermaid\ngraph TB\n    ViewContainer[\"SCM View Container\u003cbr/\u003e(VIEWLET_ID: 'workbench.view.scm')\"]\n    \n    ChangesView[\"SCMViewPane\u003cbr/\u003e(VIEW_PANE_ID)\"]\n    ReposView[\"SCMRepositoriesViewPane\u003cbr/\u003e(REPOSITORIES_VIEW_PANE_ID)\"]\n    HistoryView[\"SCMHistoryViewPane\u003cbr/\u003e(HISTORY_VIEW_PANE_ID)\"]\n    \n    ViewContainer --\u003e ChangesView\n    ViewContainer --\u003e ReposView\n    ViewContainer --\u003e HistoryView\n    \n    ChangesTree[\"WorkbenchCompressibleAsyncDataTree\u003cbr/\u003eTreeElement: Repository | Input | ActionButton | ResourceGroup | Resource\"]\n    ReposTree[\"WorkbenchCompressibleAsyncDataTree\u003cbr/\u003eTreeElement: Repository | ArtifactGroup | Artifact\"]\n    HistoryTree[\"WorkbenchCompressibleAsyncDataTree\u003cbr/\u003eTreeElement: HistoryItem | HistoryItemChange | LoadMore\"]\n    \n    ChangesView --\u003e ChangesTree\n    ReposView --\u003e ReposTree\n    HistoryView --\u003e HistoryTree\n```\n\n**Sources:** [src/vs/workbench/contrib/scm/browser/scm.contribution.ts:103-158](), [src/vs/workbench/contrib/scm/browser/scmViewPane.ts:115-125]()\n\n## SCM View Pane (Changes View)\n\n### Tree Structure and Data Source\n\nThe `SCMViewPane` displays a hierarchical tree structure where each repository can contain:\n\n```mermaid\ngraph TB\n    Root[\"SCMViewPane Root\"]\n    \n    Repo1[\"ISCMRepository\u003cbr/\u003e(RepositoryRenderer)\"]\n    Input1[\"ISCMInput\u003cbr/\u003e(InputRenderer)\"]\n    ActionBtn1[\"ISCMActionButton\u003cbr/\u003e(ActionButtonRenderer)\"]\n    Group1[\"ISCMResourceGroup\u003cbr/\u003e(ResourceGroupRenderer)\"]\n    Group2[\"ISCMResourceGroup\"]\n    \n    Resource1[\"ISCMResource\u003cbr/\u003e(ResourceRenderer)\"]\n    Resource2[\"ISCMResource\"]\n    ResourceNode[\"IResourceNode\u003cbr/\u003e(Tree Mode)\"]\n    \n    Root --\u003e Repo1\n    Repo1 --\u003e Input1\n    Repo1 --\u003e ActionBtn1\n    Repo1 --\u003e Group1\n    Repo1 --\u003e Group2\n    \n    Group1 --\u003e Resource1\n    Group1 --\u003e Resource2\n    Group2 --\u003e ResourceNode\n    \n    ResourceNode -.contains.-\u003e Resource1\n    ResourceNode -.contains.-\u003e Resource2\n```\n\nThe tree uses an async data source implementation that provides children based on element type:\n\n```mermaid\ngraph LR\n    DataSource[\"SCMTreeDataSource\"]\n    \n    GetChildren[\"getChildren()\"]\n    HasChildren[\"hasChildren()\"]\n    \n    DataSource --\u003e GetChildren\n    DataSource --\u003e HasChildren\n    \n    RepoChildren[\"Repository Children:\u003cbr/\u003e1. Input (if visible)\u003cbr/\u003e2. ActionButton (if present)\u003cbr/\u003e3. ResourceGroups\"]\n    GroupChildren[\"ResourceGroup Children:\u003cbr/\u003e- Resources (List mode)\u003cbr/\u003e- ResourceTree (Tree mode)\"]\n    \n    GetChildren --\u003e RepoChildren\n    GetChildren --\u003e GroupChildren\n```\n\n**Sources:** [src/vs/workbench/contrib/scm/browser/scmViewPane.ts:1120-1248]()\n\n### SCM Input Widget\n\nThe `SCMInputWidget` is a specialized editor component for commit message input:\n\n```mermaid\ngraph TB\n    SCMInputWidget[\"SCMInputWidget\"]\n    \n    Editor[\"CodeEditorWidget\u003cbr/\u003e(Monaco Editor)\"]\n    Toolbar[\"WorkbenchToolBar\u003cbr/\u003e(scm-editor-toolbar)\"]\n    ValidationContainer[\"Validation Message Container\"]\n    \n    SCMInputWidget --\u003e Editor\n    SCMInputWidget --\u003e Toolbar\n    SCMInputWidget --\u003e ValidationContainer\n    \n    EditorConfig[\"Editor Configuration:\u003cbr/\u003e- Simple editor options\u003cbr/\u003e- Line numbers: off\u003cbr/\u003e- Minimap: disabled\u003cbr/\u003e- Suggest enabled\u003cbr/\u003e- Snippet enabled\"]\n    \n    EditorContribs[\"Editor Contributions:\u003cbr/\u003e- SuggestController\u003cbr/\u003e- SnippetController2\u003cbr/\u003e- ContextMenuController\u003cbr/\u003e- InlineCompletionsController\u003cbr/\u003e- CodeActionController\"]\n    \n    Editor --\u003e EditorConfig\n    Editor --\u003e EditorContribs\n    \n    Validation[\"Input Validation:\u003cbr/\u003e- Error (red border)\u003cbr/\u003e- Warning (orange border)\u003cbr/\u003e- Info (blue border)\"]\n    \n    ValidationContainer --\u003e Validation\n```\n\nThe input widget provides:\n- Multi-line text editing with syntax highlighting for commit messages\n- Configurable placeholder text\n- Input validation with visual feedback\n- Toolbar for actions (visible on scroll or focus)\n- Support for suggestions and snippets\n- Auto-resizing based on content height\n\n**Sources:** [src/vs/workbench/contrib/scm/browser/scmViewPane.ts:1562-1911](), [src/vs/workbench/contrib/scm/browser/scmViewPane.ts:296-416]()\n\n### Action Button Component\n\nThe `SCMActionButton` renders primary actions for a repository (e.g., \"Commit\", \"Publish Branch\"):\n\n```mermaid\ngraph LR\n    ActionButton[\"SCMActionButton\"]\n    \n    ButtonDropdown[\"ButtonWithDropdown\"]\n    PrimaryBtn[\"Primary Button\u003cbr/\u003e(command.title)\"]\n    DropdownBtn[\"Dropdown Button\u003cbr/\u003e(secondary commands)\"]\n    \n    ActionButton --\u003e ButtonDropdown\n    ButtonDropdown --\u003e PrimaryBtn\n    ButtonDropdown --\u003e DropdownBtn\n    \n    PrimaryBtn --\u003e Execute[\"Execute command.id with args\"]\n    DropdownBtn --\u003e Menu[\"Show secondary commands menu\"]\n```\n\n**Sources:** [src/vs/workbench/contrib/scm/browser/scmViewPane.ts:1913-2170]()\n\n### Resource Groups and Resources\n\nResource groups organize changed files by category (e.g., \"Changes\", \"Staged Changes\"):\n\n```mermaid\ngraph TB\n    ResourceGroup[\"ISCMResourceGroup\"]\n    \n    GroupHeader[\"Group Header\u003cbr/\u003e- Label\u003cbr/\u003e- Count Badge\u003cbr/\u003e- Action Bar\"]\n    \n    ListMode[\"List Mode:\u003cbr/\u003eFlat list of resources\"]\n    TreeMode[\"Tree Mode:\u003cbr/\u003eHierarchical folder structure\"]\n    \n    ResourceGroup --\u003e GroupHeader\n    ResourceGroup --\u003e ListMode\n    ResourceGroup --\u003e TreeMode\n    \n    Resource[\"ISCMResource\u003cbr/\u003e- sourceUri\u003cbr/\u003e- decorations\u003cbr/\u003e- command\"]\n    \n    ResourceLabel[\"Resource Label:\u003cbr/\u003e- File icon\u003cbr/\u003e- File name\u003cbr/\u003e- Decoration icon\u003cbr/\u003e- Status tooltip\"]\n    \n    ActionBar[\"Inline Actions:\u003cbr/\u003e- Stage/Unstage\u003cbr/\u003e- Discard\u003cbr/\u003e- Open File\"]\n    \n    ListMode --\u003e Resource\n    TreeMode --\u003e Resource\n    \n    Resource --\u003e ResourceLabel\n    Resource --\u003e ActionBar\n```\n\n**Sources:** [src/vs/workbench/contrib/scm/browser/scmViewPane.ts:418-482](), [src/vs/workbench/contrib/scm/browser/scmViewPane.ts:484-706]()\n\n## Tree Renderers\n\n### Renderer Type Hierarchy\n\nThe SCM view uses multiple specialized renderers for different tree element types:\n\n| Renderer | Template ID | Element Type | Key UI Elements |\n|----------|-------------|--------------|-----------------|\n| `RepositoryRenderer` | `'repository'` | `ISCMRepository` | Icon, label, count badge, toolbar |\n| `InputRenderer` | `'input'` | `ISCMInput` | SCMInputWidget |\n| `ActionButtonRenderer` | `'actionButton'` | `ISCMActionButton` | SCMActionButton |\n| `ResourceGroupRenderer` | `'resource group'` | `ISCMResourceGroup` | Name, count, action bar |\n| `ResourceRenderer` | `'resource'` | `ISCMResource` | File label, decoration icon, actions |\n\n**Sources:** [src/vs/workbench/contrib/scm/browser/scmViewPane.ts:708-737]()\n\n### Resource Rendering Details\n\nThe `ResourceRenderer` handles both individual resources and folder nodes in tree mode:\n\n```mermaid\ngraph TB\n    RenderElement[\"ResourceRenderer.renderElement()\"]\n    \n    IsNode{{\"Is ResourceNode?\"}}\n    IsResource{{\"Is Resource?\"}}\n    \n    RenderElement --\u003e IsNode\n    IsNode --\u003e|Yes| FolderRender[\"Render Folder:\u003cbr/\u003e- Folder icon\u003cbr/\u003e- Folder name\u003cbr/\u003e- Child count\"]\n    IsNode --\u003e|No| IsResource\n    \n    IsResource --\u003e|Yes| FileRender[\"Render File:\u003cbr/\u003e- File icon\u003cbr/\u003e- File name\u003cbr/\u003e- Status decoration\"]\n    \n    FileRender --\u003e DecorationIcon[\"Decoration Icon:\u003cbr/\u003e- ThemeIcon or URI\u003cbr/\u003e- Colored or themed\u003cbr/\u003e- Tooltip\"]\n    \n    FileRender --\u003e ActionBar[\"Action Bar:\u003cbr/\u003e- Context menu actions\u003cbr/\u003e- Inline actions\"]\n    \n    FileRender --\u003e Styling[\"Visual Styling:\u003cbr/\u003e- Faded (decorations.faded)\u003cbr/\u003e- Strike-through (decorations.strikeThrough)\"]\n```\n\n**Sources:** [src/vs/workbench/contrib/scm/browser/scmViewPane.ts:524-706]()\n\n### Repository Renderer\n\nThe `RepositoryRenderer` displays repository headers with dynamic visibility indicators:\n\n```mermaid\ngraph LR\n    Template[\"RepositoryTemplate\"]\n    \n    Icon[\"Icon Element\u003cbr/\u003e(provider.iconPath or Codicon.repo)\"]\n    Label[\"IconLabel\u003cbr/\u003e(repository.provider.name)\"]\n    Actions[\"WorkbenchToolBar\u003cbr/\u003e(MenuId.SCMSourceControl)\"]\n    CountBadge[\"CountBadge\u003cbr/\u003e(resource count)\"]\n    \n    Template --\u003e Icon\n    Template --\u003e Label\n    Template --\u003e Actions\n    Template --\u003e CountBadge\n    \n    VisibleIcon[\"Selected Icon:\u003cbr/\u003eShows Codicon.repoSelected when repository is visible and multiple repos exist\"]\n    \n    Icon --\u003e VisibleIcon\n```\n\n**Sources:** [src/vs/workbench/contrib/scm/browser/scmRepositoryRenderer.ts:68-148]()\n\n## SCM History View Pane\n\nThe `SCMHistoryViewPane` displays commit history as a visual graph:\n\n```mermaid\ngraph TB\n    HistoryPane[\"SCMHistoryViewPane\"]\n    \n    Tree[\"WorkbenchCompressibleAsyncDataTree\"]\n    DataSource[\"SCMHistoryTreeDataSource\"]\n    \n    HistoryPane --\u003e Tree\n    Tree --\u003e DataSource\n    \n    Elements[\"Tree Elements\"]\n    \n    HistoryItem[\"SCMHistoryItemViewModelTreeElement\u003cbr/\u003e- Commit graph visualization\u003cbr/\u003e- Author, message, timestamp\u003cbr/\u003e- References (branches, tags)\"]\n    \n    HistoryChange[\"SCMHistoryItemChangeViewModelTreeElement\u003cbr/\u003e- File changes in commit\u003cbr/\u003e- Add/Modify/Delete status\"]\n    \n    LoadMore[\"SCMHistoryItemLoadMoreTreeElement\u003cbr/\u003e- Pagination control\"]\n    \n    Elements --\u003e HistoryItem\n    Elements --\u003e HistoryChange\n    Elements --\u003e LoadMore\n    \n    Tree --\u003e Elements\n```\n\n**Sources:** [src/vs/workbench/contrib/scm/browser/scmHistoryViewPane.ts:79-286]()\n\n### History Item Renderer\n\nThe `HistoryItemRenderer` creates complex visualizations for commits:\n\n```mermaid\ngraph TB\n    HistoryItemTemplate[\"HistoryItemTemplate\"]\n    \n    GraphContainer[\"Graph Container\u003cbr/\u003e(SVG swimlanes and nodes)\"]\n    IconLabel[\"IconLabel\u003cbr/\u003e(commit message and author)\"]\n    LabelContainer[\"Label Container\u003cbr/\u003e(branch/tag badges)\"]\n    ActionBar[\"WorkbenchToolBar\u003cbr/\u003e(inline actions)\"]\n    \n    HistoryItemTemplate --\u003e GraphContainer\n    HistoryItemTemplate --\u003e IconLabel\n    HistoryItemTemplate --\u003e LabelContainer\n    HistoryItemTemplate --\u003e ActionBar\n    \n    GraphViz[\"Graph Visualization:\u003cbr/\u003e- Swimlanes for branches\u003cbr/\u003e- Colored paths\u003cbr/\u003e- Merge nodes\u003cbr/\u003e- Current/Incoming/Outgoing indicators\"]\n    \n    Badges[\"Reference Badges:\u003cbr/\u003e- Branch icons\u003cbr/\u003e- Tag icons\u003cbr/\u003e- Colored backgrounds\u003cbr/\u003e- Grouped by color and icon\"]\n    \n    GraphContainer --\u003e GraphViz\n    LabelContainer --\u003e Badges\n    \n    Hover[\"Hover Tooltip:\u003cbr/\u003e- Full commit message\u003cbr/\u003e- Statistics (files, +/- lines)\u003cbr/\u003e- Copy commit hash\u003cbr/\u003e- Remote commands\"]\n    \n    IconLabel --\u003e Hover\n```\n\n**Sources:** [src/vs/workbench/contrib/scm/browser/scmHistoryViewPane.ts:439-638](), [src/vs/workbench/contrib/scm/browser/scmHistory.ts:1-100]()\n\n## SCM Repositories View Pane\n\nThe `SCMRepositoriesViewPane` provides repository management and artifact browsing:\n\n```mermaid\ngraph TB\n    ReposPane[\"SCMRepositoriesViewPane\"]\n    \n    Tree[\"WorkbenchCompressibleAsyncDataTree\"]\n    DataSource[\"SCMRepositoriesDataSource\"]\n    \n    ReposPane --\u003e Tree\n    Tree --\u003e DataSource\n    \n    RepoNode[\"ISCMRepository Node\u003cbr/\u003e- Repository selection\u003cbr/\u003e- Status and actions\"]\n    \n    ArtifactGroup[\"SCMArtifactGroupTreeElement\u003cbr/\u003e- Artifact category\u003cbr/\u003e- Group icon and label\"]\n    \n    Artifact[\"SCMArtifactTreeElement\u003cbr/\u003e- Individual artifact\u003cbr/\u003e- Timestamp\u003cbr/\u003e- Actions\"]\n    \n    Tree --\u003e RepoNode\n    RepoNode --\u003e ArtifactGroup\n    ArtifactGroup --\u003e Artifact\n    \n    Explorer[\"Artifact Explorer Mode:\u003cbr/\u003eEnabled when selectionMode is 'single'\"]\n    \n    ArtifactGroup --\u003e Explorer\n```\n\nWhen `scm.repositories.explorer` is enabled and selection mode is \"single\", the repositories view shows artifacts (like GitHub Actions runs or Azure Pipelines builds) for the selected repository.\n\n**Sources:** [src/vs/workbench/contrib/scm/browser/scmRepositoriesViewPane.ts:51-450]()\n\n### Artifact Renderers\n\n```mermaid\ngraph LR\n    ArtifactGroupRenderer[\"ArtifactGroupRenderer\"]\n    ArtifactRenderer[\"ArtifactRenderer\"]\n    \n    GroupTemplate[\"ArtifactGroupTemplate:\u003cbr/\u003e- Icon\u003cbr/\u003e- Label\u003cbr/\u003e- Action bar\"]\n    \n    ArtifactTemplate[\"ArtifactTemplate:\u003cbr/\u003e- Label\u003cbr/\u003e- Timestamp\u003cbr/\u003e- Action bar\"]\n    \n    ArtifactGroupRenderer --\u003e GroupTemplate\n    ArtifactRenderer --\u003e ArtifactTemplate\n    \n    TimestampDisplay[\"Timestamp Display:\u003cbr/\u003e- Shows relative time (fromNow)\u003cbr/\u003e- Duplicate detection\u003cbr/\u003e- Hover shows actions\"]\n    \n    ArtifactTemplate --\u003e TimestampDisplay\n```\n\n**Sources:** [src/vs/workbench/contrib/scm/browser/scmRepositoriesViewPane.ts:80-256]()\n\n## Menu System\n\nThe SCM menu system provides context-sensitive actions throughout the UI:\n\n```mermaid\ngraph TB\n    SCMMenus[\"SCMMenus\"]\n    \n    TitleMenu[\"SCMTitleMenu\u003cbr/\u003e(MenuId.SCMTitle)\"]\n    \n    RepositoryMenus[\"SCMRepositoryMenus\u003cbr/\u003e(per ISCMProvider)\"]\n    \n    SCMMenus --\u003e TitleMenu\n    SCMMenus --\u003e RepositoryMenus\n    \n    RepoContextMenus[\"Repository Context Menus\"]\n    \n    RepositoryMenu[\"getRepositoryMenu()\u003cbr/\u003e(MenuId.SCMSourceControl)\"]\n    RepositoryContextMenu[\"getRepositoryContextMenu()\u003cbr/\u003e(MenuId.SCMSourceControlInline)\"]\n    ResourceGroupMenu[\"getResourceGroupMenu()\u003cbr/\u003e(MenuId.SCMResourceGroupContext)\"]\n    ResourceMenu[\"getResourceMenu()\u003cbr/\u003e(MenuId.SCMResourceContext)\"]\n    ResourceFolderMenu[\"getResourceFolderMenu()\u003cbr/\u003e(MenuId.SCMResourceFolderContext)\"]\n    \n    RepositoryMenus --\u003e RepoContextMenus\n    \n    RepoContextMenus --\u003e RepositoryMenu\n    RepoContextMenus --\u003e RepositoryContextMenu\n    RepoContextMenus --\u003e ResourceGroupMenu\n    RepoContextMenus --\u003e ResourceMenu\n    RepoContextMenus --\u003e ResourceFolderMenu\n    \n    HistoryMenus[\"History Menus\"]\n    \n    HistoryItemContext[\"MenuId.SCMHistoryItemContext\"]\n    HistoryItemChangeContext[\"MenuId.SCMHistoryItemChangeContext\"]\n    \n    RepoContextMenus --\u003e HistoryMenus\n    HistoryMenus --\u003e HistoryItemContext\n    HistoryMenus --\u003e HistoryItemChangeContext\n```\n\nMenu items are context-aware based on:\n- `scmResourceState` context key (for resource context value)\n- `scmResourceGroupState` context key (for group context value)\n- `scmProvider` context key (for provider-specific actions)\n\n**Sources:** [src/vs/workbench/contrib/scm/browser/menus.ts:1-250]()\n\n### Action View Item Provider\n\nThe `getActionViewItemProvider()` function creates custom action view items for specific SCM actions:\n\n```mermaid\ngraph TB\n    Provider[\"getActionViewItemProvider()\"]\n    \n    StatusBarAction{{\"Is StatusBarAction?\"}}\n    \n    Provider --\u003e StatusBarAction\n    \n    StatusBarItem[\"StatusBarActionViewItem\u003cbr/\u003e- Enhanced styling\u003cbr/\u003e- Icon support\u003cbr/\u003e- Tooltip\"]\n    \n    DefaultItem[\"Default MenuEntryActionViewItem\"]\n    \n    StatusBarAction --\u003e|Yes| StatusBarItem\n    StatusBarAction --\u003e|No| DefaultItem\n```\n\n**Sources:** [src/vs/workbench/contrib/scm/browser/util.ts:109-139]()\n\n## Drag and Drop Support\n\nThe SCM tree supports drag and drop operations for resources:\n\n```mermaid\ngraph LR\n    DragDrop[\"SCMTreeDragAndDrop\"]\n    \n    GetDragURI[\"getDragURI()\u003cbr/\u003eReturns resource sourceUri\"]\n    \n    OnDragStart[\"onDragStart()\u003cbr/\u003e- Fills editor drag data\u003cbr/\u003e- Sets file system paths\u003cbr/\u003e- Creates transfer data\"]\n    \n    DragDrop --\u003e GetDragURI\n    DragDrop --\u003e OnDragStart\n    \n    DataTransfers[\"Data Transfers:\u003cbr/\u003e- CodeDataTransfers.FILES\u003cbr/\u003e- Editor drag data\u003cbr/\u003e- Multi-selection support\"]\n    \n    OnDragStart --\u003e DataTransfers\n```\n\n**Sources:** [src/vs/workbench/contrib/scm/browser/scmViewPane.ts:236-287]()\n\n## View State Persistence\n\nThe SCM views persist their state across sessions:\n\n```mermaid\ngraph TB\n    Persistence[\"View State Persistence\"]\n    \n    TreeState[\"Tree State:\u003cbr/\u003e- Expanded nodes\u003cbr/\u003e- Scroll position\u003cbr/\u003e- Selection\"]\n    \n    ViewMode[\"View Mode:\u003cbr/\u003e- List vs Tree\u003cbr/\u003e- Sort key\u003cbr/\u003e- Filter text\"]\n    \n    RepositorySelection[\"Repository Selection:\u003cbr/\u003e- Visible repositories\u003cbr/\u003e- Pinned repository\"]\n    \n    Persistence --\u003e TreeState\n    Persistence --\u003e ViewMode\n    Persistence --\u003e RepositorySelection\n    \n    Storage[\"IStorageService\u003cbr/\u003eStorageScope.WORKSPACE\u003cbr/\u003eStorageTarget.USER\"]\n    \n    TreeState --\u003e Storage\n    ViewMode --\u003e Storage\n    RepositorySelection --\u003e Storage\n```\n\n**Sources:** [src/vs/workbench/contrib/scm/browser/scmViewPane.ts:2539-2582]()\n\n## CSS Styling Structure\n\nThe SCM views use a comprehensive CSS structure defined in `scm.css`:\n\n| CSS Class | Purpose |\n|-----------|---------|\n| `.scm-view` | Main container for all SCM views |\n| `.scm-provider` | Repository header styling |\n| `.scm-input` | Input box container |\n| `.scm-editor` | Editor widget styling with border and validation states |\n| `.resource-group` | Resource group header |\n| `.resource` | Individual resource item |\n| `.history-item` | History item with graph visualization |\n| `.button-container` | Action button container |\n\nValidation states for the input box:\n- `.validation-info` - Blue border and background\n- `.validation-warning` - Orange border and background  \n- `.validation-error` - Red border and background\n\n**Sources:** [src/vs/workbench/contrib/scm/browser/media/scm.css:1-100](), [src/vs/workbench/contrib/scm/browser/media/scm.css:439-521]()\n\n## Context Keys\n\nThe SCM views expose and consume various context keys for conditional behavior:\n\n| Context Key | Type | Purpose |\n|-------------|------|---------|\n| `scmRepository` | string | Current repository ID |\n| `scmProvider` | string | Current provider ID |\n| `scmResourceGroup` | string | Current resource group ID |\n| `scmResourceState` | string | Resource context value |\n| `scmResourceGroupState` | string | Group context value |\n| `scm.providerCount` | number | Total number of providers |\n| `scmActiveResourceHasChanges` | boolean | Active editor resource has changes |\n\n**Sources:** [src/vs/workbench/contrib/scm/browser/scmViewPane.ts:116-125](), [src/vs/workbench/contrib/scm/browser/activity.ts:199-217]()"])</script><script>self.__next_f.push([1,"4a:T5122,"])</script><script>self.__next_f.push([1,"# SCM History Provider\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [extensions/git/src/historyProvider.ts](extensions/git/src/historyProvider.ts)\n- [src/vs/workbench/api/browser/mainThreadSCM.ts](src/vs/workbench/api/browser/mainThreadSCM.ts)\n- [src/vs/workbench/api/common/extHostSCM.ts](src/vs/workbench/api/common/extHostSCM.ts)\n- [src/vs/workbench/contrib/scm/browser/activity.ts](src/vs/workbench/contrib/scm/browser/activity.ts)\n- [src/vs/workbench/contrib/scm/browser/media/scm.css](src/vs/workbench/contrib/scm/browser/media/scm.css)\n- [src/vs/workbench/contrib/scm/browser/menus.ts](src/vs/workbench/contrib/scm/browser/menus.ts)\n- [src/vs/workbench/contrib/scm/browser/scm.contribution.ts](src/vs/workbench/contrib/scm/browser/scm.contribution.ts)\n- [src/vs/workbench/contrib/scm/browser/scmHistory.ts](src/vs/workbench/contrib/scm/browser/scmHistory.ts)\n- [src/vs/workbench/contrib/scm/browser/scmHistoryViewPane.ts](src/vs/workbench/contrib/scm/browser/scmHistoryViewPane.ts)\n- [src/vs/workbench/contrib/scm/browser/scmRepositoriesViewPane.ts](src/vs/workbench/contrib/scm/browser/scmRepositoriesViewPane.ts)\n- [src/vs/workbench/contrib/scm/browser/scmRepositoryRenderer.ts](src/vs/workbench/contrib/scm/browser/scmRepositoryRenderer.ts)\n- [src/vs/workbench/contrib/scm/browser/scmViewPane.ts](src/vs/workbench/contrib/scm/browser/scmViewPane.ts)\n- [src/vs/workbench/contrib/scm/browser/scmViewService.ts](src/vs/workbench/contrib/scm/browser/scmViewService.ts)\n- [src/vs/workbench/contrib/scm/browser/util.ts](src/vs/workbench/contrib/scm/browser/util.ts)\n- [src/vs/workbench/contrib/scm/browser/workingSet.ts](src/vs/workbench/contrib/scm/browser/workingSet.ts)\n- [src/vs/workbench/contrib/scm/common/history.ts](src/vs/workbench/contrib/scm/common/history.ts)\n- [src/vs/workbench/contrib/scm/common/scm.ts](src/vs/workbench/contrib/scm/common/scm.ts)\n- [src/vs/workbench/contrib/scm/test/browser/scmHistory.test.ts](src/vs/workbench/contrib/scm/test/browser/scmHistory.test.ts)\n- [src/vscode-dts/vscode.proposed.scmHistoryProvider.d.ts](src/vscode-dts/vscode.proposed.scmHistoryProvider.d.ts)\n\n\u003c/details\u003e\n\n\n\nThe SCM History Provider system enables source control extensions to expose their version control history (commits, branches, tags, etc.) to VS Code. This system provides the infrastructure for displaying commit graphs, history items, and associated changes in the Source Control Graph view.\n\nFor information about the broader SCM framework, see [SCM Framework Architecture](#9.1). For details about SCM providers in general, see [SCM Provider System](#9.2).\n\n## Architecture Overview\n\nThe history provider system consists of three main layers: the extension host interface, the main thread implementation, and the UI rendering layer.\n\n```mermaid\ngraph TB\n    subgraph \"Extension Host Process\"\n        ExtHistoryProvider[\"SourceControlHistoryProvider\u003cbr/\u003e(vscode.d.ts)\"]\n        ExtHostSCM[\"ExtHostSourceControl\u003cbr/\u003e(extHostSCM.ts)\"]\n    end\n    \n    subgraph \"Main Thread Process\"\n        MainThreadSCM[\"MainThreadSCMHistoryProvider\u003cbr/\u003e(mainThreadSCM.ts)\"]\n        ISCMHistoryProvider[\"ISCMHistoryProvider\u003cbr/\u003e(history.ts)\"]\n        HistoryViewPane[\"SCMHistoryViewPane\u003cbr/\u003e(scmHistoryViewPane.ts)\"]\n    end\n    \n    subgraph \"Git Extension\"\n        GitHistoryProvider[\"GitHistoryProvider\u003cbr/\u003e(historyProvider.ts)\"]\n    end\n    \n    GitHistoryProvider --\u003e|\"implements\"| ExtHistoryProvider\n    ExtHistoryProvider --\u003e|\"RPC calls\"| ExtHostSCM\n    ExtHostSCM \u003c--\u003e|\"IPC\"| MainThreadSCM\n    MainThreadSCM --\u003e|\"implements\"| ISCMHistoryProvider\n    ISCMHistoryProvider --\u003e|\"consumed by\"| HistoryViewPane\n```\n\nSources: [src/vs/workbench/contrib/scm/common/history.ts:1-100](), [src/vs/workbench/contrib/scm/browser/scmHistoryViewPane.ts:1-100](), [src/vs/workbench/api/browser/mainThreadSCM.ts:204-279](), [extensions/git/src/historyProvider.ts:42-82]()\n\n## Core Interfaces\n\n### ISCMHistoryProvider\n\nThe `ISCMHistoryProvider` interface is the main abstraction for history providers in the workbench.\n\n| Property/Method | Type | Description |\n|----------------|------|-------------|\n| `historyItemRef` | `IObservable\u003cISCMHistoryItemRef \\| undefined\u003e` | Current local reference (e.g., current branch) |\n| `historyItemRemoteRef` | `IObservable\u003cISCMHistoryItemRef \\| undefined\u003e` | Remote tracking reference |\n| `historyItemBaseRef` | `IObservable\u003cISCMHistoryItemRef \\| undefined\u003e` | Base reference for merge operations |\n| `historyItemRefChanges` | `IObservable\u003cISCMHistoryItemRefsChangeEvent\u003e` | Observable for reference changes |\n| `provideHistoryItemRefs()` | Method | Returns available references (branches, tags) |\n| `provideHistoryItems()` | Method | Returns history items matching options |\n| `provideHistoryItemChanges()` | Method | Returns file changes for a history item |\n| `resolveHistoryItem()` | Method | Resolves full details for a history item |\n| `resolveHistoryItemRefsCommonAncestor()` | Method | Finds common ancestor between refs |\n\nSources: [src/vs/workbench/contrib/scm/common/history.ts:17-31]()\n\n### ISCMHistoryItem\n\nRepresents a single history item (typically a commit).\n\n```typescript\ninterface ISCMHistoryItem {\n    readonly id: string;                        // Unique identifier (commit hash)\n    readonly parentIds: string[];               // Parent commit IDs\n    readonly subject: string;                   // Commit subject/title\n    readonly message: string;                   // Full commit message\n    readonly displayId?: string;                // Short hash for display\n    readonly author?: string;                   // Author name\n    readonly authorEmail?: string;              // Author email\n    readonly authorIcon?: URI | ThemeIcon;      // Author avatar\n    readonly timestamp?: number;                // Commit timestamp\n    readonly statistics?: ISCMHistoryItemStatistics; // File change stats\n    readonly references?: ISCMHistoryItemRef[]; // Associated refs\n    readonly tooltip?: IMarkdownString;         // Hover tooltip content\n}\n```\n\nSources: [src/vs/workbench/contrib/scm/common/history.ts:63-76]()\n\n### ISCMHistoryItemRef\n\nRepresents a reference like a branch, tag, or remote.\n\n```typescript\ninterface ISCMHistoryItemRef {\n    readonly id: string;            // Full ref ID (e.g., \"refs/heads/main\")\n    readonly name: string;          // Display name (e.g., \"main\")\n    readonly revision?: string;     // Commit hash the ref points to\n    readonly category?: string;     // Category for grouping\n    readonly description?: string;  // Additional description\n    readonly color?: ColorIdentifier; // Color for rendering\n    readonly icon?: URI | ThemeIcon;  // Icon for rendering\n}\n```\n\nSources: [src/vs/workbench/contrib/scm/common/history.ts:46-54]()\n\n## History Provider Implementation\n\n### MainThreadSCMHistoryProvider Bridge\n\nThe `MainThreadSCMHistoryProvider` class bridges the extension host and main thread.\n\n```mermaid\ngraph LR\n    subgraph \"Observable State\"\n        historyItemRef[\"_historyItemRef\u003cbr/\u003eobservableValue\"]\n        historyItemRemoteRef[\"_historyItemRemoteRef\u003cbr/\u003eobservableValue\"]\n        historyItemBaseRef[\"_historyItemBaseRef\u003cbr/\u003eobservableValue\"]\n        historyItemRefChanges[\"_historyItemRefChanges\u003cbr/\u003eobservableValue\"]\n    end\n    \n    subgraph \"RPC Methods\"\n        provideHistoryItems[\"provideHistoryItems()\"]\n        provideHistoryItemChanges[\"provideHistoryItemChanges()\"]\n        resolveHistoryItem[\"resolveHistoryItem()\"]\n    end\n    \n    ExtHostProxy[\"proxy: ExtHostSCMShape\"] --\u003e|\"$provideHistoryItems\"| provideHistoryItems\n    ExtHostProxy --\u003e|\"$provideHistoryItemChanges\"| provideHistoryItemChanges\n    ExtHostProxy --\u003e|\"$resolveHistoryItem\"| resolveHistoryItem\n    \n    ExtHostProxy --\u003e|\"$onDidChangeCurrentHistoryItemRefs\"| historyItemRef\n    ExtHostProxy --\u003e|\"$onDidChangeCurrentHistoryItemRefs\"| historyItemRemoteRef\n    ExtHostProxy --\u003e|\"$onDidChangeCurrentHistoryItemRefs\"| historyItemBaseRef\n    ExtHostProxy --\u003e|\"$onDidChangeHistoryItemRefs\"| historyItemRefChanges\n```\n\nSources: [src/vs/workbench/api/browser/mainThreadSCM.ts:204-279]()\n\n### Git History Provider Example\n\nThe Git extension provides a concrete implementation of the history provider.\n\n**Key Components:**\n\n| Component | Purpose |\n|-----------|---------|\n| `currentHistoryItemRef` | Tracks current branch/commit (HEAD) |\n| `currentHistoryItemRemoteRef` | Tracks upstream remote branch |\n| `currentHistoryItemBaseRef` | Tracks merge base for PRs |\n| `provideHistoryItems()` | Queries git log with filtering options |\n| `provideHistoryItemChanges()` | Runs git diff to get file changes |\n| `resolveHistoryItemRefsCommonAncestor()` | Finds merge base between refs |\n\n**Reference Resolution:**\n\nThe Git provider maintains three types of references:\n\n1. **Local Reference**: Current HEAD (branch or detached commit)\n2. **Remote Reference**: Upstream tracking branch\n3. **Base Reference**: Common ancestor with a different remote branch\n\nSources: [extensions/git/src/historyProvider.ts:42-222]()\n\n### History Item Lifecycle\n\n```mermaid\nsequenceDiagram\n    participant Ext as Extension\n    participant ExtHost as ExtHost\n    participant MainThread as MainThread\n    participant View as History View\n    \n    Note over Ext,View: Repository Operation (commit, checkout, etc.)\n    Ext-\u003e\u003eExtHost: Fire onDidChangeCurrentHistoryItemRefs\n    ExtHost-\u003e\u003eMainThread: $onDidChangeCurrentHistoryItemRefs\n    MainThread-\u003e\u003eMainThread: Update observables (historyItemRef, etc.)\n    MainThread-\u003e\u003eView: Observable change notification\n    \n    View-\u003e\u003eMainThread: provideHistoryItems(options)\n    MainThread-\u003e\u003eExtHost: $provideHistoryItems\n    ExtHost-\u003e\u003eExt: provideHistoryItems\n    Ext-\u003e\u003eExt: Query git log\n    Ext--\u003e\u003eExtHost: SourceControlHistoryItem[]\n    ExtHost--\u003e\u003eMainThread: SCMHistoryItemDto[]\n    MainThread--\u003e\u003eView: ISCMHistoryItem[]\n    \n    View-\u003e\u003eView: Render history graph\n```\n\nSources: [extensions/git/src/historyProvider.ts:92-222](), [src/vs/workbench/api/browser/mainThreadSCM.ts:228-253]()\n\n## History View Pane\n\nThe `SCMHistoryViewPane` displays the history graph in the UI.\n\n### View Architecture\n\n```mermaid\ngraph TB\n    SCMHistoryViewPane[\"SCMHistoryViewPane\"]\n    Tree[\"WorkbenchCompressibleAsyncDataTree\"]\n    DataSource[\"HistoryItemDataSource\"]\n    Renderers[\"Renderers\"]\n    \n    subgraph \"Renderers\"\n        HistoryItemRenderer[\"HistoryItemRenderer\u003cbr/\u003eCommit display\"]\n        HistoryItemChangeRenderer[\"HistoryItemChangeRenderer\u003cbr/\u003eFile changes\"]\n        HistoryItemLoadMoreRenderer[\"HistoryItemLoadMoreRenderer\u003cbr/\u003ePagination\"]\n    end\n    \n    subgraph \"Tree Elements\"\n        HistoryItemViewModel[\"SCMHistoryItemViewModelTreeElement\"]\n        HistoryItemChange[\"SCMHistoryItemChangeViewModelTreeElement\"]\n        LoadMore[\"SCMHistoryItemLoadMoreTreeElement\"]\n    end\n    \n    SCMHistoryViewPane --\u003e|\"creates\"| Tree\n    Tree --\u003e|\"uses\"| DataSource\n    Tree --\u003e|\"uses\"| Renderers\n    DataSource --\u003e|\"provides\"| HistoryItemViewModel\n    DataSource --\u003e|\"provides\"| HistoryItemChange\n    DataSource --\u003e|\"provides\"| LoadMore\n```\n\nSources: [src/vs/workbench/contrib/scm/browser/scmHistoryViewPane.ts:1-100]()\n\n### Data Source Implementation\n\nThe `HistoryItemDataSource` loads history items on demand with pagination support.\n\n**Key Methods:**\n\n| Method | Description |\n|--------|-------------|\n| `getChildren()` | Returns child elements for tree navigation |\n| `_getHistoryItems()` | Fetches history items from provider |\n| `_getHistoryItemChanges()` | Fetches file changes for a history item |\n| `_resolveChildren()` | Resolves children with view mode (list/tree) |\n\n**Pagination:**\n\nThe data source supports incremental loading:\n- Initial page size from `scm.graph.pageSize` config (default: 50)\n- Load more items on scroll when `scm.graph.pageOnScroll` is enabled\n- Creates `SCMHistoryItemLoadMoreTreeElement` for \"Load More\" UI\n\nSources: [src/vs/workbench/contrib/scm/browser/scmHistoryViewPane.ts:776-1073]()\n\n### History Item Rendering\n\nThe `HistoryItemRenderer` displays commit information with graph visualization.\n\n**Template Structure:**\n\n```typescript\ninterface HistoryItemTemplate {\n    readonly element: HTMLElement;\n    readonly label: IconLabel;              // Author and subject\n    readonly graphContainer: HTMLElement;   // SVG graph visualization\n    readonly actionBar: WorkbenchToolBar;   // Inline actions\n    readonly labelContainer: HTMLElement;   // Branch/tag badges\n}\n```\n\n**Rendering Pipeline:**\n\n1. **Graph Container**: Renders SVG graph using `renderSCMHistoryItemGraph()`\n2. **Label**: Displays commit subject and author with highlighting\n3. **Badges**: Shows associated branches/tags with color coding\n4. **Actions**: Provides inline actions (view changes, etc.)\n5. **Hover**: Shows detailed tooltip with commit message and statistics\n\nSources: [src/vs/workbench/contrib/scm/browser/scmHistoryViewPane.ts:439-556]()\n\n## Graph Rendering\n\nThe graph visualization system renders commit relationships as a directed graph.\n\n### Graph Model\n\nHistory items are transformed into view models with graph information:\n\n```typescript\ninterface ISCMHistoryItemViewModel {\n    readonly historyItem: ISCMHistoryItem;\n    readonly inputSwimlanes: ISCMHistoryItemGraphNode[];  // Incoming edges\n    readonly outputSwimlanes: ISCMHistoryItemGraphNode[]; // Outgoing edges\n}\n\ninterface ISCMHistoryItemGraphNode {\n    readonly id: string;        // Swimlane identifier\n    readonly color: string;     // Color for the swimlane\n}\n```\n\nThe `toISCMHistoryItemViewModelArray()` function converts a list of history items into view models with proper swimlane assignments.\n\nSources: [src/vs/workbench/contrib/scm/common/history.ts:78-92](), [src/vs/workbench/contrib/scm/browser/scmHistory.ts:1-50]()\n\n### SVG Generation\n\nThe `renderSCMHistoryItemGraph()` function generates SVG elements for each history item:\n\n**Graph Components:**\n\n| Component | Description |\n|-----------|-------------|\n| Circles | Represent commits (filled or hollow) |\n| Lines | Connect commits to show parent-child relationships |\n| Curves | Handle branching and merging with Bezier curves |\n| Colors | Distinguish different branches/swimlanes |\n\n**Special Cases:**\n\n- **Incoming Changes**: History items with `SCMIncomingHistoryItemId` show pending remote changes\n- **Outgoing Changes**: History items with `SCMOutgoingHistoryItemId` show unpushed local changes\n- **Merge Commits**: Multiple input swimlanes converge into one\n- **Branch Points**: One input swimlane splits into multiple outputs\n\nSources: [src/vs/workbench/contrib/scm/browser/scmHistory.ts:176-430]()\n\n### Graph Color Registry\n\nThe color system uses a predefined palette for swimlanes:\n\n```typescript\nexport const colorRegistry: string[] = [\n    asCssVariable(scmGraphColor1),\n    asCssVariable(scmGraphColor2),\n    asCssVariable(scmGraphColor3),\n    // ... up to 16 colors\n];\n```\n\nReference types also have special colors:\n- `historyItemRefColor`: Current branch (blue)\n- `historyItemRemoteRefColor`: Remote branch (purple)\n- `historyItemBaseRefColor`: Base reference (orange)\n\nSources: [src/vs/workbench/contrib/scm/browser/scmHistory.ts:46-130]()\n\n## Extension API\n\nExtensions implement the `SourceControlHistoryProvider` API to expose history.\n\n### Provider Registration\n\n```typescript\n// In extension activation\nconst provider = scm.createSourceControl('git', 'Git', rootUri);\nprovider.historyProvider = new MyHistoryProvider();\n```\n\n### Event System\n\n**Required Events:**\n\n| Event | Fired When |\n|-------|-----------|\n| `onDidChangeCurrentHistoryItemRefs` | Current branch/commit changes |\n| `onDidChangeHistoryItemRefs` | Any ref is added/removed/modified |\n\n**Event Handling:**\n\n```typescript\nclass GitHistoryProvider {\n    private _onDidChangeCurrentHistoryItemRefs = new EventEmitter\u003cvoid\u003e();\n    readonly onDidChangeCurrentHistoryItemRefs = this._onDidChangeCurrentHistoryItemRefs.event;\n    \n    // Fire after checkout, commit, fetch, etc.\n    private async onDidRunWriteOperation() {\n        this._currentHistoryItemRef = /* ... */;\n        this._onDidChangeCurrentHistoryItemRefs.fire();\n    }\n}\n```\n\nSources: [src/vscode-dts/vscode.proposed.scmHistoryProvider.d.ts:9-37](), [extensions/git/src/historyProvider.ts:55-222]()\n\n### Providing History Items\n\nThe `provideHistoryItems()` method returns history matching filter criteria:\n\n**Options:**\n\n```typescript\ninterface SourceControlHistoryOptions {\n    readonly skip?: number;                     // Pagination offset\n    readonly limit?: number | { id?: string };  // Page size or until ID\n    readonly historyItemRefs?: readonly string[]; // Filter by refs\n    readonly filterText?: string;               // Search text\n}\n```\n\n**Implementation Pattern:**\n\n```typescript\nasync provideHistoryItems(options: SourceControlHistoryOptions) {\n    const logOptions: LogOptions = {\n        refNames: options.historyItemRefs,\n        maxEntries: options.limit,\n        skip: options.skip\n    };\n    \n    const commits = await this.repository.log(logOptions);\n    return commits.map(commit =\u003e ({\n        id: commit.hash,\n        parentIds: commit.parents,\n        subject: commit.message.split('\\n')[0],\n        message: commit.message,\n        author: commit.authorName,\n        timestamp: commit.authorDate?.getTime()\n    }));\n}\n```\n\nSources: [extensions/git/src/historyProvider.ts:248-335](), [src/vscode-dts/vscode.proposed.scmHistoryProvider.d.ts:39-44]()\n\n### Providing History Item Changes\n\nThe `provideHistoryItemChanges()` method returns file-level changes:\n\n```typescript\nasync provideHistoryItemChanges(historyItemId: string, historyItemParentId?: string) {\n    const changes = await this.repository.diffBetweenWithStats(\n        historyItemParentId ?? await this.repository.getEmptyTree(),\n        historyItemId\n    );\n    \n    return changes.map(change =\u003e ({\n        uri: change.uri.with({ query: `ref=${historyItemId}` }),\n        originalUri: change.originalUri,\n        modifiedUri: change.modifiedUri\n    }));\n}\n```\n\nSources: [extensions/git/src/historyProvider.ts:337-367]()\n\n## Data Flow\n\nThe complete data flow from extension to UI rendering:\n\n```mermaid\nsequenceDiagram\n    participant User\n    participant View as SCMHistoryViewPane\n    participant DataSource as HistoryItemDataSource\n    participant Main as MainThreadSCMHistoryProvider\n    participant Ext as GitHistoryProvider\n    participant Git as Git Process\n    \n    User-\u003e\u003eView: Open History View\n    View-\u003e\u003eDataSource: getChildren(repositoryElement)\n    \n    DataSource-\u003e\u003eMain: provideHistoryItems(options)\n    Main-\u003e\u003eExt: $provideHistoryItems (IPC)\n    Ext-\u003e\u003eGit: git log --graph --all\n    Git--\u003e\u003eExt: commit data\n    Ext-\u003e\u003eExt: Parse commits, add avatars\n    Ext--\u003e\u003eMain: SourceControlHistoryItem[]\n    Main-\u003e\u003eMain: Convert to ISCMHistoryItem\n    Main--\u003e\u003eDataSource: ISCMHistoryItem[]\n    \n    DataSource-\u003e\u003eDataSource: toISCMHistoryItemViewModelArray()\n    DataSource-\u003e\u003eDataSource: Compute graph swimlanes\n    DataSource--\u003e\u003eView: SCMHistoryItemViewModelTreeElement[]\n    \n    View-\u003e\u003eView: Render tree items\n    View-\u003e\u003eView: renderSCMHistoryItemGraph()\n    View-\u003e\u003eView: Display commit info, badges\n    \n    User-\u003e\u003eView: Expand history item\n    View-\u003e\u003eDataSource: getChildren(historyItemElement)\n    DataSource-\u003e\u003eMain: provideHistoryItemChanges()\n    Main-\u003e\u003eExt: $provideHistoryItemChanges (IPC)\n    Ext-\u003e\u003eGit: git diff historyItemParent historyItemId\n    Git--\u003e\u003eExt: diff data\n    Ext--\u003e\u003eMain: SourceControlHistoryItemChange[]\n    Main--\u003e\u003eDataSource: ISCMHistoryItemChange[]\n    DataSource--\u003e\u003eView: SCMHistoryItemChangeViewModelTreeElement[]\n    View-\u003e\u003eView: Render file changes\n```\n\nSources: [src/vs/workbench/contrib/scm/browser/scmHistoryViewPane.ts:776-1073](), [src/vs/workbench/api/browser/mainThreadSCM.ts:228-262](), [extensions/git/src/historyProvider.ts:248-367]()\n\n## Configuration\n\nThe history provider system is configurable via settings:\n\n| Setting | Type | Default | Description |\n|---------|------|---------|-------------|\n| `scm.graph.pageOnScroll` | boolean | true | Load more items when scrolling to end |\n| `scm.graph.pageSize` | number | 50 | Number of items per page |\n| `scm.graph.badges` | 'all' \\| 'filter' | 'filter' | Which badges to show |\n| `scm.graph.showIncomingChanges` | boolean | true | Show incoming changes item |\n| `scm.graph.showOutgoingChanges` | boolean | true | Show outgoing changes item |\n\nSources: [src/vs/workbench/contrib/scm/browser/scm.contribution.ts:398-429]()\n\n## Related Systems\n\n- **SCM Framework Architecture** [#9.1](): Base SCM provider system\n- **SCM Provider System** [#9.2](): Provider registration and lifecycle\n- **SCM Views and UI Components** [#9.3](): Main SCM view architecture\n- **Git Extension** [#10.1](): Primary history provider implementation"])</script><script>self.__next_f.push([1,"4b:T5cde,"])</script><script>self.__next_f.push([1,"# SCM Extension API\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [extensions/git/src/historyProvider.ts](extensions/git/src/historyProvider.ts)\n- [extensions/vscode-api-tests/package.json](extensions/vscode-api-tests/package.json)\n- [extensions/vscode-api-tests/src/singlefolder-tests/chat.test.ts](extensions/vscode-api-tests/src/singlefolder-tests/chat.test.ts)\n- [src/vs/editor/browser/config/charWidthReader.ts](src/vs/editor/browser/config/charWidthReader.ts)\n- [src/vs/editor/browser/editorBrowser.ts](src/vs/editor/browser/editorBrowser.ts)\n- [src/vs/editor/browser/viewParts/minimap/minimap.ts](src/vs/editor/browser/viewParts/minimap/minimap.ts)\n- [src/vs/editor/browser/viewParts/minimap/minimapCharRenderer.ts](src/vs/editor/browser/viewParts/minimap/minimapCharRenderer.ts)\n- [src/vs/editor/browser/viewParts/minimap/minimapCharRendererFactory.ts](src/vs/editor/browser/viewParts/minimap/minimapCharRendererFactory.ts)\n- [src/vs/editor/browser/viewParts/minimap/minimapCharSheet.ts](src/vs/editor/browser/viewParts/minimap/minimapCharSheet.ts)\n- [src/vs/editor/browser/viewParts/minimap/minimapPreBaked.ts](src/vs/editor/browser/viewParts/minimap/minimapPreBaked.ts)\n- [src/vs/editor/browser/widget/codeEditor/codeEditorWidget.ts](src/vs/editor/browser/widget/codeEditor/codeEditorWidget.ts)\n- [src/vs/editor/common/config/editorOptions.ts](src/vs/editor/common/config/editorOptions.ts)\n- [src/vs/editor/common/config/fontInfo.ts](src/vs/editor/common/config/fontInfo.ts)\n- [src/vs/editor/common/editorCommon.ts](src/vs/editor/common/editorCommon.ts)\n- [src/vs/editor/common/languages.ts](src/vs/editor/common/languages.ts)\n- [src/vs/editor/common/standalone/standaloneEnums.ts](src/vs/editor/common/standalone/standaloneEnums.ts)\n- [src/vs/editor/common/textModelEvents.ts](src/vs/editor/common/textModelEvents.ts)\n- [src/vs/editor/common/viewModel/minimapTokensColorTracker.ts](src/vs/editor/common/viewModel/minimapTokensColorTracker.ts)\n- [src/vs/editor/test/browser/view/minimapCharRenderer.test.ts](src/vs/editor/test/browser/view/minimapCharRenderer.test.ts)\n- [src/vs/monaco.d.ts](src/vs/monaco.d.ts)\n- [src/vs/platform/extensions/common/extensionsApiProposals.ts](src/vs/platform/extensions/common/extensionsApiProposals.ts)\n- [src/vs/workbench/api/browser/extensionHost.contribution.ts](src/vs/workbench/api/browser/extensionHost.contribution.ts)\n- [src/vs/workbench/api/browser/mainThreadLanguageFeatures.ts](src/vs/workbench/api/browser/mainThreadLanguageFeatures.ts)\n- [src/vs/workbench/api/browser/mainThreadSCM.ts](src/vs/workbench/api/browser/mainThreadSCM.ts)\n- [src/vs/workbench/api/common/extHost.api.impl.ts](src/vs/workbench/api/common/extHost.api.impl.ts)\n- [src/vs/workbench/api/common/extHost.protocol.ts](src/vs/workbench/api/common/extHost.protocol.ts)\n- [src/vs/workbench/api/common/extHostLanguageFeatures.ts](src/vs/workbench/api/common/extHostLanguageFeatures.ts)\n- [src/vs/workbench/api/common/extHostSCM.ts](src/vs/workbench/api/common/extHostSCM.ts)\n- [src/vs/workbench/api/common/extHostTypeConverters.ts](src/vs/workbench/api/common/extHostTypeConverters.ts)\n- [src/vs/workbench/api/common/extHostTypes.ts](src/vs/workbench/api/common/extHostTypes.ts)\n- [src/vs/workbench/contrib/scm/browser/activity.ts](src/vs/workbench/contrib/scm/browser/activity.ts)\n- [src/vs/workbench/contrib/scm/browser/media/scm.css](src/vs/workbench/contrib/scm/browser/media/scm.css)\n- [src/vs/workbench/contrib/scm/browser/menus.ts](src/vs/workbench/contrib/scm/browser/menus.ts)\n- [src/vs/workbench/contrib/scm/browser/scm.contribution.ts](src/vs/workbench/contrib/scm/browser/scm.contribution.ts)\n- [src/vs/workbench/contrib/scm/browser/scmHistory.ts](src/vs/workbench/contrib/scm/browser/scmHistory.ts)\n- [src/vs/workbench/contrib/scm/browser/scmHistoryViewPane.ts](src/vs/workbench/contrib/scm/browser/scmHistoryViewPane.ts)\n- [src/vs/workbench/contrib/scm/browser/scmRepositoriesViewPane.ts](src/vs/workbench/contrib/scm/browser/scmRepositoriesViewPane.ts)\n- [src/vs/workbench/contrib/scm/browser/scmRepositoryRenderer.ts](src/vs/workbench/contrib/scm/browser/scmRepositoryRenderer.ts)\n- [src/vs/workbench/contrib/scm/browser/scmViewPane.ts](src/vs/workbench/contrib/scm/browser/scmViewPane.ts)\n- [src/vs/workbench/contrib/scm/browser/scmViewService.ts](src/vs/workbench/contrib/scm/browser/scmViewService.ts)\n- [src/vs/workbench/contrib/scm/browser/util.ts](src/vs/workbench/contrib/scm/browser/util.ts)\n- [src/vs/workbench/contrib/scm/browser/workingSet.ts](src/vs/workbench/contrib/scm/browser/workingSet.ts)\n- [src/vs/workbench/contrib/scm/common/history.ts](src/vs/workbench/contrib/scm/common/history.ts)\n- [src/vs/workbench/contrib/scm/common/scm.ts](src/vs/workbench/contrib/scm/common/scm.ts)\n- [src/vs/workbench/contrib/scm/test/browser/scmHistory.test.ts](src/vs/workbench/contrib/scm/test/browser/scmHistory.test.ts)\n- [src/vscode-dts/vscode.d.ts](src/vscode-dts/vscode.d.ts)\n- [src/vscode-dts/vscode.proposed.inlineCompletionsAdditions.d.ts](src/vscode-dts/vscode.proposed.inlineCompletionsAdditions.d.ts)\n- [src/vscode-dts/vscode.proposed.scmHistoryProvider.d.ts](src/vscode-dts/vscode.proposed.scmHistoryProvider.d.ts)\n\n\u003c/details\u003e\n\n\n\nThis document describes the extension API that allows VS Code extensions to integrate source control providers through the `vscode.scm` namespace. It covers how extensions create source control providers, manage resource groups and resources, provide input validation, and implement quick diff functionality.\n\nFor the internal SCM framework architecture, see [SCM Framework Architecture](#9.1). For details on the SCM provider system interfaces, see [SCM Provider System](#9.2). For history provider implementation, see [SCM History Provider](#9.4).\n\n## API Overview\n\nThe SCM extension API is exposed through the `vscode.scm` namespace and provides the following main entry points:\n\n| API Member | Purpose | Key Type |\n|------------|---------|----------|\n| `vscode.scm.createSourceControl()` | Creates a new source control provider | `SourceControl` |\n| `SourceControl.createResourceGroup()` | Creates a resource group within the provider | `SourceControlResourceGroup` |\n| `SourceControl.inputBox` | Access to the input box for commit messages | `SourceControlInputBox` |\n| `SourceControl.quickDiffProvider` | Register a provider for inline diff decorations | `QuickDiffProvider` |\n\nThe API is implemented through a bridge pattern where extension-side objects in the extension host process communicate via RPC with main thread implementations that integrate with the workbench.\n\n**Sources:** [src/vscode-dts/vscode.d.ts:5000-5300](), [src/vs/workbench/api/common/extHostSCM.ts:1-50]()\n\n## Extension Host Architecture\n\n```mermaid\ngraph TB\n    subgraph \"Extension Process\"\n        ExtAPI[\"vscode.scm.createSourceControl()\"]\n        ExtHostSCM[\"ExtHostSCM\"]\n        SourceControlImpl[\"SourceControlImpl\"]\n        ResourceGroupImpl[\"SourceControlResourceGroupImpl\"]\n        ResourceStateImpl[\"SourceControlResourceStateImpl\"]\n        InputBoxImpl[\"SourceControlInputBoxImpl\"]\n        QuickDiffImpl[\"QuickDiffImpl\"]\n        \n        ExtAPI --\u003e ExtHostSCM\n        ExtHostSCM --\u003e SourceControlImpl\n        SourceControlImpl --\u003e ResourceGroupImpl\n        ResourceGroupImpl --\u003e ResourceStateImpl\n        SourceControlImpl --\u003e InputBoxImpl\n        SourceControlImpl --\u003e QuickDiffImpl\n    end\n    \n    subgraph \"RPC Protocol\"\n        Protocol[\"MainThreadSCMShape\u003cbr/\u003e$registerSourceControl\u003cbr/\u003e$updateSourceControl\u003cbr/\u003e$unregisterSourceControl\u003cbr/\u003e$registerGroup\u003cbr/\u003e$updateGroup\"]\n    end\n    \n    subgraph \"Main Thread\"\n        MainThreadSCM[\"MainThreadSCM\"]\n        SCMService[\"ISCMService\"]\n        MainProvider[\"MainThreadSCMProvider\"]\n        MainResourceGroup[\"MainThreadSCMResourceGroup\"]\n    end\n    \n    ExtHostSCM --\u003e|\"RPC Messages\"| Protocol\n    Protocol --\u003e|\"RPC Messages\"| MainThreadSCM\n    MainThreadSCM --\u003e SCMService\n    MainThreadSCM --\u003e MainProvider\n    MainProvider --\u003e MainResourceGroup\n    \n    style ExtHostSCM fill:#e1f5ff\n    style Protocol fill:#ffe1e1\n    style MainThreadSCM fill:#e6ffe6\n```\n\nThe extension API uses a multi-layer architecture:\n\n1. **Extension API Layer**: Public API types defined in `vscode.d.ts`\n2. **Extension Host Layer**: Implementation classes that handle API calls\n3. **RPC Protocol Layer**: Message passing between processes\n4. **Main Thread Layer**: Integration with workbench services\n\n**Sources:** [src/vs/workbench/api/common/extHostSCM.ts:50-150](), [src/vs/workbench/api/browser/mainThreadSCM.ts:1-100](), [src/vs/workbench/api/common/extHost.protocol.ts:850-920]()\n\n## Creating a Source Control Provider\n\nExtensions create source control providers through `vscode.scm.createSourceControl()`:\n\n```typescript\nconst sourceControl = vscode.scm.createSourceControl(\n    'myScmId',           // Unique identifier\n    'My SCM',            // Display name\n    vscode.Uri.file('/path/to/root')  // Root URI (optional)\n);\n```\n\nThis triggers the following flow:\n\n```mermaid\nsequenceDiagram\n    participant Ext as Extension\n    participant ESCM as ExtHostSCM\n    participant RPC as RPC Protocol\n    participant MSCM as MainThreadSCM\n    participant Svc as ISCMService\n    \n    Ext-\u003e\u003eESCM: createSourceControl(id, label, rootUri)\n    ESCM-\u003e\u003eESCM: new SourceControlImpl()\n    ESCM-\u003e\u003eRPC: $registerSourceControl(handle, id, label, rootUri)\n    RPC-\u003e\u003eMSCM: $registerSourceControl(handle, id, label, rootUri)\n    MSCM-\u003e\u003eMSCM: new MainThreadSCMProvider()\n    MSCM-\u003e\u003eSvc: registerSCMProvider(provider)\n    Svc--\u003e\u003eMSCM: ISCMRepository\n    MSCM--\u003e\u003eRPC: Success\n    RPC--\u003e\u003eESCM: Success\n    ESCM--\u003e\u003eExt: SourceControl object\n```\n\nThe `SourceControlImpl` class maintains the provider state and exposes properties:\n\n| Property | Type | Purpose |\n|----------|------|---------|\n| `id` | `string` | Unique provider identifier |\n| `label` | `string` | Display name in UI |\n| `rootUri` | `Uri` | Optional workspace root |\n| `inputBox` | `SourceControlInputBox` | Commit message input |\n| `count` | `number` | Badge count (e.g., uncommitted changes) |\n| `quickDiffProvider` | `QuickDiffProvider` | Optional diff provider |\n| `commitTemplate` | `string` | Default commit message template |\n| `acceptInputCommand` | `Command` | Command for committing |\n| `statusBarCommands` | `Command[]` | Additional status bar actions |\n\n**Sources:** [src/vs/workbench/api/common/extHostSCM.ts:200-350](), [src/vs/workbench/api/browser/mainThreadSCM.ts:150-250]()\n\n## Resource Groups and Resources\n\nSource control providers organize changes into resource groups (e.g., \"Changes\", \"Staged Changes\", \"Merge Changes\"):\n\n```mermaid\ngraph LR\n    SC[\"SourceControl\"]\n    RG1[\"ResourceGroup\u003cbr/\u003e'Changes'\"]\n    RG2[\"ResourceGroup\u003cbr/\u003e'Staged'\"]\n    R1[\"Resource\u003cbr/\u003efile1.ts\"]\n    R2[\"Resource\u003cbr/\u003efile2.ts\"]\n    R3[\"Resource\u003cbr/\u003efile3.ts\"]\n    \n    SC --\u003e|\"createResourceGroup()\"| RG1\n    SC --\u003e|\"createResourceGroup()\"| RG2\n    RG1 --\u003e|\"resourceStates\"| R1\n    RG1 --\u003e|\"resourceStates\"| R2\n    RG2 --\u003e|\"resourceStates\"| R3\n```\n\n### Creating Resource Groups\n\n```typescript\nconst changesGroup = sourceControl.createResourceGroup(\n    'workingTree',      // Unique ID\n    'Changes'           // Display label\n);\n```\n\nThe `SourceControlResourceGroup` interface provides:\n\n| Property/Method | Type | Description |\n|-----------------|------|-------------|\n| `id` | `string` | Unique identifier |\n| `label` | `string` | Display label |\n| `hideWhenEmpty` | `boolean` | Hide group when no resources |\n| `resourceStates` | `SourceControlResourceState[]` | Array of resources |\n| `dispose()` | `() =\u003e void` | Remove the resource group |\n\n**Sources:** [src/vs/workbench/api/common/extHostSCM.ts:400-500](), [src/vscode-dts/vscode.d.ts:5100-5150]()\n\n### Resource States\n\nIndividual resources represent files with changes:\n\n```typescript\nconst resource: vscode.SourceControlResourceState = {\n    resourceUri: vscode.Uri.file('/path/to/file.ts'),\n    command: {\n        title: 'Open',\n        command: 'vscode.open',\n        arguments: [vscode.Uri.file('/path/to/file.ts')]\n    },\n    decorations: {\n        strikeThrough: false,\n        faded: false,\n        tooltip: 'Modified',\n        iconPath: new vscode.ThemeIcon('diff-modified'),\n        light: { iconPath: '...' },\n        dark: { iconPath: '...' }\n    }\n};\n\nchangesGroup.resourceStates = [resource];\n```\n\nThe `SourceControlResourceDecorations` interface allows customization:\n\n| Property | Type | Purpose |\n|----------|------|---------|\n| `strikeThrough` | `boolean` | Strike-through text styling |\n| `faded` | `boolean` | Fade the resource |\n| `tooltip` | `string` | Hover tooltip |\n| `iconPath` | `string \\| Uri \\| ThemeIcon` | Custom icon |\n| `light` | `{ iconPath: string \\| Uri }` | Light theme icon |\n| `dark` | `{ iconPath: string \\| Uri }` | Dark theme icon |\n\n**Sources:** [src/vs/workbench/api/common/extHostSCM.ts:550-650](), [src/vscode-dts/vscode.d.ts:5150-5250]()\n\n## Input Box Implementation\n\nThe input box provides commit message entry with validation and value providers:\n\n```mermaid\ngraph TB\n    subgraph \"Extension Host\"\n        InputBoxImpl[\"SourceControlInputBoxImpl\"]\n        ValidatorFn[\"validationProvider\u003cbr/\u003eFunction\"]\n        ValueProviderFn[\"valueProvider\u003cbr/\u003eFunction\"]\n    end\n    \n    subgraph \"Properties\"\n        Value[\"value: string\"]\n        Placeholder[\"placeholder: string\"]\n        Visible[\"visible: boolean\"]\n        Enabled[\"enabled: boolean\"]\n    end\n    \n    subgraph \"Main Thread\"\n        MainInput[\"MainThreadSCMInput\"]\n        InputWidget[\"SCM Input Widget\"]\n    end\n    \n    InputBoxImpl --\u003e Value\n    InputBoxImpl --\u003e Placeholder\n    InputBoxImpl --\u003e Visible\n    InputBoxImpl --\u003e Enabled\n    InputBoxImpl --\u003e ValidatorFn\n    InputBoxImpl --\u003e ValueProviderFn\n    \n    InputBoxImpl --\u003e|\"RPC Updates\"| MainInput\n    MainInput --\u003e InputWidget\n    \n    InputWidget --\u003e|\"User Types\"| MainInput\n    MainInput --\u003e|\"$onInputBoxValueChange\"| InputBoxImpl\n```\n\n### Input Validation\n\nExtensions can provide synchronous validation:\n\n```typescript\nsourceControl.inputBox.validateInput = (value: string, cursorPosition: number) =\u003e {\n    if (value.length === 0) {\n        return {\n            message: 'Commit message cannot be empty',\n            type: vscode.SourceControlInputBoxValidationType.Error\n        };\n    }\n    if (value.length \u003e 72) {\n        return {\n            message: 'First line should be less than 72 characters',\n            type: vscode.SourceControlInputBoxValidationType.Warning\n        };\n    }\n    return undefined;\n};\n```\n\nThe validation types are:\n\n| Type | Enum Value | Visual Treatment |\n|------|------------|------------------|\n| Error | `SourceControlInputBoxValidationType.Error` | Red error styling |\n| Warning | `SourceControlInputBoxValidationType.Warning` | Yellow warning styling |\n| Information | `SourceControlInputBoxValidationType.Information` | Blue info styling |\n\n**Sources:** [src/vs/workbench/api/common/extHostSCM.ts:700-800](), [src/vs/workbench/contrib/scm/common/scm.ts:100-150]()\n\n### Value Providers\n\nExtensions can provide initial values for the input box based on context:\n\n```typescript\nsourceControl.inputBox.valueProvider = async (context: vscode.SourceControlInputValueProviderContext) =\u003e {\n    if (context.resources.length === 1) {\n        // Generate message for single file change\n        const uri = context.resources[0];\n        return `Update ${path.basename(uri.fsPath)}`;\n    }\n    return undefined;\n};\n```\n\nThe context includes:\n- `resources`: Array of selected resource URIs\n- Additional context information from the UI\n\n**Sources:** [src/vs/workbench/api/common/extHostSCM.ts:750-850](), [src/vs/workbench/api/common/extHost.protocol.ts:880-900]()\n\n## Quick Diff Provider\n\nThe quick diff provider enables inline diff decorations in the editor (the green/red bars in the gutter):\n\n```mermaid\ngraph LR\n    subgraph \"Extension\"\n        QDP[\"QuickDiffProvider\"]\n        ProvideOriginal[\"provideOriginalResource()\"]\n    end\n    \n    subgraph \"Extension Host\"\n        QuickDiffImpl[\"QuickDiffImpl\"]\n    end\n    \n    subgraph \"Main Thread\"\n        MainQuickDiff[\"MainThreadSCM\u003cbr/\u003eQuickDiff\"]\n        Service[\"IQuickDiffService\"]\n    end\n    \n    subgraph \"Editor\"\n        Decorations[\"Diff Decorations\"]\n        Gutter[\"Gutter Indicators\"]\n    end\n    \n    QDP --\u003e ProvideOriginal\n    QDP --\u003e|\"registered via\"| QuickDiffImpl\n    QuickDiffImpl --\u003e|\"RPC\"| MainQuickDiff\n    MainQuickDiff --\u003e Service\n    Service --\u003e|\"queries\"| MainQuickDiff\n    MainQuickDiff --\u003e|\"RPC call\"| QuickDiffImpl\n    QuickDiffImpl --\u003e|\"calls\"| ProvideOriginal\n    Service --\u003e Decorations\n    Service --\u003e Gutter\n```\n\n### Implementation\n\n```typescript\nsourceControl.quickDiffProvider = {\n    provideOriginalResource(uri: vscode.Uri, token: vscode.CancellationToken): vscode.ProviderResult\u003cvscode.Uri\u003e {\n        // Return URI of the original version to diff against\n        // Could be: git show HEAD:file, svn cat file@BASE, etc.\n        if (isTracked(uri)) {\n            return vscode.Uri.parse(`git:${uri.fsPath}?HEAD`);\n        }\n        return null;\n    }\n};\n```\n\nThe quick diff provider is queried whenever:\n1. A document is opened in the editor\n2. A document is saved\n3. The SCM state changes (e.g., after a commit)\n\nThe returned URI is used with a `TextDocumentContentProvider` to retrieve the original content for comparison.\n\n**Sources:** [src/vs/workbench/api/common/extHostSCM.ts:900-1000](), [src/vs/workbench/api/common/extHostQuickDiff.ts:1-150]()\n\n## Type Conversion and RPC\n\nThe SCM API uses type converters to marshal data between extension types and internal types:\n\n### Key Converters\n\n| Extension Type | Internal Type | Converter Function |\n|----------------|---------------|-------------------|\n| `SourceControlResourceState` | `ISCMResource` | `convertResourceState()` |\n| `SourceControlResourceDecorations` | `ISCMResourceDecorations` | `convertDecorations()` |\n| `SourceControlInputBoxValidation` | `IInputValidation` | `convertValidation()` |\n| `Command` | `ICommandDto` | `Command.toInternal()` |\n\n### Resource State Conversion\n\nThe conversion from extension API types to internal types happens in `ExtHostSCM`:\n\n```mermaid\ngraph LR\n    subgraph \"Extension API Type\"\n        ExtResource[\"SourceControlResourceState\u003cbr/\u003e- resourceUri: Uri\u003cbr/\u003e- command: Command\u003cbr/\u003e- decorations: Decorations\"]\n    end\n    \n    subgraph \"Type Converter\"\n        Converter[\"Type Converter\u003cbr/\u003econvertResourceState()\"]\n    end\n    \n    subgraph \"Protocol DTO\"\n        DTO[\"SCMRawResourceDto\u003cbr/\u003e- handle: number\u003cbr/\u003e- sourceUri: UriComponents\u003cbr/\u003e- command: ICommandDto\u003cbr/\u003e- decorations: DecorationsDto\"]\n    end\n    \n    subgraph \"Internal Type\"\n        Internal[\"ISCMResource\u003cbr/\u003e- sourceUri: URI\u003cbr/\u003e- command: Command\u003cbr/\u003e- decorations: ISCMResourceDecorations\"]\n    end\n    \n    ExtResource --\u003e Converter\n    Converter --\u003e DTO\n    DTO --\u003e|\"RPC Transfer\"| Internal\n```\n\nThe `SourceControlResourceStateImpl` class implements caching and change detection:\n\n1. When `resourceStates` is set on a group, resources are compared\n2. Only changed resources trigger RPC messages\n3. Resources are identified by handle (a unique number)\n4. Decorations and commands are serialized to DTOs\n\n**Sources:** [src/vs/workbench/api/common/extHostSCM.ts:600-700](), [src/vs/workbench/api/common/extHostTypeConverters.ts:3500-3600](), [src/vs/workbench/api/common/extHost.protocol.ts:900-950]()\n\n## Complete Extension Flow\n\n```mermaid\nsequenceDiagram\n    participant Ext as Extension Code\n    participant API as vscode.scm API\n    participant EH as ExtHostSCM\n    participant RPC as RPC Protocol\n    participant MT as MainThreadSCM\n    participant Svc as ISCMService\n    participant UI as SCM View\n    \n    Note over Ext,UI: 1. Provider Registration\n    Ext-\u003e\u003eAPI: createSourceControl(id, label)\n    API-\u003e\u003eEH: createSourceControl()\n    EH-\u003e\u003eEH: new SourceControlImpl()\n    EH-\u003e\u003eRPC: $registerSourceControl(handle, id, label)\n    RPC-\u003e\u003eMT: $registerSourceControl()\n    MT-\u003e\u003eSvc: registerSCMProvider()\n    Svc--\u003e\u003eUI: Provider appears in UI\n    \n    Note over Ext,UI: 2. Resource Group Creation\n    Ext-\u003e\u003eAPI: sourceControl.createResourceGroup(id, label)\n    API-\u003e\u003eEH: createResourceGroup()\n    EH-\u003e\u003eEH: new SourceControlResourceGroupImpl()\n    EH-\u003e\u003eRPC: $registerGroup(handle, id, label)\n    RPC-\u003e\u003eMT: $registerGroup()\n    MT-\u003e\u003eSvc: Add resource group\n    \n    Note over Ext,UI: 3. Resource Updates\n    Ext-\u003e\u003eAPI: group.resourceStates = [...]\n    API-\u003e\u003eEH: set resourceStates\n    EH-\u003e\u003eEH: Diff and convert resources\n    EH-\u003e\u003eRPC: $spliceResourceStates(handle, splice)\n    RPC-\u003e\u003eMT: $spliceResourceStates()\n    MT-\u003e\u003eSvc: Update resources\n    Svc--\u003e\u003eUI: Refresh resource list\n    \n    Note over Ext,UI: 4. Input Box Interaction\n    UI-\u003e\u003eSvc: User types in input box\n    Svc-\u003e\u003eMT: Input value changed\n    MT-\u003e\u003eRPC: $onInputBoxValueChange(handle, value)\n    RPC-\u003e\u003eEH: $onInputBoxValueChange()\n    EH-\u003e\u003eAPI: inputBox.value = newValue\n    API-\u003e\u003eExt: onDidChangeValue event\n    \n    Note over Ext,UI: 5. Input Validation\n    UI-\u003e\u003eSvc: Request validation\n    Svc-\u003e\u003eMT: Validate input\n    MT-\u003e\u003eRPC: $validateInput(handle, value, cursorPos)\n    RPC-\u003e\u003eEH: $validateInput()\n    EH-\u003e\u003eExt: validateInput(value, cursorPos)\n    Ext--\u003e\u003eEH: ValidationResult\n    EH--\u003e\u003eRPC: IInputValidation\n    RPC--\u003e\u003eMT: IInputValidation\n    MT--\u003e\u003eSvc: IInputValidation\n    Svc--\u003e\u003eUI: Show validation message\n    \n    Note over Ext,UI: 6. Quick Diff\n    UI-\u003e\u003eSvc: Editor opened\n    Svc-\u003e\u003eMT: Request original resource\n    MT-\u003e\u003eRPC: $provideOriginalResource(handle, uri)\n    RPC-\u003e\u003eEH: $provideOriginalResource()\n    EH-\u003e\u003eExt: quickDiffProvider.provideOriginalResource()\n    Ext--\u003e\u003eEH: Original URI\n    EH--\u003e\u003eRPC: Original URI\n    RPC--\u003e\u003eMT: Original URI\n    MT--\u003e\u003eSvc: Original URI\n    Svc--\u003e\u003eUI: Show diff decorations\n```\n\n**Sources:** [src/vs/workbench/api/common/extHostSCM.ts:100-1000](), [src/vs/workbench/api/browser/mainThreadSCM.ts:100-800]()\n\n## History Provider Integration\n\nFor SCM history integration (commit history, branches, tags), extensions implement the `SourceControlHistoryProvider` interface. This is covered in detail in [SCM History Provider](#9.4).\n\nKey integration points:\n- `SourceControl.historyProvider` property\n- `provideHistoryItems()` - provides commit history\n- `provideHistoryItemChanges()` - provides file changes per commit\n- `resolveHistoryItemRefsCommonAncestor()` - finds common ancestor\n\n**Sources:** [src/vscode-dts/vscode.d.ts:5300-5500](), [src/vs/workbench/api/common/extHostSCM.ts:1050-1200]()\n\n## Action Buttons and Commands\n\nExtensions can register action buttons that appear in the SCM view:\n\n```typescript\nconst actionButton: vscode.SourceControlActionButton = {\n    command: {\n        title: 'Sync Changes',\n        command: 'myScm.sync',\n        arguments: []\n    },\n    description: 'Push and pull changes',\n    enabled: true\n};\n\nsourceControl.actionButton = actionButton;\n```\n\nThe action button appears in the SCM view title bar and can be dynamically updated by setting the property.\n\n**Sources:** [src/vs/workbench/api/common/extHostSCM.ts:350-400](), [src/vs/workbench/contrib/scm/common/scm.ts:80-120]()\n\n## Events and Observability\n\nThe SCM API exposes several events for extensions to react to user interactions:\n\n| Event | Interface | Purpose |\n|-------|-----------|---------|\n| `inputBox.onDidChange` | `Event\u003cstring\u003e` | Input box value changed |\n| `inputBox.onDidAccept` | `Event\u003cvoid\u003e` | User accepted input (e.g., committed) |\n| `onDidChangeState` | `Event\u003cvoid\u003e` | Provider state changed |\n\nExtensions use these events to stay synchronized with UI state and user actions.\n\n**Sources:** [src/vs/workbench/api/common/extHostSCM.ts:250-350](), [src/vscode-dts/vscode.d.ts:5050-5100]()"])</script><script>self.__next_f.push([1,"4c:T6b59,"])</script><script>self.__next_f.push([1,"# Git Extension\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [extensions/git/package.json](extensions/git/package.json)\n- [extensions/git/package.nls.json](extensions/git/package.nls.json)\n- [extensions/git/src/actionButton.ts](extensions/git/src/actionButton.ts)\n- [extensions/git/src/api/api1.ts](extensions/git/src/api/api1.ts)\n- [extensions/git/src/api/git.d.ts](extensions/git/src/api/git.d.ts)\n- [extensions/git/src/artifactProvider.ts](extensions/git/src/artifactProvider.ts)\n- [extensions/git/src/askpass-empty.sh](extensions/git/src/askpass-empty.sh)\n- [extensions/git/src/askpass-main.ts](extensions/git/src/askpass-main.ts)\n- [extensions/git/src/askpass.sh](extensions/git/src/askpass.sh)\n- [extensions/git/src/askpass.ts](extensions/git/src/askpass.ts)\n- [extensions/git/src/autofetch.ts](extensions/git/src/autofetch.ts)\n- [extensions/git/src/commands.ts](extensions/git/src/commands.ts)\n- [extensions/git/src/git.ts](extensions/git/src/git.ts)\n- [extensions/git/src/gitEditor.ts](extensions/git/src/gitEditor.ts)\n- [extensions/git/src/ipc/ipcClient.ts](extensions/git/src/ipc/ipcClient.ts)\n- [extensions/git/src/ipc/ipcServer.ts](extensions/git/src/ipc/ipcServer.ts)\n- [extensions/git/src/main.ts](extensions/git/src/main.ts)\n- [extensions/git/src/model.ts](extensions/git/src/model.ts)\n- [extensions/git/src/operation.ts](extensions/git/src/operation.ts)\n- [extensions/git/src/postCommitCommands.ts](extensions/git/src/postCommitCommands.ts)\n- [extensions/git/src/repository.ts](extensions/git/src/repository.ts)\n- [extensions/git/src/ssh-askpass-empty.sh](extensions/git/src/ssh-askpass-empty.sh)\n- [extensions/git/src/ssh-askpass.sh](extensions/git/src/ssh-askpass.sh)\n- [extensions/git/src/statusbar.ts](extensions/git/src/statusbar.ts)\n- [extensions/git/src/terminal.ts](extensions/git/src/terminal.ts)\n- [extensions/git/src/util.ts](extensions/git/src/util.ts)\n- [extensions/git/tsconfig.json](extensions/git/tsconfig.json)\n- [src/vs/workbench/contrib/scm/common/artifact.ts](src/vs/workbench/contrib/scm/common/artifact.ts)\n- [src/vscode-dts/vscode.proposed.scmArtifactProvider.d.ts](src/vscode-dts/vscode.proposed.scmArtifactProvider.d.ts)\n- [test/automation/src/statusbar.ts](test/automation/src/statusbar.ts)\n\n\u003c/details\u003e\n\n\n\nThe Git Extension is VS Code's built-in extension that provides Git version control integration. It implements the SCM Framework (see [SCM Framework Architecture](#9.1)) as the primary source control provider, exposing Git functionality through the Source Control view, commands, and extension API. The extension manages Git repository discovery, executes Git operations, and provides features like commit history, branch management, and conflict resolution.\n\nFor information about the SCM framework that this extension implements, see [Source Control Management](#9). For the public API that other extensions can consume, see [SCM Extension API](#9.5).\n\n## Extension Activation and Initialization\n\nThe Git Extension activates immediately on workspace open (`activationEvents: [\"*\"]`). The activation flow in [extensions/git/src/main.ts:190-262]() creates the core infrastructure:\n\n1. **Git Discovery**: Searches for git executable using `findGit()` which checks configuration paths, system paths, and platform-specific locations\n2. **IPC Server Setup**: Creates `IPCServer` for handling askpass and git editor operations\n3. **Model Creation**: Instantiates the `Model` class which manages repository lifecycle\n4. **Command Registration**: Registers all git commands through `CommandCenter`\n5. **Provider Registration**: Registers file system provider, decorations, timeline, and other providers\n\n```mermaid\ngraph TD\n    Activate[\"activate()\"] --\u003e FindGit[\"findGit()\"]\n    FindGit --\u003e CreateIPC[\"createIPCServer()\"]\n    CreateIPC --\u003e CreateAskpass[\"new Askpass()\"]\n    CreateIPC --\u003e CreateGitEditor[\"new GitEditor()\"]\n    CreateAskpass --\u003e CreateGit[\"new Git()\"]\n    CreateGit --\u003e CreateModel[\"new Model()\"]\n    CreateModel --\u003e CreateCC[\"new CommandCenter()\"]\n    CreateModel --\u003e RegisterProviders[\"Register Providers\"]\n    RegisterProviders --\u003e FSProvider[\"GitFileSystemProvider\"]\n    RegisterProviders --\u003e Decorations[\"GitDecorations\"]\n    RegisterProviders --\u003e Timeline[\"GitTimelineProvider\"]\n    RegisterProviders --\u003e Blame[\"GitBlameController\"]\n    CreateCC --\u003e RegisterCommands[\"Register Commands\"]\n```\n\n**Sources**: [extensions/git/src/main.ts:190-262](), [extensions/git/src/main.ts:40-139]()\n\n## Architecture Overview\n\nThe Git Extension consists of several major components organized in layers:\n\n```mermaid\ngraph TB\n    subgraph \"User Interface Layer\"\n        Commands[\"CommandCenter\u003cbr/\u003ecommands.ts\"]\n        SCMView[\"SCM View Integration\u003cbr/\u003eRepository.sourceControl\"]\n        StatusBar[\"StatusBarCommands\u003cbr/\u003estatusbar.ts\"]\n        ActionButton[\"ActionButton\u003cbr/\u003eactionButton.ts\"]\n    end\n    \n    subgraph \"Model Layer\"\n        Model[\"Model\u003cbr/\u003emodel.ts\u003cbr/\u003eRepository Discovery \u0026 Management\"]\n        Repository[\"Repository\u003cbr/\u003erepository.ts\u003cbr/\u003eGit Repository Representation\"]\n        OperationManager[\"OperationManager\u003cbr/\u003eoperation.ts\u003cbr/\u003eConcurrent Operation Control\"]\n    end\n    \n    subgraph \"Git Execution Layer\"\n        Git[\"Git\u003cbr/\u003egit.ts\u003cbr/\u003eCommand Execution\"]\n        BaseRepository[\"Repository (git.ts)\u003cbr/\u003eLow-level Git Operations\"]\n    end\n    \n    subgraph \"Supporting Infrastructure\"\n        Askpass[\"Askpass\u003cbr/\u003easkpass.ts\u003cbr/\u003eCredential Handling\"]\n        GitEditor[\"GitEditor\u003cbr/\u003egitEditor.ts\u003cbr/\u003eCommit Message Editor\"]\n        IPCServer[\"IPCServer\u003cbr/\u003eipc/ipcServer.ts\"]\n        AutoFetcher[\"AutoFetcher\u003cbr/\u003eautofetch.ts\"]\n    end\n    \n    subgraph \"SCM Framework Integration\"\n        HistoryProvider[\"GitHistoryProvider\u003cbr/\u003ehistoryProvider.ts\"]\n        ArtifactProvider[\"GitArtifactProvider\u003cbr/\u003eartifactProvider.ts\"]\n        QuickDiffProvider[\"Repository.quickDiff\"]\n    end\n    \n    Commands --\u003e Model\n    Commands --\u003e Repository\n    SCMView --\u003e Repository\n    StatusBar --\u003e Repository\n    ActionButton --\u003e Repository\n    \n    Model --\u003e Repository\n    Repository --\u003e OperationManager\n    Repository --\u003e BaseRepository\n    Repository --\u003e HistoryProvider\n    Repository --\u003e ArtifactProvider\n    \n    BaseRepository --\u003e Git\n    Git --\u003e Askpass\n    Git --\u003e GitEditor\n    Askpass --\u003e IPCServer\n    GitEditor --\u003e IPCServer\n    \n    Repository --\u003e AutoFetcher\n```\n\n**Sources**: [extensions/git/src/main.ts:40-139](), [extensions/git/src/model.ts:186-307](), [extensions/git/src/repository.ts:699-1000](), [extensions/git/src/git.ts:385-614]()\n\n## Model and Repository Management\n\n### Model Class\n\nThe `Model` class in [extensions/git/src/model.ts:186-307]() serves as the central coordinator for repository management:\n\n| Responsibility | Implementation |\n|---|---|\n| Repository Discovery | Scans workspace folders and open editors for `.git` directories |\n| Repository Lifecycle | Opens repositories, tracks state, closes repositories |\n| Multi-Repository Support | Manages multiple concurrent repositories |\n| Parent/Unsafe Repository Handling | Tracks repositories in parent folders and unsafe repositories |\n| Extension API Registry | Maintains registries for branch protection, publishers, etc. |\n\n```mermaid\ngraph TD\n    Model[\"Model\u003cbr/\u003emodel.ts\"] --\u003e DoInitialScan[\"doInitialScan()\"]\n    DoInitialScan --\u003e ScanWorkspaceFolders[\"scanWorkspaceFolders()\"]\n    DoInitialScan --\u003e OnDidChangeWorkspaceFolders[\"onDidChangeWorkspaceFolders()\"]\n    DoInitialScan --\u003e OnDidChangeVisibleTextEditors[\"onDidChangeVisibleTextEditors()\"]\n    \n    ScanWorkspaceFolders --\u003e ScanRepositoryRoot[\"scanRepositoryRoot()\"]\n    ScanRepositoryRoot --\u003e OpenRepository[\"openRepository()\"]\n    OpenRepository --\u003e CreateRepository[\"new Repository()\"]\n    CreateRepository --\u003e AddRepository[\"openRepositories.push()\"]\n    \n    Model --\u003e ClosedReposManager[\"ClosedRepositoriesManager\u003cbr/\u003eTracks closed repos\"]\n    Model --\u003e ParentReposManager[\"ParentRepositoriesManager\u003cbr/\u003eRepos in parent folders\"]\n    Model --\u003e UnsafeReposManager[\"UnsafeRepositoriesManager\u003cbr/\u003eUnsafe repos\"]\n```\n\n**Sources**: [extensions/git/src/model.ts:186-307](), [extensions/git/src/model.ts:310-350](), [extensions/git/src/model.ts:357-449]()\n\n### Repository Class\n\nThe `Repository` class in [extensions/git/src/repository.ts:699-1000]() represents a single Git repository:\n\n| Component | Purpose |\n|---|---|\n| `sourceControl: SourceControl` | VS Code SCM integration point |\n| `repository: BaseRepository` | Low-level git operations wrapper |\n| `operations: OperationManager` | Manages concurrent git operations |\n| Resource Groups | `indexGroup`, `workingTreeGroup`, `mergeGroup`, `untrackedGroup` |\n| `HEAD: Branch` | Current branch/ref information |\n| `remotes: Remote[]` | Configured remotes |\n| `submodules: Submodule[]` | Git submodules |\n| `worktrees: Worktree[]` | Git worktrees |\n\n```mermaid\ngraph LR\n    Repository[\"Repository\u003cbr/\u003erepository.ts\"] --\u003e SourceControl[\"sourceControl\u003cbr/\u003eISourceControl\"]\n    Repository --\u003e BaseRepo[\"repository\u003cbr/\u003eBaseRepository (git.ts)\"]\n    Repository --\u003e OpManager[\"operations\u003cbr/\u003eOperationManager\"]\n    Repository --\u003e ResourceGroups[\"Resource Groups\"]\n    \n    ResourceGroups --\u003e IndexGroup[\"indexGroup\u003cbr/\u003eStaged Changes\"]\n    ResourceGroups --\u003e WorkingTreeGroup[\"workingTreeGroup\u003cbr/\u003eModified Files\"]\n    ResourceGroups --\u003e MergeGroup[\"mergeGroup\u003cbr/\u003eMerge Conflicts\"]\n    ResourceGroups --\u003e UntrackedGroup[\"untrackedGroup\u003cbr/\u003eUntracked Files\"]\n    \n    Repository --\u003e Providers[\"Providers\"]\n    Providers --\u003e HistoryProvider[\"historyProvider\u003cbr/\u003eGitHistoryProvider\"]\n    Providers --\u003e ArtifactProvider[\"artifactProvider\u003cbr/\u003eGitArtifactProvider\"]\n    Providers --\u003e QuickDiff[\"quickDiff\u003cbr/\u003eQuickDiffProvider\"]\n    \n    Repository --\u003e Watchers[\"File Watchers\"]\n    Watchers --\u003e DotGitWatcher[\"dotGitWatcher\u003cbr/\u003eWatches .git\"]\n    Watchers --\u003e WorkspaceWatcher[\"Workspace file changes\"]\n```\n\n**Sources**: [extensions/git/src/repository.ts:699-1000](), [extensions/git/src/repository.ts:1001-1200](), [extensions/git/src/repository.ts:345-414]()\n\n### Repository Status Flow\n\nThe repository status is updated through the `status()` method which orchestrates the following flow:\n\n```mermaid\nsequenceDiagram\n    participant U as User/Timer\n    participant R as Repository\n    participant O as OperationManager\n    participant BR as BaseRepository\n    participant G as Git\n    \n    U-\u003e\u003eR: Trigger refresh\n    R-\u003e\u003eO: run(OperationKind.Status)\n    O-\u003e\u003eBR: status()\n    BR-\u003e\u003eG: exec('status', '--porcelain=v2')\n    G--\u003e\u003eBR: Raw git output\n    BR-\u003e\u003eBR: parseStatusInfo()\n    BR--\u003e\u003eR: IFileStatus[]\n    R-\u003e\u003eR: updateResourceGroups()\n    R-\u003e\u003eR: _onDidRunGitStatus.fire()\n```\n\n**Sources**: [extensions/git/src/repository.ts:1470-1580](), [extensions/git/src/git.ts:1138-1350]()\n\n## Git Command Execution\n\n### Git Class\n\nThe `Git` class in [extensions/git/src/git.ts:385-614]() provides the low-level interface to the git executable:\n\n| Method | Purpose |\n|---|---|\n| `exec()` | Execute git command with arguments |\n| `stream()` | Stream git command output |\n| `clone()` | Clone a repository with progress reporting |\n| `init()` | Initialize a new repository |\n| `getRepositoryRoot()` | Find repository root from path |\n| `getRepositoryDotGit()` | Get `.git` directory information |\n\n```mermaid\ngraph TD\n    GitExec[\"Git.exec()\"] --\u003e Spawn[\"spawn git process\"]\n    Spawn --\u003e BuildArgs[\"Build arguments\"]\n    Spawn --\u003e SetEnv[\"Set environment\u003cbr/\u003eGIT_ASKPASS, GIT_EDITOR\"]\n    SetEnv --\u003e Execute[\"cp.spawn(gitPath, args)\"]\n    Execute --\u003e CollectOutput[\"Collect stdout/stderr\"]\n    CollectOutput --\u003e ParseResult[\"Parse result\"]\n    ParseResult --\u003e HandleError[\"Handle GitError\"]\n    HandleError --\u003e CheckErrorCode[\"getGitErrorCode()\"]\n```\n\n**Sources**: [extensions/git/src/git.ts:385-614](), [extensions/git/src/git.ts:591-613](), [extensions/git/src/git.ts:328-363]()\n\n### BaseRepository Class\n\nThe `BaseRepository` class in [extensions/git/src/git.ts:700-1000]() wraps `Git` with higher-level repository operations:\n\n**Key Methods**:\n- `status()`: Get repository status with conflict detection\n- `add()`, `stage()`: Stage files\n- `commit()`: Create commits with various options\n- `checkout()`: Checkout branches/refs\n- `branch()`, `deleteBranch()`: Branch management\n- `fetch()`, `pull()`, `push()`: Remote operations\n- `merge()`, `rebase()`: Integration operations\n- `diff*()`: Various diff operations\n- `log()`: Retrieve commit history\n\n**Sources**: [extensions/git/src/git.ts:700-1000](), [extensions/git/src/git.ts:1138-1350](), [extensions/git/src/git.ts:1730-1900]()\n\n## Command Center\n\nThe `CommandCenter` class in [extensions/git/src/commands.ts:780-800]() implements all user-facing git commands using the `@command` decorator:\n\n```mermaid\ngraph TB\n    CommandCenter[\"CommandCenter\u003cbr/\u003ecommands.ts\"] --\u003e Lifecycle[\"Repository Lifecycle\"]\n    CommandCenter --\u003e FileOps[\"File Operations\"]\n    CommandCenter --\u003e Commits[\"Commit Operations\"]\n    CommandCenter --\u003e Branches[\"Branch Operations\"]\n    CommandCenter --\u003e Remotes[\"Remote Operations\"]\n    \n    Lifecycle --\u003e Init[\"init()\"]\n    Lifecycle --\u003e Clone[\"clone()\"]\n    Lifecycle --\u003e OpenRepo[\"openRepository()\"]\n    Lifecycle --\u003e CloseRepo[\"close()\"]\n    \n    FileOps --\u003e Stage[\"stage(), stageAll()\"]\n    FileOps --\u003e Unstage[\"unstage(), unstageAll()\"]\n    FileOps --\u003e Clean[\"clean(), cleanAll()\"]\n    FileOps --\u003e Revert[\"revert()\"]\n    \n    Commits --\u003e Commit[\"commit()\"]\n    Commits --\u003e CommitAmend[\"commitAmend()\"]\n    Commits --\u003e UndoCommit[\"undoCommit()\"]\n    Commits --\u003e Stash[\"stash(), stashPop()\"]\n    \n    Branches --\u003e Checkout[\"checkout()\"]\n    Branches --\u003e Branch[\"branch(), branchFrom()\"]\n    Branches --\u003e DeleteBranch[\"deleteBranch()\"]\n    Branches --\u003e Merge[\"merge()\"]\n    Branches --\u003e Rebase[\"rebase()\"]\n    \n    Remotes --\u003e Fetch[\"fetch(), fetchAll()\"]\n    Remotes --\u003e Pull[\"pull(), pullRebase()\"]\n    Remotes --\u003e Push[\"push(), pushForce()\"]\n    Remotes --\u003e Sync[\"sync()\"]\n    Remotes --\u003e Publish[\"publish()\"]\n```\n\n**Command Registration**: Commands are registered via the `@command` decorator which populates the `Commands` array. During construction, each command is registered with VS Code's command system:\n\n```\n@command('git.refresh', { repository: true })\nasync refresh(repository: Repository): Promise\u003cvoid\u003e\n```\n\n**Sources**: [extensions/git/src/commands.ts:780-800](), [extensions/git/src/commands.ts:375-383](), [extensions/git/src/commands.ts:801-1200]()\n\n## Integration with SCM Framework\n\nThe Git Extension integrates with VS Code's SCM Framework by implementing several key interfaces:\n\n### Source Control Provider\n\nEach `Repository` creates a `SourceControl` instance in [extensions/git/src/repository.ts:699-850]():\n\n| SCM Element | Git Implementation |\n|---|---|\n| `SourceControl` | Created via `scm.createSourceControl('git', 'Git')` |\n| `SourceControlResourceGroup` | `indexGroup`, `workingTreeGroup`, `mergeGroup`, `untrackedGroup` |\n| `SourceControlResourceState` | `Resource` class with decorations and commands |\n| `SourceControlInputBox` | Commit message input with validation |\n| `SourceControlActionButton` | Commit/Sync/Publish button via `ActionButton` |\n\n```mermaid\ngraph LR\n    Repository[\"Repository\"] --\u003e CreateSC[\"scm.createSourceControl()\"]\n    CreateSC --\u003e SourceControl[\"sourceControl\u003cbr/\u003eSourceControl\"]\n    \n    SourceControl --\u003e InputBox[\"inputBox\u003cbr/\u003eCommit Message\"]\n    SourceControl --\u003e ResourceGroups[\"Resource Groups\"]\n    \n    ResourceGroups --\u003e CreateGroup[\"createResourceGroup()\"]\n    CreateGroup --\u003e IndexGroup[\"Index\u003cbr/\u003eStaged Changes\"]\n    CreateGroup --\u003e WorkingTreeGroup[\"Working Tree\u003cbr/\u003eModified Files\"]\n    CreateGroup --\u003e MergeGroup[\"Merge\u003cbr/\u003eConflicts\"]\n    CreateGroup --\u003e UntrackedGroup[\"Untracked\u003cbr/\u003eNew Files\"]\n    \n    IndexGroup --\u003e Resources[\"Resource[]\"]\n    WorkingTreeGroup --\u003e Resources\n    MergeGroup --\u003e Resources\n    UntrackedGroup --\u003e Resources\n    \n    Resources --\u003e ResourceClass[\"Resource\u003cbr/\u003ewith decorations\"]\n```\n\n**Sources**: [extensions/git/src/repository.ts:699-850](), [extensions/git/src/repository.ts:52-343]()\n\n### History Provider\n\n`GitHistoryProvider` in [extensions/git/src/historyProvider.ts]() implements `SourceControlHistoryProvider`:\n\n**Key Methods**:\n- `provideCurrentHistory()`: Returns current branch history\n- `provideHistoryItems()`: Retrieves commit history for pagination\n- `provideHistoryItemChanges()`: Gets file changes for a commit\n- `resolveHistoryItemRefsCommonAncestor()`: Finds merge base\n\nThe provider uses the repository's `log()` method to retrieve commits and transforms them into `SourceControlHistoryItem` format.\n\n**Sources**: [extensions/git/src/historyProvider.ts]()\n\n### Artifact Provider\n\n`GitArtifactProvider` in [extensions/git/src/artifactProvider.ts:68-200]() implements `SourceControlArtifactProvider` to expose branches, tags, and worktrees:\n\n```mermaid\ngraph TD\n    ArtifactProvider[\"GitArtifactProvider\"] --\u003e Groups[\"Artifact Groups\"]\n    \n    Groups --\u003e BranchesGroup[\"branches\u003cbr/\u003eLocal \u0026 Remote Branches\"]\n    Groups --\u003e TagsGroup[\"tags\u003cbr/\u003eGit Tags\"]\n    Groups --\u003e WorktreesGroup[\"worktrees\u003cbr/\u003eGit Worktrees\"]\n    \n    BranchesGroup --\u003e GetArtifacts[\"getArtifacts('branches')\"]\n    GetArtifacts --\u003e FilterRefs[\"Filter refs by type\"]\n    FilterRefs --\u003e CreateArtifact[\"Create SourceControlArtifact\"]\n    CreateArtifact --\u003e AddActions[\"Add contextValue for menus\"]\n```\n\n**Artifact Types**:\n- **Branches**: Local and remote branches with commit information\n- **Tags**: Annotated and lightweight tags\n- **Worktrees**: Active git worktrees\n\n**Sources**: [extensions/git/src/artifactProvider.ts:68-200]()\n\n### Quick Diff Provider\n\nThe repository implements `QuickDiffProvider` to show inline diff decorations:\n\n```typescript\nquickDiff = {\n    provideOriginalResource: (uri: Uri) =\u003e toGitUri(uri, '~')\n}\n```\n\nThis provides the \"original\" version of files for diff comparison in the editor gutter.\n\n**Sources**: [extensions/git/src/repository.ts:870-900]()\n\n## Operation Management\n\nThe `OperationManager` in [extensions/git/src/operation.ts:179-350]() ensures safe concurrent execution of git operations:\n\n| Feature | Purpose |\n|---|---|\n| Operation Queueing | Serializes conflicting operations |\n| Blocking Operations | Prevents concurrent modifying operations |\n| Operation Kinds | 60+ operation types (Commit, Fetch, Push, etc.) |\n| Progress Reporting | Shows operations in SCM view |\n| Retry Logic | Retries failed operations |\n\n```mermaid\ngraph TD\n    Run[\"OperationManager.run()\"] --\u003e CheckRunning[\"Check if running\"]\n    CheckRunning --\u003e|Allowed| CreateOp[\"Create Operation\"]\n    CheckRunning --\u003e|Blocked| Queue[\"Add to queue\"]\n    \n    CreateOp --\u003e SetRunning[\"operations.add(operation)\"]\n    SetRunning --\u003e Execute[\"Execute function\"]\n    Execute --\u003e OnDidChange[\"_onDidChangeOperations.fire()\"]\n    Execute --\u003e EndOp[\"operation.end()\"]\n    EndOp --\u003e Remove[\"operations.delete(operation)\"]\n    Remove --\u003e ProcessQueue[\"Process queued operations\"]\n```\n\n**Operation Properties**:\n- `kind`: Operation type (from `OperationKind` enum)\n- `blocking`: Whether it blocks other operations\n- `readOnly`: Whether it modifies repository state\n- `remote`: Whether it involves network communication\n- `retry`: Whether it should be retried on failure\n- `showProgress`: Whether to show in UI\n\n**Sources**: [extensions/git/src/operation.ts:179-350](), [extensions/git/src/operation.ts:9-78]()\n\n## IPC Infrastructure\n\nThe Git Extension uses IPC (Inter-Process Communication) to handle credential prompts and commit message editing:\n\n### Askpass System\n\n```mermaid\nsequenceDiagram\n    participant G as Git Process\n    participant Script as askpass.sh\n    participant Node as askpass-main.js\n    participant IPC as IPCClient\n    participant Server as IPCServer\n    participant Askpass as Askpass Handler\n    participant UI as VS Code UI\n    \n    G-\u003e\u003eScript: Execute GIT_ASKPASS script\n    Script-\u003e\u003eNode: Spawn Node.js process\n    Node-\u003e\u003eIPC: IPCClient.call()\n    IPC-\u003e\u003eServer: HTTP request to pipe\n    Server-\u003e\u003eAskpass: Route to 'askpass' handler\n    Askpass-\u003e\u003eUI: window.showInputBox()\n    UI--\u003e\u003eAskpass: User input\n    Askpass--\u003e\u003eServer: Return credentials\n    Server--\u003e\u003eIPC: Response\n    IPC--\u003e\u003eNode: Credentials\n    Node--\u003e\u003eScript: Write to pipe\n    Script--\u003e\u003eG: Return credentials\n```\n\n**Key Files**:\n- [extensions/git/src/askpass.sh:1-6]() - Shell script that git calls\n- [extensions/git/src/askpass-main.ts:1-44]() - Node.js entry point\n- [extensions/git/src/askpass.ts:13-140]() - Handler implementation\n- [extensions/git/src/ipc/ipcServer.ts:1-100]() - IPC server\n- [extensions/git/src/ipc/ipcClient.ts:1-40]() - IPC client\n\n**Environment Variables Set**:\n```\nGIT_ASKPASS=\u003cextension-path\u003e/askpass.sh\nVSCODE_GIT_ASKPASS_NODE=\u003cnode-path\u003e\nVSCODE_GIT_ASKPASS_MAIN=\u003cextension-path\u003e/askpass-main.js\nVSCODE_GIT_ASKPASS_PIPE=\u003ctemp-pipe-path\u003e\n```\n\n**Sources**: [extensions/git/src/askpass.ts:13-140](), [extensions/git/src/askpass-main.ts:1-44](), [extensions/git/src/ipc/ipcServer.ts:1-100]()\n\n### Git Editor System\n\nThe `GitEditor` class in [extensions/git/src/gitEditor.ts:1-150]() implements `GIT_EDITOR` functionality:\n\n**Purpose**: Opens commit message files in VS Code editor instead of external editor.\n\n**Flow**:\n1. Git spawns `git-editor.sh` when commit message needed\n2. Script calls `git-editor-main.js` via Node.js\n3. IPC call to `GitEditor` handler\n4. Opens document in VS Code with special URI scheme\n5. Waits for user to save/close\n6. Returns edited content to git\n\n**Environment Variables**:\n```\nGIT_EDITOR=\u003cextension-path\u003e/git-editor.sh\nVSCODE_GIT_EDITOR_NODE=\u003cnode-path\u003e\nVSCODE_GIT_EDITOR_MAIN=\u003cextension-path\u003e/git-editor-main.js\n```\n\n**Sources**: [extensions/git/src/gitEditor.ts:1-150]()\n\n## Supporting Features\n\n### Action Button\n\nThe `ActionButton` class in [extensions/git/src/actionButton.ts:43-200]() provides the dynamic commit/sync/publish button in the SCM view:\n\n**Button States**:\n1. **Commit** (when changes exist): Primary action to commit staged/all changes\n2. **Publish Branch** (when branch has no upstream): Publish to remote\n3. **Sync Changes** (when branch is tracking): Sync with remote\n4. **Commit (disabled)**: When no changes but showing button\n\nThe button adapts based on:\n- Repository state (has changes, merge/rebase in progress)\n- Branch state (protected, has upstream, ahead/behind)\n- Operation state (commit/checkout/sync in progress)\n- Post-commit command configuration\n\n**Sources**: [extensions/git/src/actionButton.ts:43-200]()\n\n### Status Bar\n\nThe `StatusBarCommands` class in [extensions/git/src/statusbar.ts:1-250]() manages the status bar elements:\n\n| Status Bar Item | Content |\n|---|---|\n| Checkout Status | Branch name with icon, checkout command |\n| Sync Status | Ahead/behind counts, sync command |\n\nIcons vary based on repository state:\n- `$(git-branch)`: Normal branch\n- `$(lock)`: Protected branch\n- `$(git-branch-conflicts)`: Merge/rebase in progress\n- `$(git-branch-staged-changes)`: Staged changes\n- `$(git-branch-changes)`: Working tree changes\n- `$(tag)`: Detached at tag\n- `$(git-commit)`: Detached at commit\n\n**Sources**: [extensions/git/src/statusbar.ts:1-250]()\n\n### Branch Protection\n\nThe extension supports branch protection via the `GitBranchProtectionProvider` in [extensions/git/src/branchProtection.ts]():\n\n**Configuration**: Users configure protected branches via `git.branchProtection` setting using glob patterns:\n```json\n{\n  \"git.branchProtection\": [\"main\", \"release/*\"]\n}\n```\n\n**Behavior**: When committing to protected branch, the extension:\n1. Checks if current branch matches protection patterns\n2. Shows prompt based on `git.branchProtectionPrompt` setting\n3. Options: Always commit, commit to new branch, or prompt each time\n\n**Sources**: [extensions/git/src/branchProtection.ts](), [extensions/git/src/repository.ts:690-730]()\n\n### Auto-Fetch\n\nThe `AutoFetcher` class in [extensions/git/src/autofetch.ts:11-120]() automatically fetches from remotes:\n\n**Configuration**:\n- `git.autofetch`: Enable/disable (true/false/'all')\n- `git.autofetchPeriod`: Interval in seconds (default 180)\n\n**Behavior**:\n- Fetches in background at configured interval\n- Can fetch from default remote or all remotes\n- Pauses when repository operations are running\n- Shows notification on first use to inform user\n\n**Sources**: [extensions/git/src/autofetch.ts:11-120]()\n\n### Timeline Provider\n\nThe `GitTimelineProvider` in [extensions/git/src/timelineProvider.ts]() implements VS Code's Timeline view:\n\n**Provides**:\n- File history as timeline items\n- Commit metadata (author, date, message)\n- Actions: Open diff, copy commit ID, select for compare\n\n**Implementation**: Uses `git log` with `--follow` option to track file history across renames.\n\n**Sources**: [extensions/git/src/timelineProvider.ts]()\n\n### Blame Controller\n\nThe `GitBlameController` in [extensions/git/src/blame.ts]() provides git blame information:\n\n**Features**:\n- Editor decorations showing author and date\n- Status bar item with current line blame\n- Commands to toggle blame display\n\n**Implementation**: Executes `git blame` command and parses output into line-by-line attribution.\n\n**Sources**: [extensions/git/src/blame.ts]()\n\n## Extension API\n\nThe Git Extension exposes a public API that other extensions can consume via `getExtension('vscode.git')`. The API is defined in [extensions/git/src/api/git.d.ts:1-420]() and implemented in [extensions/git/src/api/api1.ts:1-300]().\n\n### API Structure\n\n```mermaid\ngraph TD\n    API[\"API Interface\"] --\u003e Git[\"git: Git\u003cbr/\u003eGit executable info\"]\n    API --\u003e Repos[\"repositories: Repository[]\"]\n    API --\u003e Events[\"Events\"]\n    \n    Events --\u003e OnDidOpenRepo[\"onDidOpenRepository\"]\n    Events --\u003e OnDidCloseRepo[\"onDidCloseRepository\"]\n    Events --\u003e OnDidPublish[\"onDidPublish\"]\n    \n    Repos --\u003e Repository[\"Repository Interface\"]\n    Repository --\u003e State[\"state: RepositoryState\u003cbr/\u003eHEAD, refs, remotes\"]\n    Repository --\u003e InputBox[\"inputBox: InputBox\u003cbr/\u003eCommit message\"]\n    Repository --\u003e Operations[\"Operations\"]\n    \n    Operations --\u003e FileOps[\"add(), revert(), clean()\"]\n    Operations --\u003e CommitOps[\"commit(), merge()\"]\n    Operations --\u003e RemoteOps[\"fetch(), pull(), push()\"]\n    Operations --\u003e BranchOps[\"createBranch(), checkout()\"]\n    Operations --\u003e DiffOps[\"diff(), diffWith()\"]\n```\n\n**Key API Members**:\n- `getRepository(uri: Uri)`: Get repository for file\n- `repositories`: Array of open repositories\n- `toGitUri(uri: Uri, ref: string)`: Create git URI for ref\n- Provider registration: `registerRemoteSourcePublisher()`, `registerCredentialsProvider()`, etc.\n\n**Sources**: [extensions/git/src/api/git.d.ts:1-420](), [extensions/git/src/api/api1.ts:1-300](), [extensions/git/src/api/extension.ts]()\n\n## Configuration\n\nThe Git Extension provides extensive configuration options via `git.*` settings defined in [extensions/git/package.json:159-263]():\n\n| Category | Key Settings |\n|---|---|\n| **General** | `git.enabled`, `git.path`, `git.autoRepositoryDetection` |\n| **Commits** | `git.enableSmartCommit`, `git.enableCommitSigning`, `git.useEditorAsCommitInput` |\n| **Branches** | `git.defaultBranchName`, `git.branchProtection`, `git.branchPrefix` |\n| **Remotes** | `git.autofetch`, `git.pullBeforeCheckout`, `git.fetchOnPull` |\n| **Advanced** | `git.allowForcePush`, `git.autoStash`, `git.rebaseWhenSync` |\n| **UI** | `git.decorations.enabled`, `git.showActionButton`, `git.showProgress` |\n\n**Sources**: [extensions/git/package.json:159-263]()"])</script><script>self.__next_f.push([1,"4d:T59b9,"])</script><script>self.__next_f.push([1,"# Git Extension Architecture\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [extensions/git/package.json](extensions/git/package.json)\n- [extensions/git/package.nls.json](extensions/git/package.nls.json)\n- [extensions/git/src/actionButton.ts](extensions/git/src/actionButton.ts)\n- [extensions/git/src/api/api1.ts](extensions/git/src/api/api1.ts)\n- [extensions/git/src/api/git.d.ts](extensions/git/src/api/git.d.ts)\n- [extensions/git/src/artifactProvider.ts](extensions/git/src/artifactProvider.ts)\n- [extensions/git/src/askpass-empty.sh](extensions/git/src/askpass-empty.sh)\n- [extensions/git/src/askpass-main.ts](extensions/git/src/askpass-main.ts)\n- [extensions/git/src/askpass.sh](extensions/git/src/askpass.sh)\n- [extensions/git/src/askpass.ts](extensions/git/src/askpass.ts)\n- [extensions/git/src/autofetch.ts](extensions/git/src/autofetch.ts)\n- [extensions/git/src/commands.ts](extensions/git/src/commands.ts)\n- [extensions/git/src/git.ts](extensions/git/src/git.ts)\n- [extensions/git/src/gitEditor.ts](extensions/git/src/gitEditor.ts)\n- [extensions/git/src/ipc/ipcClient.ts](extensions/git/src/ipc/ipcClient.ts)\n- [extensions/git/src/ipc/ipcServer.ts](extensions/git/src/ipc/ipcServer.ts)\n- [extensions/git/src/main.ts](extensions/git/src/main.ts)\n- [extensions/git/src/model.ts](extensions/git/src/model.ts)\n- [extensions/git/src/operation.ts](extensions/git/src/operation.ts)\n- [extensions/git/src/postCommitCommands.ts](extensions/git/src/postCommitCommands.ts)\n- [extensions/git/src/repository.ts](extensions/git/src/repository.ts)\n- [extensions/git/src/ssh-askpass-empty.sh](extensions/git/src/ssh-askpass-empty.sh)\n- [extensions/git/src/ssh-askpass.sh](extensions/git/src/ssh-askpass.sh)\n- [extensions/git/src/statusbar.ts](extensions/git/src/statusbar.ts)\n- [extensions/git/src/terminal.ts](extensions/git/src/terminal.ts)\n- [extensions/git/src/util.ts](extensions/git/src/util.ts)\n- [extensions/git/tsconfig.json](extensions/git/tsconfig.json)\n- [src/vs/workbench/contrib/scm/common/artifact.ts](src/vs/workbench/contrib/scm/common/artifact.ts)\n- [src/vscode-dts/vscode.proposed.scmArtifactProvider.d.ts](src/vscode-dts/vscode.proposed.scmArtifactProvider.d.ts)\n- [test/automation/src/statusbar.ts](test/automation/src/statusbar.ts)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis document describes the internal architecture of the Git extension, a built-in extension that provides Git source control integration for VS Code. It covers the extension's core classes, command system, state management, and integration with VS Code's Source Control Management (SCM) framework.\n\nFor information about the broader SCM framework that this extension integrates with, see [Git Extension and SCM Framework](#11). For Git operations and CLI interaction details, see [Git Operations and State Management](#11.3).\n\n---\n\n## High-Level Architecture\n\nThe Git extension follows a three-layer architecture separating repository management, state management, and Git CLI execution.\n\n### Three-Layer Abstraction\n\n```mermaid\ngraph TB\n    subgraph \"Layer 1: Multi-Repository Management\"\n        Model[\"Model\u003cbr/\u003eextensions/git/src/model.ts:186\"]\n        ModelResp[\"Responsibilities:\u003cbr/\u003e- Repository discovery\u003cbr/\u003e- Multi-repository coordination\u003cbr/\u003e- Extension API registry\"]\n    end\n    \n    subgraph \"Layer 2: Repository State \u0026 SCM Integration\"\n        Repository[\"Repository\u003cbr/\u003eextensions/git/src/repository.ts:699\"]\n        RepositoryResp[\"Responsibilities:\u003cbr/\u003e- Git status tracking\u003cbr/\u003e- Resource groups (merge, index, working tree)\u003cbr/\u003e- SCM provider implementation\u003cbr/\u003e- Operation management\"]\n    end\n    \n    subgraph \"Layer 3: Git CLI Execution\"\n        BaseRepository[\"Repository (BaseRepository)\u003cbr/\u003eextensions/git/src/git.ts:700\"]\n        Git[\"Git\u003cbr/\u003eextensions/git/src/git.ts:385\"]\n        GitResp[\"Responsibilities:\u003cbr/\u003e- Git command execution\u003cbr/\u003e- Output parsing\u003cbr/\u003e- Error handling\"]\n    end\n    \n    Model --\u003e|\"creates/manages\"| Repository\n    Repository --\u003e|\"extends BaseRepository\"| BaseRepository\n    BaseRepository --\u003e|\"uses\"| Git\n    \n    CommandCenter[\"CommandCenter\u003cbr/\u003eextensions/git/src/commands.ts:780\"]\n    CommandCenter --\u003e|\"operates on\"| Repository\n    CommandCenter --\u003e|\"uses\"| Model\n```\n\n**Sources:** [extensions/git/src/model.ts:186-308](), [extensions/git/src/repository.ts:699-1800](), [extensions/git/src/git.ts:385-700](), [extensions/git/src/commands.ts:780-799]()\n\n### Core Components Integration\n\n```mermaid\ngraph TB\n    Model[\"Model\"]\n    Repository[\"Repository\"]\n    Git[\"Git\"]\n    \n    Model --\u003e|\"manages\"| Repository\n    Repository --\u003e|\"uses\"| Git\n    \n    SCMProvider[\"SourceControl\u003cbr/\u003evscode.scm.createSourceControl\"]\n    ResourceGroups[\"Resource Groups\u003cbr/\u003emergeGroup, indexGroup\u003cbr/\u003eworkingTreeGroup, untrackedGroup\"]\n    \n    Repository --\u003e|\"creates\"| SCMProvider\n    Repository --\u003e|\"populates\"| ResourceGroups\n    \n    HistoryProvider[\"GitHistoryProvider\u003cbr/\u003eextensions/git/src/historyProvider.ts\"]\n    ActionButton[\"ActionButton\u003cbr/\u003eextensions/git/src/actionButton.ts\"]\n    StatusBar[\"StatusBarCommands\u003cbr/\u003eextensions/git/src/statusbar.ts\"]\n    ArtifactProvider[\"GitArtifactProvider\u003cbr/\u003eextensions/git/src/artifactProvider.ts\"]\n    \n    Repository --\u003e|\"owns\"| HistoryProvider\n    Repository --\u003e|\"owns\"| ActionButton\n    Repository --\u003e|\"owns\"| StatusBar\n    Repository --\u003e|\"owns\"| ArtifactProvider\n    \n    CommandCenter[\"CommandCenter\"]\n    CommandCenter --\u003e|\"executes operations on\"| Repository\n```\n\n**Sources:** [extensions/git/src/repository.ts:699-1000](), [extensions/git/src/historyProvider.ts:42-81](), [extensions/git/src/actionButton.ts:43-98](), [extensions/git/src/statusbar.ts:19-42](), [extensions/git/src/artifactProvider.ts:68-90]()\n\n### Extension Initialization Flow\n\n```mermaid\nsequenceDiagram\n    participant Activate as activate()\u003cbr/\u003emain.ts:256\n    participant CreateModel as createModel()\u003cbr/\u003emain.ts:40\n    participant Model as Model\u003cbr/\u003emodel.ts:186\n    participant Repository as Repository\u003cbr/\u003erepository.ts:699\n    participant SCM as VS Code SCM API\n    participant CommandCenter as CommandCenter\u003cbr/\u003ecommands.ts:780\n    \n    Activate-\u003e\u003eCreateModel: createModel(context, logger, telemetryReporter)\n    CreateModel-\u003e\u003eCreateModel: findGit() - locate git executable\n    CreateModel-\u003e\u003eModel: new Model(git, askpass, globalState, workspaceState)\n    CreateModel-\u003e\u003eCommandCenter: new CommandCenter(git, model, ...)\n    CreateModel-\u003e\u003eCommandCenter: Register Commands.map(...)\n    CreateModel--\u003e\u003eActivate: {model, cloneManager}\n    \n    Activate-\u003e\u003eActivate: new GitExtensionImpl({model, cloneManager})\n    Activate-\u003e\u003eActivate: registerAPICommands(result)\n    \n    Model-\u003e\u003eModel: doInitialScan()\n    Model-\u003e\u003eModel: scanWorkspaceFolders()\n    Model-\u003e\u003eRepository: git.open(repositoryRoot, dotGit)\n    Repository-\u003e\u003eSCM: scm.createSourceControl('git', 'Git')\n    Repository-\u003e\u003eRepository: Initialize resource groups\n    Repository-\u003e\u003eRepository: status() - initial git status\n    Repository--\u003e\u003eModel: Repository instance\n```\n\n**Sources:** [extensions/git/src/main.ts:40-262](), [extensions/git/src/model.ts:186-350](), [extensions/git/src/repository.ts:699-900](), [extensions/git/src/commands.ts:780-799]()\n\n---\n\n## Model and Repository Management\n\n### Model Class Responsibilities\n\nThe `Model` class (`extensions/git/src/model.ts`) is the top-level manager:\n\n| Responsibility | Implementation |\n|----------------|----------------|\n| Repository Discovery | `scanWorkspaceFolders()`, `openRepository()` |\n| Repository Lifecycle | `onDidOpenRepository`, `onDidCloseRepository` events |\n| Multi-Repository Coordination | Maintains `openRepositories: OpenRepository[]` |\n| Closed/Unsafe Repository Tracking | `ClosedRepositoriesManager`, `UnsafeRepositoriesManager` |\n| Registry Management | Implements `IBranchProtectionProviderRegistry`, `IPushErrorHandlerRegistry`, etc. |\n\n**Sources:** [extensions/git/src/model.ts:186-600]()\n\n### Repository Discovery\n\n```mermaid\ngraph LR\n    Start[\"Extension Activation\"]\n    Scan[\"scanWorkspaceFolders()\"]\n    Parent[\"scanParentFolders()\"]\n    Editors[\"scanOpenEditors()\"]\n    Watch[\"Watch filesystem\"]\n    \n    Start --\u003e Scan\n    Start --\u003e Parent\n    Start --\u003e Editors\n    Scan --\u003e Open[\"openRepository(path)\"]\n    Parent --\u003e ParentMgr[\"ParentRepositoriesManager\"]\n    Editors --\u003e Open\n    Watch --\u003e Open\n    \n    Open --\u003e Repository[\"Repository instance\"]\n    Repository --\u003e Model[\"Model.repositories[]\"]\n```\n\n**Sources:** [extensions/git/src/model.ts:300-500]()\n\n---\n\n## Repository State and Resource Groups\n\nThe `Repository` class manages Git state and exposes it through VS Code's SCM API.\n\n### Resource Group Architecture\n\n```mermaid\ngraph TB\n    Repository[\"Repository\"]\n    \n    SourceControl[\"sourceControl: SourceControl\"]\n    \n    MergeGroup[\"mergeGroup\u003cbr/\u003eResourceGroupType.Merge\u003cbr/\u003eMerge conflicts\"]\n    IndexGroup[\"indexGroup\u003cbr/\u003eResourceGroupType.Index\u003cbr/\u003eStaged changes\"]\n    WorkingTreeGroup[\"workingTreeGroup\u003cbr/\u003eResourceGroupType.WorkingTree\u003cbr/\u003eUnstaged changes\"]\n    UntrackedGroup[\"untrackedGroup\u003cbr/\u003eResourceGroupType.Untracked\u003cbr/\u003eUntracked files\"]\n    \n    Repository --\u003e SourceControl\n    SourceControl --\u003e MergeGroup\n    SourceControl --\u003e IndexGroup\n    SourceControl --\u003e WorkingTreeGroup\n    SourceControl --\u003e UntrackedGroup\n    \n    Resource[\"Resource\u003cbr/\u003eimplements SourceControlResourceState\"]\n    \n    MergeGroup --\u003e|\"contains\"| Resource\n    IndexGroup --\u003e|\"contains\"| Resource\n    WorkingTreeGroup --\u003e|\"contains\"| Resource\n    UntrackedGroup --\u003e|\"contains\"| Resource\n```\n\n**Sources:** [extensions/git/src/repository.ts:44-49](), [extensions/git/src/repository.ts:51-342]()\n\n### Resource Class\n\nThe `Resource` class represents a single file change:\n\n- **Status Mapping**: Maps Git status codes to UI representations (icon, color, letter)\n- **Commands**: Resolves default commands (open, open change, compare)\n- **Decorations**: Provides `SourceControlResourceDecorations` (icon, tooltip, strikethrough)\n- **Context**: Includes `contextValue` for menu contributions\n\n**Sources:** [extensions/git/src/repository.ts:51-342]()\n\n---\n\n## Git Operations and Command Execution\n\n### Git CLI Wrapper\n\nThe `Git` class wraps all Git CLI interactions:\n\n```mermaid\ngraph LR\n    Git[\"Git class\u003cbr/\u003eextensions/git/src/git.ts\"]\n    Exec[\"exec(cwd, args, options)\"]\n    Stream[\"stream(cwd, args)\"]\n    Buffer[\"buffer(cwd, args)\"]\n    \n    Git --\u003e Exec\n    Git --\u003e Stream\n    Git --\u003e Buffer\n    \n    Exec --\u003e SpawnOptions[\"SpawnOptions\u003cbr/\u003e- input\u003cbr/\u003e- cancellationToken\u003cbr/\u003e- onSpawn\"]\n    Exec --\u003e ChildProcess[\"cp.spawn(gitPath, args)\"]\n    ChildProcess --\u003e Result[\"IExecutionResult\u003cbr/\u003e- exitCode\u003cbr/\u003e- stdout\u003cbr/\u003e- stderr\"]\n    \n    Result --\u003e ErrorHandler[\"getGitErrorCode(stderr)\"]\n    ErrorHandler --\u003e GitError[\"GitError\u003cbr/\u003e- gitErrorCode\u003cbr/\u003e- gitCommand\"]\n```\n\n**Sources:** [extensions/git/src/git.ts:200-270](), [extensions/git/src/git.ts:327-362]()\n\n### Repository Class Git Operations\n\nThe `BaseRepository` class (inherited by `Repository`) implements high-level Git operations:\n\n| Operation Category | Key Methods |\n|-------------------|-------------|\n| Status \u0026 State | `status()`, `getHEAD()`, `getRefs()`, `getRemotes()` |\n| Staging | `stage()`, `unstage()`, `revert()` |\n| Commit | `commit()`, `commitWithOptions()` |\n| Branch | `checkout()`, `branch()`, `deleteBranch()`, `merge()` |\n| Remote | `fetch()`, `pull()`, `push()`, `addRemote()` |\n| History | `log()`, `getCommit()`, `diffBetween()` |\n| Stash | `createStash()`, `popStash()`, `getStashes()` |\n\n**Sources:** [extensions/git/src/git.ts:700-2000]()\n\n---\n\n## CommandCenter and Command System\n\nThe `CommandCenter` class implements over 200 Git commands using a decorator-based registration system.\n\n### Command Registration Pattern\n\n```typescript\n// From commands.ts\n@command('git.refresh', { repository: true })\nasync refresh(repository: Repository): Promise\u003cvoid\u003e {\n    await repository.refresh();\n}\n\n@command('git.stage')\nasync stage(...resourceStates: SourceControlResourceState[]): Promise\u003cvoid\u003e {\n    // Implementation\n}\n```\n\n**Sources:** [extensions/git/src/commands.ts:375-383](), [extensions/git/src/commands.ts:801-809]()\n\n### Command Categories\n\n```mermaid\ngraph TB\n    CommandCenter[\"CommandCenter\"]\n    \n    Status[\"Status \u0026 Refresh\u003cbr/\u003erefresh, openResource\"]\n    Staging[\"Staging Operations\u003cbr/\u003estage, unstage, clean\u003cbr/\u003estageAll, unstageAll\"]\n    Commit[\"Commit Operations\u003cbr/\u003ecommit, commitAmend\u003cbr/\u003ecommitSigned, undoCommit\"]\n    Branch[\"Branch Management\u003cbr/\u003echeckout, branch, deleteBranch\u003cbr/\u003emerge, rebase\"]\n    Remote[\"Remote Operations\u003cbr/\u003efetch, pull, push\u003cbr/\u003esync, publish\"]\n    Stash[\"Stash Operations\u003cbr/\u003estash, stashPop, stashApply\"]\n    History[\"History \u0026 Diff\u003cbr/\u003eopenChange, openMergeEditor\u003cbr/\u003eopenTimeline\"]\n    Config[\"Configuration\u003cbr/\u003einit, clone, addRemote\"]\n    \n    CommandCenter --\u003e Status\n    CommandCenter --\u003e Staging\n    CommandCenter --\u003e Commit\n    CommandCenter --\u003e Branch\n    CommandCenter --\u003e Remote\n    CommandCenter --\u003e Stash\n    CommandCenter --\u003e History\n    CommandCenter --\u003e Config\n```\n\n**Sources:** [extensions/git/src/commands.ts:780-3000](), [extensions/git/package.json:71-900]()\n\n### Command Options\n\nCommands are registered with options controlling their behavior:\n\n| Option | Purpose |\n|--------|---------|\n| `repository: true` | Automatically resolve repository from context |\n| `repositoryFilter: ['repository', 'submodule', 'worktree']` | Filter repository types |\n\n**Sources:** [extensions/git/src/commands.ts:361-371]()\n\n---\n\n## SCM Provider Integration\n\nThe Git extension implements VS Code's `ISCMProvider` interface through its `Repository` class.\n\n### SCM API Implementation\n\n```mermaid\ngraph TB\n    VSCode[\"VS Code SCM Framework\u003cbr/\u003esrc/vs/workbench/contrib/scm\"]\n    \n    Repository[\"Repository\u003cbr/\u003eGit Extension\"]\n    \n    SourceControl[\"SourceControl\u003cbr/\u003escm.createSourceControl('git')\"]\n    InputBox[\"inputBox: SourceControlInputBox\u003cbr/\u003eCommit message\"]\n    ResourceGroups[\"ResourceGroups\u003cbr/\u003eMerge, Index, WorkingTree, Untracked\"]\n    \n    Repository --\u003e SourceControl\n    SourceControl --\u003e InputBox\n    SourceControl --\u003e ResourceGroups\n    \n    HistoryProvider[\"historyProvider: GitHistoryProvider\u003cbr/\u003eImplements SourceControlHistoryProvider\"]\n    QuickDiffProvider[\"quickDiffProvider: GitQuickDiffProvider\u003cbr/\u003eImplements QuickDiffProvider\"]\n    \n    Repository --\u003e HistoryProvider\n    Repository --\u003e QuickDiffProvider\n    \n    VSCode --\u003e|\"Reads from\"| SourceControl\n    VSCode --\u003e|\"Displays\"| ResourceGroups\n    VSCode --\u003e|\"Calls\"| HistoryProvider\n    VSCode --\u003e|\"Calls\"| QuickDiffProvider\n```\n\n**Sources:** [extensions/git/src/repository.ts:590-800](), [extensions/git/src/historyProvider.ts:42-81]()\n\n### Resource State Flow\n\n```mermaid\nsequenceDiagram\n    participant Git as Git CLI\n    participant Repo as Repository\n    participant Update as _updateResourceGroups\n    participant Groups as Resource Groups\n    participant VSCode as VS Code UI\n    \n    Repo-\u003e\u003eGit: status()\n    Git--\u003e\u003eRepo: IFileStatus[]\n    Repo-\u003e\u003eUpdate: _updateResourceGroups(groups)\n    \n    Update-\u003e\u003eUpdate: categorizeResourceByResolution()\n    Update-\u003e\u003eUpdate: Group by resourceGroupType\n    \n    Update-\u003e\u003eGroups: mergeGroup.resourceStates = resources\n    Update-\u003e\u003eGroups: indexGroup.resourceStates = resources\n    Update-\u003e\u003eGroups: workingTreeGroup.resourceStates = resources\n    Update-\u003e\u003eGroups: untrackedGroup.resourceStates = resources\n    \n    Groups-\u003e\u003eVSCode: onDidChangeResources event\n    VSCode-\u003e\u003eVSCode: Render SCM view\n```\n\n**Sources:** [extensions/git/src/repository.ts:1400-1600]()\n\n---\n\n## History Provider\n\nThe `GitHistoryProvider` implements VS Code's proposed `SourceControlHistoryProvider` API.\n\n### History Provider Architecture\n\n```mermaid\ngraph TB\n    GitHistoryProvider[\"GitHistoryProvider\u003cbr/\u003eextensions/git/src/historyProvider.ts\"]\n    \n    CurrentRef[\"currentHistoryItemRef\u003cbr/\u003eCurrent branch/tag/commit\"]\n    RemoteRef[\"currentHistoryItemRemoteRef\u003cbr/\u003eRemote tracking branch\"]\n    BaseRef[\"currentHistoryItemBaseRef\u003cbr/\u003eMerge base\"]\n    \n    GitHistoryProvider --\u003e CurrentRef\n    GitHistoryProvider --\u003e RemoteRef\n    GitHistoryProvider --\u003e BaseRef\n    \n    Methods[\"Key Methods\"]\n    ProvideItems[\"provideHistoryItems()\u003cbr/\u003eReturns commit history\"]\n    ProvideItemRefs[\"provideHistoryItemRefs()\u003cbr/\u003eReturns branches/tags\"]\n    ResolveRef[\"resolveHistoryItemRefsCommonAncestor()\u003cbr/\u003eFinds merge base\"]\n    \n    GitHistoryProvider --\u003e Methods\n    Methods --\u003e ProvideItems\n    Methods --\u003e ProvideItemRefs\n    Methods --\u003e ResolveRef\n    \n    Decorations[\"FileDecorationProvider\u003cbr/\u003eDecorates history items\"]\n    GitHistoryProvider --\u003e Decorations\n```\n\n**Sources:** [extensions/git/src/historyProvider.ts:42-200]()\n\n### History Item Refs\n\nHistory item refs represent branches, tags, and the current HEAD:\n\n```typescript\ninterface SourceControlHistoryItemRef {\n    id: string;           // e.g., 'refs/heads/main'\n    name: string;         // e.g., 'main'\n    revision?: string;    // commit hash\n    icon?: ThemeIcon;     // UI icon\n}\n```\n\n**Sources:** [extensions/git/src/historyProvider.ts:19-40](), [src/vscode-dts/vscode.proposed.scmHistoryProvider.d.ts:1-150]()\n\n---\n\n## Action Button System\n\nThe `ActionButton` class manages the dynamic action button in the SCM view that changes based on repository state.\n\n### Action Button State Machine\n\n```mermaid\ngraph TB\n    State[\"Repository State\"]\n    \n    NoRemote[\"No Remote\u003cbr/\u003eactionButton = Publish\"]\n    HasRemote[\"Has Remote\"]\n    \n    State --\u003e NoRemote\n    State --\u003e HasRemote\n    \n    HasRemote --\u003e Sync[\"Commits to push/pull\u003cbr/\u003eactionButton = Sync\"]\n    HasRemote --\u003e Push[\"Only commits to push\u003cbr/\u003eactionButton = Push\"]\n    HasRemote --\u003e Pull[\"Only commits to pull\u003cbr/\u003eactionButton = Pull\"]\n    HasRemote --\u003e Synced[\"Nothing to sync\u003cbr/\u003eactionButton = undefined\"]\n    \n    Config[\"Configuration\u003cbr/\u003egit.showActionButton\"]\n    PostCommit[\"git.postCommitCommand\u003cbr/\u003eAffects button after commit\"]\n    \n    Config -.affects.-\u003e State\n    PostCommit -.affects.-\u003e State\n```\n\n**Sources:** [extensions/git/src/actionButton.ts:1-400]()\n\n### Action Button Implementation\n\nKey methods in the `ActionButton` class:\n\n| Method | Purpose |\n|--------|---------|\n| `getActionButton()` | Determines which button to show based on state |\n| `getSyncChangesActionButton()` | Creates Sync button |\n| `getPublishBranchActionButton()` | Creates Publish button |\n| `executeActionButton()` | Handles button click |\n\n**Sources:** [extensions/git/src/actionButton.ts:100-300]()\n\n---\n\n## Operation Management\n\nThe `OperationManager` serializes Git operations to prevent conflicts.\n\n### Operation System\n\n```mermaid\ngraph TB\n    OperationManager[\"OperationManager\u003cbr/\u003eextensions/git/src/operation.ts\"]\n    \n    Queue[\"Operation Queue\"]\n    Current[\"currentOperation\"]\n    \n    OperationManager --\u003e Queue\n    OperationManager --\u003e Current\n    \n    Run[\"run(operation, fn)\u003cbr/\u003eQueues and executes operation\"]\n    \n    OperationManager --\u003e Run\n    \n    Operation[\"Operation\u003cbr/\u003e- kind: OperationKind\u003cbr/\u003e- blocking: boolean\u003cbr/\u003e- readOnly: boolean\u003cbr/\u003e- showProgress: boolean\"]\n    \n    Run --\u003e Operation\n    \n    OperationKind[\"OperationKind\u003cbr/\u003eCommit, Push, Pull, Fetch\u003cbr/\u003eStatus, Checkout, etc.\"]\n    \n    Operation --\u003e OperationKind\n    \n    Result[\"OperationResult\u003cbr/\u003e- operation: Operation\u003cbr/\u003e- error?: any\"]\n    \n    Run --\u003e Result\n    \n    Events[\"Events\u003cbr/\u003eonDidChangeOperations\u003cbr/\u003eonDidRunOperation\"]\n    \n    OperationManager --\u003e Events\n```\n\n**Sources:** [extensions/git/src/operation.ts:1-300]()\n\n### Operation Categories\n\nOperations are categorized by `OperationKind`:\n\n| Category | Examples | Blocking |\n|----------|----------|----------|\n| Write Operations | `Commit`, `Stage`, `Push`, `Pull` | Yes |\n| Read Operations | `Status`, `Log`, `Show` | No |\n| Background Operations | `Fetch`, `Background` | No |\n| UI Operations | `StatusBar`, `RepoCheck` | No |\n\n**Sources:** [extensions/git/src/operation.ts:13-50]()\n\n---\n\n## Status Bar Integration\n\nThe `StatusBarCommands` class manages the Git status bar item.\n\n### Status Bar Item Structure\n\n```mermaid\ngraph LR\n    StatusBar[\"StatusBarCommands\"]\n    \n    Item[\"StatusBarItem\"]\n    \n    StatusBar --\u003e Item\n    \n    Text[\"text: branch name\"]\n    Icon[\"$(sync-icon) sync indicator\"]\n    Tooltip[\"tooltip: branch details\u003cbr/\u003eahead/behind counts\"]\n    Command[\"command: git.checkout\"]\n    \n    Item --\u003e Text\n    Item --\u003e Icon\n    Item --\u003e Tooltip\n    Item --\u003e Command\n    \n    Update[\"onDidRunOperation\u003cbr/\u003eonDidChangeState\u003cbr/\u003eUpdate item on changes\"]\n    \n    StatusBar --\u003e Update\n```\n\n**Sources:** [extensions/git/src/statusbar.ts:1-300]()\n\n---\n\n## Extension Manifest and Contribution Points\n\nThe `package.json` defines all extension contributions.\n\n### Key Contribution Points\n\n| Contribution | Count | Purpose |\n|--------------|-------|---------|\n| `commands` | 200+ | Git commands exposed to users |\n| `menus` | Multiple | Command placement in SCM view |\n| `configuration` | 80+ | Extension settings |\n| `keybindings` | 20+ | Default keyboard shortcuts |\n| `views` | 0 | Uses SCM framework views |\n\n**Sources:** [extensions/git/package.json:70-1500]()\n\n### Enabled API Proposals\n\nThe Git extension uses several proposed APIs:\n\n```json\n{\n  \"enabledApiProposals\": [\n    \"scmHistoryProvider\",\n    \"scmArtifactProvider\",\n    \"quickDiffProvider\",\n    \"scmActionButton\",\n    \"scmValidation\",\n    \"tabInputTextMerge\",\n    \"timeline\"\n  ]\n}\n```\n\n**Sources:** [extensions/git/package.json:12-43]()\n\n---\n\n## Supporting Services\n\n### Additional Components\n\n```mermaid\ngraph TB\n    AutoFetcher[\"AutoFetcher\u003cbr/\u003ePeriodic git fetch\"]\n    ProgressManager[\"ProgressManager\u003cbr/\u003eShows operation progress\"]\n    FileEventLogger[\"FileEventLogger\u003cbr/\u003eLogs file system events\"]\n    DotGitWatcher[\"DotGitWatcher\u003cbr/\u003eWatches .git directory\"]\n    \n    Repository[\"Repository\"]\n    \n    Repository --\u003e AutoFetcher\n    Repository --\u003e ProgressManager\n    Repository --\u003e FileEventLogger\n    Repository --\u003e DotGitWatcher\n    \n    Telemetry[\"TelemetryReporter\u003cbr/\u003eUsage analytics\"]\n    Askpass[\"Askpass\u003cbr/\u003eGit credential helper\"]\n    TerminalManager[\"TerminalEnvironmentManager\u003cbr/\u003eSets up terminal env\"]\n    \n    Extension[\"Extension Context\"]\n    \n    Extension --\u003e Telemetry\n    Extension --\u003e Askpass\n    Extension --\u003e TerminalManager\n```\n\n**Sources:** [extensions/git/src/repository.ts:355-497](), [extensions/git/src/main.ts:40-250]()\n\n### Askpass System\n\nThe Askpass system handles Git credential requests:\n\n- **IPC Server**: Listens for credential requests from Git\n- **Credential Provider**: Forwards requests to VS Code authentication\n- **Environment Variables**: Configures Git to use the askpass helper\n\n**Sources:** [extensions/git/src/askpass.ts:1-250]()\n\n---\n\nThis architecture enables the Git extension to provide comprehensive Git integration while maintaining clean separation of concerns and leveraging VS Code's SCM framework effectively."])</script><script>self.__next_f.push([1,"4e:T5cdc,"])</script><script>self.__next_f.push([1,"# Repository and Operation Management\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [extensions/git/package.json](extensions/git/package.json)\n- [extensions/git/package.nls.json](extensions/git/package.nls.json)\n- [extensions/git/src/actionButton.ts](extensions/git/src/actionButton.ts)\n- [extensions/git/src/api/api1.ts](extensions/git/src/api/api1.ts)\n- [extensions/git/src/api/git.d.ts](extensions/git/src/api/git.d.ts)\n- [extensions/git/src/artifactProvider.ts](extensions/git/src/artifactProvider.ts)\n- [extensions/git/src/askpass-empty.sh](extensions/git/src/askpass-empty.sh)\n- [extensions/git/src/askpass-main.ts](extensions/git/src/askpass-main.ts)\n- [extensions/git/src/askpass.sh](extensions/git/src/askpass.sh)\n- [extensions/git/src/askpass.ts](extensions/git/src/askpass.ts)\n- [extensions/git/src/autofetch.ts](extensions/git/src/autofetch.ts)\n- [extensions/git/src/commands.ts](extensions/git/src/commands.ts)\n- [extensions/git/src/git.ts](extensions/git/src/git.ts)\n- [extensions/git/src/gitEditor.ts](extensions/git/src/gitEditor.ts)\n- [extensions/git/src/ipc/ipcClient.ts](extensions/git/src/ipc/ipcClient.ts)\n- [extensions/git/src/ipc/ipcServer.ts](extensions/git/src/ipc/ipcServer.ts)\n- [extensions/git/src/main.ts](extensions/git/src/main.ts)\n- [extensions/git/src/model.ts](extensions/git/src/model.ts)\n- [extensions/git/src/operation.ts](extensions/git/src/operation.ts)\n- [extensions/git/src/postCommitCommands.ts](extensions/git/src/postCommitCommands.ts)\n- [extensions/git/src/repository.ts](extensions/git/src/repository.ts)\n- [extensions/git/src/ssh-askpass-empty.sh](extensions/git/src/ssh-askpass-empty.sh)\n- [extensions/git/src/ssh-askpass.sh](extensions/git/src/ssh-askpass.sh)\n- [extensions/git/src/statusbar.ts](extensions/git/src/statusbar.ts)\n- [extensions/git/src/terminal.ts](extensions/git/src/terminal.ts)\n- [extensions/git/src/util.ts](extensions/git/src/util.ts)\n- [extensions/git/tsconfig.json](extensions/git/tsconfig.json)\n- [src/vs/workbench/contrib/scm/common/artifact.ts](src/vs/workbench/contrib/scm/common/artifact.ts)\n- [src/vscode-dts/vscode.proposed.scmArtifactProvider.d.ts](src/vscode-dts/vscode.proposed.scmArtifactProvider.d.ts)\n- [test/automation/src/statusbar.ts](test/automation/src/statusbar.ts)\n\n\u003c/details\u003e\n\n\n\nThis page documents how the Git extension discovers, manages, and tracks Git repositories, as well as how it coordinates concurrent Git operations to ensure data consistency and proper sequencing.\n\nFor information about the overall Git extension architecture and the Model/Repository/Git abstraction layers, see [Git Extension Architecture](#10.1). For details about specific user-facing Git commands, see [Git Commands and Actions](#10.3).\n\n## Overview\n\nThe Git extension manages multiple repositories simultaneously, each represented by a `Repository` instance. The extension handles:\n\n- **Repository Discovery**: Scanning workspace folders and open files to find Git repositories\n- **Repository Lifecycle**: Opening, closing, and tracking repository state\n- **Operation Coordination**: Ensuring Git operations run in the correct order and don't conflict\n- **Status Management**: Periodically updating repository state and resource groups\n\nThe key classes are:\n- `Model` ([extensions/git/src/model.ts:186-785]()): Manages all repositories and coordinates discovery\n- `Repository` ([extensions/git/src/repository.ts:699-2294]()): Represents a single Git repository\n- `OperationManager` ([extensions/git/src/operation.ts:120-371]()): Coordinates concurrent Git operations\n\nSources: [extensions/git/src/model.ts:186-785](), [extensions/git/src/repository.ts:699-2294](), [extensions/git/src/operation.ts:1-371]()\n\n## Repository Discovery and Lifecycle\n\n### Discovery Process\n\nThe `Model` class orchestrates repository discovery through multiple mechanisms:\n\n```mermaid\ngraph TD\n    Model[\"Model\"]\n    InitScan[\"doInitialScan()\"]\n    WorkspaceScan[\"scanWorkspaceFolders()\"]\n    EditorScan[\"onDidChangeVisibleTextEditors()\"]\n    FileWatcher[\"FileSystemWatcher\u003cbr/\u003e(**/.git)\"]\n    \n    Model --\u003e InitScan\n    InitScan --\u003e WorkspaceScan\n    InitScan --\u003e EditorScan\n    \n    Model --\u003e FileWatcher\n    FileWatcher --\u003e PossibleRepo[\"onPossibleGitRepositoryChange()\"]\n    PossibleRepo --\u003e OpenRepo[\"openRepository()\"]\n    \n    WorkspaceScan --\u003e ScanRepoRoot[\"getRepositoryRoot()\"]\n    EditorScan --\u003e ScanRepoRoot\n    ScanRepoRoot --\u003e OpenRepo\n    \n    OpenRepo --\u003e CreateRepo[\"new Repository()\"]\n    CreateRepo --\u003e RegisterRepo[\"_onDidOpenRepository.fire()\"]\n```\n\n**Initial Scan**: When the extension activates, `doInitialScan()` ([extensions/git/src/model.ts:310-350]()) performs three parallel scans:\n\n1. **Workspace Folders**: `scanWorkspaceFolders()` ([extensions/git/src/model.ts:357-432]()) scans each workspace folder up to `git.repositoryScanMaxDepth` levels deep\n2. **Open Editors**: `onDidChangeVisibleTextEditors()` ([extensions/git/src/model.ts:673-699]()) checks if any open files are in Git repositories\n3. **Watch for Changes**: A `FileSystemWatcher` monitors `**/.git` paths to detect new repositories\n\nSources: [extensions/git/src/model.ts:310-432](), [extensions/git/src/model.ts:673-699]()\n\n### Repository States\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e Idle: openRepository()\n    Idle --\u003e Idle: Git operations\n    Idle --\u003e Disposed: dispose()\n    Disposed --\u003e [*]\n    \n    note right of Idle\n        Normal operation state\n        Running git status\n        Handling user actions\n    end note\n    \n    note right of Disposed\n        Repository closed\n        Resources cleaned up\n        No longer tracked\n    end note\n```\n\nThe `RepositoryState` enum ([extensions/git/src/repository.ts:40-43]()) defines two states:\n- **Idle**: Repository is active and processing operations\n- **Disposed**: Repository has been closed and cleaned up\n\nSources: [extensions/git/src/repository.ts:40-43]()\n\n### Repository Management\n\n```mermaid\ngraph LR\n    Model[\"Model\"]\n    OpenRepos[\"openRepositories:\u003cbr/\u003eOpenRepository[]\"]\n    ClosedMgr[\"ClosedRepositoriesManager\"]\n    ParentMgr[\"ParentRepositoriesManager\"]\n    UnsafeMgr[\"UnsafeRepositoriesManager\"]\n    \n    Model --\u003e OpenRepos\n    Model --\u003e ClosedMgr\n    Model --\u003e ParentMgr\n    Model --\u003e UnsafeMgr\n    \n    OpenRepos --\u003e Repo1[\"Repository\u003cbr/\u003e(main repo)\"]\n    OpenRepos --\u003e Repo2[\"Repository\u003cbr/\u003e(submodule)\"]\n    OpenRepos --\u003e Repo3[\"Repository\u003cbr/\u003e(worktree)\"]\n    \n    ClosedMgr --\u003e WorkspaceState[\"workspaceState.get('closedRepositories')\"]\n    ParentMgr --\u003e GlobalState[\"globalState (parent repos)\"]\n    UnsafeMgr --\u003e UnsafeList[\"Detected unsafe repos\"]\n```\n\nThe `Model` maintains several repository collections:\n\n**Open Repositories** ([extensions/git/src/model.ts:200-201]()): Active `Repository` instances wrapped in `OpenRepository` objects with their disposables\n\n**Closed Repositories** ([extensions/git/src/model.ts:64-98]()): The `ClosedRepositoriesManager` tracks repositories that users have explicitly closed, stored in workspace state\n\n**Parent Repositories** ([extensions/git/src/model.ts:100-141]()): The `ParentRepositoriesManager` tracks repositories found in parent folders (above workspace root), requiring explicit user confirmation to open\n\n**Unsafe Repositories** ([extensions/git/src/model.ts:143-184]()): The `UnsafeRepositoriesManager` tracks repositories that Git considers unsafe due to ownership issues\n\nSources: [extensions/git/src/model.ts:64-184](), [extensions/git/src/model.ts:200-201]()\n\n## Repository Class Architecture\n\n### Core Structure\n\nThe `Repository` class represents a single Git repository and manages its state, operations, and resource groups:\n\n```mermaid\ngraph TB\n    subgraph \"Repository Class\"\n        Repo[\"Repository\"]\n        \n        subgraph \"State\"\n            HEAD[\"HEAD: Branch?\"]\n            Refs[\"refs: Ref[]\"]\n            Remotes[\"remotes: Remote[]\"]\n            Submodules[\"submodules: Submodule[]\"]\n            Worktrees[\"worktrees: Worktree[]\"]\n        end\n        \n        subgraph \"Operations\"\n            OpMgr[\"operations:\u003cbr/\u003eOperationManager\"]\n            Run[\"run\u0026lt;T\u0026gt;(operation)\"]\n        end\n        \n        subgraph \"Resource Groups\"\n            MergeGroup[\"mergeGroup:\u003cbr/\u003eGitResourceGroup\"]\n            IndexGroup[\"indexGroup:\u003cbr/\u003eGitResourceGroup\"]\n            WorkingTreeGroup[\"workingTreeGroup:\u003cbr/\u003eGitResourceGroup\"]\n            UntrackedGroup[\"untrackedGroup:\u003cbr/\u003eGitResourceGroup\"]\n        end\n        \n        subgraph \"Git Integration\"\n            Repository[\"repository:\u003cbr/\u003eBaseRepository\"]\n            GitStatus[\"status()\"]\n        end\n    end\n    \n    Repo --\u003e HEAD\n    Repo --\u003e Refs\n    Repo --\u003e Remotes\n    Repo --\u003e Submodules\n    Repo --\u003e Worktrees\n    \n    Repo --\u003e OpMgr\n    Repo --\u003e Run\n    OpMgr --\u003e Run\n    \n    Repo --\u003e MergeGroup\n    Repo --\u003e IndexGroup\n    Repo --\u003e WorkingTreeGroup\n    Repo --\u003e UntrackedGroup\n    \n    Repo --\u003e Repository\n    Repository --\u003e GitStatus\n    Run --\u003e GitStatus\n```\n\n**Key Components**:\n\n- **State Properties** ([extensions/git/src/repository.ts:709-719]()): Current branch (`HEAD`), refs, remotes, submodules, and worktrees\n- **OperationManager** ([extensions/git/src/repository.ts:766]()): Coordinates all Git operations\n- **Resource Groups** ([extensions/git/src/repository.ts:732-735]()): SCM resource groups for merge conflicts, staged changes, working tree changes, and untracked files\n- **BaseRepository** ([extensions/git/src/repository.ts:711]()): Low-level Git command wrapper from `git.ts`\n\nSources: [extensions/git/src/repository.ts:699-800]()\n\n### Repository Initialization\n\n```mermaid\nsequenceDiagram\n    participant Model\n    participant Repository\n    participant BaseRepository\n    participant SourceControl\n    participant AutoFetcher\n    participant ProgressMgr\n    \n    Model-\u003e\u003eRepository: new Repository(git, root, dotGit, ...)\n    Repository-\u003e\u003eBaseRepository: new BaseRepository(git, root, dotGit)\n    Repository-\u003e\u003eSourceControl: scm.createSourceControl()\n    Repository-\u003e\u003eSourceControl: Create resource groups\n    Repository-\u003e\u003eAutoFetcher: new AutoFetcher()\n    Repository-\u003e\u003eProgressMgr: new ProgressManager()\n    Repository-\u003e\u003eRepository: updateModelState()\n    Repository-\u003e\u003eRepository: status()\n```\n\nWhen a repository is opened ([extensions/git/src/repository.ts:773-824]()):\n\n1. Creates the `BaseRepository` wrapper for Git commands\n2. Registers a VS Code `SourceControl` instance\n3. Creates four resource groups (merge, index, working tree, untracked)\n4. Initializes `AutoFetcher` for periodic fetching\n5. Sets up `ProgressManager` for operation progress indicators\n6. Runs initial `status()` to populate state\n\nSources: [extensions/git/src/repository.ts:773-824]()\n\n### Status Update Flow\n\n```mermaid\ngraph TD\n    Trigger[\"Trigger: Timer, File Change,\u003cbr/\u003eor Manual Refresh\"]\n    \n    Status[\"status()\u003cbr/\u003e@throttle\"]\n    RunOp[\"run(OperationKind.Status)\"]\n    GitStatus[\"repository.status()\"]\n    UpdateState[\"updateModelState()\"]\n    \n    UpdateGroups[\"Update Resource Groups\"]\n    MergeGroup[\"mergeGroup.resourceStates\"]\n    IndexGroup[\"indexGroup.resourceStates\"]\n    WorkingGroup[\"workingTreeGroup.resourceStates\"]\n    UntrackedGroup[\"untrackedGroup.resourceStates\"]\n    \n    FireEvent[\"_onDidRunGitStatus.fire()\"]\n    \n    Trigger --\u003e Status\n    Status --\u003e RunOp\n    RunOp --\u003e GitStatus\n    GitStatus --\u003e UpdateState\n    UpdateState --\u003e UpdateGroups\n    \n    UpdateGroups --\u003e MergeGroup\n    UpdateGroups --\u003e IndexGroup\n    UpdateGroups --\u003e WorkingGroup\n    UpdateGroups --\u003e UntrackedGroup\n    \n    UpdateGroups --\u003e FireEvent\n```\n\nThe `status()` method ([extensions/git/src/repository.ts:1108-1250]()) is the core of repository state management:\n\n1. **Throttled Execution**: Uses `@throttle` decorator to prevent excessive calls\n2. **Operation Wrapping**: Executes through `run()` to coordinate with other operations\n3. **Git Status**: Calls `BaseRepository.status()` to get current repository state\n4. **State Update**: `updateModelState()` ([extensions/git/src/repository.ts:848-1033]()) processes the status into:\n   - HEAD branch information\n   - Refs (branches, tags, remote heads)\n   - Remotes\n   - Submodules and worktrees\n   - Merge/rebase state\n5. **Resource Groups**: Updates the four SCM resource groups with current file changes\n6. **Event Notification**: Fires `onDidRunGitStatus` for UI updates\n\nSources: [extensions/git/src/repository.ts:1108-1250](), [extensions/git/src/repository.ts:848-1033]()\n\n### Resource Groups and File States\n\n```mermaid\ngraph LR\n    subgraph \"Git Status\"\n        StatusOutput[\"git status --porcelain=2\"]\n    end\n    \n    subgraph \"Resource Classification\"\n        Classify[\"Classify by Status\"]\n    end\n    \n    subgraph \"Resource Groups\"\n        Merge[\"mergeGroup\u003cbr/\u003e(ResourceGroupType.Merge)\"]\n        Index[\"indexGroup\u003cbr/\u003e(ResourceGroupType.Index)\"]\n        Working[\"workingTreeGroup\u003cbr/\u003e(ResourceGroupType.WorkingTree)\"]\n        Untracked[\"untrackedGroup\u003cbr/\u003e(ResourceGroupType.Untracked)\"]\n    end\n    \n    StatusOutput --\u003e Classify\n    \n    Classify --\u003e|BOTH_MODIFIED, etc.| Merge\n    Classify --\u003e|INDEX_MODIFIED, etc.| Index\n    Classify --\u003e|MODIFIED, DELETED| Working\n    Classify --\u003e|UNTRACKED| Untracked\n    \n    Merge --\u003e Resource1[\"Resource\u003cbr/\u003e(conflict file)\"]\n    Index --\u003e Resource2[\"Resource\u003cbr/\u003e(staged file)\"]\n    Working --\u003e Resource3[\"Resource\u003cbr/\u003e(modified file)\"]\n    Untracked --\u003e Resource4[\"Resource\u003cbr/\u003e(new file)\"]\n```\n\nEach file in the repository is represented as a `Resource` ([extensions/git/src/repository.ts:52-343]()) and placed in one of four groups:\n\n- **Merge Group** ([extensions/git/src/repository.ts:732]()): Files with merge conflicts (`BOTH_MODIFIED`, `ADDED_BY_US`, etc.)\n- **Index Group** ([extensions/git/src/repository.ts:733]()): Staged changes (`INDEX_MODIFIED`, `INDEX_ADDED`, `INDEX_DELETED`)\n- **Working Tree Group** ([extensions/git/src/repository.ts:734]()): Unstaged changes (`MODIFIED`, `DELETED`, `TYPE_CHANGED`)\n- **Untracked Group** ([extensions/git/src/repository.ts:735]()): New files not tracked by Git (`UNTRACKED`)\n\nThe `Resource` class provides:\n- **Status Letters**: Single-character status codes (`M`, `A`, `D`, `R`, etc.)\n- **Status Colors**: Theme colors for different file states\n- **Icons**: Light/dark icons for each status type\n- **Commands**: Default actions when clicking a resource\n\nSources: [extensions/git/src/repository.ts:52-343](), [extensions/git/src/repository.ts:732-735]()\n\n## Operation Management\n\n### OperationManager Architecture\n\nThe `OperationManager` ([extensions/git/src/operation.ts:120-371]()) ensures Git operations execute safely without conflicts:\n\n```mermaid\ngraph TB\n    subgraph \"OperationManager\"\n        Operations[\"operations:\u003cbr/\u003eMap\u0026lt;OperationKind, Operation[]\u0026gt;\"]\n        OnDidChange[\"_onDidChangeOperations:\u003cbr/\u003eEventEmitter\"]\n    end\n    \n    subgraph \"Operation Execution\"\n        Run[\"run\u0026lt;T\u0026gt;(operation, fn)\"]\n        Queue[\"Queue or Execute\"]\n        WaitForPrior[\"Wait for prior operations\"]\n        Execute[\"Execute fn()\"]\n        Notify[\"Fire events\"]\n    end\n    \n    subgraph \"Operation Properties\"\n        Blocking[\"blocking:\u003cbr/\u003eboolean\"]\n        ReadOnly[\"readOnly:\u003cbr/\u003eboolean\"]\n        Remote[\"remote:\u003cbr/\u003eboolean\"]\n        ShowProgress[\"showProgress:\u003cbr/\u003eboolean\"]\n    end\n    \n    Operations --\u003e Run\n    Run --\u003e Queue\n    Queue --\u003e WaitForPrior\n    WaitForPrior --\u003e Execute\n    Execute --\u003e Notify\n    Notify --\u003e OnDidChange\n    \n    Run -.uses.-\u003e Blocking\n    Run -.uses.-\u003e ReadOnly\n    Run -.uses.-\u003e Remote\n```\n\n**Core Responsibilities**:\n\n1. **Operation Tracking**: Maintains a map of currently executing operations by kind\n2. **Sequencing**: Ensures operations that modify state don't run concurrently\n3. **Progress**: Shows progress indicators for long-running operations\n4. **Cancellation**: Supports canceling operations that are safe to cancel\n\nSources: [extensions/git/src/operation.ts:120-371]()\n\n### Operation Kinds and Properties\n\nEach operation has a kind ([extensions/git/src/operation.ts:9-67]()) and properties ([extensions/git/src/operation.ts:79-258]()) that control its execution:\n\n| Property | Purpose | Example |\n|----------|---------|---------|\n| **blocking** | Operation modifies state, blocks other blocking operations | `Commit: true` |\n| **readOnly** | Operation only reads state, can run concurrently | `Show: true` |\n| **remote** | Operation involves network communication | `Fetch: true` |\n| **retry** | Operation can be automatically retried on failure | `Status: true` |\n| **showProgress** | Show progress indicator in UI | `Push: true` |\n\nExamples:\n- **Commit** ([extensions/git/src/operation.ts:128]()): `blocking=true, readOnly=false` - modifies repository\n- **Status** ([extensions/git/src/operation.ts:237]()): `blocking=false, readOnly=true` - only reads state\n- **Fetch** ([extensions/git/src/operation.ts:167]()): `blocking=false, remote=true` - network operation\n- **Push** ([extensions/git/src/operation.ts:207]()): `blocking=true, remote=true` - modifies and uses network\n\nSources: [extensions/git/src/operation.ts:9-67](), [extensions/git/src/operation.ts:79-258]()\n\n### Operation Execution Flow\n\n```mermaid\nsequenceDiagram\n    participant Caller\n    participant Repository\n    participant OperationMgr\n    participant Git\n    \n    Caller-\u003e\u003eRepository: commit(message)\n    Repository-\u003e\u003eOperationMgr: run(OperationKind.Commit, fn)\n    \n    alt Operations queue empty\n        OperationMgr-\u003e\u003eOperationMgr: Register operation\n        OperationMgr-\u003e\u003eGit: Execute fn()\n        Git--\u003e\u003eOperationMgr: Result\n        OperationMgr-\u003e\u003eOperationMgr: Unregister operation\n        OperationMgr-\u003e\u003eOperationMgr: Fire onDidChangeOperations\n        OperationMgr--\u003e\u003eRepository: Result\n    else Blocking operation running\n        OperationMgr-\u003e\u003eOperationMgr: Queue operation\n        OperationMgr-\u003e\u003eOperationMgr: Wait for prior operation\n        Note over OperationMgr: Previous operation completes\n        OperationMgr-\u003e\u003eGit: Execute fn()\n        Git--\u003e\u003eOperationMgr: Result\n        OperationMgr-\u003e\u003eOperationMgr: Unregister operation\n        OperationMgr--\u003e\u003eRepository: Result\n    end\n    \n    Repository--\u003e\u003eCaller: Result\n```\n\nThe `run()` method ([extensions/git/src/operation.ts:300-371]()) coordinates operation execution:\n\n1. **Check for Conflicts**: If a blocking operation is running and this operation is also blocking, queue it\n2. **Register Operation**: Add to the `operations` map\n3. **Execute Function**: Call the provided function (e.g., `repository.commit()`)\n4. **Handle Errors**: Wrap errors with operation context\n5. **Unregister**: Remove from operations map\n6. **Fire Events**: Notify listeners via `onDidChangeOperations` and `onDidRunOperation`\n\nSources: [extensions/git/src/operation.ts:300-371]()\n\n### Operation Coordination Example\n\n```mermaid\ngraph TD\n    User1[\"User Action 1:\u003cbr/\u003eStage Files\"]\n    User2[\"User Action 2:\u003cbr/\u003eCommit\"]\n    User3[\"User Action 3:\u003cbr/\u003eView Diff\"]\n    \n    Stage[\"OperationKind.Stage\u003cbr/\u003eblocking=true\"]\n    Commit[\"OperationKind.Commit\u003cbr/\u003eblocking=true\"]\n    Diff[\"OperationKind.Diff\u003cbr/\u003eblocking=false\u003cbr/\u003ereadOnly=true\"]\n    \n    Queue[\"Operation Queue\"]\n    \n    User1 --\u003e Stage\n    User2 --\u003e Commit\n    User3 --\u003e Diff\n    \n    Stage --\u003e Queue\n    Commit --\u003e Wait[\"Wait for Stage\"]\n    Diff --\u003e Execute[\"Execute immediately\u003cbr/\u003e(read-only)\"]\n    \n    Wait --\u003e Queue\n```\n\n**Concurrent Execution**: Read-only operations like `Diff` or `Show` can run while blocking operations are executing\n\n**Sequential Execution**: Blocking operations like `Stage` and `Commit` run one at a time\n\n**Retry Logic**: Some operations (like `Status`) automatically retry on transient failures\n\nSources: [extensions/git/src/operation.ts:260-290]()\n\n## Status Updates and Refresh Mechanisms\n\n### Automatic Status Updates\n\nThe `Repository` class triggers status updates through multiple mechanisms:\n\n```mermaid\ngraph TD\n    subgraph \"Status Triggers\"\n        Timer[\"AutoRefreshTimer\u003cbr/\u003e(every 3-10s)\"]\n        FileWatcher[\"DotGitWatcher\u003cbr/\u003e(.git/** changes)\"]\n        WorkspaceWatcher[\"FileSystemWatcher\u003cbr/\u003e(workspace changes)\"]\n        Operations[\"Git Operations\u003cbr/\u003e(commit, stage, etc.)\"]\n    end\n    \n    subgraph \"Throttling\"\n        EventuallyIdle[\"eventuallyUpdateWhenIdleAndWait()\"]\n        Debounce[\"@debounce(1000ms)\"]\n    end\n    \n    subgraph \"Execution\"\n        Status[\"status()\u003cbr/\u003e@throttle\"]\n        GitStatus[\"git status --porcelain=2\"]\n    end\n    \n    Timer --\u003e EventuallyIdle\n    FileWatcher --\u003e EventuallyIdle\n    WorkspaceWatcher --\u003e EventuallyIdle\n    Operations --\u003e Status\n    \n    EventuallyIdle --\u003e Debounce\n    Debounce --\u003e Status\n    Status --\u003e GitStatus\n```\n\n**Auto-Refresh Timer** ([extensions/git/src/repository.ts:1278-1310]()): When `git.autorefresh` is enabled, status updates run every 3-10 seconds (randomized to spread load)\n\n**File Watchers**:\n- **DotGitWatcher** ([extensions/git/src/repository.ts:449-499]()): Watches `.git` directory for ref changes, ignoring temporary files like `index.lock`\n- **Workspace Watcher** ([extensions/git/src/repository.ts:1330-1354]()): Watches for file changes in the working tree\n\n**Operation Triggers**: Operations like `commit()`, `stage()`, and `clean()` explicitly call `status()` after completion\n\n**Throttling**: \n- `@throttle` decorator on `status()` prevents excessive calls\n- `@debounce` decorator on file watcher handlers delays status updates by 1 second\n\nSources: [extensions/git/src/repository.ts:1278-1354](), [extensions/git/src/repository.ts:449-499]()\n\n### Status Update Optimization\n\n```mermaid\ngraph LR\n    subgraph \"Status Limiter\"\n        StatusLimiter[\"statusLimiter:\u003cbr/\u003eLimiter(5)\"]\n    end\n    \n    subgraph \"Concurrent Limit\"\n        Status1[\"status() call 1\"]\n        Status2[\"status() call 2\"]\n        Status3[\"status() call 3\"]\n        Status4[\"status() call 4\"]\n        Status5[\"status() call 5\"]\n        Status6[\"status() call 6\u003cbr/\u003e(queued)\"]\n    end\n    \n    StatusLimiter --\u003e Status1\n    StatusLimiter --\u003e Status2\n    StatusLimiter --\u003e Status3\n    StatusLimiter --\u003e Status4\n    StatusLimiter --\u003e Status5\n    StatusLimiter -.limits.-\u003e Status6\n```\n\nThe `Limiter` ([extensions/git/src/util.ts:442-461]()) restricts concurrent status operations to 5 at a time. This prevents overloading Git when multiple repositories are open.\n\n**Smart Update**: When idle and waiting (`eventuallyUpdateWhenIdleAndWait()`), the repository waits for:\n1. All running operations to complete\n2. A 5-second idle period\n3. Then runs status update\n\nThis ensures status updates don't interfere with user actions.\n\nSources: [extensions/git/src/repository.ts:1367-1377](), [extensions/git/src/util.ts:442-461]()\n\n### Repository Context Keys\n\nThe repository exposes several context keys for conditional UI behavior:\n\n```mermaid\ngraph TB\n    Repo[\"Repository\"]\n    \n    RepoState[\"Context Keys\"]\n    \n    Repo --\u003e Count[\"gitOpenRepositoryCount\"]\n    Repo --\u003e State[\"git.state\"]\n    Repo --\u003e Merge[\"gitMergeInProgress\"]\n    Repo --\u003e Rebase[\"gitRebaseInProgress\"]\n    Repo --\u003e Operation[\"operationInProgress\"]\n    \n    Count --\u003e EnableCmd[\"Enable/disable commands\"]\n    State --\u003e ShowViews[\"Show/hide views\"]\n    Merge --\u003e ShowMergeUI[\"Show merge UI\"]\n    Rebase --\u003e ShowRebaseUI[\"Show rebase UI\"]\n    Operation --\u003e DisableActions[\"Disable concurrent actions\"]\n```\n\nKey context keys set by the repository ([extensions/git/src/repository.ts:835-847]()):\n- `operationInProgress`: When any operation is running\n- `gitOpenRepositoryCount`: Number of open repositories\n- `gitMergeInProgress`: When in merge state\n- `gitRebaseInProgress`: When rebasing\n\nThese control command enablement in `package.json`.\n\nSources: [extensions/git/src/repository.ts:835-847](), [extensions/git/package.json:78-1022]()"])</script><script>self.__next_f.push([1,"4f:T6507,"])</script><script>self.__next_f.push([1,"# Git Commands and Actions\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [extensions/git/package.json](extensions/git/package.json)\n- [extensions/git/package.nls.json](extensions/git/package.nls.json)\n- [extensions/git/src/actionButton.ts](extensions/git/src/actionButton.ts)\n- [extensions/git/src/api/api1.ts](extensions/git/src/api/api1.ts)\n- [extensions/git/src/api/git.d.ts](extensions/git/src/api/git.d.ts)\n- [extensions/git/src/artifactProvider.ts](extensions/git/src/artifactProvider.ts)\n- [extensions/git/src/askpass-empty.sh](extensions/git/src/askpass-empty.sh)\n- [extensions/git/src/askpass-main.ts](extensions/git/src/askpass-main.ts)\n- [extensions/git/src/askpass.sh](extensions/git/src/askpass.sh)\n- [extensions/git/src/askpass.ts](extensions/git/src/askpass.ts)\n- [extensions/git/src/autofetch.ts](extensions/git/src/autofetch.ts)\n- [extensions/git/src/commands.ts](extensions/git/src/commands.ts)\n- [extensions/git/src/git.ts](extensions/git/src/git.ts)\n- [extensions/git/src/gitEditor.ts](extensions/git/src/gitEditor.ts)\n- [extensions/git/src/ipc/ipcClient.ts](extensions/git/src/ipc/ipcClient.ts)\n- [extensions/git/src/ipc/ipcServer.ts](extensions/git/src/ipc/ipcServer.ts)\n- [extensions/git/src/main.ts](extensions/git/src/main.ts)\n- [extensions/git/src/model.ts](extensions/git/src/model.ts)\n- [extensions/git/src/operation.ts](extensions/git/src/operation.ts)\n- [extensions/git/src/postCommitCommands.ts](extensions/git/src/postCommitCommands.ts)\n- [extensions/git/src/repository.ts](extensions/git/src/repository.ts)\n- [extensions/git/src/ssh-askpass-empty.sh](extensions/git/src/ssh-askpass-empty.sh)\n- [extensions/git/src/ssh-askpass.sh](extensions/git/src/ssh-askpass.sh)\n- [extensions/git/src/statusbar.ts](extensions/git/src/statusbar.ts)\n- [extensions/git/src/terminal.ts](extensions/git/src/terminal.ts)\n- [extensions/git/src/util.ts](extensions/git/src/util.ts)\n- [extensions/git/tsconfig.json](extensions/git/tsconfig.json)\n- [src/vs/workbench/contrib/scm/common/artifact.ts](src/vs/workbench/contrib/scm/common/artifact.ts)\n- [src/vscode-dts/vscode.proposed.scmArtifactProvider.d.ts](src/vscode-dts/vscode.proposed.scmArtifactProvider.d.ts)\n- [test/automation/src/statusbar.ts](test/automation/src/statusbar.ts)\n\n\u003c/details\u003e\n\n\n\nThis document describes the command infrastructure of the Git extension, focusing on the `CommandCenter` class that implements all user-facing Git commands and the supporting classes that enable interactive command flows such as branch checkout, commit operations, and remote management.\n\nFor information about the underlying Git operations and repository state management, see [Repository and Operation Management](#10.2). For details about the Git history interface, see [Git History Provider](#10.4).\n\n## Command Center Architecture\n\nThe `CommandCenter` class in [extensions/git/src/commands.ts:780-799]() serves as the central hub for all Git command implementations. It is instantiated with dependencies on the `Git` instance, `Model`, global and workspace state, logger, telemetry reporter, and `CloneManager`.\n\nCommands are registered using the `@command` decorator which collects metadata about each command method, including its command ID and whether it requires a repository context. The registration process occurs in the constructor, where all decorated methods are bound to VS Code command IDs.\n\n```mermaid\ngraph TB\n    PackageJSON[\"package.json\u003cbr/\u003eCommand Contributions\"]\n    Decorator[\"@command decorator\u003cbr/\u003eMetadata Collection\"]\n    CommandCenter[\"CommandCenter class\u003cbr/\u003eCommand Implementations\"]\n    VSCodeCommands[\"commands.registerCommand\u003cbr/\u003eVS Code Command Registry\"]\n    UserAction[\"User Actions\u003cbr/\u003eMenus, Palette, Keybindings\"]\n    \n    PackageJSON --\u003e|\"declares\"| UserAction\n    Decorator --\u003e|\"annotates\"| CommandCenter\n    CommandCenter --\u003e|\"registers via constructor\"| VSCodeCommands\n    UserAction --\u003e|\"invokes\"| VSCodeCommands\n    VSCodeCommands --\u003e|\"executes\"| CommandCenter\n```\n\n**Diagram: Command Registration Flow**\n\nThe decorator pattern [extensions/git/src/commands.ts:375-383]() collects command metadata into a `Commands` array. Each command entry contains the command ID, method key, method reference, and options like whether it requires a repository context.\n\n**Sources:** [extensions/git/src/commands.ts:780-799](), [extensions/git/src/commands.ts:375-383](), [extensions/git/src/commands.ts:793-796]()\n\n## Command Helper Classes\n\nThe Git extension uses a hierarchy of helper classes to present interactive quick picks for selecting refs, branches, remotes, and other Git entities. These classes implement the `QuickPickItem` interface and provide formatted labels, descriptions, and icons.\n\n### Quick Pick Item Class Hierarchy\n\n```mermaid\nclassDiagram\n    class QuickPickItem {\n        \u003c\u003cinterface\u003e\u003e\n        +label: string\n        +description: string\n        +detail: string\n    }\n    \n    class RefItem {\n        +ref: Ref\n        +shortCommitLength: number\n        +label: string\n        +description: string\n        +detail: string\n        +buttons: QuickInputButton[]\n        +refId: string\n        +refName: string\n        +refRemote: string\n        +shortCommit: string\n    }\n    \n    class BranchItem {\n        +ref: Branch\n        +description: string\n    }\n    \n    class CheckoutItem {\n        +run(repository, opts): Promise~void~\n    }\n    \n    class CheckoutProtectedItem {\n        +label: string\n    }\n    \n    class CheckoutRemoteHeadItem {\n        +run(repository, opts): Promise~void~\n    }\n    \n    class CheckoutTagItem {\n        +run(repository, opts): Promise~void~\n    }\n    \n    class BranchDeleteItem {\n        +run(repository, force): Promise~void~\n    }\n    \n    class TagDeleteItem {\n        +run(repository): Promise~void~\n    }\n    \n    class MergeItem {\n        +run(repository): Promise~void~\n    }\n    \n    class RebaseItem {\n        +run(repository): Promise~void~\n    }\n    \n    class RemoteItem {\n        +remote: Remote\n        +label: string\n        +description: string\n        +remoteName: string\n        +run(): Promise~void~\n    }\n    \n    class StashItem {\n        +stash: Stash\n        +label: string\n        +description: string\n    }\n    \n    QuickPickItem \u003c|-- RefItem\n    RefItem \u003c|-- BranchItem\n    BranchItem \u003c|-- CheckoutItem\n    CheckoutItem \u003c|-- CheckoutProtectedItem\n    RefItem \u003c|-- CheckoutRemoteHeadItem\n    RefItem \u003c|-- CheckoutTagItem\n    BranchItem \u003c|-- BranchDeleteItem\n    RefItem \u003c|-- TagDeleteItem\n    BranchItem \u003c|-- MergeItem\n    BranchItem \u003c|-- RebaseItem\n    QuickPickItem \u003c|-- RemoteItem\n    QuickPickItem \u003c|-- StashItem\n```\n\n**Diagram: Quick Pick Item Class Hierarchy**\n\nKey helper classes include:\n\n| Class | Purpose | Key Properties |\n|-------|---------|----------------|\n| `RefItem` | Base class for Git refs | `ref`, `shortCommit`, `refId`, `buttons` |\n| `BranchItem` | Represents branches with ahead/behind info | Extends `RefItem` with sync status |\n| `CheckoutItem` | Executable checkout action | `run()` method with checkout options |\n| `CheckoutProtectedItem` | Protected branch with lock icon | Override `label` with lock icon |\n| `CheckoutRemoteHeadItem` | Remote branch checkout | Creates/checks out tracking branch |\n| `CheckoutTagItem` | Tag checkout | Checks out tag reference |\n| `BranchDeleteItem` | Branch deletion action | Handles local and remote deletion |\n| `MergeItem` / `RebaseItem` | Branch merge/rebase actions | Execute merge/rebase operations |\n| `RemoteItem` | Remote fetch action | Represents a remote for fetch |\n| `StashItem` | Stash entry | Displays stash index and description |\n\nThe `RefProcessor` and `RefItemsProcessor` classes [extensions/git/src/commands.ts:470-543]() transform raw `Ref` objects into appropriate `QuickPickItem` instances based on ref type and context.\n\n**Sources:** [extensions/git/src/commands.ts:24-360](), [extensions/git/src/commands.ts:470-543](), [extensions/git/src/commands.ts:562-625]()\n\n## Repository Selection\n\nMany commands require a repository context. The `CommandCenter` uses the `@command` decorator with `options.repository = true` to indicate commands that need repository resolution. The command registration infrastructure [extensions/git/src/commands.ts:793-796]() wraps these commands to automatically resolve the repository from the command arguments or prompt the user to select one.\n\n```mermaid\ngraph TB\n    UserInvoke[\"User Invokes Command\"]\n    HasRepoArg{\"Has Repository\u003cbr/\u003eArgument?\"}\n    SingleRepo{\"Single Repository\u003cbr/\u003ein Workspace?\"}\n    PromptUser[\"Show Repository\u003cbr/\u003eQuick Pick\"]\n    ResolveRepo[\"Resolve Repository\u003cbr/\u003efrom Argument\"]\n    ExecuteCommand[\"Execute Command\u003cbr/\u003ewith Repository\"]\n    \n    UserInvoke --\u003e HasRepoArg\n    HasRepoArg --\u003e|\"Yes\"| ResolveRepo\n    HasRepoArg --\u003e|\"No\"| SingleRepo\n    SingleRepo --\u003e|\"Yes\"| ExecuteCommand\n    SingleRepo --\u003e|\"No\"| PromptUser\n    ResolveRepo --\u003e ExecuteCommand\n    PromptUser --\u003e ExecuteCommand\n```\n\n**Diagram: Repository Resolution Flow**\n\nThe repository resolver can extract repositories from:\n- `SourceControl` instances\n- `SourceControlResourceGroup` instances  \n- `Uri` file paths\n- Direct repository string identifiers\n\nThe `RepositoryItem` class [extensions/git/src/commands.ts:345-351]() provides the quick pick UI for repository selection when multiple repositories are present.\n\n**Sources:** [extensions/git/src/commands.ts:793-796](), [extensions/git/src/commands.ts:345-351]()\n\n## Checkout Command Flow\n\nThe checkout command (`git.checkout`) demonstrates a typical interactive command flow with ref selection, processing, and execution.\n\n```mermaid\nsequenceDiagram\n    participant User\n    participant CommandCenter\n    participant createCheckoutItems\n    participant RefProcessors\n    participant Repository\n    participant Git\n    \n    User-\u003e\u003eCommandCenter: git.checkout\n    CommandCenter-\u003e\u003ecreateCheckoutItems: Get checkout items\n    createCheckoutItems-\u003e\u003eRepository: getRefs(includeCommitDetails)\n    Repository--\u003e\u003ecreateCheckoutItems: Ref[]\n    createCheckoutItems-\u003e\u003eRefProcessors: Process refs by type\n    RefProcessors--\u003e\u003ecreateCheckoutItems: QuickPickItem[]\n    createCheckoutItems--\u003e\u003eCommandCenter: CheckoutItem[]\n    CommandCenter-\u003e\u003eUser: Show quick pick\n    User-\u003e\u003eCommandCenter: Select CheckoutItem\n    CommandCenter-\u003e\u003eCheckoutItem: run(repository, opts)\n    CheckoutItem-\u003e\u003eRepository: checkout(treeish, opts)\n    Repository-\u003e\u003eGit: checkout git command\n    Git--\u003e\u003eRepository: Success\n    Repository--\u003e\u003eCheckoutItem: Success\n    CheckoutItem--\u003e\u003eCommandCenter: Success\n```\n\n**Diagram: Checkout Command Execution Flow**\n\nThe `createCheckoutItems` function [extensions/git/src/commands.ts:412-440]() orchestrates the checkout flow:\n\n1. **Configuration reading**: Reads `git.checkoutType` and `git.showReferenceDetails` settings\n2. **Ref retrieval**: Calls `repository.getRefs()` with optional commit details\n3. **Ref processing**: Uses `RefProcessor` instances for each checkout type (local, remote, tags)\n4. **Button attachment**: Attaches remote source action buttons for remote refs\n5. **Item construction**: Creates `CheckoutItem`, `CheckoutRemoteHeadItem`, or `CheckoutTagItem` instances\n\nCheckout types are filtered based on the `git.checkoutType` configuration:\n- `'local'`: Local branches only\n- `'remote'`: Remote branches only\n- `'tags'`: Tags only\n- `'all'` or array: Multiple types\n\nThe `pullBeforeCheckout` configuration determines whether branches are fast-forwarded before checkout.\n\n**Sources:** [extensions/git/src/commands.ts:412-440](), [extensions/git/src/commands.ts:1262-1301]()\n\n## Commit Command Workflow\n\nThe commit commands implement a sophisticated workflow that handles smart commit, amend, signing, verification, and post-commit actions.\n\n### Commit Options and Variants\n\nThe Git extension provides multiple commit command variants:\n\n| Command | All Files | Amend | Sign | Verify | Post-Command |\n|---------|-----------|-------|------|--------|--------------|\n| `git.commit` | No | No | No | Yes | Prompt |\n| `git.commitStaged` | No | No | No | Yes | Prompt |\n| `git.commitAll` | tracked | No | No | Yes | Prompt |\n| `git.commitAmend` | No | Yes | No | Yes | Prompt |\n| `git.commitSigned` | No | No | Yes | Yes | Prompt |\n| `git.commitNoVerify` | No | No | No | No | Prompt |\n| `git.commitStagedAmend` | No | Yes | No | Yes | Prompt |\n| `git.commitAllAmend` | tracked | Yes | No | Yes | Prompt |\n\nAll commit commands funnel through the internal `_commit` method [extensions/git/src/commands.ts:1764-1943]() which handles:\n\n1. **Smart Commit**: When `git.enableSmartCommit` is enabled and no files are staged, automatically stage tracked changes\n2. **Save prompting**: Check for unsaved files based on `git.promptToSaveFilesBeforeCommit` \n3. **Diagnostics checking**: Evaluate `git.diagnosticsCommitHook` to block commits with unresolved diagnostics\n4. **Message validation**: Ensure commit message is not empty or validate via input box validation\n5. **Branch protection**: Check if committing to a protected branch requires user confirmation\n6. **Commit execution**: Execute the commit via `repository.commit(message, options)`\n7. **Post-commit command**: Execute configured post-commit action (push, sync, or custom command)\n\n```mermaid\ngraph TB\n    CommitCmd[\"Commit Command Invoked\"]\n    CheckSmart{\"Smart Commit\u003cbr/\u003eEnabled?\"}\n    CheckStaged{\"Files Staged?\"}\n    StageFiles[\"Stage Tracked Files\"]\n    CheckSave{\"Unsaved Files?\"}\n    SavePrompt[\"Prompt to Save\"]\n    CheckDiag{\"Diagnostics\u003cbr/\u003eEnabled?\"}\n    EvalDiag[\"Evaluate Diagnostics\"]\n    DiagFail{\"Has Unresolved\u003cbr/\u003eDiagnostics?\"}\n    ShowDiagPrompt[\"Show Diagnostic Prompt\"]\n    CheckProtected{\"Branch\u003cbr/\u003eProtected?\"}\n    ProtectPrompt[\"Branch Protection Prompt\"]\n    ExecuteCommit[\"repository.commit()\"]\n    PostCommit[\"Execute Post-Commit Command\"]\n    \n    CommitCmd --\u003e CheckSmart\n    CheckSmart --\u003e|\"Yes\"| CheckStaged\n    CheckSmart --\u003e|\"No\"| CheckSave\n    CheckStaged --\u003e|\"No\"| StageFiles\n    CheckStaged --\u003e|\"Yes\"| CheckSave\n    StageFiles --\u003e CheckSave\n    CheckSave --\u003e|\"Yes\"| SavePrompt\n    CheckSave --\u003e|\"No\"| CheckDiag\n    SavePrompt --\u003e CheckDiag\n    CheckDiag --\u003e|\"Yes\"| EvalDiag\n    CheckDiag --\u003e|\"No\"| CheckProtected\n    EvalDiag --\u003e DiagFail\n    DiagFail --\u003e|\"Yes\"| ShowDiagPrompt\n    DiagFail --\u003e|\"No\"| CheckProtected\n    ShowDiagPrompt --\u003e|\"Commit Anyway\"| CheckProtected\n    ShowDiagPrompt --\u003e|\"Cancel\"| CommitCmd\n    CheckProtected --\u003e|\"Yes\"| ProtectPrompt\n    CheckProtected --\u003e|\"No\"| ExecuteCommit\n    ProtectPrompt --\u003e|\"Confirmed\"| ExecuteCommit\n    ProtectPrompt --\u003e|\"Cancel\"| CommitCmd\n    ExecuteCommit --\u003e PostCommit\n```\n\n**Diagram: Commit Command Flow with Validation and Protection**\n\nThe `evaluateDiagnosticsCommitHook` function [extensions/git/src/commands.ts:694-778]() evaluates workspace diagnostics for files being committed and blocks the commit if configured severity thresholds are exceeded.\n\n**Sources:** [extensions/git/src/commands.ts:1764-1943](), [extensions/git/src/commands.ts:694-778](), [extensions/git/src/commands.ts:1710-1762]()\n\n## Push and Pull Commands\n\nPush and pull operations support various modes and configurations:\n\n### Push Operations\n\nThe push workflow is implemented through the internal `_push` method [extensions/git/src/commands.ts:2265-2435]() which handles:\n\n- **Push types**: Regular push, push with tags, push tags only\n- **Force push**: Support for force, force-with-lease, and force-if-includes modes\n- **Upstream setup**: Automatic upstream tracking for new branches\n- **Remote selection**: Interactive remote/refspec selection for `git.pushTo`\n- **Silent mode**: Suppress success notifications when configured\n\n```mermaid\ngraph LR\n    PushCmd[\"Push Command\"]\n    HasUpstream{\"Has Upstream?\"}\n    PromptUpstream[\"Prompt to Set Upstream\"]\n    CheckForce{\"Force Push?\"}\n    ExecutePush[\"repository.push()\"]\n    ShowSuccess[\"Show Success Notification\"]\n    \n    PushCmd --\u003e HasUpstream\n    HasUpstream --\u003e|\"No\"| PromptUpstream\n    HasUpstream --\u003e|\"Yes\"| CheckForce\n    PromptUpstream --\u003e CheckForce\n    CheckForce --\u003e ExecutePush\n    ExecutePush --\u003e ShowSuccess\n```\n\n**Diagram: Push Command Flow**\n\nPush command variants:\n- `git.push`: Push current branch to upstream\n- `git.pushTo`: Interactive push to selected remote/branch\n- `git.pushForce`: Force push with configured force mode\n- `git.pushTags`: Push tags only\n- `git.pushWithTags`: Push with `--follow-tags`\n\n### Pull Operations\n\nPull commands [extensions/git/src/commands.ts:2523-2628]() include:\n- `git.pull`: Standard pull\n- `git.pullRebase`: Pull with rebase\n- `git.pullFrom`: Interactive pull from remote/branch\n\nThe pull configuration includes:\n- `git.fetchOnPull`: Fetch all branches vs. just current\n- `git.pullTags`: Fetch tags during pull\n- `git.autoStash`: Automatically stash/unstash during pull\n\n**Sources:** [extensions/git/src/commands.ts:2265-2435](), [extensions/git/src/commands.ts:2437-2521](), [extensions/git/src/commands.ts:2523-2628]()\n\n## Branch Management Commands\n\nBranch operations include creation, deletion, renaming, and merging:\n\n### Branch Creation\n\nThe `branch` command [extensions/git/src/commands.ts:1302-1382]() implements:\n\n1. **Name input**: Prompt for branch name with validation regex\n2. **Smart naming**: Optional random name generation using dictionaries (adjectives, animals, colors, numbers)\n3. **Sanitization**: Clean branch name according to Git rules\n4. **Creation**: Create branch with optional immediate checkout\n\nBranch name sanitization [extensions/git/src/commands.ts:649-651]() removes:\n- Leading dashes\n- Leading/trailing dots\n- Double dots `..`\n- Special characters: `~`, `^`, `:`, `\\`, `*`, `[`, `]`\n- `.lock` suffix\n\n### Branch Deletion\n\nThe `deleteBranch` command [extensions/git/src/commands.ts:1425-1503]() provides:\n\n- Interactive branch selection with deletion indicators\n- Force deletion option for unmerged branches\n- Support for both local and remote branch deletion\n- Confirmation prompts for destructive operations\n\n### Merge and Rebase\n\nMerge operations [extensions/git/src/commands.ts:1596-1697]():\n- Select branch/tag to merge\n- Execute `repository.merge(ref)`\n- Handle merge conflicts through conflict resolution UI\n- `git.mergeAbort` to abort in-progress merge\n\nRebase operations:\n- Interactive rebase branch selection\n- Execute `repository.rebase(branch)`\n- Continue/abort rebase operations\n- Support for rebase commit handling\n\n**Sources:** [extensions/git/src/commands.ts:1302-1382](), [extensions/git/src/commands.ts:1425-1503](), [extensions/git/src/commands.ts:1596-1697]()\n\n## Remote Management\n\nRemote commands manage remote repositories:\n\n### Remote Operations\n\n| Command | Purpose |\n|---------|---------|\n| `git.addRemote` | Add new remote with name and URL |\n| `git.removeRemote` | Remove existing remote |\n| `git.fetch` | Fetch from selected remote |\n| `git.fetchAll` | Fetch from all remotes |\n\nThe `addRemote` command [extensions/git/src/commands.ts:2639-2676]() includes:\n- Remote name input with sanitization\n- URL input (supports remote source providers)\n- Validation and duplicate checking\n\nThe fetch commands support:\n- Single remote fetch with optional ref\n- All remotes fetch\n- Prune option to remove stale branches\n- Depth parameter for shallow fetches\n\n**Sources:** [extensions/git/src/commands.ts:2639-2676](), [extensions/git/src/commands.ts:2733-2819]()\n\n## Staging and Unstaging Commands\n\nThe staging workflow implements granular control over the Git index:\n\n### Stage Operations\n\nStaging commands operate on multiple resource granularities:\n\n| Command | Scope | Method |\n|---------|-------|--------|\n| `git.stage` | Selected resources | `stage()` |\n| `git.stageAll` | All changes | `stageAll()` |\n| `git.stageAllTracked` | Tracked changes only | `stageAll()` |\n| `git.stageAllUntracked` | Untracked files only | `stageAll()` |\n| `git.stageAllMerge` | Merge conflict resolutions | `stageAll()` |\n| `git.stageSelectedRanges` | Text selection ranges | `stageSelectedRanges()` |\n| `git.stageChange` | Single change hunk | Stage via URI |\n\nThe `stageSelectedRanges` command [extensions/git/src/commands.ts:2041-2098]() implements sophisticated line-level staging:\n\n1. Get active editor and text selection\n2. Retrieve diff information from repository\n3. Apply selected line changes to index\n4. Update working tree with inverse changes\n\n### Unstage Operations\n\nUnstaging commands mirror the staging interface:\n- `git.unstage`: Unstage selected resources\n- `git.unstageAll`: Unstage all changes\n- `git.unstageSelectedRanges`: Unstage text selection ranges\n\nBoth staging and unstaging respect the SCM resource context and can operate on individual files, resource groups, or selections.\n\n**Sources:** [extensions/git/src/commands.ts:1985-2098](), [extensions/git/src/commands.ts:2099-2168]()\n\n## Stash Commands\n\nStash operations enable saving and restoring working directory changes:\n\n### Stash Creation\n\nThe stash commands [extensions/git/src/commands.ts:3100-3189]() include:\n\n- `git.stash`: Stash tracked changes only\n- `git.stashIncludeUntracked`: Stash including untracked files\n- `git.stashStaged`: Stash staged changes only (Git 2.35+)\n\nEach stash command:\n1. Prompts to save unsaved files (if configured)\n2. Requests optional stash message\n3. Creates stash with specified options\n4. Updates repository state\n\n### Stash Application and Removal\n\nStash retrieval commands:\n- `git.stashPop`: Apply and remove latest stash\n- `git.stashApply`: Apply stash without removing\n- `git.stashDrop`: Remove stash without applying\n\nThe stash selection UI [extensions/git/src/commands.ts:3190-3293]() shows:\n- Stash index and description\n- Branch name if available\n- Relative timestamp\n- Author and commit information\n\n**Sources:** [extensions/git/src/commands.ts:3100-3293]()\n\n## File and Change Commands\n\nFile-level operations provide granular change management:\n\n### Opening Files and Changes\n\n| Command | Opens |\n|---------|-------|\n| `git.openFile` | Current version of file |\n| `git.openFile2` | File from resource context |\n| `git.openHEADFile` | HEAD version of file |\n| `git.openChange` | Diff view of changes |\n| `git.openAllChanges` | All changed files |\n\nThe `openChange` command resolves the appropriate diff:\n- Working tree changes: Compare with index (`~`)\n- Staged changes: Compare with HEAD\n- Merge conflicts: Open merge editor or diff view\n\n### Change Reversion\n\nThe `clean` and `revert` commands [extensions/git/src/commands.ts:2169-2264]() discard changes:\n\n- `git.clean`: Discard changes in selected files\n- `git.cleanAll`: Discard all changes with scope selection\n- `git.revertSelectedRanges`: Revert text selection ranges\n\nThe `discardAllScope` setting controls whether \"all\" means tracked files only, all files, or prompts for user choice.\n\n**Sources:** [extensions/git/src/commands.ts:811-838](), [extensions/git/src/commands.ts:840-959](), [extensions/git/src/commands.ts:2169-2264]()\n\n## Tag Commands\n\nTag management supports creating and deleting local and remote tags:\n\n### Tag Creation\n\nThe `createTag` command [extensions/git/src/commands.ts:1698-1748]() implements:\n\n1. Prompt for tag name\n2. Optional tag message (creates annotated tag)\n3. Optional ref/commit to tag (defaults to HEAD)\n4. Execute `repository.tag(name, message, ref)`\n\n### Tag Deletion\n\nTag deletion commands:\n- `git.deleteTag`: Delete local tag\n- `git.deleteRemoteTag`: Delete remote tag\n\nRemote tag deletion [extensions/git/src/commands.ts:1769-1809]() requires:\n1. Select remote\n2. Select tag from remote refs\n3. Confirm deletion\n4. Execute `repository.deleteRemoteRef(remote, tagName)`\n\n**Sources:** [extensions/git/src/commands.ts:1698-1748](), [extensions/git/src/commands.ts:1749-1809]()\n\n## Command Error Handling\n\nThe command infrastructure includes comprehensive error handling:\n\n### Error Presentation\n\nWhen Git operations fail, the `CommandCenter` presents errors through:\n\n1. **Error messages**: Modal dialogs with action buttons\n2. **Output channel**: Detailed error output in Git output channel\n3. **Text documents**: Full error details in temporary documents\n\nThe `CommandErrorOutputTextDocumentContentProvider` [extensions/git/src/commands.ts:677-692]() creates virtual text documents for displaying command errors with full stdout/stderr output.\n\n### Error Recovery\n\nCommon error scenarios and recovery:\n- **Authentication failures**: Trigger credential provider flow\n- **Merge conflicts**: Open conflict resolution UI\n- **Push rejected**: Suggest pull or force push\n- **Protected branches**: Show branch protection prompt\n- **Network errors**: Suggest retry or offline mode\n\n**Sources:** [extensions/git/src/commands.ts:677-692]()\n\n## Command Categories\n\nCommands are organized into logical categories for menu contributions:\n\n### Repository Lifecycle\n- Initialize, clone, open, close repositories\n- Repository detection and unsafe repository management\n\n### File Operations  \n- Stage, unstage, clean, revert changes\n- Open files and diff views\n- Ignore files\n\n### Commit Operations\n- Commit, amend, sign-off commits\n- Undo commits, restore commit templates\n\n### Branch Operations\n- Create, delete, rename, checkout branches\n- Merge, rebase, cherry-pick operations\n\n### Remote Operations\n- Add, remove remotes\n- Fetch, pull, push operations\n- Publish branches\n\n### Stash Operations\n- Create, apply, pop, drop stashes\n- View stash contents\n\n### Tag Operations\n- Create, delete tags (local and remote)\n\n### History and Comparison\n- View commits, timeline, blame\n- Compare refs, merge bases\n\n### Worktree Operations\n- Create, delete, open worktrees\n- Migrate changes between worktrees\n\nAll commands are declared in [extensions/git/package.json:71-1023]() with enablement expressions, icons, and category assignments.\n\n**Sources:** [extensions/git/package.json:71-1023](), [extensions/git/src/commands.ts:780-3660]()"])</script><script>self.__next_f.push([1,"50:T4a50,"])</script><script>self.__next_f.push([1,"# Git History Provider\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [extensions/git/package.json](extensions/git/package.json)\n- [extensions/git/package.nls.json](extensions/git/package.nls.json)\n- [extensions/git/src/actionButton.ts](extensions/git/src/actionButton.ts)\n- [extensions/git/src/api/api1.ts](extensions/git/src/api/api1.ts)\n- [extensions/git/src/api/git.d.ts](extensions/git/src/api/git.d.ts)\n- [extensions/git/src/artifactProvider.ts](extensions/git/src/artifactProvider.ts)\n- [extensions/git/src/askpass-empty.sh](extensions/git/src/askpass-empty.sh)\n- [extensions/git/src/askpass-main.ts](extensions/git/src/askpass-main.ts)\n- [extensions/git/src/askpass.sh](extensions/git/src/askpass.sh)\n- [extensions/git/src/askpass.ts](extensions/git/src/askpass.ts)\n- [extensions/git/src/autofetch.ts](extensions/git/src/autofetch.ts)\n- [extensions/git/src/commands.ts](extensions/git/src/commands.ts)\n- [extensions/git/src/git.ts](extensions/git/src/git.ts)\n- [extensions/git/src/gitEditor.ts](extensions/git/src/gitEditor.ts)\n- [extensions/git/src/historyProvider.ts](extensions/git/src/historyProvider.ts)\n- [extensions/git/src/ipc/ipcClient.ts](extensions/git/src/ipc/ipcClient.ts)\n- [extensions/git/src/ipc/ipcServer.ts](extensions/git/src/ipc/ipcServer.ts)\n- [extensions/git/src/main.ts](extensions/git/src/main.ts)\n- [extensions/git/src/model.ts](extensions/git/src/model.ts)\n- [extensions/git/src/operation.ts](extensions/git/src/operation.ts)\n- [extensions/git/src/postCommitCommands.ts](extensions/git/src/postCommitCommands.ts)\n- [extensions/git/src/repository.ts](extensions/git/src/repository.ts)\n- [extensions/git/src/ssh-askpass-empty.sh](extensions/git/src/ssh-askpass-empty.sh)\n- [extensions/git/src/ssh-askpass.sh](extensions/git/src/ssh-askpass.sh)\n- [extensions/git/src/statusbar.ts](extensions/git/src/statusbar.ts)\n- [extensions/git/src/terminal.ts](extensions/git/src/terminal.ts)\n- [extensions/git/src/util.ts](extensions/git/src/util.ts)\n- [extensions/git/tsconfig.json](extensions/git/tsconfig.json)\n- [src/vs/workbench/api/browser/mainThreadSCM.ts](src/vs/workbench/api/browser/mainThreadSCM.ts)\n- [src/vs/workbench/api/common/extHostSCM.ts](src/vs/workbench/api/common/extHostSCM.ts)\n- [src/vs/workbench/contrib/scm/browser/activity.ts](src/vs/workbench/contrib/scm/browser/activity.ts)\n- [src/vs/workbench/contrib/scm/browser/media/scm.css](src/vs/workbench/contrib/scm/browser/media/scm.css)\n- [src/vs/workbench/contrib/scm/browser/menus.ts](src/vs/workbench/contrib/scm/browser/menus.ts)\n- [src/vs/workbench/contrib/scm/browser/scm.contribution.ts](src/vs/workbench/contrib/scm/browser/scm.contribution.ts)\n- [src/vs/workbench/contrib/scm/browser/scmHistory.ts](src/vs/workbench/contrib/scm/browser/scmHistory.ts)\n- [src/vs/workbench/contrib/scm/browser/scmHistoryViewPane.ts](src/vs/workbench/contrib/scm/browser/scmHistoryViewPane.ts)\n- [src/vs/workbench/contrib/scm/browser/scmRepositoriesViewPane.ts](src/vs/workbench/contrib/scm/browser/scmRepositoriesViewPane.ts)\n- [src/vs/workbench/contrib/scm/browser/scmRepositoryRenderer.ts](src/vs/workbench/contrib/scm/browser/scmRepositoryRenderer.ts)\n- [src/vs/workbench/contrib/scm/browser/scmViewPane.ts](src/vs/workbench/contrib/scm/browser/scmViewPane.ts)\n- [src/vs/workbench/contrib/scm/browser/scmViewService.ts](src/vs/workbench/contrib/scm/browser/scmViewService.ts)\n- [src/vs/workbench/contrib/scm/browser/util.ts](src/vs/workbench/contrib/scm/browser/util.ts)\n- [src/vs/workbench/contrib/scm/browser/workingSet.ts](src/vs/workbench/contrib/scm/browser/workingSet.ts)\n- [src/vs/workbench/contrib/scm/common/artifact.ts](src/vs/workbench/contrib/scm/common/artifact.ts)\n- [src/vs/workbench/contrib/scm/common/history.ts](src/vs/workbench/contrib/scm/common/history.ts)\n- [src/vs/workbench/contrib/scm/common/scm.ts](src/vs/workbench/contrib/scm/common/scm.ts)\n- [src/vs/workbench/contrib/scm/test/browser/scmHistory.test.ts](src/vs/workbench/contrib/scm/test/browser/scmHistory.test.ts)\n- [src/vscode-dts/vscode.proposed.scmArtifactProvider.d.ts](src/vscode-dts/vscode.proposed.scmArtifactProvider.d.ts)\n- [src/vscode-dts/vscode.proposed.scmHistoryProvider.d.ts](src/vscode-dts/vscode.proposed.scmHistoryProvider.d.ts)\n- [test/automation/src/statusbar.ts](test/automation/src/statusbar.ts)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThe Git History Provider is the implementation of the SCM history system for Git repositories in VS Code. It enables the visualization of commit history, branches, tags, and their relationships in the Source Control view's History pane. This document covers the `GitHistoryProvider` class implementation and its integration with the VS Code SCM framework.\n\nFor information about the broader SCM framework and history UI, see [SCM History Provider](#9.4). For details about the Git extension architecture, see [Git Extension Architecture](#10.1).\n\n## Architecture Overview\n\nThe Git History Provider acts as a bridge between the Git command-line operations and VS Code's SCM history UI. It implements the `SourceControlHistoryProvider` interface and provides commit history, branch/tag references, and visual decorations for history items.\n\n### System Context Diagram\n\n```mermaid\ngraph TB\n    subgraph \"VS Code Core\"\n        SCMService[\"ISCMService\"]\n        HistoryPane[\"SCMHistoryViewPane\"]\n        FileDecorations[\"FileDecorationProvider\"]\n    end\n    \n    subgraph \"Git Extension\"\n        Repository[\"Repository\"]\n        GitHistoryProvider[\"GitHistoryProvider\"]\n        Git[\"Git (CLI Wrapper)\"]\n        HistoryItemDetailsRegistry[\"ISourceControlHistoryItemDetailsProviderRegistry\"]\n    end\n    \n    Repository --\u003e|\"creates \u0026 registers\"| GitHistoryProvider\n    GitHistoryProvider --\u003e|\"implements\"| SCMService\n    GitHistoryProvider --\u003e|\"implements\"| FileDecorations\n    GitHistoryProvider --\u003e|\"uses\"| Git\n    GitHistoryProvider --\u003e|\"uses\"| HistoryItemDetailsRegistry\n    HistoryPane --\u003e|\"queries\"| GitHistoryProvider\n    \n    GitHistoryProvider --\u003e|\"provideHistoryItems()\"| HistoryPane\n    GitHistoryProvider --\u003e|\"currentHistoryItemRef\"| HistoryPane\n    GitHistoryProvider --\u003e|\"historyItemRefs\"| HistoryPane\n```\n\n**Sources:** [extensions/git/src/historyProvider.ts:1-810](), [extensions/git/src/repository.ts:1-2000](), [src/vs/workbench/contrib/scm/common/history.ts:1-150]()\n\n## Key Components\n\n### GitHistoryProvider Class\n\nThe `GitHistoryProvider` class [extensions/git/src/historyProvider.ts:42-810]() is the central component that implements both `SourceControlHistoryProvider` and `FileDecorationProvider` interfaces. It manages the state of history item references and provides history data to the UI.\n\n```mermaid\nclassDiagram\n    class GitHistoryProvider {\n        -Repository repository\n        -LogOutputChannel logger\n        -ISourceControlHistoryItemDetailsProviderRegistry historyItemDetailProviderRegistry\n        -SourceControlHistoryItemRef _currentHistoryItemRef\n        -SourceControlHistoryItemRef _currentHistoryItemRemoteRef\n        -SourceControlHistoryItemRef _currentHistoryItemBaseRef\n        -SourceControlHistoryItemRef[] _historyItemRefs\n        +currentHistoryItemRef\n        +currentHistoryItemRemoteRef\n        +currentHistoryItemBaseRef\n        +onDidChangeCurrentHistoryItemRefs Event\n        +onDidChangeHistoryItemRefs Event\n        +provideHistoryItems(options) Promise\n        +provideHistoryItemChanges(id, uri) Promise\n        +resolveHistoryItemRefsCommonAncestor(refs) Promise\n        +provideFileDecoration(uri) FileDecoration\n    }\n    \n    class Repository {\n        +provider SourceControl\n        +historyProvider GitHistoryProvider\n        +HEAD Branch\n        +refs Ref[]\n        +remotes Remote[]\n    }\n    \n    class Git {\n        +log(repository, options) Promise~Commit[]~\n        +show(repository, path, ref) Promise\n        +getCommit(repository, ref) Promise~Commit~\n        +mergeBase(repository, ref1, ref2) Promise\n    }\n    \n    GitHistoryProvider --\u003e Repository\n    GitHistoryProvider --\u003e Git\n    Repository --\u003e GitHistoryProvider\n```\n\n**Sources:** [extensions/git/src/historyProvider.ts:42-100](), [extensions/git/src/repository.ts:650-750]()\n\n### History Item References\n\nHistory item references represent branches, tags, and other git refs that can be used to filter or scope the commit history display.\n\n| Property | Type | Description |\n|----------|------|-------------|\n| `currentHistoryItemRef` | `SourceControlHistoryItemRef \\| undefined` | The currently selected ref (usually HEAD) |\n| `currentHistoryItemRemoteRef` | `SourceControlHistoryItemRef \\| undefined` | The remote tracking ref for the current branch |\n| `currentHistoryItemBaseRef` | `SourceControlHistoryItemRef \\| undefined` | The base ref for comparing changes |\n| `_historyItemRefs` | `SourceControlHistoryItemRef[]` | All available refs (branches, tags) |\n\n**Sources:** [extensions/git/src/historyProvider.ts:46-62]()\n\n## History Item Ref Management\n\nThe history provider tracks changes to Git refs (branches, tags) and maintains a synchronized view of the current repository state.\n\n### Ref Update Flow\n\n```mermaid\nsequenceDiagram\n    participant Repo as Repository\n    participant HistProv as GitHistoryProvider\n    participant Git as Git CLI\n    participant UI as SCMHistoryViewPane\n    \n    Note over Repo: Git operation completes\n    Repo-\u003e\u003eHistProv: onDidRunWriteOperation\n    HistProv-\u003e\u003eHistProv: updateRepositoryState()\n    HistProv-\u003e\u003eGit: getRefs()\n    Git--\u003e\u003eHistProv: Ref[]\n    HistProv-\u003e\u003eHistProv: processRefs()\n    HistProv-\u003e\u003eHistProv: updateHistoryItemRefs()\n    HistProv-\u003e\u003eHistProv: updateCurrentHistoryItemRefs()\n    HistProv-\u003e\u003eUI: onDidChangeHistoryItemRefs\n    HistProv-\u003e\u003eUI: onDidChangeCurrentHistoryItemRefs\n    UI-\u003e\u003eUI: refresh()\n```\n\n**Sources:** [extensions/git/src/historyProvider.ts:92-200]()\n\n### Ref Processing\n\nThe provider converts Git `Ref` objects to `SourceControlHistoryItemRef` objects [extensions/git/src/historyProvider.ts:300-450]():\n\n```mermaid\ngraph LR\n    GitRefs[\"Git Refs\u003cbr/\u003e(Branch, Tag)\"]\n    ProcessRefs[\"processRefs()\"]\n    HistoryItemRefs[\"SourceControlHistoryItemRef[]\"]\n    Compare[\"compareSourceControlHistoryItemRef()\"]\n    Sort[\"sorted refs\"]\n    \n    GitRefs --\u003e ProcessRefs\n    ProcessRefs --\u003e HistoryItemRefs\n    HistoryItemRefs --\u003e Compare\n    Compare --\u003e Sort\n    \n    subgraph \"Ref Properties\"\n        RefId[\"id: refs/heads/main\"]\n        RefName[\"name: main\"]\n        RefIcon[\"icon: git-branch\"]\n        RefRevision[\"revision: commit hash\"]\n    end\n```\n\nThe `compareSourceControlHistoryItemRef` function [extensions/git/src/historyProvider.ts:19-40]() sorts refs by type:\n1. Local branches (`refs/heads/`)\n2. Remote branches (`refs/remotes/`)\n3. Tags (`refs/tags/`)\n\n**Sources:** [extensions/git/src/historyProvider.ts:19-40](), [extensions/git/src/historyProvider.ts:300-450]()\n\n## History Item Retrieval\n\nThe `provideHistoryItems` method [extensions/git/src/historyProvider.ts:475-600]() is the core function that retrieves commit history from Git and converts it to the format expected by VS Code.\n\n### History Item Retrieval Flow\n\n```mermaid\ngraph TB\n    UI[\"SCMHistoryViewPane\"]\n    ProvideHistoryItems[\"provideHistoryItems(options)\"]\n    BuildLogOptions[\"buildLogOptions()\"]\n    GitLog[\"git.log(logOptions)\"]\n    ProcessCommits[\"process commits\"]\n    EnrichDetails[\"enrich with provider details\"]\n    HistoryItems[\"SourceControlHistoryItem[]\"]\n    \n    UI --\u003e|\"request history\"| ProvideHistoryItems\n    ProvideHistoryItems --\u003e BuildLogOptions\n    BuildLogOptions --\u003e GitLog\n    GitLog --\u003e ProcessCommits\n    ProcessCommits --\u003e EnrichDetails\n    EnrichDetails --\u003e HistoryItems\n    HistoryItems --\u003e UI\n    \n    subgraph \"LogOptions\"\n        MaxEntries[\"maxEntries: limit\"]\n        RefNames[\"refNames: filter by ref\"]\n        Skip[\"skip: pagination\"]\n        Author[\"author: filter\"]\n    end\n    \n    BuildLogOptions -.-\u003e LogOptions\n```\n\n**Sources:** [extensions/git/src/historyProvider.ts:475-600]()\n\n### Commit Conversion\n\nEach Git `Commit` object is converted to a `SourceControlHistoryItem` [extensions/git/src/historyProvider.ts:550-650]():\n\n| Git Commit Field | History Item Field | Processing |\n|------------------|-------------------|------------|\n| `hash` | `id` | Short hash (7 chars by default) |\n| `message` | `message` | Emojified, truncated, with links |\n| `parents` | `parentIds` | Array of short parent hashes |\n| `authorName` | `author` | Direct mapping |\n| `authorEmail` | Not exposed | Used for avatar lookup |\n| `authorDate` | `timestamp` | Unix timestamp in milliseconds |\n| Refs at commit | `references` | Converted to `SourceControlHistoryItemRef[]` |\n| Statistics | `statistics` | Files changed, insertions, deletions |\n\n**Sources:** [extensions/git/src/historyProvider.ts:550-650]()\n\n### History Item Details Enhancement\n\nThe provider uses the `ISourceControlHistoryItemDetailsProviderRegistry` [extensions/git/src/historyProvider.ts:580-620]() to enhance history items with:\n\n1. **Avatar URLs** - Via `provideSourceControlHistoryItemAvatar()`\n2. **Message Links** - Via `provideSourceControlHistoryItemMessageLinks()` to linkify issue references\n3. **Hover Commands** - Via `provideSourceControlHistoryItemHoverCommands()` for commit hash actions\n\n```mermaid\ngraph LR\n    BaseHistoryItem[\"Base HistoryItem\"]\n    AvatarProvider[\"provideSourceControlHistoryItemAvatar()\"]\n    MessageLinksProvider[\"provideSourceControlHistoryItemMessageLinks()\"]\n    HoverCommandsProvider[\"provideSourceControlHistoryItemHoverCommands()\"]\n    EnrichedItem[\"Enriched HistoryItem\"]\n    \n    BaseHistoryItem --\u003e AvatarProvider\n    BaseHistoryItem --\u003e MessageLinksProvider\n    BaseHistoryItem --\u003e HoverCommandsProvider\n    AvatarProvider --\u003e EnrichedItem\n    MessageLinksProvider --\u003e EnrichedItem\n    HoverCommandsProvider --\u003e EnrichedItem\n```\n\n**Sources:** [extensions/git/src/historyProvider.ts:580-620](), [extensions/git/src/historyItemDetailsProvider.ts:1-200]()\n\n## History Item Changes\n\nThe `provideHistoryItemChanges` method [extensions/git/src/historyProvider.ts:650-750]() retrieves the list of files changed in a specific commit.\n\n```mermaid\nsequenceDiagram\n    participant UI as User clicks commit\n    participant HistProv as GitHistoryProvider\n    participant Git as Git CLI\n    participant Changes as SourceControlHistoryItemChange[]\n    \n    UI-\u003e\u003eHistProv: provideHistoryItemChanges(id, uri)\n    HistProv-\u003e\u003eGit: show(repository, uri, id)\n    Git--\u003e\u003eHistProv: raw git show output\n    HistProv-\u003e\u003eHistProv: parse changes\n    HistProv-\u003e\u003eHistProv: create URIs with git: scheme\n    HistProv-\u003e\u003eChanges: map to HistoryItemChange\n    Changes--\u003e\u003eUI: display file changes\n```\n\nEach change includes:\n- `uri` - The file URI with appropriate revision\n- `originalUri` - The original file location (for renames)\n- `renameUri` - The new file location (for renames)\n- `modifiedUri` - URI for the modified version\n\n**Sources:** [extensions/git/src/historyProvider.ts:650-750]()\n\n## File Decorations\n\nThe `GitHistoryProvider` implements `FileDecorationProvider` [extensions/git/src/historyProvider.ts:760-810]() to show visual indicators on history items.\n\n### Decoration Types\n\n```mermaid\ngraph TB\n    HistoryItem[\"History Item\"]\n    CheckType{\"Check Type\"}\n    IncomingDec[\"Incoming: cloud-download\u003cbr/\u003ecolor: charts-blue\"]\n    OutgoingDec[\"Outgoing: cloud-upload\u003cbr/\u003ecolor: charts-blue\"]\n    CurrentDec[\"Current: circle-large-filled\u003cbr/\u003ecolor: charts-purple\"]\n    \n    HistoryItem --\u003e CheckType\n    CheckType --\u003e|\"id ends with\u003cbr/\u003e-incoming\"| IncomingDec\n    CheckType --\u003e|\"id ends with\u003cbr/\u003e-outgoing\"| OutgoingDec\n    CheckType --\u003e|\"matches current ref\"| CurrentDec\n```\n\nThe special history item IDs used for decorations [extensions/git/src/historyProvider.ts:765-790]():\n- **Incoming changes**: ID ends with `-incoming` - Shows commits in remote that aren't in local\n- **Outgoing changes**: ID ends with `-outgoing` - Shows local commits not pushed to remote\n- **Current HEAD**: Matches the current history item ref revision\n\n**Sources:** [extensions/git/src/historyProvider.ts:760-810]()\n\n## Integration with Repository\n\nThe `GitHistoryProvider` is created and registered by the `Repository` class [extensions/git/src/repository.ts:650-750]():\n\n```mermaid\ngraph TB\n    Repository[\"Repository constructor\"]\n    CreateProvider[\"new GitHistoryProvider()\"]\n    RegisterProvider[\"sourceControl.historyProvider.set()\"]\n    WatchOperations[\"listen: onDidRunOperation\"]\n    UpdateRefs[\"updateModelState()\"]\n    EmitRefChanges[\"provider emits events\"]\n    \n    Repository --\u003e CreateProvider\n    CreateProvider --\u003e RegisterProvider\n    Repository --\u003e WatchOperations\n    WatchOperations --\u003e UpdateRefs\n    UpdateRefs --\u003e EmitRefChanges\n```\n\nThe repository provides the provider with:\n- Access to the `Git` CLI wrapper for executing git commands\n- The repository root path and configuration\n- Events for git operations (commit, fetch, pull, etc.)\n\n**Sources:** [extensions/git/src/repository.ts:650-750](), [extensions/git/src/repository.ts:1200-1300]()\n\n## Configuration and Customization\n\nThe history provider respects several workspace settings:\n\n| Setting | Default | Purpose |\n|---------|---------|---------|\n| `git.commitShortHashLength` | 7 | Length of abbreviated commit hashes |\n| Various `git.graph.*` settings | - | Graph visualization options |\n\n**Sources:** [extensions/git/src/historyProvider.ts:83-90]()\n\n## Common Ancestor Resolution\n\nThe `resolveHistoryItemRefsCommonAncestor` method [extensions/git/src/historyProvider.ts:705-730]() finds the merge base between two refs, which is used for three-way comparisons:\n\n```mermaid\ngraph LR\n    Ref1[\"Ref 1\u003cbr/\u003e(e.g., main)\"]\n    Ref2[\"Ref 2\u003cbr/\u003e(e.g., feature)\"]\n    GitMergeBase[\"git merge-base\"]\n    CommonAncestor[\"Common Ancestor\u003cbr/\u003eCommit\"]\n    \n    Ref1 --\u003e GitMergeBase\n    Ref2 --\u003e GitMergeBase\n    GitMergeBase --\u003e CommonAncestor\n```\n\nThis is essential for:\n- Three-way merge operations\n- Showing the diff between branches accurately\n- Understanding the relationship between refs\n\n**Sources:** [extensions/git/src/historyProvider.ts:705-730]()\n\n## Error Handling and Logging\n\nThe provider includes comprehensive error handling and logging [extensions/git/src/historyProvider.ts:92-200]():\n\n- All git operations are wrapped in try-catch blocks\n- Errors are logged to the Git output channel\n- The provider gracefully handles repository state inconsistencies\n- Debug-level logging helps troubleshoot history loading issues\n\n**Sources:** [extensions/git/src/historyProvider.ts:92-200]()\n\n## Summary\n\nThe Git History Provider is a critical component that bridges Git's command-line interface with VS Code's SCM history UI. It manages the complex state of Git refs, retrieves and processes commit history, and provides rich decorations and details for history items. The provider's design allows for extensibility through the history item details provider registry while maintaining clean separation between the Git-specific logic and the generic SCM framework."])</script><script>self.__next_f.push([1,"51:T4f11,"])</script><script>self.__next_f.push([1,"# Git IPC and Helper Processes\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [extensions/git/package.json](extensions/git/package.json)\n- [extensions/git/package.nls.json](extensions/git/package.nls.json)\n- [extensions/git/src/actionButton.ts](extensions/git/src/actionButton.ts)\n- [extensions/git/src/api/api1.ts](extensions/git/src/api/api1.ts)\n- [extensions/git/src/api/git.d.ts](extensions/git/src/api/git.d.ts)\n- [extensions/git/src/artifactProvider.ts](extensions/git/src/artifactProvider.ts)\n- [extensions/git/src/askpass-empty.sh](extensions/git/src/askpass-empty.sh)\n- [extensions/git/src/askpass-main.ts](extensions/git/src/askpass-main.ts)\n- [extensions/git/src/askpass.sh](extensions/git/src/askpass.sh)\n- [extensions/git/src/askpass.ts](extensions/git/src/askpass.ts)\n- [extensions/git/src/autofetch.ts](extensions/git/src/autofetch.ts)\n- [extensions/git/src/commands.ts](extensions/git/src/commands.ts)\n- [extensions/git/src/git.ts](extensions/git/src/git.ts)\n- [extensions/git/src/gitEditor.ts](extensions/git/src/gitEditor.ts)\n- [extensions/git/src/ipc/ipcClient.ts](extensions/git/src/ipc/ipcClient.ts)\n- [extensions/git/src/ipc/ipcServer.ts](extensions/git/src/ipc/ipcServer.ts)\n- [extensions/git/src/main.ts](extensions/git/src/main.ts)\n- [extensions/git/src/model.ts](extensions/git/src/model.ts)\n- [extensions/git/src/operation.ts](extensions/git/src/operation.ts)\n- [extensions/git/src/postCommitCommands.ts](extensions/git/src/postCommitCommands.ts)\n- [extensions/git/src/repository.ts](extensions/git/src/repository.ts)\n- [extensions/git/src/ssh-askpass-empty.sh](extensions/git/src/ssh-askpass-empty.sh)\n- [extensions/git/src/ssh-askpass.sh](extensions/git/src/ssh-askpass.sh)\n- [extensions/git/src/statusbar.ts](extensions/git/src/statusbar.ts)\n- [extensions/git/src/terminal.ts](extensions/git/src/terminal.ts)\n- [extensions/git/src/util.ts](extensions/git/src/util.ts)\n- [extensions/git/tsconfig.json](extensions/git/tsconfig.json)\n- [src/vs/workbench/contrib/scm/common/artifact.ts](src/vs/workbench/contrib/scm/common/artifact.ts)\n- [src/vscode-dts/vscode.proposed.scmArtifactProvider.d.ts](src/vscode-dts/vscode.proposed.scmArtifactProvider.d.ts)\n- [test/automation/src/statusbar.ts](test/automation/src/statusbar.ts)\n\n\u003c/details\u003e\n\n\n\nThis document describes the Inter-Process Communication (IPC) infrastructure used by the Git extension to handle Git credential prompts and commit message editing. When Git requests user input during operations like push/pull (credentials) or commit (message editing), these helper processes bridge Git's expectations with VS Code's UI.\n\nFor information about the overall Git extension architecture, see [10.1](#10.1). For Git commands and operations, see [10.3](#10.3).\n\n## Purpose and Scope\n\nThe Git CLI expects certain external programs to handle user interactions:\n- `GIT_ASKPASS`: Program to prompt for credentials (username/password)\n- `SSH_ASKPASS`: Program to prompt for SSH passphrases\n- `GIT_EDITOR`: Program to edit commit messages\n\nThe Git extension provides custom implementations of these programs that communicate with VS Code via IPC, allowing Git operations to prompt for credentials and edit commit messages using VS Code's UI instead of terminal prompts or external editors.\n\n## IPC Architecture Overview\n\nThe IPC system enables bidirectional communication between the Git CLI and VS Code through helper processes.\n\n```mermaid\ngraph TD\n    Git[\"Git CLI Process\"]\n    AskpassSh[\"askpass.sh\u003cbr/\u003eShell Script\"]\n    SshAskpassSh[\"ssh-askpass.sh\u003cbr/\u003eShell Script\"]\n    EditorSh[\"git-editor.sh\u003cbr/\u003eShell Script\"]\n    AskpassMain[\"askpass-main.ts\u003cbr/\u003eNode Process\"]\n    EditorMain[\"git-editor-main.ts\u003cbr/\u003eNode Process\"]\n    IPCClient[\"IPCClient\"]\n    IPCServer[\"IPCServer\u003cbr/\u003eHTTP on Named Pipe\"]\n    AskpassHandler[\"Askpass Handler\u003cbr/\u003eIIPCHandler\"]\n    EditorHandler[\"GitEditor Handler\u003cbr/\u003eIIPCHandler\"]\n    VSCodeUI[\"VS Code UI\u003cbr/\u003eInputBox/Editor\"]\n    \n    Git --\u003e|GIT_ASKPASS env| AskpassSh\n    Git --\u003e|SSH_ASKPASS env| SshAskpassSh\n    Git --\u003e|GIT_EDITOR env| EditorSh\n    \n    AskpassSh --\u003e|spawn Node.js| AskpassMain\n    SshAskpassSh --\u003e|spawn Node.js| AskpassMain\n    EditorSh --\u003e|spawn Node.js| EditorMain\n    \n    AskpassMain --\u003e IPCClient\n    EditorMain --\u003e IPCClient\n    \n    IPCClient --\u003e|HTTP Request| IPCServer\n    \n    IPCServer --\u003e AskpassHandler\n    IPCServer --\u003e EditorHandler\n    \n    AskpassHandler --\u003e VSCodeUI\n    EditorHandler --\u003e VSCodeUI\n    \n    VSCodeUI --\u003e|Response| AskpassHandler\n    VSCodeUI --\u003e|Response| EditorHandler\n    \n    AskpassHandler --\u003e|HTTP Response| IPCServer\n    EditorHandler --\u003e|HTTP Response| IPCServer\n    \n    IPCServer --\u003e|Result| IPCClient\n    IPCClient --\u003e|Write to pipe| AskpassMain\n    IPCClient --\u003e|Write to file| EditorMain\n    \n    AskpassMain --\u003e|stdout| AskpassSh\n    EditorMain --\u003e|success/failure| EditorSh\n    \n    AskpassSh --\u003e|credentials| Git\n    EditorSh --\u003e|commit message| Git\n```\n\n**Sources:** [extensions/git/src/ipc/ipcServer.ts:1-100](), [extensions/git/src/ipc/ipcClient.ts:1-50]()\n\n## IPC Server Infrastructure\n\n### IPCServer Class\n\nThe `IPCServer` creates an HTTP server listening on a named pipe (platform-specific socket path). It manages handler registration and request routing.\n\n| Platform | Socket Path Format |\n|----------|-------------------|\n| Windows | `\\\\\\\\.\\\\pipe\\\\vscode-git-{id}-sock` |\n| Linux (XDG) | `$XDG_RUNTIME_DIR/vscode-git-{id}.sock` |\n| macOS/Other | `/tmp/vscode-git-{id}.sock` |\n\n```mermaid\ngraph LR\n    subgraph \"IPCServer Creation\"\n        CreateFn[\"createIPCServer()\"]\n        GenID[\"Generate UUID\"]\n        Socket[\"Create Named Pipe\u003cbr/\u003ePlatform-specific path\"]\n        HTTPServer[\"HTTP Server\u003cbr/\u003ehttp.createServer()\"]\n        Handlers[\"Map\u003cstring, IIPCHandler\u003e\"]\n    end\n    \n    CreateFn --\u003e GenID\n    GenID --\u003e Socket\n    Socket --\u003e HTTPServer\n    HTTPServer --\u003e Handlers\n    \n    subgraph \"Request Handling\"\n        Request[\"HTTP POST\"]\n        Route[\"Route by 'type' field\"]\n        Handler[\"IIPCHandler.handle()\"]\n        Response[\"HTTP 200 + result\"]\n    end\n    \n    Request --\u003e Route\n    Route --\u003e Handler\n    Handler --\u003e Response\n```\n\nThe server provides environment variables for helper processes:\n\n- `VSCODE_GIT_ASKPASS_PIPE`: Socket path for IPC\n- `VSCODE_GIT_ASKPASS_NODE`: Path to Node.js executable\n- `VSCODE_GIT_ASKPASS_MAIN`: Path to helper script entry point\n\n**Sources:** [extensions/git/src/ipc/ipcServer.ts:15-100](), [extensions/git/src/main.ts:66-83]()\n\n### IIPCHandler Interface\n\nHandlers implement the `IIPCHandler` interface to process specific request types:\n\n```typescript\ninterface IIPCHandler {\n    handle(payload: any): Promise\u003cstring\u003e;\n}\n```\n\nThe server routes requests based on the handler name registered via `registerHandler(name, handler)`.\n\n**Sources:** [extensions/git/src/ipc/ipcServer.ts:60-100]()\n\n### IPCClient Class\n\nHelper processes use `IPCClient` to communicate with the server. The client reads the socket path from `VSCODE_GIT_ASKPASS_PIPE` environment variable and sends HTTP POST requests.\n\n```mermaid\ngraph TD\n    Client[\"IPCClient.call(payload)\"]\n    Env[\"Read VSCODE_GIT_ASKPASS_PIPE\"]\n    Connect[\"HTTP POST to socket\"]\n    Wait[\"Wait for response\"]\n    Return[\"Return result string\"]\n    \n    Client --\u003e Env\n    Env --\u003e Connect\n    Connect --\u003e Wait\n    Wait --\u003e Return\n```\n\n**Sources:** [extensions/git/src/ipc/ipcClient.ts:8-50]()\n\n## Askpass System\n\nThe Askpass system handles credential prompts for both HTTPS and SSH Git operations.\n\n### Architecture\n\n```mermaid\ngraph TD\n    subgraph \"Git Environment Setup\"\n        AskpassClass[\"Askpass Class\u003cbr/\u003eIIPCHandler\"]\n        EnvVars[\"Environment Variables\"]\n        AskpassClass --\u003e|provides| EnvVars\n    end\n    \n    subgraph \"Environment Variables\"\n        GIT_ASKPASS[\"GIT_ASKPASS=askpass.sh\"]\n        SSH_ASKPASS[\"SSH_ASKPASS=ssh-askpass.sh\"]\n        ASKPASS_NODE[\"VSCODE_GIT_ASKPASS_NODE\"]\n        ASKPASS_MAIN[\"VSCODE_GIT_ASKPASS_MAIN\"]\n        ASKPASS_PIPE[\"VSCODE_GIT_ASKPASS_PIPE\"]\n    end\n    \n    subgraph \"Shell Scripts\"\n        AskpassSh[\"askpass.sh\"]\n        SshAskpassSh[\"ssh-askpass.sh\"]\n    end\n    \n    subgraph \"Node Entry Point\"\n        AskpassMainTs[\"askpass-main.ts\"]\n        Validation[\"Validate Environment\"]\n        IPCCall[\"IPCClient.call()\"]\n        WriteOutput[\"Write to temp pipe\"]\n    end\n    \n    subgraph \"Askpass Handler\"\n        HandleMethod[\"Askpass.handle()\"]\n        CheckType[\"Check askpassType\"]\n        HandleHTTPS[\"handleAskpass()\"]\n        HandleSSH[\"handleSSHAskpass()\"]\n        CredCache[\"Credentials Cache\"]\n        Providers[\"CredentialsProvider[]\"]\n    end\n    \n    GIT_ASKPASS --\u003e AskpassSh\n    SSH_ASKPASS --\u003e SshAskpassSh\n    \n    AskpassSh --\u003e|spawn| AskpassMainTs\n    SshAskpassSh --\u003e|spawn| AskpassMainTs\n    \n    AskpassMainTs --\u003e Validation\n    Validation --\u003e IPCCall\n    IPCCall --\u003e HandleMethod\n    \n    HandleMethod --\u003e CheckType\n    CheckType --\u003e|https| HandleHTTPS\n    CheckType --\u003e|ssh| HandleSSH\n    \n    HandleHTTPS --\u003e CredCache\n    HandleHTTPS --\u003e Providers\n    HandleSSH --\u003e CredCache\n    HandleSSH --\u003e Providers\n    \n    Providers --\u003e|fallback| VSCodeUI[\"window.showInputBox()\"]\n```\n\n**Sources:** [extensions/git/src/askpass.ts:1-200](), [extensions/git/src/askpass-main.ts:1-44]()\n\n### Askpass Class Implementation\n\nThe `Askpass` class implements `IIPCHandler` and `ITerminalEnvironmentProvider`:\n\n**Key Methods:**\n\n| Method | Purpose |\n|--------|---------|\n| `handle(payload)` | Routes to `handleAskpass()` or `handleSSHAskpass()` based on type |\n| `handleAskpass(argv)` | Handles HTTPS credentials (username/password) |\n| `handleSSHAskpass(argv)` | Handles SSH passphrase prompts |\n| `getEnv()` | Returns environment variables for Git process |\n| `getTerminalEnv()` | Returns environment variables for terminal integration |\n\n**Sources:** [extensions/git/src/askpass.ts:13-150]()\n\n### HTTPS Credential Flow\n\n```mermaid\nsequenceDiagram\n    participant Git\n    participant askpass.sh\n    participant askpass-main\n    participant IPCClient\n    participant Askpass\n    participant Cache\n    participant UI\n    \n    Git-\u003e\u003easkpass.sh: Execute with prompt arg\n    askpass.sh-\u003e\u003easkpass.sh: Create temp pipe\n    askpass.sh-\u003e\u003easkpass-main: Spawn Node.js\n    askpass-main-\u003e\u003easkpass-main: Validate environment\n    askpass-main-\u003e\u003eIPCClient: call({askpassType: 'https', argv})\n    IPCClient-\u003e\u003eAskpass: HTTP POST\n    Askpass-\u003e\u003eAskpass: Parse prompt for host\n    Askpass-\u003e\u003eCache: Check cache\n    \n    alt Cache hit\n        Cache--\u003e\u003eAskpass: Return cached credential\n    else Cache miss\n        Askpass-\u003e\u003eAskpass: Check CredentialsProviders\n        alt Provider available\n            Askpass-\u003e\u003eProvider: getCredentials(host)\n            Provider--\u003e\u003eAskpass: Return credentials\n        else No provider\n            Askpass-\u003e\u003eUI: window.showInputBox()\n            UI--\u003e\u003eAskpass: User input\n        end\n        Askpass-\u003e\u003eCache: Store credential\n    end\n    \n    Askpass--\u003e\u003eIPCClient: Return credential\n    IPCClient--\u003e\u003easkpass-main: HTTP response\n    askpass-main-\u003e\u003easkpass.sh: Write to temp pipe\n    askpass.sh-\u003e\u003easkpass.sh: Cat temp pipe\n    askpass.sh-\u003e\u003eGit: Output credential\n```\n\n**Sources:** [extensions/git/src/askpass.ts:60-150](), [extensions/git/src/askpass-main.ts:15-41]()\n\n### SSH Passphrase Flow\n\nFor SSH operations, Git uses `SSH_ASKPASS` instead of `GIT_ASKPASS`. The flow is similar but simpler:\n\n1. Git spawns `ssh-askpass.sh` with the prompt text\n2. The shell script spawns `askpass-main.ts` with `VSCODE_GIT_ASKPASS_TYPE=ssh`\n3. `Askpass.handleSSHAskpass()` shows an input box for the passphrase\n4. No caching is performed for SSH passphrases\n\n**Sources:** [extensions/git/src/askpass.ts:120-150](), [extensions/git/src/ssh-askpass.sh:1-6]()\n\n### Credentials Provider API\n\nExtensions can register custom credential providers via the API:\n\n```typescript\nexport interface CredentialsProvider {\n    getCredentials(host: Uri): ProviderResult\u003cCredentials\u003e;\n}\n\nexport interface Credentials {\n    readonly username: string;\n    readonly password: string;\n}\n```\n\nThe Askpass system attempts registered providers before falling back to VS Code's input box.\n\n**Sources:** [extensions/git/src/askpass.ts:140-165](), [extensions/git/src/api/git.d.ts:339-346]()\n\n## GitEditor System\n\nThe GitEditor system redirects Git's commit message editing to VS Code's editor instead of launching an external editor.\n\n### Architecture\n\n```mermaid\ngraph TD\n    subgraph \"GitEditor Class\"\n        EditorClass[\"GitEditor\u003cbr/\u003eIIPCHandler\"]\n        EditorEnv[\"Environment Variables\"]\n        EditorClass --\u003e|provides| EditorEnv\n    end\n    \n    subgraph \"Environment Variables\"\n        GIT_EDITOR[\"GIT_EDITOR=git-editor.sh\"]\n        EDITOR_NODE[\"VSCODE_GIT_ASKPASS_NODE\"]\n        EDITOR_MAIN[\"VSCODE_GIT_ASKPASS_MAIN\"]\n        EDITOR_PIPE[\"VSCODE_GIT_ASKPASS_PIPE\"]\n    end\n    \n    subgraph \"Shell Script\"\n        EditorSh[\"git-editor.sh\"]\n    end\n    \n    subgraph \"Node Entry Point\"\n        EditorMainTs[\"git-editor-main.ts\"]\n        ValidateEnv[\"Validate Environment\"]\n        SendFile[\"IPCClient.call(file)\"]\n        WaitResult[\"Wait for edit result\"]\n    end\n    \n    subgraph \"GitEditor Handler\"\n        HandleEdit[\"GitEditor.handle(file)\"]\n        CheckEnabled[\"Check git.enabled\"]\n        CheckSCM[\"Find repository\"]\n        OpenDoc[\"workspace.openTextDocument()\"]\n        ShowEditor[\"window.showTextDocument()\"]\n        WaitClose[\"onDidCloseTextDocument\"]\n        SaveCheck[\"Check if saved\"]\n    end\n    \n    GIT_EDITOR --\u003e EditorSh\n    EditorSh --\u003e|spawn with file arg| EditorMainTs\n    \n    EditorMainTs --\u003e ValidateEnv\n    ValidateEnv --\u003e SendFile\n    SendFile --\u003e HandleEdit\n    \n    HandleEdit --\u003e CheckEnabled\n    CheckEnabled --\u003e CheckSCM\n    CheckSCM --\u003e OpenDoc\n    OpenDoc --\u003e ShowEditor\n    ShowEditor --\u003e WaitClose\n    WaitClose --\u003e SaveCheck\n    SaveCheck --\u003e|saved| Success[\"Return success\"]\n    SaveCheck --\u003e|not saved| Failure[\"Return failure\"]\n    \n    Success --\u003e WaitResult\n    Failure --\u003e WaitResult\n    WaitResult --\u003e EditorSh\n```\n\n**Sources:** [extensions/git/src/gitEditor.ts:1-150]()\n\n### Commit Message Editing Flow\n\n```mermaid\nsequenceDiagram\n    participant Git\n    participant git-editor.sh\n    participant git-editor-main\n    participant GitEditor\n    participant VSCode\n    participant User\n    \n    Git-\u003e\u003egit-editor.sh: Execute with COMMIT_EDITMSG path\n    git-editor.sh-\u003e\u003egit-editor-main: Spawn Node.js with file path\n    git-editor-main-\u003e\u003egit-editor-main: Read environment\n    git-editor-main-\u003e\u003eGitEditor: IPCClient.call(file)\n    GitEditor-\u003e\u003eGitEditor: Extract file path\n    GitEditor-\u003e\u003eVSCode: workspace.openTextDocument(file)\n    GitEditor-\u003e\u003eVSCode: window.showTextDocument()\n    \n    Note over VSCode,User: Editor opens in VS Code\n    \n    User-\u003e\u003eVSCode: Edit commit message\n    User-\u003e\u003eVSCode: Save and close OR just close\n    \n    VSCode-\u003e\u003eGitEditor: onDidCloseTextDocument event\n    GitEditor-\u003e\u003eGitEditor: Check if document was saved\n    \n    alt Document saved\n        GitEditor--\u003e\u003egit-editor-main: Return \"success\"\n        git-editor-main--\u003e\u003egit-editor.sh: Exit code 0\n        git-editor.sh--\u003e\u003eGit: Success\n    else Document not saved (cancelled)\n        GitEditor--\u003e\u003egit-editor-main: Return \"fail\"\n        git-editor-main--\u003e\u003egit-editor.sh: Exit code 1\n        git-editor.sh--\u003e\u003eGit: Failure\n        Git-\u003e\u003eGit: Abort commit\n    end\n```\n\n**Sources:** [extensions/git/src/gitEditor.ts:40-120]()\n\n### GitEditor Class Implementation\n\n**Key Methods:**\n\n| Method | Purpose |\n|--------|---------|\n| `handle(file)` | Opens the specified file in VS Code editor |\n| `getEnv()` | Returns `GIT_EDITOR` environment variable |\n| `getTerminalEnv()` | Returns environment for terminal integration |\n\nThe editor waits for the document to be closed, then checks if it was saved. If not saved, the commit is aborted.\n\n**Sources:** [extensions/git/src/gitEditor.ts:20-100]()\n\n### Document Link Provider\n\nThe `GitEditorDocumentLinkProvider` adds clickable links in commit message files:\n\n- Repository paths like `[git/src/repository.ts:123]()` become clickable\n- Links open the referenced file at the specified line\n\n**Sources:** [extensions/git/src/gitEditor.ts:100-150]()\n\n## Integration with Git Operations\n\nThe IPC system is initialized during extension activation and integrated into Git operations:\n\n### Initialization Flow\n\n```mermaid\ngraph TD\n    Activate[\"activate()\u003cbr/\u003emain.ts\"]\n    CreateModel[\"createModel()\"]\n    CreateIPC[\"createIPCServer()\"]\n    CreateAskpass[\"new Askpass(ipcServer)\"]\n    CreateEditor[\"new GitEditor(ipcServer)\"]\n    CombineEnv[\"Combine environments\"]\n    CreateGit[\"new Git(env)\"]\n    CreateTermMgr[\"TerminalEnvironmentManager\"]\n    \n    Activate --\u003e CreateModel\n    CreateModel --\u003e CreateIPC\n    CreateIPC --\u003e CreateAskpass\n    CreateIPC --\u003e CreateEditor\n    \n    CreateAskpass --\u003e|getEnv()| CombineEnv\n    CreateEditor --\u003e|getEnv()| CombineEnv\n    CreateIPC --\u003e|getEnv()| CombineEnv\n    \n    CombineEnv --\u003e CreateGit\n    \n    CreateAskpass --\u003e CreateTermMgr\n    CreateEditor --\u003e CreateTermMgr\n    CreateIPC --\u003e CreateTermMgr\n```\n\n**Sources:** [extensions/git/src/main.ts:40-140]()\n\n### Environment Variable Setup\n\nThe Git class receives combined environment variables from all IPC components:\n\n```typescript\nconst environment = {\n    ...askpass.getEnv(),\n    ...gitEditor.getEnv(),\n    ...ipcServer?.getEnv()\n};\n\nconst git = new Git({\n    gitPath: info.path,\n    version: info.version,\n    env: environment\n});\n```\n\nThese environment variables are inherited by all Git child processes spawned by the extension.\n\n**Sources:** [extensions/git/src/main.ts:80-91]()\n\n### Terminal Integration\n\nThe `TerminalEnvironmentManager` ensures that Git commands run in VS Code's integrated terminal also have access to the IPC helper processes:\n\n```mermaid\ngraph LR\n    TermMgr[\"TerminalEnvironmentManager\"]\n    Providers[\"ITerminalEnvironmentProvider[]\"]\n    EnvCollection[\"context.environmentVariableCollection\"]\n    Terminal[\"Integrated Terminal\"]\n    \n    TermMgr --\u003e Providers\n    Providers --\u003e|getTerminalEnv()| TermMgr\n    TermMgr --\u003e|set()| EnvCollection\n    EnvCollection --\u003e|inherited by| Terminal\n```\n\nThis allows users to run Git commands manually in the terminal and still get VS Code prompts for credentials.\n\n**Sources:** [extensions/git/src/terminal.ts:15-60](), [extensions/git/src/main.ts:81-82]()\n\n## Error Handling and Fallback\n\n### Empty Helpers\n\nIf IPC server creation fails, the extension falls back to empty helper scripts that immediately return empty strings:\n\n- `askpass-empty.sh`: Simply echoes empty string\n- `ssh-askpass-empty.sh`: Simply echoes empty string\n\nThis prevents Git operations from hanging indefinitely waiting for input.\n\n**Sources:** [extensions/git/src/askpass-empty.sh:1-2](), [extensions/git/src/ssh-askpass-empty.sh:1-2](), [extensions/git/src/main.ts:66-75]()\n\n### Silent Fetch Operations\n\nAskpass main validates `VSCODE_GIT_FETCH_SILENT` environment variable and exits early for silent fetch operations to avoid unnecessary credential prompts:\n\n```typescript\nif (process.env['VSCODE_GIT_COMMAND'] === 'fetch' \u0026\u0026 \n    !!process.env['VSCODE_GIT_FETCH_SILENT']) {\n    return fatal('Skip silent fetch commands');\n}\n```\n\n**Sources:** [extensions/git/src/askpass-main.ts:28-30]()\n\n### Configuration Check\n\nBoth Askpass and GitEditor check `git.enabled` configuration before processing requests. If Git is disabled, they return empty responses to allow operations to fail gracefully.\n\n**Sources:** [extensions/git/src/askpass.ts:47-53](), [extensions/git/src/gitEditor.ts:45-50]()\n\n## Summary\n\nThe Git IPC and Helper Processes system provides seamless integration between Git CLI operations and VS Code's UI:\n\n1. **IPC Server**: HTTP server on named pipe for bidirectional communication\n2. **Askpass System**: Handles credential prompts through VS Code UI with caching\n3. **GitEditor System**: Opens commit messages in VS Code editor instead of external editor\n4. **Terminal Integration**: Works for both extension-spawned and user-spawned Git processes\n\nThis architecture allows VS Code to maintain control over user interactions during Git operations while respecting Git's standard extension points (`GIT_ASKPASS`, `GIT_EDITOR`)."])</script><script>self.__next_f.push([1,"52:T7bd3,"])</script><script>self.__next_f.push([1,"# Settings and Preferences\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [src/vs/workbench/api/browser/mainThreadAiSettingsSearch.ts](src/vs/workbench/api/browser/mainThreadAiSettingsSearch.ts)\n- [src/vs/workbench/api/common/extHostAiSettingsSearch.ts](src/vs/workbench/api/common/extHostAiSettingsSearch.ts)\n- [src/vs/workbench/contrib/preferences/browser/keybindingsEditor.ts](src/vs/workbench/contrib/preferences/browser/keybindingsEditor.ts)\n- [src/vs/workbench/contrib/preferences/browser/media/keybindingsEditor.css](src/vs/workbench/contrib/preferences/browser/media/keybindingsEditor.css)\n- [src/vs/workbench/contrib/preferences/browser/media/settingsEditor2.css](src/vs/workbench/contrib/preferences/browser/media/settingsEditor2.css)\n- [src/vs/workbench/contrib/preferences/browser/media/settingsWidgets.css](src/vs/workbench/contrib/preferences/browser/media/settingsWidgets.css)\n- [src/vs/workbench/contrib/preferences/browser/preferences.contribution.ts](src/vs/workbench/contrib/preferences/browser/preferences.contribution.ts)\n- [src/vs/workbench/contrib/preferences/browser/preferencesSearch.ts](src/vs/workbench/contrib/preferences/browser/preferencesSearch.ts)\n- [src/vs/workbench/contrib/preferences/browser/settingsEditor2.ts](src/vs/workbench/contrib/preferences/browser/settingsEditor2.ts)\n- [src/vs/workbench/contrib/preferences/browser/settingsEditorSettingIndicators.ts](src/vs/workbench/contrib/preferences/browser/settingsEditorSettingIndicators.ts)\n- [src/vs/workbench/contrib/preferences/browser/settingsTree.ts](src/vs/workbench/contrib/preferences/browser/settingsTree.ts)\n- [src/vs/workbench/contrib/preferences/browser/settingsTreeModels.ts](src/vs/workbench/contrib/preferences/browser/settingsTreeModels.ts)\n- [src/vs/workbench/contrib/preferences/browser/settingsWidgets.ts](src/vs/workbench/contrib/preferences/browser/settingsWidgets.ts)\n- [src/vs/workbench/contrib/preferences/browser/tocTree.ts](src/vs/workbench/contrib/preferences/browser/tocTree.ts)\n- [src/vs/workbench/contrib/preferences/common/preferences.ts](src/vs/workbench/contrib/preferences/common/preferences.ts)\n- [src/vs/workbench/contrib/preferences/common/preferencesContribution.ts](src/vs/workbench/contrib/preferences/common/preferencesContribution.ts)\n- [src/vs/workbench/services/aiSettingsSearch/common/aiSettingsSearch.ts](src/vs/workbench/services/aiSettingsSearch/common/aiSettingsSearch.ts)\n- [src/vs/workbench/services/aiSettingsSearch/common/aiSettingsSearchService.ts](src/vs/workbench/services/aiSettingsSearch/common/aiSettingsSearchService.ts)\n- [src/vs/workbench/services/preferences/browser/keybindingsEditorModel.ts](src/vs/workbench/services/preferences/browser/keybindingsEditorModel.ts)\n- [src/vs/workbench/services/preferences/browser/preferencesService.ts](src/vs/workbench/services/preferences/browser/preferencesService.ts)\n- [src/vs/workbench/services/preferences/common/preferences.ts](src/vs/workbench/services/preferences/common/preferences.ts)\n- [src/vs/workbench/services/preferences/common/preferencesModels.ts](src/vs/workbench/services/preferences/common/preferencesModels.ts)\n- [src/vs/workbench/services/preferences/test/browser/keybindingsEditorModel.test.ts](src/vs/workbench/services/preferences/test/browser/keybindingsEditorModel.test.ts)\n- [src/vscode-dts/vscode.proposed.aiSettingsSearch.d.ts](src/vscode-dts/vscode.proposed.aiSettingsSearch.d.ts)\n\n\u003c/details\u003e\n\n\n\nThis document covers VS Code's settings and preferences system, which provides UI editors for configuring application settings and keybindings. The system includes the Settings Editor (UI-based configuration), Keybindings Editor (keybinding management), and supporting services for search, persistence, and integration with the configuration system.\n\nFor information about the underlying configuration storage and synchronization, see the Configuration Service documentation. For details on how extensions contribute settings, see [Extension System](#5).\n\n## Architecture Overview\n\nThe settings and preferences system consists of two main editor components backed by shared service infrastructure:\n\n```mermaid\ngraph TB\n    subgraph \"Editor Components\"\n        SettingsEditor2[\"SettingsEditor2\u003cbr/\u003e(settingsEditor2.ts)\"]\n        KeybindingsEditor[\"KeybindingsEditor\u003cbr/\u003e(keybindingsEditor.ts)\"]\n    end\n    \n    subgraph \"Service Layer\"\n        PreferencesService[\"IPreferencesService\u003cbr/\u003e(preferencesService.ts)\"]\n        PreferencesSearchService[\"IPreferencesSearchService\u003cbr/\u003e(preferencesSearch.ts)\"]\n        ConfigService[\"IConfigurationService\"]\n    end\n    \n    subgraph \"Data Models\"\n        Settings2EditorModel[\"Settings2EditorModel\u003cbr/\u003e(preferencesModels.ts)\"]\n        SettingsTreeModel[\"SettingsTreeModel\u003cbr/\u003e(settingsTreeModels.ts)\"]\n        KeybindingsEditorModel[\"KeybindingsEditorModel\u003cbr/\u003e(keybindingsEditorModel.ts)\"]\n    end\n    \n    subgraph \"UI Components\"\n        SettingsTree[\"SettingsTree\u003cbr/\u003e(settingsTree.ts)\"]\n        TOCTree[\"TOCTree\u003cbr/\u003e(tocTree.ts)\"]\n        SettingsWidgets[\"Setting Widgets\u003cbr/\u003e(settingsWidgets.ts)\"]\n    end\n    \n    SettingsEditor2 --\u003e PreferencesService\n    SettingsEditor2 --\u003e PreferencesSearchService\n    SettingsEditor2 --\u003e Settings2EditorModel\n    SettingsEditor2 --\u003e SettingsTree\n    SettingsEditor2 --\u003e TOCTree\n    \n    KeybindingsEditor --\u003e PreferencesService\n    KeybindingsEditor --\u003e KeybindingsEditorModel\n    \n    SettingsTree --\u003e SettingsTreeModel\n    SettingsTree --\u003e SettingsWidgets\n    \n    PreferencesService --\u003e ConfigService\n    PreferencesService --\u003e Settings2EditorModel\n```\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/settingsEditor2.ts:108-347](), [src/vs/workbench/contrib/preferences/browser/keybindingsEditor.ts:74-151](), [src/vs/workbench/services/preferences/browser/preferencesService.ts:55-109]()\n\n## Settings Editor Architecture\n\n### SettingsEditor2 Component\n\nThe `SettingsEditor2` class is the main UI component for the settings editor. It uses a split-view layout with a table of contents (TOC) on the left and a settings tree on the right:\n\n```mermaid\ngraph TB\n    subgraph \"SettingsEditor2 Layout\"\n        HeaderContainer[\"Header Container\u003cbr/\u003eSearch + Target Widget\"]\n        SplitView[\"SplitView\u003cbr/\u003e(Orientation.HORIZONTAL)\"]\n        TOCContainer[\"TOC Tree Container\"]\n        SettingsContainer[\"Settings Tree Container\"]\n    end\n    \n    subgraph \"Search System\"\n        SearchWidget[\"SuggestEnabledInput\u003cbr/\u003e(searchWidget)\"]\n        SearchDelayer[\"Delayer(200ms)\"]\n        SearchProviders[\"Search Providers\u003cbr/\u003e- Local\u003cbr/\u003e- Remote\u003cbr/\u003e- AI\"]\n    end\n    \n    subgraph \"Data Flow\"\n        SearchResultModel[\"SearchResultModel\"]\n        SettingsTreeModel2[\"SettingsTreeModel\"]\n    end\n    \n    HeaderContainer --\u003e SearchWidget\n    SplitView --\u003e TOCContainer\n    SplitView --\u003e SettingsContainer\n    \n    SearchWidget --\u003e SearchDelayer\n    SearchDelayer --\u003e SearchProviders\n    SearchProviders --\u003e SearchResultModel\n    \n    TOCContainer --\u003e TOCTree\n    SettingsContainer --\u003e SettingsTree\n    \n    SettingsTree --\u003e SearchResultModel\n    SettingsTree --\u003e SettingsTreeModel2\n```\n\n**Key Properties:**\n- **Static ID:** `'workbench.editor.settings2'`\n- **Minimum Width:** 500px\n- **TOC Minimum Width:** 100px\n- **Search Debounce:** 200ms\n- **Update Debounce:** Fast (200ms) or Slow (1000ms) depending on setting type\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/settingsEditor2.ts:108-167](), [src/vs/workbench/contrib/preferences/browser/settingsEditor2.ts:457-480]()\n\n### Settings Tree Model\n\nThe settings tree is hierarchical, with groups containing settings elements:\n\n```mermaid\ngraph TB\n    SettingsTreeGroupElement[\"SettingsTreeGroupElement\u003cbr/\u003e- id: string\u003cbr/\u003e- label: string\u003cbr/\u003e- level: number\u003cbr/\u003e- children: SettingsTreeGroupChild[]\"]\n    \n    SettingsTreeSettingElement[\"SettingsTreeSettingElement\u003cbr/\u003e- setting: ISetting\u003cbr/\u003e- value: any\u003cbr/\u003e- scopeValue: any\u003cbr/\u003e- defaultValue: any\u003cbr/\u003e- isConfigured: boolean\u003cbr/\u003e- valueType: SettingValueType\"]\n    \n    SettingsTreeNewExtensionsElement[\"SettingsTreeNewExtensionsElement\u003cbr/\u003e- extensionIds: string[]\"]\n    \n    SettingsTreeGroupElement --\u003e|\"children\"| SettingsTreeSettingElement\n    SettingsTreeGroupElement --\u003e|\"children\"| SettingsTreeGroupElement\n    SettingsTreeGroupElement --\u003e|\"children\"| SettingsTreeNewExtensionsElement\n    \n    SettingsTreeSettingElement --\u003e|\"inspectSelf()\"| InspectResult[\"Inspect Configuration\u003cbr/\u003e- isConfigured\u003cbr/\u003e- targetSelector\u003cbr/\u003e- inspected values\"]\n```\n\n**Value Types** supported by `SettingValueType`:\n- Primitive: `Boolean`, `String`, `Integer`, `Number`, `Enum`, `Null`\n- Complex: `Array`, `Object`, `BooleanObject`, `ComplexObject`\n- Special: `Exclude`, `Include`, `MultilineString`, `LanguageTag`, `ExtensionToggle`\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/settingsTreeModels.ts:40-105](), [src/vs/workbench/contrib/preferences/browser/settingsTreeModels.ts:113-274](), [src/vs/workbench/services/preferences/common/preferences.ts:24-43]()\n\n### Settings Tree Rendering\n\nThe `SettingsTree` uses different renderers for different setting types:\n\n```mermaid\ngraph LR\n    SettingsTree[\"SettingsTree\u003cbr/\u003e(WorkbenchObjectTree)\"]\n    \n    subgraph \"Renderers\"\n        SettingGroupRenderer[\"SettingGroupRenderer\u003cbr/\u003eSETTINGS_ELEMENT_TEMPLATE_ID\"]\n        SettingBoolRenderer[\"SettingBoolRenderer\u003cbr/\u003eSETTINGS_BOOL_TEMPLATE_ID\"]\n        SettingTextRenderer[\"SettingTextRenderer\u003cbr/\u003eSETTINGS_TEXT_TEMPLATE_ID\"]\n        SettingNumberRenderer[\"SettingNumberRenderer\u003cbr/\u003eSETTINGS_NUMBER_TEMPLATE_ID\"]\n        SettingEnumRenderer[\"SettingEnumRenderer\u003cbr/\u003eSETTINGS_ENUM_TEMPLATE_ID\"]\n        SettingArrayRenderer[\"SettingArrayRenderer\u003cbr/\u003eSETTINGS_ARRAY_TEMPLATE_ID\"]\n        SettingObjectRenderer[\"SettingObjectRenderer\u003cbr/\u003eSETTINGS_OBJECT_TEMPLATE_ID\"]\n        SettingComplexRenderer[\"SettingComplexRenderer\u003cbr/\u003eSETTINGS_COMPLEX_TEMPLATE_ID\"]\n    end\n    \n    SettingsTree --\u003e SettingGroupRenderer\n    SettingsTree --\u003e SettingBoolRenderer\n    SettingsTree --\u003e SettingTextRenderer\n    SettingsTree --\u003e SettingNumberRenderer\n    SettingsTree --\u003e SettingEnumRenderer\n    SettingsTree --\u003e SettingArrayRenderer\n    SettingsTree --\u003e SettingObjectRenderer\n    SettingsTree --\u003e SettingComplexRenderer\n```\n\n**Template Structure** (for setting items):\n- Container Element\n- Category + Label Elements\n- Description + Deprecation Warning Elements\n- Control Element (type-specific widget)\n- Validation Message Element\n- Toolbar (for actions like reset/edit)\n- Indicators Label (modified, policy, sync ignored, etc.)\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/settingsTree.ts:761-776](), [src/vs/workbench/contrib/preferences/browser/settingsTree.ts:1415-1530]()\n\n### Setting Widgets\n\nEach setting type has a specialized widget for editing:\n\n| Setting Type | Widget Class | UI Control |\n|--------------|--------------|------------|\n| Boolean | Toggle | `Toggle` checkbox |\n| String | InputBox | `InputBox` (single or multiline) |\n| Number/Integer | InputBox | `InputBox` with number validation |\n| Enum | SelectBox | `SelectBox` dropdown |\n| Array | ListSettingWidget | Custom list with add/remove/edit |\n| Object | ObjectSettingDropdownWidget | Key-value editor |\n| BooleanObject | ObjectSettingCheckboxWidget | Key-checkbox pairs |\n| Exclude/Include | ExcludeSettingWidget / IncludeSettingWidget | Pattern list with when clauses |\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/settingsTree.ts:1415-1530](), [src/vs/workbench/contrib/preferences/browser/settingsWidgets.ts:151-434]()\n\n## Search System\n\nThe settings editor supports multiple search providers that can be used simultaneously:\n\n```mermaid\ngraph TB\n    SearchInput[\"Search Input\u003cbr/\u003e(SuggestEnabledInput)\"]\n    \n    subgraph \"Search Pipeline\"\n        ParseQuery[\"parseQuery()\u003cbr/\u003eExtract filters:\u003cbr/\u003e@tag, @ext, @id, @lang\"]\n        LocalProvider[\"LocalSearchProvider\u003cbr/\u003eSTRING_MATCH\"]\n        RemoteProvider[\"RemoteSearchProvider\u003cbr/\u003eTF_IDF / FILTER_MODEL\"]\n        AiProvider[\"AiSearchProvider\u003cbr/\u003eEMBEDDINGS / LLM_RANKED\"]\n    end\n    \n    subgraph \"Results Processing\"\n        SearchResultModel2[\"SearchResultModel\u003cbr/\u003e- filterMatches\u003cbr/\u003e- exactMatch\u003cbr/\u003e- showAiResults\"]\n        ResultsRanking[\"Rank \u0026 Merge Results\u003cbr/\u003eRemove duplicates\u003cbr/\u003eScore by match type\"]\n    end\n    \n    SearchInput --\u003e ParseQuery\n    ParseQuery --\u003e LocalProvider\n    ParseQuery --\u003e RemoteProvider\n    ParseQuery --\u003e AiProvider\n    \n    LocalProvider --\u003e ResultsRanking\n    RemoteProvider --\u003e ResultsRanking\n    AiProvider --\u003e ResultsRanking\n    \n    ResultsRanking --\u003e SearchResultModel2\n    SearchResultModel2 --\u003e SettingsTree\n```\n\n**Search Match Types** (in order of relevance):\n1. `ExactMatch` - Exact key match\n2. `AllWordsInSettingsLabel` - All search words in label\n3. `ContiguousQueryInSettingId` - Contiguous match in setting ID\n4. `ContiguousWordsInSettingsLabel` - Contiguous words in label\n5. `NonContiguousWordsInSettingsLabel` - Non-contiguous words in label\n6. `DescriptionOrValueMatch` - Match in description or value\n7. `NonContiguousQueryInSettingId` - Non-contiguous in ID\n8. `RemoteMatch` - Remote search result\n9. `LanguageTagSettingMatch` - Language-specific setting match\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/preferencesSearch.ts:79-134](), [src/vs/workbench/contrib/preferences/browser/settingsTreeModels.ts:391-538](), [src/vs/workbench/services/preferences/common/preferences.ts:135-160]()\n\n### Local Search Provider\n\nThe `LocalSearchProvider` performs client-side matching using the `SettingMatches` class:\n\n```mermaid\ngraph LR\n    Query[\"Search Query\"]\n    \n    subgraph \"SettingMatches\"\n        KeyMatch[\"Key Matching\u003cbr/\u003e- matchesWords\u003cbr/\u003e- matchesContiguousSubString\u003cbr/\u003e- matchesCamelCase\"]\n        DescMatch[\"Description Matching\u003cbr/\u003e- matchesWords on description\"]\n        ValueMatch[\"Value Matching\u003cbr/\u003e- Match enum values\u003cbr/\u003e- Match object keys\"]\n        TagMatch[\"Tag Matching\u003cbr/\u003e@tag:tagname\"]\n    end\n    \n    subgraph \"Scoring\"\n        KeyScore[\"Key Match Score\u003cbr/\u003eHigher for exact/contiguous\"]\n        FinalScore[\"Final Match Type\u003cbr/\u003eSettingMatchType enum\"]\n    end\n    \n    Query --\u003e KeyMatch\n    Query --\u003e DescMatch\n    Query --\u003e ValueMatch\n    Query --\u003e TagMatch\n    \n    KeyMatch --\u003e KeyScore\n    DescMatch --\u003e FinalScore\n    ValueMatch --\u003e FinalScore\n    TagMatch --\u003e FinalScore\n    KeyScore --\u003e FinalScore\n```\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/preferencesSearch.ts:79-134](), [src/vs/workbench/contrib/preferences/browser/preferencesSearch.ts:136-249]()\n\n### AI-Powered Search\n\nThe settings editor integrates with AI services for natural language search:\n\n```mermaid\ngraph TB\n    AiSearchToggle[\"AI Search Toggle\u003cbr/\u003e(showAiResultsAction)\"]\n    \n    subgraph \"AI Search Providers\"\n        IAiSettingsSearchService[\"IAiSettingsSearchService\"]\n        ExtensionProvider[\"Extension Provider\u003cbr/\u003e(via API)\"]\n    end\n    \n    subgraph \"Search Stages\"\n        EmbeddingsSearch[\"Embeddings Search\u003cbr/\u003eFast, top K results\"]\n        LLMRanking[\"LLM Ranking\u003cbr/\u003eSlower, reranks results\"]\n    end\n    \n    AiSearchToggle --\u003e|\"enabled\"| IAiSettingsSearchService\n    IAiSettingsSearchService --\u003e ExtensionProvider\n    \n    ExtensionProvider --\u003e|\"startSearch()\"| EmbeddingsSearch\n    ExtensionProvider --\u003e|\"getLLMRankedResults()\"| LLMRanking\n    \n    EmbeddingsSearch --\u003e DisplayResults[\"Display Embeddings Results\u003cbr/\u003e(EMBEDDINGS_SEARCH_PROVIDER_NAME)\"]\n    LLMRanking --\u003e UpdateResults[\"Update with LLM Results\u003cbr/\u003e(LLM_RANKED_SEARCH_PROVIDER_NAME)\"]\n```\n\n**Configuration:**\n- `workbench.settings.enableNaturalLanguageSearch` - Enable AI search\n- `workbench.settings.showAISearchToggle` - Show toggle button in UI\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/settingsEditor2.ts:824-839](), [src/vs/workbench/contrib/preferences/common/preferences.ts:59-67](), [src/vs/workbench/services/aiSettingsSearch/common/aiSettingsSearch.ts:11-42]()\n\n## Keybindings Editor\n\nThe `KeybindingsEditor` provides a table-based interface for managing keyboard shortcuts:\n\n```mermaid\ngraph TB\n    subgraph \"KeybindingsEditor Components\"\n        SearchWidget2[\"KeybindingsSearchWidget\u003cbr/\u003e- Record keys mode\u003cbr/\u003e- Search history\"]\n        ActionsToolbar[\"Action Toolbar\u003cbr/\u003e- Record keys toggle\u003cbr/\u003e- Sort by precedence\u003cbr/\u003e- Clear search\"]\n        KeybindingsTable[\"WorkbenchTable\u003cbr/\u003e- Command column\u003cbr/\u003e- Keybinding column\u003cbr/\u003e- When column\u003cbr/\u003e- Source column\"]\n    end\n    \n    subgraph \"Data Model\"\n        KeybindingsEditorModel2[\"KeybindingsEditorModel\u003cbr/\u003efetch()\u003cbr/\u003eresolve()\"]\n        KeybindingItemEntry[\"IKeybindingItemEntry[]\u003cbr/\u003e- keybinding\u003cbr/\u003e- command\u003cbr/\u003e- when\u003cbr/\u003e- source\"]\n    end\n    \n    subgraph \"Actions\"\n        DefineKeybinding[\"Define Keybinding\u003cbr/\u003eDefineKeybindingWidget\"]\n        DefineWhen[\"Define When Expression\u003cbr/\u003eInline editor\"]\n        RemoveKeybinding[\"Remove Keybinding\"]\n        ResetKeybinding[\"Reset Keybinding\"]\n    end\n    \n    SearchWidget2 --\u003e KeybindingsEditorModel2\n    KeybindingsEditorModel2 --\u003e KeybindingItemEntry\n    KeybindingItemEntry --\u003e KeybindingsTable\n    \n    KeybindingsTable --\u003e DefineKeybinding\n    KeybindingsTable --\u003e DefineWhen\n    KeybindingsTable --\u003e RemoveKeybinding\n    KeybindingsTable --\u003e ResetKeybinding\n```\n\n**Key Features:**\n- **Record Keys Mode:** Captures keyboard input directly in search box\n- **Sort by Precedence:** Shows keybindings in order of priority\n- **Search Filters:** `@source:default`, `@source:user`, `@source:extension`\n- **Context Menu:** Right-click for actions (define, remove, reset, copy)\n- **When Expression Editing:** Inline editing of context key expressions\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/keybindingsEditor.ts:74-152](), [src/vs/workbench/contrib/preferences/browser/keybindingsEditor.ts:360-429](), [src/vs/workbench/contrib/preferences/browser/keybindingsEditor.ts:640-813]()\n\n### Keybindings Search\n\nThe `KeybindingsEditorModel` performs search and filtering:\n\n```mermaid\ngraph LR\n    SearchQuery[\"Search Query\"]\n    \n    subgraph \"KeybindingsEditorModel.fetch()\"\n        ParseSearchValue[\"Parse Search\u003cbr/\u003e- Extract @source filters\u003cbr/\u003e- Extract quoted strings\u003cbr/\u003e- Tokenize words\"]\n        FilterBySource[\"Filter by Source\u003cbr/\u003e- Default\u003cbr/\u003e- User\u003cbr/\u003e- Extension\"]\n        MatchKeybinding[\"Match Keybinding\u003cbr/\u003e- Key chord matching\u003cbr/\u003e- Modifier matching\"]\n        MatchCommand[\"Match Command\u003cbr/\u003e- Command ID\u003cbr/\u003e- Command label\u003cbr/\u003e- Extension name\"]\n        MatchWhen[\"Match When Expression\"]\n    end\n    \n    SearchQuery --\u003e ParseSearchValue\n    ParseSearchValue --\u003e FilterBySource\n    FilterBySource --\u003e MatchKeybinding\n    FilterBySource --\u003e MatchCommand\n    FilterBySource --\u003e MatchWhen\n    \n    MatchKeybinding --\u003e SortResults[\"Sort Results\u003cbr/\u003e- By match score\u003cbr/\u003e- By precedence\"]\n    MatchCommand --\u003e SortResults\n    MatchWhen --\u003e SortResults\n```\n\n**Sources:** [src/vs/workbench/services/preferences/browser/keybindingsEditorModel.ts:141-345](), [src/vs/workbench/services/preferences/browser/keybindingsEditorModel.ts:347-571]()\n\n## Preferences Service\n\nThe `IPreferencesService` is the main service interface for managing settings and keybindings:\n\n```mermaid\ngraph TB\n    IPreferencesService[\"IPreferencesService\"]\n    \n    subgraph \"Resource Management\"\n        UserSettings[\"userSettingsResource\u003cbr/\u003eProfile settings URI\"]\n        WorkspaceSettings[\"workspaceSettingsResource\u003cbr/\u003eWorkspace config URI\"]\n        FolderSettings[\"getFolderSettingsResource()\u003cbr/\u003ePer-folder settings\"]\n    end\n    \n    subgraph \"Model Creation\"\n        CreatePrefsModel[\"createPreferencesEditorModel()\u003cbr/\u003eParse JSON settings\"]\n        CreateSettings2Model[\"createSettings2EditorModel()\u003cbr/\u003eSettings2EditorModel\"]\n    end\n    \n    subgraph \"Editor Opening\"\n        OpenSettings[\"openSettings()\u003cbr/\u003eOpen settings editor\"]\n        OpenUserSettings[\"openUserSettings()\"]\n        OpenWorkspaceSettings[\"openWorkspaceSettings()\"]\n        OpenFolderSettings[\"openFolderSettings()\"]\n        OpenKeybindings[\"openGlobalKeybindingSettings()\"]\n    end\n    \n    IPreferencesService --\u003e UserSettings\n    IPreferencesService --\u003e WorkspaceSettings\n    IPreferencesService --\u003e FolderSettings\n    \n    IPreferencesService --\u003e CreatePrefsModel\n    IPreferencesService --\u003e CreateSettings2Model\n    \n    IPreferencesService --\u003e OpenSettings\n    IPreferencesService --\u003e OpenUserSettings\n    IPreferencesService --\u003e OpenWorkspaceSettings\n    IPreferencesService --\u003e OpenFolderSettings\n    IPreferencesService --\u003e OpenKeybindings\n```\n\n**Key Methods:**\n- `openSettings(options)` - Open settings UI or JSON based on options\n- `getEditableSettingsURI(target, resource)` - Get URI for target settings file\n- `createSettings2EditorModel()` - Create model for Settings Editor 2\n- `getSetting(settingId)` - Get setting definition by ID\n\n**Sources:** [src/vs/workbench/services/preferences/common/preferences.ts:249-281](), [src/vs/workbench/services/preferences/browser/preferencesService.ts:55-109]()\n\n### Settings Editor Input\n\nThe settings editor uses specialized input types:\n\n```mermaid\ngraph LR\n    subgraph \"Editor Inputs\"\n        SettingsEditor2Input[\"SettingsEditor2Input\u003cbr/\u003eUI-based editor\"]\n        PreferencesEditorInput[\"PreferencesEditorInput\u003cbr/\u003eSplit JSON editor\u003cbr/\u003e(SideBySideEditorInput)\"]\n        KeybindingsEditorInput[\"KeybindingsEditorInput\u003cbr/\u003eKeybindings table\"]\n    end\n    \n    subgraph \"Configuration\"\n        UseSplitJson[\"workbench.settings.useSplitJSON\u003cbr/\u003e(default: false)\"]\n        DefaultEditor[\"workbench.settings.editor\u003cbr/\u003e('ui' | 'json')\"]\n    end\n    \n    UseSplitJson --\u003e|\"true\"| PreferencesEditorInput\n    UseSplitJson --\u003e|\"false\"| SettingsEditor2Input\n    DefaultEditor --\u003e SettingsEditor2Input\n    \n    PreferencesEditorInput --\u003e|\"primary\"| DefaultSettings[\"Default Settings\u003cbr/\u003e(read-only)\"]\n    PreferencesEditorInput --\u003e|\"secondary\"| UserSettings2[\"User Settings\u003cbr/\u003e(editable JSON)\"]\n```\n\n**Sources:** [src/vs/workbench/services/preferences/common/preferencesEditorInput.ts:1-50](), [src/vs/workbench/contrib/preferences/common/preferencesContribution.ts:25-122]()\n\n## Settings Data Models\n\n### Settings2EditorModel\n\nThe `Settings2EditorModel` is the main data model for the UI-based settings editor:\n\n```mermaid\ngraph TB\n    Settings2EditorModel2[\"Settings2EditorModel\"]\n    \n    subgraph \"Data Sources\"\n        DefaultSettings2[\"DefaultSettings\u003cbr/\u003e- All registered settings\u003cbr/\u003e- Grouped by category\"]\n        ConfigService2[\"IConfigurationService\u003cbr/\u003e- User values\u003cbr/\u003e- Workspace values\u003cbr/\u003e- Default values\"]\n        Registry[\"IConfigurationRegistry\u003cbr/\u003e- Schema definitions\u003cbr/\u003e- Extension contributions\"]\n    end\n    \n    subgraph \"Group Structure\"\n        CommonlyUsed[\"Commonly Used Group\u003cbr/\u003eTop 10 settings\"]\n        TOCGroups[\"TOC-based Groups\u003cbr/\u003eFrom tocData\"]\n        ExtensionGroups[\"Extension Groups\u003cbr/\u003ePer-extension settings\"]\n    end\n    \n    subgraph \"Operations\"\n        FilterSettings[\"filterSettings()\u003cbr/\u003eMatch settings by query\"]\n        UpdateResultGroup[\"updateResultGroup()\u003cbr/\u003eMerge search results\"]\n        GetPreference[\"getPreference()\u003cbr/\u003eGet setting by key\"]\n    end\n    \n    Settings2EditorModel2 --\u003e DefaultSettings2\n    Settings2EditorModel2 --\u003e ConfigService2\n    Settings2EditorModel2 --\u003e Registry\n    \n    DefaultSettings2 --\u003e CommonlyUsed\n    DefaultSettings2 --\u003e TOCGroups\n    DefaultSettings2 --\u003e ExtensionGroups\n    \n    Settings2EditorModel2 --\u003e FilterSettings\n    Settings2EditorModel2 --\u003e UpdateResultGroup\n    Settings2EditorModel2 --\u003e GetPreference\n```\n\n**Sources:** [src/vs/workbench/services/preferences/common/preferencesModels.ts:211-282](), [src/vs/workbench/services/preferences/common/preferencesModels.ts:30-120]()\n\n### ISetting Interface\n\nEach setting in the tree is represented by the `ISetting` interface:\n\n**Key Properties:**\n- `key: string` - Setting identifier (e.g., `\"editor.fontSize\"`)\n- `value: any` - Current value\n- `type: string | string[]` - JSON schema type(s)\n- `description: string[]` - Markdown description lines\n- `scope: ConfigurationScope` - Application, Window, Resource, or Language Overridable\n- `enum?: string[]` - Enumeration values\n- `enumDescriptions?: string[]` - Descriptions for enum values\n- `objectProperties?: IJSONSchemaMap` - For object-type settings\n- `tags?: string[]` - Tags like \"experimental\", \"preview\", \"usesOnlineServices\"\n- `restricted?: boolean` - Requires workspace trust\n- `order?: number` - Display order within group\n\n**Sources:** [src/vs/workbench/services/preferences/common/preferences.ts:60-102]()\n\n## Table of Contents (TOC) Tree\n\nThe TOC provides navigation for the settings editor:\n\n```mermaid\ngraph TB\n    TOCTree[\"TOCTree\u003cbr/\u003e(WorkbenchObjectTree)\"]\n    TOCTreeModel2[\"TOCTreeModel\"]\n    \n    subgraph \"TOC Data\"\n        TocData[\"tocData\u003cbr/\u003eStatic category structure\"]\n        SettingsGroups[\"settingsTreeRoot.children\u003cbr/\u003eDynamic groups from model\"]\n        SearchModel[\"currentSearchModel\u003cbr/\u003eSearch result groups\"]\n    end\n    \n    subgraph \"TOC Elements\"\n        TOCCategoryElement[\"Category Entry\u003cbr/\u003e- id\u003cbr/\u003e- label\u003cbr/\u003e- children\"]\n        TOCSettingsCount[\"Settings Count\u003cbr/\u003e(in search mode)\"]\n    end\n    \n    TOCTree --\u003e TOCTreeModel2\n    TOCTreeModel2 --\u003e TocData\n    TOCTreeModel2 --\u003e SettingsGroups\n    TOCTreeModel2 --\u003e SearchModel\n    \n    TocData --\u003e TOCCategoryElement\n    SettingsGroups --\u003e TOCCategoryElement\n    SearchModel --\u003e TOCSettingsCount\n```\n\n**TOC Behavior:**\n- In normal mode: Shows full category hierarchy\n- In search mode: Shows only categories with matching settings and result counts\n- Selection syncs with settings tree scroll position\n- Sticky scroll shows current category in settings tree header\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/tocTree.ts:29-102](), [src/vs/workbench/contrib/preferences/browser/settingsEditor2.ts:843-976]()\n\n## Configuration Integration\n\nThe settings editor integrates with the configuration system:\n\n```mermaid\ngraph LR\n    SettingsEditor[\"Settings Editor\"]\n    \n    subgraph \"Configuration Service\"\n        IWorkbenchConfigurationService2[\"IWorkbenchConfigurationService\"]\n        InspectConfig[\"inspect(key, overrides)\u003cbr/\u003eGet values per scope\"]\n        UpdateConfig[\"updateValue(key, value, target)\u003cbr/\u003eWrite to config file\"]\n    end\n    \n    subgraph \"Configuration Targets\"\n        UserLocal[\"User (Local)\u003cbr/\u003esettings.json\"]\n        UserRemote[\"User (Remote)\u003cbr/\u003esettings.json\"]\n        Workspace[\"Workspace\u003cbr/\u003e.vscode/settings.json\"]\n        WorkspaceFolder[\"Workspace Folder\u003cbr/\u003e.vscode/settings.json\"]\n        Application[\"Application\u003cbr/\u003eProfiles\"]\n    end\n    \n    subgraph \"Language Overrides\"\n        LanguageSpecific[\"Language-Specific\u003cbr/\u003e[language-id]\"]\n    end\n    \n    SettingsEditor --\u003e InspectConfig\n    SettingsEditor --\u003e UpdateConfig\n    \n    InspectConfig --\u003e UserLocal\n    InspectConfig --\u003e UserRemote\n    InspectConfig --\u003e Workspace\n    InspectConfig --\u003e WorkspaceFolder\n    InspectConfig --\u003e Application\n    \n    UpdateConfig --\u003e UserLocal\n    UpdateConfig --\u003e UserRemote\n    UpdateConfig --\u003e Workspace\n    UpdateConfig --\u003e WorkspaceFolder\n    \n    InspectConfig --\u003e LanguageSpecific\n    UpdateConfig --\u003e LanguageSpecific\n```\n\n**Configuration Flow:**\n1. User edits setting in UI widget\n2. Widget fires `onDidChangeList` or similar event\n3. Settings editor calls `updateValue()` on configuration service\n4. Configuration service writes to appropriate JSON file\n5. Configuration change event fires\n6. Settings tree model re-inspects and updates display\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/settingsEditor2.ts:1463-1572](), [src/vs/workbench/contrib/preferences/browser/settingsTreeModels.ts:276-390]()\n\n## Extension API for Settings Search\n\nExtensions can contribute AI-powered settings search through the proposed API:\n\n```mermaid\ngraph TB\n    Extension[\"Extension\"]\n    \n    subgraph \"Extension API\"\n        RegisterProvider[\"vscode.ai.registerSettingsSearchProvider()\"]\n        ProviderInterface[\"SettingsSearchProvider\u003cbr/\u003e- provideSettingsSearchResults()\"]\n    end\n    \n    subgraph \"Extension Host\"\n        ExtHostAiSettingsSearch[\"ExtHostAiSettingsSearch\"]\n    end\n    \n    subgraph \"Main Thread\"\n        MainThreadAiSettingsSearch[\"MainThreadAiSettingsSearch\"]\n        IAiSettingsSearchService2[\"IAiSettingsSearchService\"]\n    end\n    \n    subgraph \"Settings Editor\"\n        AiProvider2[\"AiSearchProvider\u003cbr/\u003egetEmbeddingsResults()\u003cbr/\u003egetLLMRankedResults()\"]\n    end\n    \n    Extension --\u003e RegisterProvider\n    RegisterProvider --\u003e ProviderInterface\n    ProviderInterface --\u003e ExtHostAiSettingsSearch\n    ExtHostAiSettingsSearch --\u003e|\"RPC\"| MainThreadAiSettingsSearch\n    MainThreadAiSettingsSearch --\u003e IAiSettingsSearchService2\n    IAiSettingsSearchService2 --\u003e AiProvider2\n    AiProvider2 --\u003e SettingsEditor\n```\n\n**API Interface:**\n- `SettingsSearchProvider.provideSettingsSearchResults(query, options, progress, token)`\n  - `query: string` - User's search query\n  - `options.limit: number` - Max results to return\n  - `options.embeddingsOnly: boolean` - Only embeddings search, no LLM ranking\n  - `progress: Progress\u003cSettingsSearchResult\u003e` - Report results incrementally\n  - Returns: `Thenable\u003cvoid\u003e`\n\n**Result Types:**\n- `EMBEDDED` - Fast embeddings search results\n- `LLM_RANKED` - Slower, more accurate LLM-ranked results\n- `CANCELED` - Search was canceled\n\n**Sources:** [src/vscode-dts/vscode.proposed.aiSettingsSearch.d.ts:1-32](), [src/vs/workbench/api/common/extHostAiSettingsSearch.ts:15-47](), [src/vs/workbench/api/browser/mainThreadAiSettingsSearch.ts:11-44]()\n\n## Focus Management\n\nThe settings editor manages keyboard navigation across multiple UI areas:\n\n```mermaid\ngraph LR\n    subgraph \"Focus Contexts\"\n        SearchFocus[\"Search\u003cbr/\u003eCONTEXT_SETTINGS_SEARCH_FOCUS\"]\n        TOCFocus[\"TOC\u003cbr/\u003eCONTEXT_TOC_ROW_FOCUS\"]\n        SettingsTreeFocus[\"Settings Tree\u003cbr/\u003eCONTEXT_SETTINGS_ROW_FOCUS\"]\n        ControlFocus[\"Setting Control\u003cbr/\u003eInput/Select/etc\"]\n    end\n    \n    subgraph \"Navigation\"\n        TabKey[\"Tab / Shift+Tab\"]\n        ArrowKeys[\"Arrow Keys\"]\n        EscapeKey[\"Escape\"]\n    end\n    \n    TabKey --\u003e SearchFocus\n    TabKey --\u003e TOCFocus\n    SearchFocus --\u003e TOCFocus\n    TOCFocus --\u003e SettingsTreeFocus\n    SettingsTreeFocus --\u003e ControlFocus\n    \n    ArrowKeys --\u003e TOCFocus\n    ArrowKeys --\u003e SettingsTreeFocus\n    \n    EscapeKey --\u003e SearchFocus\n```\n\n**Context Keys:**\n- `CONTEXT_SETTINGS_EDITOR` - In settings editor\n- `CONTEXT_SETTINGS_SEARCH_FOCUS` - Search box focused\n- `CONTEXT_TOC_ROW_FOCUS` - TOC tree focused\n- `CONTEXT_SETTINGS_ROW_FOCUS` - Settings tree focused\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/settingsEditor2.ts:609-688](), [src/vs/workbench/contrib/preferences/common/preferences.ts:68-78]()\n\n## Setting Indicators\n\nSettings display indicators for various states:\n\n| Indicator | Meaning | Display |\n|-----------|---------|---------|\n| Modified | Value differs from default | Blue bar on left edge |\n| Policy | Set by organization policy | Lock icon |\n| Workspace Trust | Requires trusted workspace | Shield icon |\n| Sync Ignored | Not synced across devices | Cloud with slash icon |\n| Scope Override | Overridden in another scope | \"Also modified in...\" label |\n| Default Override | Language-specific default | Source extension name |\n| Preview | Experimental feature | \"Preview\" badge |\n| Advanced | Advanced setting | \"Advanced\" label (when filtered) |\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/settingsEditorSettingIndicators.ts:39-286](), [src/vs/workbench/contrib/preferences/browser/settingsEditor2.ts:1-75]()"])</script><script>self.__next_f.push([1,"53:T9500,"])</script><script>self.__next_f.push([1,"# Settings Editor Architecture\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [src/vs/workbench/api/browser/mainThreadAiSettingsSearch.ts](src/vs/workbench/api/browser/mainThreadAiSettingsSearch.ts)\n- [src/vs/workbench/api/common/extHostAiSettingsSearch.ts](src/vs/workbench/api/common/extHostAiSettingsSearch.ts)\n- [src/vs/workbench/contrib/preferences/browser/keybindingsEditor.ts](src/vs/workbench/contrib/preferences/browser/keybindingsEditor.ts)\n- [src/vs/workbench/contrib/preferences/browser/media/keybindingsEditor.css](src/vs/workbench/contrib/preferences/browser/media/keybindingsEditor.css)\n- [src/vs/workbench/contrib/preferences/browser/media/settingsEditor2.css](src/vs/workbench/contrib/preferences/browser/media/settingsEditor2.css)\n- [src/vs/workbench/contrib/preferences/browser/media/settingsWidgets.css](src/vs/workbench/contrib/preferences/browser/media/settingsWidgets.css)\n- [src/vs/workbench/contrib/preferences/browser/preferences.contribution.ts](src/vs/workbench/contrib/preferences/browser/preferences.contribution.ts)\n- [src/vs/workbench/contrib/preferences/browser/preferencesSearch.ts](src/vs/workbench/contrib/preferences/browser/preferencesSearch.ts)\n- [src/vs/workbench/contrib/preferences/browser/settingsEditor2.ts](src/vs/workbench/contrib/preferences/browser/settingsEditor2.ts)\n- [src/vs/workbench/contrib/preferences/browser/settingsEditorSettingIndicators.ts](src/vs/workbench/contrib/preferences/browser/settingsEditorSettingIndicators.ts)\n- [src/vs/workbench/contrib/preferences/browser/settingsTree.ts](src/vs/workbench/contrib/preferences/browser/settingsTree.ts)\n- [src/vs/workbench/contrib/preferences/browser/settingsTreeModels.ts](src/vs/workbench/contrib/preferences/browser/settingsTreeModels.ts)\n- [src/vs/workbench/contrib/preferences/browser/settingsWidgets.ts](src/vs/workbench/contrib/preferences/browser/settingsWidgets.ts)\n- [src/vs/workbench/contrib/preferences/browser/tocTree.ts](src/vs/workbench/contrib/preferences/browser/tocTree.ts)\n- [src/vs/workbench/contrib/preferences/common/preferences.ts](src/vs/workbench/contrib/preferences/common/preferences.ts)\n- [src/vs/workbench/contrib/preferences/common/preferencesContribution.ts](src/vs/workbench/contrib/preferences/common/preferencesContribution.ts)\n- [src/vs/workbench/services/aiSettingsSearch/common/aiSettingsSearch.ts](src/vs/workbench/services/aiSettingsSearch/common/aiSettingsSearch.ts)\n- [src/vs/workbench/services/aiSettingsSearch/common/aiSettingsSearchService.ts](src/vs/workbench/services/aiSettingsSearch/common/aiSettingsSearchService.ts)\n- [src/vs/workbench/services/preferences/browser/keybindingsEditorModel.ts](src/vs/workbench/services/preferences/browser/keybindingsEditorModel.ts)\n- [src/vs/workbench/services/preferences/browser/preferencesService.ts](src/vs/workbench/services/preferences/browser/preferencesService.ts)\n- [src/vs/workbench/services/preferences/common/preferences.ts](src/vs/workbench/services/preferences/common/preferences.ts)\n- [src/vs/workbench/services/preferences/common/preferencesModels.ts](src/vs/workbench/services/preferences/common/preferencesModels.ts)\n- [src/vs/workbench/services/preferences/test/browser/keybindingsEditorModel.test.ts](src/vs/workbench/services/preferences/test/browser/keybindingsEditorModel.test.ts)\n- [src/vscode-dts/vscode.proposed.aiSettingsSearch.d.ts](src/vscode-dts/vscode.proposed.aiSettingsSearch.d.ts)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis document describes the architecture of VS Code's Settings Editor (UI), a graphical interface for viewing and modifying user settings. The Settings Editor is implemented as `SettingsEditor2` and provides a tree-based view of configuration options with search, filtering, and type-specific editing widgets.\n\nFor information about the JSON-based settings editing experience, see [11.2](#11.2). For keybindings editing, see [11.3](#11.3). For the underlying preferences service and models, see [11.4](#11.4).\n\n---\n\n## Overview\n\nThe Settings Editor provides a user-friendly alternative to editing `settings.json` directly. It displays all available settings in a hierarchical tree structure with a table of contents (TOC), search functionality, and specialized UI widgets for different setting types.\n\n**Key Features:**\n- Tree-based settings display organized by categories\n- Table of contents navigation\n- Multi-provider search (local string matching, TF-IDF, AI-powered)\n- Type-specific renderers for boolean, string, enum, object, array settings\n- Extension-contributed settings integration\n- Workspace trust and policy indicators\n- Settings synchronization status\n\n**Main Components:**\n```mermaid\ngraph TB\n    subgraph \"SettingsEditor2\"\n        Editor[\"SettingsEditor2\u003cbr/\u003e(EditorPane)\"]\n        SearchWidget[\"SuggestEnabledInput\u003cbr/\u003eSearch Box\"]\n        SplitView[\"SplitView\u003cbr/\u003eLayout Container\"]\n    end\n    \n    subgraph \"Left Side - TOC\"\n        TOCTree[\"TOCTree\u003cbr/\u003e(WorkbenchObjectTree)\"]\n        TOCModel[\"TOCTreeModel\u003cbr/\u003eTOC Data\"]\n    end\n    \n    subgraph \"Right Side - Settings\"\n        SettingsTree[\"SettingsTree\u003cbr/\u003e(WorkbenchObjectTree)\"]\n        TreeModel[\"SettingsTreeModel\u003cbr/\u003eSettings Data\"]\n        SearchModel[\"SearchResultModel\u003cbr/\u003eFiltered Results\"]\n        Renderers[\"SettingTreeRenderers\u003cbr/\u003eType-Specific UI\"]\n    end\n    \n    subgraph \"Data Sources\"\n        DefaultSettings[\"Settings2EditorModel\u003cbr/\u003eDefault Settings\"]\n        ConfigService[\"IWorkbenchConfigurationService\u003cbr/\u003eConfig Values\"]\n        SearchProviders[\"IPreferencesSearchService\u003cbr/\u003eSearch Providers\"]\n    end\n    \n    Editor --\u003e SearchWidget\n    Editor --\u003e SplitView\n    SplitView --\u003e TOCTree\n    SplitView --\u003e SettingsTree\n    \n    TOCTree --\u003e TOCModel\n    SettingsTree --\u003e TreeModel\n    SettingsTree --\u003e SearchModel\n    SettingsTree --\u003e Renderers\n    \n    TreeModel --\u003e DefaultSettings\n    TreeModel --\u003e ConfigService\n    SearchModel --\u003e SearchProviders\n    SearchModel --\u003e TreeModel\n    \n    TOCModel -.syncs with.-\u003e SettingsTree\n```\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/settingsEditor2.ts:108-456](), [src/vs/workbench/contrib/preferences/browser/settingsTree.ts:1-100](), [src/vs/workbench/contrib/preferences/browser/tocTree.ts:1-50]()\n\n---\n\n## SettingsEditor2 - Main Editor Class\n\n`SettingsEditor2` extends `EditorPane` and serves as the primary controller for the Settings UI. It manages the lifecycle, layout, and coordination between subcomponents.\n\n### Class Structure\n\n```mermaid\ngraph LR\n    SettingsEditor2 --\u003e EditorPane\n    SettingsEditor2 --\u003e SuggestEnabledInput\n    SettingsEditor2 --\u003e SplitView\n    SettingsEditor2 --\u003e TOCTree\n    SettingsEditor2 --\u003e SettingsTree\n    SettingsEditor2 --\u003e SettingsTargetsWidget\n    SettingsEditor2 --\u003e SettingTreeRenderers\n    \n    SettingsEditor2 -.uses.-\u003e SettingsTreeModel\n    SettingsEditor2 -.uses.-\u003e SearchResultModel\n    SettingsEditor2 -.uses.-\u003e Settings2EditorModel\n```\n\n**Key Properties:**\n\n| Property | Type | Purpose |\n|----------|------|---------|\n| `searchWidget` | `SuggestEnabledInput` | Search input with autocomplete |\n| `splitView` | `SplitView` | Left/right layout container |\n| `tocTree` | `TOCTree` | Table of contents tree |\n| `settingsTree` | `SettingsTree` | Main settings tree |\n| `settingsTreeModel` | `SettingsTreeModel` | Current settings data model |\n| `searchResultModel` | `SearchResultModel` | Filtered search results |\n| `defaultSettingsEditorModel` | `Settings2EditorModel` | Default settings source |\n| `settingRenderers` | `SettingTreeRenderers` | Type-specific renderers |\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/settingsEditor2.ts:108-346](), [src/vs/workbench/contrib/preferences/browser/settingsEditor2.ts:168-244]()\n\n### Initialization Flow\n\n```mermaid\nsequenceDiagram\n    participant Client\n    participant SettingsEditor2\n    participant Settings2EditorModel\n    participant SettingsTreeModel\n    participant SettingsTree\n    \n    Client-\u003e\u003eSettingsEditor2: setInput(input, options)\n    SettingsEditor2-\u003e\u003eSettings2EditorModel: resolve()\n    Settings2EditorModel--\u003e\u003eSettingsEditor2: model\n    SettingsEditor2-\u003e\u003eSettingsEditor2: onConfigUpdate()\n    SettingsEditor2-\u003e\u003eSettingsTreeModel: create with settings groups\n    SettingsTreeModel--\u003e\u003eSettingsEditor2: model instance\n    SettingsEditor2-\u003e\u003eSettingsTree: setInput(model)\n    SettingsTree-\u003e\u003eSettingsTree: render tree\n    SettingsEditor2-\u003e\u003eSettingsEditor2: updateTreeScrollSync()\n```\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/settingsEditor2.ts:482-523](), [src/vs/workbench/contrib/preferences/browser/settingsEditor2.ts:843-943]()\n\n### Layout Management\n\nThe editor uses a `SplitView` with two panes:\n\n**Split View Configuration:**\n- **Left Pane (TOC):** Width = 200px (default), Min = 100px, Hidden when narrow (\u003c700px total width)\n- **Right Pane (Settings):** Flexible width, Min = 500px\n\n```mermaid\ngraph TB\n    subgraph \"SettingsEditor2 Layout\"\n        Header[\"Header Container\u003cbr/\u003e- Search Box\u003cbr/\u003e- Settings Target Selector\u003cbr/\u003e- Action Buttons\"]\n        Body[\"Body Container\u003cbr/\u003e(SplitView)\"]\n        \n        Body --\u003e TOCPane[\"TOC Pane\u003cbr/\u003e- TOCTree\u003cbr/\u003e- Categories/Groups\"]\n        Body --\u003e SettingsPane[\"Settings Pane\u003cbr/\u003e- SettingsTree\u003cbr/\u003e- Setting Items\"]\n    end\n    \n    style Header fill:#f9f9f9\n    style TOCPane fill:#f0f0f0\n    style SettingsPane fill:#ffffff\n```\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/settingsEditor2.ts:592-607](), [src/vs/workbench/contrib/preferences/browser/settingsEditor2.ts:1148-1210]()\n\n---\n\n## Settings Data Models\n\n### SettingsTreeModel\n\n`SettingsTreeModel` represents the hierarchical structure of settings organized into groups. It maintains the tree state and provides methods for filtering and updating settings.\n\n**Class Hierarchy:**\n```mermaid\ngraph TB\n    SettingsTreeElement[\"SettingsTreeElement\u003cbr/\u003e(Abstract Base)\"]\n    SettingsTreeGroupElement[\"SettingsTreeGroupElement\u003cbr/\u003eCategory/Section\"]\n    SettingsTreeSettingElement[\"SettingsTreeSettingElement\u003cbr/\u003eIndividual Setting\"]\n    SettingsTreeNewExtensionsElement[\"SettingsTreeNewExtensionsElement\u003cbr/\u003eExtension Prompt\"]\n    \n    SettingsTreeElement --\u003e SettingsTreeGroupElement\n    SettingsTreeElement --\u003e SettingsTreeSettingElement\n    SettingsTreeElement --\u003e SettingsTreeNewExtensionsElement\n```\n\n**Key Methods:**\n\n| Method | Purpose |\n|--------|---------|\n| `update()` | Refreshes tree elements from configuration |\n| `updateWorkspaceTrust()` | Updates restricted setting indicators |\n| `getElementsByName()` | Finds settings by key |\n| `treeElementsBySettingName` | Map of setting key  tree element |\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/settingsTreeModels.ts:648-784](), [src/vs/workbench/contrib/preferences/browser/settingsTreeModels.ts:40-105]()\n\n### SettingsTreeSettingElement\n\nRepresents a single setting with its value, metadata, and display properties.\n\n**Key Properties:**\n\n| Property | Type | Description |\n|----------|------|-------------|\n| `setting` | `ISetting` | Setting definition from registry |\n| `value` | `any` | Current effective value |\n| `scopeValue` | `any` | Value in selected scope |\n| `defaultValue` | `any` | Default value |\n| `isConfigured` | `boolean` | Whether user has set a value |\n| `hasPolicyValue` | `boolean` | Whether policy controls this setting |\n| `valueType` | `SettingValueType` | Type for rendering (enum, boolean, string, etc.) |\n| `overriddenScopeList` | `string[]` | Scopes with conflicting values |\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/settingsTreeModels.ts:113-390]()\n\n### SearchResultModel\n\n`SearchResultModel` extends `SettingsTreeModel` to represent filtered search results. It supports multiple search providers and merges their results.\n\n```mermaid\ngraph LR\n    SearchResultModel[\"SearchResultModel\"]\n    StringMatchProvider[\"LocalSearchProvider\u003cbr/\u003eString Matching\"]\n    TFIDFProvider[\"TF-IDF Provider\u003cbr/\u003eRelevance Ranking\"]\n    EmbeddingsProvider[\"AI Embeddings\u003cbr/\u003eSemantic Search\"]\n    LLMProvider[\"LLM Ranked\u003cbr/\u003eAI-Powered Ranking\"]\n    \n    SearchResultModel --\u003e StringMatchProvider\n    SearchResultModel --\u003e TFIDFProvider\n    SearchResultModel --\u003e EmbeddingsProvider\n    SearchResultModel --\u003e LLMProvider\n```\n\n**Search Result Grouping:**\n\nThe model tracks multiple result groups simultaneously, each identified by a provider name:\n\n| Provider ID | Purpose |\n|-------------|---------|\n| `STRING_MATCH_SEARCH_PROVIDER_NAME` | Basic text matching |\n| `TF_IDF_SEARCH_PROVIDER_NAME` | Term frequency analysis |\n| `EMBEDDINGS_SEARCH_PROVIDER_NAME` | AI semantic similarity |\n| `LLM_RANKED_SEARCH_PROVIDER_NAME` | LLM-based ranking |\n| `FILTER_MODEL_SEARCH_PROVIDER_NAME` | Extension filter model |\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/settingsTreeModels.ts:786-1004](), [src/vs/workbench/contrib/preferences/common/preferences.ts:130-190]()\n\n---\n\n## Settings Tree Rendering\n\n### SettingsTree and Renderers\n\n`SettingsTree` is a `WorkbenchObjectTree` that displays settings using type-specific renderers. `SettingTreeRenderers` provides a collection of renderers for different setting types.\n\n**Renderer Architecture:**\n```mermaid\ngraph TB\n    SettingsTree[\"SettingsTree\u003cbr/\u003e(WorkbenchObjectTree)\"]\n    SettingTreeRenderers[\"SettingTreeRenderers\u003cbr/\u003eRenderer Collection\"]\n    \n    subgraph \"Renderer Types\"\n        BoolRenderer[\"SettingBoolRenderer\u003cbr/\u003eToggle/Checkbox\"]\n        TextRenderer[\"SettingTextRenderer\u003cbr/\u003eInputBox\"]\n        EnumRenderer[\"SettingEnumRenderer\u003cbr/\u003eSelectBox\"]\n        NumberRenderer[\"SettingNumberRenderer\u003cbr/\u003eNumber Input\"]\n        ArrayRenderer[\"SettingArrayRenderer\u003cbr/\u003eList Widget\"]\n        ObjectRenderer[\"SettingObjectRenderer\u003cbr/\u003eKey-Value Editor\"]\n        ComplexRenderer[\"SettingComplexRenderer\u003cbr/\u003eEdit in JSON\"]\n        ExtToggleRenderer[\"SettingExtensionToggleRenderer\u003cbr/\u003eExtension Enable/Disable\"]\n    end\n    \n    SettingsTree --\u003e SettingTreeRenderers\n    SettingTreeRenderers --\u003e BoolRenderer\n    SettingTreeRenderers --\u003e TextRenderer\n    SettingTreeRenderers --\u003e EnumRenderer\n    SettingTreeRenderers --\u003e NumberRenderer\n    SettingTreeRenderers --\u003e ArrayRenderer\n    SettingTreeRenderers --\u003e ObjectRenderer\n    SettingTreeRenderers --\u003e ComplexRenderer\n    SettingTreeRenderers --\u003e ExtToggleRenderer\n```\n\n**Template IDs:**\n\nEach renderer type has a unique template ID defined as constants:\n- `SETTINGS_BOOL_TEMPLATE_ID` = 'settings.bool.template'\n- `SETTINGS_TEXT_TEMPLATE_ID` = 'settings.text.template'\n- `SETTINGS_ENUM_TEMPLATE_ID` = 'settings.enum.template'\n- `SETTINGS_NUMBER_TEMPLATE_ID` = 'settings.number.template'\n- `SETTINGS_ARRAY_TEMPLATE_ID` = 'settings.array.template'\n- `SETTINGS_OBJECT_TEMPLATE_ID` = 'settings.object.template'\n- `SETTINGS_COMPLEX_TEMPLATE_ID` = 'settings.complex.template'\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/settingsTree.ts:760-776](), [src/vs/workbench/contrib/preferences/browser/settingsTree.ts:1655-1750]()\n\n### Renderer Templates\n\nEach renderer creates and manages a template structure for its setting type:\n\n```mermaid\ngraph TB\n    subgraph \"Setting Item Template Structure\"\n        Container[\"containerElement\u003cbr/\u003e(setting-item)\"]\n        Category[\"categoryElement\u003cbr/\u003eSetting Category\"]\n        Label[\"labelElement\u003cbr/\u003eSetting Name\"]\n        Description[\"descriptionElement\u003cbr/\u003eMarkdown Description\"]\n        Control[\"controlElement\u003cbr/\u003eType-Specific Widget\"]\n        Indicators[\"indicatorsLabel\u003cbr/\u003eModified/Policy/etc\"]\n        Toolbar[\"toolbar\u003cbr/\u003eActions (Reset/Edit)\"]\n        Validation[\"validationErrorMessageElement\u003cbr/\u003eError Display\"]\n    end\n    \n    Container --\u003e Category\n    Container --\u003e Label\n    Container --\u003e Indicators\n    Container --\u003e Description\n    Container --\u003e Control\n    Container --\u003e Toolbar\n    Container --\u003e Validation\n```\n\n**Common Template Interface:**\n```typescript\ninterface ISettingItemTemplate\u003cT = any\u003e {\n    onChange?: (value: T) =\u003e void;\n    context?: SettingsTreeSettingElement;\n    containerElement: HTMLElement;\n    categoryElement: HTMLElement;\n    labelElement: SimpleIconLabel;\n    descriptionElement: HTMLElement;\n    controlElement: HTMLElement;\n    deprecationWarningElement: HTMLElement;\n    indicatorsLabel: SettingsTreeIndicatorsLabel;\n    toolbar: ToolBar;\n    elementDisposables: DisposableStore;\n}\n```\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/settingsTree.ts:686-703](), [src/vs/workbench/contrib/preferences/browser/settingsTree.ts:1779-1904]()\n\n### Type-Specific Renderers\n\n#### Boolean Renderer\n\nRenders settings as toggles or checkboxes:\n\n```mermaid\ngraph LR\n    BoolRenderer[\"SettingBoolRenderer\"]\n    Template[\"ISettingBoolItemTemplate\"]\n    Toggle[\"Toggle Widget\"]\n    \n    BoolRenderer --\u003e Template\n    Template --\u003e Toggle\n    Template -.onChange.-\u003e BoolRenderer\n    BoolRenderer -.fire event.-\u003e SettingsEditor2\n```\n\n**Key Logic:**\n- Uses `Toggle` widget from base UI components\n- Clicking description text also toggles value\n- Disabled when policy-controlled\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/settingsTree.ts:1968-2089]()\n\n#### Enum Renderer\n\nRenders settings with predefined choices as dropdowns:\n\n```mermaid\ngraph LR\n    EnumRenderer[\"SettingEnumRenderer\"]\n    Template[\"ISettingEnumItemTemplate\"]\n    SelectBox[\"SelectBox Widget\"]\n    DescriptionPane[\"Enum Option Descriptions\"]\n    \n    EnumRenderer --\u003e Template\n    Template --\u003e SelectBox\n    Template --\u003e DescriptionPane\n    SelectBox -.onChange.-\u003e EnumRenderer\n```\n\n**Features:**\n- Displays enum option descriptions on hover\n- Supports markdownEnumDescriptions\n- Handles both simple and complex enum types\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/settingsTree.ts:2091-2336]()\n\n#### Object and Array Renderers\n\nFor complex structured data, specialized widget renderers are used:\n\n**Object Widgets:**\n- `ObjectSettingDropdownWidget` - Key-value pairs with add/remove\n- `ObjectSettingCheckboxWidget` - Boolean properties\n- `ListSettingWidget` - Array of strings/enums\n- `IncludeSettingWidget` / `ExcludeSettingWidget` - File glob patterns\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/settingsTree.ts:2698-2935](), [src/vs/workbench/contrib/preferences/browser/settingsWidgets.ts:151-434]()\n\n---\n\n## Search System\n\n### Search Flow\n\n```mermaid\nsequenceDiagram\n    participant User\n    participant SearchWidget\n    participant SettingsEditor2\n    participant SearchDelayer\n    participant SearchProviders\n    participant SearchResultModel\n    participant SettingsTree\n    \n    User-\u003e\u003eSearchWidget: Type query\n    SearchWidget-\u003e\u003eSettingsEditor2: onInputDidChange\n    SettingsEditor2-\u003e\u003eSearchDelayer: trigger (200ms debounce)\n    SearchDelayer-\u003e\u003eSettingsEditor2: onSearchInputChanged()\n    \n    SettingsEditor2-\u003e\u003eSearchProviders: getLocalSearchProvider()\n    SettingsEditor2-\u003e\u003eSearchProviders: getRemoteSearchProvider()\n    SettingsEditor2-\u003e\u003eSearchProviders: getAiSearchProvider()\n    \n    par Parallel Search\n        SearchProviders-\u003e\u003eSearchProviders: searchModel()\n        SearchProviders--\u003e\u003eSearchResultModel: local results\n        SearchProviders-\u003e\u003eSearchProviders: embeddings search\n        SearchProviders--\u003e\u003eSearchResultModel: AI results\n    end\n    \n    SearchResultModel-\u003e\u003eSearchResultModel: merge and deduplicate\n    SearchResultModel--\u003e\u003eSettingsTree: updateInput()\n    SettingsTree-\u003e\u003eSettingsTree: render filtered results\n```\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/settingsEditor2.ts:769-773](), [src/vs/workbench/contrib/preferences/browser/settingsEditor2.ts:1366-1573]()\n\n### Search Providers\n\n#### LocalSearchProvider\n\nPerforms string matching against setting keys, descriptions, and values.\n\n**Match Types (Priority Order):**\n\n| Match Type | Score | Description |\n|------------|-------|-------------|\n| `ExactMatch` | 1 \u003c\u003c 8 | Exact key match |\n| `AllWordsInSettingsLabel` | 1 \u003c\u003c 7 | All words match label |\n| `ContiguousQueryInSettingId` | 1 \u003c\u003c 6 | Contiguous substring in key |\n| `ContiguousWordsInSettingsLabel` | 1 \u003c\u003c 5 | Contiguous word match |\n| `NonContiguousWordsInSettingsLabel` | 1 \u003c\u003c 4 | Non-contiguous word match |\n| `DescriptionOrValueMatch` | 1 \u003c\u003c 3 | Description/value match |\n| `NonContiguousQueryInSettingId` | 1 \u003c\u003c 2 | Non-contiguous key match |\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/preferencesSearch.ts:79-134](), [src/vs/workbench/services/preferences/common/preferences.ts:135-152]()\n\n#### TF-IDF Search Provider\n\nUses term frequency-inverse document frequency for relevance ranking:\n\n```mermaid\ngraph LR\n    TFIDFProvider[\"TF-IDF Provider\"]\n    TfIdfCalculator[\"TfIdfCalculator\u003cbr/\u003eDocument Scoring\"]\n    SettingDocuments[\"Setting Documents\u003cbr/\u003eKey + Description\"]\n    \n    TFIDFProvider --\u003e TfIdfCalculator\n    TfIdfCalculator --\u003e SettingDocuments\n    SettingDocuments -.scores.-\u003e TFIDFProvider\n```\n\n**Document Structure:**\n- Each setting becomes a TF-IDF document\n- Document text = setting key + description words\n- Boost factor applied to key matches\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/preferencesSearch.ts:239-357]()\n\n#### AI Search Providers\n\nAI-powered search uses two strategies:\n\n1. **Embeddings Search** - Vector similarity matching\n2. **LLM Ranked Search** - Language model relevance ranking\n\n```mermaid\ngraph TB\n    AiSearchProvider[\"AiSearchProvider\"]\n    EmbeddingsQuery[\"getEmbeddingsResults()\u003cbr/\u003eVector Search\"]\n    LLMQuery[\"getLLMRankedResults()\u003cbr/\u003eLLM Ranking\"]\n    \n    AiSearchProvider --\u003e EmbeddingsQuery\n    AiSearchProvider --\u003e LLMQuery\n    \n    EmbeddingsQuery -.fast results.-\u003e SearchResultModel\n    LLMQuery -.refined results.-\u003e SearchResultModel\n    \n    IAiSettingsSearchService[\"IAiSettingsSearchService\"]\n    ExtensionProvider[\"Extension-Provided\u003cbr/\u003eAI Search\"]\n    \n    EmbeddingsQuery --\u003e IAiSettingsSearchService\n    LLMQuery --\u003e IAiSettingsSearchService\n    IAiSettingsSearchService --\u003e ExtensionProvider\n```\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/preferencesSearch.ts:359-455](), [src/vs/workbench/services/aiSettingsSearch/common/aiSettingsSearch.ts:1-49]()\n\n### Query Parsing\n\nThe search widget supports special query filters:\n\n**Filter Syntax:**\n\n| Filter | Example | Purpose |\n|--------|---------|---------|\n| `@modified` | `@modified` | Show only modified settings |\n| `@tag:` | `@tag:accessibility` | Filter by tag |\n| `@id:` | `@id:editor.fontSize` | Find by exact ID |\n| `@ext:` | `@ext:vscode.git` | Extension-contributed settings |\n| `@feature:` | `@feature:terminal` | Feature category |\n| `@lang:` | `@lang:javascript` | Language-specific settings |\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/settingsTreeModels.ts:1034-1191](), [src/vs/workbench/contrib/preferences/common/preferences.ts:122-151]()\n\n---\n\n## Table of Contents (TOC)\n\n### TOC Architecture\n\nThe TOC provides hierarchical navigation through settings categories:\n\n```mermaid\ngraph TB\n    TOCTree[\"TOCTree\u003cbr/\u003e(WorkbenchObjectTree)\"]\n    TOCTreeModel[\"TOCTreeModel\"]\n    \n    subgraph \"TOC Structure\"\n        CommonlyUsed[\"Commonly Used\u003cbr/\u003eFrequently Modified\"]\n        Categories[\"Category Groups\u003cbr/\u003eEditor, Workbench, etc.\"]\n        Extensions[\"Extensions\u003cbr/\u003eExtension Settings\"]\n    end\n    \n    TOCTree --\u003e TOCTreeModel\n    TOCTreeModel --\u003e CommonlyUsed\n    TOCTreeModel --\u003e Categories\n    TOCTreeModel --\u003e Extensions\n    \n    TOCTreeModel -.watches.-\u003e SettingsTreeRoot[\"SettingsTreeGroupElement\u003cbr/\u003eRoot\"]\n    TOCTreeModel -.watches.-\u003e SearchResultModel[\"SearchResultModel\u003cbr/\u003eFilter Results\"]\n```\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/tocTree.ts:29-94]()\n\n### TOC Sync with Settings Tree\n\nThe TOC automatically scrolls to match the currently visible settings:\n\n```mermaid\nsequenceDiagram\n    participant SettingsTree\n    participant SettingsEditor2\n    participant TOCTree\n    \n    SettingsTree-\u003e\u003eSettingsTree: onDidScroll\n    SettingsTree-\u003e\u003eSettingsEditor2: updateTreeScrollSync()\n    SettingsEditor2-\u003e\u003eSettingsEditor2: Get visible setting element\n    SettingsEditor2-\u003e\u003eSettingsEditor2: Find parent group\n    SettingsEditor2-\u003e\u003eTOCTree: reveal(group)\n    SettingsEditor2-\u003e\u003eTOCTree: setSelection([group])\n    TOCTree-\u003e\u003eTOCTree: Update selection styling\n```\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/settingsEditor2.ts:1899-1975]()\n\n### TOC Filtering in Search Mode\n\nWhen searching, the TOC shows result counts per category:\n\n**Display Logic:**\n- In search mode: Show result count badges\n- Categories with 0 results: Hidden or dimmed\n- Click TOC item: Scrolls to first matching setting in that category\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/tocTree.ts:95-180](), [src/vs/workbench/contrib/preferences/browser/media/settingsEditor2.css:294-328]()\n\n---\n\n## Settings Indicators and Metadata\n\n### SettingsTreeIndicatorsLabel\n\nDisplays metadata badges next to settings:\n\n```mermaid\ngraph LR\n    IndicatorsLabel[\"SettingsTreeIndicatorsLabel\"]\n    \n    subgraph \"Indicator Types\"\n        Preview[\"Preview\u003cbr/\u003eExperimental Feature\"]\n        Advanced[\"Advanced\u003cbr/\u003eAdvanced Setting\"]\n        Policy[\"Policy\u003cbr/\u003eManaged by Policy\"]\n        Untrusted[\"Untrusted\u003cbr/\u003eRequires Workspace Trust\"]\n        SyncIgnored[\"Sync Ignored\u003cbr/\u003eNot Synced\"]\n        Modified[\"Modified\u003cbr/\u003eOverridden Values\"]\n    end\n    \n    IndicatorsLabel --\u003e Preview\n    IndicatorsLabel --\u003e Advanced\n    IndicatorsLabel --\u003e Policy\n    IndicatorsLabel --\u003e Untrusted\n    IndicatorsLabel --\u003e SyncIgnored\n    IndicatorsLabel --\u003e Modified\n```\n\n**Indicator Priority:**\n- Policy indicators are always shown (highest priority)\n- Preview/Advanced shown for tagged settings\n- Sync ignored shown when setting excluded from sync\n- Modified/overridden shown with clickable scope links\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/settingsEditorSettingIndicators.ts:66-193]()\n\n### Scope Override Indicators\n\nWhen a setting has different values in different scopes, indicators show where overrides exist:\n\n**Example Display:**\n```\nSetting Name (Also modified in: workspace, remote)\n```\n\n**Click Behavior:**\n- Clicking a scope indicator opens that scope's settings\n- Emits `ISettingOverrideClickEvent` with scope and language info\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/settingsEditorSettingIndicators.ts:195-362]()\n\n---\n\n## Settings Widgets\n\n### ListSettingWidget\n\nEditable list of strings or enums with drag-and-drop reordering:\n\n```mermaid\ngraph TB\n    ListSettingWidget[\"ListSettingWidget\"]\n    Model[\"ListSettingListModel\u003cbr/\u003eItem State\"]\n    \n    subgraph \"List UI\"\n        Items[\"Data Item Rows\u003cbr/\u003eDisplay Mode\"]\n        EditRow[\"Edit Row\u003cbr/\u003eInput Mode\"]\n        AddButton[\"Add Button\"]\n    end\n    \n    subgraph \"Item Actions\"\n        Edit[\"Edit Item\"]\n        Remove[\"Remove Item\"]\n        DragDrop[\"Drag to Reorder\"]\n    end\n    \n    ListSettingWidget --\u003e Model\n    ListSettingWidget --\u003e Items\n    ListSettingWidget --\u003e EditRow\n    ListSettingWidget --\u003e AddButton\n    \n    Items --\u003e Edit\n    Items --\u003e Remove\n    Items --\u003e DragDrop\n```\n\n**Events:**\n- `ISettingListAddEvent` - Item added\n- `ISettingListChangeEvent` - Item edited\n- `ISettingListRemoveEvent` - Item removed\n- `ISettingListMoveEvent` - Item reordered\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/settingsWidgets.ts:453-732]()\n\n### ObjectSettingDropdownWidget\n\nKey-value editor for object settings:\n\n**Features:**\n- Enum key suggestions (when schema defines properties)\n- Type-specific value inputs (string, number, boolean, enum)\n- Add/remove/reset buttons per row\n- Default value indicators\n\n**Value Input Types:**\n\n| Type | Widget |\n|------|--------|\n| `boolean` | Toggle |\n| `enum` | SelectBox |\n| `string` | InputBox |\n| `number` | InputBox with number validation |\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/settingsWidgets.ts:734-1490]()\n\n### Include/Exclude Setting Widgets\n\nSpecialized widgets for file glob patterns (`files.exclude`, `search.exclude`, etc.):\n\n**UI Structure:**\n- Pattern field (glob pattern)\n- When clause field (optional condition)\n- Source indicator (shows if pattern comes from extension default)\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/settingsWidgets.ts:1492-1640]()\n\n---\n\n## Configuration Updates\n\n### Setting Value Changes\n\n```mermaid\nsequenceDiagram\n    participant Renderer\n    participant SettingsEditor2\n    participant Delayer\n    participant ConfigService\n    \n    Renderer-\u003e\u003eRenderer: User edits value\n    Renderer-\u003e\u003eSettingsEditor2: onChange(event)\n    SettingsEditor2-\u003e\u003eSettingsEditor2: Check if fast/slow update\n    \n    alt Fast Update (bool, enum)\n        SettingsEditor2-\u003e\u003eDelayer: trigger (200ms)\n    else Slow Update (text, number)\n        SettingsEditor2-\u003e\u003eDelayer: trigger (1000ms)\n    end\n    \n    Delayer-\u003e\u003eSettingsEditor2: settingUpdateDelayer.trigger()\n    SettingsEditor2-\u003e\u003eConfigService: updateValue(key, value, target)\n    ConfigService-\u003e\u003eConfigService: Write to settings file\n    ConfigService--\u003e\u003eSettingsEditor2: Configuration changed event\n    SettingsEditor2-\u003e\u003eSettingsTreeModel: updateElementsByKey()\n    SettingsTreeModel-\u003e\u003eSettingsTree: Refresh affected elements\n```\n\n**Update Speeds:**\n\nSettings are debounced at different rates based on type:\n- **Fast (200ms):** Boolean, Enum, Array, Object\n- **Slow (1000ms):** String, Number (waiting for typing to finish)\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/settingsEditor2.ts:153-166](), [src/vs/workbench/contrib/preferences/browser/settingsEditor2.ts:1577-1650]()\n\n### Reset to Default\n\nUsers can reset individual settings or entire configuration objects:\n\n**Reset Flow:**\n```mermaid\nsequenceDiagram\n    participant User\n    participant SettingsTree\n    participant ConfigService\n    participant SettingsEditor2\n    \n    User-\u003e\u003eSettingsTree: Click Reset button\n    SettingsTree-\u003e\u003eConfigService: updateValue(key, undefined, target)\n    ConfigService-\u003e\u003eConfigService: Remove from settings JSON\n    ConfigService--\u003e\u003eSettingsEditor2: onDidChangeConfiguration\n    SettingsEditor2-\u003e\u003eSettingsTreeModel: Update model\n    SettingsTreeModel--\u003e\u003eSettingsTree: Refresh element\n    SettingsTree-\u003e\u003eSettingsTree: Show default value\n```\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/settingsTree.ts:1379-1406]()\n\n---\n\n## Settings Target Selection\n\nThe Settings Editor supports editing different configuration scopes:\n\n### SettingsTargetsWidget\n\nDisplays and controls which settings file is being edited:\n\n**Target Types:**\n\n| Target | Constant | Description |\n|--------|----------|-------------|\n| User | `ConfigurationTarget.USER_LOCAL` | User settings (synced) |\n| Remote | `ConfigurationTarget.USER_REMOTE` | Remote user settings |\n| Workspace | `ConfigurationTarget.WORKSPACE` | Workspace settings |\n| Folder | URI-based | Workspace folder settings |\n| Application | `ConfigurationTarget.APPLICATION` | Application-level settings |\n\n```mermaid\ngraph TB\n    SettingsTargetsWidget[\"SettingsTargetsWidget\u003cbr/\u003eDropdown\"]\n    \n    subgraph \"Available Targets\"\n        User[\"User Settings\u003cbr/\u003e~/.config/Code/settings.json\"]\n        Remote[\"Remote Settings\u003cbr/\u003eRemote Host Config\"]\n        Workspace[\"Workspace Settings\u003cbr/\u003e.vscode/settings.json\"]\n        Folder[\"Folder Settings\u003cbr/\u003eMulti-root Folders\"]\n    end\n    \n    SettingsTargetsWidget --\u003e User\n    SettingsTargetsWidget --\u003e Remote\n    SettingsTargetsWidget --\u003e Workspace\n    SettingsTargetsWidget --\u003e Folder\n    \n    SettingsTargetsWidget -.onDidTargetChange.-\u003e SettingsEditor2\n```\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/preferencesWidgets.ts:1-300](), [src/vs/workbench/contrib/preferences/browser/settingsEditor2.ts:777-795]()\n\n### Target Change Handling\n\nWhen the user switches targets:\n\n1. Clear current model\n2. Create new `SettingsTreeModel` for target\n3. Re-render tree with target-specific values\n4. Update TOC\n5. Preserve search query and filters\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/settingsEditor2.ts:841-876]()\n\n---\n\n## Extension Integration\n\n### Extension-Contributed Settings\n\nExtensions contribute settings through `package.json` configuration contributions:\n\n```mermaid\ngraph LR\n    Extension[\"Extension\u003cbr/\u003epackage.json\"]\n    ConfigRegistry[\"IConfigurationRegistry\u003cbr/\u003eRegistry.as(Extensions.Configuration)\"]\n    Settings2EditorModel[\"Settings2EditorModel\"]\n    SettingsTreeModel[\"SettingsTreeModel\"]\n    \n    Extension --\u003e|contributes.configuration| ConfigRegistry\n    ConfigRegistry --\u003e Settings2EditorModel\n    Settings2EditorModel --\u003e SettingsTreeModel\n```\n\n**Extension Setting Metadata:**\n\n| Field | Purpose |\n|-------|---------|\n| `extensionInfo.id` | Extension identifier |\n| `extensionInfo.displayName` | Extension display name |\n| `setting.extensionName` | Populated for extension settings |\n| `setting.extensionPublisher` | Publisher name |\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/settingsTree.ts:475-566](), [src/vs/workbench/services/preferences/common/preferencesModels.ts:1130-1243]()\n\n### Extension Toggle Settings\n\nSpecial UI for enabling/disabling extensions via settings:\n\n**Detection:**\nSettings are treated as extension toggles when:\n- Key matches pattern: `extensions.{extensionId}.enabled`\n- Product configuration includes extension in experimental toggles\n\n**Renderer:**\n`SettingExtensionToggleRenderer` provides:\n- Enable/Disable button\n- Extension name and publisher\n- Dismiss button (to hide the suggestion)\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/settingsTree.ts:3240-3470](), [src/vs/workbench/contrib/preferences/common/preferences.ts:175-226]()\n\n---\n\n## Keyboard Navigation\n\n### Focus Contexts\n\nThe editor maintains focus context to enable keyboard shortcuts:\n\n```mermaid\ngraph TB\n    FocusContext[\"SettingsFocusContext\u003cbr/\u003eCurrent Focus\"]\n    \n    subgraph \"Context States\"\n        Search[\"Search\u003cbr/\u003eCONTEXT_SETTINGS_SEARCH_FOCUS\"]\n        TOC[\"TableOfContents\u003cbr/\u003eCONTEXT_TOC_ROW_FOCUS\"]\n        Tree[\"SettingTree\u003cbr/\u003eCONTEXT_SETTINGS_ROW_FOCUS\"]\n        Control[\"SettingControl\u003cbr/\u003eCONTEXT_SETTINGS_ROW_FOCUS\"]\n    end\n    \n    FocusContext --\u003e Search\n    FocusContext --\u003e TOC\n    FocusContext --\u003e Tree\n    FocusContext --\u003e Control\n```\n\n**Navigation Flow:**\n- `Tab` / `Shift+Tab` - Cycle between search, TOC, and settings tree\n- `` / `` - Navigate within TOC or settings tree\n- `Enter` - Focus on setting control (input, toggle, etc.)\n- `Escape` - Return focus to tree\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/settingsEditor2.ts:76-81](), [src/vs/workbench/contrib/preferences/browser/settingsEditor2.ts:609-632]()\n\n---\n\n## Styling and Theming\n\n### Color Tokens\n\nThe Settings Editor defines custom color tokens:\n\n| Token | Purpose | Default |\n|-------|---------|---------|\n| `settings.headerForeground` | Category headers | Foreground |\n| `settings.modifiedItemIndicator` | Modified indicator bar | Accent |\n| `settings.focusedRowBackground` | Focused row background | List active |\n| `settings.rowHoverBackground` | Row hover background | List hover |\n| `settings.focusedRowBorder` | Focused row border outline | Focus border |\n| `settings.checkboxBackground` | Checkbox fill | Input background |\n| `settings.checkboxBorder` | Checkbox border | Input border |\n| `settings.textInputBorder` | Text input border | Input border |\n| `settings.numberInputBorder` | Number input border | Input border |\n\n**Sources:** [src/vs/workbench/contrib/preferences/common/settingsEditorColorRegistry.ts:1-100](), [src/vs/workbench/contrib/preferences/browser/media/settingsEditor2.css:1-50]()\n\n### CSS Structure\n\n**Main Classes:**\n\n```css\n.settings-editor\n   .settings-header\n      .search-container\n         .suggest-input-container\n         .search-container-widgets\n      .settings-header-controls\n          .settings-target-container\n   .settings-body\n      .monaco-split-view2\n          .settings-toc-container\n             .settings-toc-wrapper\n          .settings-tree-container\n              .monaco-list\n                  .setting-item-contents\n```\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/media/settingsEditor2.css:10-383]()\n\n---\n\n## Performance Considerations\n\n### Rendering Optimizations\n\n**Virtualization:**\n- Both TOC and settings tree use virtual scrolling\n- Only visible items are rendered in DOM\n- Renderer templates are recycled\n\n**Search Debouncing:**\n- 200ms debounce on search input\n- Prevents excessive filtering during typing\n\n**Lazy Loading:**\n- Extension settings loaded on demand\n- AI search results loaded asynchronously\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/settingsEditor2.ts:112-114](), [src/vs/workbench/contrib/preferences/browser/settingsEditor2.ts:273-280]()\n\n### Configuration Update Batching\n\nSettings changes are batched to avoid multiple file writes:\n\n```mermaid\nsequenceDiagram\n    participant User\n    participant Renderer\n    participant Delayer\n    participant SettingsEditor2\n    participant ConfigService\n    \n    User-\u003e\u003eRenderer: Change setting A\n    Renderer-\u003e\u003eSettingsEditor2: onChange(A)\n    SettingsEditor2-\u003e\u003eDelayer: Schedule update\n    \n    User-\u003e\u003eRenderer: Change setting B\n    Renderer-\u003e\u003eSettingsEditor2: onChange(B)\n    SettingsEditor2-\u003e\u003eDelayer: Cancel previous, schedule new\n    \n    Note over Delayer: Wait for debounce period\n    \n    Delayer-\u003e\u003eSettingsEditor2: Execute update\n    SettingsEditor2-\u003e\u003eConfigService: updateValue(B)\n```\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/settingsEditor2.ts:1577-1650]()\n\n---\n\n## Related Systems\n\n- **Keybindings Editor** [11.3](#11.3) - Similar tree-based editor for keyboard shortcuts\n- **Preferences Service** [11.4](#11.4) - Underlying service layer for settings access\n- **Configuration Service** - Platform-level configuration management\n- **Extension System** [5](#5) - Extension contribution mechanism\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/preferences.contribution.ts:1-100](), [src/vs/workbench/services/preferences/browser/preferencesService.ts:1-100]()"])</script><script>self.__next_f.push([1,"54:T6cf9,"])</script><script>self.__next_f.push([1,"# Settings Tree Model and Rendering\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [src/vs/workbench/api/browser/mainThreadAiSettingsSearch.ts](src/vs/workbench/api/browser/mainThreadAiSettingsSearch.ts)\n- [src/vs/workbench/api/common/extHostAiSettingsSearch.ts](src/vs/workbench/api/common/extHostAiSettingsSearch.ts)\n- [src/vs/workbench/contrib/preferences/browser/keybindingsEditor.ts](src/vs/workbench/contrib/preferences/browser/keybindingsEditor.ts)\n- [src/vs/workbench/contrib/preferences/browser/media/keybindingsEditor.css](src/vs/workbench/contrib/preferences/browser/media/keybindingsEditor.css)\n- [src/vs/workbench/contrib/preferences/browser/media/settingsEditor2.css](src/vs/workbench/contrib/preferences/browser/media/settingsEditor2.css)\n- [src/vs/workbench/contrib/preferences/browser/media/settingsWidgets.css](src/vs/workbench/contrib/preferences/browser/media/settingsWidgets.css)\n- [src/vs/workbench/contrib/preferences/browser/preferences.contribution.ts](src/vs/workbench/contrib/preferences/browser/preferences.contribution.ts)\n- [src/vs/workbench/contrib/preferences/browser/preferencesSearch.ts](src/vs/workbench/contrib/preferences/browser/preferencesSearch.ts)\n- [src/vs/workbench/contrib/preferences/browser/settingsEditor2.ts](src/vs/workbench/contrib/preferences/browser/settingsEditor2.ts)\n- [src/vs/workbench/contrib/preferences/browser/settingsEditorSettingIndicators.ts](src/vs/workbench/contrib/preferences/browser/settingsEditorSettingIndicators.ts)\n- [src/vs/workbench/contrib/preferences/browser/settingsTree.ts](src/vs/workbench/contrib/preferences/browser/settingsTree.ts)\n- [src/vs/workbench/contrib/preferences/browser/settingsTreeModels.ts](src/vs/workbench/contrib/preferences/browser/settingsTreeModels.ts)\n- [src/vs/workbench/contrib/preferences/browser/settingsWidgets.ts](src/vs/workbench/contrib/preferences/browser/settingsWidgets.ts)\n- [src/vs/workbench/contrib/preferences/browser/tocTree.ts](src/vs/workbench/contrib/preferences/browser/tocTree.ts)\n- [src/vs/workbench/contrib/preferences/common/preferences.ts](src/vs/workbench/contrib/preferences/common/preferences.ts)\n- [src/vs/workbench/contrib/preferences/common/preferencesContribution.ts](src/vs/workbench/contrib/preferences/common/preferencesContribution.ts)\n- [src/vs/workbench/services/aiSettingsSearch/common/aiSettingsSearch.ts](src/vs/workbench/services/aiSettingsSearch/common/aiSettingsSearch.ts)\n- [src/vs/workbench/services/aiSettingsSearch/common/aiSettingsSearchService.ts](src/vs/workbench/services/aiSettingsSearch/common/aiSettingsSearchService.ts)\n- [src/vs/workbench/services/preferences/browser/keybindingsEditorModel.ts](src/vs/workbench/services/preferences/browser/keybindingsEditorModel.ts)\n- [src/vs/workbench/services/preferences/browser/preferencesService.ts](src/vs/workbench/services/preferences/browser/preferencesService.ts)\n- [src/vs/workbench/services/preferences/common/preferences.ts](src/vs/workbench/services/preferences/common/preferences.ts)\n- [src/vs/workbench/services/preferences/common/preferencesModels.ts](src/vs/workbench/services/preferences/common/preferencesModels.ts)\n- [src/vs/workbench/services/preferences/test/browser/keybindingsEditorModel.test.ts](src/vs/workbench/services/preferences/test/browser/keybindingsEditorModel.test.ts)\n- [src/vscode-dts/vscode.proposed.aiSettingsSearch.d.ts](src/vscode-dts/vscode.proposed.aiSettingsSearch.d.ts)\n\n\u003c/details\u003e\n\n\n\nThis page documents the tree-based data model and rendering infrastructure used by the Settings Editor to display configuration settings in a hierarchical, searchable view. This system transforms flat configuration registry data into a navigable tree structure and renders it with appropriate UI controls for each setting type.\n\nFor information about the overall Settings Editor architecture and how it coordinates these components, see [Settings Editor Architecture](#11.1). For details on the Table of Contents tree shown alongside the settings, see [tocTree.ts:1-300]().\n\n## Purpose and Scope\n\nThe Settings Tree Model and Rendering system consists of two primary responsibilities:\n\n1. **Tree Model** (`SettingsTreeModel` and related classes): Organizes settings from the configuration registry into a hierarchical structure with groups, subgroups, and individual setting elements. Supports search filtering, workspace trust evaluation, and language-specific overrides.\n\n2. **Tree Rendering** (`SettingsTree` and renderer classes): Renders the tree model using VS Code's tree widget infrastructure, providing specialized renderers for each setting value type (boolean, string, enum, array, object, etc.) with appropriate input controls and validation.\n\nSources: [src/vs/workbench/contrib/preferences/browser/settingsTreeModels.ts:1-100](), [src/vs/workbench/contrib/preferences/browser/settingsTree.ts:1-100]()\n\n## Architecture Overview\n\n```mermaid\ngraph TB\n    subgraph \"Data Sources\"\n        ConfigRegistry[\"IConfigurationRegistry\u003cbr/\u003e(Extensions.Configuration)\"]\n        DefaultSettings[\"DefaultSettings\u003cbr/\u003e(Settings2EditorModel)\"]\n        UserConfig[\"User Configuration\u003cbr/\u003e(IWorkbenchConfigurationService)\"]\n    end\n    \n    subgraph \"Tree Model Layer\"\n        STM[\"SettingsTreeModel\"]\n        SRM[\"SearchResultModel\"]\n        STGE[\"SettingsTreeGroupElement\"]\n        STSE[\"SettingsTreeSettingElement\"]\n        \n        STM --\u003e|\"contains\"| STGE\n        STM --\u003e|\"contains\"| STSE\n        STGE --\u003e|\"children\"| STSE\n        STGE --\u003e|\"children\"| STGE\n    end\n    \n    subgraph \"Rendering Layer\"\n        SettingsTree[\"SettingsTree\u003cbr/\u003e(WorkbenchObjectTree)\"]\n        STRenderers[\"SettingTreeRenderers\"]\n        \n        BoolRenderer[\"SettingBoolRenderer\"]\n        TextRenderer[\"SettingTextRenderer\"]\n        EnumRenderer[\"SettingEnumRenderer\"]\n        ArrayRenderer[\"SettingArrayRenderer\"]\n        ObjectRenderer[\"SettingObjectRenderer\"]\n        ComplexRenderer[\"SettingComplexRenderer\"]\n        GroupRenderer[\"SettingGroupRenderer\"]\n        \n        STRenderers --\u003e|\"manages\"| BoolRenderer\n        STRenderers --\u003e|\"manages\"| TextRenderer\n        STRenderers --\u003e|\"manages\"| EnumRenderer\n        STRenderers --\u003e|\"manages\"| ArrayRenderer\n        STRenderers --\u003e|\"manages\"| ObjectRenderer\n        STRenderers --\u003e|\"manages\"| ComplexRenderer\n        STRenderers --\u003e|\"manages\"| GroupRenderer\n    end\n    \n    subgraph \"UI Output\"\n        DOM[\"DOM Elements\u003cbr/\u003e(setting-item containers)\"]\n        Widgets[\"Input Widgets\u003cbr/\u003e(Toggle, InputBox, SelectBox, etc.)\"]\n    end\n    \n    ConfigRegistry --\u003e|\"provides settings\"| DefaultSettings\n    DefaultSettings --\u003e|\"builds\"| STM\n    UserConfig --\u003e|\"inspects values\"| STSE\n    \n    STM --\u003e|\"data source\"| SettingsTree\n    SettingsTree --\u003e|\"uses\"| STRenderers\n    \n    BoolRenderer --\u003e|\"renders to\"| DOM\n    BoolRenderer --\u003e|\"creates\"| Widgets\n    TextRenderer --\u003e|\"renders to\"| DOM\n    TextRenderer --\u003e|\"creates\"| Widgets\n    EnumRenderer --\u003e|\"renders to\"| DOM\n    EnumRenderer --\u003e|\"creates\"| Widgets\n    ArrayRenderer --\u003e|\"renders to\"| DOM\n    ArrayRenderer --\u003e|\"creates\"| Widgets\n    ObjectRenderer --\u003e|\"renders to\"| DOM\n    ObjectRenderer --\u003e|\"creates\"| Widgets\n```\n\n**Diagram: Settings Tree Model and Rendering Architecture**\n\nThe system follows a clear separation between model and view:\n- **Model Layer**: Tree elements (`SettingsTreeElement` subclasses) represent the hierarchical structure\n- **Rendering Layer**: Specialized renderers create DOM and input widgets for each element type\n- **Data Flow**: Configuration data flows from registry  model  tree widget  renderers  DOM\n\nSources: [src/vs/workbench/contrib/preferences/browser/settingsTreeModels.ts:40-106](), [src/vs/workbench/contrib/preferences/browser/settingsTree.ts:1282-1356](), [src/vs/workbench/contrib/preferences/browser/settingsEditor2.ts:169-194]()\n\n## Tree Model Classes\n\n### SettingsTreeElement Base Class\n\nAll tree elements inherit from `SettingsTreeElement`, providing common functionality:\n\n```mermaid\nclassDiagram\n    class SettingsTreeElement {\n        +string id\n        +SettingsTreeGroupElement parent\n        +boolean tabbable\n        +Event~void~ onDidChangeTabbable\n    }\n    \n    class SettingsTreeGroupElement {\n        +string label\n        +number level\n        +number count\n        +SettingsTreeGroupChild[] children\n        +boolean isFirstGroup\n        +containsSetting(key: string) boolean\n    }\n    \n    class SettingsTreeSettingElement {\n        +ISetting setting\n        +any value\n        +any scopeValue\n        +any defaultValue\n        +boolean isConfigured\n        +boolean isUntrusted\n        +boolean hasPolicyValue\n        +SettingValueType valueType\n        +string displayCategory\n        +string displayLabel\n        +inspectSelf() void\n    }\n    \n    class SettingsTreeNewExtensionsElement {\n        +string[] extensionIds\n    }\n    \n    SettingsTreeElement \u003c|-- SettingsTreeGroupElement\n    SettingsTreeElement \u003c|-- SettingsTreeSettingElement\n    SettingsTreeElement \u003c|-- SettingsTreeNewExtensionsElement\n    \n    SettingsTreeGroupElement --\u003e|\"children\"| SettingsTreeElement\n```\n\n**Diagram: Tree Element Class Hierarchy**\n\nSources: [src/vs/workbench/contrib/preferences/browser/settingsTreeModels.ts:40-111]()\n\n### SettingsTreeModel\n\n`SettingsTreeModel` is the primary model class that builds the tree structure:\n\n| Method | Purpose |\n|--------|---------|\n| `constructor()` | Initializes with settings target, language filter, and workspace trust state |\n| `update(tocRoot, coreSettingsGroups)` | Builds tree from TOC data and settings groups |\n| `updateWorkspaceTrust(isWorkspaceTrusted)` | Updates trust state for all settings |\n| `getUniqueKey(e)` | Returns unique identifier for tree element |\n| `settingsTreeRoot` | Property returning root group element |\n\nThe model creation process:\n\n1. **Resolve Settings Tree**: Matches settings from configuration registry to TOC (Table of Contents) structure\n2. **Create Group Elements**: Builds `SettingsTreeGroupElement` nodes from TOC hierarchy\n3. **Create Setting Elements**: Instantiates `SettingsTreeSettingElement` for each setting\n4. **Inspect Values**: Queries configuration service for current, default, and override values\n5. **Apply Filters**: Handles workspace trust, language filters, and policy restrictions\n\nSources: [src/vs/workbench/contrib/preferences/browser/settingsTreeModels.ts:461-573]()\n\n### SettingsTreeSettingElement Details\n\nEach setting element contains rich metadata:\n\n```typescript\n// Key Properties\nsetting: ISetting                    // Schema from configuration registry\nvalue: any                           // Current effective value\nscopeValue: any                      // Value in current scope (if configured)\ndefaultValue: any                    // Default value from schema\nisConfigured: boolean                // Whether user has modified\nhasPolicyValue: boolean              // Whether managed by policy\nisUntrusted: boolean                 // Whether restricted in untrusted workspace\n\n// Display Properties\ndisplayCategory: string              // Category shown in UI (e.g., \"Editor\")\ndisplayLabel: string                 // Label shown in UI (e.g., \"Font Size\")\ndescription: string                  // Help text\nvalueType: SettingValueType          // Type determines renderer used\n\n// Override Tracking\noverriddenScopeList: string[]        // Scopes with overrides (e.g., [\"workspace:\", \"remote:\"])\nlanguageOverrideValues: Map          // Language-specific values\n```\n\nThe `inspectSelf()` method queries the configuration service to populate these values:\n\nSources: [src/vs/workbench/contrib/preferences/browser/settingsTreeModels.ts:113-390]()\n\n### SearchResultModel\n\nWhen searching, `SearchResultModel` wraps the base tree model:\n\n```mermaid\ngraph LR\n    Query[\"User Query\"]\n    \n    subgraph \"Search Pipeline\"\n        LocalSearch[\"LocalSearchProvider\"]\n        RemoteSearch[\"RemoteSearchProvider\u003cbr/\u003e(optional)\"]\n        AiSearch[\"AiSearchProvider\u003cbr/\u003e(optional)\"]\n    end\n    \n    subgraph \"SearchResultModel\"\n        FilterMatches[\"filterMatches: ISettingMatch[]\"]\n        Metadata[\"metadata: IFilterMetadata\"]\n        UpdateModel[\"updateFilteredSettings()\"]\n    end\n    \n    FlatTree[\"Flat List of Matching Settings\"]\n    \n    Query --\u003e LocalSearch\n    Query --\u003e RemoteSearch\n    Query --\u003e AiSearch\n    \n    LocalSearch --\u003e FilterMatches\n    RemoteSearch --\u003e FilterMatches\n    AiSearch --\u003e FilterMatches\n    \n    FilterMatches --\u003e UpdateModel\n    UpdateModel --\u003e FlatTree\n```\n\n**Diagram: Search Result Model Flow**\n\n`SearchResultModel` provides:\n- `filterMatches`: Array of matching settings with match information\n- `showAiResults`: Toggle for AI-powered search results\n- `updateFilteredSettings()`: Flattens matching settings into renderable list\n- `getFlatSettings()`: Returns flat array of settings that match search\n\nSources: [src/vs/workbench/contrib/preferences/browser/settingsTreeModels.ts:618-766]()\n\n## Tree Rendering System\n\n### SettingsTree Widget\n\n`SettingsTree` extends `WorkbenchObjectTree` with settings-specific behavior:\n\n```typescript\nexport class SettingsTree extends WorkbenchObjectTree\u003cSettingsTreeElement\u003e {\n    // Constructor registers custom behaviors\n    constructor(\n        container: HTMLElement,\n        viewState: ISettingsEditorViewState,\n        renderers: ITreeRenderer\u003cany, void, any\u003e[],\n        // ... services\n    ) {\n        super(\n            'SettingsEditor',\n            container,\n            delegate,          // Controls row heights\n            renderers,         // Setting-specific renderers\n            options,           // Tree options with custom styles\n            // ... service parameters\n        );\n        \n        this.disposables.add(this.onDidChangeFocus(e =\u003e this.onFocus(e)));\n        this.disposables.add(this.onDidChangeSelection(e =\u003e this.onSelection(e)));\n    }\n}\n```\n\nThe tree widget provides:\n- **Custom Styling**: Integrates with VS Code theme system\n- **Focus Management**: Tracks focused setting for keyboard navigation\n- **Sticky Scroll**: Group headers remain visible when scrolling\n- **Context Menu**: Right-click actions on settings\n\nSources: [src/vs/workbench/contrib/preferences/browser/settingsTree.ts:1282-1434]()\n\n### Renderer Architecture\n\nEach setting value type has a dedicated renderer:\n\n| Template ID | Renderer Class | Setting Type | UI Control |\n|-------------|----------------|--------------|------------|\n| `SETTINGS_BOOL_TEMPLATE_ID` | `SettingBoolRenderer` | Boolean | `Toggle` |\n| `SETTINGS_TEXT_TEMPLATE_ID` | `SettingTextRenderer` | String | `InputBox` |\n| `SETTINGS_MULTILINE_TEXT_TEMPLATE_ID` | `SettingTextRenderer` | Multiline String | `InputBox` (multiline) |\n| `SETTINGS_NUMBER_TEMPLATE_ID` | `SettingNumberRenderer` | Number/Integer | `InputBox` (numeric) |\n| `SETTINGS_ENUM_TEMPLATE_ID` | `SettingEnumRenderer` | Enum | `SelectBox` |\n| `SETTINGS_ARRAY_TEMPLATE_ID` | `SettingArrayRenderer` | Array | `ListSettingWidget` |\n| `SETTINGS_EXCLUDE_TEMPLATE_ID` | `SettingExcludeRenderer` | Exclude patterns | `ExcludeSettingWidget` |\n| `SETTINGS_INCLUDE_TEMPLATE_ID` | `SettingIncludeRenderer` | Include patterns | `IncludeSettingWidget` |\n| `SETTINGS_OBJECT_TEMPLATE_ID` | `SettingObjectRenderer` | Object | `ObjectSettingDropdownWidget` or `ObjectSettingCheckboxWidget` |\n| `SETTINGS_COMPLEX_TEMPLATE_ID` | `SettingComplexRenderer` | Complex/JSON | Edit button |\n| `SETTINGS_ELEMENT_TEMPLATE_ID` | `SettingGroupRenderer` | Group | Header label |\n\nSources: [src/vs/workbench/contrib/preferences/browser/settingsTree.ts:761-776]()\n\n### Renderer Base Class Pattern\n\nAll setting renderers extend `AbstractSettingRenderer`:\n\n```mermaid\ngraph TB\n    ASR[\"AbstractSettingRenderer\"]\n    \n    subgraph \"Template Structure\"\n        Container[\"containerElement\u003cbr/\u003e(setting-item)\"]\n        Category[\"categoryElement\"]\n        Label[\"labelElement\u003cbr/\u003e(SimpleIconLabel)\"]\n        Description[\"descriptionElement\"]\n        Control[\"controlElement\u003cbr/\u003e(type-specific)\"]\n        Toolbar[\"toolbar\u003cbr/\u003e(ToolBar)\"]\n        Indicators[\"indicatorsLabel\u003cbr/\u003e(SettingsTreeIndicatorsLabel)\"]\n        Validation[\"validationErrorMessageElement\"]\n    end\n    \n    subgraph \"Lifecycle Methods\"\n        RenderTemplate[\"renderTemplate(container)\"]\n        RenderElement[\"renderElement(element, index, template)\"]\n        DisposeTemplate[\"disposeTemplate(template)\"]\n    end\n    \n    ASR --\u003e|\"creates\"| Container\n    Container --\u003e Category\n    Container --\u003e Label\n    Container --\u003e Description\n    Container --\u003e Control\n    Container --\u003e Toolbar\n    Container --\u003e Indicators\n    Container --\u003e Validation\n    \n    ASR --\u003e|\"implements\"| RenderTemplate\n    ASR --\u003e|\"implements\"| RenderElement\n    ASR --\u003e|\"implements\"| DisposeTemplate\n```\n\n**Diagram: Abstract Renderer Template Structure**\n\nCommon rendering steps:\n1. **`renderTemplate()`**: Creates DOM structure and widgets (called once per template instance)\n2. **`renderElement()`**: Populates template with element data (called for each tree row)\n3. **Validation**: Updates error messages when value is invalid\n4. **Change Handling**: Emits `ISettingChangeEvent` when user modifies value\n\nSources: [src/vs/workbench/contrib/preferences/browser/settingsTree.ts:813-1028]()\n\n### Example: Boolean Setting Renderer\n\n`SettingBoolRenderer` demonstrates a simple renderer implementation:\n\n```typescript\nclass SettingBoolRenderer extends AbstractSettingRenderer {\n    renderTemplate(container: HTMLElement): ISettingBoolItemTemplate {\n        // Create base structure\n        const toDispose = new DisposableStore();\n        const template = super.renderSettingTemplate(toDispose, container);\n        \n        // Add boolean-specific control\n        template.checkbox = new Toggle({ \n            icon: Codicon.check, \n            /* ... */ \n        });\n        template.checkbox.domNode.classList.add('setting-value-checkbox');\n        template.controlElement.appendChild(template.checkbox.domNode);\n        \n        // Handle checkbox changes\n        toDispose.add(template.checkbox.onChange(() =\u003e {\n            if (template.onChange) {\n                template.onChange(template.checkbox.checked);\n            }\n        }));\n        \n        return template;\n    }\n    \n    renderElement(element: SettingsTreeSettingElement, template: ISettingBoolItemTemplate) {\n        super.renderSettingElement(element, index, template);\n        \n        // Update checkbox state\n        template.checkbox.checked = element.value;\n        \n        // Setup onChange handler\n        template.onChange = (value) =\u003e this.onDidChangeSettingEmitter.fire({\n            key: element.setting.key,\n            value: value,\n            type: element.valueType,\n            /* ... */\n        });\n    }\n}\n```\n\nSources: [src/vs/workbench/contrib/preferences/browser/settingsTree.ts:1030-1143]()\n\n### Complex Renderers\n\nMore complex renderers like `SettingArrayRenderer` use specialized widgets:\n\n```mermaid\ngraph TB\n    SAR[\"SettingArrayRenderer\"]\n    Template[\"ISettingListItemTemplate\"]\n    ListWidget[\"ListSettingWidget\u0026lt;IListDataItem\u0026gt;\"]\n    \n    subgraph \"Widget Lifecycle\"\n        Create[\"new ListSettingWidget(container)\"]\n        SetValue[\"setValue(displayValue, options)\"]\n        OnChange[\"onDidChangeList event\"]\n    end\n    \n    subgraph \"Display Value Conversion\"\n        ElementValue[\"element.value: string[]\"]\n        GetDisplay[\"getListDisplayValue(element)\"]\n        DataItems[\"IListDataItem[]\"]\n    end\n    \n    SAR --\u003e|\"creates\"| Template\n    Template --\u003e|\"contains\"| ListWidget\n    \n    ElementValue --\u003e GetDisplay\n    GetDisplay --\u003e DataItems\n    DataItems --\u003e SetValue\n    \n    SetValue --\u003e ListWidget\n    ListWidget --\u003e|\"emits\"| OnChange\n    OnChange --\u003e|\"triggers\"| SAR\n```\n\n**Diagram: Array Setting Renderer Widget Flow**\n\nThe `ListSettingWidget` provides:\n- Add/remove/edit operations for array items\n- Drag-and-drop reordering\n- Validation for enum constraints and uniqueness\n- Key suggester for object-like arrays\n\nSources: [src/vs/workbench/contrib/preferences/browser/settingsTree.ts:1483-1675](), [src/vs/workbench/contrib/preferences/browser/settingsWidgets.ts:453-650]()\n\n## Tree Filtering and Search\n\n### Filter Integration\n\nThe tree supports multiple filter types:\n\n```mermaid\ngraph TB\n    ViewState[\"ISettingsEditorViewState\"]\n    \n    subgraph \"Filter Types\"\n        TagFilters[\"tagFilters: Set\u0026lt;string\u0026gt;\u003cbr/\u003e(@tag:preview, @modified, etc.)\"]\n        ExtFilters[\"extensionFilters: Set\u0026lt;string\u0026gt;\u003cbr/\u003e(@ext:microsoft.vscode)\"]\n        FeatureFilters[\"featureFilters: Set\u0026lt;string\u0026gt;\u003cbr/\u003e(@feature:terminal)\"]\n        IdFilters[\"idFilters: Set\u0026lt;string\u0026gt;\u003cbr/\u003e(@id:editor.fontSize)\"]\n        LangFilter[\"languageFilter: string\u003cbr/\u003e(@lang:typescript)\"]\n        TextQuery[\"query: string\u003cbr/\u003e(free text search)\"]\n    end\n    \n    TreeFilter[\"SettingsTreeFilter\"]\n    FilterResult[\"TreeFilterResult\"]\n    \n    ViewState --\u003e|\"contains\"| TagFilters\n    ViewState --\u003e|\"contains\"| ExtFilters\n    ViewState --\u003e|\"contains\"| FeatureFilters\n    ViewState --\u003e|\"contains\"| IdFilters\n    ViewState --\u003e|\"contains\"| LangFilter\n    ViewState --\u003e|\"contains\"| TextQuery\n    \n    ViewState --\u003e TreeFilter\n    TreeFilter --\u003e|\"produces\"| FilterResult\n    \n    FilterResult --\u003e|\"Visible\"| ShowElement[\"Show Element\"]\n    FilterResult --\u003e|\"Recurse\"| CheckChildren[\"Check Children\"]\n    FilterResult --\u003e|\"Hidden\"| HideElement[\"Hide Element\"]\n```\n\n**Diagram: Tree Filter Architecture**\n\n`SettingsTreeFilter` implements `ITreeFilter\u003cSettingsTreeElement\u003e`:\n\n```typescript\nfilter(element: SettingsTreeElement, parentVisibility: TreeVisibility): TreeFilterResult\u003cvoid\u003e {\n    // Groups are always potentially visible (recurse to children)\n    if (element instanceof SettingsTreeGroupElement) {\n        return TreeVisibility.Recurse;\n    }\n    \n    if (element instanceof SettingsTreeSettingElement) {\n        // Apply language filter\n        if (this.viewState.languageFilter \u0026\u0026 !matchesLanguage(...)) {\n            return TreeVisibility.Hidden;\n        }\n        \n        // Check tag filters (modified, policy, etc.)\n        if (this.viewState.tagFilters \u0026\u0026 !element.matchesAllTags(...)) {\n            return TreeVisibility.Hidden;\n        }\n        \n        // Apply extension and feature filters\n        // ...\n        \n        return TreeVisibility.Visible;\n    }\n    \n    return TreeVisibility.Visible;\n}\n```\n\nSources: [src/vs/workbench/contrib/preferences/browser/settingsTree.ts:1876-2053]()\n\n### Search Result Rendering\n\nWhen a search is active, `SearchResultModel` flattens the tree:\n\n1. **Matching Settings**: `filterMatches` contains settings that match query\n2. **Flatten Groups**: Groups are flattened to show matching settings directly\n3. **Highlight Matches**: Match ranges are highlighted in the UI\n4. **Show Counts**: Group nodes show count of matching settings\n\nSources: [src/vs/workbench/contrib/preferences/browser/settingsTreeModels.ts:682-717]()\n\n## Change Handling and Persistence\n\n### Setting Change Event Flow\n\n```mermaid\nsequenceDiagram\n    participant User\n    participant Renderer\n    participant SettingTreeRenderers\n    participant SettingsEditor2\n    participant ConfigService\n    \n    User-\u003e\u003eRenderer: Modifies value (click, type, etc.)\n    Renderer-\u003e\u003eRenderer: Validate input\n    Renderer-\u003e\u003eSettingTreeRenderers: onDidChangeSetting.fire(event)\n    SettingTreeRenderers-\u003e\u003eSettingsEditor2: onDidChangeSetting.fire(event)\n    SettingsEditor2-\u003e\u003eSettingsEditor2: Schedule debounced update\n    SettingsEditor2-\u003e\u003eConfigService: updateValue(key, value, target)\n    ConfigService-\u003e\u003eConfigService: Write to settings.json\n    ConfigService--\u003e\u003eSettingsEditor2: onDidChangeConfiguration event\n    SettingsEditor2-\u003e\u003eSettingsEditor2: Update tree model\n```\n\n**Diagram: Setting Change Event Flow**\n\nThe change pipeline:\n\n1. **User Input**: Renderer widget detects change\n2. **Validation**: Renderer validates against schema\n3. **Event Emission**: `ISettingChangeEvent` emitted with:\n   - `key`: Setting identifier\n   - `value`: New value (or `undefined` for reset)\n   - `type`: Setting value type\n   - `manualReset`: Whether user explicitly reset\n4. **Debouncing**: Fast updates (toggle, enum) use 200ms delay; slow updates (text) use 1000ms\n5. **Persistence**: Configuration service writes to appropriate settings file\n6. **Model Update**: Tree re-inspects setting to show new value\n\nSources: [src/vs/workbench/contrib/preferences/browser/settingsEditor2.ts:1071-1144](), [src/vs/workbench/contrib/preferences/browser/settingsTree.ts:777-783]()\n\n## Validation System\n\nEach renderer can validate user input:\n\n```typescript\ninterface ISettingItemTemplate {\n    validationErrorMessageElement: HTMLElement;\n    onChange?: (value: T) =\u003e void;\n}\n\n// In renderer\nprivate renderValue(element: SettingsTreeSettingElement, template: ISettingTextItemTemplate) {\n    template.onChange = (value: string) =\u003e {\n        // Validate using schema validator\n        const validationError = element.setting.validator?.(value);\n        \n        if (validationError) {\n            // Show error message\n            template.containerElement.classList.add('invalid-input');\n            template.validationErrorMessageElement.textContent = validationError;\n        } else {\n            // Clear error and emit change\n            template.containerElement.classList.remove('invalid-input');\n            this.onDidChangeSettingEmitter.fire({ key, value, /* ... */ });\n        }\n    };\n}\n```\n\nCommon validations:\n- **Type checking**: Ensure numeric values for number settings\n- **Range checking**: Min/max constraints from schema\n- **Pattern matching**: Regex validation for string settings\n- **Enum validation**: Value must be in allowed list\n- **Custom validators**: Setting-specific validation functions\n\nSources: [src/vs/workbench/contrib/preferences/browser/settingsTree.ts:1181-1247](), [src/vs/workbench/services/preferences/common/preferencesValidation.ts:1-100]()\n\n## Workspace Trust Integration\n\nSettings can be restricted in untrusted workspaces:\n\n```typescript\nclass SettingsTreeSettingElement {\n    isUntrusted = false;\n    \n    private update(inspectResult: IInspectResult, isWorkspaceTrusted: boolean): void {\n        const { targetSelector } = inspectResult;\n        \n        // Mark as untrusted if restricted setting in workspace scope\n        switch (targetSelector) {\n            case 'workspaceFolderValue':\n            case 'workspaceValue':\n                this.isUntrusted = !!this.setting.restricted \u0026\u0026 !isWorkspaceTrusted;\n                break;\n        }\n        \n        // Add tag for filtering\n        if (this.setting.restricted) {\n            this.tags.add(REQUIRE_TRUSTED_WORKSPACE_SETTING_TAG);\n        }\n    }\n}\n```\n\nWhen `isUntrusted` is true:\n- Setting is marked with workspace trust indicator\n- Modifications may be blocked or require confirmation\n- Special styling applied to indicate restriction\n\nSources: [src/vs/workbench/contrib/preferences/browser/settingsTreeModels.ts:294-304](), [src/vs/workbench/contrib/preferences/browser/settingsEditorSettingIndicators.ts:142-200]()\n\n## Key Files Reference\n\n| File | Primary Purpose |\n|------|-----------------|\n| `settingsTreeModels.ts` | Tree element classes, model construction, search integration |\n| `settingsTree.ts` | Tree widget, renderers for all setting types, filtering |\n| `settingsWidgets.ts` | Specialized input widgets (ListSettingWidget, ObjectSettingWidget, etc.) |\n| `settingsEditor2.ts` | Main editor coordinating model and tree |\n| `settingsLayout.ts` | TOC structure defining group hierarchy |\n| `settingsEditorSettingIndicators.ts` | Indicators for modified, policy, workspace trust settings |\n\nSources: [src/vs/workbench/contrib/preferences/browser/settingsTreeModels.ts:1-20](), [src/vs/workbench/contrib/preferences/browser/settingsTree.ts:1-100](), [src/vs/workbench/contrib/preferences/browser/settingsWidgets.ts:1-50]()"])</script><script>self.__next_f.push([1,"55:T6f57,"])</script><script>self.__next_f.push([1,"# Keybindings Editor\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [src/vs/workbench/api/browser/mainThreadAiSettingsSearch.ts](src/vs/workbench/api/browser/mainThreadAiSettingsSearch.ts)\n- [src/vs/workbench/api/common/extHostAiSettingsSearch.ts](src/vs/workbench/api/common/extHostAiSettingsSearch.ts)\n- [src/vs/workbench/contrib/preferences/browser/keybindingsEditor.ts](src/vs/workbench/contrib/preferences/browser/keybindingsEditor.ts)\n- [src/vs/workbench/contrib/preferences/browser/media/keybindingsEditor.css](src/vs/workbench/contrib/preferences/browser/media/keybindingsEditor.css)\n- [src/vs/workbench/contrib/preferences/browser/media/settingsEditor2.css](src/vs/workbench/contrib/preferences/browser/media/settingsEditor2.css)\n- [src/vs/workbench/contrib/preferences/browser/media/settingsWidgets.css](src/vs/workbench/contrib/preferences/browser/media/settingsWidgets.css)\n- [src/vs/workbench/contrib/preferences/browser/preferences.contribution.ts](src/vs/workbench/contrib/preferences/browser/preferences.contribution.ts)\n- [src/vs/workbench/contrib/preferences/browser/preferencesSearch.ts](src/vs/workbench/contrib/preferences/browser/preferencesSearch.ts)\n- [src/vs/workbench/contrib/preferences/browser/settingsEditor2.ts](src/vs/workbench/contrib/preferences/browser/settingsEditor2.ts)\n- [src/vs/workbench/contrib/preferences/browser/settingsEditorSettingIndicators.ts](src/vs/workbench/contrib/preferences/browser/settingsEditorSettingIndicators.ts)\n- [src/vs/workbench/contrib/preferences/browser/settingsTree.ts](src/vs/workbench/contrib/preferences/browser/settingsTree.ts)\n- [src/vs/workbench/contrib/preferences/browser/settingsTreeModels.ts](src/vs/workbench/contrib/preferences/browser/settingsTreeModels.ts)\n- [src/vs/workbench/contrib/preferences/browser/settingsWidgets.ts](src/vs/workbench/contrib/preferences/browser/settingsWidgets.ts)\n- [src/vs/workbench/contrib/preferences/browser/tocTree.ts](src/vs/workbench/contrib/preferences/browser/tocTree.ts)\n- [src/vs/workbench/contrib/preferences/common/preferences.ts](src/vs/workbench/contrib/preferences/common/preferences.ts)\n- [src/vs/workbench/contrib/preferences/common/preferencesContribution.ts](src/vs/workbench/contrib/preferences/common/preferencesContribution.ts)\n- [src/vs/workbench/services/aiSettingsSearch/common/aiSettingsSearch.ts](src/vs/workbench/services/aiSettingsSearch/common/aiSettingsSearch.ts)\n- [src/vs/workbench/services/aiSettingsSearch/common/aiSettingsSearchService.ts](src/vs/workbench/services/aiSettingsSearch/common/aiSettingsSearchService.ts)\n- [src/vs/workbench/services/preferences/browser/keybindingsEditorModel.ts](src/vs/workbench/services/preferences/browser/keybindingsEditorModel.ts)\n- [src/vs/workbench/services/preferences/browser/preferencesService.ts](src/vs/workbench/services/preferences/browser/preferencesService.ts)\n- [src/vs/workbench/services/preferences/common/preferences.ts](src/vs/workbench/services/preferences/common/preferences.ts)\n- [src/vs/workbench/services/preferences/common/preferencesModels.ts](src/vs/workbench/services/preferences/common/preferencesModels.ts)\n- [src/vs/workbench/services/preferences/test/browser/keybindingsEditorModel.test.ts](src/vs/workbench/services/preferences/test/browser/keybindingsEditorModel.test.ts)\n- [src/vscode-dts/vscode.proposed.aiSettingsSearch.d.ts](src/vscode-dts/vscode.proposed.aiSettingsSearch.d.ts)\n\n\u003c/details\u003e\n\n\n\nThe Keybindings Editor is a specialized editor pane that provides a graphical interface for viewing, searching, and managing keyboard shortcuts in VS Code. It presents all keybindings in a searchable table format and allows users to add, edit, remove, or reset keybindings without directly editing JSON files.\n\nFor information about the Settings Editor, see [Settings Editor Architecture](#11.1). For information about the general preferences service, see the preferences service documentation.\n\n## Architecture Overview\n\nThe Keybindings Editor follows a model-view-controller pattern with clear separation between data processing, UI rendering, and user interactions.\n\n```mermaid\ngraph TB\n    subgraph \"Editor Layer\"\n        KeybindingsEditor[\"KeybindingsEditor\u003cbr/\u003e(EditorPane)\"]\n        KeybindingsEditorInput[\"KeybindingsEditorInput\"]\n    end\n    \n    subgraph \"Model Layer\"\n        KeybindingsEditorModel[\"KeybindingsEditorModel\u003cbr/\u003e(EditorModel)\"]\n        IKeybindingItem[\"IKeybindingItem\"]\n        IKeybindingItemEntry[\"IKeybindingItemEntry\"]\n    end\n    \n    subgraph \"UI Components\"\n        SearchWidget[\"KeybindingsSearchWidget\"]\n        Table[\"WorkbenchTable\u0026lt;IKeybindingItemEntry\u0026gt;\"]\n        DefineWidget[\"DefineKeybindingWidget\"]\n        Renderers[\"ActionsColumnRenderer\u003cbr/\u003eCommandColumnRenderer\u003cbr/\u003eKeybindingColumnRenderer\u003cbr/\u003eSourceColumnRenderer\u003cbr/\u003eWhenColumnRenderer\"]\n    end\n    \n    subgraph \"Services\"\n        IKeybindingService[\"IKeybindingService\"]\n        IKeybindingEditingService[\"IKeybindingEditingService\"]\n        IExtensionService[\"IExtensionService\"]\n    end\n    \n    KeybindingsEditor --\u003e KeybindingsEditorModel\n    KeybindingsEditorInput --\u003e KeybindingsEditorModel\n    KeybindingsEditor --\u003e SearchWidget\n    KeybindingsEditor --\u003e Table\n    KeybindingsEditor --\u003e DefineWidget\n    Table --\u003e Renderers\n    \n    KeybindingsEditorModel --\u003e IKeybindingService\n    KeybindingsEditorModel --\u003e IExtensionService\n    KeybindingsEditorModel --\u003e IKeybindingItem\n    IKeybindingItem --\u003e IKeybindingItemEntry\n    \n    KeybindingsEditor --\u003e IKeybindingEditingService\n```\n\n**Components:**\n- **KeybindingsEditor**: Main editor pane that orchestrates UI and user interactions\n- **KeybindingsEditorModel**: Data model that processes and filters keybindings\n- **KeybindingsSearchWidget**: Search input with recording capability\n- **WorkbenchTable**: Table view displaying keybindings with sortable columns\n- **DefineKeybindingWidget**: Overlay widget for recording key combinations\n\nSources: [src/vs/workbench/contrib/preferences/browser/keybindingsEditor.ts:74-151](), [src/vs/workbench/services/preferences/browser/keybindingsEditorModel.ts:1-50]()\n\n## KeybindingsEditor Class\n\nThe `KeybindingsEditor` class is the main entry point for the keybindings editor UI. It extends `EditorPane` and manages the complete lifecycle of the editor.\n\n```mermaid\ngraph TB\n    KeybindingsEditor[\"KeybindingsEditor\"]\n    \n    subgraph \"State Management\"\n        keybindingsEditorModel[\"keybindingsEditorModel:\u003cbr/\u003eKeybindingsEditorModel\"]\n        tableEntries[\"tableEntries:\u003cbr/\u003eIKeybindingItemEntry[]\"]\n        dimension[\"dimension:\u003cbr/\u003eDOM.Dimension\"]\n    end\n    \n    subgraph \"Context Keys\"\n        keybindingsEditorContextKey[\"CONTEXT_KEYBINDINGS_EDITOR\"]\n        searchFocusContextKey[\"CONTEXT_KEYBINDINGS_SEARCH_FOCUS\"]\n        keybindingFocusContextKey[\"CONTEXT_KEYBINDING_FOCUS\"]\n        searchHasValueContextKey[\"CONTEXT_KEYBINDINGS_SEARCH_HAS_VALUE\"]\n    end\n    \n    subgraph \"UI Elements\"\n        headerContainer[\"headerContainer\"]\n        searchWidget[\"searchWidget:\u003cbr/\u003eKeybindingsSearchWidget\"]\n        actionsContainer[\"actionsContainer:\u003cbr/\u003eAction buttons\"]\n        keybindingsTable[\"keybindingsTable:\u003cbr/\u003eWorkbenchTable\"]\n        overlayContainer[\"overlayContainer\"]\n        defineKeybindingWidget[\"defineKeybindingWidget\"]\n    end\n    \n    subgraph \"Actions\"\n        sortByPrecedenceAction[\"sortByPrecedenceAction\"]\n        recordKeysAction[\"recordKeysAction\"]\n    end\n    \n    KeybindingsEditor --\u003e keybindingsEditorModel\n    KeybindingsEditor --\u003e tableEntries\n    KeybindingsEditor --\u003e headerContainer\n    KeybindingsEditor --\u003e keybindingsTable\n    KeybindingsEditor --\u003e defineKeybindingWidget\n    \n    headerContainer --\u003e searchWidget\n    headerContainer --\u003e actionsContainer\n    actionsContainer --\u003e sortByPrecedenceAction\n    actionsContainer --\u003e recordKeysAction\n```\n\n**Key Responsibilities:**\n- Creating and managing the table view\n- Handling search and filtering operations\n- Managing context keys for command enablement\n- Coordinating keybinding editing operations\n- Responding to keybinding service updates\n\nSources: [src/vs/workbench/contrib/preferences/browser/keybindingsEditor.ts:74-151](), [src/vs/workbench/contrib/preferences/browser/keybindingsEditor.ts:153-178]()\n\n## Data Model: KeybindingsEditorModel\n\nThe `KeybindingsEditorModel` is responsible for fetching, processing, and filtering keybindings from the keybinding service.\n\n```mermaid\ngraph LR\n    subgraph \"Input Sources\"\n        IKeybindingService[\"IKeybindingService\u003cbr/\u003egetKeybindings()\"]\n        IExtensionService[\"IExtensionService\u003cbr/\u003eextensions\"]\n        UnboundCommands[\"getAllUnboundCommands()\"]\n    end\n    \n    subgraph \"KeybindingsEditorModel\"\n        resolve[\"resolve()\u003cbr/\u003eProcess keybindings\"]\n        fetch[\"fetch(searchValue)\u003cbr/\u003eFilter \u0026 search\"]\n        _keybindingItemsSortedByPrecedence[\"_keybindingItemsSortedByPrecedence\"]\n        _keybindingItems[\"_keybindingItems\"]\n    end\n    \n    subgraph \"Output\"\n        IKeybindingItemEntry[\"IKeybindingItemEntry[]\u003cbr/\u003eFiltered results\"]\n    end\n    \n    subgraph \"Processing Steps\"\n        ResolvedKeybindingItem[\"ResolvedKeybindingItem\"]\n        IKeybindingItem[\"IKeybindingItem\u003cbr/\u003e(command, keybinding, when, source)\"]\n        ExtensionInfo[\"Add extension info\"]\n        FilterMatch[\"Apply search filters\"]\n    end\n    \n    IKeybindingService --\u003e resolve\n    IExtensionService --\u003e resolve\n    UnboundCommands --\u003e resolve\n    \n    resolve --\u003e ResolvedKeybindingItem\n    ResolvedKeybindingItem --\u003e IKeybindingItem\n    IKeybindingItem --\u003e ExtensionInfo\n    ExtensionInfo --\u003e _keybindingItemsSortedByPrecedence\n    ExtensionInfo --\u003e _keybindingItems\n    \n    _keybindingItemsSortedByPrecedence --\u003e fetch\n    _keybindingItems --\u003e fetch\n    fetch --\u003e FilterMatch\n    FilterMatch --\u003e IKeybindingItemEntry\n```\n\n**Data Structures:**\n\nThe model works with three key data types:\n\n1. **ResolvedKeybindingItem**: Raw keybinding from the keybinding service [keybindingsEditorModel.ts:16]()\n2. **IKeybindingItem**: Processed keybinding with labels and extension info [preferences.ts:310-318]()\n3. **IKeybindingItemEntry**: Keybinding with search match information [preferences.ts:296-308]()\n\nSources: [src/vs/workbench/services/preferences/browser/keybindingsEditorModel.ts:29-80](), [src/vs/workbench/services/preferences/common/preferences.ts:310-318]()\n\n### Model Resolution Process\n\n```mermaid\nsequenceDiagram\n    participant Client\n    participant Model as KeybindingsEditorModel\n    participant KS as IKeybindingService\n    participant ES as IExtensionService\n    \n    Client-\u003e\u003eModel: resolve()\n    Model-\u003e\u003eKS: getKeybindings()\n    KS--\u003e\u003eModel: ResolvedKeybindingItem[]\n    \n    Model-\u003e\u003eModel: Create IKeybindingItem objects\n    Model-\u003e\u003eES: getExtensions()\n    ES--\u003e\u003eModel: Extension descriptions\n    \n    Model-\u003e\u003eModel: Map commands to extensions\n    Model-\u003e\u003eModel: Add extension metadata\n    Model-\u003e\u003eModel: Sort by precedence\n    \n    Model-\u003e\u003eModel: Add unbound commands\n    Model--\u003e\u003eClient: Ready for fetch()\n```\n\n**Resolution Steps:**\n1. Fetch all keybindings from `IKeybindingService.getKeybindings()` [keybindingsEditorModel.ts:87-88]()\n2. Create `IKeybindingItem` objects with resolved labels [keybindingsEditorModel.ts:93-145]()\n3. Map commands to extension sources using `IExtensionService` [keybindingsEditorModel.ts:147-165]()\n4. Add unbound commands (commands without keybindings) [keybindingsEditorModel.ts:179-185]()\n5. Sort by precedence for the precedence view [keybindingsEditorModel.ts:177]()\n\nSources: [src/vs/workbench/services/preferences/browser/keybindingsEditorModel.ts:82-185]()\n\n### Search and Filtering\n\nThe `fetch(searchValue: string)` method filters keybindings based on user search input:\n\n```mermaid\ngraph TB\n    fetch[\"fetch(searchValue)\"]\n    \n    subgraph \"Search Types\"\n        emptySearch[\"Empty search\u003cbr/\u003eReturn all\"]\n        sortByPrecedence[\"Sort by precedence\u003cbr/\u003eflag check\"]\n        recordedKeys[\"Recorded keys\u003cbr/\u003estarts with '@'\"]\n        extensionFilter[\"Extension filter\u003cbr/\u003e'@ext:'\"]\n        sourceFilter[\"Source filter\u003cbr/\u003e'@source:'\"]\n        textSearch[\"Text search\u003cbr/\u003ecommand/label/when\"]\n    end\n    \n    subgraph \"Matching Logic\"\n        KeybindingItemMatches[\"KeybindingItemMatches\u003cbr/\u003eMatch command\"]\n        commandMatches[\"matchesWords()\u003cbr/\u003ematchesCamelCase()\"]\n        keybindingMatches[\"matchesKeybinding()\"]\n        whenMatches[\"Match when clause\"]\n        sourceMatches[\"Match source\"]\n    end\n    \n    fetch --\u003e emptySearch\n    fetch --\u003e recordedKeys\n    fetch --\u003e extensionFilter\n    fetch --\u003e sourceFilter\n    fetch --\u003e textSearch\n    \n    textSearch --\u003e KeybindingItemMatches\n    KeybindingItemMatches --\u003e commandMatches\n    KeybindingItemMatches --\u003e keybindingMatches\n    KeybindingItemMatches --\u003e whenMatches\n    KeybindingItemMatches --\u003e sourceMatches\n```\n\n**Search Filters:**\n- **Empty search**: Returns all keybindings [keybindingsEditorModel.ts:191-192]()\n- **Sort by precedence**: Uses `_keybindingItemsSortedByPrecedence` [keybindingsEditorModel.ts:195-196]()\n- **Recorded keys** (`@...`): Filters by exact keybinding match [keybindingsEditorModel.ts:200-211]()\n- **Extension filter** (`@ext:extensionId`): Filters by extension ID [keybindingsEditorModel.ts:213-227]()\n- **Source filter** (`@source:user|default|extension`): Filters by keybinding source [keybindingsEditorModel.ts:229-250]()\n- **Text search**: Fuzzy matches against command ID, label, when clause [keybindingsEditorModel.ts:252-277]()\n\nSources: [src/vs/workbench/services/preferences/browser/keybindingsEditorModel.ts:188-278]()\n\n## UI Components\n\n### Table Structure\n\nThe keybindings are displayed in a `WorkbenchTable` with five columns:\n\n```mermaid\ngraph LR\n    subgraph \"WorkbenchTable Columns\"\n        ActionsColumn[\"Actions Column\u003cbr/\u003e(Edit/Remove buttons)\"]\n        CommandColumn[\"Command Column\u003cbr/\u003e(Command label + ID)\"]\n        KeybindingColumn[\"Keybinding Column\u003cbr/\u003e(Key combination)\"]\n        WhenColumn[\"When Column\u003cbr/\u003e(Context expression)\"]\n        SourceColumn[\"Source Column\u003cbr/\u003e(User/Default/Extension)\"]\n    end\n    \n    subgraph \"Renderers\"\n        ActionsColumnRenderer[\"ActionsColumnRenderer\u003cbr/\u003eEdit/Remove icons\"]\n        CommandColumnRenderer[\"CommandColumnRenderer\u003cbr/\u003eHighlighted label\"]\n        KeybindingColumnRenderer[\"KeybindingColumnRenderer\u003cbr/\u003eKeybindingLabel widget\"]\n        WhenColumnRenderer[\"WhenColumnRenderer\u003cbr/\u003eCode block styling\"]\n        SourceColumnRenderer[\"SourceColumnRenderer\u003cbr/\u003eExtension name\"]\n    end\n    \n    ActionsColumn --\u003e ActionsColumnRenderer\n    CommandColumn --\u003e CommandColumnRenderer\n    KeybindingColumn --\u003e KeybindingColumnRenderer\n    WhenColumn --\u003e WhenColumnRenderer\n    SourceColumn --\u003e SourceColumnRenderer\n```\n\n**Column Renderers:**\n\n| Column | Renderer | Purpose |\n|--------|----------|---------|\n| Actions | `ActionsColumnRenderer` | Edit and remove action icons |\n| Command | `CommandColumnRenderer` | Command label with highlighted search matches |\n| Keybinding | `KeybindingColumnRenderer` | Key combination using `KeybindingLabel` widget |\n| When | `WhenColumnRenderer` | Context expression with code styling |\n| Source | `SourceColumnRenderer` | Extension or built-in source label |\n\nSources: [src/vs/workbench/contrib/preferences/browser/keybindingsEditor.ts:464-660]()\n\n### KeybindingsSearchWidget\n\nThe search widget provides specialized search capabilities for keybindings:\n\n```mermaid\ngraph TB\n    KeybindingsSearchWidget[\"KeybindingsSearchWidget\u003cbr/\u003e(SuggestEnabledInput)\"]\n    \n    subgraph \"Features\"\n        recordKeys[\"startRecordingKeys()\u003cbr/\u003eListen for keypresses\"]\n        stopRecording[\"stopRecordingKeys()\u003cbr/\u003eStop listening\"]\n        suggestions[\"Suggest filters\u003cbr/\u003e@ext:, @source:\"]\n        history[\"Search history\u003cbr/\u003eSet\u0026lt;string\u0026gt;\"]\n    end\n    \n    subgraph \"Recording Mode\"\n        recordingDisposables[\"Recording disposables\"]\n        keydownHandler[\"Keydown handler\"]\n        keycodeFormatter[\"Format to 'ctrl+k ctrl+s'\"]\n    end\n    \n    KeybindingsSearchWidget --\u003e recordKeys\n    KeybindingsSearchWidget --\u003e stopRecording\n    KeybindingsSearchWidget --\u003e suggestions\n    KeybindingsSearchWidget --\u003e history\n    \n    recordKeys --\u003e recordingDisposables\n    recordKeys --\u003e keydownHandler\n    keydownHandler --\u003e keycodeFormatter\n```\n\n**Key Features:**\n- **Recording mode**: Captures keyboard input and formats as keybinding string [keybindingWidgets.ts:71-123]()\n- **Search history**: Stores previous searches in storage service [keybindingWidgets.ts:50-57]()\n- **Filter suggestions**: Provides autocomplete for `@ext:` and `@source:` filters [keybindingWidgets.ts:131-163]()\n\nWhen recording keys, the widget:\n1. Listens for keydown events on the input box [keybindingWidgets.ts:86]()\n2. Formats the key press as a chord string (e.g., \"ctrl+k ctrl+s\") [keybindingWidgets.ts:97-110]()\n3. Updates the input value with recorded keys [keybindingWidgets.ts:111-113]()\n\nSources: [src/vs/workbench/contrib/preferences/browser/keybindingWidgets.ts:19-175]()\n\n### DefineKeybindingWidget\n\nThe `DefineKeybindingWidget` appears as an overlay when defining or editing a keybinding:\n\n```mermaid\ngraph TB\n    DefineKeybindingWidget[\"DefineKeybindingWidget\"]\n    \n    subgraph \"UI Elements\"\n        overlayMessage[\"Overlay message\u003cbr/\u003e'Press desired key combination'\"]\n        existingKeybindings[\"Existing keybindings display\"]\n        keybindingInput[\"SuggestEnabledInput\u003cbr/\u003ewith recording\"]\n        buttons[\"Define/Cancel buttons\"]\n    end\n    \n    subgraph \"Workflow\"\n        define[\"define():\u003cbr/\u003ePromise\u0026lt;string | null\u0026gt;\"]\n        startRecording[\"Start recording keys\"]\n        showExisting[\"printExisting(n keybindings)\"]\n        userAccepts[\"User clicks Define\"]\n        userCancels[\"User clicks Cancel/Esc\"]\n    end\n    \n    DefineKeybindingWidget --\u003e overlayMessage\n    DefineKeybindingWidget --\u003e existingKeybindings\n    DefineKeybindingWidget --\u003e keybindingInput\n    DefineKeybindingWidget --\u003e buttons\n    \n    define --\u003e startRecording\n    define --\u003e showExisting\n    define --\u003e userAccepts\n    define --\u003e userCancels\n    \n    userAccepts --\u003e resolve[\"Resolve with keybinding\"]\n    userCancels --\u003e reject[\"Reject promise\"]\n```\n\n**Define Workflow:**\n1. User triggers define action (edit/add keybinding)\n2. Overlay appears with recording input [keybindingWidgets.ts:263-280]()\n3. As user types keys, widget checks for conflicts [keybindingWidgets.ts:291-295]()\n4. Widget displays count of existing keybindings with same chord [keybindingWidgets.ts:287-289]()\n5. User can view existing or confirm new keybinding [keybindingWidgets.ts:297-305]()\n\nSources: [src/vs/workbench/contrib/preferences/browser/keybindingWidgets.ts:177-370]()\n\n## Editing Operations\n\nThe editor provides several keybinding modification operations through the `IKeybindingEditingService`:\n\n```mermaid\nsequenceDiagram\n    participant User\n    participant Editor as KeybindingsEditor\n    participant DefineWidget as DefineKeybindingWidget\n    participant EditService as IKeybindingEditingService\n    participant JSON as keybindings.json\n    \n    User-\u003e\u003eEditor: Click edit icon\n    Editor-\u003e\u003eEditor: selectEntry(keybinding)\n    Editor-\u003e\u003eDefineWidget: define()\n    DefineWidget--\u003e\u003eUser: Show overlay\n    \n    User-\u003e\u003eDefineWidget: Press keys\n    DefineWidget--\u003e\u003eDefineWidget: Check conflicts\n    DefineWidget--\u003e\u003eUser: Show existing count\n    \n    User-\u003e\u003eDefineWidget: Click Define\n    DefineWidget--\u003e\u003eEditor: Return keybinding string\n    \n    Editor-\u003e\u003eEditService: editKeybinding(item, key, when)\n    EditService-\u003e\u003eJSON: Update keybindings.json\n    JSON--\u003e\u003eEditService: Success\n    EditService--\u003e\u003eEditor: Complete\n    \n    Editor-\u003e\u003eEditor: render(preserveFocus)\n```\n\n### Edit Operations\n\n**Define/Edit Keybinding:**\n```typescript\nasync defineKeybinding(keybindingEntry: IKeybindingItemEntry, add: boolean): Promise\u003cvoid\u003e\n```\n1. Show overlay with define widget [keybindingsEditor.ts:220-234]()\n2. Wait for user to record key combination\n3. Call `keybindingEditingService.editKeybinding()` or `addKeybinding()` [keybindingsEditor.ts:226]()\n4. Re-render table with updated keybindings\n\n**Remove Keybinding:**\n```typescript\nasync removeKeybinding(keybindingEntry: IKeybindingItemEntry): Promise\u003cvoid\u003e\n```\n- Calls `keybindingEditingService.removeKeybinding()` [keybindingsEditor.ts:269]()\n- Removes the user-defined keybinding from `keybindings.json`\n\n**Reset Keybinding:**\n```typescript\nasync resetKeybinding(keybindingEntry: IKeybindingItemEntry): Promise\u003cvoid\u003e\n```\n- Calls `keybindingEditingService.resetKeybinding()` [keybindingsEditor.ts:281]()\n- Removes user override and restores default keybinding\n\n**Copy Keybinding:**\n```typescript\nasync copyKeybinding(keybinding: IKeybindingItemEntry): Promise\u003cvoid\u003e\n```\n- Formats keybinding as JSON object [keybindingsEditor.ts:292-301]()\n- Copies to clipboard for manual editing\n\nSources: [src/vs/workbench/contrib/preferences/browser/keybindingsEditor.ts:220-312]()\n\n### When Expression Editing\n\nUsers can define or edit the \"when\" context expression for a keybinding:\n\n```mermaid\ngraph TB\n    defineWhenExpression[\"defineWhenExpression()\"]\n    \n    subgraph \"When Expression Editor\"\n        onDefineWhenExpression[\"onDefineWhenExpression event\"]\n        SuggestEnabledInput[\"SuggestEnabledInput\u003cbr/\u003ewith context key suggestions\"]\n        acceptWhen[\"acceptWhenExpression()\"]\n        rejectWhen[\"rejectWhenExpression()\"]\n    end\n    \n    subgraph \"Integration\"\n        PreferencesEditor[\"PreferencesEditor\u003cbr/\u003e(container)\"]\n        WhenEditor[\"When expression input\"]\n        updateKeybinding[\"updateKeybinding(entry, key, when)\"]\n    end\n    \n    defineWhenExpression --\u003e onDefineWhenExpression\n    onDefineWhenExpression --\u003e PreferencesEditor\n    PreferencesEditor --\u003e WhenEditor\n    PreferencesEditor --\u003e SuggestEnabledInput\n    \n    acceptWhen --\u003e updateKeybinding\n    rejectWhen --\u003e PreferencesEditor\n```\n\nWhen clause editing:\n1. User clicks \"Define When Expression\" [keybindingsEditor.ts:236-241]()\n2. Editor fires `onDefineWhenExpression` event [keybindingsEditor.ts:239]()\n3. Container editor shows input for when clause [preferencesEditor.ts:183-254]()\n4. User edits with context key suggestions\n5. User accepts or rejects the expression [keybindingsEditor.ts:243-249]()\n\nSources: [src/vs/workbench/contrib/preferences/browser/keybindingsEditor.ts:236-249](), [src/vs/workbench/contrib/preferences/browser/preferencesEditor.ts:183-254]()\n\n## Context Keys and Commands\n\nThe editor uses context keys to control command enablement:\n\n| Context Key | Purpose |\n|-------------|---------|\n| `CONTEXT_KEYBINDINGS_EDITOR` | Editor is open |\n| `CONTEXT_KEYBINDINGS_SEARCH_FOCUS` | Search widget has focus |\n| `CONTEXT_KEYBINDING_FOCUS` | Keybinding row has focus |\n| `CONTEXT_WHEN_FOCUS` | When expression editor has focus |\n| `CONTEXT_KEYBINDINGS_SEARCH_HAS_VALUE` | Search has input |\n\n**Commands:**\n\n| Command ID | Action |\n|------------|--------|\n| `KEYBINDINGS_EDITOR_COMMAND_DEFINE` | Define keybinding |\n| `KEYBINDINGS_EDITOR_COMMAND_ADD` | Add keybinding |\n| `KEYBINDINGS_EDITOR_COMMAND_REMOVE` | Remove keybinding |\n| `KEYBINDINGS_EDITOR_COMMAND_RESET` | Reset to default |\n| `KEYBINDINGS_EDITOR_COMMAND_COPY` | Copy as JSON |\n| `KEYBINDINGS_EDITOR_COMMAND_SEARCH` | Focus search |\n| `KEYBINDINGS_EDITOR_COMMAND_DEFINE_WHEN` | Define when expression |\n| `KEYBINDINGS_EDITOR_COMMAND_RECORD_SEARCH_KEYS` | Toggle recording mode |\n| `KEYBINDINGS_EDITOR_COMMAND_SORTBY_PRECEDENCE` | Sort by precedence |\n\nSources: [src/vs/workbench/contrib/preferences/common/preferences.ts:73-95](), [src/vs/workbench/contrib/preferences/browser/preferences.contribution.ts:546-824]()\n\n## Rendering and Layout\n\nThe editor handles rendering in response to keybinding service changes:\n\n```mermaid\ngraph TB\n    render[\"render(preserveFocus)\"]\n    \n    subgraph \"Render Steps\"\n        resolve[\"model.resolve()\"]\n        fetch[\"model.fetch(searchValue)\"]\n        sort[\"Sort entries\"]\n        updateTable[\"keybindingsTable.splice()\"]\n        reveal[\"Reveal unassigned item\"]\n        updateAria[\"Update aria label\"]\n    end\n    \n    subgraph \"Triggers\"\n        onDidUpdateKeybindings[\"keybindingsService.onDidUpdateKeybindings\"]\n        userSearch[\"User search input\"]\n        userSort[\"Toggle sort by precedence\"]\n    end\n    \n    onDidUpdateKeybindings --\u003e render\n    userSearch --\u003e render\n    userSort --\u003e render\n    \n    render --\u003e resolve\n    resolve --\u003e fetch\n    fetch --\u003e sort\n    sort --\u003e updateTable\n    updateTable --\u003e reveal\n    reveal --\u003e updateAria\n```\n\n**Layout Process:**\n1. `layout(dimension)` called with editor dimensions [keybindingsEditor.ts:192-202]()\n2. Search widget layout updated [keybindingsEditor.ts:194]()\n3. Define widget layout updated [keybindingsEditor.ts:198]()\n4. Table layout computed and applied [keybindingsEditor.ts:442-462]()\n\n**Table Dimensions:**\n- Actions column: Fixed 50px\n- Command column: 40% of remaining width\n- Keybinding column: 25% of remaining width\n- When column: 25% of remaining width\n- Source column: 10% of remaining width\n\nSources: [src/vs/workbench/contrib/preferences/browser/keybindingsEditor.ts:192-202](), [src/vs/workbench/contrib/preferences/browser/keybindingsEditor.ts:442-462]()\n\n## Integration with Services\n\n### IKeybindingService\n\nThe keybindings editor reads keybindings from `IKeybindingService`:\n\n```mermaid\ngraph LR\n    IKeybindingService[\"IKeybindingService\"]\n    \n    subgraph \"Methods Used\"\n        getKeybindings[\"getKeybindings()\u003cbr/\u003eAll registered keybindings\"]\n        getDefaultKeybindings[\"getDefaultKeybindings()\u003cbr/\u003eDefault keybindings\"]\n        lookupKeybinding[\"lookupKeybinding(command)\u003cbr/\u003eFind keybinding for command\"]\n    end\n    \n    subgraph \"Events\"\n        onDidUpdateKeybindings[\"onDidUpdateKeybindings\u003cbr/\u003eKeybindings changed\"]\n    end\n    \n    IKeybindingService --\u003e getKeybindings\n    IKeybindingService --\u003e getDefaultKeybindings\n    IKeybindingService --\u003e lookupKeybinding\n    IKeybindingService --\u003e onDidUpdateKeybindings\n    \n    getKeybindings --\u003e KeybindingsEditorModel\n    onDidUpdateKeybindings --\u003e render[\"KeybindingsEditor.render()\"]\n```\n\nSources: [src/vs/workbench/services/preferences/browser/keybindingsEditorModel.ts:87-88](), [src/vs/workbench/contrib/preferences/browser/keybindingsEditor.ts:137]()\n\n### IKeybindingEditingService\n\nAll keybinding modifications go through `IKeybindingEditingService`:\n\n```mermaid\ngraph TB\n    IKeybindingEditingService[\"IKeybindingEditingService\"]\n    \n    subgraph \"Edit Methods\"\n        editKeybinding[\"editKeybinding(item, key, when)\u003cbr/\u003eUpdate existing keybinding\"]\n        addKeybinding[\"addKeybinding(item, key, when)\u003cbr/\u003eAdd new keybinding\"]\n        removeKeybinding[\"removeKeybinding(item)\u003cbr/\u003eRemove user keybinding\"]\n        resetKeybinding[\"resetKeybinding(item)\u003cbr/\u003eReset to default\"]\n    end\n    \n    subgraph \"File Operations\"\n        keybindingsJSON[\"keybindings.json\u003cbr/\u003eUser keybindings file\"]\n        IJSONEditingService[\"IJSONEditingService\u003cbr/\u003eJSON file editing\"]\n    end\n    \n    editKeybinding --\u003e IJSONEditingService\n    addKeybinding --\u003e IJSONEditingService\n    removeKeybinding --\u003e IJSONEditingService\n    resetKeybinding --\u003e IJSONEditingService\n    \n    IJSONEditingService --\u003e keybindingsJSON\n```\n\nThe editing service validates keybindings and updates the user's `keybindings.json` file. After changes, the keybinding service reloads and the editor re-renders.\n\nSources: [src/vs/workbench/contrib/preferences/browser/keybindingsEditor.ts:220-290]()\n\n### Extension Integration\n\nKeybindings contributed by extensions are tracked via `IExtensionService`:\n\n```mermaid\ngraph TB\n    IExtensionService[\"IExtensionService\"]\n    \n    subgraph \"Extension Data\"\n        getExtensions[\"getExtensions()\u003cbr/\u003eAll extension descriptions\"]\n        contributes[\"extension.contributes.keybindings\"]\n        commandsMap[\"Commands to extension map\"]\n    end\n    \n    subgraph \"KeybindingsEditorModel\"\n        resolveExtension[\"resolveExtension()\u003cbr/\u003eMap command to extension\"]\n        extensionIdToLabel[\"extensionIdToLabel()\u003cbr/\u003eExtension display name\"]\n    end\n    \n    IExtensionService --\u003e getExtensions\n    getExtensions --\u003e commandsMap\n    commandsMap --\u003e resolveExtension\n    resolveExtension --\u003e extensionIdToLabel\n```\n\nThe model creates a map of commands to extensions [keybindingsEditorModel.ts:147-165]() to show which extension contributed each keybinding.\n\nSources: [src/vs/workbench/services/preferences/browser/keybindingsEditorModel.ts:147-165]()"])</script><script>self.__next_f.push([1,"56:T61db,"])</script><script>self.__next_f.push([1,"# Preferences Service and Search\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [src/vs/workbench/api/browser/mainThreadAiSettingsSearch.ts](src/vs/workbench/api/browser/mainThreadAiSettingsSearch.ts)\n- [src/vs/workbench/api/common/extHostAiSettingsSearch.ts](src/vs/workbench/api/common/extHostAiSettingsSearch.ts)\n- [src/vs/workbench/contrib/preferences/browser/keybindingsEditor.ts](src/vs/workbench/contrib/preferences/browser/keybindingsEditor.ts)\n- [src/vs/workbench/contrib/preferences/browser/media/keybindingsEditor.css](src/vs/workbench/contrib/preferences/browser/media/keybindingsEditor.css)\n- [src/vs/workbench/contrib/preferences/browser/media/settingsEditor2.css](src/vs/workbench/contrib/preferences/browser/media/settingsEditor2.css)\n- [src/vs/workbench/contrib/preferences/browser/media/settingsWidgets.css](src/vs/workbench/contrib/preferences/browser/media/settingsWidgets.css)\n- [src/vs/workbench/contrib/preferences/browser/preferences.contribution.ts](src/vs/workbench/contrib/preferences/browser/preferences.contribution.ts)\n- [src/vs/workbench/contrib/preferences/browser/preferencesSearch.ts](src/vs/workbench/contrib/preferences/browser/preferencesSearch.ts)\n- [src/vs/workbench/contrib/preferences/browser/settingsEditor2.ts](src/vs/workbench/contrib/preferences/browser/settingsEditor2.ts)\n- [src/vs/workbench/contrib/preferences/browser/settingsEditorSettingIndicators.ts](src/vs/workbench/contrib/preferences/browser/settingsEditorSettingIndicators.ts)\n- [src/vs/workbench/contrib/preferences/browser/settingsTree.ts](src/vs/workbench/contrib/preferences/browser/settingsTree.ts)\n- [src/vs/workbench/contrib/preferences/browser/settingsTreeModels.ts](src/vs/workbench/contrib/preferences/browser/settingsTreeModels.ts)\n- [src/vs/workbench/contrib/preferences/browser/settingsWidgets.ts](src/vs/workbench/contrib/preferences/browser/settingsWidgets.ts)\n- [src/vs/workbench/contrib/preferences/browser/tocTree.ts](src/vs/workbench/contrib/preferences/browser/tocTree.ts)\n- [src/vs/workbench/contrib/preferences/common/preferences.ts](src/vs/workbench/contrib/preferences/common/preferences.ts)\n- [src/vs/workbench/contrib/preferences/common/preferencesContribution.ts](src/vs/workbench/contrib/preferences/common/preferencesContribution.ts)\n- [src/vs/workbench/services/aiSettingsSearch/common/aiSettingsSearch.ts](src/vs/workbench/services/aiSettingsSearch/common/aiSettingsSearch.ts)\n- [src/vs/workbench/services/aiSettingsSearch/common/aiSettingsSearchService.ts](src/vs/workbench/services/aiSettingsSearch/common/aiSettingsSearchService.ts)\n- [src/vs/workbench/services/preferences/browser/keybindingsEditorModel.ts](src/vs/workbench/services/preferences/browser/keybindingsEditorModel.ts)\n- [src/vs/workbench/services/preferences/browser/preferencesService.ts](src/vs/workbench/services/preferences/browser/preferencesService.ts)\n- [src/vs/workbench/services/preferences/common/preferences.ts](src/vs/workbench/services/preferences/common/preferences.ts)\n- [src/vs/workbench/services/preferences/common/preferencesModels.ts](src/vs/workbench/services/preferences/common/preferencesModels.ts)\n- [src/vs/workbench/services/preferences/test/browser/keybindingsEditorModel.test.ts](src/vs/workbench/services/preferences/test/browser/keybindingsEditorModel.test.ts)\n- [src/vscode-dts/vscode.proposed.aiSettingsSearch.d.ts](src/vscode-dts/vscode.proposed.aiSettingsSearch.d.ts)\n\n\u003c/details\u003e\n\n\n\nThis document covers the preferences service (`IPreferencesService`) and the search infrastructure for the settings editor. It explains how settings and keybindings are opened, how search queries are processed through multiple providers, and how AI-powered search is integrated.\n\nFor information about the settings editor UI and tree rendering, see [Settings Editor Architecture](#11.1) and [Settings Tree Model and Rendering](#11.2). For keybindings-specific functionality, see [Keybindings Editor](#11.3).\n\n## IPreferencesService Overview\n\nThe `IPreferencesService` is the central service for opening and managing preferences-related editors. It provides methods to open settings at different scopes (user, workspace, folder), create preference editor models, and manage settings resources.\n\n**Key Responsibilities:**\n- Opening settings editors at various configuration targets (user local, remote, workspace, folder, application)\n- Creating and managing settings editor models (`Settings2EditorModel`, `SettingsEditorModel`)\n- Resolving settings file URIs for different scopes\n- Opening keybindings editors\n- Managing language-specific settings\n- Creating split JSON editor inputs for side-by-side editing\n\nThe service is implemented by `PreferencesService` [src/vs/workbench/services/preferences/browser/preferencesService.ts:55-647]().\n\n```mermaid\ngraph TB\n    subgraph \"IPreferencesService API\"\n        OpenSettings[\"openSettings(options)\"]\n        OpenUserSettings[\"openUserSettings(options)\"]\n        OpenWorkspaceSettings[\"openWorkspaceSettings(options)\"]\n        OpenFolderSettings[\"openFolderSettings(options)\"]\n        CreateModel[\"createSettings2EditorModel()\"]\n        GetSetting[\"getSetting(settingId)\"]\n    end\n    \n    subgraph \"PreferencesService Implementation\"\n        Service[\"PreferencesService\"]\n        DefaultSettings[\"DefaultSettings\"]\n        EditorInputs[\"Settings Editor Inputs\"]\n    end\n    \n    subgraph \"Editor Inputs\"\n        SettingsEditor2Input[\"SettingsEditor2Input\"]\n        PreferencesEditorInput[\"PreferencesEditorInput\"]\n        KeybindingsEditorInput[\"KeybindingsEditorInput\"]\n    end\n    \n    subgraph \"Models\"\n        Settings2EditorModel[\"Settings2EditorModel\"]\n        SettingsEditorModel[\"SettingsEditorModel\"]\n        DefaultSettingsModel[\"DefaultSettingsEditorModel\"]\n    end\n    \n    OpenSettings --\u003e Service\n    OpenUserSettings --\u003e Service\n    OpenWorkspaceSettings --\u003e Service\n    OpenFolderSettings --\u003e Service\n    CreateModel --\u003e Service\n    GetSetting --\u003e Service\n    \n    Service --\u003e DefaultSettings\n    Service --\u003e EditorInputs\n    \n    EditorInputs --\u003e SettingsEditor2Input\n    EditorInputs --\u003e PreferencesEditorInput\n    EditorInputs --\u003e KeybindingsEditorInput\n    \n    Service --\u003e Settings2EditorModel\n    Service --\u003e SettingsEditorModel\n    Service --\u003e DefaultSettingsModel\n```\n\n**Sources:** [src/vs/workbench/services/preferences/common/preferences.ts:249-281](), [src/vs/workbench/services/preferences/browser/preferencesService.ts:55-647]()\n\n## Settings Search Architecture\n\nThe settings search system uses multiple search providers that run in parallel to find matching settings. Each provider uses a different strategy to match settings against user queries.\n\n### Search Provider System\n\nThe `IPreferencesSearchService` manages search providers and coordinates search execution. It provides three types of providers:\n\n1. **LocalSearchProvider**: String-based matching using filters\n2. **RemoteSearchProvider**: Server-based natural language search  \n3. **AiSearchProvider**: AI-powered embeddings and LLM ranking\n\n```mermaid\ngraph TB\n    subgraph \"Search Coordination\"\n        SearchService[\"IPreferencesSearchService\u003cbr/\u003e(PreferencesSearchService)\"]\n        SettingsEditor[\"SettingsEditor2\"]\n    end\n    \n    subgraph \"Search Providers\"\n        LocalProvider[\"LocalSearchProvider\u003cbr/\u003eSTRING_MATCH_SEARCH_PROVIDER_NAME\"]\n        RemoteProvider[\"RemoteSearchProvider\u003cbr/\u003eFILTER_MODEL_SEARCH_PROVIDER_NAME\"]\n        AiProvider[\"AiSearchProvider\u003cbr/\u003eEMBEDDINGS_SEARCH_PROVIDER_NAME\u003cbr/\u003eLLM_RANKED_SEARCH_PROVIDER_NAME\"]\n        TfIdfProvider[\"TF_IDF_SEARCH_PROVIDER_NAME\"]\n    end\n    \n    subgraph \"Search Strategies\"\n        StringMatch[\"SettingMatches\u003cbr/\u003ematchesWords()\u003cbr/\u003ematchesContiguousSubString()\"]\n        TfIdf[\"TfIdfCalculator\u003cbr/\u003eTfIdfDocument\"]\n        Embeddings[\"Embeddings-based\u003cbr/\u003eSimilarity Search\"]\n        LLMRanking[\"LLM Re-ranking\u003cbr/\u003eof Results\"]\n    end\n    \n    subgraph \"Results\"\n        SearchResult[\"ISearchResult\"]\n        SettingMatch[\"ISettingMatch[]\u003cbr/\u003ematchType, score, matches\"]\n        FilterResult[\"IFilterResult\"]\n    end\n    \n    SettingsEditor --\u003e SearchService\n    \n    SearchService --\u003e LocalProvider\n    SearchService --\u003e RemoteProvider\n    SearchService --\u003e AiProvider\n    \n    LocalProvider --\u003e StringMatch\n    LocalProvider --\u003e TfIdf\n    RemoteProvider --\u003e Embeddings\n    AiProvider --\u003e Embeddings\n    AiProvider --\u003e LLMRanking\n    \n    StringMatch --\u003e SearchResult\n    TfIdf --\u003e SearchResult\n    Embeddings --\u003e SearchResult\n    LLMRanking --\u003e SearchResult\n    \n    SearchResult --\u003e SettingMatch\n    SettingMatch --\u003e FilterResult\n```\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/preferencesSearch.ts:27-68](), [src/vs/workbench/contrib/preferences/common/preferences.ts:37-57]()\n\n### Search Provider Names and Constants\n\nThe system uses predefined provider names to identify and track results from different search strategies:\n\n| Provider Name | Purpose |\n|--------------|---------|\n| `STRING_MATCH_SEARCH_PROVIDER_NAME` | Local string-based matching |\n| `TF_IDF_SEARCH_PROVIDER_NAME` | TF-IDF based relevance scoring |\n| `FILTER_MODEL_SEARCH_PROVIDER_NAME` | Remote server filtering |\n| `EMBEDDINGS_SEARCH_PROVIDER_NAME` | AI embeddings similarity search |\n| `LLM_RANKED_SEARCH_PROVIDER_NAME` | LLM re-ranked results |\n\n**Sources:** [src/vs/workbench/contrib/preferences/common/preferences.ts:112-156]()\n\n## Local Search Provider\n\nThe `LocalSearchProvider` implements client-side string matching using various filtering algorithms. It's the primary search mechanism that always runs, regardless of whether remote/AI search is enabled.\n\n### String Matching Strategy\n\nThe `SettingMatches` class [src/vs/workbench/contrib/preferences/browser/preferencesSearch.ts:136-253]() implements multiple matching strategies:\n\n**Match Types** (in order of relevance):\n- `SettingMatchType.None`: No match\n- `SettingMatchType.LanguageTagSettingMatch`: Matches language-specific settings\n- `SettingMatchType.RemoteMatch`: Match from remote provider\n- `SettingMatchType.NonContiguousQueryInSettingId`: Non-contiguous match in setting key\n- `SettingMatchType.DescriptionOrValueMatch`: Match in description or value\n- `SettingMatchType.NonContiguousWordsInSettingsLabel`: Non-contiguous word match\n- `SettingMatchType.ContiguousWordsInSettingsLabel`: Contiguous word match\n- `SettingMatchType.ContiguousQueryInSettingId`: Contiguous match in setting key\n- `SettingMatchType.AllWordsInSettingsLabel`: All words match\n- `SettingMatchType.ExactMatch`: Exact match\n\n```mermaid\ngraph TB\n    subgraph \"LocalSearchProvider Search Flow\"\n        Query[\"Search Query\u003cbr/\u003e(cleanFilter removes : and quotes)\"]\n        SettingMatcher[\"SettingMatcher Function\"]\n        SettingMatches[\"SettingMatches Class\"]\n    end\n    \n    subgraph \"Matching Algorithms\"\n        KeyMatch[\"Key Matching\u003cbr/\u003ematchesWords()\u003cbr/\u003ematchesContiguousSubString()\u003cbr/\u003ematchesBaseContiguousSubString()\"]\n        DescMatch[\"Description Matching\u003cbr/\u003ematchesSubString()\"]\n        ValueMatch[\"Value Matching\u003cbr/\u003eEnum values, arrays\"]\n        CategoryMatch[\"Category Matching\"]\n    end\n    \n    subgraph \"Match Scoring\"\n        KeyScore[\"keyMatchScore\u003cbr/\u003e(based on match position)\"]\n        MatchType[\"matchType\u003cbr/\u003e(SettingMatchType enum)\"]\n        Ranges[\"matches: IRange[]\u003cbr/\u003e(highlight ranges)\"]\n    end\n    \n    subgraph \"Result Filtering\"\n        TopKeyType[\"Find Top Key Match Type\"]\n        Filter[\"Filter by Top Type\u003cbr/\u003e+ Always Allow Description Matches\"]\n        Sort[\"Sort by Match Type\u003cbr/\u003eand ToC Order\"]\n    end\n    \n    Query --\u003e SettingMatcher\n    SettingMatcher --\u003e SettingMatches\n    \n    SettingMatches --\u003e KeyMatch\n    SettingMatches --\u003e DescMatch\n    SettingMatches --\u003e ValueMatch\n    SettingMatches --\u003e CategoryMatch\n    \n    KeyMatch --\u003e KeyScore\n    DescMatch --\u003e MatchType\n    ValueMatch --\u003e MatchType\n    CategoryMatch --\u003e MatchType\n    \n    KeyScore --\u003e Ranges\n    MatchType --\u003e Ranges\n    \n    Ranges --\u003e TopKeyType\n    TopKeyType --\u003e Filter\n    Filter --\u003e Sort\n```\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/preferencesSearch.ts:79-134](), [src/vs/workbench/contrib/preferences/browser/preferencesSearch.ts:136-253]()\n\n### TF-IDF Based Search\n\nIn addition to string matching, the system uses TF-IDF (Term Frequency-Inverse Document Frequency) to score setting relevance. This approach considers how frequently terms appear in a setting versus across all settings.\n\nThe `TfIdfCalculator` [src/vs/base/common/tfIdf.ts]() processes settings as documents where each setting's key, description, and other metadata form the document content.\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/preferencesSearch.ts:255-386]()\n\n## AI-Powered Search\n\nThe AI search infrastructure allows extensions to provide semantic search capabilities through embeddings and LLM ranking.\n\n### AI Search Service\n\nThe `IAiSettingsSearchService` [src/vs/workbench/services/aiSettingsSearch/common/aiSettingsSearch.ts:30-45]() coordinates AI-powered search:\n\n**Key Methods:**\n- `startSearch(query, token)`: Initiates search with registered providers\n- `getEmbeddingsResults(query, token)`: Gets embedding-based similarity results\n- `getLLMRankedResults(query, token)`: Gets LLM re-ranked results\n- `registerSettingsSearchProvider(provider)`: Registers an AI search provider\n\n```mermaid\ngraph TB\n    subgraph \"Settings Editor Search Flow\"\n        SearchWidget[\"searchWidget.getValue()\"]\n        SearchDelay[\"searchInputDelayer.trigger()\"]\n        TriggerSearch[\"triggerSearch()\"]\n    end\n    \n    subgraph \"Search Orchestration\"\n        SearchModel[\"SearchResultModel\"]\n        LocalSearch[\"localSearchProvider.searchModel()\"]\n        RemoteSearch[\"remoteSearchProvider.searchModel()\"]\n        AiSearch[\"aiSearchProvider.getLLMRankedResults()\"]\n    end\n    \n    subgraph \"AI Search Pipeline\"\n        AiService[\"IAiSettingsSearchService\"]\n        ExtensionProvider[\"Extension AI Provider\u003cbr/\u003e(via ExtHostAiSettingsSearch)\"]\n        EmbeddingsResult[\"Embeddings Results\u003cbr/\u003e(quick, lower quality)\"]\n        LLMResult[\"LLM Ranked Results\u003cbr/\u003e(slower, higher quality)\"]\n    end\n    \n    subgraph \"Result Merging\"\n        UpdateResult[\"updateResultGroup(id, resultGroup)\"]\n        RemoveDupes[\"removeDuplicateResults()\"]\n        RenderTree[\"renderTree()\"]\n    end\n    \n    SearchWidget --\u003e SearchDelay\n    SearchDelay --\u003e TriggerSearch\n    \n    TriggerSearch --\u003e SearchModel\n    \n    SearchModel --\u003e LocalSearch\n    SearchModel --\u003e RemoteSearch\n    SearchModel --\u003e AiSearch\n    \n    AiSearch --\u003e AiService\n    AiService --\u003e ExtensionProvider\n    ExtensionProvider --\u003e EmbeddingsResult\n    ExtensionProvider --\u003e LLMResult\n    \n    EmbeddingsResult --\u003e UpdateResult\n    LLMResult --\u003e UpdateResult\n    LocalSearch --\u003e UpdateResult\n    RemoteSearch --\u003e UpdateResult\n    \n    UpdateResult --\u003e RemoveDupes\n    RemoveDupes --\u003e RenderTree\n```\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/settingsEditor2.ts:1100-1370](), [src/vs/workbench/services/aiSettingsSearch/common/aiSettingsSearchService.ts:13-83]()\n\n### AI Search Provider Registration\n\nExtensions can register AI search providers through the `vscode.ai.registerSettingsSearchProvider` API [src/vscode-dts/vscode.proposed.aiSettingsSearch.d.ts:24-30]().\n\nThe flow:\n1. Extension calls `vscode.ai.registerSettingsSearchProvider(provider)`\n2. `ExtHostAiSettingsSearch` receives the registration [src/vs/workbench/api/common/extHostAiSettingsSearch.ts:42-51]()\n3. Main thread `MainThreadAiSettingsSearch` registers with `IAiSettingsSearchService` [src/vs/workbench/api/browser/mainThreadAiSettingsSearch.ts:24-31]()\n4. Settings editor can now query the provider\n\n**Result Types:**\n```typescript\nexport enum AiSettingsSearchResultKind {\n    EMBEDDED = 1,      // Results from embeddings similarity\n    LLM_RANKED = 2,    // Results from LLM re-ranking\n    CANCELED = 3,      // Search was canceled\n}\n```\n\n**Sources:** [src/vs/workbench/services/aiSettingsSearch/common/aiSettingsSearch.ts:13-28](), [src/vs/workbench/api/common/extHostAiSettingsSearch.ts:15-51]()\n\n## Search Query Processing\n\nThe settings editor processes search queries through several stages to identify filters and search terms.\n\n### Query Parsing\n\nThe `parseQuery` function [src/vs/workbench/contrib/preferences/browser/settingsTreeModels.ts:577-718]() extracts structured information from the query string:\n\n**Extracted Filters:**\n- `@id:` - Filter by setting ID\n- `@ext:` - Filter by extension ID\n- `@feature:` - Filter by feature area (e.g., `@feature:scm`)\n- `@tag:` - Filter by tag (e.g., `@tag:usesOnlineServices`)\n- `@lang:` - Filter by language ID\n\n**Example Query:** `@feature:terminal shell`\n- `featureFilters`: Set containing \"terminal\"\n- Remaining query: \"shell\"\n\n```mermaid\ngraph LR\n    subgraph \"Query Input\"\n        RawQuery[\"User Query String\u003cbr/\u003ee.g., '@feature:terminal shell integration'\"]\n    end\n    \n    subgraph \"parseQuery() Processing\"\n        SplitWords[\"Split into Words\"]\n        CheckFilters[\"Check Each Word\u003cbr/\u003efor Filter Prefixes\"]\n        ExtractFilter[\"Extract Filter Type\u003cbr/\u003eand Value\"]\n        RemainingWords[\"Collect Non-Filter\u003cbr/\u003eWords\"]\n    end\n    \n    subgraph \"Parsed Output\"\n        Filters[\"ISettingsEditorViewState\"]\n        TagFilters[\"tagFilters: Set\u003cstring\u003e\"]\n        ExtFilters[\"extensionFilters: Set\u003cstring\u003e\"]\n        FeatureFilters[\"featureFilters: Set\u003cstring\u003e\"]\n        IdFilters[\"idFilters: Set\u003cstring\u003e\"]\n        LangFilter[\"languageFilter: string\"]\n        QueryText[\"query: string\"]\n    end\n    \n    RawQuery --\u003e SplitWords\n    SplitWords --\u003e CheckFilters\n    CheckFilters --\u003e ExtractFilter\n    CheckFilters --\u003e RemainingWords\n    \n    ExtractFilter --\u003e Filters\n    RemainingWords --\u003e QueryText\n    \n    Filters --\u003e TagFilters\n    Filters --\u003e ExtFilters\n    Filters --\u003e FeatureFilters\n    Filters --\u003e IdFilters\n    Filters --\u003e LangFilter\n    Filters --\u003e QueryText\n```\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/settingsTreeModels.ts:577-718]()\n\n### Filter Application\n\nAfter parsing, filters are applied to settings through the `SettingsTreeModel`:\n\n1. **Tag Filters**: Match against setting tags (`setting.tags`)\n2. **Extension Filters**: Match against extension ID (`setting.extensionInfo.id`)\n3. **Feature Filters**: Match against setting key prefix\n4. **ID Filters**: Match against exact setting key\n5. **Language Filters**: Filter language-specific overrides\n\nThe `matchesAllTags` and `matchesAnyExtension` methods [src/vs/workbench/contrib/preferences/browser/settingsTreeModels.ts:392-402]() determine if a setting passes the filters.\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/settingsTreeModels.ts:392-474]()\n\n## Search Results and Ranking\n\nSearch results from multiple providers are merged and ranked to present the most relevant settings to users.\n\n### Result Model Structure\n\nThe `SearchResultModel` [src/vs/workbench/contrib/preferences/browser/settingsTreeModels.ts:475-776]() manages search results:\n\n**Key Components:**\n- `filterMatches: ISettingMatch[]` - All matched settings with match details\n- `exactMatch: boolean` - Whether any result is an exact match\n- `metadata: IFilterMetadata` - Search provider metadata (timing, request details)\n\n**ISettingMatch Structure:**\n```typescript\ninterface ISettingMatch {\n    setting: ISetting;           // The matched setting\n    matches: IRange[] | null;    // Text ranges to highlight\n    matchType: SettingMatchType; // Type of match (key, description, etc.)\n    keyMatchScore: number;       // Score for key matches\n    score: number;               // Overall relevance score\n    providerName?: string;       // Which provider found this\n}\n```\n\n**Sources:** [src/vs/workbench/services/preferences/common/preferences.ts:109-189](), [src/vs/workbench/contrib/preferences/browser/settingsTreeModels.ts:475-776]()\n\n### Duplicate Removal\n\nWhen multiple search providers return results, duplicates are removed preferring results from earlier providers (higher priority):\n\n```mermaid\ngraph TB\n    subgraph \"Result Groups by Priority\"\n        P1[\"Provider 1 Results\u003cbr/\u003e(e.g., Local String Match)\"]\n        P2[\"Provider 2 Results\u003cbr/\u003e(e.g., TF-IDF)\"]\n        P3[\"Provider 3 Results\u003cbr/\u003e(e.g., AI Embeddings)\"]\n        P4[\"Provider 4 Results\u003cbr/\u003e(e.g., LLM Ranked)\"]\n    end\n    \n    subgraph \"Deduplication Process\"\n        SortByOrder[\"Sort Groups by Order\"]\n        SeenKeys[\"Track Seen Setting Keys\"]\n        FilterDupes[\"Filter Out Duplicates\u003cbr/\u003eKeep First Occurrence\"]\n    end\n    \n    subgraph \"Final Results\"\n        MergedList[\"Merged Setting List\u003cbr/\u003e(No Duplicates)\"]\n        Metadata[\"Preserve All Metadata\u003cbr/\u003efrom Each Provider\"]\n    end\n    \n    P1 --\u003e SortByOrder\n    P2 --\u003e SortByOrder\n    P3 --\u003e SortByOrder\n    P4 --\u003e SortByOrder\n    \n    SortByOrder --\u003e SeenKeys\n    SeenKeys --\u003e FilterDupes\n    \n    FilterDupes --\u003e MergedList\n    FilterDupes --\u003e Metadata\n```\n\nThe `removeDuplicateResults` method [src/vs/workbench/services/preferences/common/preferencesModels.ts:48-57]() ensures each setting key appears only once, preferring the match from the higher-priority provider.\n\n**Sources:** [src/vs/workbench/services/preferences/common/preferencesModels.ts:30-120]()\n\n## Search UI Integration\n\nThe settings editor integrates search through the `SettingsEditor2` class [src/vs/workbench/contrib/preferences/browser/settingsEditor2.ts:108-1905]().\n\n### Search Widget\n\nThe search widget uses `SuggestEnabledInput` [src/vs/workbench/contrib/preferences/browser/settingsEditor2.ts:737-765]() which provides:\n- Auto-completion for filter tags (`@ext:`, `@feature:`, etc.)\n- Language ID suggestions for `@lang:` filter\n- Extension ID suggestions for `@ext:` filter\n- Search history\n\n### Search Trigger Flow\n\n```mermaid\ngraph TB\n    subgraph \"User Input\"\n        TypeQuery[\"User Types in\u003cbr/\u003eSearch Box\"]\n        InputChange[\"onInputDidChange Event\"]\n    end\n    \n    subgraph \"Debounced Trigger\"\n        Delayer[\"searchInputDelayer\u003cbr/\u003e(200ms delay)\"]\n        InputChanged[\"onSearchInputChanged(showAI)\"]\n    end\n    \n    subgraph \"Search Initiation\"\n        CancelPrev[\"Cancel Previous Search\"]\n        ParseQuery[\"parseQuery(searchValue)\"]\n        UpdateViewState[\"Update viewState.query\u003cbr/\u003eviewState.tagFilters, etc.\"]\n        TriggerSearch[\"triggerSearch(query, options)\"]\n    end\n    \n    subgraph \"Provider Execution\"\n        LocalProv[\"Local Search\u003cbr/\u003e(immediate)\"]\n        RemoteProv[\"Remote Search\u003cbr/\u003e(if enabled)\"]\n        AiProv[\"AI Search\u003cbr/\u003e(if enabled \u0026 toggled)\"]\n    end\n    \n    subgraph \"Result Handling\"\n        LocalResults[\"Local Results\u003cbr/\u003e(STRING_MATCH)\"]\n        RemoteResults[\"Remote Results\u003cbr/\u003e(FILTER_MODEL)\"]\n        EmbedResults[\"Embeddings Results\u003cbr/\u003e(EMBEDDINGS)\"]\n        LLMResults[\"LLM Results\u003cbr/\u003e(LLM_RANKED)\"]\n        UpdateGroups[\"updateResultGroup()\u003cbr/\u003efor each provider\"]\n        RenderResults[\"renderTree()\"]\n    end\n    \n    TypeQuery --\u003e InputChange\n    InputChange --\u003e Delayer\n    Delayer --\u003e InputChanged\n    \n    InputChanged --\u003e CancelPrev\n    CancelPrev --\u003e ParseQuery\n    ParseQuery --\u003e UpdateViewState\n    UpdateViewState --\u003e TriggerSearch\n    \n    TriggerSearch --\u003e LocalProv\n    TriggerSearch --\u003e RemoteProv\n    TriggerSearch --\u003e AiProv\n    \n    LocalProv --\u003e LocalResults\n    RemoteProv --\u003e RemoteResults\n    AiProv --\u003e EmbedResults\n    AiProv --\u003e LLMResults\n    \n    LocalResults --\u003e UpdateGroups\n    RemoteResults --\u003e UpdateGroups\n    EmbedResults --\u003e UpdateGroups\n    LLMResults --\u003e UpdateGroups\n    \n    UpdateGroups --\u003e RenderResults\n```\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/settingsEditor2.ts:769-773](), [src/vs/workbench/contrib/preferences/browser/settingsEditor2.ts:1072-1172](), [src/vs/workbench/contrib/preferences/browser/settingsEditor2.ts:1183-1370]()\n\n### AI Search Toggle\n\nThe settings editor provides a toggle button for AI search results when:\n- Natural language search is enabled (`workbench.settings.enableNaturalLanguageSearch`)\n- Show AI toggle is enabled (`workbench.settings.showAISearchToggle`)\n- Chat is not hidden or disabled\n\nWhen toggled on, the `SearchResultModel.showAiResults` property controls whether AI results are displayed in the tree.\n\n**Sources:** [src/vs/workbench/contrib/preferences/browser/settingsEditor2.ts:397-420](), [src/vs/workbench/contrib/preferences/browser/settingsEditor2.ts:824-839]()\n\n## Configuration Options\n\nSeveral configuration settings control search behavior:\n\n| Setting | Purpose |\n|---------|---------|\n| `workbench.settings.enableNaturalLanguageSearch` | Enable/disable remote and AI search |\n| `workbench.settings.showAISearchToggle` | Show/hide the AI results toggle button |\n| `workbench.settings.naturalLanguageSearchEndpoint` | Remote search server URL |\n| `workbench.settings.naturalLanguageSearchKey` | API key for remote search |\n| `workbench.settings.useNaturalLanguageSearchPost` | Use POST instead of GET for remote search |\n\n**Sources:** [src/vs/workbench/contrib/preferences/common/preferences.ts:18-30]()"])</script><script>self.__next_f.push([1,"5:[\"$\",\"$L15\",null,{\"repoName\":\"microsoft/vscode\",\"hasConfig\":false,\"canSteer\":true,\"children\":[\"$\",\"$L16\",null,{\"wiki\":{\"metadata\":{\"repo_name\":\"microsoft/vscode\",\"commit_hash\":\"c9c76f12\",\"generated_at\":\"2026-01-16T13:57:41.049714\",\"config\":null,\"config_source\":\"none\"},\"pages\":[{\"page_plan\":{\"id\":\"1\",\"title\":\"Overview\"},\"content\":\"$17\"},{\"page_plan\":{\"id\":\"2\",\"title\":\"Build System and Development\"},\"content\":\"$18\"},{\"page_plan\":{\"id\":\"2.1\",\"title\":\"Package Structure and Dependencies\"},\"content\":\"$19\"},{\"page_plan\":{\"id\":\"2.2\",\"title\":\"Native Modules and Cross-Platform Builds\"},\"content\":\"$1a\"},{\"page_plan\":{\"id\":\"2.3\",\"title\":\"Build Tasks and Scripts\"},\"content\":\"$1b\"},{\"page_plan\":{\"id\":\"2.4\",\"title\":\"Code Quality and Linting\"},\"content\":\"$1c\"},{\"page_plan\":{\"id\":\"3\",\"title\":\"Application Lifecycle and Bootstrap\"},\"content\":\"$1d\"},{\"page_plan\":{\"id\":\"3.1\",\"title\":\"Entry Points and Execution Modes\"},\"content\":\"$1e\"},{\"page_plan\":{\"id\":\"3.2\",\"title\":\"Electron Main Process Startup\"},\"content\":\"$1f\"},{\"page_plan\":{\"id\":\"3.3\",\"title\":\"Multi-Process Architecture\"},\"content\":\"$20\"},{\"page_plan\":{\"id\":\"3.4\",\"title\":\"Web Workbench Bootstrap\"},\"content\":\"$21\"},{\"page_plan\":{\"id\":\"3.5\",\"title\":\"Service Initialization and Dependency Injection\"},\"content\":\"$22\"},{\"page_plan\":{\"id\":\"4\",\"title\":\"Workbench Architecture\"},\"content\":\"$23\"},{\"page_plan\":{\"id\":\"4.1\",\"title\":\"Layout System and Parts\"},\"content\":\"$24\"},{\"page_plan\":{\"id\":\"4.2\",\"title\":\"Editor Service and Groups\"},\"content\":\"$25\"},{\"page_plan\":{\"id\":\"4.3\",\"title\":\"Editor Input and Pane System\"},\"content\":\"$26\"},{\"page_plan\":{\"id\":\"4.4\",\"title\":\"View System and Contributions\"},\"content\":\"$27\"},{\"page_plan\":{\"id\":\"4.5\",\"title\":\"Context Keys and State Management\"},\"content\":\"$28\"},{\"page_plan\":{\"id\":\"4.6\",\"title\":\"Drag and Drop System\"},\"content\":\"$29\"},{\"page_plan\":{\"id\":\"4.7\",\"title\":\"Multi-Window Support\"},\"content\":\"$2a\"},{\"page_plan\":{\"id\":\"5\",\"title\":\"Extension System\"},\"content\":\"$2b\"},{\"page_plan\":{\"id\":\"5.1\",\"title\":\"Extension Host Architecture and RPC Protocol\"},\"content\":\"$2c\"},{\"page_plan\":{\"id\":\"5.2\",\"title\":\"Extension API Implementation\"},\"content\":\"$2d\"},{\"page_plan\":{\"id\":\"5.3\",\"title\":\"Language Features Provider System\"},\"content\":\"$2e\"},{\"page_plan\":{\"id\":\"5.4\",\"title\":\"Extension Management and Marketplace\"},\"content\":\"$2f\"},{\"page_plan\":{\"id\":\"5.5\",\"title\":\"Extension Management UI\"},\"content\":\"$30\"},{\"page_plan\":{\"id\":\"6\",\"title\":\"Integrated Terminal\"},\"content\":\"$31\"},{\"page_plan\":{\"id\":\"6.1\",\"title\":\"Terminal Architecture Overview\"},\"content\":\"$32\"},{\"page_plan\":{\"id\":\"6.2\",\"title\":\"Terminal Instance and Process Management\"},\"content\":\"$33\"},{\"page_plan\":{\"id\":\"6.3\",\"title\":\"XTerm.js Integration and Rendering\"},\"content\":\"$34\"},{\"page_plan\":{\"id\":\"6.4\",\"title\":\"Pty Host and Multi-Server Support\"},\"content\":\"$35\"},{\"page_plan\":{\"id\":\"6.5\",\"title\":\"Shell Integration and Capabilities\"},\"content\":\"$36\"},{\"page_plan\":{\"id\":\"6.6\",\"title\":\"Terminal UI and Layout\"},\"content\":\"$37\"},{\"page_plan\":{\"id\":\"6.7\",\"title\":\"Terminal Extension API\"},\"content\":\"$38\"},{\"page_plan\":{\"id\":\"7\",\"title\":\"Chat and AI Integration\"},\"content\":\"$39\"},{\"page_plan\":{\"id\":\"7.1\",\"title\":\"Chat System Architecture\"},\"content\":\"$3a\"},{\"page_plan\":{\"id\":\"7.2\",\"title\":\"Chat Agents and Participants\"},\"content\":\"$3b\"},{\"page_plan\":{\"id\":\"7.3\",\"title\":\"Chat Request and Response Flow\"},\"content\":\"$3c\"},{\"page_plan\":{\"id\":\"7.4\",\"title\":\"Chat UI Components\"},\"content\":\"$3d\"},{\"page_plan\":{\"id\":\"7.5\",\"title\":\"Chat Modes and Sessions\"},\"content\":\"$3e\"},{\"page_plan\":{\"id\":\"7.6\",\"title\":\"Chat Extension API\"},\"content\":\"$3f\"},{\"page_plan\":{\"id\":\"8\",\"title\":\"Notebooks\"},\"content\":\"$40\"},{\"page_plan\":{\"id\":\"8.1\",\"title\":\"Notebook Architecture Overview\"},\"content\":\"$41\"},{\"page_plan\":{\"id\":\"8.2\",\"title\":\"Notebook Editor and Cell Management\"},\"content\":\"$42\"},{\"page_plan\":{\"id\":\"8.3\",\"title\":\"Notebook Data Model\"},\"content\":\"$43\"},{\"page_plan\":{\"id\":\"8.4\",\"title\":\"Cell Outputs and WebView Rendering\"},\"content\":\"$44\"},{\"page_plan\":{\"id\":\"8.5\",\"title\":\"Notebook Extension API\"},\"content\":\"$45\"},{\"page_plan\":{\"id\":\"9\",\"title\":\"Source Control Management\"},\"content\":\"$46\"},{\"page_plan\":{\"id\":\"9.1\",\"title\":\"SCM Framework Architecture\"},\"content\":\"$47\"},{\"page_plan\":{\"id\":\"9.2\",\"title\":\"SCM Provider System\"},\"content\":\"$48\"},{\"page_plan\":{\"id\":\"9.3\",\"title\":\"SCM Views and UI Components\"},\"content\":\"$49\"},{\"page_plan\":{\"id\":\"9.4\",\"title\":\"SCM History Provider\"},\"content\":\"$4a\"},{\"page_plan\":{\"id\":\"9.5\",\"title\":\"SCM Extension API\"},\"content\":\"$4b\"},{\"page_plan\":{\"id\":\"10\",\"title\":\"Git Extension\"},\"content\":\"$4c\"},{\"page_plan\":{\"id\":\"10.1\",\"title\":\"Git Extension Architecture\"},\"content\":\"$4d\"},{\"page_plan\":{\"id\":\"10.2\",\"title\":\"Repository and Operation Management\"},\"content\":\"$4e\"},{\"page_plan\":{\"id\":\"10.3\",\"title\":\"Git Commands and Actions\"},\"content\":\"$4f\"},{\"page_plan\":{\"id\":\"10.4\",\"title\":\"Git History Provider\"},\"content\":\"$50\"},{\"page_plan\":{\"id\":\"10.5\",\"title\":\"Git IPC and Helper Processes\"},\"content\":\"$51\"},{\"page_plan\":{\"id\":\"11\",\"title\":\"Settings and Preferences\"},\"content\":\"$52\"},{\"page_plan\":{\"id\":\"11.1\",\"title\":\"Settings Editor Architecture\"},\"content\":\"$53\"},{\"page_plan\":{\"id\":\"11.2\",\"title\":\"Settings Tree Model and Rendering\"},\"content\":\"$54\"},{\"page_plan\":{\"id\":\"11.3\",\"title\":\"Keybindings Editor\"},\"content\":\"$55\"},{\"page_plan\":{\"id\":\"11.4\",\"title\":\"Preferences Service and Search\"},\"content\":\"$56\"}]},\"children\":\"$L57\"}]}]\n"])</script><script>self.__next_f.push([1,"6:[[\"$\",\"script\",null,{\"type\":\"application/ld+json\",\"dangerouslySetInnerHTML\":{\"__html\":\"{\\\"@context\\\":\\\"https://schema.org\\\",\\\"@type\\\":\\\"TechArticle\\\",\\\"headline\\\":\\\"Overview\\\",\\\"description\\\":\\\"This document provides a high-level overview of VS Code's architecture, including its execution contexts, multi-process architecture, major subsystems, and codebase organization. It serves as an entry\\\",\\\"image\\\":\\\"https://deepwiki.com/microsoft/vscode/og-image.png\\\",\\\"datePublished\\\":\\\"2026-01-16T13:57:41.049714\\\",\\\"dateModified\\\":\\\"2026-01-16T13:57:41.049714\\\",\\\"author\\\":{\\\"@type\\\":\\\"Organization\\\",\\\"name\\\":\\\"DeepWiki\\\",\\\"url\\\":\\\"https://deepwiki.com\\\"},\\\"publisher\\\":{\\\"@type\\\":\\\"Organization\\\",\\\"name\\\":\\\"DeepWiki\\\",\\\"logo\\\":{\\\"@type\\\":\\\"ImageObject\\\",\\\"url\\\":\\\"https://deepwiki.com/icon.png\\\"}},\\\"mainEntityOfPage\\\":{\\\"@type\\\":\\\"WebPage\\\",\\\"@id\\\":\\\"https://deepwiki.com/microsoft/vscode\\\"}}\"}}],[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]\n"])</script><script>self.__next_f.push([1,"e:{\"metadata\":[[\"$\",\"title\",\"0\",{\"children\":\"microsoft/vscode | DeepWiki\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"This document provides a high-level overview of VS Code's architecture, including its execution contexts, multi-process architecture, major subsystems, and codebase organization. It serves as an entry\"}],[\"$\",\"meta\",\"2\",{\"name\":\"keywords\",\"content\":\"microsoft/vscode,microsoft,vscode,documentation,wiki,codebase,AI documentation,Devin,Overview\"}],[\"$\",\"link\",\"3\",{\"rel\":\"canonical\",\"href\":\"https://deepwiki.com/microsoft/vscode\"}],[\"$\",\"meta\",\"4\",{\"property\":\"og:title\",\"content\":\"microsoft/vscode | DeepWiki\"}],[\"$\",\"meta\",\"5\",{\"property\":\"og:description\",\"content\":\"This document provides a high-level overview of VS Code's architecture, including its execution contexts, multi-process architecture, major subsystems, and codebase organization. It serves as an entry\"}],[\"$\",\"meta\",\"6\",{\"property\":\"og:url\",\"content\":\"https://deepwiki.com/microsoft/vscode\"}],[\"$\",\"meta\",\"7\",{\"property\":\"og:site_name\",\"content\":\"DeepWiki\"}],[\"$\",\"meta\",\"8\",{\"property\":\"og:image\",\"content\":\"https://deepwiki.com/microsoft/vscode/og-image.png?page=1\"}],[\"$\",\"meta\",\"9\",{\"property\":\"og:type\",\"content\":\"website\"}],[\"$\",\"meta\",\"10\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"11\",{\"name\":\"twitter:site\",\"content\":\"@cognition\"}],[\"$\",\"meta\",\"12\",{\"name\":\"twitter:creator\",\"content\":\"@cognition\"}],[\"$\",\"meta\",\"13\",{\"name\":\"twitter:title\",\"content\":\"microsoft/vscode | DeepWiki\"}],[\"$\",\"meta\",\"14\",{\"name\":\"twitter:description\",\"content\":\"This document provides a high-level overview of VS Code's architecture, including its execution contexts, multi-process architecture, major subsystems, and codebase organization. It serves as an entry\"}],[\"$\",\"meta\",\"15\",{\"name\":\"twitter:image\",\"content\":\"https://deepwiki.com/microsoft/vscode/og-image.png?page=1\"}],[\"$\",\"link\",\"16\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"48x48\"}],[\"$\",\"link\",\"17\",{\"rel\":\"icon\",\"href\":\"/icon.png?1ee4c6a68a73a205\",\"type\":\"image/png\",\"sizes\":\"48x48\"}],[\"$\",\"link\",\"18\",{\"rel\":\"apple-touch-icon\",\"href\":\"/apple-icon.png?a4f658907db0ab87\",\"type\":\"image/png\",\"sizes\":\"180x180\"}],[\"$\",\"$L58\",\"19\",{}]],\"error\":null,\"digest\":\"$undefined\"}\n"])</script><script>self.__next_f.push([1,"13:\"$e:metadata\"\n"])</script><script>self.__next_f.push([1,"57:[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]\n"])</script></body></html>