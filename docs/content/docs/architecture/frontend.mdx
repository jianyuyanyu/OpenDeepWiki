---
title: 前端架构
description: Next.js 前端架构 — App Router、组件结构、i18n 和 API 集成。
---

## 概览

OpenDeepWiki 前端是一个使用 App Router 的 Next.js 16 应用，位于 `web/`。它提供用户界面，用于浏览仓库、阅读生成的文档、与 AI 助手聊天和管理设置。

## 项目结构

```
web/
├── app/                       # Next.js App Router
│   ├── layout.tsx             # 根布局（主题、i18n、认证提供商）
│   ├── globals.css            # 全局样式（Tailwind CSS）
│   ├── sidebar.tsx            # 主侧边栏组件
│   ├── middleware.ts          # 区域检测中间件
│   ├── (main)/               # 主应用路由
│   │   ├── page.tsx           # 主页（公开仓库列表）
│   │   ├── apps/              # 用户应用管理
│   │   ├── bookmarks/         # 书签仓库
│   │   ├── organizations/     # 组织管理
│   │   ├── private/           # 私有仓库
│   │   ├── profile/           # 用户资料
│   │   ├── recommend/         # 推荐仓库
│   │   ├── settings/          # 用户设置
│   │   └── subscribe/         # 订阅管理
│   ├── admin/                 # 管理面板
│   │   ├── repositories/      # 仓库管理
│   │   ├── users/             # 用户管理
│   │   ├── roles/             # 角色管理
│   │   ├── settings/          # 系统设置
│   │   ├── tools/             # MCP 和模型配置
│   │   └── chat-assistant/    # 聊天助手配置
│   ├── auth/                  # 认证页面
│   ├── api/[...path]/         # 后端 API 代理
│   └── [owner]/[repo]/        # 仓库文档页面
├── components/                # 可复用组件
│   ├── ui/                    # 基础 UI 原语（基于 Radix UI）
│   ├── repo/                  # 仓库相关组件
│   ├── chat/                  # 聊天助手组件
│   ├── apps/                  # 应用管理组件
│   ├── admin/                 # 管理面板组件
│   └── animate-ui/            # 动画组件（Motion）
├── hooks/                     # 自定义 React hooks
├── lib/                       # 工具函数和 API 客户端
├── contexts/                  # React 上下文提供商
├── i18n/                      # 国际化配置
│   ├── messages/              # 翻译文件（zh、en、ko、ja）
│   └── request.ts             # 区域请求处理器
├── types/                     # TypeScript 类型定义
└── public/                    # 静态资源
```

## App Router 和布局

应用使用 Next.js App Router 和嵌套布局：

- **根布局**（`app/layout.tsx`）— 用 `ThemeProvider`（next-themes）、`NextIntlClientProvider`（i18n）和 `AuthProvider` 包装整个应用
- **主布局**（`app/(main)/`）— 主要用户界面布局，带侧边栏导航
- **管理布局**（`app/admin/layout.tsx`）— 管理面板及其侧边栏
- **仓库页面**（`app/[owner]/[repo]/`）— 用于浏览仓库文档的动态路由

## 组件组织

组件按域组织：

| 目录 | 用途 |
|-----------|---------|
| `components/ui/` | 基于 Radix UI 的基础 UI 原语（Button、Dialog、Select、Tabs 等） |
| `components/repo/` | 仓库浏览 — 侧边栏、Markdown 渲染器、思维导图查看器、源文件 |
| `components/chat/` | 聊天助手 — 消息显示、面板、模型选择器、图像上传 |
| `components/apps/` | 应用管理 — 表单对话框、日志表、统计图表 |
| `components/admin/` | 管理面板侧边栏和导航 |
| `components/animate-ui/` | 使用 Motion 库的动画原语 |

根级别的共享组件包括标题、搜索框、语言切换和主题切换。

## 自定义 Hooks

| Hook | 用途 |
|------|---------|
| `use-chat-history` | 管理聊天会话历史和消息状态 |
| `use-translations` | 为当前区域提供翻译函数 |
| `use-auto-height` | 根据内容自动调整 textarea 高度 |
| `use-mobile` | 检测移动视口以实现响应式行为 |
| `use-scroll-position` | 跟踪滚动位置以实现 UI 效果 |
| `use-controlled-state` | 管理受控/非受控组件状态 |

## 国际化（i18n）

前端使用 `next-intl` 支持 4 种语言：

- 中文（zh）— 默认
- 英文（en）
- 韩文（ko）
- 日文（ja）

区域检测通过中间件（`middleware.ts`）工作：

1. 检查 URL 查询参数 `?lang=xx`
2. 回退到 `NEXT_LOCALE` cookie
3. 默认为 `zh`

检测到的区域通过 `x-next-intl-locale` 请求头传递。

## API 集成

对后端的 API 调用通过 `app/api/[...path]/` 的捕获所有路由代理。前端在 `lib/` 中使用类型化的 API 客户端模块：

| 模块 | 端点 |
|--------|-----------|
| `repository-api.ts` | 仓库 CRUD、提交、可见性 |
| `chat-api.ts` | 聊天流、会话管理 |
| `auth-api.ts` | 登录、注册、令牌刷新 |
| `admin-api.ts` | 管理员统计、用户/角色管理 |
| `apps-api.ts` | 用户应用 CRUD、统计、日志 |
| `bookmark-api.ts` | 书签管理 |
| `organization-api.ts` | 组织操作 |
| `subscription-api.ts` | 订阅管理 |

API 代理 URL 通过 `API_PROXY_URL` 环境变量配置（默认为后端服务 URL）。

## 样式

- **Tailwind CSS** — 用于所有样式的实用优先 CSS 框架
- **Radix UI** — 无头、可访问的 UI 原语
- **class-variance-authority (CVA)** — 组件变体管理
- **next-themes** — 深色/浅色主题切换，支持系统偏好检测

## 关键依赖

| 包 | 用途 |
|---------|---------|
| `next`（16.x） | 带 App Router 的 React 框架 |
| `react`（19.x） | UI 库 |
| `next-intl` | 国际化 |
| `next-themes` | 主题管理 |
| `lucide-react` | 图标库 |
| `mermaid` | 文档中的图表渲染 |
| `react-markdown` | Markdown 渲染 |
| `react-syntax-highlighter` | 代码语法高亮 |
| `motion` | 动画库 |
| `radix-ui` | 可访问的 UI 原语 |
