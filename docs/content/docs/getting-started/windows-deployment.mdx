---
title: Windows 部署
description: 在 Windows 上构建和部署 OpenDeepWiki，包括后端发布、前端构建和一键启动。
---

import { Steps, Step } from "fumadocs-ui/components/steps";
import { Tabs, Tab } from "fumadocs-ui/components/tabs";
import { Callout } from "fumadocs-ui/components/callout";

# Windows 部署

本指南介绍如何在 Windows 上直接构建和部署 OpenDeepWiki，不依赖 Docker，适合 Windows 服务器或本地生产环境。

## 前置条件

| 工具 | 版本 | 用途 |
|---|---|---|
| [.NET SDK](https://dotnet.microsoft.com/download) | 10.0+（预览版） | 后端构建和发布 |
| [Node.js](https://nodejs.org/) | 18+ | 前端构建和运行 |
| [Git](https://git-scm.com/) | 最新版 | 仓库克隆（后端运行时使用） |

<Callout type="info">
  后端目标是 `net10.0`。确保已安装 .NET 10 预览版 SDK，使用 `dotnet --version` 检查。
</Callout>

## 一键构建

项目根目录提供了 `publish.bat` 脚本，可以一键完成后端发布和前端构建：

```batch
publish.bat
```

脚本会自动完成以下操作：
1. 清理旧的发布目录
2. 使用 `dotnet publish` 构建后端为单文件自包含可执行程序（`win-x64`）
3. 安装前端依赖并构建 Next.js standalone 产物
4. 复制所有构建产物到 `publish/` 目录
5. 生成 `.env.example` 示例配置文件和启动脚本

## 手动构建

如果需要自定义构建过程，可以分步执行：

<Steps>

<Step>
### 构建后端

```batch
dotnet publish src/OpenDeepWiki/OpenDeepWiki.csproj -c Release -o publish\backend -p:PublishSingleFile=true --self-contained true -r win-x64
```

这会生成一个自包含的 `OpenDeepWiki.exe`，无需目标机器安装 .NET 运行时。

复制 Prompts 目录（AI 提示模板）：

```batch
xcopy /E /I /Y src\OpenDeepWiki\Prompts publish\backend\Prompts
```
</Step>

<Step>
### 构建前端

```batch
cd web
npm install
npm run build
cd ..
```

复制 standalone 构建产物：

```batch
xcopy /E /I /Y web\.next\standalone\web\* publish\frontend\
xcopy /E /I /Y web\.next\static publish\frontend\.next\static
xcopy /E /I /Y web\public publish\frontend\public
```

<Callout type="info">
  前端使用 Next.js standalone 模式输出，运行时只需要 Node.js，不需要 `node_modules`。
</Callout>
</Step>

</Steps>

## 发布目录结构

构建完成后，`publish/` 目录结构如下：

```
publish/
├── backend/              # 后端服务
│   ├── OpenDeepWiki.exe  # 自包含可执行文件
│   ├── Prompts/          # AI 提示模板
│   ├── .env.example      # 环境变量示例
│   └── start-backend.bat # 后端启动脚本
├── frontend/             # 前端服务
│   ├── server.js         # Next.js standalone 服务器
│   ├── .next/static/     # 静态资源
│   ├── public/           # 公共资源
│   ├── .env.example      # 环境变量示例
│   └── start-frontend.bat# 前端启动脚本
└── start-all.bat         # 一键启动脚本
```

## 配置

### 后端配置

将 `publish/backend/.env.example` 复制为 `.env`，然后编辑：

```batch
copy publish\backend\.env.example publish\backend\.env
```

关键配置项：

```ini title="publish/backend/.env"
# 服务监听地址
URLS=http://localhost:8080

# 数据库配置（支持: sqlite, postgresql）
DB_TYPE=sqlite
CONNECTION_STRING=Data Source=./opendeepwiki.db

# 仓库存储目录
REPOSITORIES_DIRECTORY=./repositories

# AI 服务配置（全局默认，用于 Chat 等功能）
CHAT_API_KEY=your-api-key-here
ENDPOINT=https://api.openai.com/v1
CHAT_REQUEST_TYPE=OpenAI

# Wiki 生成器配置 - 目录生成
WIKI_CATALOG_MODEL=gpt-4o
WIKI_CATALOG_ENDPOINT=https://api.openai.com/v1
WIKI_CATALOG_API_KEY=your-catalog-api-key
WIKI_CATALOG_REQUEST_TYPE=OpenAI

# Wiki 生成器配置 - 内容生成
WIKI_CONTENT_MODEL=gpt-4o
WIKI_CONTENT_ENDPOINT=https://api.openai.com/v1
WIKI_CONTENT_API_KEY=your-content-api-key
WIKI_CONTENT_REQUEST_TYPE=OpenAI

# Wiki 生成并行数（默认: 5）
WIKI_PARALLEL_COUNT=5

# 多语言支持（逗号分隔）
WIKI_LANGUAGES=en,zh

# JWT 配置（生产环境请修改）
JWT_SECRET_KEY=your-secret-key-change-in-production
```

<Callout type="warn">
  生产环境中务必修改 `JWT_SECRET_KEY`，默认密钥仅用于开发。同时确保 AI API 密钥已正确配置。
</Callout>

### 前端配置

将 `publish/frontend/.env.example` 复制为 `.env.local`：

```batch
copy publish\frontend\.env.example publish\frontend\.env.local
```

```ini title="publish/frontend/.env.local"
# 后端 API 代理地址
API_PROXY_URL=http://localhost:8080
```

如果后端监听地址不是默认的 `http://localhost:8080`，需要修改此值与后端 `URLS` 保持一致。

## 启动服务

### 一键启动

运行 `publish/start-all.bat`，会自动在新窗口中分别启动后端和前端服务：

```batch
publish\start-all.bat
```

启动后：
- 后端 API：`http://localhost:8080`
- 前端应用：`http://localhost:3000`

### 分别启动

也可以手动在不同的终端窗口中分别启动：

```batch
# 终端 1 — 启动后端
publish\backend\start-backend.bat

# 终端 2 — 启动前端
publish\frontend\start-frontend.bat
```

## 注册为 Windows 服务（可选）

如果需要在服务器上长期运行，建议将后端注册为 Windows 服务：

```batch
sc create OpenDeepWiki binPath= "C:\path\to\publish\backend\OpenDeepWiki.exe" start= auto
sc start OpenDeepWiki
```

前端可以使用 [PM2](https://pm2.keymetrics.io/) 管理：

```batch
npm install -g pm2
cd publish\frontend
pm2 start server.js --name opendeepwiki-web
pm2 save
```

<Callout type="info">
  使用 Windows 服务或 PM2 可以实现开机自启和进程守护，适合生产环境。
</Callout>

## 数据库选择

### SQLite（默认）

无需额外设置，数据库文件自动创建在后端目录中。适合小规模部署和测试。

### PostgreSQL

生产环境推荐使用 PostgreSQL，修改 `.env` 中的数据库配置：

```ini
DB_TYPE=postgresql
CONNECTION_STRING=Host=localhost;Database=opendeepwiki;Username=postgres;Password=your-password
```

详见 [数据库配置](/docs/deployment/database)。

## 故障排除

### 后端启动失败

- 检查 `.env` 文件是否存在且配置正确
- 确认 AI API 密钥有效且端点可达
- 查看控制台输出的错误信息

### 前端无法连接后端

- 确认后端已启动并监听在配置的端口
- 检查 `publish/frontend/.env.local` 中的 `API_PROXY_URL` 是否与后端地址一致
- 检查 Windows 防火墙是否放行了 8080 和 3000 端口

### 端口被占用

如果默认端口已被占用，修改配置：

```ini
# 后端 .env — 修改监听端口
URLS=http://localhost:9090
```

同时更新前端的 `API_PROXY_URL` 指向新端口。前端端口可通过设置 `PORT` 环境变量修改。

### 构建失败

- 后端构建失败：确保已安装 .NET 10 预览版 SDK（`dotnet --list-sdks`）
- 前端构建失败：确保 Node.js 版本 ≥ 18（`node --version`），尝试删除 `web/node_modules` 后重新 `npm install`
