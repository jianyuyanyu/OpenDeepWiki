---
title: 本地开发
description: 为 OpenDeepWiki 设置本地开发环境，包括 .NET 后端和 Next.js 前端。
---

import { Steps, Step } from "fumadocs-ui/components/steps";
import { Tabs, Tab } from "fumadocs-ui/components/tabs";
import { Callout } from "fumadocs-ui/components/callout";

# 本地开发

本指南将引导你为 OpenDeepWiki 设置本地开发环境。该项目由两部分组成：

- **后端** — ASP.NET Core API（`src/OpenDeepWiki/`）
- **前端** — Next.js 应用（`web/`）

## 前置条件

| 工具 | 版本 | 用途 |
|---|---|---|
| [.NET SDK](https://dotnet.microsoft.com/download) | 10.0+ (预览版) | 后端构建和运行 |
| [Node.js](https://nodejs.org/) | 18+ | 前端构建和运行 |
| [Git](https://git-scm.com/) | 最新版 | 仓库克隆（后端运行时使用） |

<Callout type="info">
  后端目标是 `net10.0`。确保已安装 .NET 10 预览版 SDK。使用 `dotnet --version` 检查。
</Callout>

## 设置

<Steps>

<Step>
### 克隆仓库

```bash
git clone https://github.com/AIDotNet/OpenDeepWiki.git
cd OpenDeepWiki
```
</Step>

<Step>
### 配置后端

后端从 `appsettings.json` 和环境变量读取配置。对于本地开发，编辑 `src/OpenDeepWiki/appsettings.Development.json` 或设置环境变量：

```json title="src/OpenDeepWiki/appsettings.Development.json"
{
  "ConnectionStrings": {
    "Default": "Data Source=opendeepwiki.db"
  },
  "AI": {
    "Endpoint": "https://api.openai.com/v1",
    "ApiKey": "your-api-key"
  }
}
```

你可能想设置的关键环境变量：

```bash
# AI 提供商配置
export CHAT_API_KEY=your-api-key
export ENDPOINT=https://api.openai.com/v1
export WIKI_CATALOG_MODEL=gpt-4o
export WIKI_CONTENT_MODEL=gpt-4o
export WIKI_CATALOG_API_KEY=your-api-key
export WIKI_CONTENT_API_KEY=your-api-key
```

默认情况下，后端使用 SQLite，本地数据库文件为 `opendeepwiki.db`（项目目录中）。
</Step>

<Step>
### 启动后端

```bash
dotnet run --project src/OpenDeepWiki/OpenDeepWiki.csproj
```

API 默认在 `http://localhost:5000` 启动（检查 `Properties/launchSettings.json` 获取确切端口）。
</Step>

<Step>
### 配置并启动前端

在另一个终端中：

```bash
cd web
npm install
```

创建或编辑 `web/.env.local` 以指向你的本地后端：

```bash title="web/.env.local"
API_PROXY_URL=http://localhost:5000
```

然后启动开发服务器：

```bash
npm run dev
```

前端在 [http://localhost:3000](http://localhost:3000) 启动。
</Step>

</Steps>

## 项目结构

```
OpenDeepWiki/
├── src/
│   ├── OpenDeepWiki/              # ASP.NET Core API（主入口）
│   │   ├── Endpoints/             # 最小 API 端点定义
│   │   ├── Services/              # 业务逻辑服务
│   │   ├── Agents/                # AI 代理和工具定义
│   │   ├── Chat/                  # 聊天系统（提供商、路由、队列）
│   │   ├── Models/                # 请求/响应 DTO
│   │   └── prompts/               # AI 提示模板（Markdown）
│   ├── OpenDeepWiki.Entities/     # 域实体和模型
│   ├── OpenDeepWiki.EFCore/       # 共享 EF Core DbContext
│   └── EFCore/
│       ├── OpenDeepWiki.Sqlite/   # SQLite 提供商
│       └── OpenDeepWiki.Postgresql/ # PostgreSQL 提供商
├── web/                           # Next.js 前端
│   ├── app/                       # App Router 页面
│   ├── components/                # React 组件
│   ├── hooks/                     # 自定义 React hooks
│   ├── lib/                       # API 客户端和工具
│   └── i18n/                      # 国际化
├── tests/
│   └── OpenDeepWiki.Tests/        # xUnit + FsCheck 测试
└── docs/                          # 本文档站点（Fumadocs）
```

## 运行测试

### 后端测试

```bash
dotnet test tests/OpenDeepWiki.Tests/OpenDeepWiki.Tests.csproj
```

### 前端 lint

```bash
cd web
npm run lint
```

## 常见问题

### 后端构建失败

- 确保你有 .NET 10 预览版 SDK：`dotnet --list-sdks`
- 从仓库根目录运行 `dotnet restore` 以恢复 NuGet 包

### 前端无法连接到后端

- 验证后端正在运行并检查 `Properties/launchSettings.json` 中的端口
- 确保 `web/.env.local` 中的 `API_PROXY_URL` 与后端 URL 匹配

### 数据库迁移错误

后端在启动时自动应用迁移。如果遇到问题，可以删除本地 `opendeepwiki.db` 文件并重启 — 它会被重新创建。
