---
title: 数据库配置
description: 将 SQLite 或 PostgreSQL 配置为 OpenDeepWiki 的数据库后端。
---

import { Callout } from "fumadocs-ui/components/callout";

# 数据库配置

OpenDeepWiki 支持两个数据库后端：**SQLite**（默认）和 **PostgreSQL**。数据库类型由 `DB_TYPE` 环境变量控制。

## SQLite（默认）

SQLite 无需额外设置。数据库文件会在首次运行时自动创建。

```yaml title="compose.yaml"
environment:
  - DB_TYPE=sqlite
  - CONNECTION_STRING=Data Source=/data/opendeepwiki.db
```

### 何时使用 SQLite

- 开发和测试
- 小到中等规模的部署（单实例）
- 快速设置，基础设施最少

<Callout type="info">
  在 Docker 中运行时，数据库文件存储在 `/data` 卷中。确保卷已映射以在容器重启后保持数据。
</Callout>

### SQLite 文件位置

| 环境 | 默认路径 |
|---|---|
| Docker | `/data/opendeepwiki.db` |
| 本地开发 | `./opendeepwiki.db`（项目根目录） |

## PostgreSQL

对于生产工作负载，推荐使用 PostgreSQL。它提供更好的并发性、可扩展性和数据完整性。

### 使用 PostgreSQL 的 Docker Compose

将 PostgreSQL 服务添加到你的 `compose.yaml`：

```yaml title="compose.yaml"
services:
  db:
    image: postgres:16
    restart: unless-stopped
    environment:
      - POSTGRES_DB=opendeepwiki
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=your-secure-password
    volumes:
      - pgdata:/var/lib/postgresql/data
    ports:
      - "5432:5432"

  opendeepwiki:
    # ... 其他配置 ...
    environment:
      - DB_TYPE=postgresql
      - CONNECTION_STRING=Host=db;Database=opendeepwiki;Username=postgres;Password=your-secure-password
    depends_on:
      - db

  web:
    # ... 其他配置 ...

volumes:
  pgdata:
```

### 外部 PostgreSQL

连接到现有的 PostgreSQL 实例：

```yaml title="compose.yaml"
environment:
  - DB_TYPE=postgresql
  - CONNECTION_STRING=Host=your-db-host;Port=5432;Database=opendeepwiki;Username=your-user;Password=your-password
```

### 连接字符串格式

PostgreSQL 连接字符串遵循标准 Npgsql 格式：

```
Host=<host>;Port=<port>;Database=<database>;Username=<user>;Password=<password>
```

| 参数 | 默认值 | 描述 |
|---|---|---|
| `Host` | — | 数据库服务器主机名或 IP |
| `Port` | `5432` | PostgreSQL 端口 |
| `Database` | — | 数据库名称 |
| `Username` | — | 数据库用户 |
| `Password` | — | 数据库密码 |

### 何时使用 PostgreSQL

- 生产部署
- 高并发或大规模使用
- 需要强大的备份和复制
- 多实例部署

## 数据库初始化

OpenDeepWiki 在启动时自动运行数据库迁移。无需手动迁移步骤 — 应用在首次启动时创建所有必要的表和架构。

<Callout type="info">
  数据库迁移通过启动期间的 `DbInitializer.InitializeAsync()` 自动应用。这对 SQLite 和 PostgreSQL 都适用。
</Callout>

## 切换数据库

从 SQLite 迁移到 PostgreSQL：

1. 设置 PostgreSQL 实例
2. 在环境中更新 `DB_TYPE` 和 `CONNECTION_STRING`
3. 重启应用 — 架构将自动创建
4. 重新提交仓库以重新生成文档

<Callout type="warn">
  SQLite 和 PostgreSQL 之间没有内置的数据迁移工具。切换数据库需要从仓库重新生成文档。
</Callout>

## 配置参考

| 变量 | 值 | 默认值 | 描述 |
|---|---|---|---|
| `DB_TYPE` | `sqlite`、`postgresql` | `sqlite` | 数据库后端类型 |
| `CONNECTION_STRING` | 连接字符串 | `Data Source=/data/opendeepwiki.db` | 数据库连接字符串 |

数据库类型也可以通过 `appsettings.json` 设置：

```json title="appsettings.json"
{
  "Database": {
    "Type": "sqlite"
  },
  "ConnectionStrings": {
    "Default": "Data Source=/data/opendeepwiki.db"
  }
}
```

环境变量优先于 `appsettings.json` 值。
